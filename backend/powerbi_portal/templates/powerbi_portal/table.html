<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ view_name }} - PowerBI Portal</title>
    <style>
      body{font-family:Arial,sans-serif;background:#f5f6f8;margin:0;padding:24px}
      .top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
      .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
      a{color:#2563eb;text-decoration:none}
      .muted{color:#6b7280;font-size:13px}
      .btn{display:inline-block;padding:8px 10px;border:1px solid #d1d5db;border-radius:10px;background:#fff}
      table{border-collapse:collapse;width:100%;font-size:12px}
      th,td{border:1px solid #e5e7eb;padding:6px;vertical-align:top;white-space:nowrap}
      th{background:#f9fafb;text-align:left;position:sticky;top:0}
      .scroll{overflow:auto;max-height:70vh;border:1px solid #e5e7eb;border-radius:10px}
      .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
      select,input{padding:8px;border:1px solid #d1d5db;border-radius:10px;background:#fff}
    </style>
  </head>
  <body>
    <div class="top">
      <div>
        <div style="font-size:18px;font-weight:700;">{{ view_name }}</div>
        <div class="muted">Showing first {{ limit }} rows (live)</div>
      </div>
      <div class="row">
        <a class="btn" href="/powerbi/">All views</a>
        {% if can_export %}
          <form method="get" action="/powerbi/export/{{ view_name }}/" class="row" style="gap:6px;">
            <input type="hidden" name="limit" value="{{ limit }}" />
            <select name="format">
              <option value="xlsx" selected>Excel</option>
              <option value="csv">CSV</option>
              <option value="pdf">PDF</option>
            </select>
            <button class="btn" type="submit">Download</button>
          </form>
        {% endif %}
        <form method="post" action="/powerbi/logout/" style="display:inline;">
          {% csrf_token %}
          <button class="btn" type="submit">Logout</button>
        </form>
      </div>
    </div>

    <div class="card" style="margin-bottom:12px;">
      <form method="get" class="row">
        <label class="muted">View</label>
        <select name="_" onchange="location.href='/powerbi/view/' + this.value + '/';">
          {% for v in available_views %}
            <option value="{{ v }}" {% if v == view_name %}selected{% endif %}>{{ v }}</option>
          {% endfor %}
        </select>

        <label class="muted">Limit</label>
        <input name="limit" type="number" min="1" max="2000" value="{{ limit }}" />
        <button class="btn" type="submit">Reload</button>
      </form>
    </div>

    <div class="card">
      <div class="scroll">
        <table>
          <thead>
            <tr>
              {% for c in cols %}
                <th>{{ c }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr>
                {% for cell in r %}
                  <td>{{ cell }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% if not rows %}
        <div class="muted" style="margin-top:10px;">No rows returned.</div>
      {% endif %}
    </div>
  </body>
</html>
