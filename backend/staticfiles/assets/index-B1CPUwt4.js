var aT=Object.defineProperty;var iT=(e,t,r)=>t in e?aT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var os=(e,t,r)=>iT(e,typeof t!="symbol"?t+"":t,r);function oT(e,t){for(var r=0;r<t.length;r++){const s=t[r];if(typeof s!="string"&&!Array.isArray(s)){for(const a in s)if(a!=="default"&&!(a in e)){const i=Object.getOwnPropertyDescriptor(s,a);i&&Object.defineProperty(e,a,i.get?i:{enumerable:!0,get:()=>s[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var aZ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lT(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var M4={exports:{}},P1={},R4={exports:{}},zn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ap=Symbol.for("react.element"),cT=Symbol.for("react.portal"),dT=Symbol.for("react.fragment"),uT=Symbol.for("react.strict_mode"),fT=Symbol.for("react.profiler"),hT=Symbol.for("react.provider"),pT=Symbol.for("react.context"),mT=Symbol.for("react.forward_ref"),xT=Symbol.for("react.suspense"),gT=Symbol.for("react.memo"),yT=Symbol.for("react.lazy"),R5=Symbol.iterator;function bT(e){return e===null||typeof e!="object"?null:(e=R5&&e[R5]||e["@@iterator"],typeof e=="function"?e:null)}var B4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},P4=Object.assign,O4={};function f0(e,t,r){this.props=e,this.context=t,this.refs=O4,this.updater=r||B4}f0.prototype.isReactComponent={};f0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};f0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function I4(){}I4.prototype=f0.prototype;function Q2(e,t,r){this.props=e,this.context=t,this.refs=O4,this.updater=r||B4}var X2=Q2.prototype=new I4;X2.constructor=Q2;P4(X2,f0.prototype);X2.isPureReactComponent=!0;var B5=Array.isArray,D4=Object.prototype.hasOwnProperty,Y2={current:null},U4={key:!0,ref:!0,__self:!0,__source:!0};function $4(e,t,r){var s,a={},i=null,o=null;if(t!=null)for(s in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)D4.call(t,s)&&!U4.hasOwnProperty(s)&&(a[s]=t[s]);var l=arguments.length-2;if(l===1)a.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)a[s]===void 0&&(a[s]=l[s]);return{$$typeof:Ap,type:e,key:i,ref:o,props:a,_owner:Y2.current}}function vT(e,t){return{$$typeof:Ap,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function K2(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ap}function wT(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var P5=/\/+/g;function Dg(e,t){return typeof e=="object"&&e!==null&&e.key!=null?wT(""+e.key):t.toString(36)}function fx(e,t,r,s,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ap:case cT:o=!0}}if(o)return o=e,a=a(o),e=s===""?"."+Dg(o,0):s,B5(a)?(r="",e!=null&&(r=e.replace(P5,"$&/")+"/"),fx(a,t,r,"",function(d){return d})):a!=null&&(K2(a)&&(a=vT(a,r+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(P5,"$&/")+"/")+e)),t.push(a)),1;if(o=0,s=s===""?".":s+":",B5(e))for(var l=0;l<e.length;l++){i=e[l];var c=s+Dg(i,l);o+=fx(i,t,r,c,a)}else if(c=bT(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=s+Dg(i,l++),o+=fx(i,t,r,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function pm(e,t,r){if(e==null)return e;var s=[],a=0;return fx(e,s,"","",function(i){return t.call(r,i,a++)}),s}function ST(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Fi={current:null},hx={transition:null},_T={ReactCurrentDispatcher:Fi,ReactCurrentBatchConfig:hx,ReactCurrentOwner:Y2};function W4(){throw Error("act(...) is not supported in production builds of React.")}zn.Children={map:pm,forEach:function(e,t,r){pm(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return pm(e,function(){t++}),t},toArray:function(e){return pm(e,function(t){return t})||[]},only:function(e){if(!K2(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};zn.Component=f0;zn.Fragment=dT;zn.Profiler=fT;zn.PureComponent=Q2;zn.StrictMode=uT;zn.Suspense=xT;zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_T;zn.act=W4;zn.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=P4({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Y2.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)D4.call(t,c)&&!U4.hasOwnProperty(c)&&(s[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)s.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:Ap,type:e.type,key:a,ref:i,props:s,_owner:o}};zn.createContext=function(e){return e={$$typeof:pT,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:hT,_context:e},e.Consumer=e};zn.createElement=$4;zn.createFactory=function(e){var t=$4.bind(null,e);return t.type=e,t};zn.createRef=function(){return{current:null}};zn.forwardRef=function(e){return{$$typeof:mT,render:e}};zn.isValidElement=K2;zn.lazy=function(e){return{$$typeof:yT,_payload:{_status:-1,_result:e},_init:ST}};zn.memo=function(e,t){return{$$typeof:gT,type:e,compare:t===void 0?null:t}};zn.startTransition=function(e){var t=hx.transition;hx.transition={};try{e()}finally{hx.transition=t}};zn.unstable_act=W4;zn.useCallback=function(e,t){return Fi.current.useCallback(e,t)};zn.useContext=function(e){return Fi.current.useContext(e)};zn.useDebugValue=function(){};zn.useDeferredValue=function(e){return Fi.current.useDeferredValue(e)};zn.useEffect=function(e,t){return Fi.current.useEffect(e,t)};zn.useId=function(){return Fi.current.useId()};zn.useImperativeHandle=function(e,t,r){return Fi.current.useImperativeHandle(e,t,r)};zn.useInsertionEffect=function(e,t){return Fi.current.useInsertionEffect(e,t)};zn.useLayoutEffect=function(e,t){return Fi.current.useLayoutEffect(e,t)};zn.useMemo=function(e,t){return Fi.current.useMemo(e,t)};zn.useReducer=function(e,t,r){return Fi.current.useReducer(e,t,r)};zn.useRef=function(e){return Fi.current.useRef(e)};zn.useState=function(e){return Fi.current.useState(e)};zn.useSyncExternalStore=function(e,t,r){return Fi.current.useSyncExternalStore(e,t,r)};zn.useTransition=function(){return Fi.current.useTransition()};zn.version="18.3.1";R4.exports=zn;var v=R4.exports;const Jr=lT(v),kT=oT({__proto__:null,default:Jr},[v]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jT=v,NT=Symbol.for("react.element"),AT=Symbol.for("react.fragment"),CT=Object.prototype.hasOwnProperty,ET=jT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,TT={key:!0,ref:!0,__self:!0,__source:!0};function z4(e,t,r){var s,a={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(s in t)CT.call(t,s)&&!TT.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)a[s]===void 0&&(a[s]=t[s]);return{$$typeof:NT,type:e,key:i,ref:o,props:a,_owner:ET.current}}P1.Fragment=AT;P1.jsx=z4;P1.jsxs=z4;M4.exports=P1;var n=M4.exports,q4={exports:{}},jo={},H4={exports:{}},V4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(R,q){var me=R.length;R.push(q);e:for(;0<me;){var fe=me-1>>>1,E=R[fe];if(0<a(E,q))R[fe]=q,R[me]=E,me=fe;else break e}}function r(R){return R.length===0?null:R[0]}function s(R){if(R.length===0)return null;var q=R[0],me=R.pop();if(me!==q){R[0]=me;e:for(var fe=0,E=R.length,U=E>>>1;fe<U;){var I=2*(fe+1)-1,M=R[I],te=I+1,Q=R[te];if(0>a(M,me))te<E&&0>a(Q,M)?(R[fe]=Q,R[te]=me,fe=te):(R[fe]=M,R[I]=me,fe=I);else if(te<E&&0>a(Q,me))R[fe]=Q,R[te]=me,fe=te;else break e}}return q}function a(R,q){var me=R.sortIndex-q.sortIndex;return me!==0?me:R.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,p=3,f=!1,x=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(R){for(var q=r(d);q!==null;){if(q.callback===null)s(d);else if(q.startTime<=R)s(d),q.sortIndex=q.expirationTime,t(c,q);else break;q=r(d)}}function k(R){if(g=!1,S(R),!x)if(r(c)!==null)x=!0,ge(F);else{var q=r(d);q!==null&&Fe(k,q.startTime-R)}}function F(R,q){x=!1,g&&(g=!1,m(O),O=-1),f=!0;var me=p;try{for(S(q),h=r(c);h!==null&&(!(h.expirationTime>q)||R&&!A());){var fe=h.callback;if(typeof fe=="function"){h.callback=null,p=h.priorityLevel;var E=fe(h.expirationTime<=q);q=e.unstable_now(),typeof E=="function"?h.callback=E:h===r(c)&&s(c),S(q)}else s(c);h=r(c)}if(h!==null)var U=!0;else{var I=r(d);I!==null&&Fe(k,I.startTime-q),U=!1}return U}finally{h=null,p=me,f=!1}}var L=!1,C=null,O=-1,T=5,W=-1;function A(){return!(e.unstable_now()-W<T)}function N(){if(C!==null){var R=e.unstable_now();W=R;var q=!0;try{q=C(!0,R)}finally{q?P():(L=!1,C=null)}}else L=!1}var P;if(typeof w=="function")P=function(){w(N)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,re=K.port2;K.port1.onmessage=N,P=function(){re.postMessage(null)}}else P=function(){y(N,0)};function ge(R){C=R,L||(L=!0,P())}function Fe(R,q){O=y(function(){R(e.unstable_now())},q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(R){R.callback=null},e.unstable_continueExecution=function(){x||f||(x=!0,ge(F))},e.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<R?Math.floor(1e3/R):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(R){switch(p){case 1:case 2:case 3:var q=3;break;default:q=p}var me=p;p=q;try{return R()}finally{p=me}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(R,q){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var me=p;p=R;try{return q()}finally{p=me}},e.unstable_scheduleCallback=function(R,q,me){var fe=e.unstable_now();switch(typeof me=="object"&&me!==null?(me=me.delay,me=typeof me=="number"&&0<me?fe+me:fe):me=fe,R){case 1:var E=-1;break;case 2:E=250;break;case 5:E=1073741823;break;case 4:E=1e4;break;default:E=5e3}return E=me+E,R={id:u++,callback:q,priorityLevel:R,startTime:me,expirationTime:E,sortIndex:-1},me>fe?(R.sortIndex=me,t(d,R),r(c)===null&&R===r(d)&&(g?(m(O),O=-1):g=!0,Fe(k,me-fe))):(R.sortIndex=E,t(c,R),x||f||(x=!0,ge(F))),R},e.unstable_shouldYield=A,e.unstable_wrapCallback=function(R){var q=p;return function(){var me=p;p=q;try{return R.apply(this,arguments)}finally{p=me}}}})(V4);H4.exports=V4;var LT=H4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FT=v,_o=LT;function Dr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var G4=new Set,Dh={};function Eu(e,t){e0(e,t),e0(e+"Capture",t)}function e0(e,t){for(Dh[e]=t,e=0;e<t.length;e++)G4.add(t[e])}var vc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pb=Object.prototype.hasOwnProperty,MT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,O5={},I5={};function RT(e){return pb.call(I5,e)?!0:pb.call(O5,e)?!1:MT.test(e)?I5[e]=!0:(O5[e]=!0,!1)}function BT(e,t,r,s){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function PT(e,t,r,s){if(t===null||typeof t>"u"||BT(e,t,r,s))return!0;if(s)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Mi(e,t,r,s,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var ti={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ti[e]=new Mi(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ti[t]=new Mi(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ti[e]=new Mi(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ti[e]=new Mi(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ti[e]=new Mi(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ti[e]=new Mi(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ti[e]=new Mi(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ti[e]=new Mi(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ti[e]=new Mi(e,5,!1,e.toLowerCase(),null,!1,!1)});var J2=/[\-:]([a-z])/g;function Z2(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(J2,Z2);ti[t]=new Mi(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(J2,Z2);ti[t]=new Mi(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(J2,Z2);ti[t]=new Mi(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ti[e]=new Mi(e,1,!1,e.toLowerCase(),null,!1,!1)});ti.xlinkHref=new Mi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ti[e]=new Mi(e,1,!1,e.toLowerCase(),null,!0,!0)});function ev(e,t,r,s){var a=ti.hasOwnProperty(t)?ti[t]:null;(a!==null?a.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(PT(t,r,a,s)&&(r=null),s||a===null?RT(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,s=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,s?e.setAttributeNS(s,t,r):e.setAttribute(t,r))))}var Ac=FT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mm=Symbol.for("react.element"),yf=Symbol.for("react.portal"),bf=Symbol.for("react.fragment"),tv=Symbol.for("react.strict_mode"),mb=Symbol.for("react.profiler"),Q4=Symbol.for("react.provider"),X4=Symbol.for("react.context"),rv=Symbol.for("react.forward_ref"),xb=Symbol.for("react.suspense"),gb=Symbol.for("react.suspense_list"),nv=Symbol.for("react.memo"),ed=Symbol.for("react.lazy"),Y4=Symbol.for("react.offscreen"),D5=Symbol.iterator;function G0(e){return e===null||typeof e!="object"?null:(e=D5&&e[D5]||e["@@iterator"],typeof e=="function"?e:null)}var Us=Object.assign,Ug;function hh(e){if(Ug===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);Ug=t&&t[1]||""}return`
`+Ug+e}var $g=!1;function Wg(e,t){if(!e||$g)return"";$g=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var s=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){s=d}e.call(t.prototype)}else{try{throw Error()}catch(d){s=d}e()}}catch(d){if(d&&s&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=s.stack.split(`
`),o=a.length-1,l=i.length-1;1<=o&&0<=l&&a[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(a[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||a[o]!==i[l]){var c=`
`+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=l);break}}}finally{$g=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?hh(e):""}function OT(e){switch(e.tag){case 5:return hh(e.type);case 16:return hh("Lazy");case 13:return hh("Suspense");case 19:return hh("SuspenseList");case 0:case 2:case 15:return e=Wg(e.type,!1),e;case 11:return e=Wg(e.type.render,!1),e;case 1:return e=Wg(e.type,!0),e;default:return""}}function yb(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case bf:return"Fragment";case yf:return"Portal";case mb:return"Profiler";case tv:return"StrictMode";case xb:return"Suspense";case gb:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case X4:return(e.displayName||"Context")+".Consumer";case Q4:return(e._context.displayName||"Context")+".Provider";case rv:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case nv:return t=e.displayName||null,t!==null?t:yb(e.type)||"Memo";case ed:t=e._payload,e=e._init;try{return yb(e(t))}catch{}}return null}function IT(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yb(t);case 8:return t===tv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function wd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function K4(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function DT(e){var t=K4(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function xm(e){e._valueTracker||(e._valueTracker=DT(e))}function J4(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=K4(e)?e.checked?"true":"false":e.value),e=s,e!==r?(t.setValue(e),!0):!1}function Ix(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function bb(e,t){var r=t.checked;return Us({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function U5(e,t){var r=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;r=wd(t.value!=null?t.value:r),e._wrapperState={initialChecked:s,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Z4(e,t){t=t.checked,t!=null&&ev(e,"checked",t,!1)}function vb(e,t){Z4(e,t);var r=wd(t.value),s=t.type;if(r!=null)s==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?wb(e,t.type,r):t.hasOwnProperty("defaultValue")&&wb(e,t.type,wd(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function $5(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function wb(e,t,r){(t!=="number"||Ix(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var ph=Array.isArray;function Pf(e,t,r,s){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&s&&(e[r].defaultSelected=!0)}else{for(r=""+wd(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,s&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Sb(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Dr(91));return Us({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function W5(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Dr(92));if(ph(r)){if(1<r.length)throw Error(Dr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:wd(r)}}function e3(e,t){var r=wd(t.value),s=wd(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),s!=null&&(e.defaultValue=""+s)}function z5(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function t3(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _b(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?t3(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var gm,r3=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,s,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,s,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(gm=gm||document.createElement("div"),gm.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=gm.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Uh(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var vh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},UT=["Webkit","ms","Moz","O"];Object.keys(vh).forEach(function(e){UT.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),vh[t]=vh[e]})});function n3(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||vh.hasOwnProperty(e)&&vh[e]?(""+t).trim():t+"px"}function s3(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var s=r.indexOf("--")===0,a=n3(r,t[r],s);r==="float"&&(r="cssFloat"),s?e.setProperty(r,a):e[r]=a}}var $T=Us({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function kb(e,t){if(t){if($T[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Dr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Dr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Dr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Dr(62))}}function jb(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nb=null;function sv(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ab=null,Of=null,If=null;function q5(e){if(e=Tp(e)){if(typeof Ab!="function")throw Error(Dr(280));var t=e.stateNode;t&&(t=$1(t),Ab(e.stateNode,e.type,t))}}function a3(e){Of?If?If.push(e):If=[e]:Of=e}function i3(){if(Of){var e=Of,t=If;if(If=Of=null,q5(e),t)for(e=0;e<t.length;e++)q5(t[e])}}function o3(e,t){return e(t)}function l3(){}var zg=!1;function c3(e,t,r){if(zg)return e(t,r);zg=!0;try{return o3(e,t,r)}finally{zg=!1,(Of!==null||If!==null)&&(l3(),i3())}}function $h(e,t){var r=e.stateNode;if(r===null)return null;var s=$1(r);if(s===null)return null;r=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Dr(231,t,typeof r));return r}var Cb=!1;if(vc)try{var Q0={};Object.defineProperty(Q0,"passive",{get:function(){Cb=!0}}),window.addEventListener("test",Q0,Q0),window.removeEventListener("test",Q0,Q0)}catch{Cb=!1}function WT(e,t,r,s,a,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(u){this.onError(u)}}var wh=!1,Dx=null,Ux=!1,Eb=null,zT={onError:function(e){wh=!0,Dx=e}};function qT(e,t,r,s,a,i,o,l,c){wh=!1,Dx=null,WT.apply(zT,arguments)}function HT(e,t,r,s,a,i,o,l,c){if(qT.apply(this,arguments),wh){if(wh){var d=Dx;wh=!1,Dx=null}else throw Error(Dr(198));Ux||(Ux=!0,Eb=d)}}function Tu(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function d3(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function H5(e){if(Tu(e)!==e)throw Error(Dr(188))}function VT(e){var t=e.alternate;if(!t){if(t=Tu(e),t===null)throw Error(Dr(188));return t!==e?null:e}for(var r=e,s=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(s=a.return,s!==null){r=s;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return H5(a),e;if(i===s)return H5(a),t;i=i.sibling}throw Error(Dr(188))}if(r.return!==s.return)r=a,s=i;else{for(var o=!1,l=a.child;l;){if(l===r){o=!0,r=a,s=i;break}if(l===s){o=!0,s=a,r=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===r){o=!0,r=i,s=a;break}if(l===s){o=!0,s=i,r=a;break}l=l.sibling}if(!o)throw Error(Dr(189))}}if(r.alternate!==s)throw Error(Dr(190))}if(r.tag!==3)throw Error(Dr(188));return r.stateNode.current===r?e:t}function u3(e){return e=VT(e),e!==null?f3(e):null}function f3(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=f3(e);if(t!==null)return t;e=e.sibling}return null}var h3=_o.unstable_scheduleCallback,V5=_o.unstable_cancelCallback,GT=_o.unstable_shouldYield,QT=_o.unstable_requestPaint,aa=_o.unstable_now,XT=_o.unstable_getCurrentPriorityLevel,av=_o.unstable_ImmediatePriority,p3=_o.unstable_UserBlockingPriority,$x=_o.unstable_NormalPriority,YT=_o.unstable_LowPriority,m3=_o.unstable_IdlePriority,O1=null,Hl=null;function KT(e){if(Hl&&typeof Hl.onCommitFiberRoot=="function")try{Hl.onCommitFiberRoot(O1,e,void 0,(e.current.flags&128)===128)}catch{}}var hl=Math.clz32?Math.clz32:e7,JT=Math.log,ZT=Math.LN2;function e7(e){return e>>>=0,e===0?32:31-(JT(e)/ZT|0)|0}var ym=64,bm=4194304;function mh(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Wx(e,t){var r=e.pendingLanes;if(r===0)return 0;var s=0,a=e.suspendedLanes,i=e.pingedLanes,o=r&268435455;if(o!==0){var l=o&~a;l!==0?s=mh(l):(i&=o,i!==0&&(s=mh(i)))}else o=r&~a,o!==0?s=mh(o):i!==0&&(s=mh(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&a)&&(a=s&-s,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(s&4&&(s|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)r=31-hl(t),a=1<<r,s|=e[r],t&=~a;return s}function t7(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function r7(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-hl(i),l=1<<o,c=a[o];c===-1?(!(l&r)||l&s)&&(a[o]=t7(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Tb(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function x3(){var e=ym;return ym<<=1,!(ym&4194240)&&(ym=64),e}function qg(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Cp(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-hl(t),e[t]=r}function n7(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-hl(r),i=1<<a;t[a]=0,s[a]=-1,e[a]=-1,r&=~i}}function iv(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-hl(r),a=1<<s;a&t|e[s]&t&&(e[s]|=t),r&=~a}}var fs=0;function g3(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var y3,ov,b3,v3,w3,Lb=!1,vm=[],fd=null,hd=null,pd=null,Wh=new Map,zh=new Map,rd=[],s7="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function G5(e,t){switch(e){case"focusin":case"focusout":fd=null;break;case"dragenter":case"dragleave":hd=null;break;case"mouseover":case"mouseout":pd=null;break;case"pointerover":case"pointerout":Wh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":zh.delete(t.pointerId)}}function X0(e,t,r,s,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Tp(t),t!==null&&ov(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function a7(e,t,r,s,a){switch(t){case"focusin":return fd=X0(fd,e,t,r,s,a),!0;case"dragenter":return hd=X0(hd,e,t,r,s,a),!0;case"mouseover":return pd=X0(pd,e,t,r,s,a),!0;case"pointerover":var i=a.pointerId;return Wh.set(i,X0(Wh.get(i)||null,e,t,r,s,a)),!0;case"gotpointercapture":return i=a.pointerId,zh.set(i,X0(zh.get(i)||null,e,t,r,s,a)),!0}return!1}function S3(e){var t=Jd(e.target);if(t!==null){var r=Tu(t);if(r!==null){if(t=r.tag,t===13){if(t=d3(r),t!==null){e.blockedOn=t,w3(e.priority,function(){b3(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function px(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=Fb(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);Nb=s,r.target.dispatchEvent(s),Nb=null}else return t=Tp(r),t!==null&&ov(t),e.blockedOn=r,!1;t.shift()}return!0}function Q5(e,t,r){px(e)&&r.delete(t)}function i7(){Lb=!1,fd!==null&&px(fd)&&(fd=null),hd!==null&&px(hd)&&(hd=null),pd!==null&&px(pd)&&(pd=null),Wh.forEach(Q5),zh.forEach(Q5)}function Y0(e,t){e.blockedOn===t&&(e.blockedOn=null,Lb||(Lb=!0,_o.unstable_scheduleCallback(_o.unstable_NormalPriority,i7)))}function qh(e){function t(a){return Y0(a,e)}if(0<vm.length){Y0(vm[0],e);for(var r=1;r<vm.length;r++){var s=vm[r];s.blockedOn===e&&(s.blockedOn=null)}}for(fd!==null&&Y0(fd,e),hd!==null&&Y0(hd,e),pd!==null&&Y0(pd,e),Wh.forEach(t),zh.forEach(t),r=0;r<rd.length;r++)s=rd[r],s.blockedOn===e&&(s.blockedOn=null);for(;0<rd.length&&(r=rd[0],r.blockedOn===null);)S3(r),r.blockedOn===null&&rd.shift()}var Df=Ac.ReactCurrentBatchConfig,zx=!0;function o7(e,t,r,s){var a=fs,i=Df.transition;Df.transition=null;try{fs=1,lv(e,t,r,s)}finally{fs=a,Df.transition=i}}function l7(e,t,r,s){var a=fs,i=Df.transition;Df.transition=null;try{fs=4,lv(e,t,r,s)}finally{fs=a,Df.transition=i}}function lv(e,t,r,s){if(zx){var a=Fb(e,t,r,s);if(a===null)ey(e,t,s,qx,r),G5(e,s);else if(a7(a,e,t,r,s))s.stopPropagation();else if(G5(e,s),t&4&&-1<s7.indexOf(e)){for(;a!==null;){var i=Tp(a);if(i!==null&&y3(i),i=Fb(e,t,r,s),i===null&&ey(e,t,s,qx,r),i===a)break;a=i}a!==null&&s.stopPropagation()}else ey(e,t,s,null,r)}}var qx=null;function Fb(e,t,r,s){if(qx=null,e=sv(s),e=Jd(e),e!==null)if(t=Tu(e),t===null)e=null;else if(r=t.tag,r===13){if(e=d3(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qx=e,null}function _3(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XT()){case av:return 1;case p3:return 4;case $x:case YT:return 16;case m3:return 536870912;default:return 16}default:return 16}}var id=null,cv=null,mx=null;function k3(){if(mx)return mx;var e,t=cv,r=t.length,s,a="value"in id?id.value:id.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var o=r-e;for(s=1;s<=o&&t[r-s]===a[i-s];s++);return mx=a.slice(e,1<s?1-s:void 0)}function xx(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function wm(){return!0}function X5(){return!1}function No(e){function t(r,s,a,i,o){this._reactName=r,this._targetInst=a,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(r=e[l],this[l]=r?r(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?wm:X5,this.isPropagationStopped=X5,this}return Us(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=wm)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=wm)},persist:function(){},isPersistent:wm}),t}var h0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dv=No(h0),Ep=Us({},h0,{view:0,detail:0}),c7=No(Ep),Hg,Vg,K0,I1=Us({},Ep,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uv,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==K0&&(K0&&e.type==="mousemove"?(Hg=e.screenX-K0.screenX,Vg=e.screenY-K0.screenY):Vg=Hg=0,K0=e),Hg)},movementY:function(e){return"movementY"in e?e.movementY:Vg}}),Y5=No(I1),d7=Us({},I1,{dataTransfer:0}),u7=No(d7),f7=Us({},Ep,{relatedTarget:0}),Gg=No(f7),h7=Us({},h0,{animationName:0,elapsedTime:0,pseudoElement:0}),p7=No(h7),m7=Us({},h0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),x7=No(m7),g7=Us({},h0,{data:0}),K5=No(g7),y7={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b7={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},v7={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function w7(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=v7[e])?!!t[e]:!1}function uv(){return w7}var S7=Us({},Ep,{key:function(e){if(e.key){var t=y7[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=xx(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?b7[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uv,charCode:function(e){return e.type==="keypress"?xx(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?xx(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),_7=No(S7),k7=Us({},I1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),J5=No(k7),j7=Us({},Ep,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uv}),N7=No(j7),A7=Us({},h0,{propertyName:0,elapsedTime:0,pseudoElement:0}),C7=No(A7),E7=Us({},I1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),T7=No(E7),L7=[9,13,27,32],fv=vc&&"CompositionEvent"in window,Sh=null;vc&&"documentMode"in document&&(Sh=document.documentMode);var F7=vc&&"TextEvent"in window&&!Sh,j3=vc&&(!fv||Sh&&8<Sh&&11>=Sh),Z5=" ",eS=!1;function N3(e,t){switch(e){case"keyup":return L7.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function A3(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var vf=!1;function M7(e,t){switch(e){case"compositionend":return A3(t);case"keypress":return t.which!==32?null:(eS=!0,Z5);case"textInput":return e=t.data,e===Z5&&eS?null:e;default:return null}}function R7(e,t){if(vf)return e==="compositionend"||!fv&&N3(e,t)?(e=k3(),mx=cv=id=null,vf=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return j3&&t.locale!=="ko"?null:t.data;default:return null}}var B7={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tS(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!B7[e.type]:t==="textarea"}function C3(e,t,r,s){a3(s),t=Hx(t,"onChange"),0<t.length&&(r=new dv("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var _h=null,Hh=null;function P7(e){D3(e,0)}function D1(e){var t=_f(e);if(J4(t))return e}function O7(e,t){if(e==="change")return t}var E3=!1;if(vc){var Qg;if(vc){var Xg="oninput"in document;if(!Xg){var rS=document.createElement("div");rS.setAttribute("oninput","return;"),Xg=typeof rS.oninput=="function"}Qg=Xg}else Qg=!1;E3=Qg&&(!document.documentMode||9<document.documentMode)}function nS(){_h&&(_h.detachEvent("onpropertychange",T3),Hh=_h=null)}function T3(e){if(e.propertyName==="value"&&D1(Hh)){var t=[];C3(t,Hh,e,sv(e)),c3(P7,t)}}function I7(e,t,r){e==="focusin"?(nS(),_h=t,Hh=r,_h.attachEvent("onpropertychange",T3)):e==="focusout"&&nS()}function D7(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return D1(Hh)}function U7(e,t){if(e==="click")return D1(t)}function $7(e,t){if(e==="input"||e==="change")return D1(t)}function W7(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var yl=typeof Object.is=="function"?Object.is:W7;function Vh(e,t){if(yl(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var a=r[s];if(!pb.call(t,a)||!yl(e[a],t[a]))return!1}return!0}function sS(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function aS(e,t){var r=sS(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=t&&s>=t)return{node:r,offset:t-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=sS(r)}}function L3(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?L3(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function F3(){for(var e=window,t=Ix();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Ix(e.document)}return t}function hv(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function z7(e){var t=F3(),r=e.focusedElem,s=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&L3(r.ownerDocument.documentElement,r)){if(s!==null&&hv(r)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,i=Math.min(s.start,a);s=s.end===void 0?i:Math.min(s.end,a),!e.extend&&i>s&&(a=s,s=i,i=a),a=aS(r,i);var o=aS(r,s);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var q7=vc&&"documentMode"in document&&11>=document.documentMode,wf=null,Mb=null,kh=null,Rb=!1;function iS(e,t,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Rb||wf==null||wf!==Ix(s)||(s=wf,"selectionStart"in s&&hv(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),kh&&Vh(kh,s)||(kh=s,s=Hx(Mb,"onSelect"),0<s.length&&(t=new dv("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=wf)))}function Sm(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Sf={animationend:Sm("Animation","AnimationEnd"),animationiteration:Sm("Animation","AnimationIteration"),animationstart:Sm("Animation","AnimationStart"),transitionend:Sm("Transition","TransitionEnd")},Yg={},M3={};vc&&(M3=document.createElement("div").style,"AnimationEvent"in window||(delete Sf.animationend.animation,delete Sf.animationiteration.animation,delete Sf.animationstart.animation),"TransitionEvent"in window||delete Sf.transitionend.transition);function U1(e){if(Yg[e])return Yg[e];if(!Sf[e])return e;var t=Sf[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in M3)return Yg[e]=t[r];return e}var R3=U1("animationend"),B3=U1("animationiteration"),P3=U1("animationstart"),O3=U1("transitionend"),I3=new Map,oS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Td(e,t){I3.set(e,t),Eu(t,[e])}for(var Kg=0;Kg<oS.length;Kg++){var Jg=oS[Kg],H7=Jg.toLowerCase(),V7=Jg[0].toUpperCase()+Jg.slice(1);Td(H7,"on"+V7)}Td(R3,"onAnimationEnd");Td(B3,"onAnimationIteration");Td(P3,"onAnimationStart");Td("dblclick","onDoubleClick");Td("focusin","onFocus");Td("focusout","onBlur");Td(O3,"onTransitionEnd");e0("onMouseEnter",["mouseout","mouseover"]);e0("onMouseLeave",["mouseout","mouseover"]);e0("onPointerEnter",["pointerout","pointerover"]);e0("onPointerLeave",["pointerout","pointerover"]);Eu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Eu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Eu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Eu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Eu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Eu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G7=new Set("cancel close invalid load scroll toggle".split(" ").concat(xh));function lS(e,t,r){var s=e.type||"unknown-event";e.currentTarget=r,HT(s,t,void 0,e),e.currentTarget=null}function D3(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],a=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var o=s.length-1;0<=o;o--){var l=s[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;lS(a,l,d),i=c}else for(o=0;o<s.length;o++){if(l=s[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;lS(a,l,d),i=c}}}if(Ux)throw e=Eb,Ux=!1,Eb=null,e}function _s(e,t){var r=t[Db];r===void 0&&(r=t[Db]=new Set);var s=e+"__bubble";r.has(s)||(U3(t,e,2,!1),r.add(s))}function Zg(e,t,r){var s=0;t&&(s|=4),U3(r,e,s,t)}var _m="_reactListening"+Math.random().toString(36).slice(2);function Gh(e){if(!e[_m]){e[_m]=!0,G4.forEach(function(r){r!=="selectionchange"&&(G7.has(r)||Zg(r,!1,e),Zg(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[_m]||(t[_m]=!0,Zg("selectionchange",!1,t))}}function U3(e,t,r,s){switch(_3(t)){case 1:var a=o7;break;case 4:a=l7;break;default:a=lv}r=a.bind(null,t,r,e),a=void 0,!Cb||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),s?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function ey(e,t,r,s,a){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var l=s.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;o=o.return}for(;l!==null;){if(o=Jd(l),o===null)return;if(c=o.tag,c===5||c===6){s=i=o;continue e}l=l.parentNode}}s=s.return}c3(function(){var d=i,u=sv(r),h=[];e:{var p=I3.get(e);if(p!==void 0){var f=dv,x=e;switch(e){case"keypress":if(xx(r)===0)break e;case"keydown":case"keyup":f=_7;break;case"focusin":x="focus",f=Gg;break;case"focusout":x="blur",f=Gg;break;case"beforeblur":case"afterblur":f=Gg;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Y5;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=u7;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=N7;break;case R3:case B3:case P3:f=p7;break;case O3:f=C7;break;case"scroll":f=c7;break;case"wheel":f=T7;break;case"copy":case"cut":case"paste":f=x7;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=J5}var g=(t&4)!==0,y=!g&&e==="scroll",m=g?p!==null?p+"Capture":null:p;g=[];for(var w=d,S;w!==null;){S=w;var k=S.stateNode;if(S.tag===5&&k!==null&&(S=k,m!==null&&(k=$h(w,m),k!=null&&g.push(Qh(w,k,S)))),y)break;w=w.return}0<g.length&&(p=new f(p,x,null,r,u),h.push({event:p,listeners:g}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",p&&r!==Nb&&(x=r.relatedTarget||r.fromElement)&&(Jd(x)||x[wc]))break e;if((f||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,f?(x=r.relatedTarget||r.toElement,f=d,x=x?Jd(x):null,x!==null&&(y=Tu(x),x!==y||x.tag!==5&&x.tag!==6)&&(x=null)):(f=null,x=d),f!==x)){if(g=Y5,k="onMouseLeave",m="onMouseEnter",w="mouse",(e==="pointerout"||e==="pointerover")&&(g=J5,k="onPointerLeave",m="onPointerEnter",w="pointer"),y=f==null?p:_f(f),S=x==null?p:_f(x),p=new g(k,w+"leave",f,r,u),p.target=y,p.relatedTarget=S,k=null,Jd(u)===d&&(g=new g(m,w+"enter",x,r,u),g.target=S,g.relatedTarget=y,k=g),y=k,f&&x)t:{for(g=f,m=x,w=0,S=g;S;S=Qu(S))w++;for(S=0,k=m;k;k=Qu(k))S++;for(;0<w-S;)g=Qu(g),w--;for(;0<S-w;)m=Qu(m),S--;for(;w--;){if(g===m||m!==null&&g===m.alternate)break t;g=Qu(g),m=Qu(m)}g=null}else g=null;f!==null&&cS(h,p,f,g,!1),x!==null&&y!==null&&cS(h,y,x,g,!0)}}e:{if(p=d?_f(d):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var F=O7;else if(tS(p))if(E3)F=$7;else{F=D7;var L=I7}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(F=U7);if(F&&(F=F(e,d))){C3(h,F,r,u);break e}L&&L(e,p,d),e==="focusout"&&(L=p._wrapperState)&&L.controlled&&p.type==="number"&&wb(p,"number",p.value)}switch(L=d?_f(d):window,e){case"focusin":(tS(L)||L.contentEditable==="true")&&(wf=L,Mb=d,kh=null);break;case"focusout":kh=Mb=wf=null;break;case"mousedown":Rb=!0;break;case"contextmenu":case"mouseup":case"dragend":Rb=!1,iS(h,r,u);break;case"selectionchange":if(q7)break;case"keydown":case"keyup":iS(h,r,u)}var C;if(fv)e:{switch(e){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else vf?N3(e,r)&&(O="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(O="onCompositionStart");O&&(j3&&r.locale!=="ko"&&(vf||O!=="onCompositionStart"?O==="onCompositionEnd"&&vf&&(C=k3()):(id=u,cv="value"in id?id.value:id.textContent,vf=!0)),L=Hx(d,O),0<L.length&&(O=new K5(O,e,null,r,u),h.push({event:O,listeners:L}),C?O.data=C:(C=A3(r),C!==null&&(O.data=C)))),(C=F7?M7(e,r):R7(e,r))&&(d=Hx(d,"onBeforeInput"),0<d.length&&(u=new K5("onBeforeInput","beforeinput",null,r,u),h.push({event:u,listeners:d}),u.data=C))}D3(h,t)})}function Qh(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Hx(e,t){for(var r=t+"Capture",s=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=$h(e,r),i!=null&&s.unshift(Qh(e,i,a)),i=$h(e,t),i!=null&&s.push(Qh(e,i,a))),e=e.return}return s}function Qu(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function cS(e,t,r,s,a){for(var i=t._reactName,o=[];r!==null&&r!==s;){var l=r,c=l.alternate,d=l.stateNode;if(c!==null&&c===s)break;l.tag===5&&d!==null&&(l=d,a?(c=$h(r,i),c!=null&&o.unshift(Qh(r,c,l))):a||(c=$h(r,i),c!=null&&o.push(Qh(r,c,l)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var Q7=/\r\n?/g,X7=/\u0000|\uFFFD/g;function dS(e){return(typeof e=="string"?e:""+e).replace(Q7,`
`).replace(X7,"")}function km(e,t,r){if(t=dS(t),dS(e)!==t&&r)throw Error(Dr(425))}function Vx(){}var Bb=null,Pb=null;function Ob(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ib=typeof setTimeout=="function"?setTimeout:void 0,Y7=typeof clearTimeout=="function"?clearTimeout:void 0,uS=typeof Promise=="function"?Promise:void 0,K7=typeof queueMicrotask=="function"?queueMicrotask:typeof uS<"u"?function(e){return uS.resolve(null).then(e).catch(J7)}:Ib;function J7(e){setTimeout(function(){throw e})}function ty(e,t){var r=t,s=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(s===0){e.removeChild(a),qh(t);return}s--}else r!=="$"&&r!=="$?"&&r!=="$!"||s++;r=a}while(r);qh(t)}function md(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function fS(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var p0=Math.random().toString(36).slice(2),Wl="__reactFiber$"+p0,Xh="__reactProps$"+p0,wc="__reactContainer$"+p0,Db="__reactEvents$"+p0,Z7="__reactListeners$"+p0,eL="__reactHandles$"+p0;function Jd(e){var t=e[Wl];if(t)return t;for(var r=e.parentNode;r;){if(t=r[wc]||r[Wl]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=fS(e);e!==null;){if(r=e[Wl])return r;e=fS(e)}return t}e=r,r=e.parentNode}return null}function Tp(e){return e=e[Wl]||e[wc],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function _f(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Dr(33))}function $1(e){return e[Xh]||null}var Ub=[],kf=-1;function Ld(e){return{current:e}}function Ns(e){0>kf||(e.current=Ub[kf],Ub[kf]=null,kf--)}function vs(e,t){kf++,Ub[kf]=e.current,e.current=t}var Sd={},bi=Ld(Sd),qi=Ld(!1),hu=Sd;function t0(e,t){var r=e.type.contextTypes;if(!r)return Sd;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Hi(e){return e=e.childContextTypes,e!=null}function Gx(){Ns(qi),Ns(bi)}function hS(e,t,r){if(bi.current!==Sd)throw Error(Dr(168));vs(bi,t),vs(qi,r)}function $3(e,t,r){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return r;s=s.getChildContext();for(var a in s)if(!(a in t))throw Error(Dr(108,IT(e)||"Unknown",a));return Us({},r,s)}function Qx(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Sd,hu=bi.current,vs(bi,e),vs(qi,qi.current),!0}function pS(e,t,r){var s=e.stateNode;if(!s)throw Error(Dr(169));r?(e=$3(e,t,hu),s.__reactInternalMemoizedMergedChildContext=e,Ns(qi),Ns(bi),vs(bi,e)):Ns(qi),vs(qi,r)}var uc=null,W1=!1,ry=!1;function W3(e){uc===null?uc=[e]:uc.push(e)}function tL(e){W1=!0,W3(e)}function Fd(){if(!ry&&uc!==null){ry=!0;var e=0,t=fs;try{var r=uc;for(fs=1;e<r.length;e++){var s=r[e];do s=s(!0);while(s!==null)}uc=null,W1=!1}catch(a){throw uc!==null&&(uc=uc.slice(e+1)),h3(av,Fd),a}finally{fs=t,ry=!1}}return null}var jf=[],Nf=0,Xx=null,Yx=0,$o=[],Wo=0,pu=null,hc=1,pc="";function Gd(e,t){jf[Nf++]=Yx,jf[Nf++]=Xx,Xx=e,Yx=t}function z3(e,t,r){$o[Wo++]=hc,$o[Wo++]=pc,$o[Wo++]=pu,pu=e;var s=hc;e=pc;var a=32-hl(s)-1;s&=~(1<<a),r+=1;var i=32-hl(t)+a;if(30<i){var o=a-a%5;i=(s&(1<<o)-1).toString(32),s>>=o,a-=o,hc=1<<32-hl(t)+a|r<<a|s,pc=i+e}else hc=1<<i|r<<a|s,pc=e}function pv(e){e.return!==null&&(Gd(e,1),z3(e,1,0))}function mv(e){for(;e===Xx;)Xx=jf[--Nf],jf[Nf]=null,Yx=jf[--Nf],jf[Nf]=null;for(;e===pu;)pu=$o[--Wo],$o[Wo]=null,pc=$o[--Wo],$o[Wo]=null,hc=$o[--Wo],$o[Wo]=null}var So=null,bo=null,Ls=!1,dl=null;function q3(e,t){var r=zo(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function mS(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,So=e,bo=md(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,So=e,bo=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=pu!==null?{id:hc,overflow:pc}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=zo(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,So=e,bo=null,!0):!1;default:return!1}}function $b(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Wb(e){if(Ls){var t=bo;if(t){var r=t;if(!mS(e,t)){if($b(e))throw Error(Dr(418));t=md(r.nextSibling);var s=So;t&&mS(e,t)?q3(s,r):(e.flags=e.flags&-4097|2,Ls=!1,So=e)}}else{if($b(e))throw Error(Dr(418));e.flags=e.flags&-4097|2,Ls=!1,So=e}}}function xS(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;So=e}function jm(e){if(e!==So)return!1;if(!Ls)return xS(e),Ls=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ob(e.type,e.memoizedProps)),t&&(t=bo)){if($b(e))throw H3(),Error(Dr(418));for(;t;)q3(e,t),t=md(t.nextSibling)}if(xS(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Dr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){bo=md(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}bo=null}}else bo=So?md(e.stateNode.nextSibling):null;return!0}function H3(){for(var e=bo;e;)e=md(e.nextSibling)}function r0(){bo=So=null,Ls=!1}function xv(e){dl===null?dl=[e]:dl.push(e)}var rL=Ac.ReactCurrentBatchConfig;function J0(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Dr(309));var s=r.stateNode}if(!s)throw Error(Dr(147,e));var a=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var l=a.refs;o===null?delete l[i]:l[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(Dr(284));if(!r._owner)throw Error(Dr(290,e))}return e}function Nm(e,t){throw e=Object.prototype.toString.call(t),Error(Dr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function gS(e){var t=e._init;return t(e._payload)}function V3(e){function t(m,w){if(e){var S=m.deletions;S===null?(m.deletions=[w],m.flags|=16):S.push(w)}}function r(m,w){if(!e)return null;for(;w!==null;)t(m,w),w=w.sibling;return null}function s(m,w){for(m=new Map;w!==null;)w.key!==null?m.set(w.key,w):m.set(w.index,w),w=w.sibling;return m}function a(m,w){return m=bd(m,w),m.index=0,m.sibling=null,m}function i(m,w,S){return m.index=S,e?(S=m.alternate,S!==null?(S=S.index,S<w?(m.flags|=2,w):S):(m.flags|=2,w)):(m.flags|=1048576,w)}function o(m){return e&&m.alternate===null&&(m.flags|=2),m}function l(m,w,S,k){return w===null||w.tag!==6?(w=cy(S,m.mode,k),w.return=m,w):(w=a(w,S),w.return=m,w)}function c(m,w,S,k){var F=S.type;return F===bf?u(m,w,S.props.children,k,S.key):w!==null&&(w.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===ed&&gS(F)===w.type)?(k=a(w,S.props),k.ref=J0(m,w,S),k.return=m,k):(k=_x(S.type,S.key,S.props,null,m.mode,k),k.ref=J0(m,w,S),k.return=m,k)}function d(m,w,S,k){return w===null||w.tag!==4||w.stateNode.containerInfo!==S.containerInfo||w.stateNode.implementation!==S.implementation?(w=dy(S,m.mode,k),w.return=m,w):(w=a(w,S.children||[]),w.return=m,w)}function u(m,w,S,k,F){return w===null||w.tag!==7?(w=au(S,m.mode,k,F),w.return=m,w):(w=a(w,S),w.return=m,w)}function h(m,w,S){if(typeof w=="string"&&w!==""||typeof w=="number")return w=cy(""+w,m.mode,S),w.return=m,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case mm:return S=_x(w.type,w.key,w.props,null,m.mode,S),S.ref=J0(m,null,w),S.return=m,S;case yf:return w=dy(w,m.mode,S),w.return=m,w;case ed:var k=w._init;return h(m,k(w._payload),S)}if(ph(w)||G0(w))return w=au(w,m.mode,S,null),w.return=m,w;Nm(m,w)}return null}function p(m,w,S,k){var F=w!==null?w.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return F!==null?null:l(m,w,""+S,k);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case mm:return S.key===F?c(m,w,S,k):null;case yf:return S.key===F?d(m,w,S,k):null;case ed:return F=S._init,p(m,w,F(S._payload),k)}if(ph(S)||G0(S))return F!==null?null:u(m,w,S,k,null);Nm(m,S)}return null}function f(m,w,S,k,F){if(typeof k=="string"&&k!==""||typeof k=="number")return m=m.get(S)||null,l(w,m,""+k,F);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case mm:return m=m.get(k.key===null?S:k.key)||null,c(w,m,k,F);case yf:return m=m.get(k.key===null?S:k.key)||null,d(w,m,k,F);case ed:var L=k._init;return f(m,w,S,L(k._payload),F)}if(ph(k)||G0(k))return m=m.get(S)||null,u(w,m,k,F,null);Nm(w,k)}return null}function x(m,w,S,k){for(var F=null,L=null,C=w,O=w=0,T=null;C!==null&&O<S.length;O++){C.index>O?(T=C,C=null):T=C.sibling;var W=p(m,C,S[O],k);if(W===null){C===null&&(C=T);break}e&&C&&W.alternate===null&&t(m,C),w=i(W,w,O),L===null?F=W:L.sibling=W,L=W,C=T}if(O===S.length)return r(m,C),Ls&&Gd(m,O),F;if(C===null){for(;O<S.length;O++)C=h(m,S[O],k),C!==null&&(w=i(C,w,O),L===null?F=C:L.sibling=C,L=C);return Ls&&Gd(m,O),F}for(C=s(m,C);O<S.length;O++)T=f(C,m,O,S[O],k),T!==null&&(e&&T.alternate!==null&&C.delete(T.key===null?O:T.key),w=i(T,w,O),L===null?F=T:L.sibling=T,L=T);return e&&C.forEach(function(A){return t(m,A)}),Ls&&Gd(m,O),F}function g(m,w,S,k){var F=G0(S);if(typeof F!="function")throw Error(Dr(150));if(S=F.call(S),S==null)throw Error(Dr(151));for(var L=F=null,C=w,O=w=0,T=null,W=S.next();C!==null&&!W.done;O++,W=S.next()){C.index>O?(T=C,C=null):T=C.sibling;var A=p(m,C,W.value,k);if(A===null){C===null&&(C=T);break}e&&C&&A.alternate===null&&t(m,C),w=i(A,w,O),L===null?F=A:L.sibling=A,L=A,C=T}if(W.done)return r(m,C),Ls&&Gd(m,O),F;if(C===null){for(;!W.done;O++,W=S.next())W=h(m,W.value,k),W!==null&&(w=i(W,w,O),L===null?F=W:L.sibling=W,L=W);return Ls&&Gd(m,O),F}for(C=s(m,C);!W.done;O++,W=S.next())W=f(C,m,O,W.value,k),W!==null&&(e&&W.alternate!==null&&C.delete(W.key===null?O:W.key),w=i(W,w,O),L===null?F=W:L.sibling=W,L=W);return e&&C.forEach(function(N){return t(m,N)}),Ls&&Gd(m,O),F}function y(m,w,S,k){if(typeof S=="object"&&S!==null&&S.type===bf&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case mm:e:{for(var F=S.key,L=w;L!==null;){if(L.key===F){if(F=S.type,F===bf){if(L.tag===7){r(m,L.sibling),w=a(L,S.props.children),w.return=m,m=w;break e}}else if(L.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===ed&&gS(F)===L.type){r(m,L.sibling),w=a(L,S.props),w.ref=J0(m,L,S),w.return=m,m=w;break e}r(m,L);break}else t(m,L);L=L.sibling}S.type===bf?(w=au(S.props.children,m.mode,k,S.key),w.return=m,m=w):(k=_x(S.type,S.key,S.props,null,m.mode,k),k.ref=J0(m,w,S),k.return=m,m=k)}return o(m);case yf:e:{for(L=S.key;w!==null;){if(w.key===L)if(w.tag===4&&w.stateNode.containerInfo===S.containerInfo&&w.stateNode.implementation===S.implementation){r(m,w.sibling),w=a(w,S.children||[]),w.return=m,m=w;break e}else{r(m,w);break}else t(m,w);w=w.sibling}w=dy(S,m.mode,k),w.return=m,m=w}return o(m);case ed:return L=S._init,y(m,w,L(S._payload),k)}if(ph(S))return x(m,w,S,k);if(G0(S))return g(m,w,S,k);Nm(m,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,w!==null&&w.tag===6?(r(m,w.sibling),w=a(w,S),w.return=m,m=w):(r(m,w),w=cy(S,m.mode,k),w.return=m,m=w),o(m)):r(m,w)}return y}var n0=V3(!0),G3=V3(!1),Kx=Ld(null),Jx=null,Af=null,gv=null;function yv(){gv=Af=Jx=null}function bv(e){var t=Kx.current;Ns(Kx),e._currentValue=t}function zb(e,t,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function Uf(e,t){Jx=e,gv=Af=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&($i=!0),e.firstContext=null)}function Vo(e){var t=e._currentValue;if(gv!==e)if(e={context:e,memoizedValue:t,next:null},Af===null){if(Jx===null)throw Error(Dr(308));Af=e,Jx.dependencies={lanes:0,firstContext:e}}else Af=Af.next=e;return t}var Zd=null;function vv(e){Zd===null?Zd=[e]:Zd.push(e)}function Q3(e,t,r,s){var a=t.interleaved;return a===null?(r.next=r,vv(t)):(r.next=a.next,a.next=r),t.interleaved=r,Sc(e,s)}function Sc(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var td=!1;function wv(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function X3(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function xc(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function xd(e,t,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,Yn&2){var a=s.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),s.pending=t,Sc(e,r)}return a=s.interleaved,a===null?(t.next=t,vv(s)):(t.next=a.next,a.next=t),s.interleaved=t,Sc(e,r)}function gx(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,iv(e,r)}}function yS(e,t){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:s.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Zx(e,t,r,s){var a=e.updateQueue;td=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=a.baseState;o=0,u=d=c=null,l=i;do{var p=l.lane,f=l.eventTime;if((s&p)===p){u!==null&&(u=u.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var x=e,g=l;switch(p=t,f=r,g.tag){case 1:if(x=g.payload,typeof x=="function"){h=x.call(f,h,p);break e}h=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,p=typeof x=="function"?x.call(f,h,p):x,p==null)break e;h=Us({},h,p);break e;case 2:td=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,p=a.effects,p===null?a.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=f,c=h):u=u.next=f,o|=p;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;p=l,l=p.next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}while(!0);if(u===null&&(c=h),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=u,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);xu|=o,e.lanes=o,e.memoizedState=h}}function bS(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],a=s.callback;if(a!==null){if(s.callback=null,s=r,typeof a!="function")throw Error(Dr(191,a));a.call(s)}}}var Lp={},Vl=Ld(Lp),Yh=Ld(Lp),Kh=Ld(Lp);function eu(e){if(e===Lp)throw Error(Dr(174));return e}function Sv(e,t){switch(vs(Kh,t),vs(Yh,e),vs(Vl,Lp),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_b(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_b(t,e)}Ns(Vl),vs(Vl,t)}function s0(){Ns(Vl),Ns(Yh),Ns(Kh)}function Y3(e){eu(Kh.current);var t=eu(Vl.current),r=_b(t,e.type);t!==r&&(vs(Yh,e),vs(Vl,r))}function _v(e){Yh.current===e&&(Ns(Vl),Ns(Yh))}var Ps=Ld(0);function e1(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ny=[];function kv(){for(var e=0;e<ny.length;e++)ny[e]._workInProgressVersionPrimary=null;ny.length=0}var yx=Ac.ReactCurrentDispatcher,sy=Ac.ReactCurrentBatchConfig,mu=0,Ds=null,Ca=null,Pa=null,t1=!1,jh=!1,Jh=0,nL=0;function ni(){throw Error(Dr(321))}function jv(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!yl(e[r],t[r]))return!1;return!0}function Nv(e,t,r,s,a,i){if(mu=i,Ds=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,yx.current=e===null||e.memoizedState===null?oL:lL,e=r(s,a),jh){i=0;do{if(jh=!1,Jh=0,25<=i)throw Error(Dr(301));i+=1,Pa=Ca=null,t.updateQueue=null,yx.current=cL,e=r(s,a)}while(jh)}if(yx.current=r1,t=Ca!==null&&Ca.next!==null,mu=0,Pa=Ca=Ds=null,t1=!1,t)throw Error(Dr(300));return e}function Av(){var e=Jh!==0;return Jh=0,e}function Dl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pa===null?Ds.memoizedState=Pa=e:Pa=Pa.next=e,Pa}function Go(){if(Ca===null){var e=Ds.alternate;e=e!==null?e.memoizedState:null}else e=Ca.next;var t=Pa===null?Ds.memoizedState:Pa.next;if(t!==null)Pa=t,Ca=e;else{if(e===null)throw Error(Dr(310));Ca=e,e={memoizedState:Ca.memoizedState,baseState:Ca.baseState,baseQueue:Ca.baseQueue,queue:Ca.queue,next:null},Pa===null?Ds.memoizedState=Pa=e:Pa=Pa.next=e}return Pa}function Zh(e,t){return typeof t=="function"?t(e):t}function ay(e){var t=Go(),r=t.queue;if(r===null)throw Error(Dr(311));r.lastRenderedReducer=e;var s=Ca,a=s.baseQueue,i=r.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}s.baseQueue=a=i,r.pending=null}if(a!==null){i=a.next,s=s.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((mu&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),s=d.hasEagerState?d.eagerState:e(s,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=s):c=c.next=h,Ds.lanes|=u,xu|=u}d=d.next}while(d!==null&&d!==i);c===null?o=s:c.next=l,yl(s,t.memoizedState)||($i=!0),t.memoizedState=s,t.baseState=o,t.baseQueue=c,r.lastRenderedState=s}if(e=r.interleaved,e!==null){a=e;do i=a.lane,Ds.lanes|=i,xu|=i,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function iy(e){var t=Go(),r=t.queue;if(r===null)throw Error(Dr(311));r.lastRenderedReducer=e;var s=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);yl(i,t.memoizedState)||($i=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,s]}function K3(){}function J3(e,t){var r=Ds,s=Go(),a=t(),i=!yl(s.memoizedState,a);if(i&&(s.memoizedState=a,$i=!0),s=s.queue,Cv(tN.bind(null,r,s,e),[e]),s.getSnapshot!==t||i||Pa!==null&&Pa.memoizedState.tag&1){if(r.flags|=2048,ep(9,eN.bind(null,r,s,a,t),void 0,null),Ua===null)throw Error(Dr(349));mu&30||Z3(r,t,a)}return a}function Z3(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ds.updateQueue,t===null?(t={lastEffect:null,stores:null},Ds.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function eN(e,t,r,s){t.value=r,t.getSnapshot=s,rN(t)&&nN(e)}function tN(e,t,r){return r(function(){rN(t)&&nN(e)})}function rN(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!yl(e,r)}catch{return!0}}function nN(e){var t=Sc(e,1);t!==null&&pl(t,e,1,-1)}function vS(e){var t=Dl();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zh,lastRenderedState:e},t.queue=e,e=e.dispatch=iL.bind(null,Ds,e),[t.memoizedState,e]}function ep(e,t,r,s){return e={tag:e,create:t,destroy:r,deps:s,next:null},t=Ds.updateQueue,t===null?(t={lastEffect:null,stores:null},Ds.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e)),e}function sN(){return Go().memoizedState}function bx(e,t,r,s){var a=Dl();Ds.flags|=e,a.memoizedState=ep(1|t,r,void 0,s===void 0?null:s)}function z1(e,t,r,s){var a=Go();s=s===void 0?null:s;var i=void 0;if(Ca!==null){var o=Ca.memoizedState;if(i=o.destroy,s!==null&&jv(s,o.deps)){a.memoizedState=ep(t,r,i,s);return}}Ds.flags|=e,a.memoizedState=ep(1|t,r,i,s)}function wS(e,t){return bx(8390656,8,e,t)}function Cv(e,t){return z1(2048,8,e,t)}function aN(e,t){return z1(4,2,e,t)}function iN(e,t){return z1(4,4,e,t)}function oN(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function lN(e,t,r){return r=r!=null?r.concat([e]):null,z1(4,4,oN.bind(null,t,e),r)}function Ev(){}function cN(e,t){var r=Go();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&jv(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function dN(e,t){var r=Go();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&jv(t,s[1])?s[0]:(e=e(),r.memoizedState=[e,t],e)}function uN(e,t,r){return mu&21?(yl(r,t)||(r=x3(),Ds.lanes|=r,xu|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,$i=!0),e.memoizedState=r)}function sL(e,t){var r=fs;fs=r!==0&&4>r?r:4,e(!0);var s=sy.transition;sy.transition={};try{e(!1),t()}finally{fs=r,sy.transition=s}}function fN(){return Go().memoizedState}function aL(e,t,r){var s=yd(e);if(r={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null},hN(e))pN(t,r);else if(r=Q3(e,t,r,s),r!==null){var a=Ti();pl(r,e,s,a),mN(r,t,s)}}function iL(e,t,r){var s=yd(e),a={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null};if(hN(e))pN(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,l=i(o,r);if(a.hasEagerState=!0,a.eagerState=l,yl(l,o)){var c=t.interleaved;c===null?(a.next=a,vv(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}r=Q3(e,t,a,s),r!==null&&(a=Ti(),pl(r,e,s,a),mN(r,t,s))}}function hN(e){var t=e.alternate;return e===Ds||t!==null&&t===Ds}function pN(e,t){jh=t1=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function mN(e,t,r){if(r&4194240){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,iv(e,r)}}var r1={readContext:Vo,useCallback:ni,useContext:ni,useEffect:ni,useImperativeHandle:ni,useInsertionEffect:ni,useLayoutEffect:ni,useMemo:ni,useReducer:ni,useRef:ni,useState:ni,useDebugValue:ni,useDeferredValue:ni,useTransition:ni,useMutableSource:ni,useSyncExternalStore:ni,useId:ni,unstable_isNewReconciler:!1},oL={readContext:Vo,useCallback:function(e,t){return Dl().memoizedState=[e,t===void 0?null:t],e},useContext:Vo,useEffect:wS,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,bx(4194308,4,oN.bind(null,t,e),r)},useLayoutEffect:function(e,t){return bx(4194308,4,e,t)},useInsertionEffect:function(e,t){return bx(4,2,e,t)},useMemo:function(e,t){var r=Dl();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var s=Dl();return t=r!==void 0?r(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=aL.bind(null,Ds,e),[s.memoizedState,e]},useRef:function(e){var t=Dl();return e={current:e},t.memoizedState=e},useState:vS,useDebugValue:Ev,useDeferredValue:function(e){return Dl().memoizedState=e},useTransition:function(){var e=vS(!1),t=e[0];return e=sL.bind(null,e[1]),Dl().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var s=Ds,a=Dl();if(Ls){if(r===void 0)throw Error(Dr(407));r=r()}else{if(r=t(),Ua===null)throw Error(Dr(349));mu&30||Z3(s,t,r)}a.memoizedState=r;var i={value:r,getSnapshot:t};return a.queue=i,wS(tN.bind(null,s,i,e),[e]),s.flags|=2048,ep(9,eN.bind(null,s,i,r,t),void 0,null),r},useId:function(){var e=Dl(),t=Ua.identifierPrefix;if(Ls){var r=pc,s=hc;r=(s&~(1<<32-hl(s)-1)).toString(32)+r,t=":"+t+"R"+r,r=Jh++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=nL++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},lL={readContext:Vo,useCallback:cN,useContext:Vo,useEffect:Cv,useImperativeHandle:lN,useInsertionEffect:aN,useLayoutEffect:iN,useMemo:dN,useReducer:ay,useRef:sN,useState:function(){return ay(Zh)},useDebugValue:Ev,useDeferredValue:function(e){var t=Go();return uN(t,Ca.memoizedState,e)},useTransition:function(){var e=ay(Zh)[0],t=Go().memoizedState;return[e,t]},useMutableSource:K3,useSyncExternalStore:J3,useId:fN,unstable_isNewReconciler:!1},cL={readContext:Vo,useCallback:cN,useContext:Vo,useEffect:Cv,useImperativeHandle:lN,useInsertionEffect:aN,useLayoutEffect:iN,useMemo:dN,useReducer:iy,useRef:sN,useState:function(){return iy(Zh)},useDebugValue:Ev,useDeferredValue:function(e){var t=Go();return Ca===null?t.memoizedState=e:uN(t,Ca.memoizedState,e)},useTransition:function(){var e=iy(Zh)[0],t=Go().memoizedState;return[e,t]},useMutableSource:K3,useSyncExternalStore:J3,useId:fN,unstable_isNewReconciler:!1};function ll(e,t){if(e&&e.defaultProps){t=Us({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function qb(e,t,r,s){t=e.memoizedState,r=r(s,t),r=r==null?t:Us({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var q1={isMounted:function(e){return(e=e._reactInternals)?Tu(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var s=Ti(),a=yd(e),i=xc(s,a);i.payload=t,r!=null&&(i.callback=r),t=xd(e,i,a),t!==null&&(pl(t,e,a,s),gx(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=Ti(),a=yd(e),i=xc(s,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=xd(e,i,a),t!==null&&(pl(t,e,a,s),gx(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Ti(),s=yd(e),a=xc(r,s);a.tag=2,t!=null&&(a.callback=t),t=xd(e,a,s),t!==null&&(pl(t,e,s,r),gx(t,e,s))}};function SS(e,t,r,s,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,o):t.prototype&&t.prototype.isPureReactComponent?!Vh(r,s)||!Vh(a,i):!0}function xN(e,t,r){var s=!1,a=Sd,i=t.contextType;return typeof i=="object"&&i!==null?i=Vo(i):(a=Hi(t)?hu:bi.current,s=t.contextTypes,i=(s=s!=null)?t0(e,a):Sd),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=q1,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function _S(e,t,r,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&q1.enqueueReplaceState(t,t.state,null)}function Hb(e,t,r,s){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs={},wv(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=Vo(i):(i=Hi(t)?hu:bi.current,a.context=t0(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(qb(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&q1.enqueueReplaceState(a,a.state,null),Zx(e,r,a,s),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function a0(e,t){try{var r="",s=t;do r+=OT(s),s=s.return;while(s);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function oy(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Vb(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var dL=typeof WeakMap=="function"?WeakMap:Map;function gN(e,t,r){r=xc(-1,r),r.tag=3,r.payload={element:null};var s=t.value;return r.callback=function(){s1||(s1=!0,r2=s),Vb(e,t)},r}function yN(e,t,r){r=xc(-1,r),r.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var a=t.value;r.payload=function(){return s(a)},r.callback=function(){Vb(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){Vb(e,t),typeof s!="function"&&(gd===null?gd=new Set([this]):gd.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function kS(e,t,r){var s=e.pingCache;if(s===null){s=e.pingCache=new dL;var a=new Set;s.set(t,a)}else a=s.get(t),a===void 0&&(a=new Set,s.set(t,a));a.has(r)||(a.add(r),e=kL.bind(null,e,t,r),t.then(e,e))}function jS(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function NS(e,t,r,s,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=xc(-1,1),t.tag=2,xd(r,t,1))),r.lanes|=1),e)}var uL=Ac.ReactCurrentOwner,$i=!1;function Ai(e,t,r,s){t.child=e===null?G3(t,null,r,s):n0(t,e.child,r,s)}function AS(e,t,r,s,a){r=r.render;var i=t.ref;return Uf(t,a),s=Nv(e,t,r,s,i,a),r=Av(),e!==null&&!$i?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,_c(e,t,a)):(Ls&&r&&pv(t),t.flags|=1,Ai(e,t,s,a),t.child)}function CS(e,t,r,s,a){if(e===null){var i=r.type;return typeof i=="function"&&!Ov(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,bN(e,t,i,s,a)):(e=_x(r.type,null,s,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var o=i.memoizedProps;if(r=r.compare,r=r!==null?r:Vh,r(o,s)&&e.ref===t.ref)return _c(e,t,a)}return t.flags|=1,e=bd(i,s),e.ref=t.ref,e.return=t,t.child=e}function bN(e,t,r,s,a){if(e!==null){var i=e.memoizedProps;if(Vh(i,s)&&e.ref===t.ref)if($i=!1,t.pendingProps=s=i,(e.lanes&a)!==0)e.flags&131072&&($i=!0);else return t.lanes=e.lanes,_c(e,t,a)}return Gb(e,t,r,s,a)}function vN(e,t,r){var s=t.pendingProps,a=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},vs(Ef,po),po|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,vs(Ef,po),po|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:r,vs(Ef,po),po|=s}else i!==null?(s=i.baseLanes|r,t.memoizedState=null):s=r,vs(Ef,po),po|=s;return Ai(e,t,a,r),t.child}function wN(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Gb(e,t,r,s,a){var i=Hi(r)?hu:bi.current;return i=t0(t,i),Uf(t,a),r=Nv(e,t,r,s,i,a),s=Av(),e!==null&&!$i?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,_c(e,t,a)):(Ls&&s&&pv(t),t.flags|=1,Ai(e,t,r,a),t.child)}function ES(e,t,r,s,a){if(Hi(r)){var i=!0;Qx(t)}else i=!1;if(Uf(t,a),t.stateNode===null)vx(e,t),xN(t,r,s),Hb(t,r,s,a),s=!0;else if(e===null){var o=t.stateNode,l=t.memoizedProps;o.props=l;var c=o.context,d=r.contextType;typeof d=="object"&&d!==null?d=Vo(d):(d=Hi(r)?hu:bi.current,d=t0(t,d));var u=r.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==s||c!==d)&&_S(t,o,s,d),td=!1;var p=t.memoizedState;o.state=p,Zx(t,s,o,a),c=t.memoizedState,l!==s||p!==c||qi.current||td?(typeof u=="function"&&(qb(t,r,u,s),c=t.memoizedState),(l=td||SS(t,r,l,s,p,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),o.props=s,o.state=c,o.context=d,s=l):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{o=t.stateNode,X3(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:ll(t.type,l),o.props=d,h=t.pendingProps,p=o.context,c=r.contextType,typeof c=="object"&&c!==null?c=Vo(c):(c=Hi(r)?hu:bi.current,c=t0(t,c));var f=r.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||p!==c)&&_S(t,o,s,c),td=!1,p=t.memoizedState,o.state=p,Zx(t,s,o,a);var x=t.memoizedState;l!==h||p!==x||qi.current||td?(typeof f=="function"&&(qb(t,r,f,s),x=t.memoizedState),(d=td||SS(t,r,d,s,p,x,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,x,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,x,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=x),o.props=s,o.state=x,o.context=c,s=d):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),s=!1)}return Qb(e,t,r,s,i,a)}function Qb(e,t,r,s,a,i){wN(e,t);var o=(t.flags&128)!==0;if(!s&&!o)return a&&pS(t,r,!1),_c(e,t,i);s=t.stateNode,uL.current=t;var l=o&&typeof r.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&o?(t.child=n0(t,e.child,null,i),t.child=n0(t,null,l,i)):Ai(e,t,l,i),t.memoizedState=s.state,a&&pS(t,r,!0),t.child}function SN(e){var t=e.stateNode;t.pendingContext?hS(e,t.pendingContext,t.pendingContext!==t.context):t.context&&hS(e,t.context,!1),Sv(e,t.containerInfo)}function TS(e,t,r,s,a){return r0(),xv(a),t.flags|=256,Ai(e,t,r,s),t.child}var Xb={dehydrated:null,treeContext:null,retryLane:0};function Yb(e){return{baseLanes:e,cachePool:null,transitions:null}}function _N(e,t,r){var s=t.pendingProps,a=Ps.current,i=!1,o=(t.flags&128)!==0,l;if((l=o)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),vs(Ps,a&1),e===null)return Wb(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=s.children,e=s.fallback,i?(s=t.mode,i=t.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=G1(o,s,0,null),e=au(e,s,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Yb(r),t.memoizedState=Xb,e):Tv(t,o));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return fL(e,t,o,s,l,a,r);if(i){i=s.fallback,o=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&t.child!==a?(s=t.child,s.childLanes=0,s.pendingProps=c,t.deletions=null):(s=bd(a,c),s.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=bd(l,i):(i=au(i,o,r,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,o=e.child.memoizedState,o=o===null?Yb(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~r,t.memoizedState=Xb,s}return i=e.child,e=i.sibling,s=bd(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=r),s.return=t,s.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=s,t.memoizedState=null,s}function Tv(e,t){return t=G1({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Am(e,t,r,s){return s!==null&&xv(s),n0(t,e.child,null,r),e=Tv(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function fL(e,t,r,s,a,i,o){if(r)return t.flags&256?(t.flags&=-257,s=oy(Error(Dr(422))),Am(e,t,o,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,a=t.mode,s=G1({mode:"visible",children:s.children},a,0,null),i=au(i,a,o,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&n0(t,e.child,null,o),t.child.memoizedState=Yb(o),t.memoizedState=Xb,i);if(!(t.mode&1))return Am(e,t,o,null);if(a.data==="$!"){if(s=a.nextSibling&&a.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(Dr(419)),s=oy(i,s,void 0),Am(e,t,o,s)}if(l=(o&e.childLanes)!==0,$i||l){if(s=Ua,s!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(s.suspendedLanes|o)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Sc(e,a),pl(s,e,a,-1))}return Pv(),s=oy(Error(Dr(421))),Am(e,t,o,s)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=jL.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,bo=md(a.nextSibling),So=t,Ls=!0,dl=null,e!==null&&($o[Wo++]=hc,$o[Wo++]=pc,$o[Wo++]=pu,hc=e.id,pc=e.overflow,pu=t),t=Tv(t,s.children),t.flags|=4096,t)}function LS(e,t,r){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),zb(e.return,t,r)}function ly(e,t,r,s,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=r,i.tailMode=a)}function kN(e,t,r){var s=t.pendingProps,a=s.revealOrder,i=s.tail;if(Ai(e,t,s.children,r),s=Ps.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&LS(e,r,t);else if(e.tag===19)LS(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(vs(Ps,s),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&e1(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),ly(t,!1,a,r,i);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&e1(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}ly(t,!0,r,null,i);break;case"together":ly(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function vx(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function _c(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),xu|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Dr(153));if(t.child!==null){for(e=t.child,r=bd(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=bd(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function hL(e,t,r){switch(t.tag){case 3:SN(t),r0();break;case 5:Y3(t);break;case 1:Hi(t.type)&&Qx(t);break;case 4:Sv(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,a=t.memoizedProps.value;vs(Kx,s._currentValue),s._currentValue=a;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(vs(Ps,Ps.current&1),t.flags|=128,null):r&t.child.childLanes?_N(e,t,r):(vs(Ps,Ps.current&1),e=_c(e,t,r),e!==null?e.sibling:null);vs(Ps,Ps.current&1);break;case 19:if(s=(r&t.childLanes)!==0,e.flags&128){if(s)return kN(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),vs(Ps,Ps.current),s)break;return null;case 22:case 23:return t.lanes=0,vN(e,t,r)}return _c(e,t,r)}var jN,Kb,NN,AN;jN=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Kb=function(){};NN=function(e,t,r,s){var a=e.memoizedProps;if(a!==s){e=t.stateNode,eu(Vl.current);var i=null;switch(r){case"input":a=bb(e,a),s=bb(e,s),i=[];break;case"select":a=Us({},a,{value:void 0}),s=Us({},s,{value:void 0}),i=[];break;case"textarea":a=Sb(e,a),s=Sb(e,s),i=[];break;default:typeof a.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=Vx)}kb(r,s);var o;r=null;for(d in a)if(!s.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(o in l)l.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Dh.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in s){var c=s[d];if(l=a!=null?a[d]:void 0,s.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(r||(r={}),r[o]=c[o])}else r||(i||(i=[]),i.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Dh.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&_s("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}r&&(i=i||[]).push("style",r);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};AN=function(e,t,r,s){r!==s&&(t.flags|=4)};function Z0(e,t){if(!Ls)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function si(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,s|=a.subtreeFlags&14680064,s|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,s|=a.subtreeFlags,s|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function pL(e,t,r){var s=t.pendingProps;switch(mv(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return si(t),null;case 1:return Hi(t.type)&&Gx(),si(t),null;case 3:return s=t.stateNode,s0(),Ns(qi),Ns(bi),kv(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(jm(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,dl!==null&&(a2(dl),dl=null))),Kb(e,t),si(t),null;case 5:_v(t);var a=eu(Kh.current);if(r=t.type,e!==null&&t.stateNode!=null)NN(e,t,r,s,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(Dr(166));return si(t),null}if(e=eu(Vl.current),jm(t)){s=t.stateNode,r=t.type;var i=t.memoizedProps;switch(s[Wl]=t,s[Xh]=i,e=(t.mode&1)!==0,r){case"dialog":_s("cancel",s),_s("close",s);break;case"iframe":case"object":case"embed":_s("load",s);break;case"video":case"audio":for(a=0;a<xh.length;a++)_s(xh[a],s);break;case"source":_s("error",s);break;case"img":case"image":case"link":_s("error",s),_s("load",s);break;case"details":_s("toggle",s);break;case"input":U5(s,i),_s("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},_s("invalid",s);break;case"textarea":W5(s,i),_s("invalid",s)}kb(r,i),a=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&km(s.textContent,l,e),a=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&km(s.textContent,l,e),a=["children",""+l]):Dh.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&_s("scroll",s)}switch(r){case"input":xm(s),$5(s,i,!0);break;case"textarea":xm(s),z5(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Vx)}s=a,t.updateQueue=s,s!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=t3(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=o.createElement(r,{is:s.is}):(e=o.createElement(r),r==="select"&&(o=e,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):e=o.createElementNS(e,r),e[Wl]=t,e[Xh]=s,jN(e,t,!1,!1),t.stateNode=e;e:{switch(o=jb(r,s),r){case"dialog":_s("cancel",e),_s("close",e),a=s;break;case"iframe":case"object":case"embed":_s("load",e),a=s;break;case"video":case"audio":for(a=0;a<xh.length;a++)_s(xh[a],e);a=s;break;case"source":_s("error",e),a=s;break;case"img":case"image":case"link":_s("error",e),_s("load",e),a=s;break;case"details":_s("toggle",e),a=s;break;case"input":U5(e,s),a=bb(e,s),_s("invalid",e);break;case"option":a=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},a=Us({},s,{value:void 0}),_s("invalid",e);break;case"textarea":W5(e,s),a=Sb(e,s),_s("invalid",e);break;default:a=s}kb(r,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?s3(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&r3(e,c)):i==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&Uh(e,c):typeof c=="number"&&Uh(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Dh.hasOwnProperty(i)?c!=null&&i==="onScroll"&&_s("scroll",e):c!=null&&ev(e,i,c,o))}switch(r){case"input":xm(e),$5(e,s,!1);break;case"textarea":xm(e),z5(e);break;case"option":s.value!=null&&e.setAttribute("value",""+wd(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?Pf(e,!!s.multiple,i,!1):s.defaultValue!=null&&Pf(e,!!s.multiple,s.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Vx)}switch(r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return si(t),null;case 6:if(e&&t.stateNode!=null)AN(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(Dr(166));if(r=eu(Kh.current),eu(Vl.current),jm(t)){if(s=t.stateNode,r=t.memoizedProps,s[Wl]=t,(i=s.nodeValue!==r)&&(e=So,e!==null))switch(e.tag){case 3:km(s.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&km(s.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(r.nodeType===9?r:r.ownerDocument).createTextNode(s),s[Wl]=t,t.stateNode=s}return si(t),null;case 13:if(Ns(Ps),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ls&&bo!==null&&t.mode&1&&!(t.flags&128))H3(),r0(),t.flags|=98560,i=!1;else if(i=jm(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(Dr(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Dr(317));i[Wl]=t}else r0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;si(t),i=!1}else dl!==null&&(a2(dl),dl=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Ps.current&1?Ta===0&&(Ta=3):Pv())),t.updateQueue!==null&&(t.flags|=4),si(t),null);case 4:return s0(),Kb(e,t),e===null&&Gh(t.stateNode.containerInfo),si(t),null;case 10:return bv(t.type._context),si(t),null;case 17:return Hi(t.type)&&Gx(),si(t),null;case 19:if(Ns(Ps),i=t.memoizedState,i===null)return si(t),null;if(s=(t.flags&128)!==0,o=i.rendering,o===null)if(s)Z0(i,!1);else{if(Ta!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=e1(e),o!==null){for(t.flags|=128,Z0(i,!1),s=o.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=r,r=t.child;r!==null;)i=r,e=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return vs(Ps,Ps.current&1|2),t.child}e=e.sibling}i.tail!==null&&aa()>i0&&(t.flags|=128,s=!0,Z0(i,!1),t.lanes=4194304)}else{if(!s)if(e=e1(o),e!==null){if(t.flags|=128,s=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Z0(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ls)return si(t),null}else 2*aa()-i.renderingStartTime>i0&&r!==1073741824&&(t.flags|=128,s=!0,Z0(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(r=i.last,r!==null?r.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=aa(),t.sibling=null,r=Ps.current,vs(Ps,s?r&1|2:r&1),t):(si(t),null);case 22:case 23:return Bv(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?po&1073741824&&(si(t),t.subtreeFlags&6&&(t.flags|=8192)):si(t),null;case 24:return null;case 25:return null}throw Error(Dr(156,t.tag))}function mL(e,t){switch(mv(t),t.tag){case 1:return Hi(t.type)&&Gx(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return s0(),Ns(qi),Ns(bi),kv(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return _v(t),null;case 13:if(Ns(Ps),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Dr(340));r0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ns(Ps),null;case 4:return s0(),null;case 10:return bv(t.type._context),null;case 22:case 23:return Bv(),null;case 24:return null;default:return null}}var Cm=!1,fi=!1,xL=typeof WeakSet=="function"?WeakSet:Set,tn=null;function Cf(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(s){Vs(e,t,s)}else r.current=null}function Jb(e,t,r){try{r()}catch(s){Vs(e,t,s)}}var FS=!1;function gL(e,t){if(Bb=zx,e=F3(),hv(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var a=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var f;h!==r||a!==0&&h.nodeType!==3||(l=o+a),h!==i||s!==0&&h.nodeType!==3||(c=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)p=h,h=f;for(;;){if(h===e)break t;if(p===r&&++d===a&&(l=o),p===i&&++u===s&&(c=o),(f=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=f}r=l===-1||c===-1?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(Pb={focusedElem:e,selectionRange:r},zx=!1,tn=t;tn!==null;)if(t=tn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,tn=e;else for(;tn!==null;){t=tn;try{var x=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,y=x.memoizedState,m=t.stateNode,w=m.getSnapshotBeforeUpdate(t.elementType===t.type?g:ll(t.type,g),y);m.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var S=t.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Dr(163))}}catch(k){Vs(t,t.return,k)}if(e=t.sibling,e!==null){e.return=t.return,tn=e;break}tn=t.return}return x=FS,FS=!1,x}function Nh(e,t,r){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var a=s=s.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&Jb(t,r,i)}a=a.next}while(a!==s)}}function H1(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var s=r.create;r.destroy=s()}r=r.next}while(r!==t)}}function Zb(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function CN(e){var t=e.alternate;t!==null&&(e.alternate=null,CN(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Wl],delete t[Xh],delete t[Db],delete t[Z7],delete t[eL])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function EN(e){return e.tag===5||e.tag===3||e.tag===4}function MS(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||EN(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function e2(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Vx));else if(s!==4&&(e=e.child,e!==null))for(e2(e,t,r),e=e.sibling;e!==null;)e2(e,t,r),e=e.sibling}function t2(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(t2(e,t,r),e=e.sibling;e!==null;)t2(e,t,r),e=e.sibling}var Ka=null,cl=!1;function Vc(e,t,r){for(r=r.child;r!==null;)TN(e,t,r),r=r.sibling}function TN(e,t,r){if(Hl&&typeof Hl.onCommitFiberUnmount=="function")try{Hl.onCommitFiberUnmount(O1,r)}catch{}switch(r.tag){case 5:fi||Cf(r,t);case 6:var s=Ka,a=cl;Ka=null,Vc(e,t,r),Ka=s,cl=a,Ka!==null&&(cl?(e=Ka,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Ka.removeChild(r.stateNode));break;case 18:Ka!==null&&(cl?(e=Ka,r=r.stateNode,e.nodeType===8?ty(e.parentNode,r):e.nodeType===1&&ty(e,r),qh(e)):ty(Ka,r.stateNode));break;case 4:s=Ka,a=cl,Ka=r.stateNode.containerInfo,cl=!0,Vc(e,t,r),Ka=s,cl=a;break;case 0:case 11:case 14:case 15:if(!fi&&(s=r.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){a=s=s.next;do{var i=a,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Jb(r,t,o),a=a.next}while(a!==s)}Vc(e,t,r);break;case 1:if(!fi&&(Cf(r,t),s=r.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=r.memoizedProps,s.state=r.memoizedState,s.componentWillUnmount()}catch(l){Vs(r,t,l)}Vc(e,t,r);break;case 21:Vc(e,t,r);break;case 22:r.mode&1?(fi=(s=fi)||r.memoizedState!==null,Vc(e,t,r),fi=s):Vc(e,t,r);break;default:Vc(e,t,r)}}function RS(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new xL),t.forEach(function(s){var a=NL.bind(null,e,s);r.has(s)||(r.add(s),s.then(a,a))})}}function nl(e,t){var r=t.deletions;if(r!==null)for(var s=0;s<r.length;s++){var a=r[s];try{var i=e,o=t,l=o;e:for(;l!==null;){switch(l.tag){case 5:Ka=l.stateNode,cl=!1;break e;case 3:Ka=l.stateNode.containerInfo,cl=!0;break e;case 4:Ka=l.stateNode.containerInfo,cl=!0;break e}l=l.return}if(Ka===null)throw Error(Dr(160));TN(i,o,a),Ka=null,cl=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){Vs(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)LN(t,e),t=t.sibling}function LN(e,t){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nl(t,e),Tl(e),s&4){try{Nh(3,e,e.return),H1(3,e)}catch(g){Vs(e,e.return,g)}try{Nh(5,e,e.return)}catch(g){Vs(e,e.return,g)}}break;case 1:nl(t,e),Tl(e),s&512&&r!==null&&Cf(r,r.return);break;case 5:if(nl(t,e),Tl(e),s&512&&r!==null&&Cf(r,r.return),e.flags&32){var a=e.stateNode;try{Uh(a,"")}catch(g){Vs(e,e.return,g)}}if(s&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,o=r!==null?r.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Z4(a,i),jb(l,o);var d=jb(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?s3(a,h):u==="dangerouslySetInnerHTML"?r3(a,h):u==="children"?Uh(a,h):ev(a,u,h,d)}switch(l){case"input":vb(a,i);break;case"textarea":e3(a,i);break;case"select":var p=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Pf(a,!!i.multiple,f,!1):p!==!!i.multiple&&(i.defaultValue!=null?Pf(a,!!i.multiple,i.defaultValue,!0):Pf(a,!!i.multiple,i.multiple?[]:"",!1))}a[Xh]=i}catch(g){Vs(e,e.return,g)}}break;case 6:if(nl(t,e),Tl(e),s&4){if(e.stateNode===null)throw Error(Dr(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(g){Vs(e,e.return,g)}}break;case 3:if(nl(t,e),Tl(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{qh(t.containerInfo)}catch(g){Vs(e,e.return,g)}break;case 4:nl(t,e),Tl(e);break;case 13:nl(t,e),Tl(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(Mv=aa())),s&4&&RS(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(fi=(d=fi)||u,nl(t,e),fi=d):nl(t,e),Tl(e),s&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(tn=e,u=e.child;u!==null;){for(h=tn=u;tn!==null;){switch(p=tn,f=p.child,p.tag){case 0:case 11:case 14:case 15:Nh(4,p,p.return);break;case 1:Cf(p,p.return);var x=p.stateNode;if(typeof x.componentWillUnmount=="function"){s=p,r=p.return;try{t=s,x.props=t.memoizedProps,x.state=t.memoizedState,x.componentWillUnmount()}catch(g){Vs(s,r,g)}}break;case 5:Cf(p,p.return);break;case 22:if(p.memoizedState!==null){PS(h);continue}}f!==null?(f.return=p,tn=f):PS(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{a=h.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=n3("display",o))}catch(g){Vs(e,e.return,g)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Vs(e,e.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:nl(t,e),Tl(e),s&4&&RS(e);break;case 21:break;default:nl(t,e),Tl(e)}}function Tl(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(EN(r)){var s=r;break e}r=r.return}throw Error(Dr(160))}switch(s.tag){case 5:var a=s.stateNode;s.flags&32&&(Uh(a,""),s.flags&=-33);var i=MS(e);t2(e,i,a);break;case 3:case 4:var o=s.stateNode.containerInfo,l=MS(e);e2(e,l,o);break;default:throw Error(Dr(161))}}catch(c){Vs(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function yL(e,t,r){tn=e,FN(e)}function FN(e,t,r){for(var s=(e.mode&1)!==0;tn!==null;){var a=tn,i=a.child;if(a.tag===22&&s){var o=a.memoizedState!==null||Cm;if(!o){var l=a.alternate,c=l!==null&&l.memoizedState!==null||fi;l=Cm;var d=fi;if(Cm=o,(fi=c)&&!d)for(tn=a;tn!==null;)o=tn,c=o.child,o.tag===22&&o.memoizedState!==null?OS(a):c!==null?(c.return=o,tn=c):OS(a);for(;i!==null;)tn=i,FN(i),i=i.sibling;tn=a,Cm=l,fi=d}BS(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,tn=i):BS(e)}}function BS(e){for(;tn!==null;){var t=tn;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:fi||H1(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!fi)if(r===null)s.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:ll(t.type,r.memoizedProps);s.componentDidUpdate(a,r.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&bS(t,i,s);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}bS(t,o,r)}break;case 5:var l=t.stateNode;if(r===null&&t.flags&4){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&qh(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Dr(163))}fi||t.flags&512&&Zb(t)}catch(p){Vs(t,t.return,p)}}if(t===e){tn=null;break}if(r=t.sibling,r!==null){r.return=t.return,tn=r;break}tn=t.return}}function PS(e){for(;tn!==null;){var t=tn;if(t===e){tn=null;break}var r=t.sibling;if(r!==null){r.return=t.return,tn=r;break}tn=t.return}}function OS(e){for(;tn!==null;){var t=tn;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{H1(4,t)}catch(c){Vs(t,r,c)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var a=t.return;try{s.componentDidMount()}catch(c){Vs(t,a,c)}}var i=t.return;try{Zb(t)}catch(c){Vs(t,i,c)}break;case 5:var o=t.return;try{Zb(t)}catch(c){Vs(t,o,c)}}}catch(c){Vs(t,t.return,c)}if(t===e){tn=null;break}var l=t.sibling;if(l!==null){l.return=t.return,tn=l;break}tn=t.return}}var bL=Math.ceil,n1=Ac.ReactCurrentDispatcher,Lv=Ac.ReactCurrentOwner,qo=Ac.ReactCurrentBatchConfig,Yn=0,Ua=null,ba=null,ei=0,po=0,Ef=Ld(0),Ta=0,tp=null,xu=0,V1=0,Fv=0,Ah=null,Ui=null,Mv=0,i0=1/0,dc=null,s1=!1,r2=null,gd=null,Em=!1,od=null,a1=0,Ch=0,n2=null,wx=-1,Sx=0;function Ti(){return Yn&6?aa():wx!==-1?wx:wx=aa()}function yd(e){return e.mode&1?Yn&2&&ei!==0?ei&-ei:rL.transition!==null?(Sx===0&&(Sx=x3()),Sx):(e=fs,e!==0||(e=window.event,e=e===void 0?16:_3(e.type)),e):1}function pl(e,t,r,s){if(50<Ch)throw Ch=0,n2=null,Error(Dr(185));Cp(e,r,s),(!(Yn&2)||e!==Ua)&&(e===Ua&&(!(Yn&2)&&(V1|=r),Ta===4&&nd(e,ei)),Vi(e,s),r===1&&Yn===0&&!(t.mode&1)&&(i0=aa()+500,W1&&Fd()))}function Vi(e,t){var r=e.callbackNode;r7(e,t);var s=Wx(e,e===Ua?ei:0);if(s===0)r!==null&&V5(r),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(r!=null&&V5(r),t===1)e.tag===0?tL(IS.bind(null,e)):W3(IS.bind(null,e)),K7(function(){!(Yn&6)&&Fd()}),r=null;else{switch(g3(s)){case 1:r=av;break;case 4:r=p3;break;case 16:r=$x;break;case 536870912:r=m3;break;default:r=$x}r=UN(r,MN.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function MN(e,t){if(wx=-1,Sx=0,Yn&6)throw Error(Dr(327));var r=e.callbackNode;if($f()&&e.callbackNode!==r)return null;var s=Wx(e,e===Ua?ei:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=i1(e,s);else{t=s;var a=Yn;Yn|=2;var i=BN();(Ua!==e||ei!==t)&&(dc=null,i0=aa()+500,su(e,t));do try{SL();break}catch(l){RN(e,l)}while(!0);yv(),n1.current=i,Yn=a,ba!==null?t=0:(Ua=null,ei=0,t=Ta)}if(t!==0){if(t===2&&(a=Tb(e),a!==0&&(s=a,t=s2(e,a))),t===1)throw r=tp,su(e,0),nd(e,s),Vi(e,aa()),r;if(t===6)nd(e,s);else{if(a=e.current.alternate,!(s&30)&&!vL(a)&&(t=i1(e,s),t===2&&(i=Tb(e),i!==0&&(s=i,t=s2(e,i))),t===1))throw r=tp,su(e,0),nd(e,s),Vi(e,aa()),r;switch(e.finishedWork=a,e.finishedLanes=s,t){case 0:case 1:throw Error(Dr(345));case 2:Qd(e,Ui,dc);break;case 3:if(nd(e,s),(s&130023424)===s&&(t=Mv+500-aa(),10<t)){if(Wx(e,0)!==0)break;if(a=e.suspendedLanes,(a&s)!==s){Ti(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Ib(Qd.bind(null,e,Ui,dc),t);break}Qd(e,Ui,dc);break;case 4:if(nd(e,s),(s&4194240)===s)break;for(t=e.eventTimes,a=-1;0<s;){var o=31-hl(s);i=1<<o,o=t[o],o>a&&(a=o),s&=~i}if(s=a,s=aa()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*bL(s/1960))-s,10<s){e.timeoutHandle=Ib(Qd.bind(null,e,Ui,dc),s);break}Qd(e,Ui,dc);break;case 5:Qd(e,Ui,dc);break;default:throw Error(Dr(329))}}}return Vi(e,aa()),e.callbackNode===r?MN.bind(null,e):null}function s2(e,t){var r=Ah;return e.current.memoizedState.isDehydrated&&(su(e,t).flags|=256),e=i1(e,t),e!==2&&(t=Ui,Ui=r,t!==null&&a2(t)),e}function a2(e){Ui===null?Ui=e:Ui.push.apply(Ui,e)}function vL(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var s=0;s<r.length;s++){var a=r[s],i=a.getSnapshot;a=a.value;try{if(!yl(i(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function nd(e,t){for(t&=~Fv,t&=~V1,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-hl(t),s=1<<r;e[r]=-1,t&=~s}}function IS(e){if(Yn&6)throw Error(Dr(327));$f();var t=Wx(e,0);if(!(t&1))return Vi(e,aa()),null;var r=i1(e,t);if(e.tag!==0&&r===2){var s=Tb(e);s!==0&&(t=s,r=s2(e,s))}if(r===1)throw r=tp,su(e,0),nd(e,t),Vi(e,aa()),r;if(r===6)throw Error(Dr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Qd(e,Ui,dc),Vi(e,aa()),null}function Rv(e,t){var r=Yn;Yn|=1;try{return e(t)}finally{Yn=r,Yn===0&&(i0=aa()+500,W1&&Fd())}}function gu(e){od!==null&&od.tag===0&&!(Yn&6)&&$f();var t=Yn;Yn|=1;var r=qo.transition,s=fs;try{if(qo.transition=null,fs=1,e)return e()}finally{fs=s,qo.transition=r,Yn=t,!(Yn&6)&&Fd()}}function Bv(){po=Ef.current,Ns(Ef)}function su(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Y7(r)),ba!==null)for(r=ba.return;r!==null;){var s=r;switch(mv(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Gx();break;case 3:s0(),Ns(qi),Ns(bi),kv();break;case 5:_v(s);break;case 4:s0();break;case 13:Ns(Ps);break;case 19:Ns(Ps);break;case 10:bv(s.type._context);break;case 22:case 23:Bv()}r=r.return}if(Ua=e,ba=e=bd(e.current,null),ei=po=t,Ta=0,tp=null,Fv=V1=xu=0,Ui=Ah=null,Zd!==null){for(t=0;t<Zd.length;t++)if(r=Zd[t],s=r.interleaved,s!==null){r.interleaved=null;var a=s.next,i=r.pending;if(i!==null){var o=i.next;i.next=a,s.next=o}r.pending=s}Zd=null}return e}function RN(e,t){do{var r=ba;try{if(yv(),yx.current=r1,t1){for(var s=Ds.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}t1=!1}if(mu=0,Pa=Ca=Ds=null,jh=!1,Jh=0,Lv.current=null,r===null||r.return===null){Ta=1,tp=t,ba=null;break}e:{var i=e,o=r.return,l=r,c=t;if(t=ei,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=jS(o);if(f!==null){f.flags&=-257,NS(f,o,l,i,t),f.mode&1&&kS(i,d,t),t=f,c=d;var x=t.updateQueue;if(x===null){var g=new Set;g.add(c),t.updateQueue=g}else x.add(c);break e}else{if(!(t&1)){kS(i,d,t),Pv();break e}c=Error(Dr(426))}}else if(Ls&&l.mode&1){var y=jS(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),NS(y,o,l,i,t),xv(a0(c,l));break e}}i=c=a0(c,l),Ta!==4&&(Ta=2),Ah===null?Ah=[i]:Ah.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var m=gN(i,c,t);yS(i,m);break e;case 1:l=c;var w=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(gd===null||!gd.has(S)))){i.flags|=65536,t&=-t,i.lanes|=t;var k=yN(i,l,t);yS(i,k);break e}}i=i.return}while(i!==null)}ON(r)}catch(F){t=F,ba===r&&r!==null&&(ba=r=r.return);continue}break}while(!0)}function BN(){var e=n1.current;return n1.current=r1,e===null?r1:e}function Pv(){(Ta===0||Ta===3||Ta===2)&&(Ta=4),Ua===null||!(xu&268435455)&&!(V1&268435455)||nd(Ua,ei)}function i1(e,t){var r=Yn;Yn|=2;var s=BN();(Ua!==e||ei!==t)&&(dc=null,su(e,t));do try{wL();break}catch(a){RN(e,a)}while(!0);if(yv(),Yn=r,n1.current=s,ba!==null)throw Error(Dr(261));return Ua=null,ei=0,Ta}function wL(){for(;ba!==null;)PN(ba)}function SL(){for(;ba!==null&&!GT();)PN(ba)}function PN(e){var t=DN(e.alternate,e,po);e.memoizedProps=e.pendingProps,t===null?ON(e):ba=t,Lv.current=null}function ON(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=mL(r,t),r!==null){r.flags&=32767,ba=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ta=6,ba=null;return}}else if(r=pL(r,t,po),r!==null){ba=r;return}if(t=t.sibling,t!==null){ba=t;return}ba=t=e}while(t!==null);Ta===0&&(Ta=5)}function Qd(e,t,r){var s=fs,a=qo.transition;try{qo.transition=null,fs=1,_L(e,t,r,s)}finally{qo.transition=a,fs=s}return null}function _L(e,t,r,s){do $f();while(od!==null);if(Yn&6)throw Error(Dr(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Dr(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(n7(e,i),e===Ua&&(ba=Ua=null,ei=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Em||(Em=!0,UN($x,function(){return $f(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=qo.transition,qo.transition=null;var o=fs;fs=1;var l=Yn;Yn|=4,Lv.current=null,gL(e,r),LN(r,e),z7(Pb),zx=!!Bb,Pb=Bb=null,e.current=r,yL(r),QT(),Yn=l,fs=o,qo.transition=i}else e.current=r;if(Em&&(Em=!1,od=e,a1=a),i=e.pendingLanes,i===0&&(gd=null),KT(r.stateNode),Vi(e,aa()),t!==null)for(s=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],s(a.value,{componentStack:a.stack,digest:a.digest});if(s1)throw s1=!1,e=r2,r2=null,e;return a1&1&&e.tag!==0&&$f(),i=e.pendingLanes,i&1?e===n2?Ch++:(Ch=0,n2=e):Ch=0,Fd(),null}function $f(){if(od!==null){var e=g3(a1),t=qo.transition,r=fs;try{if(qo.transition=null,fs=16>e?16:e,od===null)var s=!1;else{if(e=od,od=null,a1=0,Yn&6)throw Error(Dr(331));var a=Yn;for(Yn|=4,tn=e.current;tn!==null;){var i=tn,o=i.child;if(tn.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(tn=d;tn!==null;){var u=tn;switch(u.tag){case 0:case 11:case 15:Nh(8,u,i)}var h=u.child;if(h!==null)h.return=u,tn=h;else for(;tn!==null;){u=tn;var p=u.sibling,f=u.return;if(CN(u),u===d){tn=null;break}if(p!==null){p.return=f,tn=p;break}tn=f}}}var x=i.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}tn=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,tn=o;else e:for(;tn!==null;){if(i=tn,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Nh(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,tn=m;break e}tn=i.return}}var w=e.current;for(tn=w;tn!==null;){o=tn;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,tn=S;else e:for(o=w;tn!==null;){if(l=tn,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:H1(9,l)}}catch(F){Vs(l,l.return,F)}if(l===o){tn=null;break e}var k=l.sibling;if(k!==null){k.return=l.return,tn=k;break e}tn=l.return}}if(Yn=a,Fd(),Hl&&typeof Hl.onPostCommitFiberRoot=="function")try{Hl.onPostCommitFiberRoot(O1,e)}catch{}s=!0}return s}finally{fs=r,qo.transition=t}}return!1}function DS(e,t,r){t=a0(r,t),t=gN(e,t,1),e=xd(e,t,1),t=Ti(),e!==null&&(Cp(e,1,t),Vi(e,t))}function Vs(e,t,r){if(e.tag===3)DS(e,e,r);else for(;t!==null;){if(t.tag===3){DS(t,e,r);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(gd===null||!gd.has(s))){e=a0(r,e),e=yN(t,e,1),t=xd(t,e,1),e=Ti(),t!==null&&(Cp(t,1,e),Vi(t,e));break}}t=t.return}}function kL(e,t,r){var s=e.pingCache;s!==null&&s.delete(t),t=Ti(),e.pingedLanes|=e.suspendedLanes&r,Ua===e&&(ei&r)===r&&(Ta===4||Ta===3&&(ei&130023424)===ei&&500>aa()-Mv?su(e,0):Fv|=r),Vi(e,t)}function IN(e,t){t===0&&(e.mode&1?(t=bm,bm<<=1,!(bm&130023424)&&(bm=4194304)):t=1);var r=Ti();e=Sc(e,t),e!==null&&(Cp(e,t,r),Vi(e,r))}function jL(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),IN(e,r)}function NL(e,t){var r=0;switch(e.tag){case 13:var s=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(Dr(314))}s!==null&&s.delete(t),IN(e,r)}var DN;DN=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||qi.current)$i=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return $i=!1,hL(e,t,r);$i=!!(e.flags&131072)}else $i=!1,Ls&&t.flags&1048576&&z3(t,Yx,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;vx(e,t),e=t.pendingProps;var a=t0(t,bi.current);Uf(t,r),a=Nv(null,t,s,e,a,r);var i=Av();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Hi(s)?(i=!0,Qx(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,wv(t),a.updater=q1,t.stateNode=a,a._reactInternals=t,Hb(t,s,e,r),t=Qb(null,t,s,!0,i,r)):(t.tag=0,Ls&&i&&pv(t),Ai(null,t,a,r),t=t.child),t;case 16:s=t.elementType;e:{switch(vx(e,t),e=t.pendingProps,a=s._init,s=a(s._payload),t.type=s,a=t.tag=CL(s),e=ll(s,e),a){case 0:t=Gb(null,t,s,e,r);break e;case 1:t=ES(null,t,s,e,r);break e;case 11:t=AS(null,t,s,e,r);break e;case 14:t=CS(null,t,s,ll(s.type,e),r);break e}throw Error(Dr(306,s,""))}return t;case 0:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:ll(s,a),Gb(e,t,s,a,r);case 1:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:ll(s,a),ES(e,t,s,a,r);case 3:e:{if(SN(t),e===null)throw Error(Dr(387));s=t.pendingProps,i=t.memoizedState,a=i.element,X3(e,t),Zx(t,s,null,r);var o=t.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=a0(Error(Dr(423)),t),t=TS(e,t,s,r,a);break e}else if(s!==a){a=a0(Error(Dr(424)),t),t=TS(e,t,s,r,a);break e}else for(bo=md(t.stateNode.containerInfo.firstChild),So=t,Ls=!0,dl=null,r=G3(t,null,s,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(r0(),s===a){t=_c(e,t,r);break e}Ai(e,t,s,r)}t=t.child}return t;case 5:return Y3(t),e===null&&Wb(t),s=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,Ob(s,a)?o=null:i!==null&&Ob(s,i)&&(t.flags|=32),wN(e,t),Ai(e,t,o,r),t.child;case 6:return e===null&&Wb(t),null;case 13:return _N(e,t,r);case 4:return Sv(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=n0(t,null,s,r):Ai(e,t,s,r),t.child;case 11:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:ll(s,a),AS(e,t,s,a,r);case 7:return Ai(e,t,t.pendingProps,r),t.child;case 8:return Ai(e,t,t.pendingProps.children,r),t.child;case 12:return Ai(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(s=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,vs(Kx,s._currentValue),s._currentValue=o,i!==null)if(yl(i.value,o)){if(i.children===a.children&&!qi.current){t=_c(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===s){if(i.tag===1){c=xc(-1,r&-r),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=r,c=i.alternate,c!==null&&(c.lanes|=r),zb(i.return,r,t),l.lanes|=r;break}c=c.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Dr(341));o.lanes|=r,l=o.alternate,l!==null&&(l.lanes|=r),zb(o,r,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Ai(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,s=t.pendingProps.children,Uf(t,r),a=Vo(a),s=s(a),t.flags|=1,Ai(e,t,s,r),t.child;case 14:return s=t.type,a=ll(s,t.pendingProps),a=ll(s.type,a),CS(e,t,s,a,r);case 15:return bN(e,t,t.type,t.pendingProps,r);case 17:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:ll(s,a),vx(e,t),t.tag=1,Hi(s)?(e=!0,Qx(t)):e=!1,Uf(t,r),xN(t,s,a),Hb(t,s,a,r),Qb(null,t,s,!0,e,r);case 19:return kN(e,t,r);case 22:return vN(e,t,r)}throw Error(Dr(156,t.tag))};function UN(e,t){return h3(e,t)}function AL(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zo(e,t,r,s){return new AL(e,t,r,s)}function Ov(e){return e=e.prototype,!(!e||!e.isReactComponent)}function CL(e){if(typeof e=="function")return Ov(e)?1:0;if(e!=null){if(e=e.$$typeof,e===rv)return 11;if(e===nv)return 14}return 2}function bd(e,t){var r=e.alternate;return r===null?(r=zo(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function _x(e,t,r,s,a,i){var o=2;if(s=e,typeof e=="function")Ov(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case bf:return au(r.children,a,i,t);case tv:o=8,a|=8;break;case mb:return e=zo(12,r,t,a|2),e.elementType=mb,e.lanes=i,e;case xb:return e=zo(13,r,t,a),e.elementType=xb,e.lanes=i,e;case gb:return e=zo(19,r,t,a),e.elementType=gb,e.lanes=i,e;case Y4:return G1(r,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Q4:o=10;break e;case X4:o=9;break e;case rv:o=11;break e;case nv:o=14;break e;case ed:o=16,s=null;break e}throw Error(Dr(130,e==null?e:typeof e,""))}return t=zo(o,r,t,a),t.elementType=e,t.type=s,t.lanes=i,t}function au(e,t,r,s){return e=zo(7,e,s,t),e.lanes=r,e}function G1(e,t,r,s){return e=zo(22,e,s,t),e.elementType=Y4,e.lanes=r,e.stateNode={isHidden:!1},e}function cy(e,t,r){return e=zo(6,e,null,t),e.lanes=r,e}function dy(e,t,r){return t=zo(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function EL(e,t,r,s,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qg(0),this.expirationTimes=qg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qg(0),this.identifierPrefix=s,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Iv(e,t,r,s,a,i,o,l,c){return e=new EL(e,t,r,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=zo(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},wv(i),e}function TL(e,t,r){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yf,key:s==null?null:""+s,children:e,containerInfo:t,implementation:r}}function $N(e){if(!e)return Sd;e=e._reactInternals;e:{if(Tu(e)!==e||e.tag!==1)throw Error(Dr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Hi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Dr(171))}if(e.tag===1){var r=e.type;if(Hi(r))return $3(e,r,t)}return t}function WN(e,t,r,s,a,i,o,l,c){return e=Iv(r,s,!0,e,a,i,o,l,c),e.context=$N(null),r=e.current,s=Ti(),a=yd(r),i=xc(s,a),i.callback=t??null,xd(r,i,a),e.current.lanes=a,Cp(e,a,s),Vi(e,s),e}function Q1(e,t,r,s){var a=t.current,i=Ti(),o=yd(a);return r=$N(r),t.context===null?t.context=r:t.pendingContext=r,t=xc(i,o),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=xd(a,t,o),e!==null&&(pl(e,a,o,i),gx(e,a,o)),o}function o1(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function US(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Dv(e,t){US(e,t),(e=e.alternate)&&US(e,t)}function LL(){return null}var zN=typeof reportError=="function"?reportError:function(e){console.error(e)};function Uv(e){this._internalRoot=e}X1.prototype.render=Uv.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Dr(409));Q1(e,t,null,null)};X1.prototype.unmount=Uv.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;gu(function(){Q1(null,e,null,null)}),t[wc]=null}};function X1(e){this._internalRoot=e}X1.prototype.unstable_scheduleHydration=function(e){if(e){var t=v3();e={blockedOn:null,target:e,priority:t};for(var r=0;r<rd.length&&t!==0&&t<rd[r].priority;r++);rd.splice(r,0,e),r===0&&S3(e)}};function $v(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Y1(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function $S(){}function FL(e,t,r,s,a){if(a){if(typeof s=="function"){var i=s;s=function(){var d=o1(o);i.call(d)}}var o=WN(t,s,e,0,null,!1,!1,"",$S);return e._reactRootContainer=o,e[wc]=o.current,Gh(e.nodeType===8?e.parentNode:e),gu(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof s=="function"){var l=s;s=function(){var d=o1(c);l.call(d)}}var c=Iv(e,0,!1,null,null,!1,!1,"",$S);return e._reactRootContainer=c,e[wc]=c.current,Gh(e.nodeType===8?e.parentNode:e),gu(function(){Q1(t,c,r,s)}),c}function K1(e,t,r,s,a){var i=r._reactRootContainer;if(i){var o=i;if(typeof a=="function"){var l=a;a=function(){var c=o1(o);l.call(c)}}Q1(t,o,e,a)}else o=FL(r,t,e,a,s);return o1(o)}y3=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=mh(t.pendingLanes);r!==0&&(iv(t,r|1),Vi(t,aa()),!(Yn&6)&&(i0=aa()+500,Fd()))}break;case 13:gu(function(){var s=Sc(e,1);if(s!==null){var a=Ti();pl(s,e,1,a)}}),Dv(e,1)}};ov=function(e){if(e.tag===13){var t=Sc(e,134217728);if(t!==null){var r=Ti();pl(t,e,134217728,r)}Dv(e,134217728)}};b3=function(e){if(e.tag===13){var t=yd(e),r=Sc(e,t);if(r!==null){var s=Ti();pl(r,e,t,s)}Dv(e,t)}};v3=function(){return fs};w3=function(e,t){var r=fs;try{return fs=e,t()}finally{fs=r}};Ab=function(e,t,r){switch(t){case"input":if(vb(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var s=r[t];if(s!==e&&s.form===e.form){var a=$1(s);if(!a)throw Error(Dr(90));J4(s),vb(s,a)}}}break;case"textarea":e3(e,r);break;case"select":t=r.value,t!=null&&Pf(e,!!r.multiple,t,!1)}};o3=Rv;l3=gu;var ML={usingClientEntryPoint:!1,Events:[Tp,_f,$1,a3,i3,Rv]},eh={findFiberByHostInstance:Jd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},RL={bundleType:eh.bundleType,version:eh.version,rendererPackageName:eh.rendererPackageName,rendererConfig:eh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ac.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=u3(e),e===null?null:e.stateNode},findFiberByHostInstance:eh.findFiberByHostInstance||LL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tm.isDisabled&&Tm.supportsFiber)try{O1=Tm.inject(RL),Hl=Tm}catch{}}jo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ML;jo.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$v(t))throw Error(Dr(200));return TL(e,t,null,r)};jo.createRoot=function(e,t){if(!$v(e))throw Error(Dr(299));var r=!1,s="",a=zN;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Iv(e,1,!1,null,null,r,!1,s,a),e[wc]=t.current,Gh(e.nodeType===8?e.parentNode:e),new Uv(t)};jo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Dr(188)):(e=Object.keys(e).join(","),Error(Dr(268,e)));return e=u3(t),e=e===null?null:e.stateNode,e};jo.flushSync=function(e){return gu(e)};jo.hydrate=function(e,t,r){if(!Y1(t))throw Error(Dr(200));return K1(null,e,t,!0,r)};jo.hydrateRoot=function(e,t,r){if(!$v(e))throw Error(Dr(405));var s=r!=null&&r.hydratedSources||null,a=!1,i="",o=zN;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=WN(t,null,e,1,r??null,a,!1,i,o),e[wc]=t.current,Gh(e),s)for(e=0;e<s.length;e++)r=s[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new X1(t)};jo.render=function(e,t,r){if(!Y1(t))throw Error(Dr(200));return K1(null,e,t,!1,r)};jo.unmountComponentAtNode=function(e){if(!Y1(e))throw Error(Dr(40));return e._reactRootContainer?(gu(function(){K1(null,null,e,!1,function(){e._reactRootContainer=null,e[wc]=null})}),!0):!1};jo.unstable_batchedUpdates=Rv;jo.unstable_renderSubtreeIntoContainer=function(e,t,r,s){if(!Y1(r))throw Error(Dr(200));if(e==null||e._reactInternals===void 0)throw Error(Dr(38));return K1(e,t,r,!1,s)};jo.version="18.3.1-next-f1338f8080-20240426";function qN(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(qN)}catch(e){console.error(e)}}qN(),q4.exports=jo;var BL=q4.exports,HN,WS=BL;HN=WS.createRoot,WS.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rp(){return rp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},rp.apply(this,arguments)}var ld;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ld||(ld={}));const zS="popstate";function PL(e){e===void 0&&(e={});function t(s,a){let{pathname:i,search:o,hash:l}=s.location;return i2("",{pathname:i,search:o,hash:l},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(s,a){return typeof a=="string"?a:l1(a)}return IL(t,r,null,e)}function da(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Wv(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function OL(){return Math.random().toString(36).substr(2,8)}function qS(e,t){return{usr:e.state,key:e.key,idx:t}}function i2(e,t,r,s){return r===void 0&&(r=null),rp({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?m0(t):t,{state:r,key:t&&t.key||s||OL()})}function l1(e){let{pathname:t="/",search:r="",hash:s=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function m0(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function IL(e,t,r,s){s===void 0&&(s={});let{window:a=document.defaultView,v5Compat:i=!1}=s,o=a.history,l=ld.Pop,c=null,d=u();d==null&&(d=0,o.replaceState(rp({},o.state,{idx:d}),""));function u(){return(o.state||{idx:null}).idx}function h(){l=ld.Pop;let y=u(),m=y==null?null:y-d;d=y,c&&c({action:l,location:g.location,delta:m})}function p(y,m){l=ld.Push;let w=i2(g.location,y,m);d=u()+1;let S=qS(w,d),k=g.createHref(w);try{o.pushState(S,"",k)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;a.location.assign(k)}i&&c&&c({action:l,location:g.location,delta:1})}function f(y,m){l=ld.Replace;let w=i2(g.location,y,m);d=u();let S=qS(w,d),k=g.createHref(w);o.replaceState(S,"",k),i&&c&&c({action:l,location:g.location,delta:0})}function x(y){let m=a.location.origin!=="null"?a.location.origin:a.location.href,w=typeof y=="string"?y:l1(y);return w=w.replace(/ $/,"%20"),da(m,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,m)}let g={get action(){return l},get location(){return e(a,o)},listen(y){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(zS,h),c=y,()=>{a.removeEventListener(zS,h),c=null}},createHref(y){return t(a,y)},createURL:x,encodeLocation(y){let m=x(y);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:p,replace:f,go(y){return o.go(y)}};return g}var HS;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(HS||(HS={}));function DL(e,t,r){return r===void 0&&(r="/"),UL(e,t,r)}function UL(e,t,r,s){let a=typeof t=="string"?m0(t):t,i=zv(a.pathname||"/",r);if(i==null)return null;let o=VN(e);$L(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=ZL(i);l=YL(o[c],d)}return l}function VN(e,t,r,s){t===void 0&&(t=[]),r===void 0&&(r=[]),s===void 0&&(s="");let a=(i,o,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};c.relativePath.startsWith("/")&&(da(c.relativePath.startsWith(s),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(s.length));let d=vd([s,c.relativePath]),u=r.concat(c);i.children&&i.children.length>0&&(da(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),VN(i.children,t,u,d)),!(i.path==null&&!i.index)&&t.push({path:d,score:QL(d,i.index),routesMeta:u})};return e.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))a(i,o);else for(let c of GN(i.path))a(i,o,c)}),t}function GN(e){let t=e.split("/");if(t.length===0)return[];let[r,...s]=t,a=r.endsWith("?"),i=r.replace(/\?$/,"");if(s.length===0)return a?[i,""]:[i];let o=GN(s.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),a&&l.push(...o),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function $L(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:XL(t.routesMeta.map(s=>s.childrenIndex),r.routesMeta.map(s=>s.childrenIndex)))}const WL=/^:[\w-]+$/,zL=3,qL=2,HL=1,VL=10,GL=-2,VS=e=>e==="*";function QL(e,t){let r=e.split("/"),s=r.length;return r.some(VS)&&(s+=GL),t&&(s+=qL),r.filter(a=>!VS(a)).reduce((a,i)=>a+(WL.test(i)?zL:i===""?HL:VL),s)}function XL(e,t){return e.length===t.length&&e.slice(0,-1).every((s,a)=>s===t[a])?e[e.length-1]-t[t.length-1]:0}function YL(e,t,r){let{routesMeta:s}=e,a={},i="/",o=[];for(let l=0;l<s.length;++l){let c=s[l],d=l===s.length-1,u=i==="/"?t:t.slice(i.length)||"/",h=KL({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),p=c.route;if(!h)return null;Object.assign(a,h.params),o.push({params:a,pathname:vd([i,h.pathname]),pathnameBase:sF(vd([i,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(i=vd([i,h.pathnameBase]))}return o}function KL(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,s]=JL(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let i=a[0],o=i.replace(/(.)\/+$/,"$1"),l=a.slice(1);return{params:s.reduce((d,u,h)=>{let{paramName:p,isOptional:f}=u;if(p==="*"){let g=l[h]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[h];return f&&!x?d[p]=void 0:d[p]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:e}}function JL(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Wv(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(s.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),s]}function ZL(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Wv(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function zv(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,s=e.charAt(r);return s&&s!=="/"?null:e.slice(r)||"/"}const eF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,tF=e=>eF.test(e);function rF(e,t){t===void 0&&(t="/");let{pathname:r,search:s="",hash:a=""}=typeof e=="string"?m0(e):e,i;if(r)if(tF(r))i=r;else{if(r.includes("//")){let o=r;r=r.replace(/\/\/+/g,"/"),Wv(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+r))}r.startsWith("/")?i=GS(r.substring(1),"/"):i=GS(r,t)}else i=t;return{pathname:i,search:aF(s),hash:iF(a)}}function GS(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function uy(e,t,r,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nF(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function qv(e,t){let r=nF(e);return t?r.map((s,a)=>a===r.length-1?s.pathname:s.pathnameBase):r.map(s=>s.pathnameBase)}function Hv(e,t,r,s){s===void 0&&(s=!1);let a;typeof e=="string"?a=m0(e):(a=rp({},e),da(!a.pathname||!a.pathname.includes("?"),uy("?","pathname","search",a)),da(!a.pathname||!a.pathname.includes("#"),uy("#","pathname","hash",a)),da(!a.search||!a.search.includes("#"),uy("#","search","hash",a)));let i=e===""||a.pathname==="",o=i?"/":a.pathname,l;if(o==null)l=r;else{let h=t.length-1;if(!s&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),h-=1;a.pathname=p.join("/")}l=h>=0?t[h]:"/"}let c=rF(a,l),d=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const vd=e=>e.join("/").replace(/\/\/+/g,"/"),sF=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),aF=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,iF=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function oF(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const QN=["post","put","patch","delete"];new Set(QN);const lF=["get",...QN];new Set(lF);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function np(){return np=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},np.apply(this,arguments)}const Vv=v.createContext(null),cF=v.createContext(null),Md=v.createContext(null),J1=v.createContext(null),Cc=v.createContext({outlet:null,matches:[],isDataRoute:!1}),XN=v.createContext(null);function dF(e,t){let{relative:r}=t===void 0?{}:t;x0()||da(!1);let{basename:s,navigator:a}=v.useContext(Md),{hash:i,pathname:o,search:l}=KN(e,{relative:r}),c=o;return s!=="/"&&(c=o==="/"?s:vd([s,o])),a.createHref({pathname:c,search:l,hash:i})}function x0(){return v.useContext(J1)!=null}function Ji(){return x0()||da(!1),v.useContext(J1).location}function YN(e){v.useContext(Md).static||v.useLayoutEffect(e)}function Ri(){let{isDataRoute:e}=v.useContext(Cc);return e?_F():uF()}function uF(){x0()||da(!1);let e=v.useContext(Vv),{basename:t,future:r,navigator:s}=v.useContext(Md),{matches:a}=v.useContext(Cc),{pathname:i}=Ji(),o=JSON.stringify(qv(a,r.v7_relativeSplatPath)),l=v.useRef(!1);return YN(()=>{l.current=!0}),v.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){s.go(d);return}let h=Hv(d,JSON.parse(o),i,u.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:vd([t,h.pathname])),(u.replace?s.replace:s.push)(h,u.state,u)},[t,s,o,i,e])}function g0(){let{matches:e}=v.useContext(Cc),t=e[e.length-1];return t?t.params:{}}function KN(e,t){let{relative:r}=t===void 0?{}:t,{future:s}=v.useContext(Md),{matches:a}=v.useContext(Cc),{pathname:i}=Ji(),o=JSON.stringify(qv(a,s.v7_relativeSplatPath));return v.useMemo(()=>Hv(e,JSON.parse(o),i,r==="path"),[e,o,i,r])}function fF(e,t){return hF(e,t)}function hF(e,t,r,s){x0()||da(!1);let{navigator:a}=v.useContext(Md),{matches:i}=v.useContext(Cc),o=i[i.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=Ji(),u;if(t){var h;let y=typeof t=="string"?m0(t):t;c==="/"||(h=y.pathname)!=null&&h.startsWith(c)||da(!1),u=y}else u=d;let p=u.pathname||"/",f=p;if(c!=="/"){let y=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(y.length).join("/")}let x=DL(e,{pathname:f}),g=yF(x&&x.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:vd([c,a.encodeLocation?a.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:vd([c,a.encodeLocation?a.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),i,r,s);return t&&g?v.createElement(J1.Provider,{value:{location:np({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ld.Pop}},g):g}function pF(){let e=SF(),t=oF(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return v.createElement(v.Fragment,null,v.createElement("h2",null,"Unexpected Application Error!"),v.createElement("h3",{style:{fontStyle:"italic"}},t),r?v.createElement("pre",{style:a},r):null,null)}const mF=v.createElement(pF,null);class xF extends v.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?v.createElement(Cc.Provider,{value:this.props.routeContext},v.createElement(XN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function gF(e){let{routeContext:t,match:r,children:s}=e,a=v.useContext(Vv);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),v.createElement(Cc.Provider,{value:t},s)}function yF(e,t,r,s){var a;if(t===void 0&&(t=[]),r===void 0&&(r=null),s===void 0&&(s=null),e==null){var i;if(!r)return null;if(r.errors)e=r.matches;else if((i=s)!=null&&i.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let o=e,l=(a=r)==null?void 0:a.errors;if(l!=null){let u=o.findIndex(h=>h.route.id&&(l==null?void 0:l[h.route.id])!==void 0);u>=0||da(!1),o=o.slice(0,Math.min(o.length,u+1))}let c=!1,d=-1;if(r&&s&&s.v7_partialHydration)for(let u=0;u<o.length;u++){let h=o[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(d=u),h.route.id){let{loaderData:p,errors:f}=r,x=h.route.loader&&p[h.route.id]===void 0&&(!f||f[h.route.id]===void 0);if(h.route.lazy||x){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((u,h,p)=>{let f,x=!1,g=null,y=null;r&&(f=l&&h.route.id?l[h.route.id]:void 0,g=h.route.errorElement||mF,c&&(d<0&&p===0?(kF("route-fallback"),x=!0,y=null):d===p&&(x=!0,y=h.route.hydrateFallbackElement||null)));let m=t.concat(o.slice(0,p+1)),w=()=>{let S;return f?S=g:x?S=y:h.route.Component?S=v.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=u,v.createElement(gF,{match:h,routeContext:{outlet:u,matches:m,isDataRoute:r!=null},children:S})};return r&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?v.createElement(xF,{location:r.location,revalidation:r.revalidation,component:g,error:f,children:w(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):w()},null)}var JN=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(JN||{}),ZN=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ZN||{});function bF(e){let t=v.useContext(Vv);return t||da(!1),t}function vF(e){let t=v.useContext(cF);return t||da(!1),t}function wF(e){let t=v.useContext(Cc);return t||da(!1),t}function e6(e){let t=wF(),r=t.matches[t.matches.length-1];return r.route.id||da(!1),r.route.id}function SF(){var e;let t=v.useContext(XN),r=vF(),s=e6();return t!==void 0?t:(e=r.errors)==null?void 0:e[s]}function _F(){let{router:e}=bF(JN.UseNavigateStable),t=e6(ZN.UseNavigateStable),r=v.useRef(!1);return YN(()=>{r.current=!0}),v.useCallback(function(a,i){i===void 0&&(i={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,np({fromRouteId:t},i)))},[e,t])}const QS={};function kF(e,t,r){QS[e]||(QS[e]=!0)}function jF(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Tf(e){let{to:t,replace:r,state:s,relative:a}=e;x0()||da(!1);let{future:i,static:o}=v.useContext(Md),{matches:l}=v.useContext(Cc),{pathname:c}=Ji(),d=Ri(),u=Hv(t,qv(l,i.v7_relativeSplatPath),c,a==="path"),h=JSON.stringify(u);return v.useEffect(()=>d(JSON.parse(h),{replace:r,state:s,relative:a}),[d,h,a,r,s]),null}function Pn(e){da(!1)}function NF(e){let{basename:t="/",children:r=null,location:s,navigationType:a=ld.Pop,navigator:i,static:o=!1,future:l}=e;x0()&&da(!1);let c=t.replace(/^\/*/,"/"),d=v.useMemo(()=>({basename:c,navigator:i,static:o,future:np({v7_relativeSplatPath:!1},l)}),[c,l,i,o]);typeof s=="string"&&(s=m0(s));let{pathname:u="/",search:h="",hash:p="",state:f=null,key:x="default"}=s,g=v.useMemo(()=>{let y=zv(u,c);return y==null?null:{location:{pathname:y,search:h,hash:p,state:f,key:x},navigationType:a}},[c,u,h,p,f,x,a]);return g==null?null:v.createElement(Md.Provider,{value:d},v.createElement(J1.Provider,{children:r,value:g}))}function o2(e){let{children:t,location:r}=e;return fF(l2(t),r)}new Promise(()=>{});function l2(e,t){t===void 0&&(t=[]);let r=[];return v.Children.forEach(e,(s,a)=>{if(!v.isValidElement(s))return;let i=[...t,a];if(s.type===v.Fragment){r.push.apply(r,l2(s.props.children,i));return}s.type!==Pn&&da(!1),!s.props.index||!s.props.children||da(!1);let o={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=l2(s.props.children,i)),r.push(o)}),r}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function c2(){return c2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},c2.apply(this,arguments)}function AF(e,t){if(e==null)return{};var r={},s=Object.keys(e),a,i;for(i=0;i<s.length;i++)a=s[i],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function CF(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function EF(e,t){return e.button===0&&(!t||t==="_self")&&!CF(e)}function d2(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let s=e[r];return t.concat(Array.isArray(s)?s.map(a=>[r,a]):[[r,s]])},[]))}function TF(e,t){let r=d2(e);return t&&t.forEach((s,a)=>{r.has(a)||t.getAll(a).forEach(i=>{r.append(a,i)})}),r}const LF=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],FF="6";try{window.__reactRouterVersion=FF}catch{}const MF="startTransition",XS=kT[MF];function RF(e){let{basename:t,children:r,future:s,window:a}=e,i=v.useRef();i.current==null&&(i.current=PL({window:a,v5Compat:!0}));let o=i.current,[l,c]=v.useState({action:o.action,location:o.location}),{v7_startTransition:d}=s||{},u=v.useCallback(h=>{d&&XS?XS(()=>c(h)):c(h)},[c,d]);return v.useLayoutEffect(()=>o.listen(u),[o,u]),v.useEffect(()=>jF(s),[s]),v.createElement(NF,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:o,future:s})}const BF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",PF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sa=v.forwardRef(function(t,r){let{onClick:s,relative:a,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:u,viewTransition:h}=t,p=AF(t,LF),{basename:f}=v.useContext(Md),x,g=!1;if(typeof d=="string"&&PF.test(d)&&(x=d,BF))try{let S=new URL(window.location.href),k=d.startsWith("//")?new URL(S.protocol+d):new URL(d),F=zv(k.pathname,f);k.origin===S.origin&&F!=null?d=F+k.search+k.hash:g=!0}catch{}let y=dF(d,{relative:a}),m=OF(d,{replace:o,state:l,target:c,preventScrollReset:u,relative:a,viewTransition:h});function w(S){s&&s(S),S.defaultPrevented||m(S)}return v.createElement("a",c2({},p,{href:x||y,onClick:g||i?s:w,ref:r,target:c}))});var YS;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(YS||(YS={}));var KS;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(KS||(KS={}));function OF(e,t){let{target:r,replace:s,state:a,preventScrollReset:i,relative:o,viewTransition:l}=t===void 0?{}:t,c=Ri(),d=Ji(),u=KN(e,{relative:o});return v.useCallback(h=>{if(EF(h,r)){h.preventDefault();let p=s!==void 0?s:l1(d)===l1(u);c(e,{replace:p,state:a,preventScrollReset:i,relative:o,viewTransition:l})}},[d,c,u,s,a,r,e,i,o,l])}function IF(e){let t=v.useRef(d2(e)),r=v.useRef(!1),s=Ji(),a=v.useMemo(()=>TF(s.search,r.current?null:t.current),[s.search]),i=Ri(),o=v.useCallback((l,c)=>{const d=d2(typeof l=="function"?l(a):l);r.current=!0,i("?"+d,c)},[i,a]);return[a,o]}function t6(e,t){return function(){return e.apply(t,arguments)}}const{toString:DF}=Object.prototype,{getPrototypeOf:Gv}=Object,{iterator:Z1,toStringTag:r6}=Symbol,eg=(e=>t=>{const r=DF.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),vl=e=>(e=e.toLowerCase(),t=>eg(t)===e),tg=e=>t=>typeof t===e,{isArray:y0}=Array,o0=tg("undefined");function Fp(e){return e!==null&&!o0(e)&&e.constructor!==null&&!o0(e.constructor)&&Gi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const n6=vl("ArrayBuffer");function UF(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&n6(e.buffer),t}const $F=tg("string"),Gi=tg("function"),s6=tg("number"),Mp=e=>e!==null&&typeof e=="object",WF=e=>e===!0||e===!1,kx=e=>{if(eg(e)!=="object")return!1;const t=Gv(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(r6 in e)&&!(Z1 in e)},zF=e=>{if(!Mp(e)||Fp(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},qF=vl("Date"),HF=vl("File"),VF=vl("Blob"),GF=vl("FileList"),QF=e=>Mp(e)&&Gi(e.pipe),XF=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Gi(e.append)&&((t=eg(e))==="formdata"||t==="object"&&Gi(e.toString)&&e.toString()==="[object FormData]"))},YF=vl("URLSearchParams"),[KF,JF,ZF,eM]=["ReadableStream","Request","Response","Headers"].map(vl),tM=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rp(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let s,a;if(typeof e!="object"&&(e=[e]),y0(e))for(s=0,a=e.length;s<a;s++)t.call(null,e[s],s,e);else{if(Fp(e))return;const i=r?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let l;for(s=0;s<o;s++)l=i[s],t.call(null,e[l],l,e)}}function a6(e,t){if(Fp(e))return null;t=t.toLowerCase();const r=Object.keys(e);let s=r.length,a;for(;s-- >0;)if(a=r[s],t===a.toLowerCase())return a;return null}const tu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,i6=e=>!o0(e)&&e!==tu;function u2(){const{caseless:e,skipUndefined:t}=i6(this)&&this||{},r={},s=(a,i)=>{const o=e&&a6(r,i)||i;kx(r[o])&&kx(a)?r[o]=u2(r[o],a):kx(a)?r[o]=u2({},a):y0(a)?r[o]=a.slice():(!t||!o0(a))&&(r[o]=a)};for(let a=0,i=arguments.length;a<i;a++)arguments[a]&&Rp(arguments[a],s);return r}const rM=(e,t,r,{allOwnKeys:s}={})=>(Rp(t,(a,i)=>{r&&Gi(a)?e[i]=t6(a,r):e[i]=a},{allOwnKeys:s}),e),nM=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),sM=(e,t,r,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},aM=(e,t,r,s)=>{let a,i,o;const l={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),i=a.length;i-- >0;)o=a[i],(!s||s(o,e,t))&&!l[o]&&(t[o]=e[o],l[o]=!0);e=r!==!1&&Gv(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},iM=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const s=e.indexOf(t,r);return s!==-1&&s===r},oM=e=>{if(!e)return null;if(y0(e))return e;let t=e.length;if(!s6(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},lM=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&Gv(Uint8Array)),cM=(e,t)=>{const s=(e&&e[Z1]).call(e);let a;for(;(a=s.next())&&!a.done;){const i=a.value;t.call(e,i[0],i[1])}},dM=(e,t)=>{let r;const s=[];for(;(r=e.exec(t))!==null;)s.push(r);return s},uM=vl("HTMLFormElement"),fM=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,a){return s.toUpperCase()+a}),JS=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),hM=vl("RegExp"),o6=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),s={};Rp(r,(a,i)=>{let o;(o=t(a,i,e))!==!1&&(s[i]=o||a)}),Object.defineProperties(e,s)},pM=e=>{o6(e,(t,r)=>{if(Gi(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const s=e[r];if(Gi(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},mM=(e,t)=>{const r={},s=a=>{a.forEach(i=>{r[i]=!0})};return y0(e)?s(e):s(String(e).split(t)),r},xM=()=>{},gM=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function yM(e){return!!(e&&Gi(e.append)&&e[r6]==="FormData"&&e[Z1])}const bM=e=>{const t=new Array(10),r=(s,a)=>{if(Mp(s)){if(t.indexOf(s)>=0)return;if(Fp(s))return s;if(!("toJSON"in s)){t[a]=s;const i=y0(s)?[]:{};return Rp(s,(o,l)=>{const c=r(o,a+1);!o0(c)&&(i[l]=c)}),t[a]=void 0,i}}return s};return r(e,0)},vM=vl("AsyncFunction"),wM=e=>e&&(Mp(e)||Gi(e))&&Gi(e.then)&&Gi(e.catch),l6=((e,t)=>e?setImmediate:t?((r,s)=>(tu.addEventListener("message",({source:a,data:i})=>{a===tu&&i===r&&s.length&&s.shift()()},!1),a=>{s.push(a),tu.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Gi(tu.postMessage)),SM=typeof queueMicrotask<"u"?queueMicrotask.bind(tu):typeof process<"u"&&process.nextTick||l6,_M=e=>e!=null&&Gi(e[Z1]),or={isArray:y0,isArrayBuffer:n6,isBuffer:Fp,isFormData:XF,isArrayBufferView:UF,isString:$F,isNumber:s6,isBoolean:WF,isObject:Mp,isPlainObject:kx,isEmptyObject:zF,isReadableStream:KF,isRequest:JF,isResponse:ZF,isHeaders:eM,isUndefined:o0,isDate:qF,isFile:HF,isBlob:VF,isRegExp:hM,isFunction:Gi,isStream:QF,isURLSearchParams:YF,isTypedArray:lM,isFileList:GF,forEach:Rp,merge:u2,extend:rM,trim:tM,stripBOM:nM,inherits:sM,toFlatObject:aM,kindOf:eg,kindOfTest:vl,endsWith:iM,toArray:oM,forEachEntry:cM,matchAll:dM,isHTMLForm:uM,hasOwnProperty:JS,hasOwnProp:JS,reduceDescriptors:o6,freezeMethods:pM,toObjectSet:mM,toCamelCase:fM,noop:xM,toFiniteNumber:gM,findKey:a6,global:tu,isContextDefined:i6,isSpecCompliantForm:yM,toJSONObject:bM,isAsyncFn:vM,isThenable:wM,setImmediate:l6,asap:SM,isIterable:_M};function Tn(e,t,r,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}or.inherits(Tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:or.toJSONObject(this.config),code:this.code,status:this.status}}});const c6=Tn.prototype,d6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{d6[e]={value:e}});Object.defineProperties(Tn,d6);Object.defineProperty(c6,"isAxiosError",{value:!0});Tn.from=(e,t,r,s,a,i)=>{const o=Object.create(c6);or.toFlatObject(e,o,function(u){return u!==Error.prototype},d=>d!=="isAxiosError");const l=e&&e.message?e.message:"Error",c=t==null&&e?e.code:t;return Tn.call(o,l,c,r,s,a),e&&o.cause==null&&Object.defineProperty(o,"cause",{value:e,configurable:!0}),o.name=e&&e.name||"Error",i&&Object.assign(o,i),o};const kM=null;function f2(e){return or.isPlainObject(e)||or.isArray(e)}function u6(e){return or.endsWith(e,"[]")?e.slice(0,-2):e}function ZS(e,t,r){return e?e.concat(t).map(function(a,i){return a=u6(a),!r&&i?"["+a+"]":a}).join(r?".":""):t}function jM(e){return or.isArray(e)&&!e.some(f2)}const NM=or.toFlatObject(or,{},null,function(t){return/^is[A-Z]/.test(t)});function rg(e,t,r){if(!or.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=or.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,y){return!or.isUndefined(y[g])});const s=r.metaTokens,a=r.visitor||u,i=r.dots,o=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&or.isSpecCompliantForm(t);if(!or.isFunction(a))throw new TypeError("visitor must be a function");function d(x){if(x===null)return"";if(or.isDate(x))return x.toISOString();if(or.isBoolean(x))return x.toString();if(!c&&or.isBlob(x))throw new Tn("Blob is not supported. Use a Buffer instead.");return or.isArrayBuffer(x)||or.isTypedArray(x)?c&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function u(x,g,y){let m=x;if(x&&!y&&typeof x=="object"){if(or.endsWith(g,"{}"))g=s?g:g.slice(0,-2),x=JSON.stringify(x);else if(or.isArray(x)&&jM(x)||(or.isFileList(x)||or.endsWith(g,"[]"))&&(m=or.toArray(x)))return g=u6(g),m.forEach(function(S,k){!(or.isUndefined(S)||S===null)&&t.append(o===!0?ZS([g],k,i):o===null?g:g+"[]",d(S))}),!1}return f2(x)?!0:(t.append(ZS(y,g,i),d(x)),!1)}const h=[],p=Object.assign(NM,{defaultVisitor:u,convertValue:d,isVisitable:f2});function f(x,g){if(!or.isUndefined(x)){if(h.indexOf(x)!==-1)throw Error("Circular reference detected in "+g.join("."));h.push(x),or.forEach(x,function(m,w){(!(or.isUndefined(m)||m===null)&&a.call(t,m,or.isString(w)?w.trim():w,g,p))===!0&&f(m,g?g.concat(w):[w])}),h.pop()}}if(!or.isObject(e))throw new TypeError("data must be an object");return f(e),t}function e_(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Qv(e,t){this._pairs=[],e&&rg(e,this,t)}const f6=Qv.prototype;f6.append=function(t,r){this._pairs.push([t,r])};f6.toString=function(t){const r=t?function(s){return t.call(this,s,e_)}:e_;return this._pairs.map(function(a){return r(a[0])+"="+r(a[1])},"").join("&")};function AM(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function h6(e,t,r){if(!t)return e;const s=r&&r.encode||AM;or.isFunction(r)&&(r={serialize:r});const a=r&&r.serialize;let i;if(a?i=a(t,r):i=or.isURLSearchParams(t)?t.toString():new Qv(t,r).toString(s),i){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class t_{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){or.forEach(this.handlers,function(s){s!==null&&t(s)})}}const p6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},CM=typeof URLSearchParams<"u"?URLSearchParams:Qv,EM=typeof FormData<"u"?FormData:null,TM=typeof Blob<"u"?Blob:null,LM={isBrowser:!0,classes:{URLSearchParams:CM,FormData:EM,Blob:TM},protocols:["http","https","file","blob","url","data"]},Xv=typeof window<"u"&&typeof document<"u",h2=typeof navigator=="object"&&navigator||void 0,FM=Xv&&(!h2||["ReactNative","NativeScript","NS"].indexOf(h2.product)<0),MM=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",RM=Xv&&window.location.href||"http://localhost",BM=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Xv,hasStandardBrowserEnv:FM,hasStandardBrowserWebWorkerEnv:MM,navigator:h2,origin:RM},Symbol.toStringTag,{value:"Module"})),pi={...BM,...LM};function PM(e,t){return rg(e,new pi.classes.URLSearchParams,{visitor:function(r,s,a,i){return pi.isNode&&or.isBuffer(r)?(this.append(s,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function OM(e){return or.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function IM(e){const t={},r=Object.keys(e);let s;const a=r.length;let i;for(s=0;s<a;s++)i=r[s],t[i]=e[i];return t}function m6(e){function t(r,s,a,i){let o=r[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),c=i>=r.length;return o=!o&&or.isArray(a)?a.length:o,c?(or.hasOwnProp(a,o)?a[o]=[a[o],s]:a[o]=s,!l):((!a[o]||!or.isObject(a[o]))&&(a[o]=[]),t(r,s,a[o],i)&&or.isArray(a[o])&&(a[o]=IM(a[o])),!l)}if(or.isFormData(e)&&or.isFunction(e.entries)){const r={};return or.forEachEntry(e,(s,a)=>{t(OM(s),a,r,0)}),r}return null}function DM(e,t,r){if(or.isString(e))try{return(t||JSON.parse)(e),or.trim(e)}catch(s){if(s.name!=="SyntaxError")throw s}return(r||JSON.stringify)(e)}const Bp={transitional:p6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,i=or.isObject(t);if(i&&or.isHTMLForm(t)&&(t=new FormData(t)),or.isFormData(t))return a?JSON.stringify(m6(t)):t;if(or.isArrayBuffer(t)||or.isBuffer(t)||or.isStream(t)||or.isFile(t)||or.isBlob(t)||or.isReadableStream(t))return t;if(or.isArrayBufferView(t))return t.buffer;if(or.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return PM(t,this.formSerializer).toString();if((l=or.isFileList(t))||s.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return rg(l?{"files[]":t}:t,c&&new c,this.formSerializer)}}return i||a?(r.setContentType("application/json",!1),DM(t)):t}],transformResponse:[function(t){const r=this.transitional||Bp.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(or.isResponse(t)||or.isReadableStream(t))return t;if(t&&or.isString(t)&&(s&&!this.responseType||a)){const o=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(l){if(o)throw l.name==="SyntaxError"?Tn.from(l,Tn.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pi.classes.FormData,Blob:pi.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};or.forEach(["delete","get","head","post","put","patch"],e=>{Bp.headers[e]={}});const UM=or.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$M=e=>{const t={};let r,s,a;return e&&e.split(`
`).forEach(function(o){a=o.indexOf(":"),r=o.substring(0,a).trim().toLowerCase(),s=o.substring(a+1).trim(),!(!r||t[r]&&UM[r])&&(r==="set-cookie"?t[r]?t[r].push(s):t[r]=[s]:t[r]=t[r]?t[r]+", "+s:s)}),t},r_=Symbol("internals");function th(e){return e&&String(e).trim().toLowerCase()}function jx(e){return e===!1||e==null?e:or.isArray(e)?e.map(jx):String(e)}function WM(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=r.exec(e);)t[s[1]]=s[2];return t}const zM=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function fy(e,t,r,s,a){if(or.isFunction(s))return s.call(this,t,r);if(a&&(t=r),!!or.isString(t)){if(or.isString(s))return t.indexOf(s)!==-1;if(or.isRegExp(s))return s.test(t)}}function qM(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,s)=>r.toUpperCase()+s)}function HM(e,t){const r=or.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+r,{value:function(a,i,o){return this[s].call(this,t,a,i,o)},configurable:!0})})}let Qi=class{constructor(t){t&&this.set(t)}set(t,r,s){const a=this;function i(l,c,d){const u=th(c);if(!u)throw new Error("header name must be a non-empty string");const h=or.findKey(a,u);(!h||a[h]===void 0||d===!0||d===void 0&&a[h]!==!1)&&(a[h||c]=jx(l))}const o=(l,c)=>or.forEach(l,(d,u)=>i(d,u,c));if(or.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(or.isString(t)&&(t=t.trim())&&!zM(t))o($M(t),r);else if(or.isObject(t)&&or.isIterable(t)){let l={},c,d;for(const u of t){if(!or.isArray(u))throw TypeError("Object iterator must return a key-value pair");l[d=u[0]]=(c=l[d])?or.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}o(l,r)}else t!=null&&i(r,t,s);return this}get(t,r){if(t=th(t),t){const s=or.findKey(this,t);if(s){const a=this[s];if(!r)return a;if(r===!0)return WM(a);if(or.isFunction(r))return r.call(this,a,s);if(or.isRegExp(r))return r.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=th(t),t){const s=or.findKey(this,t);return!!(s&&this[s]!==void 0&&(!r||fy(this,this[s],s,r)))}return!1}delete(t,r){const s=this;let a=!1;function i(o){if(o=th(o),o){const l=or.findKey(s,o);l&&(!r||fy(s,s[l],l,r))&&(delete s[l],a=!0)}}return or.isArray(t)?t.forEach(i):i(t),a}clear(t){const r=Object.keys(this);let s=r.length,a=!1;for(;s--;){const i=r[s];(!t||fy(this,this[i],i,t,!0))&&(delete this[i],a=!0)}return a}normalize(t){const r=this,s={};return or.forEach(this,(a,i)=>{const o=or.findKey(s,i);if(o){r[o]=jx(a),delete r[i];return}const l=t?qM(i):String(i).trim();l!==i&&delete r[i],r[l]=jx(a),s[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return or.forEach(this,(s,a)=>{s!=null&&s!==!1&&(r[a]=t&&or.isArray(s)?s.join(", "):s)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const s=new this(t);return r.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[r_]=this[r_]={accessors:{}}).accessors,a=this.prototype;function i(o){const l=th(o);s[l]||(HM(a,o),s[l]=!0)}return or.isArray(t)?t.forEach(i):i(t),this}};Qi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);or.reduceDescriptors(Qi.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[r]=s}}});or.freezeMethods(Qi);function hy(e,t){const r=this||Bp,s=t||r,a=Qi.from(s.headers);let i=s.data;return or.forEach(e,function(l){i=l.call(r,i,a.normalize(),t?t.status:void 0)}),a.normalize(),i}function x6(e){return!!(e&&e.__CANCEL__)}function b0(e,t,r){Tn.call(this,e??"canceled",Tn.ERR_CANCELED,t,r),this.name="CanceledError"}or.inherits(b0,Tn,{__CANCEL__:!0});function g6(e,t,r){const s=r.config.validateStatus;!r.status||!s||s(r.status)?e(r):t(new Tn("Request failed with status code "+r.status,[Tn.ERR_BAD_REQUEST,Tn.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function VM(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function GM(e,t){e=e||10;const r=new Array(e),s=new Array(e);let a=0,i=0,o;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),u=s[i];o||(o=d),r[a]=c,s[a]=d;let h=i,p=0;for(;h!==a;)p+=r[h++],h=h%e;if(a=(a+1)%e,a===i&&(i=(i+1)%e),d-o<t)return;const f=u&&d-u;return f?Math.round(p*1e3/f):void 0}}function QM(e,t){let r=0,s=1e3/t,a,i;const o=(d,u=Date.now())=>{r=u,a=null,i&&(clearTimeout(i),i=null),e(...d)};return[(...d)=>{const u=Date.now(),h=u-r;h>=s?o(d,u):(a=d,i||(i=setTimeout(()=>{i=null,o(a)},s-h)))},()=>a&&o(a)]}const c1=(e,t,r=3)=>{let s=0;const a=GM(50,250);return QM(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,c=o-s,d=a(c),u=o<=l;s=o;const h={loaded:o,total:l,progress:l?o/l:void 0,bytes:c,rate:d||void 0,estimated:d&&l&&u?(l-o)/d:void 0,event:i,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(h)},r)},n_=(e,t)=>{const r=e!=null;return[s=>t[0]({lengthComputable:r,total:e,loaded:s}),t[1]]},s_=e=>(...t)=>or.asap(()=>e(...t)),XM=pi.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,pi.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(pi.origin),pi.navigator&&/(msie|trident)/i.test(pi.navigator.userAgent)):()=>!0,YM=pi.hasStandardBrowserEnv?{write(e,t,r,s,a,i,o){if(typeof document>"u")return;const l=[`${e}=${encodeURIComponent(t)}`];or.isNumber(r)&&l.push(`expires=${new Date(r).toUTCString()}`),or.isString(s)&&l.push(`path=${s}`),or.isString(a)&&l.push(`domain=${a}`),i===!0&&l.push("secure"),or.isString(o)&&l.push(`SameSite=${o}`),document.cookie=l.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function KM(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function JM(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function y6(e,t,r){let s=!KM(t);return e&&(s||r==!1)?JM(e,t):t}const a_=e=>e instanceof Qi?{...e}:e;function yu(e,t){t=t||{};const r={};function s(d,u,h,p){return or.isPlainObject(d)&&or.isPlainObject(u)?or.merge.call({caseless:p},d,u):or.isPlainObject(u)?or.merge({},u):or.isArray(u)?u.slice():u}function a(d,u,h,p){if(or.isUndefined(u)){if(!or.isUndefined(d))return s(void 0,d,h,p)}else return s(d,u,h,p)}function i(d,u){if(!or.isUndefined(u))return s(void 0,u)}function o(d,u){if(or.isUndefined(u)){if(!or.isUndefined(d))return s(void 0,d)}else return s(void 0,u)}function l(d,u,h){if(h in t)return s(d,u);if(h in e)return s(void 0,d)}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(d,u,h)=>a(a_(d),a_(u),h,!0)};return or.forEach(Object.keys({...e,...t}),function(u){const h=c[u]||a,p=h(e[u],t[u],u);or.isUndefined(p)&&h!==l||(r[u]=p)}),r}const b6=e=>{const t=yu({},e);let{data:r,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:i,headers:o,auth:l}=t;if(t.headers=o=Qi.from(o),t.url=h6(y6(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),or.isFormData(r)){if(pi.hasStandardBrowserEnv||pi.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(or.isFunction(r.getHeaders)){const c=r.getHeaders(),d=["content-type","content-length"];Object.entries(c).forEach(([u,h])=>{d.includes(u.toLowerCase())&&o.set(u,h)})}}if(pi.hasStandardBrowserEnv&&(s&&or.isFunction(s)&&(s=s(t)),s||s!==!1&&XM(t.url))){const c=a&&i&&YM.read(i);c&&o.set(a,c)}return t},ZM=typeof XMLHttpRequest<"u",eR=ZM&&function(e){return new Promise(function(r,s){const a=b6(e);let i=a.data;const o=Qi.from(a.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:d}=a,u,h,p,f,x;function g(){f&&f(),x&&x(),a.cancelToken&&a.cancelToken.unsubscribe(u),a.signal&&a.signal.removeEventListener("abort",u)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function m(){if(!y)return;const S=Qi.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),F={data:!l||l==="text"||l==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:S,config:e,request:y};g6(function(C){r(C),g()},function(C){s(C),g()},F),y=null}"onloadend"in y?y.onloadend=m:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(m)},y.onabort=function(){y&&(s(new Tn("Request aborted",Tn.ECONNABORTED,e,y)),y=null)},y.onerror=function(k){const F=k&&k.message?k.message:"Network Error",L=new Tn(F,Tn.ERR_NETWORK,e,y);L.event=k||null,s(L),y=null},y.ontimeout=function(){let k=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const F=a.transitional||p6;a.timeoutErrorMessage&&(k=a.timeoutErrorMessage),s(new Tn(k,F.clarifyTimeoutError?Tn.ETIMEDOUT:Tn.ECONNABORTED,e,y)),y=null},i===void 0&&o.setContentType(null),"setRequestHeader"in y&&or.forEach(o.toJSON(),function(k,F){y.setRequestHeader(F,k)}),or.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),l&&l!=="json"&&(y.responseType=a.responseType),d&&([p,x]=c1(d,!0),y.addEventListener("progress",p)),c&&y.upload&&([h,f]=c1(c),y.upload.addEventListener("progress",h),y.upload.addEventListener("loadend",f)),(a.cancelToken||a.signal)&&(u=S=>{y&&(s(!S||S.type?new b0(null,e,y):S),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(u),a.signal&&(a.signal.aborted?u():a.signal.addEventListener("abort",u)));const w=VM(a.url);if(w&&pi.protocols.indexOf(w)===-1){s(new Tn("Unsupported protocol "+w+":",Tn.ERR_BAD_REQUEST,e));return}y.send(i||null)})},tR=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let s=new AbortController,a;const i=function(d){if(!a){a=!0,l();const u=d instanceof Error?d:this.reason;s.abort(u instanceof Tn?u:new b0(u instanceof Error?u.message:u))}};let o=t&&setTimeout(()=>{o=null,i(new Tn(`timeout ${t} of ms exceeded`,Tn.ETIMEDOUT))},t);const l=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),e=null)};e.forEach(d=>d.addEventListener("abort",i));const{signal:c}=s;return c.unsubscribe=()=>or.asap(l),c}},rR=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let s=0,a;for(;s<r;)a=s+t,yield e.slice(s,a),s=a},nR=async function*(e,t){for await(const r of sR(e))yield*rR(r,t)},sR=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:s}=await t.read();if(r)break;yield s}}finally{await t.cancel()}},i_=(e,t,r,s)=>{const a=nR(e,t);let i=0,o,l=c=>{o||(o=!0,s&&s(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await a.next();if(d){l(),c.close();return}let h=u.byteLength;if(r){let p=i+=h;r(p)}c.enqueue(new Uint8Array(u))}catch(d){throw l(d),d}},cancel(c){return l(c),a.return()}},{highWaterMark:2})},o_=64*1024,{isFunction:Lm}=or,aR=(({Request:e,Response:t})=>({Request:e,Response:t}))(or.global),{ReadableStream:l_,TextEncoder:c_}=or.global,d_=(e,...t)=>{try{return!!e(...t)}catch{return!1}},iR=e=>{e=or.merge.call({skipUndefined:!0},aR,e);const{fetch:t,Request:r,Response:s}=e,a=t?Lm(t):typeof fetch=="function",i=Lm(r),o=Lm(s);if(!a)return!1;const l=a&&Lm(l_),c=a&&(typeof c_=="function"?(x=>g=>x.encode(g))(new c_):async x=>new Uint8Array(await new r(x).arrayBuffer())),d=i&&l&&d_(()=>{let x=!1;const g=new r(pi.origin,{body:new l_,method:"POST",get duplex(){return x=!0,"half"}}).headers.has("Content-Type");return x&&!g}),u=o&&l&&d_(()=>or.isReadableStream(new s("").body)),h={stream:u&&(x=>x.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(x=>{!h[x]&&(h[x]=(g,y)=>{let m=g&&g[x];if(m)return m.call(g);throw new Tn(`Response type '${x}' is not supported`,Tn.ERR_NOT_SUPPORT,y)})});const p=async x=>{if(x==null)return 0;if(or.isBlob(x))return x.size;if(or.isSpecCompliantForm(x))return(await new r(pi.origin,{method:"POST",body:x}).arrayBuffer()).byteLength;if(or.isArrayBufferView(x)||or.isArrayBuffer(x))return x.byteLength;if(or.isURLSearchParams(x)&&(x=x+""),or.isString(x))return(await c(x)).byteLength},f=async(x,g)=>{const y=or.toFiniteNumber(x.getContentLength());return y??p(g)};return async x=>{let{url:g,method:y,data:m,signal:w,cancelToken:S,timeout:k,onDownloadProgress:F,onUploadProgress:L,responseType:C,headers:O,withCredentials:T="same-origin",fetchOptions:W}=b6(x),A=t||fetch;C=C?(C+"").toLowerCase():"text";let N=tR([w,S&&S.toAbortSignal()],k),P=null;const K=N&&N.unsubscribe&&(()=>{N.unsubscribe()});let re;try{if(L&&d&&y!=="get"&&y!=="head"&&(re=await f(O,m))!==0){let fe=new r(g,{method:"POST",body:m,duplex:"half"}),E;if(or.isFormData(m)&&(E=fe.headers.get("content-type"))&&O.setContentType(E),fe.body){const[U,I]=n_(re,c1(s_(L)));m=i_(fe.body,o_,U,I)}}or.isString(T)||(T=T?"include":"omit");const ge=i&&"credentials"in r.prototype,Fe={...W,signal:N,method:y.toUpperCase(),headers:O.normalize().toJSON(),body:m,duplex:"half",credentials:ge?T:void 0};P=i&&new r(g,Fe);let R=await(i?A(P,W):A(g,Fe));const q=u&&(C==="stream"||C==="response");if(u&&(F||q&&K)){const fe={};["status","statusText","headers"].forEach(M=>{fe[M]=R[M]});const E=or.toFiniteNumber(R.headers.get("content-length")),[U,I]=F&&n_(E,c1(s_(F),!0))||[];R=new s(i_(R.body,o_,U,()=>{I&&I(),K&&K()}),fe)}C=C||"text";let me=await h[or.findKey(h,C)||"text"](R,x);return!q&&K&&K(),await new Promise((fe,E)=>{g6(fe,E,{data:me,headers:Qi.from(R.headers),status:R.status,statusText:R.statusText,config:x,request:P})})}catch(ge){throw K&&K(),ge&&ge.name==="TypeError"&&/Load failed|fetch/i.test(ge.message)?Object.assign(new Tn("Network Error",Tn.ERR_NETWORK,x,P),{cause:ge.cause||ge}):Tn.from(ge,ge&&ge.code,x,P)}}},oR=new Map,v6=e=>{let t=e&&e.env||{};const{fetch:r,Request:s,Response:a}=t,i=[s,a,r];let o=i.length,l=o,c,d,u=oR;for(;l--;)c=i[l],d=u.get(c),d===void 0&&u.set(c,d=l?new Map:iR(t)),u=d;return d};v6();const Yv={http:kM,xhr:eR,fetch:{get:v6}};or.forEach(Yv,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const u_=e=>`- ${e}`,lR=e=>or.isFunction(e)||e===null||e===!1;function cR(e,t){e=or.isArray(e)?e:[e];const{length:r}=e;let s,a;const i={};for(let o=0;o<r;o++){s=e[o];let l;if(a=s,!lR(s)&&(a=Yv[(l=String(s)).toLowerCase()],a===void 0))throw new Tn(`Unknown adapter '${l}'`);if(a&&(or.isFunction(a)||(a=a.get(t))))break;i[l||"#"+o]=a}if(!a){const o=Object.entries(i).map(([c,d])=>`adapter ${c} `+(d===!1?"is not supported by the environment":"is not available in the build"));let l=r?o.length>1?`since :
`+o.map(u_).join(`
`):" "+u_(o[0]):"as no adapter specified";throw new Tn("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return a}const w6={getAdapter:cR,adapters:Yv};function py(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new b0(null,e)}function f_(e){return py(e),e.headers=Qi.from(e.headers),e.data=hy.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),w6.getAdapter(e.adapter||Bp.adapter,e)(e).then(function(s){return py(e),s.data=hy.call(e,e.transformResponse,s),s.headers=Qi.from(s.headers),s},function(s){return x6(s)||(py(e),s&&s.response&&(s.response.data=hy.call(e,e.transformResponse,s.response),s.response.headers=Qi.from(s.response.headers))),Promise.reject(s)})}const S6="1.13.2",ng={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{ng[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const h_={};ng.transitional=function(t,r,s){function a(i,o){return"[Axios v"+S6+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,l)=>{if(t===!1)throw new Tn(a(o," has been removed"+(r?" in "+r:"")),Tn.ERR_DEPRECATED);return r&&!h_[o]&&(h_[o]=!0,console.warn(a(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(i,o,l):!0}};ng.spelling=function(t){return(r,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function dR(e,t,r){if(typeof e!="object")throw new Tn("options must be an object",Tn.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let a=s.length;for(;a-- >0;){const i=s[a],o=t[i];if(o){const l=e[i],c=l===void 0||o(l,i,e);if(c!==!0)throw new Tn("option "+i+" must be "+c,Tn.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Tn("Unknown option "+i,Tn.ERR_BAD_OPTION)}}const Nx={assertOptions:dR,validators:ng},Ll=Nx.validators;let iu=class{constructor(t){this.defaults=t||{},this.interceptors={request:new t_,response:new t_}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const i=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=yu(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:i}=r;s!==void 0&&Nx.assertOptions(s,{silentJSONParsing:Ll.transitional(Ll.boolean),forcedJSONParsing:Ll.transitional(Ll.boolean),clarifyTimeoutError:Ll.transitional(Ll.boolean)},!1),a!=null&&(or.isFunction(a)?r.paramsSerializer={serialize:a}:Nx.assertOptions(a,{encode:Ll.function,serialize:Ll.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Nx.assertOptions(r,{baseUrl:Ll.spelling("baseURL"),withXsrfToken:Ll.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=i&&or.merge(i.common,i[r.method]);i&&or.forEach(["delete","get","head","post","put","patch","common"],x=>{delete i[x]}),r.headers=Qi.concat(o,i);const l=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(r)===!1||(c=c&&g.synchronous,l.unshift(g.fulfilled,g.rejected))});const d=[];this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let u,h=0,p;if(!c){const x=[f_.bind(this),void 0];for(x.unshift(...l),x.push(...d),p=x.length,u=Promise.resolve(r);h<p;)u=u.then(x[h++],x[h++]);return u}p=l.length;let f=r;for(;h<p;){const x=l[h++],g=l[h++];try{f=x(f)}catch(y){g.call(this,y);break}}try{u=f_.call(this,f)}catch(x){return Promise.reject(x)}for(h=0,p=d.length;h<p;)u=u.then(d[h++],d[h++]);return u}getUri(t){t=yu(this.defaults,t);const r=y6(t.baseURL,t.url,t.allowAbsoluteUrls);return h6(r,t.params,t.paramsSerializer)}};or.forEach(["delete","get","head","options"],function(t){iu.prototype[t]=function(r,s){return this.request(yu(s||{},{method:t,url:r,data:(s||{}).data}))}});or.forEach(["post","put","patch"],function(t){function r(s){return function(i,o,l){return this.request(yu(l||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}iu.prototype[t]=r(),iu.prototype[t+"Form"]=r(!0)});let uR=class _6{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const s=this;this.promise.then(a=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](a);s._listeners=null}),this.promise.then=a=>{let i;const o=new Promise(l=>{s.subscribe(l),i=l}).then(a);return o.cancel=function(){s.unsubscribe(i)},o},t(function(i,o,l){s.reason||(s.reason=new b0(i,o,l),r(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=s=>{t.abort(s)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new _6(function(a){t=a}),cancel:t}}};function fR(e){return function(r){return e.apply(null,r)}}function hR(e){return or.isObject(e)&&e.isAxiosError===!0}const p2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(p2).forEach(([e,t])=>{p2[t]=e});function k6(e){const t=new iu(e),r=t6(iu.prototype.request,t);return or.extend(r,iu.prototype,t,{allOwnKeys:!0}),or.extend(r,t,null,{allOwnKeys:!0}),r.create=function(a){return k6(yu(e,a))},r}const $s=k6(Bp);$s.Axios=iu;$s.CanceledError=b0;$s.CancelToken=uR;$s.isCancel=x6;$s.VERSION=S6;$s.toFormData=rg;$s.AxiosError=Tn;$s.Cancel=$s.CanceledError;$s.all=function(t){return Promise.all(t)};$s.spread=fR;$s.isAxiosError=hR;$s.mergeConfig=yu;$s.AxiosHeaders=Qi;$s.formToJSON=e=>m6(or.isHTMLForm(e)?new FormData(e):e);$s.getAdapter=w6.getAdapter;$s.HttpStatusCode=p2;$s.default=$s;const{Axios:lZ,AxiosError:cZ,CanceledError:dZ,isCancel:uZ,CancelToken:fZ,VERSION:hZ,all:pZ,Cancel:mZ,isAxiosError:xZ,spread:gZ,toFormData:yZ,AxiosHeaders:m2,HttpStatusCode:bZ,formToJSON:vZ,getAdapter:wZ,mergeConfig:SZ}=$s,j6="https://db.zynix.us/api/accounts/",ml=$s.create({baseURL:j6});let my=!1,x2=[];function pR(e){x2.push(e)}function mR(e){x2.forEach(t=>t(e)),x2=[]}async function xR(){const e=localStorage.getItem("refresh");if(!e)throw new Error("no refresh token");const t=await $s.post(`${j6}token/refresh/`,{refresh:e}),{access:r,refresh:s}=t.data;return r&&localStorage.setItem("access",r),s&&localStorage.setItem("refresh",s),r}ml.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response&&e.response.status===401&&!t._retry){if(t._retry=!0,my)return new Promise(r=>{pR(s=>{const a=t.headers??{};a.Authorization=`Bearer ${s}`,t.headers=new m2(a),r(ml(t))})});my=!0;try{const r=await xR();mR(r);const s=t.headers??{};return s.Authorization=`Bearer ${r}`,t.headers=new m2(s),ml(t)}catch(r){return Kv(),Promise.reject(r)}finally{my=!1}}return Promise.reject(e)});async function N6(e,t){const r=await ml.post("token/",{identifier:e,password:t}),{access:s,refresh:a}=r.data;localStorage.setItem("access",s),localStorage.setItem("refresh",a);try{await Pp()}catch{}return r.data}function Kv(){localStorage.removeItem("access"),localStorage.removeItem("refresh"),localStorage.removeItem("roles"),localStorage.removeItem("permissions")}ml.interceptors.request.use(e=>{const t=localStorage.getItem("access");if(t){const r=e.headers??{};r.Authorization=`Bearer ${t}`,e.headers=new m2(r)}return e});async function Pp(){if(!localStorage.getItem("access"))throw new Error("no access token");const r=(await ml.get("me/")).data;try{localStorage.setItem("roles",JSON.stringify(r.roles||[])),localStorage.setItem("permissions",JSON.stringify(r.permissions||[]))}catch{}return r}const gR=Object.freeze(Object.defineProperty({__proto__:null,apiClient:ml,getMe:Pp,login:N6,logout:Kv},Symbol.toStringTag,{value:"Module"})),yR="/assets/idcs-logo-Ci6ccowJ.png";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A6=(...e)=>e.filter((t,r,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bR=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vR=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,s)=>s?s.toUpperCase():r.toLowerCase());/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_=e=>{const t=vR(e);return t.charAt(0).toUpperCase()+t.slice(1)};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var wR={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SR=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0;return!1};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _R=v.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:a="",children:i,iconNode:o,...l},c)=>v.createElement("svg",{ref:c,...wR,width:t,height:t,stroke:e,strokeWidth:s?Number(r)*24/Number(t):r,className:A6("lucide",a),...!i&&!SR(l)&&{"aria-hidden":"true"},...l},[...o.map(([d,u])=>v.createElement(d,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=(e,t)=>{const r=v.forwardRef(({className:s,...a},i)=>v.createElement(_R,{ref:i,iconNode:t,className:A6(`lucide-${bR(p_(e))}`,`lucide-${e}`,s),...a}));return r.displayName=p_(e),r};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kR=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],jR=bn("bell",kR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NR=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],va=bn("book-open",NR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AR=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],CR=bn("briefcase",AR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ER=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],TR=bn("building-2",ER);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LR=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],FR=bn("building",LR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MR=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],g2=bn("calendar-clock",MR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RR=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ca=bn("calendar",RR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BR=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],PR=bn("chart-column",BR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OR=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],IR=bn("check",OR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DR=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],C6=bn("chevron-down",DR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Wi=bn("circle-alert",UR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $R=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],d1=bn("circle-check-big",$R);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ru=bn("circle-check",WR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zR=[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],qR=bn("circle-user-round",zR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],u1=bn("circle-x",HR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VR=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],f1=bn("clipboard-list",VR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GR=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],mi=bn("clock",GR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QR=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],h1=bn("download",QR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XR=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],YR=bn("eye-off",XR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KR=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],E6=bn("eye",KR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JR=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],ZR=bn("file-spreadsheet",JR);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eB=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],tB=bn("file-text",eB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rB=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],T6=bn("funnel",rB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nB=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],v0=bn("graduation-cap",nB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sB=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],y2=bn("grid-3x3",sB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aB=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],p1=bn("house",aB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iB=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],zi=bn("loader-circle",iB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oB=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Ax=bn("lock-open",oB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lB=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ou=bn("lock",lB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cB=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],dB=bn("log-in",cB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uB=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],fB=bn("log-out",uB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hB=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Jv=bn("mail",hB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pB=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],mB=bn("menu",pB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xB=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],m_=bn("panels-top-left",xB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gB=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],sp=bn("plus",gB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yB=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],L6=bn("refresh-cw",yB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bB=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],kc=bn("save",bB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vB=[["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M18 5v16",key:"1ethyx"}],["path",{d:"m4 6 7.106-3.79a2 2 0 0 1 1.788 0L20 6",key:"zywc2d"}],["path",{d:"m6 11-3.52 2.147a1 1 0 0 0-.48.854V19a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a1 1 0 0 0-.48-.853L18 11",key:"1d4ql0"}],["path",{d:"M6 5v16",key:"1sn0nx"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]],wB=bn("school",vB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SB=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],_B=bn("shield",SB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kB=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],_d=bn("square-pen",kB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jB=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ap=bn("trash-2",jB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NB=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],F6=bn("trending-up",NB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],m1=bn("upload",AB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Cx=bn("user-check",CB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],TB=bn("user-plus",EB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LB=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],FB=bn("user-x",LB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Lu=bn("user",MB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RB=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Qs=bn("users",RB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BB=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Qo=bn("x",BB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PB=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],OB=bn("zoom-in",PB);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IB=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],DB=bn("zoom-out",IB),M6=v.createContext(void 0);function UB({children:e}){const[t,r]=v.useState(()=>typeof window<"u"?window.innerWidth<1024:!0),s=()=>r(a=>!a);return n.jsx(M6.Provider,{value:{collapsed:t,toggle:s,setCollapsed:r},children:e})}function Zv(){const e=v.useContext(M6);if(!e)throw new Error("useSidebar must be used within SidebarProvider");return e}function R6({user:e}){const t=Ri(),s=Ji().pathname==="/login",{collapsed:a,toggle:i}=Zv(),o=()=>{Kv(),t("/login")};return n.jsx("nav",{className:"bg-white shadow-md border-b border-gray-200 fixed top-0 left-0 right-0 z-40 overflow-x-hidden",children:n.jsx("div",{className:"px-4 max-w-full",children:n.jsxs("div",{className:"flex items-center justify-between h-16",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:i,"aria-label":"Toggle sidebar",children:a?n.jsx(mB,{className:"h-6 w-6"}):n.jsx(Qo,{className:"h-6 w-6"})}),n.jsx(sa,{to:"/dashboard",className:"flex items-center gap-3 group",children:n.jsx("img",{src:yR,alt:"IDCS Logo",className:"h-12 w-12 object-contain transition-transform duration-200 group-hover:scale-110",onError:l=>{l.currentTarget.style.display="none"}})})]}),n.jsx("div",{className:"flex items-center gap-3",children:e?n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"hidden sm:block",children:n.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-50 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:n.jsx("span",{className:"text-white font-semibold text-sm",children:e.username.charAt(0).toUpperCase()})}),n.jsx("span",{className:"text-sm font-medium text-gray-700",children:e.username})]})}),n.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg font-medium transition-colors",children:[n.jsx(fB,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]}):s?n.jsxs(sa,{to:"/",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all duration-200 shadow-sm hover:shadow-md transform hover:scale-105",children:[n.jsx(p1,{className:"h-4 w-4"}),n.jsx("span",{children:"Home"})]}):n.jsxs(sa,{to:"/login",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all duration-200 shadow-sm hover:shadow-md transform hover:scale-105",children:[n.jsx(dB,{className:"h-4 w-4"}),n.jsx("span",{children:"Login"})]})})]})})})}const $B="https://db.zynix.us";let xy=!1,rh=null;async function WB(){return xy&&rh||(xy=!0,rh=(async()=>{try{const e=window.localStorage.getItem("refresh");if(!e)throw new Error("no refresh token");const t=await fetch(`${$B}/api/accounts/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:e})});if(!t.ok)throw window.localStorage.removeItem("access"),window.localStorage.removeItem("refresh"),new Error("refresh failed");const r=await t.json();return r.access&&window.localStorage.setItem("access",r.access),r.refresh&&window.localStorage.setItem("refresh",r.refresh),r.access}finally{xy=!1,rh=null}})()),rh}async function hr(e,t={},r=!0){const s=window.localStorage.getItem("access"),a=t.body instanceof FormData,i=Object.assign({},t.headers||{});a||(i["Content-Type"]="application/json"),s?i.Authorization=`Bearer ${s}`:console.warn("No access token found in localStorage");let o=e;try{typeof e=="string"&&e.startsWith("/api")&&(o=`https://db.zynix.us${e}`)}catch{}const l=await fetch(o,{...t,headers:i});if(l.status===400){const c=await l.text();console.error("400 Bad Request:",{url:o,token:s,response:c})}if(l.status!==401||!r)return l;try{const c=await WB(),d=Object.assign({},t.headers||{});return a||(d["Content-Type"]="application/json"),d.Authorization=`Bearer ${c}`,fetch(o,{...t,headers:d})}catch(c){try{window.localStorage.removeItem("access"),window.localStorage.removeItem("refresh")}catch{}console.error("Token refresh failed:",c);try{typeof window<"u"&&setTimeout(()=>{try{window.location.href="/login"}catch{}},50)}catch{}return l}}async function zB(e=""){const r=e?`${e}/api/accounts/dashboard/`:"https://db.zynix.us/api/accounts/dashboard/",s=await hr(r,{method:"GET"});if(!s.ok){const a=await s.text();throw new Error(`Dashboard fetch failed: ${s.status} ${a}`)}return s.json()}function qB(e=""){const[t,r]=v.useState(null),[s,a]=v.useState(!0),[i,o]=v.useState(null),l=v.useCallback(async()=>{a(!0),o(null);try{const c=await zB(e);r(c)}catch(c){o(c)}finally{a(!1)}},[e]);return v.useEffect(()=>{l()},[l]),{data:t,loading:s,error:i,refresh:l}}const HB="modulepreload",VB=function(e){return"/"+e},x_={},Wf=function(t,r,s){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(r.map(c=>{if(c=VB(c),c in x_)return;x_[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":HB,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})};async function wl(){var t;const e=`${sn()}/api/academics/my-teaching-assignments/`;try{return(await ml.get(e)).data}catch(r){if(((t=r==null?void 0:r.response)==null?void 0:t.status)===401)return[];throw r}}function sn(){return"https://db.zynix.us"}function Vn(){const e=window.localStorage.getItem("access");return e?{Authorization:`Bearer ${e}`}:{}}async function ew(e,t,r){const s=`${sn()}/api/obe/iqac/reset/${encodeURIComponent(String(e))}/${encodeURIComponent(String(t))}`;return(await ml.post(s,{teaching_assignment_id:r})).data}async function B6(e){var a;const t=`${sn()}/api/obe/iqac/reset-notifications`,r=e?{teaching_assignment_id:e}:{};return((a=(await ml.get(t,{params:r})).data)==null?void 0:a.notifications)||[]}async function P6(e){const t=`${sn()}/api/obe/iqac/reset-notifications/dismiss`;return(await ml.post(t,{notification_ids:e})).data}async function GB(){try{const e="https://db.zynix.us",t=localStorage.getItem("refresh");if(!t)return null;const r=await $s.post(`${e}/api/accounts/token/refresh/`,{refresh:t}),{access:s,refresh:a}=r.data||{};return s&&localStorage.setItem("access",s),a&&localStorage.setItem("refresh",a),s||null}catch{try{(await Wf(()=>Promise.resolve().then(()=>gR),void 0)).logout()}catch{}return null}}async function Ks(e,t){const r={"Content-Type":"application/json",...(t==null?void 0:t.headers)||{},...Vn()},s={...t||{},headers:r};let a=await fetch(e,s);if(a.status!==401)return a;const i=await GB();if(!i)return a;const o={...s.headers,Authorization:`Bearer ${i}`},l={...s,headers:o};return a=await fetch(e,l),a}async function sg(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/mark-table-lock/${encodeURIComponent(e)}/${encodeURIComponent(t)}${s}`,i=await Ks(a,{method:"GET"});return i.status===401?{assessment:e,subject_code:String(t),teaching_assignment_id:typeof r=="number"?r:null,academic_year:null,section_name:null,exists:!1,is_published:!1,published_blocked:!1,mark_entry_blocked:!1,mark_manager_locked:!1,mark_entry_unblocked_until:null,mark_manager_unlocked_until:null,entry_open:!1,mark_manager_editable:!0,updated_at:null}:(i.ok||await hn(i,"Mark table lock fetch failed"),i.json())}async function QB(e){const t=await zf(e);return Array.isArray(t==null?void 0:t.enabled_assessments)?t.enabled_assessments.map(r=>String(r).trim().toLowerCase()).filter(Boolean):[]}async function zf(e){const t=`${sn()}/api/academics/teaching-assignments/${encodeURIComponent(String(e))}/enabled_assessments/`,r=await Ks(t,{method:"GET"});if(r.status===401||r.status===404)return{enabled_assessments:[],meta:{locked:!1,can_edit:!1}};r.ok||await hn(r,"Failed to fetch enabled assessments");const s=await r.json();return{enabled_assessments:Array.isArray(s==null?void 0:s.enabled_assessments)?s.enabled_assessments.map(a=>String(a).trim().toLowerCase()).filter(Boolean):[],meta:(s==null?void 0:s.meta)||void 0}}async function XB(e,t){const r=`${sn()}/api/academics/teaching-assignments/${encodeURIComponent(String(e))}/enabled_assessments/`,s=await Ks(r,{method:"POST",body:JSON.stringify({enabled_assessments:t})});if(s.status===401)throw new Error("Authentication required");s.ok||await hn(s,"Failed to save enabled assessments");const a=await s.json();return Array.isArray(a==null?void 0:a.enabled_assessments)?a.enabled_assessments:[]}async function O6(e,t){const r=`${sn()}/api/academics/teaching-assignments/${encodeURIComponent(String(e))}/enabled_assessments/`,s=await Ks(r,{method:"POST",body:JSON.stringify({enabled_assessments:t})});if(s.status===401)throw new Error("Authentication required");s.ok||await hn(s,"Failed to save enabled assessments");const a=await s.json();return{enabled_assessments:Array.isArray(a==null?void 0:a.enabled_assessments)?a.enabled_assessments:[],meta:(a==null?void 0:a.meta)||void 0}}async function I6(e){const t=`${sn()}/api/academics/teaching-assignments/${encodeURIComponent(String(e))}/enabled_assessments/request-edit/`,r=await Ks(t,{method:"POST",body:JSON.stringify({})});if(r.status===401)throw new Error("Authentication required");return r.ok||await hn(r,"Failed to request edit approval"),r.json()}async function ag(e,t){const r=t?`?academic_year_id=${encodeURIComponent(String(t))}`:"",s=`${sn()}/api/academics/special-courses/${encodeURIComponent(String(e))}/enabled_assessments/${r}`,a=await Ks(s,{method:"GET"});if(a.status===401)throw new Error("Authentication required");a.ok||await hn(a,"Failed to fetch enabled assessments");const i=await a.json();return(Array.isArray(i==null?void 0:i.enabled_assessments)?i.enabled_assessments:[]).map(l=>String(l).trim().toLowerCase()).filter(Boolean)}async function kd(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/mark-table-lock/${encodeURIComponent(e)}/${encodeURIComponent(t)}/confirm-mark-manager${s}`,i=await Ks(a,{method:"POST",body:JSON.stringify({})});if(i.status===401)throw new Error("Authentication required");return i.ok||await hn(i,"Mark Manager confirm failed"),i.json()}async function D6(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/publish-window/${encodeURIComponent(e)}/${encodeURIComponent(t)}${s}`,i=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return i.status===401?{assessment:e,subject_code:String(t),publish_allowed:!1,allowed_by_due:!1,allowed_by_approval:!1,global_override_active:!1,global_is_open:null,allowed_by_global:null,due_at:null,now:null,remaining_seconds:null,approval_until:null,academic_year:null,teaching_assignment_id:typeof r=="number"?r:null}:(i.ok||await hn(i,"Publish window fetch failed"),i.json())}async function ip(e,t,r,s){const a=[`scope=${encodeURIComponent(String(r))}`];s&&a.push(`teaching_assignment_id=${encodeURIComponent(String(s))}`);const i=a.length?`?${a.join("&")}`:"",o=`${sn()}/api/obe/edit-window/${encodeURIComponent(e)}/${encodeURIComponent(t)}${i}`,l=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return l.status===401?{assessment:e,subject_code:String(t),scope:r,allowed_by_approval:!1,approval_until:null,now:null,academic_year:null,teaching_assignment_id:typeof s=="number"?s:null}:(l.ok||await hn(l,"Edit window fetch failed"),l.json())}async function U6(e,t){const r=[];e!=null&&e.length&&r.push(`semester_ids=${encodeURIComponent(e.join(","))}`),t!=null&&t.length&&r.push(`assessments=${encodeURIComponent(t.join(","))}`);const s=r.length?`?${r.join("&")}`:"",a=`${sn()}/api/obe/global-publish-controls${s}`,i=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return i.ok||await hn(i,"Global publish controls fetch failed"),i.json()}async function b2(e){const t=`${sn()}/api/obe/global-publish-controls/bulk-set`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify(e)});return r.ok||await hn(r,"Bulk set global publish controls failed"),r.json()}async function v2(e){const t=`${sn()}/api/obe/global-publish-controls/bulk-reset`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify(e)});return r.ok||await hn(r,"Bulk reset global publish controls failed"),r.json()}async function $6(){const e=`${sn()}/api/obe/semesters`,t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return t.ok||await hn(t,"Semesters fetch failed"),t.json()}async function YB(e){const t=e!=null&&e.length?`?semester_ids=${encodeURIComponent(e.join(","))}`:"",r=`${sn()}/api/obe/due-schedules${t}`,s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return s.ok||await hn(s,"Due schedules fetch failed"),s.json()}async function W6(e){const t=`?semester_ids=${encodeURIComponent(e.join(","))}`,r=`${sn()}/api/obe/due-schedule-subjects${t}`,s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return s.ok||await hn(s,"Due schedule subjects fetch failed"),s.json()}async function KB(e){const t=`${sn()}/api/obe/due-schedule-upsert`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify(e)});return r.ok||await hn(r,"Due schedule save failed"),r.json()}async function z6(e){const t=`${sn()}/api/obe/due-schedule-bulk-upsert`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify(e)});return r.ok||await hn(r,"Due schedule bulk save failed"),r.json()}function q6(e){if(Array.isArray(e))return{marks:e.map(r=>Number(r)).filter(r=>Number.isFinite(r))};if(e&&typeof e=="object"){const r=(Array.isArray(e.marks)?e.marks:[]).map(o=>Number(o)).filter(o=>Number.isFinite(o)),s=Array.isArray(e.cos)?e.cos:void 0,a=s?s.map(o=>{if(typeof o=="string")return o;const l=Number(o);return Number.isFinite(l)?l:""}):void 0,i={marks:r};return a&&(i.cos=a.filter(o=>o!=="")),i}return{marks:[]}}async function op(e){const t=[];t.push(`class_type=${encodeURIComponent(String(e.class_type||"").trim())}`),e.question_paper_type&&t.push(`question_paper_type=${encodeURIComponent(String(e.question_paper_type||"").trim())}`),t.push(`exam=${encodeURIComponent(String(e.exam||"").trim())}`);const r=t.length?`?${t.join("&")}`:"",s=`${sn()}/api/obe/iqac/qp-pattern${r}`,a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});a.ok||await hn(a,"QP pattern fetch failed");const i=await a.json(),o=q6(i==null?void 0:i.pattern);return{class_type:String((i==null?void 0:i.class_type)||""),question_paper_type:(i==null?void 0:i.question_paper_type)==null?null:String(i.question_paper_type),exam:(()=>{const l=String((i==null?void 0:i.exam)||"CIA").trim().toUpperCase();return l==="MODEL"?"MODEL":l==="CIA1"?"CIA1":l==="CIA2"?"CIA2":"CIA"})(),pattern:o,updated_at:(i==null?void 0:i.updated_at)??null,updated_by:typeof(i==null?void 0:i.updated_by)=="number"?i.updated_by:null}}async function H6(e){var o,l;const t=`${sn()}/api/obe/iqac/qp-pattern/save`,r={class_type:String(e.class_type||"").trim(),question_paper_type:e.question_paper_type?String(e.question_paper_type||"").trim():null,exam:e.exam,pattern:{marks:Array.isArray((o=e.pattern)==null?void 0:o.marks)?e.pattern.marks:[],cos:Array.isArray((l=e.pattern)==null?void 0:l.cos)?e.pattern.cos:void 0}},s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify(r)});s.ok||await hn(s,"QP pattern save failed");const a=await s.json(),i=q6(a==null?void 0:a.pattern);return{class_type:String((a==null?void 0:a.class_type)||""),question_paper_type:(a==null?void 0:a.question_paper_type)==null?null:String(a.question_paper_type),exam:(()=>{const c=String((a==null?void 0:a.exam)||"CIA").trim().toUpperCase();return c==="MODEL"?"MODEL":c==="CIA1"?"CIA1":c==="CIA2"?"CIA2":"CIA"})(),pattern:i,updated_at:(a==null?void 0:a.updated_at)??null,updated_by:typeof(a==null?void 0:a.updated_by)=="number"?a.updated_by:null}}async function JB(e){const t=`${sn()}/api/obe/due-schedule-delete`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify(e)});return r.ok||await hn(r,"Due schedule delete failed"),r.json()}async function w0(e){const t=`${sn()}/api/obe/publish-request`,r=await Ks(t,{method:"POST",body:JSON.stringify(e)});if(r.status===401)throw new Error("Authentication required");return r.ok||await hn(r,"Publish request failed"),r.json()}async function Yi(e){const t=`${sn()}/api/obe/edit-request`,r=await Ks(t,{method:"POST",body:JSON.stringify(e)});if(r.status===401)throw new Error("Authentication required");return r.ok||await hn(r,"Edit request failed"),r.json()}async function lp(e){const t=[];t.push(`assessment=${encodeURIComponent(String(e.assessment))}`),t.push(`subject_code=${encodeURIComponent(String(e.subject_code))}`),t.push(`scope=${encodeURIComponent(String(e.scope))}`),typeof e.teaching_assignment_id=="number"&&t.push(`teaching_assignment_id=${encodeURIComponent(String(e.teaching_assignment_id))}`);const r=t.length?`?${t.join("&")}`:"",s=`${sn()}/api/obe/edit-requests/my-latest${r}`,a=await Ks(s,{method:"GET"});return a.status===401?{result:null}:(a.ok||await hn(a,"My edit request status fetch failed"),a.json())}async function V6(e){const t=e?`?scope=${encodeURIComponent(e)}`:"",r=`${sn()}/api/obe/edit-requests/pending${t}`,s=await Ks(r,{method:"GET"});return s.status===401?{results:[]}:(s.ok||await hn(s,"Pending edit requests fetch failed"),s.json())}async function G6(e){var l;const t=(l=e==null?void 0:e.statuses)!=null&&l.length?e.statuses.join(","):"",r=typeof(e==null?void 0:e.limit)=="number"?e.limit:200,s=[];t&&s.push(`statuses=${encodeURIComponent(t)}`),Number.isFinite(r)&&s.push(`limit=${encodeURIComponent(String(r))}`),e!=null&&e.scope&&s.push(`scope=${encodeURIComponent(e.scope)}`);const a=s.length?`?${s.join("&")}`:"",i=`${sn()}/api/obe/edit-requests/history${a}`,o=await Ks(i,{method:"GET"});return o.status===401?{results:[]}:(o.ok||await hn(o,"Edit requests history fetch failed"),o.json())}async function ig(){const e=`${sn()}/api/obe/iqac/class-type-weights`,t=await Ks(e,{method:"GET"});if(t.status===401)throw new Error("Authentication required to fetch class-type weights");t.ok||await hn(t,"Fetch class-type weights failed");const r=await t.json();return(r==null?void 0:r.results)||{}}async function Q6(e){const t=`${sn()}/api/obe/iqac/internal-mark-mapping/${encodeURIComponent(e)}`,r=await Ks(t,{method:"GET"});if(r.status===401)throw new Error("Authentication required");return r.ok||await hn(r,"Failed to fetch internal mark mapping"),r.json()}async function X6(e,t){const r=`${sn()}/api/obe/iqac/internal-mark-mapping/${encodeURIComponent(e)}/save`,s=await Ks(r,{method:"POST",body:JSON.stringify({mapping:t})});if(s.status===401)throw new Error("Authentication required");return s.ok||await hn(s,"Failed to save internal mark mapping"),s.json()}async function ZB(e){const t=`${sn()}/api/obe/iqac/class-type-weights/save`,r=await Ks(t,{method:"POST",body:JSON.stringify(e)});if(r.status===401)throw new Error("Authentication required");r.ok||await hn(r,"Save class-type weights failed");const s=await r.json();return(s==null?void 0:s.results)||{}}async function eP(e){const t=e?`?scope=${encodeURIComponent(e)}`:"",r=`${sn()}/api/obe/edit-requests/pending-count${t}`,s=await Ks(r,{method:"GET"});return s.status===401?{pending:0}:(s.ok||await hn(s,"Pending edit requests count fetch failed"),s.json())}async function Y6(e,t=120){const r=`${sn()}/api/obe/edit-requests/${encodeURIComponent(String(e))}/approve`,s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({window_minutes:t})});return s.ok||await hn(s,"Approve edit request failed"),s.json()}async function K6(e){const t=`${sn()}/api/obe/edit-requests/${encodeURIComponent(String(e))}/reject`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()}});return r.ok||await hn(r,"Reject edit request failed"),r.json()}async function tP(){const e=`${sn()}/api/obe/publish-requests/pending`,t=await Ks(e,{method:"GET"});return t.status===401?{results:[]}:(t.ok||await hn(t,"Pending requests fetch failed"),t.json())}async function rP(e){var l;const t=(l=e==null?void 0:e.statuses)!=null&&l.length?e.statuses.join(","):"",r=typeof(e==null?void 0:e.limit)=="number"?e.limit:200,s=[];t&&s.push(`statuses=${encodeURIComponent(t)}`),Number.isFinite(r)&&s.push(`limit=${encodeURIComponent(String(r))}`);const a=s.length?`?${s.join("&")}`:"",i=`${sn()}/api/obe/publish-requests/history${a}`,o=await Ks(i,{method:"GET"});return o.status===401?{results:[]}:(o.ok||await hn(o,"History requests fetch failed"),o.json())}async function w2(){const e=`${sn()}/api/obe/publish-requests/pending-count`,t=await Ks(e,{method:"GET"});return t.status===401?{pending:0}:(t.ok||await hn(t,"Pending requests count fetch failed"),t.json())}async function nP(e,t=120){const r=`${sn()}/api/obe/publish-requests/${encodeURIComponent(String(e))}/approve`,s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({window_minutes:t})});return s.ok||await hn(s,"Approve request failed"),s.json()}async function sP(e){const t=`${sn()}/api/obe/publish-requests/${encodeURIComponent(String(e))}/reject`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...Vn()}});return r.ok||await hn(r,"Reject request failed"),r.json()}async function hn(e,t){const r=await e.text();try{const s=String(r??"").replace(/^\uFEFF/,"").trim(),a=JSON.parse(s),i=(a==null?void 0:a.detail)||t,o=Array.isArray(a==null?void 0:a.how_to_fix)?`
How to fix:
- ${a.how_to_fix.join(`
- `)}`:"",l=Array.isArray(a==null?void 0:a.errors)?`
Errors:
- ${a.errors.join(`
- `)}`:"",c=new Error(`${i}${o}${l}`);throw c.status=e.status,c.body=a,c}catch{const s=new Error(`${t}: ${e.status} ${r}`);throw s.status=e.status,s.bodyText=r,s}}async function En(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/draft/${encodeURIComponent(e)}/${encodeURIComponent(t)}${s}`,i=await Ks(a,{method:"GET"});return i.status===401?{subject:{code:String(t),name:""},draft:null,updated_at:null,updated_by:null}:(i.ok||await hn(i,"Draft fetch failed"),i.json())}async function Fs(e,t,r){const s=`${sn()}/api/obe/draft/${encodeURIComponent(e)}/${encodeURIComponent(t)}`,a=await Ks(s,{method:"PUT",body:JSON.stringify({data:r})});if(a.status===401)throw new Error("Authentication required");return a.ok||await hn(a,"Draft save failed"),a.json()}async function S0(e,t){const r=t?`?teaching_assignment_id=${encodeURIComponent(String(t))}`:"",s=`${sn()}/api/obe/ssa1-published/${encodeURIComponent(e)}${r}`,a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return a.ok||await hn(a,"SSA1 published fetch failed"),a.json()}async function J6(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/ssa1-publish/${encodeURIComponent(e)}${s}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:t})});return i.ok||await hn(i,"SSA1 publish failed"),i.json()}async function og(e){const t=`${sn()}/api/obe/review1-published/${encodeURIComponent(e)}`,r=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return r.ok||await hn(r,"Review 1 published fetch failed"),r.json()}async function Z6(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/review1-publish/${encodeURIComponent(e)}${s}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:t})});return i.ok||await hn(i,"Review 1 publish failed"),i.json()}async function Op(e,t){const r=t?`?teaching_assignment_id=${encodeURIComponent(String(t))}`:"",s=`${sn()}/api/obe/ssa2-published/${encodeURIComponent(e)}${r}`,a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return a.ok||await hn(a,"SSA2 published fetch failed"),a.json()}async function eA(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/ssa2-publish/${encodeURIComponent(e)}${s}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:t})});return i.ok||await hn(i,"SSA2 publish failed"),i.json()}async function lg(e){const t=`${sn()}/api/obe/review2-published/${encodeURIComponent(e)}`,r=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return r.ok||await hn(r,"Review 2 published fetch failed"),r.json()}async function tA(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/review2-publish/${encodeURIComponent(e)}${s}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:t})});return i.ok||await hn(i,"Review 2 publish failed"),i.json()}async function cg(e,t){const r=t?`?teaching_assignment_id=${encodeURIComponent(String(t))}`:"",s=`${sn()}/api/obe/formative1-published/${encodeURIComponent(e)}${r}`,a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return a.ok||await hn(a,"Formative1 published fetch failed"),a.json()}async function aP(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/formative1-publish/${encodeURIComponent(e)}${s}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:t})});return i.ok||await hn(i,"Formative1 publish failed"),i.json()}async function bu(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/${encodeURIComponent(e)}-published/${encodeURIComponent(t)}${s}`,i=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return i.ok||await hn(i,`${e} published fetch failed`),i.json()}async function rA(e,t,r,s){const a=s?`?teaching_assignment_id=${encodeURIComponent(String(s))}`:"",i=`${sn()}/api/obe/${encodeURIComponent(e)}-publish/${encodeURIComponent(t)}${a}`,o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:r})});return o.ok||await hn(o,`${e} publish failed`),o.json()}async function wa(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/lab-published-sheet/${encodeURIComponent(e)}/${encodeURIComponent(t)}${s}`,i=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return i.ok||await hn(i,"Lab published sheet fetch failed"),i.json()}async function dg(e,t,r,s){const a=s?`?teaching_assignment_id=${encodeURIComponent(String(s))}`:"",i=`${sn()}/api/obe/lab-publish-sheet/${encodeURIComponent(e)}/${encodeURIComponent(t)}${a}`,o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:r})});return o.ok||await hn(o,"Lab publish failed"),o.json()}async function Ip(e,t){const r=t?`?teaching_assignment_id=${encodeURIComponent(String(t))}`:"",s=`${sn()}/api/obe/cia1-published-sheet/${encodeURIComponent(e)}${r}`,a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return a.ok||await hn(a,"CIA1 published sheet fetch failed"),a.json()}async function iP(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/cia1-publish-sheet/${encodeURIComponent(e)}${s}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:t})});return i.ok||await hn(i,"CIA1 publish failed"),i.json()}async function vu(e,t,r){const s=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",a=`${sn()}/api/obe/${encodeURIComponent(e)}-published-sheet/${encodeURIComponent(t)}${s}`,i=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",...Vn()}});return i.ok||await hn(i,`${e} published sheet fetch failed`),i.json()}async function nA(e,t,r,s){const a=s?`?teaching_assignment_id=${encodeURIComponent(String(s))}`:"",i=`${sn()}/api/obe/${encodeURIComponent(e)}-publish-sheet/${encodeURIComponent(t)}${a}`,o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",...Vn()},body:JSON.stringify({data:r})});return o.ok||await hn(o,`${e} publish failed`),o.json()}async function sA(e,t,r){const s=(c,d=1200)=>{const u=String(c||""),f=u.replace(/<script[\s\S]*?<\/script>/gi," ").replace(/<style[\s\S]*?<\/style>/gi," ").replace(/<[^>]+>/g," ").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/\s+/g," ").trim()||u.replace(/\s+/g," ").trim();return f.length<=d?f:f.slice(0,d)+" (truncated)"},a=r?`?teaching_assignment_id=${encodeURIComponent(String(r))}`:"",i=`${sn()}/api/obe/${encodeURIComponent(e)}-marks/${encodeURIComponent(t)}${a}`,o=window.localStorage.getItem("access"),l=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}}});if(!l.ok){const c=await l.text();try{const d=JSON.parse(c),u=(d==null?void 0:d.detail)||`${e.toUpperCase()} roster fetch failed: ${l.status}`,h=Array.isArray(d==null?void 0:d.how_to_fix)?`
How to fix:
- ${d.how_to_fix.join(`
- `)}`:"";throw new Error(`${u}${h}`)}catch{const d=s(c);throw new Error(`${e.toUpperCase()} roster fetch failed: ${l.status}
${d||"Server returned a non-JSON error response."}`)}}return l.json()}async function oP(e,t){const r=(d,u=1200)=>{const h=String(d||""),x=h.replace(/<script[\s\S]*?<\/script>/gi," ").replace(/<style[\s\S]*?<\/style>/gi," ").replace(/<[^>]+>/g," ").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/\s+/g," ").trim()||h.replace(/\s+/g," ").trim();return x.length<=u?x:x.slice(0,u)+" (truncated)"},a=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:8000":"https://db.zynix.us",i=t?`?teaching_assignment_id=${encodeURIComponent(String(t))}`:"",o=`${a}/api/obe/cia1-marks/${encodeURIComponent(e)}${i}`,l=window.localStorage.getItem("access"),c=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",...l?{Authorization:`Bearer ${l}`}:{}}});if(!c.ok){const d=await c.text();try{const u=JSON.parse(d),h=(u==null?void 0:u.detail)||`CIA1 roster fetch failed: ${c.status}`,p=Array.isArray(u==null?void 0:u.how_to_fix)?`
How to fix:
- ${u.how_to_fix.join(`
- `)}`:"";throw new Error(`${h}${p}`)}catch{const u=r(d);throw new Error(`CIA1 roster fetch failed: ${c.status}
${u||"Server returned a non-JSON error response."}`)}}return c.json()}async function lP(e,t){const r=(d,u=1200)=>{const h=String(d||""),x=h.replace(/<script[\s\S]*?<\/script>/gi," ").replace(/<style[\s\S]*?<\/style>/gi," ").replace(/<[^>]+>/g," ").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/\s+/g," ").trim()||h.replace(/\s+/g," ").trim();return x.length<=u?x:x.slice(0,u)+" (truncated)"},i=`${typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:8000":"https://db.zynix.us"}/api/obe/cia1-marks/${encodeURIComponent(e)}`,o=window.localStorage.getItem("access"),l=await fetch(i,{method:"PUT",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({marks:t})}),c=await l.text();if(!l.ok)try{const d=JSON.parse(c),u=(d==null?void 0:d.detail)||`CIA1 save failed: ${l.status}`,h=Array.isArray(d==null?void 0:d.how_to_fix)?`
How to fix:
- ${d.how_to_fix.join(`
- `)}`:"",p=Array.isArray(d==null?void 0:d.errors)?`
Errors:
- ${d.errors.join(`
- `)}`:"";throw new Error(`${u}${h}${p}`)}catch{const d=r(c);throw new Error(`CIA1 save failed: ${l.status}
${d||"Server returned a non-JSON error response."}`)}return JSON.parse(c)}const g_=Object.freeze(Object.defineProperty({__proto__:null,approveEditRequest:Y6,approvePublishRequest:nP,bulkResetGlobalPublishControls:v2,bulkSetGlobalPublishControls:b2,bulkUpsertDueSchedule:z6,confirmMarkManagerLock:kd,createEditRequest:Yi,createPublishRequest:w0,deleteDueSchedule:JB,dismissResetNotifications:P6,fetchCia1Marks:oP,fetchCiaMarks:sA,fetchClassTypeWeights:ig,fetchDraft:En,fetchDueScheduleSubjects:W6,fetchDueSchedules:YB,fetchEditRequestsHistory:G6,fetchEditWindow:ip,fetchGlobalPublishControls:U6,fetchInternalMarkMapping:Q6,fetchIqacQpPattern:op,fetchMarkTableLockStatus:sg,fetchMyLatestEditRequest:lp,fetchMyTeachingAssignments:wl,fetchObeSemesters:$6,fetchPendingEditRequestCount:eP,fetchPendingEditRequests:V6,fetchPendingPublishRequestCount:w2,fetchPendingPublishRequests:tP,fetchPublishRequestsHistory:rP,fetchPublishWindow:D6,fetchPublishedCia1Sheet:Ip,fetchPublishedCiaSheet:vu,fetchPublishedFormative:bu,fetchPublishedFormative1:cg,fetchPublishedLabSheet:wa,fetchPublishedReview1:og,fetchPublishedReview2:lg,fetchPublishedSsa1:S0,fetchPublishedSsa2:Op,fetchResetNotifications:B6,fetchSpecialCourseEnabledAssessments:ag,fetchTeachingAssignmentEnabledAssessments:QB,fetchTeachingAssignmentEnabledAssessmentsInfo:zf,iqacResetAssessment:ew,publishCia1Sheet:iP,publishCiaSheet:nA,publishFormative:rA,publishFormative1:aP,publishLabSheet:dg,publishReview1:Z6,publishReview2:tA,publishSsa1:J6,publishSsa2:eA,rejectEditRequest:K6,rejectPublishRequest:sP,requestTeachingAssignmentEnabledAssessmentsEdit:I6,saveCia1Marks:lP,saveDraft:Fs,setTeachingAssignmentEnabledAssessments:XB,setTeachingAssignmentEnabledAssessmentsInfo:O6,upsertClassTypeWeights:ZB,upsertDueSchedule:KB,upsertInternalMarkMapping:X6,upsertIqacQpPattern:H6},Symbol.toStringTag,{value:"Module"})),cP={profile:Lu,curriculum_master:va,assigned_subjects:va,department_curriculum:m_,elective_import:m1,student_curriculum_view:y2,home:p1,hod_advisors:Qs,hod_teaching:va,advisor_students:v0,mentor_assign:Qs,timetable_templates:ca,timetable_assignments:ca,student_timetable:ca,staff_timetable:ca,student_attendance:f1,my_mentees:Qs,period_attendance:f1,obe:va,obe_master:va,obe_due_dates:g2,obe_requests:jR,academic_controller:m_};function dP({baseUrl:e=""}){const{data:t,loading:r,error:s}=qB(e),a=Ji(),{collapsed:i,toggle:o}=Zv(),[l,c]=v.useState(0),[d,u]=v.useState({}),p=((t==null?void 0:t.permissions)||[]).map(k=>String(k||"").toLowerCase()).includes("obe.master.manage");if(v.useEffect(()=>{let k=!0;const F=window.localStorage.getItem("access");if(!p||!F)return c(0),()=>{k=!1};(async()=>{try{const C=await w2();if(!k)return;c(Number(C.pending||0))}catch{}})();const L=window.setInterval(()=>{(async()=>{try{const C=await w2();if(!k)return;c(Number(C.pending||0))}catch{}})()},3e4);return()=>{k=!1,window.clearInterval(L)}},[p]),v.useEffect(()=>{a.pathname.startsWith("/academic")&&u(k=>({...k,academic:!0}))},[a.pathname]),v.useEffect(()=>{a.pathname.startsWith("/iqac/academic-controller")&&u(k=>({...k,academic_controller:!0}))},[a.pathname]),r)return n.jsx("aside",{className:`fixed top-16 left-0 h-[calc(100vh-4rem)] bg-white shadow-lg transition-all duration-300 z-30 ${i?"-translate-x-full lg:translate-x-0 lg:w-20":"w-full lg:w-64"}`,children:n.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(s)return n.jsx("aside",{className:`fixed top-16 left-0 h-[calc(100vh-4rem)] bg-white shadow-lg transition-all duration-300 z-30 ${i?"-translate-x-full lg:translate-x-0 lg:w-20":"w-full lg:w-64"}`,children:n.jsx("div",{className:"p-6 text-red-600 text-sm",children:"Error loading sidebar"})});if(!t)return null;const f=t.entry_points||{},x=[],g=(t.permissions||[]).map(k=>(k||"").toString().toLowerCase()),y=(t.roles||[]).map(k=>(k||"").toString().toUpperCase()),m=t.flags||{},w=y.includes("IQAC");return f.curriculum_master&&(g.some(k=>k.includes("curriculum"))||f.curriculum_master)&&x.push({key:"curriculum_master",label:"Curriculum Master",to:"/curriculum/master"}),f.department_curriculum&&(g.some(k=>k.includes("curriculum"))||f.department_curriculum)&&x.push({key:"department_curriculum",label:"Department Curriculum",to:"/curriculum/department"}),g.includes("curriculum.import_elective_choices")&&x.push({key:"elective_import",label:"Elective Import",to:"/curriculum/elective-import"}),f.hod_advisors&&(y.includes("HOD")||g.includes("academics.assign_advisor"))&&x.push({key:"hod_advisors",label:"Advisor Assign",to:"/hod/advisors"}),f.hod_teaching&&(y.includes("ADVISOR")||g.includes("academics.assign_teaching"))&&x.push({key:"hod_teaching",label:"Teaching Assign",to:"/advisor/teaching"}),f.advisor_students&&(y.includes("ADVISOR")||g.includes("academics.view_my_students"))&&x.push({key:"advisor_students",label:"My Students",to:"/advisor/students"}),(y.includes("ADVISOR")||g.includes("academics.assign_mentor"))&&x.push({key:"mentor_assign",label:"Mentor Assign",to:"/advisor/mentor"}),f.student_curriculum_view&&g.some(k=>k.includes("curriculum"))&&x.push({key:"student_curriculum_view",label:"My Curriculum",to:"/curriculum/student"}),(m.can_manage_timetable_templates||g.includes("timetable.manage_templates"))&&f.timetable_templates&&x.push({key:"timetable_templates",label:"IQAC: Timetable Templates",to:"/iqac/timetable"}),(!!m.can_assign_timetable||g.includes("timetable.assign")||y.includes("ADVISOR"))&&f.timetable_assignments&&x.push({key:"timetable_assignments",label:"Timetable Assignments",to:"/advisor/timetable"}),m.can_view_timetable&&m.is_student&&g.includes("timetable.view")&&x.push({key:"student_timetable",label:"My Timetable",to:"/student/timetable"}),m.can_view_timetable&&m.is_staff&&g.includes("timetable.view")&&x.push({key:"staff_timetable",label:"My Timetable (Staff)",to:"/staff/timetable"}),m.is_student&&x.push({key:"student_attendance",label:"My Attendance",to:"/student/attendance"}),m.is_staff&&(g.includes("academics.view_assigned_subjects")||y.includes("HOD"))&&x.push({key:"assigned_subjects",label:"Assigned Subjects",to:"/staff/assigned-subjects"}),m.is_staff&&g.includes("academics.view_mentees")&&x.push({key:"my_mentees",label:"My Mentees",to:"/staff/mentees"}),m.is_staff&&(g.includes("academics.mark_attendance")||y.includes("HOD")||y.includes("ADVISOR"))&&x.push({key:"period_attendance",label:"Mark Attendance",to:"/staff/period-attendance"}),m.is_staff&&(g.includes("analytics.view_all_analytics")||g.includes("analytics.view_department_analytics")||g.includes("analytics.view_class_analytics"))&&x.push({key:"attendance_analytics",label:"Attendance Analytics",to:"/staff/analytics"}),x.unshift({key:"profile",label:"Profile",to:"/profile"}),m.is_staff&&!x.some(k=>k.key==="academic")&&x.push({key:"academic",label:"Academic",to:"/academic"}),w&&!x.some(k=>k.key==="academic_controller")&&x.push({key:"academic_controller",label:"Academic Controller",to:"/iqac/academic-controller"}),p&&!w&&!x.some(k=>k.key==="obe_due_dates")&&x.push({key:"obe_due_dates",label:"OBE: Due Dates",to:"/obe/master/due-dates"}),p&&!x.some(k=>k.key==="obe_requests")&&x.push({key:"obe_requests",label:"OBE: Requests",to:"/obe/master/requests"}),n.jsxs(n.Fragment,{children:[!i&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20 lg:hidden",onClick:o}),n.jsxs("aside",{className:`fixed top-16 left-0 h-[calc(100vh-4rem)] bg-white shadow-lg transition-all duration-300 z-30 overflow-y-auto ${i?"-translate-x-full lg:translate-x-0 lg:w-20":"w-full lg:w-64"}`,children:[n.jsx("div",{className:"hidden"}),n.jsx("nav",{className:"py-6",children:n.jsxs("ul",{className:"space-y-2 px-3",children:[n.jsx("li",{children:n.jsxs(sa,{to:"/dashboard",className:`flex items-center gap-3 px-3 py-3 rounded-lg transition-all duration-200 ${a.pathname==="/dashboard"?"bg-blue-600 text-white shadow-md":"text-gray-700 hover:bg-blue-50 hover:text-blue-600"} ${i?"lg:justify-center lg:px-2":""}`,onClick:()=>{window.innerWidth<1024&&o()},children:[n.jsx(p1,{className:`flex-shrink-0 ${i?"lg:w-5 lg:h-5":"w-6 h-6"}`}),n.jsx("span",{className:`font-medium text-base ${i?"lg:hidden":""}`,children:"Dashboard"})]})}),x.map(k=>{const F=cP[k.key]||Lu,L=a.pathname.startsWith(k.to);return n.jsxs("li",{className:"relative",children:[n.jsxs(sa,{to:k.to,className:`flex items-center gap-3 px-3 py-3 rounded-lg transition-all duration-200 ${L?"bg-blue-600 text-white shadow-md":"text-gray-700 hover:bg-blue-50 hover:text-blue-600"} ${i?"lg:justify-center lg:px-2":""}`,onClick:()=>{window.innerWidth<1024&&o(),k.key==="academic"&&u(C=>({...C,academic:!C.academic})),k.key==="academic_controller"&&u(C=>({...C,academic_controller:!C.academic_controller}))},children:[n.jsx(F,{className:`flex-shrink-0 ${i?"lg:w-5 lg:h-5":"w-6 h-6"}`}),n.jsxs("span",{className:`font-medium text-base ${i?"lg:hidden":""}`,children:[k.label,k.key==="obe_requests"&&l>0?n.jsx("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 text-xs font-medium rounded-full bg-red-600 text-white",children:l}):null]})]}),k.key==="academic"&&p&&d.academic?n.jsxs("ul",{className:"pl-8 mt-1 space-y-1",children:[n.jsx("li",{children:n.jsxs(sa,{to:"/academic?tab=obe_master",className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm ${a.pathname.startsWith("/academic")&&new URLSearchParams(a.search).get("tab")==="obe_master"?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>{window.innerWidth<1024&&o()},children:[n.jsx(va,{className:"w-4 h-4"})," ",n.jsx("span",{children:"OBE Master"})]})}),w?null:n.jsx("li",{children:n.jsxs(sa,{to:"/academic?tab=due_dates",className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm ${a.pathname.startsWith("/academic")&&new URLSearchParams(a.search).get("tab")==="due_dates"?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>{window.innerWidth<1024&&o()},children:[n.jsx(g2,{className:"w-4 h-4"})," ",n.jsx("span",{children:"OBE: Due Dates"})]})})]}):null,k.key==="academic_controller"&&d.academic_controller?n.jsxs("ul",{className:"pl-8 mt-1 space-y-1",children:[n.jsx("li",{children:n.jsxs(sa,{to:"/iqac/academic-controller?tab=dashboard",className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm ${a.pathname.startsWith("/iqac/academic-controller")&&new URLSearchParams(a.search).get("tab")==="dashboard"?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>{window.innerWidth<1024&&o()},children:[n.jsx(p1,{className:"w-4 h-4"})," ",n.jsx("span",{children:"Dashboard"})]})}),n.jsx("li",{children:n.jsxs(sa,{to:"/iqac/academic-controller?tab=qp",className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm ${a.pathname.startsWith("/iqac/academic-controller")&&new URLSearchParams(a.search).get("tab")==="qp"?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>{window.innerWidth<1024&&o()},children:[n.jsx(y2,{className:"w-4 h-4"})," ",n.jsx("span",{children:"QP"})]})}),n.jsx("li",{children:n.jsxs(sa,{to:"/iqac/academic-controller?tab=due_dates",className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm ${a.pathname.startsWith("/iqac/academic-controller")&&new URLSearchParams(a.search).get("tab")==="due_dates"?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>{window.innerWidth<1024&&o()},children:[n.jsx(g2,{className:"w-4 h-4"})," ",n.jsx("span",{children:"OBE Due Dates"})]})}),n.jsx("li",{children:n.jsxs(sa,{to:"/iqac/academic-controller?tab=courses",className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm ${a.pathname.startsWith("/iqac/academic-controller")&&new URLSearchParams(a.search).get("tab")==="courses"?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>{window.innerWidth<1024&&o()},children:[n.jsx(y2,{className:"w-4 h-4"})," ",n.jsx("span",{children:"Courses"})]})})]}):null]},k.key)})]})})]})]})}const uP=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function fP({editingCell:e,periods:t,assignmentMap:r,specialName:s,setSpecialName:a,selectedSpecialId:i,setSelectedSpecialId:o,specialTimetables:l,specialDate:c,setSpecialDate:d,curriculum:u,currentSectionRegulation:h,editingCurriculumId:p,setEditingCurriculumId:f,customSubjectText:x,setCustomSubjectText:g,editingAvailableBatches:y,setEditingAvailableBatches:m,editingBatchId:w,setEditingBatchId:S,isCustomAssignment:k,setIsCustomAssignment:F,customAssignmentText:L,setCustomAssignmentText:C,selectedStaffId:O,setSelectedStaffId:T,staffList:W,sectionId:A,shortLabel:N,loadBatchesForCurriculum:P,handleDeleteSpecialEntry:K,handleDeleteAssignment:re,handleUpdateAssignment:ge,handleAssign:Fe,loadTimetable:R,setShowCellPopup:q,customSubjectOptions:me,setEditingCell:fe,fetchWithAuth:E}){if(!e)return null;const U=e.day,I=e.periodId,M=r[U]&&r[U][I]||[],te=t.find(Q=>Q.id===I)||{};return n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-3 text-white",children:[n.jsx(ca,{className:"h-5 w-5"}),n.jsxs("h3",{className:"text-lg font-semibold",children:["Day ",U,"  ",te.label||`${te.start_time||""} - ${te.end_time||""}`]})]}),n.jsx("button",{onClick:()=>{q(!1),fe(null)},className:"text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-1.5 transition-colors",children:n.jsx(Qo,{className:"h-5 w-5"})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(va,{className:"h-5 w-5 text-indigo-600"}),n.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Existing Assignments"})]}),M.length===0?n.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[n.jsx(Wi,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-500",children:"No assignment yet"})]}):n.jsx("div",{className:"space-y-3",children:M.map(Q=>{var G;return n.jsxs("div",{className:`rounded-lg p-4 border-2 ${Q.is_special?"bg-amber-50 border-amber-200":"bg-blue-50 border-blue-200"}`,children:[n.jsxs("div",{className:"font-bold text-gray-900 flex items-center gap-2",children:[n.jsx(va,{className:"h-4 w-4"}),Q.is_special?Q.timetable_name||"Special":N(Q.curriculum_row||Q.subject_text),Q.is_special&&n.jsxs("span",{className:"text-amber-600 text-sm",children:[" ",N(Q.curriculum_row||Q.subject_text)]})]}),n.jsxs("div",{className:"text-sm text-gray-700 mt-2 flex items-center gap-1",children:[n.jsx(Qs,{className:"h-3.5 w-3.5"}),((G=Q.staff)==null?void 0:G.username)||"",Q.subject_batch?`  Batch: ${Q.subject_batch.name}`:""]}),Q.is_special&&n.jsxs("div",{className:"text-xs text-amber-700 mt-2 flex items-center gap-1",children:[n.jsx(ca,{className:"h-3.5 w-3.5"}),"Date: ",Q.date||"","  ",te.label||`${te.start_time||""}${te.start_time&&te.end_time?" - ":""}${te.end_time||""}`]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[n.jsxs("button",{onClick:async()=>{var he,X;const ne=((he=Q.curriculum_row)==null?void 0:he.id)||null,z=((X=Q.subject_batch)==null?void 0:X.id)||null;if(f(ne),S(z),ne){const H=await P(ne);if(z&&!H.find(oe=>oe.id===z))try{const oe=await E(`/api/academics/subject-batches/${z}/`);if(oe.ok){const D=await oe.json();m(Y=>Y.find(le=>le.id===D.id)?Y:[...Y,D])}}catch(oe){console.error("failed to load existing batch",oe)}}else if(z)try{const H=await E(`/api/academics/subject-batches/${z}/`);if(H.ok){const oe=await H.json();m(D=>D.find(Y=>Y.id===oe.id)?D:[...D,oe])}}catch(H){console.error("failed to load existing batch",H)}},className:"px-3 py-1.5 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-1",children:[n.jsx(_d,{className:"h-3.5 w-3.5"}),"Edit"]}),n.jsxs("button",{onClick:()=>{Q.is_special?K(Q.id):re(Q.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1",children:[n.jsx(ap,{className:"h-3.5 w-3.5"}),"Delete"]}),n.jsxs("button",{onClick:async()=>{if(!p)return alert("Select new subject from right panel then click Update");const ne={};p&&(ne.curriculum_row=p),w!==null&&(ne.subject_batch_id=w),await ge(Q.id,ne)},className:"px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1",children:[n.jsx(kc,{className:"h-3.5 w-3.5"}),"Update"]})]})]},Q.id)})})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(sp,{className:"h-5 w-5 text-green-600"}),n.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Assign / Edit"})]}),n.jsxs("div",{className:"space-y-4 bg-gray-50 rounded-lg p-4 border border-gray-200",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assignment Type"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>{F(!1),C(""),T(null)},className:`px-3 py-2 text-sm rounded-lg border transition-colors ${k?"bg-white text-gray-700 border-gray-300 hover:border-indigo-300":"bg-indigo-600 text-white border-indigo-600"}`,children:"From Curriculum"}),n.jsx("button",{onClick:()=>{F(!0),f(null),S(null),m([])},className:`px-3 py-2 text-sm rounded-lg border transition-colors ${k?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 border-gray-300 hover:border-indigo-300"}`,children:"Custom Subject"})]})]}),k?n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Subject Name"}),n.jsxs("select",{value:L||"",onChange:Q=>C(Q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[n.jsx("option",{value:"",children:"Select custom subject"}),me.map(Q=>n.jsx("option",{value:Q.label,children:Q.label},Q.value))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Staff (optional)"}),n.jsxs("select",{value:O||"",onChange:Q=>T(Number(Q.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[n.jsx("option",{value:"",children:"Select staff (optional)"}),W.map(Q=>n.jsx("option",{value:Q.id,children:(()=>{var he,X,H;const G=((he=Q.user)==null?void 0:he.first_name)||"",ne=((X=Q.user)==null?void 0:X.last_name)||"";return`${G} ${ne}`.trim()||((H=Q.user)==null?void 0:H.username)||Q.staff_id})()},Q.id))]})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Subject"}),n.jsxs("select",{value:p||"",onChange:async Q=>{const G=Number(Q.target.value)||null;f(G),S(null),G?await P(G):m([])},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[n.jsx("option",{value:"",children:"Select subject"}),u.filter(Q=>!(h!=null&&h.code)||Q.regulation===h.code).map(Q=>n.jsxs("option",{value:Q.id,children:[Q.course_code,"  ",Q.course_name]},Q.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Batch (optional)"}),n.jsxs("select",{value:w||"",onChange:Q=>S(Number(Q.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[n.jsx("option",{value:"",children:"Select batch (optional)"}),y.map(Q=>n.jsx("option",{value:Q.id,children:Q.name},Q.id))]})]})]}),n.jsxs("button",{onClick:async()=>{if(k){if(!L.trim())return alert("Subject name is required");await Fe(U,I)}else{if(!p)return alert("Select a subject");await Fe(U,I,p)}q(!1),fe(null)},className:"w-full px-4 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 font-medium",children:[n.jsx(sp,{className:"h-4 w-4"}),"Assign to Period"]})]}),n.jsxs("div",{className:"mt-6 border-t border-gray-200 pt-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[n.jsx(Wi,{className:"h-5 w-5 text-amber-600"}),n.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Mark Special Period"})]}),n.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Create a date-specific override for this period."}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Special timetable"}),n.jsxs("select",{value:i??"",onChange:Q=>o(Q.target.value?Number(Q.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",children:[n.jsx("option",{value:"",children:"Create new"}),l.map(Q=>n.jsxs("option",{value:Q.id,children:[Q.name," ",Q.is_active?"":"(inactive)"]},Q.id))]}),!i&&n.jsx("input",{placeholder:"Name for new special timetable",value:s,onChange:Q=>{Q.preventDefault(),a(Q.target.value)},className:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500"},"special-name-input")]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Date"}),n.jsx("input",{type:"date",value:c||"",onChange:Q=>d(Q.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Subject"}),n.jsxs("select",{value:p??"",onChange:Q=>{const G=Number(Q.target.value)||null;f(G),g(""),S(null),G&&G!==-1&&P(G).catch(console.error)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",children:[n.jsx("option",{value:"",children:"-- choose from section subjects --"}),u.filter(Q=>!(h!=null&&h.code)||Q.regulation===h.code).map(Q=>n.jsxs("option",{value:Q.id,children:[Q.course_code,"  ",Q.course_name]},Q.id)),n.jsx("option",{value:"-1",children:"Custom text"})]}),p===-1&&n.jsxs("select",{value:x||"",onChange:Q=>{Q.preventDefault(),g(Q.target.value)},className:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",children:[n.jsx("option",{value:"",children:"-- choose custom subject --"}),me.map(Q=>n.jsx("option",{value:Q.label,children:Q.label},Q.value))]},"custom-subject-input")]}),y&&y.length>0&&p&&p!==-1&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Batch (optional)"}),n.jsxs("select",{value:w||"",onChange:Q=>S(Number(Q.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",children:[n.jsx("option",{value:"",children:"None"}),y.map(Q=>n.jsx("option",{value:Q.id,children:Q.name},Q.id))]})]}),n.jsxs("button",{onClick:async()=>{if(!c)return alert("Select a date");try{let Q=i;if(!Q){const z=s||`Special - ${c}`,he=await E("/api/timetable/special-timetables/",{method:"POST",body:JSON.stringify({name:z,section:A,is_active:!0})});if(!he.ok){const H=await he.text();return alert("Failed to create special timetable: "+H)}Q=(await he.json()).id}const G={timetable_id:Q,timetable:Q,date:c,period_id:I,period:I};p&&p!==-1&&(G.curriculum_row=p),p===-1&&x&&(G.subject_text=x),w&&(G.subject_batch_id=w);const ne=await E("/api/timetable/special-entries/",{method:"POST",body:JSON.stringify(G)});if(!ne.ok){const z=await ne.text();return alert("Failed to create special entry: "+z)}alert("Special period created"),await R(),q(!1),fe(null)}catch(Q){console.error(Q),alert("Failed to create special entry")}},className:"w-full px-4 py-2.5 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors flex items-center justify-center gap-2 font-medium",children:[n.jsx(Wi,{className:"h-4 w-4"}),"Mark Special Period"]})]})]})]})]})})]})})}function hP(){const[e,t]=v.useState([]),[r,s]=v.useState([]),[a,i]=v.useState([]),[o,l]=v.useState(null),[c,d]=v.useState(null),[u,h]=v.useState(null),[p,f]=v.useState(null),[x,g]=v.useState([]),[y,m]=v.useState([]),[w,S]=v.useState([]),[k,F]=v.useState(null),[L,C]=v.useState(null),[O,T]=v.useState([]),[W,A]=v.useState(null),[N,P]=v.useState(!1),[K,re]=v.useState(new Date().toISOString().slice(0,10)),[ge,Fe]=v.useState([]),[R,q]=v.useState(null),[me,fe]=v.useState(""),[E,U]=v.useState(""),[I,M]=v.useState([]),[te,Q]=v.useState(!1),[G,ne]=v.useState(""),[z,he]=v.useState(null),[X,H]=v.useState([]);v.useEffect(()=>{hr("/api/academics/my-students/").then(ze=>ze.ok?ze.json():[]).then(ze=>{const Ie=(ze.results||[]).map(ot=>({id:ot.section_id,name:ot.section_name,batch:ot.batch,batch_regulation:ot.batch_regulation,department_id:ot.department_id}));t(Ie),!o&&Ie.length>0&&(l(Ie[0].id),d(Ie[0].department_id),h(Ie[0].batch_regulation))}),hr("/api/timetable/templates/").then(ze=>ze.json()).then(ze=>{const Ie=ze||[];s(Ie);const ot=Ie.find(be=>be.is_active)||Ie[0];ot&&(f(ot.id),i(ot.periods||[]))}),hr("/api/academics/custom-subjects/").then(ze=>ze.ok?ze.json():{results:[]}).then(ze=>M(ze.results||[])).catch(ze=>console.error("Failed to load custom subjects",ze))},[]),v.useEffect(()=>{if(o){const ze=e.find(Ie=>Ie.id===o);ze&&h(ze.batch_regulation),hr(`/api/timetable/curriculum-for-section/?section_id=${o}`).then(Ie=>Ie.json()).then(Ie=>g(Ie.results||[])),oe(),hr(`/api/timetable/section/${o}/subjects-staff/`).then(Ie=>Ie.ok?Ie.json():[]).then(Ie=>S(Ie.results||[])),hr(`/api/timetable/special-timetables/?section_id=${o}`).then(Ie=>Ie.ok?Ie.json():[]).then(Ie=>Fe(Ie.results||[])),c&&hr(`/api/academics/advisor-staff/?department=${c}`).then(Ie=>Ie.ok?Ie.json():[]).then(Ie=>H(Ie.results||Ie||[]))}},[o,c]);async function oe(){if(o)try{const ze=await hr(`/api/timetable/section/${o}/timetable/`);if(!ze.ok)return;const Ie=await ze.json();m(Ie.results||[])}catch(ze){console.error("loadTimetable failed",ze)}}const D={};for(const ze of y){const Ie=ze.day;D[Ie]=D[Ie]||{};for(const ot of ze.assignments||[])D[Ie][ot.period_id]=D[Ie][ot.period_id]||[],D[Ie][ot.period_id].push(ot)}function Y(ze){if(!ze)return"";if(typeof ze=="string"){const be=ze.trim();return be.length<=12?be:be.slice(0,12)+""}if(ze.course_code)return ze.course_code;const Ie=ze.course_name||ze.course||ze.subject_text||"",ot=String(Ie).trim();return ot.length<=12?ot:ot.split(" ").map(be=>be[0]).slice(0,3).join("")||ot.slice(0,12)}function le(ze){const Ie=new Date,ot=Ie.getDay(),be=new Date(Ie),we=ot===0?-6:1-ot;be.setDate(Ie.getDate()+we);const Me=new Date(be);return Me.setDate(be.getDate()+(ze-1)),Me.toISOString().slice(0,10)}async function $e(ze,Ie,ot){if(!o)return alert("Section is required");const be={period_id:Ie,day:ze,section_id:o};if(te){if(!G.trim())return alert("Subject name is required");be.subject_text=G.trim(),z&&(be.staff_id=z)}else{if(!ot)return alert("Select a curriculum row first");be.curriculum_row=ot,W&&(be.subject_batch_id=W)}const we=await hr("/api/timetable/assignments/",{method:"POST",body:JSON.stringify(be)});if(!we.ok){const Me=await we.text();return alert("Failed: "+Me)}C(null),T([]),A(null),ne(""),he(null),await oe()}async function je(ze){if(T([]),!ze)return[];try{const Ie=await hr(`/api/academics/subject-batches/?curriculum_row_id=${ze}&page_size=0&include_all=1`);if(Ie.ok){const ot=await Ie.json(),be=ot.results||ot||[];return T(be),be}}catch(Ie){console.error("loadBatches failed",Ie)}return[]}function We(ze,Ie){if(Ie.is_break||Ie.is_lunch)return n.jsx("div",{className:"flex items-center justify-center py-2",children:n.jsx("span",{className:"text-sm text-gray-500 italic",children:Ie.label||(Ie.is_break?"Break":"Lunch")})});const ot=D[ze]&&D[ze][Ie.id];return n.jsx("div",{children:ot&&ot.length?n.jsx("div",{className:"space-y-2",children:ot.map((be,we)=>n.jsxs("div",{className:`rounded-lg p-2.5 cursor-pointer transition-all hover:shadow-md ${be.is_special?"bg-amber-50 border border-amber-200 hover:border-amber-300":"bg-blue-50 border border-blue-200 hover:border-blue-300"}`,onClick:()=>{F({day:ze,periodId:Ie.id}),re(le(ze)),P(!0)},children:[n.jsxs("div",{className:"font-semibold text-gray-900 text-xs leading-tight flex items-center gap-1",children:[n.jsx(va,{className:"h-3 w-3"}),be.is_special?be.timetable_name||"Special":Y(be.curriculum_row||be.subject_text),be.is_special&&n.jsxs("span",{className:"text-amber-600 ml-1",children:[" ",Y(be.curriculum_row||be.subject_text)]})]}),n.jsxs("div",{className:"text-xs text-gray-700 mt-1 flex items-center gap-1",children:[n.jsx(Qs,{className:"h-3 w-3"}),"Staff: ",(()=>{if(!be.staff)return"";const Me=be.staff.first_name||"",Wt=be.staff.last_name||"";return`${Me} ${Wt}`.trim()||be.staff.username||""})(),be.subject_batch?`  Batch: ${be.subject_batch.name}`:""]})]},we))}):n.jsxs("div",{className:"py-4 text-gray-400 text-sm cursor-pointer hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all flex items-center justify-center gap-1",onClick:()=>{F({day:ze,periodId:Ie.id}),re(le(ze)),P(!0)},children:[n.jsx(sp,{className:"h-4 w-4"}),"Click to assign"]})})}async function Ee(ze){if(ze&&confirm("Delete this assignment?"))try{const Ie=await hr(`/api/timetable/assignments/${ze}/`,{method:"DELETE"});if(!Ie.ok){const ot=await Ie.text();return alert("Failed: "+ot)}await oe()}catch(Ie){console.error(Ie),alert("Delete failed")}}async function Re(ze){if(!ze||!confirm("Delete this special period?"))return;let Ie=String(ze);Ie.startsWith("special-")&&(Ie=Ie.replace("special-",""));const ot=Number(Ie);if(!ot)return alert("Invalid special entry id");try{const be=await hr(`/api/timetable/special-entries/${ot}/`,{method:"DELETE"});if(!be.ok){const we=await be.text();return alert("Failed: "+we)}await oe()}catch(be){console.error(be),alert("Delete failed")}}async function Ve(ze,Ie){if(ze)try{const ot=await hr(`/api/timetable/assignments/${ze}/`,{method:"PATCH",body:JSON.stringify(Ie)});if(!ot.ok){const be=await ot.text();return alert("Failed: "+be)}await oe(),P(!1),F(null)}catch(ot){console.error(ot),alert("Update failed")}}const rt=(()=>{if(!(u!=null&&u.code))return[];const ze=x.filter(be=>be.regulation===u.code),Ie=new Map;return w.forEach(be=>{be.id&&be.staff&&Ie.set(be.id,be.staff)}),ze.map(be=>({...be,staff:Ie.get(be.id)||""}))})();return n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-6",children:[n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl",children:n.jsx(ca,{className:"h-7 w-7 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Timetable Editor"}),n.jsx("p",{className:"text-gray-600",children:"Manage class schedules and assignments"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"px-4 py-2 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(v0,{className:"h-4 w-4 text-indigo-600"}),n.jsx("span",{className:"font-semibold text-indigo-900",children:(e.find(ze=>ze.id===o)||{name:"Section"}).name})]})}),u&&n.jsx("div",{className:"px-4 py-2 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-lg border border-emerald-200",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(va,{className:"h-4 w-4 text-emerald-600"}),n.jsxs("span",{className:"font-semibold text-emerald-900",children:["Regulation: ",u.code]})]})}),p&&n.jsx("div",{className:"px-4 py-2 bg-gray-50 rounded-lg border border-gray-200",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(mi,{className:"h-4 w-4 text-gray-600"}),n.jsx("span",{className:"text-sm font-medium text-gray-700",children:(r.find(ze=>ze.id===p)||{name:"Template"}).name})]})})]})]})}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-6 overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(mi,{className:"h-5 w-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Weekly Schedule"})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gradient-to-r from-slate-50 to-blue-50 border-b-2 border-gray-200",children:[n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 min-w-[120px] sticky left-0 bg-gradient-to-r from-slate-50 to-blue-50 z-10",children:"Day / Period"}),a.map(ze=>n.jsxs("th",{className:"px-4 py-3 min-w-[160px]",children:[n.jsx("div",{className:"text-sm font-bold text-indigo-700",children:ze.label||`Period ${ze.index||""}`}),n.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:ze.start_time?`${ze.start_time}${ze.end_time?" - "+ze.end_time:""}`:ze.is_break?"Break":""})]},ze.id))]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:uP.map((ze,Ie)=>n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-4 py-3 font-bold text-gray-900 bg-gray-50 sticky left-0 z-10",children:ze}),a.map(ot=>{const be=k&&k.day===Ie+1&&k.periodId===ot.id;return n.jsx("td",{className:`px-4 py-3 align-top ${be?"bg-indigo-50 border-2 border-indigo-300 shadow-md":""}`,children:We(Ie+1,ot)},ot.id)})]},ze))})]})})]}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Qs,{className:"h-5 w-5 text-indigo-600"}),n.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Subjects & Staff Reference",u&&n.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["(Regulation: ",u.code,")"]})]})]})}),n.jsx("div",{className:"overflow-x-auto max-h-96",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{className:"bg-gray-50 sticky top-0",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Subject"}),n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Staff"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:rt.length===0?n.jsx("tr",{children:n.jsxs("td",{colSpan:2,className:"px-6 py-8 text-center",children:[n.jsx(va,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-500",children:u?`No subjects found for regulation ${u.code}`:"No subjects found"})]})}):rt.map(ze=>n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-6 py-3 text-sm text-gray-900",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(va,{className:"h-4 w-4 text-indigo-600"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium",children:ze.course_code?`${ze.course_code}  ${ze.course_name}`:ze.course_name}),ze.class_type&&n.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[ze.class_type," ",ze.is_elective?" Elective":""]})]})]})}),n.jsx("td",{className:"px-6 py-3 text-sm text-gray-700",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Qs,{className:"h-4 w-4 text-gray-500"}),n.jsx("span",{className:ze.staff===""?"text-gray-400 italic":"",children:ze.staff}),ze.staff===""&&n.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"Not Assigned"})]})})]},String(ze.id)))})]})})]})]}),N?n.jsx(fP,{editingCell:k,periods:a,assignmentMap:D,specialName:me,setSpecialName:fe,selectedSpecialId:R,setSelectedSpecialId:q,specialTimetables:ge,specialDate:K,setSpecialDate:re,curriculum:x,currentSectionRegulation:u,editingCurriculumId:L,setEditingCurriculumId:C,customSubjectText:E,setCustomSubjectText:U,editingAvailableBatches:O,setEditingAvailableBatches:T,editingBatchId:W,setEditingBatchId:A,isCustomAssignment:te,setIsCustomAssignment:Q,customAssignmentText:G,setCustomAssignmentText:ne,selectedStaffId:z,setSelectedStaffId:he,staffList:X,sectionId:o,shortLabel:Y,loadBatchesForCurriculum:je,handleDeleteSpecialEntry:Re,handleDeleteAssignment:Ee,handleUpdateAssignment:Ve,handleAssign:$e,loadTimetable:oe,setShowCellPopup:P,setEditingCell:F,fetchWithAuth:hr,customSubjectOptions:I}):null]})}function pP(){const[e,t]=v.useState([]),[r,s]=v.useState(null),[a,i]=v.useState(!1),[o,l]=v.useState({name:"",description:"",parity:"BOTH",is_public:!1,is_active:!1}),[c,d]=v.useState([]),[u,h]=v.useState({name:"",parity:"ODD",is_active:!1}),[p,f]=v.useState({index:1,start_time:"",end_time:"",is_break:!1,is_lunch:!1,label:""}),[x,g]=v.useState(null),[y,m]=v.useState({});v.useEffect(()=>{w()},[]),v.useEffect(()=>{S()},[]);async function w(){i(!0);try{const A=await hr("/api/timetable/templates/");if(!A.ok)throw new Error(await A.text());const N=await A.json(),P=Array.isArray(N)?N:N.results||N;if(t(P||[]),P&&P.length){const K=P.find(re=>re.is_active)||P[0];s(K);try{const re=K&&K.periods||[],ge=re.length?Math.max(...re.map(Fe=>Number(Fe.index||Fe.position||0))):0;f(Fe=>({...Fe,index:Number(ge)+1}))}catch{}}}catch(A){console.error(A),alert("Failed to load templates")}finally{i(!1)}}async function S(){try{const A=await hr("/api/academics/academic-years/");if(!A.ok)throw new Error(await A.text());const N=await A.json(),P=Array.isArray(N)?N:N.results||N;d(P||[])}catch(A){console.error(A)}}async function k(){try{const A=await hr("/api/academics/academic-years/",{method:"POST",body:JSON.stringify(u)});if(!A.ok)throw new Error(await A.text());await S(),h({name:"",parity:"ODD",is_active:!1})}catch(A){console.error(A),alert("Failed to create academic year: "+String(A))}}async function F(A,N){try{const P=await hr(`/api/academics/academic-years/${A}/`,{method:"PATCH",body:JSON.stringify({is_active:N})});if(!P.ok)throw new Error(await P.text());await S(),await w()}catch(P){console.error(P),alert("Failed to update academic year: "+String(P))}}async function L(){if(!r)return alert("Select a template first");try{const A={...p,template:r.id},N=await hr("/api/timetable/slots/",{method:"POST",body:JSON.stringify(A)});if(!N.ok)throw new Error(await N.text());await w(),f({index:p.index+1,start_time:"",end_time:"",is_break:!1,is_lunch:!1,label:""})}catch(A){console.error(A),alert("Failed to add slot: "+String(A))}}async function C(A){if(confirm("Delete this period?"))try{const N=await hr(`/api/timetable/slots/${A}/`,{method:"DELETE"});if(!N.ok)throw new Error(await N.text());await w()}catch(N){console.error(N),alert("Failed to delete slot: "+String(N))}}function O(A){g(A.id),m({...A})}function T(){g(null),m({})}async function W(){if(!(!x||!y))try{const A=await hr(`/api/timetable/slots/${x}/`,{method:"PATCH",body:JSON.stringify(y)});if(!A.ok)throw new Error(await A.text());await w(),g(null),m({})}catch(A){console.error(A),alert("Failed to update slot: "+String(A))}}return n.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[n.jsx("span",{className:"p-3 bg-indigo-100 rounded-xl",children:n.jsxs("svg",{width:"28",height:"28",fill:"none",viewBox:"0 0 48 48",children:[n.jsx("rect",{width:"48",height:"48",rx:"12",fill:"#e0e7ff"}),n.jsx("path",{d:"M16 24h16M16 32h16M16 16h16",stroke:"#6366f1",strokeWidth:"2",strokeLinecap:"round"})]})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"IQAC  Timetable Templates"}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage timetable templates and periods."})]})]}),a&&n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),"Loading templates..."]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(ca,{className:"w-5 h-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Academic Years"})]}),n.jsxs("div",{className:"space-y-3 mb-6 p-4 bg-gray-50 rounded-lg",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),n.jsx("input",{type:"text",placeholder:"e.g. 2025-26",value:u.name,onChange:A=>h({...u,name:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parity"}),n.jsxs("select",{value:u.parity,onChange:A=>h({...u,parity:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"ODD",children:"Odd"}),n.jsx("option",{value:"EVEN",children:"Even"})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",id:"activate",checked:u.is_active,onChange:A=>h({...u,is_active:A.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"activate",className:"ml-2 text-sm text-gray-700",children:"Activate on create"})]}),n.jsx("button",{onClick:k,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Create Academic Year"})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Existing Years"}),n.jsx("div",{className:"space-y-2",children:c.map(A=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[n.jsx("div",{children:n.jsxs("div",{className:"font-medium text-gray-900",children:[A.name," ",A.parity&&`(${A.parity})`,A.is_active&&n.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full",children:"Active"})]})}),n.jsx("button",{onClick:()=>F(A.id,!A.is_active),className:`px-3 py-1 text-xs font-medium rounded-lg transition-colors ${A.is_active?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:A.is_active?"Deactivate":"Activate"})]},A.id))})]})]})}),n.jsx("div",{className:"lg:col-span-2",children:n.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[n.jsx(mi,{className:"w-5 h-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Template Management"})]}),!r&&n.jsxs("div",{className:"text-center py-12 text-gray-500",children:[n.jsx(mi,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"Select a template to manage its periods."})]}),r&&n.jsxs("div",{children:[n.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("h4",{className:"text-xl font-semibold text-gray-900",children:r.name}),n.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-full",children:r.parity}),r.is_active&&n.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:"Active"})]}),r.description&&n.jsx("p",{className:"text-gray-600",children:r.description})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("h5",{className:"text-lg font-medium text-gray-900 mb-3",children:"Periods"}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full border-collapse border border-gray-200 rounded-lg",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-indigo-50",children:[n.jsx("th",{className:"border border-gray-200 px-4 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider",children:"Label"}),n.jsx("th",{className:"border border-gray-200 px-4 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider",children:"Start Time"}),n.jsx("th",{className:"border border-gray-200 px-4 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider",children:"End Time"}),n.jsx("th",{className:"border border-gray-200 px-4 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider",children:"Type"}),n.jsx("th",{className:"border border-gray-200 px-4 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white",children:(r.periods||[]).map(A=>n.jsx("tr",{className:"hover:bg-gray-50",children:x===A.id?n.jsxs(n.Fragment,{children:[n.jsx("td",{className:"border border-gray-200 px-4 py-3",children:n.jsx("input",{type:"text",value:y.label||"",onChange:N=>m({...y,label:N.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Label"})}),n.jsx("td",{className:"border border-gray-200 px-4 py-3",children:n.jsx("input",{type:"time",value:y.start_time||"",onChange:N=>m({...y,start_time:N.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"border border-gray-200 px-4 py-3",children:n.jsx("input",{type:"time",value:y.end_time||"",onChange:N=>m({...y,end_time:N.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"border border-gray-200 px-4 py-3",children:n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsxs("label",{className:"flex items-center text-xs",children:[n.jsx("input",{type:"checkbox",checked:y.is_break||!1,onChange:N=>m({...y,is_break:N.target.checked,is_lunch:!1}),className:"mr-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),"Break"]}),n.jsxs("label",{className:"flex items-center text-xs",children:[n.jsx("input",{type:"checkbox",checked:y.is_lunch||!1,onChange:N=>m({...y,is_lunch:N.target.checked,is_break:!1}),className:"mr-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),"Lunch"]})]})}),n.jsx("td",{className:"border border-gray-200 px-4 py-3",children:n.jsxs("div",{className:"flex gap-1",children:[n.jsx("button",{onClick:W,className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Save Changes",children:n.jsx(kc,{className:"w-4 h-4"})}),n.jsx("button",{onClick:T,className:"p-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",title:"Cancel Edit",children:n.jsx(Qo,{className:"w-4 h-4"})})]})})]}):n.jsxs(n.Fragment,{children:[n.jsx("td",{className:"border border-gray-200 px-4 py-3 text-sm text-gray-900",children:A.label||""}),n.jsx("td",{className:"border border-gray-200 px-4 py-3 text-sm text-gray-900",children:A.start_time||""}),n.jsx("td",{className:"border border-gray-200 px-4 py-3 text-sm text-gray-900",children:A.end_time||""}),n.jsx("td",{className:"border border-gray-200 px-4 py-3 text-sm",children:A.is_break?n.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full",children:"Break"}):A.is_lunch?n.jsx("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full",children:"Lunch"}):n.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:"Period"})}),n.jsx("td",{className:"border border-gray-200 px-4 py-3",children:n.jsxs("div",{className:"flex gap-1",children:[n.jsx("button",{onClick:()=>O(A),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Period",children:n.jsx(_d,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>C(A.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Period",children:n.jsx(ap,{className:"w-4 h-4"})})]})})]})},A.id))})]})})]}),n.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(sp,{className:"w-5 h-5 text-green-600"}),n.jsx("h5",{className:"text-lg font-medium text-gray-900",children:"Add New Period"})]}),n.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Index"}),n.jsx("input",{type:"number",value:p.index,onChange:A=>f({...p,index:Number(A.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Time"}),n.jsx("input",{type:"time",value:p.start_time,onChange:A=>f({...p,start_time:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Time"}),n.jsx("input",{type:"time",value:p.end_time,onChange:A=>f({...p,end_time:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Label"}),n.jsx("input",{type:"text",placeholder:"Period 1, Break, etc.",value:p.label,onChange:A=>f({...p,label:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[n.jsxs("label",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",checked:p.is_break,onChange:A=>f({...p,is_break:A.target.checked,is_lunch:!1}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Break Period"})]}),n.jsxs("label",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",checked:p.is_lunch,onChange:A=>f({...p,is_lunch:A.target.checked,is_break:!1}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Lunch Period"})]})]}),n.jsxs("button",{onClick:L,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center gap-2",children:[n.jsx(sp,{className:"w-4 h-4"}),"Add Period"]})]})]})]})})]})]})}function aA(){var F,L,C,O,T;const[e,t]=v.useState(!1),[r,s]=v.useState(null),[a,i]=v.useState([]),[o,l]=v.useState([]),[c,d]=v.useState({}),[u,h]=v.useState({}),[p,f]=v.useState(null);async function x(){t(!0),s(null);try{const[W,A]=await Promise.all([V6(),G6({statuses:["APPROVED","REJECTED"],limit:200})]),N=Array.isArray(W==null?void 0:W.results)?W.results:[],P=Array.isArray(A==null?void 0:A.results)?A.results:[];i(N),l(P),d(K=>{const re={...K};for(const ge of N)re[ge.id]==null&&(re[ge.id]=120);return re})}catch(W){s((W==null?void 0:W.message)||"Failed to load requests")}finally{t(!1)}}v.useEffect(()=>{x()},[]);const g=v.useMemo(()=>[...a].sort((W,A)=>String(A.requested_at||"").localeCompare(String(W.requested_at||""))),[a]),y=v.useMemo(()=>[...o].sort((W,A)=>String(A.reviewed_at||A.requested_at||"").localeCompare(String(W.reviewed_at||W.requested_at||""))),[o]);function m(W){const A=String(W||"").trim();if(!A)return"?";const N=A.split(/\s+/g).filter(Boolean);return N.length===1?N[0].slice(0,2).toUpperCase():(N[0][0]+N[N.length-1][0]).toUpperCase()}function w(W){if(!W)return"";const A=new Date(W);return Number.isNaN(A.getTime())?String(W):A.toLocaleString()}async function S(W){const A=Number(c[W]??120);h(N=>({...N,[W]:!0})),s(null);try{await Y6(W,Number.isFinite(A)?A:120),await x()}catch(N){s((N==null?void 0:N.message)||"Approve failed")}finally{h(N=>({...N,[W]:!1}))}}async function k(W){h(A=>({...A,[W]:!0})),s(null);try{await K6(W),await x()}catch(A){s((A==null?void 0:A.message)||"Reject failed")}finally{h(A=>({...A,[W]:!1}))}}return n.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:20},children:[n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:20},children:[n.jsx(mi,{size:24,color:"#9a3412"}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:24,fontWeight:950,color:"#111827"},children:"OBE Edit Requests"}),n.jsx("div",{style:{color:"#6b7280",fontSize:14},children:"Manage pending requests for Mark Entry and Mark Manager edits from faculty"})]}),n.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:n.jsxs("button",{className:"obe-btn obe-btn-secondary",onClick:x,disabled:e,children:[n.jsx(L6,{size:16,style:{marginRight:6}}),e?"Refreshing":"Refresh"]})})]}),r?n.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:12,borderRadius:12,marginBottom:20},children:[n.jsx(u1,{size:16,style:{marginRight:8,verticalAlign:"middle"}}),r]}):null,n.jsxs("div",{style:{display:"grid",gap:18},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontSize:16,fontWeight:950,color:"#111827"},children:"Answered Now"}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["(",g.length,")"]})]}),g.length===0?n.jsxs("div",{style:{textAlign:"center",padding:22,color:"#6b7280",border:"1px dashed #e5e7eb",borderRadius:14,background:"#fff"},children:[n.jsx(d1,{size:34,color:"#10b981",style:{marginBottom:8}}),n.jsx("div",{children:"No pending requests"})]}):n.jsx("div",{style:{display:"grid",gap:10},children:g.map(W=>{var K,re,ge;const A=!!u[W.id],N=String(((K=W.staff)==null?void 0:K.name)||((re=W.staff)==null?void 0:re.username)||"Unknown"),P=(ge=W.staff)==null?void 0:ge.department;return n.jsxs("div",{onClick:()=>f({kind:"pending",item:W}),style:{border:"1px solid #e5e7eb",borderRadius:14,background:"#fff",padding:12,display:"flex",gap:12,alignItems:"center",cursor:"pointer"},children:[n.jsx("div",{style:{width:44,height:44,borderRadius:999,background:"#fff7ed",border:"1px solid #fed7aa",display:"grid",placeItems:"center",fontWeight:950,color:"#9a3412"},children:m(N)}),n.jsxs("div",{style:{flex:1,minWidth:220},children:[n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"baseline"},children:[n.jsx("div",{style:{fontWeight:900,color:"#111827"},children:N}),P?n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[" ",P]}):null]}),n.jsxs("div",{style:{fontSize:13,color:"#374151",fontWeight:700},children:[W.subject_code,"  ",n.jsx("span",{style:{color:"#2563eb",fontWeight:800},children:W.subject_name||W.subject_code})]}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["Mark Manager  ",W.assessment.toUpperCase(),"  ",w(W.requested_at)]})]}),n.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[n.jsxs("div",{style:{background:"#fef3c7",color:"#92400e",padding:"4px 8px",borderRadius:999,fontSize:12,fontWeight:800,whiteSpace:"nowrap"},children:[n.jsx(mi,{size:12,style:{marginRight:4,verticalAlign:"middle"}}),"Pending"]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},onClick:Fe=>Fe.stopPropagation(),children:[n.jsx("input",{type:"number",value:c[W.id]??120,onChange:Fe=>d(R=>({...R,[W.id]:Number(Fe.target.value)})),min:1,max:1440,style:{width:82,padding:"6px 8px",border:"1px solid #d1d5db",borderRadius:10},disabled:A,title:"Window minutes"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>S(W.id),disabled:A,children:A?"Approving":"Approve"}),n.jsx("button",{className:"obe-btn obe-btn-danger",onClick:()=>k(W.id),disabled:A,children:A?"Rejecting":"Reject"})]})]})]},W.id)})})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontSize:16,fontWeight:950,color:"#111827"},children:"History"}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["(",y.length,")"]})]}),y.length===0?n.jsx("div",{style:{textAlign:"center",padding:22,color:"#6b7280",border:"1px dashed #e5e7eb",borderRadius:14,background:"#fff"},children:n.jsx("div",{children:"No reviewed requests yet"})}):n.jsx("div",{style:{display:"grid",gap:10},children:y.map(W=>{var Fe,R,q;const A=String(((Fe=W.staff)==null?void 0:Fe.name)||((R=W.staff)==null?void 0:R.username)||"Unknown"),N=(q=W.staff)==null?void 0:q.department,P=W.status==="APPROVED",K=P?"#ecfdf5":"#fef2f2",re=P?"#065f46":"#991b1b",ge=P?"#10b98133":"#ef444433";return n.jsxs("div",{onClick:()=>f({kind:"history",item:W}),style:{border:"1px solid #e5e7eb",borderRadius:14,background:"#fff",padding:12,display:"flex",gap:12,alignItems:"center",cursor:"pointer"},children:[n.jsx("div",{style:{width:44,height:44,borderRadius:999,background:"#f9fafb",border:"1px solid #e5e7eb",display:"grid",placeItems:"center",fontWeight:950,color:"#111827"},children:m(A)}),n.jsxs("div",{style:{flex:1,minWidth:220},children:[n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"baseline"},children:[n.jsx("div",{style:{fontWeight:900,color:"#111827"},children:A}),N?n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[" ",N]}):null]}),n.jsxs("div",{style:{fontSize:13,color:"#374151",fontWeight:700},children:[W.subject_code,"  ",n.jsx("span",{style:{color:"#2563eb",fontWeight:800},children:W.subject_name||W.subject_code})]}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["Mark Manager  ",W.assessment.toUpperCase(),"  Reviewed ",w(W.reviewed_at)]})]}),n.jsx("div",{style:{display:"flex",gap:10,alignItems:"center"},children:n.jsx("div",{style:{background:K,color:re,border:`1px solid ${ge}`,padding:"4px 10px",borderRadius:999,fontSize:12,fontWeight:900,whiteSpace:"nowrap"},children:P?"Approved":"Rejected"})})]},W.id)})})]})]}),p?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>f(null),children:n.jsxs("div",{style:{width:"min(760px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:16},onClick:W=>W.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,color:"#111827"},children:"Request Details"}),n.jsx("div",{style:{marginLeft:"auto"},children:n.jsx("button",{className:"obe-btn",onClick:()=>f(null),children:"Close"})})]}),n.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#f9fafb"},children:n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"160px 1fr",rowGap:8,columnGap:10,fontSize:13},children:[n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Status"}),n.jsx("div",{style:{color:"#111827",fontWeight:900},children:p.item.status}),n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Staff"}),n.jsxs("div",{style:{color:"#111827",fontWeight:900},children:[String(((F=p.item.staff)==null?void 0:F.name)||((L=p.item.staff)==null?void 0:L.username)||"Unknown"),(C=p.item.staff)!=null&&C.department?n.jsxs("span",{style:{color:"#6b7280",fontWeight:700},children:["  ",p.item.staff.department]}):null]}),n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Subject"}),n.jsxs("div",{style:{color:"#111827"},children:[n.jsx("span",{style:{fontWeight:900},children:p.item.subject_code}),"  ",n.jsx("span",{style:{color:"#2563eb",fontWeight:800},children:p.item.subject_name||p.item.subject_code})]}),n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Assessment"}),n.jsx("div",{style:{color:"#111827",fontWeight:900},children:p.item.assessment.toUpperCase()}),n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Requested At"}),n.jsx("div",{style:{color:"#111827"},children:w(p.item.requested_at)}),n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Reason"}),n.jsx("div",{style:{color:"#111827",whiteSpace:"pre-wrap"},children:p.item.reason||""}),"reviewed_at"in p.item?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Reviewed At"}),n.jsx("div",{style:{color:"#111827"},children:w(p.item.reviewed_at)}),n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Reviewed By"}),n.jsx("div",{style:{color:"#111827"},children:String(((O=p.item.reviewed_by)==null?void 0:O.name)||((T=p.item.reviewed_by)==null?void 0:T.username)||"")}),n.jsx("div",{style:{color:"#6b7280",fontWeight:800},children:"Approved Until"}),n.jsx("div",{style:{color:"#111827"},children:w(p.item.approved_until)})]}):null]})})]})}):null]})}const y_=[1,2,3,4,5,6,7,8],iA=[{key:"cia1",label:"CIA1"},{key:"cia2",label:"CIA2"},{key:"ssa1",label:"SSA1"},{key:"review1",label:"REVIEW1"},{key:"ssa2",label:"SSA2"},{key:"review2",label:"REVIEW2"},{key:"model",label:"MODEL"},{key:"formative1",label:"LAB1 (Formative1)"},{key:"formative2",label:"LAB2 (Formative2)"}],Xu=iA.map(e=>e.key);function mP(e,t){const r=String(e||"").trim(),s=String(t||"").trim();return!r||!s?null:`${r}T${s}:00`}function xP(e,t){if(!e||e.length===0)return"ON";const r=e.filter(s=>s.is_open===!0).length;return e.length===t&&r===t?"OFF":"MIXED"}function tw(){const[e,t]=v.useState([]),[r,s]=v.useState(1),[a,i]=v.useState(["ssa1","cia1"]),[o,l]=v.useState(""),[c,d]=v.useState(""),[u,h]=v.useState({}),[p,f]=v.useState([]),[x,g]=v.useState(!1),[y,m]=v.useState(null),[w,S]=v.useState(null);v.useEffect(()=>{let K=!0;return(async()=>{try{const re=await $6(),ge=Array.isArray(re==null?void 0:re.results)?re.results:[];if(!K)return;const Fe=ge.map(R=>({id:Number(R.id),number:(R==null?void 0:R.number)===null||typeof(R==null?void 0:R.number)>"u"?null:Number(R.number)})).filter(R=>Number.isFinite(R.id));Fe.sort((R,q)=>Number(R.number??9999)-Number(q.number??9999)||R.id-q.id),t(Fe)}catch(re){if(!K)return;S((re==null?void 0:re.message)||"Failed to load semesters")}})(),()=>{K=!1}},[]);const k=v.useMemo(()=>{const K=new Map;for(const re of e){const ge=re.number;typeof ge=="number"&&Number.isFinite(ge)&&K.set(ge,re.id)}return K},[e]),F=k.get(r)??null,L=v.useMemo(()=>{const K=[];for(const re of y_){const ge=k.get(re);ge&&K.push(ge)}return K},[k]),C=v.useCallback(K=>{i(re=>re.includes(K)?re.filter(ge=>ge!==K):[...re,K])},[]),O=v.useCallback(async()=>{g(!0),m(null),S(null);try{if(!F){h({}),f([]),m(`Semester ${r} is not available in the database.`);return}const[K,re]=await Promise.all([W6([F]),U6([F],Xu.map(String))]);h((K==null?void 0:K.subjects_by_semester)||{}),f((re==null?void 0:re.results)||[])}catch(K){S((K==null?void 0:K.message)||"Failed to load semester data")}finally{g(!1)}},[F,r]);v.useEffect(()=>{O()},[O]);const T=v.useMemo(()=>F?((u==null?void 0:u[String(F)])||[]).filter(re=>re&&re.subject_code):[],[u,F]),W=v.useMemo(()=>xP(p,Xu.length),[p]),A=v.useCallback(async K=>{g(!0),m(null),S(null);try{if(!F)throw new Error(`Semester ${r} is not available in the database.`);K?(await v2({semester_ids:[F],assessments:Xu.map(String)}),m(`Semester ${r}: Due Dates ON (deadlines apply)`)):(await b2({semester_ids:[F],assessments:Xu.map(String),is_open:!0}),m(`Semester ${r}: Due Dates OFF (no deadline / no locking)`)),await O()}catch(re){S((re==null?void 0:re.message)||"Semester toggle failed")}finally{g(!1)}},[O,r,F]),N=v.useCallback(async K=>{g(!0),m(null),S(null);try{if(!L.length)throw new Error("No semesters found (18).");K?(await v2({semester_ids:L,assessments:Xu.map(String)}),m("All semesters: Due Dates ON (deadlines apply)")):(await b2({semester_ids:L,assessments:Xu.map(String),is_open:!0}),m("All semesters: Due Dates OFF (no deadline / no locking)")),await O()}catch(re){S((re==null?void 0:re.message)||"Overall toggle failed")}finally{g(!1)}},[L,O]),P=v.useCallback(async()=>{g(!0),m(null),S(null);try{if(!F)throw new Error(`Semester ${r} is not available in the database.`);const K=mP(o,c);if(!K)throw new Error("Select end Due Date and Due Time");if(!a.length)throw new Error("Select at least one Exam/Assessment");const re=Array.from(new Set(T.map(Fe=>String(Fe.subject_code).trim()).filter(Boolean)));if(!re.length)throw new Error(`No courses found for Semester ${r}`);const ge=await z6({semester_id:F,subject_codes:re,assessments:a,due_at:K});m(`Semester ${r}: Saved (${Number((ge==null?void 0:ge.updated)||0)} rows).`)}catch(K){S((K==null?void 0:K.message)||"Save failed")}finally{g(!1)}},[o,c,a,F,r,T]);return n.jsx("main",{style:{padding:0,fontFamily:"Arial, sans-serif",minHeight:"100vh",background:"#fff"},children:n.jsxs("div",{style:{padding:18},children:[n.jsx("div",{className:"welcome",style:{marginBottom:14},children:n.jsx("div",{className:"welcome-left",children:n.jsxs("div",{children:[n.jsx("h2",{className:"welcome-title",style:{fontSize:22,marginBottom:2},children:"OBE Master  Due Dates"}),n.jsx("div",{className:"welcome-sub",children:"Sem 18 slider  exam checkboxes  end date/time  save."})]})})}),w&&n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10,whiteSpace:"pre-wrap"},children:w}),y&&n.jsx("div",{style:{background:"#ecfdf5",border:"1px solid #10b98133",color:"#065f46",padding:10,borderRadius:10,marginBottom:10,whiteSpace:"pre-wrap"},children:y}),n.jsxs("div",{style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:14},children:[n.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Overall Due Dates ON / OFF (All Semesters)"}),n.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("div",{style:{fontSize:13,color:"#374151",fontWeight:700},children:"Semesters: 18"}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[n.jsx("button",{onClick:()=>void N(!0),disabled:x,className:"obe-btn",style:{background:"#10b981",color:"#fff",borderRadius:999,padding:"10px 18px",fontWeight:800},title:"Use due dates (deadlines + locking apply)",children:"ON"}),n.jsx("button",{onClick:()=>void N(!1),disabled:x,className:"obe-btn",style:{background:"#ef4444",color:"#fff",borderRadius:999,padding:"10px 18px",fontWeight:800},title:"No deadlines (locking disabled)",children:"OFF"})]})]}),n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#6b7280"},children:"OFF = global override OPEN. ON = reset overrides (use due dates)."})]}),n.jsxs("div",{style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:14},children:[n.jsx("div",{style:{fontWeight:900,marginBottom:10},children:"Semester Slider"}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs("div",{style:{minWidth:130,fontWeight:900,fontSize:16},children:["SEM ",r]}),n.jsx("input",{type:"range",min:1,max:8,step:1,value:r,onChange:K=>s(Number(K.target.value)),style:{flex:"1 1 320px"}}),n.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:y_.map(K=>n.jsx("button",{className:"obe-btn",disabled:x,onClick:()=>s(K),style:{padding:"6px 10px",borderRadius:999,border:"1px solid #e5e7eb",background:K===r?"#111827":"#fff",color:K===r?"#fff":"#111827",fontWeight:900},children:K},K))})]}),n.jsx("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:"Move slider or click 18 to switch semesters."})]}),n.jsxs("div",{style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,alignItems:"baseline",marginBottom:10},children:[n.jsxs("div",{style:{fontWeight:900,fontSize:16},children:["SEM ",r]}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[T.length," courses"]})]}),n.jsxs("div",{style:{display:"flex",gap:14,flexWrap:"wrap",alignItems:"flex-end"},children:[n.jsxs("div",{style:{minWidth:260,flex:"1 1 360px"},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"Semester Due Dates ON / OFF"}),n.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs("div",{style:{fontSize:13,color:"#374151",fontWeight:900},children:["Status: ",W]}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[n.jsx("button",{onClick:()=>void A(!0),disabled:x,className:"obe-btn",style:{background:"#10b981",color:"#fff",borderRadius:999,padding:"10px 18px",fontWeight:800},children:"ON"}),n.jsx("button",{onClick:()=>void A(!1),disabled:x,className:"obe-btn",style:{background:"#ef4444",color:"#fff",borderRadius:999,padding:"10px 18px",fontWeight:800},children:"OFF"})]})]}),n.jsxs("div",{style:{marginTop:8,fontSize:12,color:"#6b7280"},children:["If OFF: Semester ",r," will ignore due times (publish always allowed)."]})]}),n.jsxs("div",{style:{minWidth:280,flex:"2 1 520px"},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"Exam / Assessment"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:8,maxHeight:160,overflow:"auto",paddingRight:6},children:iA.map(K=>n.jsxs("label",{style:{display:"flex",gap:10,alignItems:"center",fontSize:13},children:[n.jsx("input",{type:"checkbox",checked:a.includes(K.key),onChange:()=>C(K.key)}),n.jsx("span",{style:{fontWeight:800},children:K.label})]},K.key))})]}),n.jsxs("div",{style:{minWidth:260,flex:"1 1 360px"},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"End Date & Time"}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("input",{type:"date",value:o,onChange:K=>l(K.target.value),style:{padding:8,borderRadius:10,border:"1px solid #e5e7eb"}}),n.jsx("input",{type:"time",value:c,onChange:K=>d(K.target.value),style:{padding:8,borderRadius:10,border:"1px solid #e5e7eb"}}),n.jsx("button",{onClick:()=>void P(),disabled:x,className:"obe-btn obe-btn-primary",style:{padding:"10px 16px",borderRadius:10,fontWeight:900},children:x?"Saving":"Save (All Courses in SEM)"})]}),n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#6b7280"},children:"Applies to all courses loaded for the selected semester."})]})]})]})]})})}const Ec="https://db.zynix.us";async function jc(){const e=await hr(`${Ec}/api/curriculum/master/`);if(!e.ok)throw new Error("Failed to fetch masters");return e.json()}async function gP(e){const t=await hr(`${Ec}/api/curriculum/master/`,{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw new Error(await t.text());return t.json()}async function yP(e,t){const r=await hr(`${Ec}/api/curriculum/master/${e}/`,{method:"PATCH",body:JSON.stringify(t)});try{if(!r.ok){const s=r.headers.get("content-type");if(s&&s.includes("application/json")){const a=await r.json();throw new Error(a.detail||"An error occurred")}else throw new Error(await r.text())}return r.json()}catch(s){throw console.error("Error in updateMaster:",s),s}}async function vo(){const e=await hr(`${Ec}/api/curriculum/department/`);if(!e.ok)throw new Error("Failed to fetch dept rows");return e.json()}async function rw(e){const t=await hr(`${Ec}/api/curriculum/department/${encodeURIComponent(String(e))}/`);if(!t.ok)throw new Error("Failed to fetch dept row");return t.json()}async function qf(e){const t=new URLSearchParams;e!=null&&e.department_id&&t.set("department_id",String(e.department_id)),e!=null&&e.regulation&&t.set("regulation",e.regulation),e!=null&&e.semester&&t.set("semester",String(e.semester));const r=`${Ec}/api/curriculum/elective/?${t.toString()}`,s=await hr(r);if(!s.ok)throw new Error("Failed to fetch electives");return s.json()}async function bP(e){const t=await hr(`${Ec}/api/curriculum/elective/`,{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw new Error(await t.text());return t.json()}async function vP(e,t){const r=await hr(`${Ec}/api/curriculum/department/${e}/`,{method:"PATCH",body:JSON.stringify(t)});if(!r.ok)throw new Error(await r.text());return r.json()}async function wP(e,t){const r=await hr(`${Ec}/api/curriculum/department/${e}/approve/`,{method:"POST",body:JSON.stringify({action:t})});if(!r.ok)throw new Error(await r.text());return r.json()}function nh(e){return String(e||"").trim()}function SP(){const e=Ri(),[t,r]=v.useState([]),[s,a]=v.useState(!0),[i,o]=v.useState(null),[l,c]=v.useState("");v.useEffect(()=>{let h=!0;return(async()=>{try{const p=await vo();if(!h)return;r(Array.isArray(p)?p:[]),o(null)}catch(p){if(!h)return;r([]),o((p==null?void 0:p.message)||"Failed to load courses")}finally{h&&a(!1)}})(),()=>{h=!1}},[]);const d=v.useMemo(()=>{const h=new Map;for(const p of t||[]){const f=nh(p.course_code);if(!f)continue;const x={course_code:f,course_name:nh(p.course_name),class_type:nh(p.class_type)||null,question_paper_type:nh(p.question_paper_type)||null},g=h.get(f);if(!g){h.set(f,x);continue}const y=m=>(m.course_name?1:0)+(m.class_type?1:0)+(m.question_paper_type?1:0)+(String(m.question_paper_type||"").trim().toUpperCase()&&String(m.question_paper_type||"").trim().toUpperCase()!=="QP1"?1:0);y(x)>y(g)&&h.set(f,x)}return Array.from(h.values()).sort((p,f)=>p.course_code.localeCompare(f.course_code))},[t]),u=v.useMemo(()=>{const h=nh(l).toLowerCase();return h?d.filter(p=>`${p.course_code} ${p.course_name}`.toLowerCase().includes(h)):d},[d,l]);return s?n.jsx("div",{style:{color:"#6b7280"},children:"Loading courses"}):i?n.jsx("div",{style:{color:"#b91c1c"},children:i}):n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"flex-end",flexWrap:"wrap",marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#0f172a"},children:"Courses"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Search and open a course to view sections and staff mappings."})]}),n.jsxs("div",{style:{minWidth:280},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Search"}),n.jsx("input",{value:l,onChange:h=>c(h.target.value),placeholder:"Course code or name",className:"obe-input"})]})]}),u.length===0?n.jsx("div",{style:{color:"#6b7280"},children:"No courses found."}):n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:12},children:u.map(h=>n.jsxs("div",{className:"obe-card",style:{display:"flex",flexDirection:"column",gap:8},children:[n.jsx("div",{style:{fontWeight:900,color:"#0f172a"},children:h.course_code}),n.jsx("div",{style:{color:"#374151",fontWeight:700},children:h.course_name||""}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[h.class_type?`Class type: ${h.class_type}`:"",h.question_paper_type?`    QP: ${h.question_paper_type}`:""]}),n.jsx("div",{style:{marginTop:6},children:n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:()=>e(`/iqac/academic-controller/course/${encodeURIComponent(h.course_code)}`),children:"Open"})})]},h.course_code))})]})}function _P(){var O;const e=v.useMemo(()=>[{key:"THEORY_QP1",label:"Theory QP 1",class_type:"THEORY",question_paper_type:"QP1"},{key:"THEORY_QP2",label:"Theory QP 2",class_type:"THEORY",question_paper_type:"QP2"},{key:"TCPR",label:"TCPR",class_type:"TCPR"},{key:"TCPL",label:"TCPL",class_type:"TCPL"},{key:"LAB",label:"LAB",class_type:"LAB"}],[]),[t,r]=v.useState(((O=e[0])==null?void 0:O.key)||""),s=v.useMemo(()=>e.find(T=>T.key===t)||null,[e,t]),[a,i]=v.useState("CIA1"),[o,l]=v.useState([]),[c,d]=v.useState(null),[u,h]=v.useState(null),[p,f]=v.useState(!1),[x,g]=v.useState(!1),[y,m]=v.useState(null),w=v.useMemo(()=>{const T=(s==null?void 0:s.class_type)||"THEORY",W=(s==null?void 0:s.question_paper_type)||null;return{class_type:T,question_paper_type:W,exam:a}},[s,a]);v.useEffect(()=>{let T=!1;async function W(){var A,N;d(null),h(null),f(!0),m(null);try{const P=await op(w);if(T)return;const K=Array.isArray((A=P==null?void 0:P.pattern)==null?void 0:A.marks)?P.pattern.marks:[],re=Array.isArray((N=P==null?void 0:P.pattern)==null?void 0:N.cos)?P.pattern.cos:[],ge=K.map((Fe,R)=>({marks:String(Fe),co:re[R]==null?"":String(re[R])}));l(ge),m((P==null?void 0:P.updated_at)??null)}catch(P){if(T)return;h(String((P==null?void 0:P.message)||P||"Failed to load pattern.")),l([])}finally{T||f(!1)}}return W(),()=>{T=!0}},[w]);const S=()=>{l(T=>[...T,{marks:"",co:a==="CIA2"?"3":"1"}])},k=T=>{l(W=>W.filter((A,N)=>N!==T))},F=(T,W)=>{l(A=>{const N=[...A],P=N[T]||{marks:"",co:""};return N[T]={...P,marks:W},N})},L=(T,W)=>{l(A=>{const N=[...A],P=N[T]||{marks:"",co:""};return N[T]={...P,co:W},N})},C=async()=>{d(null),h(null);try{const T=o.map(K=>({marks:String(K.marks??"").trim(),co:String((K==null?void 0:K.co)??"").trim()}));if(T.length&&T.some(K=>!K.marks||!K.co)){h("Enter marks and CO for all rows (or delete empty rows).");return}for(const K of T){const re=Number(K.marks);if(!Number.isFinite(re)||re<0){h("Marks must be a non-negative number.");return}}const W=K=>{const re=String(K||"").trim();if(!re)return"";if(re==="both")return"both";if(re==="1&2")return 12;if(re==="3&4")return 34;const ge=Number(re);return Number.isFinite(ge)?Math.trunc(ge):""};g(!0);const A=T.map(K=>Number(K.marks)),N=T.map(K=>W(K.co)).filter(K=>K!=="");if(N.length!==A.length){h("CO values must be valid for all rows.");return}const P=await H6({class_type:w.class_type,question_paper_type:w.question_paper_type,exam:w.exam,pattern:{marks:A,cos:N}});m((P==null?void 0:P.updated_at)??null),d("Saved.")}catch(T){h((T==null?void 0:T.message)||"Save failed.")}finally{g(!1)}};return n.jsxs("div",{children:[n.jsxs("div",{style:{marginBottom:12},children:[n.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#0f172a"},children:"QP"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Select the QP/class type option."})]}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:e.map(T=>{const W=T.key===t;return n.jsx("button",{onClick:()=>r(T.key),className:W?"obe-btn obe-btn-primary":"obe-btn obe-btn-secondary",type:"button",children:T.label},T.key)})}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:["CIA1","CIA2","MODEL"].map(T=>{const W=a===T;return n.jsx("button",{onClick:()=>i(T),className:W?"obe-btn obe-btn-primary":"obe-btn obe-btn-secondary",type:"button",children:T==="CIA1"?"CIA 1":T==="CIA2"?"CIA 2":"MODEL"},T)})}),s?n.jsxs("div",{className:"obe-card",style:{padding:12},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",fontWeight:800,marginBottom:6},children:"Selected"}),n.jsx("div",{style:{fontWeight:900,color:"#111827"},children:s.label}),n.jsxs("div",{style:{marginTop:6,fontSize:13,color:"#374151"},children:["Class type: ",n.jsx("strong",{children:s.class_type}),s.question_paper_type?n.jsxs(n.Fragment,{children:[" "," QP: ",n.jsx("strong",{children:s.question_paper_type})]}):null," "," Exam: ",n.jsx("strong",{children:a==="CIA1"?"CIA 1":a==="CIA2"?"CIA 2":"MODEL"})]}),p?n.jsx("div",{style:{marginTop:6,fontSize:12,color:"#6b7280"},children:"Loading saved pattern"}):y?n.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#6b7280"},children:["Last saved: ",new Date(y).toLocaleString()]}):null]}):null,n.jsxs("div",{className:"obe-card",style:{padding:12,marginTop:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"baseline",flexWrap:"wrap",marginBottom:10},children:[n.jsx("div",{style:{fontWeight:900,color:"#111827"},children:"QP Pattern"}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[a==="CIA1"?"CIA 1":a==="CIA2"?"CIA 2":"MODEL","  ",(s==null?void 0:s.label)||t]})]}),u?n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10},children:u}):null,c?n.jsx("div",{style:{background:"#ecfdf5",border:"1px solid #10b98133",color:"#065f46",padding:10,borderRadius:10,marginBottom:10},children:c}):null,n.jsx("div",{style:{overflowX:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{textAlign:"left",fontSize:12,color:"#6b7280",padding:"8px 6px",borderBottom:"1px solid #e5e7eb"},children:"S.No"}),n.jsx("th",{style:{textAlign:"left",fontSize:12,color:"#6b7280",padding:"8px 6px",borderBottom:"1px solid #e5e7eb"},children:"Marks"}),n.jsx("th",{style:{textAlign:"left",fontSize:12,color:"#6b7280",padding:"8px 6px",borderBottom:"1px solid #e5e7eb"},children:"CO"}),n.jsx("th",{style:{width:120,borderBottom:"1px solid #e5e7eb"}})]})}),n.jsx("tbody",{children:o.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:4,style:{padding:10,color:"#6b7280"},children:"No questions yet. Click + to add."})}):o.map((T,W)=>n.jsxs("tr",{children:[n.jsx("td",{style:{padding:"8px 6px",borderBottom:"1px solid #f3f4f6",fontWeight:800},children:W+1}),n.jsx("td",{style:{padding:"8px 6px",borderBottom:"1px solid #f3f4f6"},children:n.jsx("input",{className:"obe-input",type:"number",min:0,step:"0.5",value:T.marks,onChange:A=>F(W,A.target.value),placeholder:"Marks",style:{maxWidth:160}})}),n.jsx("td",{style:{padding:"8px 6px",borderBottom:"1px solid #f3f4f6"},children:n.jsxs("select",{className:"obe-input",value:String((T==null?void 0:T.co)??""),onChange:A=>L(W,A.target.value),style:{maxWidth:160},children:[n.jsx("option",{value:"",children:"Select"}),a==="MODEL"?n.jsxs(n.Fragment,{children:[n.jsx("option",{value:"1",children:"1"}),n.jsx("option",{value:"2",children:"2"}),n.jsx("option",{value:"3",children:"3"}),n.jsx("option",{value:"4",children:"4"}),n.jsx("option",{value:"5",children:"5"})]}):a==="CIA2"?n.jsxs(n.Fragment,{children:[n.jsx("option",{value:"3",children:"3"}),n.jsx("option",{value:"4",children:"4"}),n.jsx("option",{value:"3&4",children:"3&4"})]}):n.jsxs(n.Fragment,{children:[n.jsx("option",{value:"1",children:"1"}),n.jsx("option",{value:"2",children:"2"}),n.jsx("option",{value:"1&2",children:"1&2"})]})]})}),n.jsx("td",{style:{padding:"8px 6px",borderBottom:"1px solid #f3f4f6"},children:n.jsx("button",{type:"button",className:"obe-btn obe-btn-danger",onClick:()=>k(W),children:"Delete"})})]},W))})]})}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:12},children:[n.jsx("button",{type:"button",className:"obe-btn obe-btn-secondary",onClick:S,children:"+"}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-primary",onClick:C,disabled:x,children:x?"Saving":"Save"})]})]})]})}const Lf=["Theory","Lab","Tcpl","Tcpr","Practical","Project","Audit","Special"];function On(e){return String(e??"").trim().toUpperCase()}function nw(e){const t=On(e);return t?!!(t==="LAB"||t==="L"||t.startsWith("LAB")||t.includes("LAB")||t.includes("PRACTICAL")||t.includes("PRACT")):!1}function kP(e){return On(e)==="SPECIAL"}function Bn(e){try{const t=window.localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function yn(e,t){try{window.localStorage.setItem(e,JSON.stringify(t))}catch{}}function ol(e){try{window.localStorage.removeItem(e)}catch{}}const Ul=[1.5,3,2.5,1.5,3,2.5,1.5,3,2.5,1.5,3,2.5,2,2,2,2,4],jP=["THEORY","TCPR","TCPL","LAB","AUDIT","PRACTICAL","SPECIAL"],gy={groupHeaders:["CO1","CO2","CO3","CO4","ME"],subHeaders:[["SSA","CIA","FA"],["SSA","CIA","FA"],["SSA","CIA","FA"],["SSA","CIA","FA"],["CO1","CO2","CO3","CO4","CO5"]]},b_=["CO1-SSA","CO1-CIA","CO1-FA","CO2-SSA","CO2-CIA","CO2-FA","CO3-SSA","CO3-CIA","CO3-FA","CO4-SSA","CO4-CIA","CO4-FA","ME-CO1","ME-CO2","ME-CO3","ME-CO4","ME-CO5"],sh=6,v_=64;function w_(e){const t=On(e);return t==="THEORY"?"Theory":t==="TCPL"?"TCPL":t==="TCPR"?"TCPR":t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}function oA(e){const t=Array.isArray(e)?[...e]:[...Ul];for(;t.length<17;)t.push("");return t.slice(0,17)}function S_(e,t,r,s){const a=Number(e),i=Number(t),o=Number(r),l=Number(s),c=(Number.isFinite(i)?i:0)+(Number.isFinite(o)?o:0)+(Number.isFinite(l)?l:0);if(!Number.isFinite(a)||a<=0||!c)return[0,0,0];const d=Math.round(a*(i||0)/c*100)/100,u=Math.round(a*(o||0)/c*100)/100,h=Math.round(a*(l||0)/c*100)/100;return[d,u,h]}function yy(e,t){let r=Array.isArray(e)?[...e]:[...Ul];if(r.length===13){const[s,a,i]=S_(r[0]??0,(t==null?void 0:t.ssa1)??1.5,(t==null?void 0:t.cia1)??3,(t==null?void 0:t.formative1)??2.5),[o,l,c]=S_(r[1]??0,(t==null?void 0:t.ssa1)??1.5,(t==null?void 0:t.cia1)??3,(t==null?void 0:t.formative1)??2.5);r=[s,a,i,o,l,c,...r.slice(2)]}return r=oA(r),r}function by(e){const t={};for(const r of["THEORY","TCPR","TCPL"])t[r]=new Array(17).fill(!1);return t}function NP(){const[e,t]=v.useState({}),[r,s]=v.useState(!1),[a,i]=v.useState(!1),[o,l]=v.useState(null),[c,d]=v.useState(null),[u,h]=v.useState({});v.useEffect(()=>{s(!0),l(null),(async()=>{const y=()=>{const w={};for(const S of Lf){const k=On(String(S));let F=1.5,L=3,C=2.5;k==="TCPL"?(F=1,L=3.25,C=3.5):k==="TCPR"?(F=1,L=3.25,C=4):k==="LAB"&&(F=1,L=1,C=1);let O=[...Ul];if(k==="THEORY")O=[...Ul];else if(k==="TCPL"){O=[];for(let T=0;T<4;T++)O.push(F,L,C);O.push(3,3,3,3,7)}else if(k==="TCPR"){O=[];for(let T=0;T<4;T++)O.push(F,L,C);O.push(3,3,3,3,10)}w[k]={ssa1:F,cia1:L,formative1:C,internal_mark_weights:O}}return w.THEORY||(w.THEORY={ssa1:1.5,cia1:3,formative1:2.5,internal_mark_weights:[...Ul]}),w},m=w=>{const S=y();if(!w||typeof w!="object")return S;const k={...S},F=Array.from(new Set([...Lf.map(C=>On(String(C))),"THEORY"])),L=w.THEORY??w.Theory??w.theory??null;L&&typeof L=="object"&&(w.THEORY=L);for(const C of F){const O=w[C]??w[String(C)]??w[String(C).toUpperCase()]??null;if(!O||typeof O!="object")continue;const T=Array.isArray(O.internal_mark_weights)?O.internal_mark_weights:null,W={ssa1:O.ssa1??k[C].ssa1,cia1:O.cia1??k[C].cia1,formative1:O.formative1??k[C].formative1};k[C]={ssa1:W.ssa1,cia1:W.cia1,formative1:W.formative1,internal_mark_weights:yy(T&&T.length?T:k[C].internal_mark_weights,W)}}return k};try{const S=await(await Wf(()=>Promise.resolve().then(()=>g_),void 0)).fetchClassTypeWeights(),k=m(S);t(k),h(by(k));return}catch{}try{const w=Bn("iqac_class_type_weights"),S=m(w);t(S),h(by(S))}catch{const w=y();t(w),h(by())}finally{s(!1)}})().finally(()=>s(!1))},[]);const p=(y,m,w)=>{t(S=>({...S,[y]:{...S[y],[m]:w}}))},f=(y,m,w)=>{t(S=>{const k=S[y]||{ssa1:"",cia1:"",formative1:"",internal_mark_weights:[...Ul]},F=Array.isArray(k.internal_mark_weights)?[...k.internal_mark_weights]:[...Ul];for(;F.length<17;)F.push("");return F[m]=w,{...S,[y]:{...k,internal_mark_weights:F}}})},x=(y,m,w)=>{h(S=>{const k=Array.isArray(S[y])?[...S[y]]:new Array(17).fill(!0);for(;k.length<17;)k.push(!0);return k[m]=w,{...S,[y]:k.slice(0,17)}})},g=async()=>{i(!0),l(null),d(null);try{const y={},m=Array.from(new Set([...Lf.map(S=>On(String(S))),"THEORY"]));for(const S of m){const k=e[S]??e[S.toLowerCase()]??e[S.toUpperCase()]??{},F=yy(Array.isArray(k==null?void 0:k.internal_mark_weights)?k.internal_mark_weights:Ul,{ssa1:k==null?void 0:k.ssa1,cia1:k==null?void 0:k.cia1,formative1:k==null?void 0:k.formative1});y[S]={ssa1:Number(k==null?void 0:k.ssa1)||0,cia1:Number(k==null?void 0:k.cia1)||0,formative1:Number(k==null?void 0:k.formative1)||0,internal_mark_weights:oA(F).map((L,C)=>{const O=Number(L);return Number.isFinite(O)?O:Ul[C]??0})}}y.THEORY||(y.THEORY=y.THEORY||null);let w=!1;try{await(await Wf(()=>Promise.resolve().then(()=>g_),void 0)).upsertClassTypeWeights(y),w=!0}catch{yn("iqac_class_type_weights",y)}t(y),d(w?"Weights saved to server successfully.":"Saved locally (backend not reachable).")}catch(y){l((y==null?void 0:y.message)||"Failed to save weights")}finally{i(!1)}};return n.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:24},children:[n.jsx("h2",{children:"Class Type Weights"}),n.jsx("p",{children:"Set the weights for each class type. These weights are IQAC-controlled and are not editable by staff."}),r?n.jsx("div",{children:"Loading..."}):n.jsxs("form",{onSubmit:y=>{y.preventDefault(),g()},children:[n.jsxs("div",{style:{marginBottom:16},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"CO Attainment Weights"}),n.jsx("div",{style:{color:"#6b7280",fontSize:13},children:"Used in CO Attainment (SSA/CIA/Formative blend)."})]}),n.jsx("div",{style:{overflowX:"auto",marginBottom:24},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{border:"1px solid #ccc",padding:8},children:"Class Type"}),n.jsx("th",{style:{border:"1px solid #ccc",padding:8},children:"SSA1"}),n.jsx("th",{style:{border:"1px solid #ccc",padding:8},children:"CIA1"}),n.jsx("th",{style:{border:"1px solid #ccc",padding:8},children:"Formative1"})]})}),n.jsx("tbody",{children:Lf.map(y=>{var S,k,F;const m=On(String(y)),w=String(y).charAt(0).toUpperCase()+String(y).slice(1);return n.jsxs("tr",{children:[n.jsx("td",{style:{border:"1px solid #ccc",padding:8},children:w}),n.jsx("td",{style:{border:"1px solid #ccc",padding:8},children:n.jsx("input",{type:"number",step:"0.1",value:((S=e[m])==null?void 0:S.ssa1)??"",onChange:L=>p(m,"ssa1",L.target.value),required:!0})}),n.jsx("td",{style:{border:"1px solid #ccc",padding:8},children:n.jsx("input",{type:"number",step:"0.1",value:((k=e[m])==null?void 0:k.cia1)??"",onChange:L=>p(m,"cia1",L.target.value),required:!0})}),n.jsx("td",{style:{border:"1px solid #ccc",padding:8},children:n.jsx("input",{type:"number",step:"0.1",value:((F=e[m])==null?void 0:F.formative1)??"",onChange:L=>p(m,"formative1",L.target.value),required:!0})})]},m)})})]})}),n.jsxs("div",{style:{marginBottom:16},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Internal Mark Weightage"}),n.jsx("div",{style:{color:"#6b7280",fontSize:13},children:"This 17-value row controls the INTERNAL MARK table calculation by class type."})]}),n.jsx("div",{style:{marginBottom:24},children:jP.map(y=>{const m=On(String(y)),w=e[m],S=yy(Array.isArray(w==null?void 0:w.internal_mark_weights)?w.internal_mark_weights:Ul,w);if(m==="THEORY"||m==="TCPR"||m==="TCPL"){const F=Array.isArray(u[m])?u[m]:new Array(17).fill(!0),L=O=>({width:v_,opacity:O?1:.45,pointerEvents:O?"auto":"none"}),C=[[0,1,2],[3,4,5],[6,7,8],[9,10,11],[12,13,14,15,16]];return n.jsxs("div",{style:{marginBottom:18,overflowX:"auto"},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:8},children:w_(m)}),n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:gy.groupHeaders.map((O,T)=>n.jsx("th",{colSpan:gy.subHeaders[T].length,style:{border:"1px solid #ccc",padding:sh,textAlign:"center",whiteSpace:"nowrap",fontSize:13},children:O},O))}),n.jsx("tr",{children:gy.subHeaders.flat().map((O,T)=>{const W=!!(F[T]??!0);return n.jsx("th",{style:{border:"1px solid #ccc",padding:sh,textAlign:"center",whiteSpace:"nowrap",fontSize:12},children:n.jsxs("label",{style:{display:"inline-flex",gap:6,alignItems:"center",userSelect:"none"},children:[n.jsx("input",{type:"checkbox",checked:W,onChange:A=>x(m,T,A.target.checked),style:{transform:"scale(0.9)"}}),O]})},`${O}_${T}`)})})]}),n.jsx("tbody",{children:n.jsx("tr",{children:C.flat().map(O=>{const T=!!(F[O]??!0);return n.jsx("td",{style:{border:"1px solid #ccc",padding:sh,textAlign:"center"},children:n.jsx("input",{type:"number",step:"0.1",value:S[O]??"",onChange:W=>f(m,O,W.target.value),disabled:!T,style:L(T)})},O)})})})]})]},m)}return n.jsxs("div",{style:{marginBottom:18,overflowX:"auto"},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:8},children:w_(m)}),n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsx("tr",{children:b_.map(F=>n.jsx("th",{style:{border:"1px solid #ccc",padding:sh,whiteSpace:"nowrap",fontSize:12},children:F},F))})}),n.jsx("tbody",{children:n.jsx("tr",{children:b_.map((F,L)=>n.jsx("td",{style:{border:"1px solid #ccc",padding:sh},children:n.jsx("input",{type:"number",step:"0.1",value:S[L]??"",onChange:C=>f(m,L,C.target.value),required:!0,style:{width:v_}})},L))})})]})]},m)})}),n.jsx("button",{type:"submit",disabled:a,style:{padding:"8px 18px",fontWeight:700},children:a?"Saving...":"Save"}),o&&n.jsx("div",{style:{color:"red",marginTop:12},children:o}),c&&n.jsx("div",{style:{color:"green",marginTop:12},children:c})]})]})}function AP(){const e=Ji(),t=Ri(),s=v.useMemo(()=>new URLSearchParams(e.search),[e.search]).get("tab")||"dashboard",[a,i]=v.useState(s);v.useEffect(()=>{const l=new URLSearchParams(e.search).get("tab");l&&l!==a&&i(l)},[e.search]);const o=[{key:"dashboard",label:"Dashboard"},{key:"weights",label:"Weights"},{key:"due_dates",label:"OBE Due Dates"},{key:"courses",label:"Courses"},{key:"qp",label:"QP"}];return n.jsxs("main",{style:{padding:18,minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n.jsxs("div",{style:{marginBottom:12},children:[n.jsx("h2",{style:{margin:0,fontSize:20},children:"Academic Controller"}),n.jsx("div",{style:{color:"#6b7280",marginTop:6},children:"IQAC tools for OBE oversight."})]}),n.jsx("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:18,flexWrap:"wrap"},children:o.map(l=>n.jsx("button",{onClick:()=>{i(l.key),t(`/iqac/academic-controller?tab=${encodeURIComponent(l.key)}`)},style:{padding:"8px 12px",borderRadius:8,border:a===l.key?"1px solid #10b981":"1px solid #e5e7eb",background:a===l.key?"#ecfdf5":"#fff",fontWeight:700,cursor:"pointer"},children:l.label},l.key))}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[a==="dashboard"&&n.jsx("div",{style:{color:"#6b7280"},children:"Dashboard coming soon."}),a==="weights"&&n.jsx(NP,{}),a==="due_dates"&&n.jsx(tw,{}),a==="courses"&&n.jsx(SP,{}),a==="qp"&&n.jsx(_P,{})]})]})}const CP="https://db.zynix.us",EP=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:8000":CP;async function x1(e){const t=encodeURIComponent(String(e||"").trim()),r=await hr(`${EP}/api/academics/iqac/course-teaching/${t}/`);if(!r.ok)throw new Error("Failed to fetch course teaching map");const s=await r.json();if(Array.isArray(s))return s;const a=s==null?void 0:s.results;return Array.isArray(a)?a:[]}function TP(){var x;const{courseCode:e}=g0(),t=Ri(),r=v.useMemo(()=>decodeURIComponent(String(e||"")).trim(),[e]),[s,a]=v.useState([]),[i,o]=v.useState(null),[l,c]=v.useState(!0),[d,u]=v.useState(null);v.useEffect(()=>{let g=!0;return(async()=>{if(r)try{const[y,m]=await Promise.all([x1(r),vo()]);if(!g)return;a(Array.isArray(y)?y:[]),o(Array.isArray(m)?m:[]),u(null)}catch(y){if(!g)return;a([]),u((y==null?void 0:y.message)||"Failed to load course mapping")}finally{g&&c(!1)}})(),()=>{g=!1}},[r]);const h=((x=s[0])==null?void 0:x.course_name)||r,p=v.useMemo(()=>{const g=new Map;for(const m of s||[]){const w=String((m==null?void 0:m.section_name)||"").trim()||"Section",S=m!=null&&m.academic_year?String(m.academic_year):null,k=`${w}__${S||""}`,F=g.get(k);F?F.items.push(m):g.set(k,{section_name:w,academic_year:S,items:[m]})}const y=Array.from(g.values());y.sort((m,w)=>{const S=m.section_name.localeCompare(w.section_name);return S!==0?S:String(m.academic_year||"").localeCompare(String(w.academic_year||""))});for(const m of y)m.items.sort((w,S)=>{var L,C,O,T;const k=String(((L=w.staff)==null?void 0:L.name)||((C=w.staff)==null?void 0:C.username)||"").trim(),F=String(((O=S.staff)==null?void 0:O.name)||((T=S.staff)==null?void 0:T.username)||"").trim();return k.localeCompare(F)});return y},[s]);async function f(g){if(!g||!window.confirm("Resetting this course will delete all entered exam data for this teaching assignment. This cannot be undone. Proceed?"))return;const m=["ssa1","review1","ssa2","review2","cia1","cia2","formative1","formative2","model"];try{for(const S of m)try{await ew(S,r,g)}catch(k){console.warn("reset assessment failed",S,k)}c(!0);const w=await x1(r);a(Array.isArray(w)?w:[]),u(null),window.alert("Reset completed.")}catch(w){window.alert("Reset failed: "+((w==null?void 0:w.message)||String(w)))}finally{c(!1)}}return n.jsxs("main",{style:{padding:18,minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:12,flexWrap:"wrap",marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{margin:0,fontSize:20},children:r}),n.jsx("div",{style:{color:"#374151",marginTop:6,fontWeight:800},children:h}),n.jsx("div",{style:{color:"#6b7280",marginTop:4},children:"Sections and staff mapping."})]}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx(sa,{className:"obe-btn obe-btn-secondary",to:"/iqac/academic-controller?tab=courses",children:"Back"}),n.jsx("button",{className:"obe-btn",onClick:()=>t(`/obe/course/${encodeURIComponent(r)}`),children:"Open OBE (faculty view)"})]})]}),l?n.jsx("div",{style:{color:"#6b7280"},children:"Loading"}):null,d?n.jsx("div",{style:{color:"#b91c1c"},children:d}):null,!l&&!d&&s.length===0?n.jsx("div",{style:{color:"#6b7280"},children:"No active teaching assignments found for this course."}):null,!l&&!d&&s.length>0?n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:p.map(g=>n.jsxs("div",{className:"obe-card",style:{display:"flex",flexDirection:"column",gap:10},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"baseline"},children:[n.jsx("div",{style:{fontWeight:900,color:"#0f172a"},children:g.section_name}),n.jsx("div",{style:{color:"#6b7280",fontSize:13},children:g.academic_year||""})]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:10},children:g.items.map(y=>{var m,w;return n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:10,background:"#fff",display:"flex",flexDirection:"column",gap:8},children:[n.jsx("div",{style:{color:"#111827",fontWeight:800},children:((m=y.staff)==null?void 0:m.name)||((w=y.staff)==null?void 0:w.username)||""}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[y.section_name?`Section: ${y.section_name}`:"",y.academic_year?`    AY: ${y.academic_year}`:"",(()=>{var k,F;const S=(i||[]).find(L=>String((L==null?void 0:L.course_code)||"").trim().toUpperCase()===r.toUpperCase());return S?`    Dept: ${((k=S.department)==null?void 0:k.name)||((F=S.department)==null?void 0:F.code)||""}    Sem: ${S.semester||""}`:""})()]}),n.jsxs("div",{style:{marginTop:2,display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:()=>t(`/iqac/academic-controller/course/${encodeURIComponent(r)}/marks/${encodeURIComponent(String(y.teaching_assignment_id))}`),children:"Open Mark Entry"}),n.jsx("button",{className:"obe-btn",onClick:()=>t(`/iqac/academic-controller/course/${encodeURIComponent(r)}/obe/${encodeURIComponent(String(y.teaching_assignment_id))}/marks`),children:"Open OBE (view-only)"}),n.jsx("button",{className:"obe-btn",onClick:()=>f(Number(y.teaching_assignment_id)),children:"Reset Course"})]})]},String(y.teaching_assignment_id))})})]},`${g.section_name}__${g.academic_year||""}`))}):null]})}async function Jo(e){const t=`/api/academics/teaching-assignments/${encodeURIComponent(String(e))}/students/`,r=(a,i=800)=>{const o=String(a||""),d=o.replace(/<script[\s\S]*?<\/script>/gi," ").replace(/<style[\s\S]*?<\/style>/gi," ").replace(/<[^>]+>/g," ").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/\s+/g," ").trim()||o.replace(/\s+/g," ").trim();return d.length<=i?d:d.slice(0,i)+" (truncated)"},s=await hr(t,{method:"GET"});if(!s.ok){const a=await s.text();throw new Error(`Roster fetch failed: ${s.status}
${r(a)}`)}return s.json()}const LP="https://db.zynix.us",Fu=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:8000":LP,g1="obe_assessment_master_config_cache";async function Mu(e,t){const r=e.headers.get("content-type")||"";try{if(r.includes("application/json")){const i=await e.json(),o=(i==null?void 0:i.detail)||(i==null?void 0:i.message);if(o)return`${t}: ${o}`}}catch{}if(e.status===401)return`${t}: Authentication required. Please login.`;if(e.status===403)return`${t}: Permission required.`;if(e.status===404)return`${t}: No CDAP found for this course yet. Upload the Excel to create one.`;let s="";try{s=await e.text()}catch{}const a=(s||"").trim();return a&&!a.startsWith("<")?`${t}: ${a}`:`${t}: Server returned ${e.status}.`}async function FP(e){const t=`${Fu}/api/obe/cdap-revision/${encodeURIComponent(e)}`,r=await hr(t,{method:"GET"});if(!r.ok){const s=await Mu(r,"CDAP revision fetch failed");throw new Error(s)}return r.json()}async function __(e){const t=`${Fu}/api/obe/articulation-matrix/${encodeURIComponent(e)}`,r=await hr(t,{method:"GET"});if(!r.ok){const s=await Mu(r,"Articulation Matrix fetch failed");throw new Error(s)}return r.json()}async function lA(e){const t=(e==null?void 0:e.subjectId)||(e==null?void 0:e.subject_id);if(!t)throw new Error("subjectId is required to save CDAP revision");const r=`${Fu}/api/obe/cdap-revision/${encodeURIComponent(t)}`,s=await hr(r,{method:"PUT",body:JSON.stringify(e)});if(!s.ok){const a=await Mu(s,"CDAP revision save failed");throw new Error(a)}return s.json()}async function cA(){const e=`${Fu}/api/obe/active-learning-mapping`,t=await hr(e,{method:"GET"});if(!t.ok){try{const a=window.localStorage.getItem(g1);if(a){const i=JSON.parse(a);if(i&&typeof i=="object")return i}}catch{}const s=await Mu(t,"Active learning mapping fetch failed");throw new Error(s)}const r=await t.json();return(r==null?void 0:r.mapping)||{}}async function MP(e){const t=`${Fu}/api/obe/active-learning-mapping`,r=await hr(t,{method:"PUT",body:JSON.stringify({mapping:e})});if(!r.ok){const a=await Mu(r,"Active learning mapping save failed");throw new Error(a)}const s=await r.json();return(s==null?void 0:s.mapping)||{}}async function Sl(){const e=`${Fu}/api/obe/assessment-master-config`,t=await hr(e,{method:"GET"});if(!t.ok){try{const i=window.localStorage.getItem(g1);if(i){const o=JSON.parse(i);if(o&&typeof o=="object")return o}}catch{}const a=await Mu(t,"Assessment master config fetch failed");throw new Error(a)}const r=await t.json(),s=(r==null?void 0:r.config)||{};try{window.localStorage.setItem(g1,JSON.stringify(s))}catch{}return s}async function RP(e){const t=`${Fu}/api/obe/assessment-master-config`,r=await hr(t,{method:"PUT",body:JSON.stringify({config:e})});if(!r.ok){const i=await Mu(r,"Assessment master config save failed");throw new Error(i)}const s=await r.json(),a=(s==null?void 0:s.config)||{};try{window.localStorage.setItem(g1,JSON.stringify(a))}catch{}return a}function BP(e,t=3e4){const r=window.setInterval(()=>e(),t);return()=>window.clearInterval(r)}function PP(e,t){if(!e)return null;const r=new Date(e).getTime();if(!Number.isFinite(r))return null;const s=t?new Date(t).getTime():Date.now();return Number.isFinite(s)?Math.floor((r-s)/1e3):null}function _0(e){if(e==null)return"";const t=Math.max(0,Math.floor(e)),r=Math.floor(t/3600),s=Math.floor(t%3600/60),a=t%60;return r>0?`${r}h ${String(s).padStart(2,"0")}m`:`${s}m ${String(a).padStart(2,"0")}s`}function Ru(e){const{assessment:t,subjectCode:r,teachingAssignmentId:s,options:a}=e,[i,o]=v.useState(null),[l,c]=v.useState(!1),[d,u]=v.useState(null),[h,p]=v.useState(null),f=v.useMemo(()=>`${t}|${r}|${s||""}`,[t,r,s]),x=async y=>{if(!t||!r)return;const m=!!(y!=null&&y.silent);m||c(!0),m||u(null);try{const w=await D6(t,r,s);o(w);const S=w.remaining_seconds??PP(w.due_at,w.now);p(S)}catch(w){u((w==null?void 0:w.message)||"Failed to check publish window")}finally{m||c(!1)}};v.useEffect(()=>{o(null),p(null),x()},[f]),v.useEffect(()=>{if((a==null?void 0:a.poll)===!1)return;const y=window.setInterval(()=>{x({silent:!0})},3e4);return()=>window.clearInterval(y)},[f,a==null?void 0:a.poll]),v.useEffect(()=>{if(h==null||h<=0)return;const y=window.setInterval(()=>{p(m=>m==null?m:m<=0?0:m-1)},1e3);return()=>window.clearInterval(y)},[h]);const g=(i==null?void 0:i.publish_allowed)??!0;return{data:i,loading:l,error:d,remainingSeconds:h,publishAllowed:g,refresh:x}}function Xo(e){const{assessment:t,subjectCode:r,scope:s,teachingAssignmentId:a,options:i}=e,[o,l]=v.useState(null),[c,d]=v.useState(!1),[u,h]=v.useState(null),p=v.useMemo(()=>`${t}|${r}|${s}|${a||""}`,[t,r,s,a]),f=async x=>{if(!t||!r||!s)return;const g=!!(x!=null&&x.silent);g||d(!0),g||h(null);try{const y=await ip(t,r,s,a);l(y)}catch(y){h((y==null?void 0:y.message)||"Failed to check edit window")}finally{g||d(!1)}};return v.useEffect(()=>{l(null),f()},[p]),v.useEffect(()=>{if((i==null?void 0:i.poll)===!1)return;const x=window.setInterval(()=>{f({silent:!0})},3e4);return()=>window.clearInterval(x)},[p,i==null?void 0:i.poll]),{data:o,loading:c,error:u,refresh:f}}function Bu(e){const{assessment:t,subjectCode:r,teachingAssignmentId:s,options:a}=e,[i,o]=v.useState(null),[l,c]=v.useState(!1),[d,u]=v.useState(null),h=v.useMemo(()=>`${t}|${r}|${s||""}`,[t,r,s]),p=async f=>{if(!t||!r)return;const x=!!(f!=null&&f.silent);x||c(!0),x||u(null);try{const g=await sg(t,r,s);o(g)}catch(g){u((g==null?void 0:g.message)||"Failed to load lock status")}finally{x||c(!1)}};return v.useEffect(()=>{o(null),p()},[h]),v.useEffect(()=>{if((a==null?void 0:a.poll)===!1)return;const f=window.setInterval(()=>{p({silent:!0})},3e4);return()=>window.clearInterval(f)},[h,a==null?void 0:a.poll]),{data:i,loading:l,error:d,refresh:p}}function OP({size:e=22}){return n.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,focusable:"false",children:[n.jsx("path",{d:"M7 10V8a5 5 0 0 1 10 0v2",stroke:"#111827",strokeWidth:"1.8",strokeLinecap:"round"}),n.jsx("path",{d:"M6.5 10h11A2.5 2.5 0 0 1 20 12.5v6A2.5 2.5 0 0 1 17.5 21h-11A2.5 2.5 0 0 1 4 18.5v-6A2.5 2.5 0 0 1 6.5 10Z",fill:"#F3F4F6",stroke:"#111827",strokeWidth:"1.2"}),n.jsx("path",{d:"M12 14.2v2.6",stroke:"#111827",strokeWidth:"1.8",strokeLinecap:"round"})]})}function k0({locked:e,title:t,subtitle:r,children:s}){return e?n.jsxs("div",{style:{position:"relative"},children:[n.jsx("div",{style:{pointerEvents:"none",userSelect:"none"},children:s}),n.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",padding:16,background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(2px)"},children:n.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",background:"#ffffff",border:"2px solid #e5e7eb",borderRadius:14,padding:"14px 18px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",maxWidth:520},children:[n.jsx("div",{style:{width:38,height:38,borderRadius:999,display:"grid",placeItems:"center",background:"#fef3c7",border:"1px solid #fde68a",flex:"0 0 auto"},children:n.jsx(OP,{size:22})}),n.jsxs("div",{style:{minWidth:0},children:[n.jsx("div",{style:{fontWeight:900,color:"#111827"},children:t||"Locked by IQAC"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginTop:2},children:r||"Publishing is turned OFF globally for this assessment."})]})]})})]}):n.jsx(n.Fragment,{children:s})}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var y1={};y1.version="0.18.5";var dA=1252,IP=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],sw={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},aw=function(e){IP.indexOf(e)!=-1&&(dA=sw[0]=e)};function DP(){aw(1252)}var ul=function(e){aw(e)};function iw(){ul(1200),DP()}function k_(e){for(var t=[],r=0,s=e.length;r<s;++r)t[r]=e.charCodeAt(r);return t}function UP(e){for(var t=[],r=0;r<e.length>>1;++r)t[r]=String.fromCharCode(e.charCodeAt(2*r)+(e.charCodeAt(2*r+1)<<8));return t.join("")}function uA(e){for(var t=[],r=0;r<e.length>>1;++r)t[r]=String.fromCharCode(e.charCodeAt(2*r+1)+(e.charCodeAt(2*r)<<8));return t.join("")}var gh=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1);return t==255&&r==254?UP(e.slice(2)):t==254&&r==255?uA(e.slice(2)):t==65279?e.slice(1):e},Fm=function(t){return String.fromCharCode(t)},j_=function(t){return String.fromCharCode(t)},cp,cd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function dp(e){for(var t="",r=0,s=0,a=0,i=0,o=0,l=0,c=0,d=0;d<e.length;)r=e.charCodeAt(d++),i=r>>2,s=e.charCodeAt(d++),o=(r&3)<<4|s>>4,a=e.charCodeAt(d++),l=(s&15)<<2|a>>6,c=a&63,isNaN(s)?l=c=64:isNaN(a)&&(c=64),t+=cd.charAt(i)+cd.charAt(o)+cd.charAt(l)+cd.charAt(c);return t}function ko(e){var t="",r=0,s=0,a=0,i=0,o=0,l=0,c=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var d=0;d<e.length;)i=cd.indexOf(e.charAt(d++)),o=cd.indexOf(e.charAt(d++)),r=i<<2|o>>4,t+=String.fromCharCode(r),l=cd.indexOf(e.charAt(d++)),s=(o&15)<<4|l>>2,l!==64&&(t+=String.fromCharCode(s)),c=cd.indexOf(e.charAt(d++)),a=(l&3)<<6|c,c!==64&&(t+=String.fromCharCode(a));return t}var Un=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Tc=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(t,r){return r?new Buffer(t,r):new Buffer(t)}:Buffer.from.bind(Buffer)}return function(){}}();function jd(e){return Un?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function N_(e){return Un?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var go=function(t){return Un?Tc(t,"binary"):t.split("").map(function(r){return r.charCodeAt(0)&255})};function ug(e){if(typeof ArrayBuffer>"u")return go(e);for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),s=0;s!=e.length;++s)r[s]=e.charCodeAt(s)&255;return t}function Rd(e){if(Array.isArray(e))return e.map(function(s){return String.fromCharCode(s)}).join("");for(var t=[],r=0;r<e.length;++r)t[r]=String.fromCharCode(e[r]);return t.join("")}function $P(e){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(e)}function ow(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return ow(new Uint8Array(e));for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=e[r];return t}var Ia=Un?function(e){return Buffer.concat(e.map(function(t){return Buffer.isBuffer(t)?t:Tc(t)}))}:function(e){if(typeof Uint8Array<"u"){var t=0,r=0;for(t=0;t<e.length;++t)r+=e[t].length;var s=new Uint8Array(r),a=0;for(t=0,r=0;t<e.length;r+=a,++t)if(a=e[t].length,e[t]instanceof Uint8Array)s.set(e[t],r);else{if(typeof e[t]=="string")throw"wtf";s.set(new Uint8Array(e[t]),r)}return s}return[].concat.apply([],e.map(function(i){return Array.isArray(i)?i:[].slice.call(i)}))};function WP(e){for(var t=[],r=0,s=e.length+250,a=jd(e.length+255),i=0;i<e.length;++i){var o=e.charCodeAt(i);if(o<128)a[r++]=o;else if(o<2048)a[r++]=192|o>>6&31,a[r++]=128|o&63;else if(o>=55296&&o<57344){o=(o&1023)+64;var l=e.charCodeAt(++i)&1023;a[r++]=240|o>>8&7,a[r++]=128|o>>2&63,a[r++]=128|l>>6&15|(o&3)<<4,a[r++]=128|l&63}else a[r++]=224|o>>12&15,a[r++]=128|o>>6&63,a[r++]=128|o&63;r>s&&(t.push(a.slice(0,r)),r=0,a=jd(65535),s=65530)}return t.push(a.slice(0,r)),Ia(t)}var Li=/\u0000/g,yh=/[\u0001-\u0006]/g;function Hf(e){for(var t="",r=e.length-1;r>=0;)t+=e.charAt(r--);return t}function fl(e,t){var r=""+e;return r.length>=t?r:Gs("0",t-r.length)+r}function lw(e,t){var r=""+e;return r.length>=t?r:Gs(" ",t-r.length)+r}function b1(e,t){var r=""+e;return r.length>=t?r:r+Gs(" ",t-r.length)}function zP(e,t){var r=""+Math.round(e);return r.length>=t?r:Gs("0",t-r.length)+r}function qP(e,t){var r=""+e;return r.length>=t?r:Gs("0",t-r.length)+r}var A_=Math.pow(2,32);function Yu(e,t){if(e>A_||e<-A_)return zP(e,t);var r=Math.round(e);return qP(r,t)}function v1(e,t){return t=t||0,e.length>=7+t&&(e.charCodeAt(t)|32)===103&&(e.charCodeAt(t+1)|32)===101&&(e.charCodeAt(t+2)|32)===110&&(e.charCodeAt(t+3)|32)===101&&(e.charCodeAt(t+4)|32)===114&&(e.charCodeAt(t+5)|32)===97&&(e.charCodeAt(t+6)|32)===108}var C_=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],vy=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function HP(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"/ "hh""mm""ss" "',e}var vn={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},E_={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},VP={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function w1(e,t,r){for(var s=e<0?-1:1,a=e*s,i=0,o=1,l=0,c=1,d=0,u=0,h=Math.floor(a);d<t&&(h=Math.floor(a),l=h*o+i,u=h*d+c,!(a-h<5e-8));)a=1/(a-h),i=o,o=l,c=d,d=u;if(u>t&&(d>t?(u=c,l=i):(u=d,l=o)),!r)return[0,s*l,u];var p=Math.floor(s*l/u);return[p,s*l-p*u,u]}function nu(e,t,r){if(e>2958465||e<0)return null;var s=e|0,a=Math.floor(86400*(e-s)),i=0,o=[],l={D:s,T:a,u:86400*(e-s)-a,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),t&&t.date1904&&(s+=1462),l.u>.9999&&(l.u=0,++a==86400&&(l.T=a=0,++s,++l.D)),s===60)o=r?[1317,10,29]:[1900,2,29],i=3;else if(s===0)o=r?[1317,8,29]:[1900,1,0],i=6;else{s>60&&--s;var c=new Date(1900,0,1);c.setDate(c.getDate()+s-1),o=[c.getFullYear(),c.getMonth()+1,c.getDate()],i=c.getDay(),s<60&&(i=(i+6)%7),r&&(i=JP(c,o))}return l.y=o[0],l.m=o[1],l.d=o[2],l.S=a%60,a=Math.floor(a/60),l.M=a%60,a=Math.floor(a/60),l.H=a,l.q=i,l}var fA=new Date(1899,11,31,0,0,0),GP=fA.getTime(),QP=new Date(1900,2,1,0,0,0);function hA(e,t){var r=e.getTime();return t?r-=1461*24*60*60*1e3:e>=QP&&(r+=24*60*60*1e3),(r-(GP+(e.getTimezoneOffset()-fA.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function cw(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function XP(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function YP(e){var t=e<0?12:11,r=cw(e.toFixed(12));return r.length<=t||(r=e.toPrecision(10),r.length<=t)?r:e.toExponential(5)}function KP(e){var t=cw(e.toFixed(11));return t.length>(e<0?12:11)||t==="0"||t==="-0"?e.toPrecision(6):t}function up(e){var t=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),r;return t>=-4&&t<=-1?r=e.toPrecision(10+t):Math.abs(t)<=9?r=YP(e):t===10?r=e.toFixed(10).substr(0,12):r=KP(e),cw(XP(r.toUpperCase()))}function wu(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):up(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return Yo(14,hA(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function JP(e,t){t[0]-=581;var r=e.getDay();return e<60&&(r=(r+6)%7),r}function ZP(e,t,r,s){var a="",i=0,o=0,l=r.y,c,d=0;switch(e){case 98:l=r.y+543;case 121:switch(t.length){case 1:case 2:c=l%100,d=2;break;default:c=l%1e4,d=4;break}break;case 109:switch(t.length){case 1:case 2:c=r.m,d=t.length;break;case 3:return vy[r.m-1][1];case 5:return vy[r.m-1][0];default:return vy[r.m-1][2]}break;case 100:switch(t.length){case 1:case 2:c=r.d,d=t.length;break;case 3:return C_[r.q][0];default:return C_[r.q][1]}break;case 104:switch(t.length){case 1:case 2:c=1+(r.H+11)%12,d=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:c=r.H,d=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:c=r.M,d=t.length;break;default:throw"bad minute format: "+t}break;case 115:if(t!="s"&&t!="ss"&&t!=".0"&&t!=".00"&&t!=".000")throw"bad second format: "+t;return r.u===0&&(t=="s"||t=="ss")?fl(r.S,t.length):(s>=2?o=s===3?1e3:100:o=s===1?10:1,i=Math.round(o*(r.S+r.u)),i>=60*o&&(i=0),t==="s"?i===0?"0":""+i/o:(a=fl(i,2+s),t==="ss"?a.substr(0,2):"."+a.substr(2,t.length-1)));case 90:switch(t){case"[h]":case"[hh]":c=r.D*24+r.H;break;case"[m]":case"[mm]":c=(r.D*24+r.H)*60+r.M;break;case"[s]":case"[ss]":c=((r.D*24+r.H)*60+r.M)*60+Math.round(r.S+r.u);break;default:throw"bad abstime format: "+t}d=t.length===3?1:2;break;case 101:c=l,d=1;break}var u=d>0?fl(c,d):"";return u}function dd(e){var t=3;if(e.length<=t)return e;for(var r=e.length%t,s=e.substr(0,r);r!=e.length;r+=t)s+=(s.length>0?",":"")+e.substr(r,t);return s}var pA=/%/g;function eO(e,t,r){var s=t.replace(pA,""),a=t.length-s.length;return gc(e,s,r*Math.pow(10,2*a))+Gs("%",a)}function tO(e,t,r){for(var s=t.length-1;t.charCodeAt(s-1)===44;)--s;return gc(e,t.substr(0,s),r/Math.pow(10,3*(t.length-s)))}function mA(e,t){var r,s=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+mA(e,-t);var a=e.indexOf(".");a===-1&&(a=e.indexOf("E"));var i=Math.floor(Math.log(t)*Math.LOG10E)%a;if(i<0&&(i+=a),r=(t/Math.pow(10,i)).toPrecision(s+1+(a+i)%a),r.indexOf("e")===-1){var o=Math.floor(Math.log(t)*Math.LOG10E);for(r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(o-r.length+i):r+="E+"+(o-i);r.substr(0,2)==="0.";)r=r.charAt(0)+r.substr(2,a)+"."+r.substr(2+a),r=r.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,u){return c+d+u.substr(0,(a+i)%a)+"."+u.substr(i)+"E"})}else r=t.toExponential(s);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}var xA=/# (\?+)( ?)\/( ?)(\d+)/;function rO(e,t,r){var s=parseInt(e[4],10),a=Math.round(t*s),i=Math.floor(a/s),o=a-i*s,l=s;return r+(i===0?"":""+i)+" "+(o===0?Gs(" ",e[1].length+1+e[4].length):lw(o,e[1].length)+e[2]+"/"+e[3]+fl(l,e[4].length))}function nO(e,t,r){return r+(t===0?"":""+t)+Gs(" ",e[1].length+2+e[4].length)}var gA=/^#*0*\.([0#]+)/,yA=/\).*[0#]/,bA=/\(###\) ###\\?-####/;function Ci(e){for(var t="",r,s=0;s!=e.length;++s)switch(r=e.charCodeAt(s)){case 35:break;case 63:t+=" ";break;case 48:t+="0";break;default:t+=String.fromCharCode(r)}return t}function T_(e,t){var r=Math.pow(10,t);return""+Math.round(e*r)/r}function L_(e,t){var r=e-Math.floor(e),s=Math.pow(10,t);return t<(""+Math.round(r*s)).length?0:Math.round(r*s)}function sO(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}function aO(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function Bo(e,t,r){if(e.charCodeAt(0)===40&&!t.match(yA)){var s=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?Bo("n",s,r):"("+Bo("n",s,-r)+")"}if(t.charCodeAt(t.length-1)===44)return tO(e,t,r);if(t.indexOf("%")!==-1)return eO(e,t,r);if(t.indexOf("E")!==-1)return mA(t,r);if(t.charCodeAt(0)===36)return"$"+Bo(e,t.substr(t.charAt(1)==" "?2:1),r);var a,i,o,l,c=Math.abs(r),d=r<0?"-":"";if(t.match(/^00+$/))return d+Yu(c,t.length);if(t.match(/^[#?]+$/))return a=Yu(r,0),a==="0"&&(a=""),a.length>t.length?a:Ci(t.substr(0,t.length-a.length))+a;if(i=t.match(xA))return rO(i,c,d);if(t.match(/^#+0+$/))return d+Yu(c,t.length-t.indexOf("0"));if(i=t.match(gA))return a=T_(r,i[1].length).replace(/^([^\.]+)$/,"$1."+Ci(i[1])).replace(/\.$/,"."+Ci(i[1])).replace(/\.(\d*)$/,function(x,g){return"."+g+Gs("0",Ci(i[1]).length-g.length)}),t.indexOf("0.")!==-1?a:a.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),i=t.match(/^(0*)\.(#*)$/))return d+T_(c,i[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=t.match(/^#{1,3},##0(\.?)$/))return d+dd(Yu(c,0));if(i=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+Bo(e,t,-r):dd(""+(Math.floor(r)+sO(r,i[1].length)))+"."+fl(L_(r,i[1].length),i[1].length);if(i=t.match(/^#,#*,#0/))return Bo(e,t.replace(/^#,#*,/,""),r);if(i=t.match(/^([0#]+)(\\?-([0#]+))+$/))return a=Hf(Bo(e,t.replace(/[\\-]/g,""),r)),o=0,Hf(Hf(t.replace(/\\/g,"")).replace(/[0#]/g,function(x){return o<a.length?a.charAt(o++):x==="0"?"0":""}));if(t.match(bA))return a=Bo(e,"##########",r),"("+a.substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var u="";if(i=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),l=w1(c,Math.pow(10,o)-1,!1),a=""+d,u=gc("n",i[1],l[1]),u.charAt(u.length-1)==" "&&(u=u.substr(0,u.length-1)+"0"),a+=u+i[2]+"/"+i[3],u=b1(l[2],o),u.length<i[4].length&&(u=Ci(i[4].substr(i[4].length-u.length))+u),a+=u,a;if(i=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),l=w1(c,Math.pow(10,o)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?lw(l[1],o)+i[2]+"/"+i[3]+b1(l[2],o):Gs(" ",2*o+1+i[2].length+i[3].length));if(i=t.match(/^[#0?]+$/))return a=Yu(r,0),t.length<=a.length?a:Ci(t.substr(0,t.length-a.length))+a;if(i=t.match(/^([#0?]+)\.([#0]+)$/)){a=""+r.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var h=t.indexOf(".")-o,p=t.length-a.length-h;return Ci(t.substr(0,h)+a+t.substr(t.length-p))}if(i=t.match(/^00,000\.([#0]*0)$/))return o=L_(r,i[1].length),r<0?"-"+Bo(e,t,-r):dd(aO(r)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(x){return"00,"+(x.length<3?fl(0,3-x.length):"")+x})+"."+fl(o,i[1].length);switch(t){case"###,##0.00":return Bo(e,"#,##0.00",r);case"###,###":case"##,###":case"#,###":var f=dd(Yu(c,0));return f!=="0"?d+f:"";case"###,###.00":return Bo(e,"###,##0.00",r).replace(/^0\./,".");case"#,###.00":return Bo(e,"#,##0.00",r).replace(/^0\./,".")}throw new Error("unsupported format |"+t+"|")}function iO(e,t,r){for(var s=t.length-1;t.charCodeAt(s-1)===44;)--s;return gc(e,t.substr(0,s),r/Math.pow(10,3*(t.length-s)))}function oO(e,t,r){var s=t.replace(pA,""),a=t.length-s.length;return gc(e,s,r*Math.pow(10,2*a))+Gs("%",a)}function vA(e,t){var r,s=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+vA(e,-t);var a=e.indexOf(".");a===-1&&(a=e.indexOf("E"));var i=Math.floor(Math.log(t)*Math.LOG10E)%a;if(i<0&&(i+=a),r=(t/Math.pow(10,i)).toPrecision(s+1+(a+i)%a),!r.match(/[Ee]/)){var o=Math.floor(Math.log(t)*Math.LOG10E);r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(o-r.length+i):r+="E+"+(o-i),r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,u){return c+d+u.substr(0,(a+i)%a)+"."+u.substr(i)+"E"})}else r=t.toExponential(s);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}function Bl(e,t,r){if(e.charCodeAt(0)===40&&!t.match(yA)){var s=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?Bl("n",s,r):"("+Bl("n",s,-r)+")"}if(t.charCodeAt(t.length-1)===44)return iO(e,t,r);if(t.indexOf("%")!==-1)return oO(e,t,r);if(t.indexOf("E")!==-1)return vA(t,r);if(t.charCodeAt(0)===36)return"$"+Bl(e,t.substr(t.charAt(1)==" "?2:1),r);var a,i,o,l,c=Math.abs(r),d=r<0?"-":"";if(t.match(/^00+$/))return d+fl(c,t.length);if(t.match(/^[#?]+$/))return a=""+r,r===0&&(a=""),a.length>t.length?a:Ci(t.substr(0,t.length-a.length))+a;if(i=t.match(xA))return nO(i,c,d);if(t.match(/^#+0+$/))return d+fl(c,t.length-t.indexOf("0"));if(i=t.match(gA))return a=(""+r).replace(/^([^\.]+)$/,"$1."+Ci(i[1])).replace(/\.$/,"."+Ci(i[1])),a=a.replace(/\.(\d*)$/,function(x,g){return"."+g+Gs("0",Ci(i[1]).length-g.length)}),t.indexOf("0.")!==-1?a:a.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),i=t.match(/^(0*)\.(#*)$/))return d+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=t.match(/^#{1,3},##0(\.?)$/))return d+dd(""+c);if(i=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+Bl(e,t,-r):dd(""+r)+"."+Gs("0",i[1].length);if(i=t.match(/^#,#*,#0/))return Bl(e,t.replace(/^#,#*,/,""),r);if(i=t.match(/^([0#]+)(\\?-([0#]+))+$/))return a=Hf(Bl(e,t.replace(/[\\-]/g,""),r)),o=0,Hf(Hf(t.replace(/\\/g,"")).replace(/[0#]/g,function(x){return o<a.length?a.charAt(o++):x==="0"?"0":""}));if(t.match(bA))return a=Bl(e,"##########",r),"("+a.substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var u="";if(i=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),l=w1(c,Math.pow(10,o)-1,!1),a=""+d,u=gc("n",i[1],l[1]),u.charAt(u.length-1)==" "&&(u=u.substr(0,u.length-1)+"0"),a+=u+i[2]+"/"+i[3],u=b1(l[2],o),u.length<i[4].length&&(u=Ci(i[4].substr(i[4].length-u.length))+u),a+=u,a;if(i=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),l=w1(c,Math.pow(10,o)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?lw(l[1],o)+i[2]+"/"+i[3]+b1(l[2],o):Gs(" ",2*o+1+i[2].length+i[3].length));if(i=t.match(/^[#0?]+$/))return a=""+r,t.length<=a.length?a:Ci(t.substr(0,t.length-a.length))+a;if(i=t.match(/^([#0]+)\.([#0]+)$/)){a=""+r.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var h=t.indexOf(".")-o,p=t.length-a.length-h;return Ci(t.substr(0,h)+a+t.substr(t.length-p))}if(i=t.match(/^00,000\.([#0]*0)$/))return r<0?"-"+Bl(e,t,-r):dd(""+r).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(x){return"00,"+(x.length<3?fl(0,3-x.length):"")+x})+"."+fl(0,i[1].length);switch(t){case"###,###":case"##,###":case"#,###":var f=dd(""+c);return f!=="0"?d+f:"";default:if(t.match(/\.[0#?]*$/))return Bl(e,t.slice(0,t.lastIndexOf(".")),r)+Ci(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function gc(e,t,r){return(r|0)===r?Bl(e,t,r):Bo(e,t,r)}function lO(e){for(var t=[],r=!1,s=0,a=0;s<e.length;++s)switch(e.charCodeAt(s)){case 34:r=!r;break;case 95:case 42:case 92:++s;break;case 59:t[t.length]=e.substr(a,s-a),a=s+1}if(t[t.length]=e.substr(a),r===!0)throw new Error("Format |"+e+"| unterminated string ");return t}var wA=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function j0(e){for(var t=0,r="",s="";t<e.length;)switch(r=e.charAt(t)){case"G":v1(e,t)&&(t+=6),t++;break;case'"':for(;e.charCodeAt(++t)!==34&&t<e.length;);++t;break;case"\\":t+=2;break;case"_":t+=2;break;case"@":++t;break;case"B":case"b":if(e.charAt(t+1)==="1"||e.charAt(t+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(e.substr(t,3).toUpperCase()==="A/P"||e.substr(t,5).toUpperCase()==="AM/PM"||e.substr(t,5).toUpperCase()==="/")return!0;++t;break;case"[":for(s=r;e.charAt(t++)!=="]"&&t<e.length;)s+=e.charAt(t);if(s.match(wA))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(r=e.charAt(++t))>-1||r=="\\"&&e.charAt(t+1)=="-"&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===r;);break;case"*":++t,(e.charAt(t)==" "||e.charAt(t)=="*")&&++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;case" ":++t;break;default:++t;break}return!1}function cO(e,t,r,s){for(var a=[],i="",o=0,l="",c="t",d,u,h,p="H";o<e.length;)switch(l=e.charAt(o)){case"G":if(!v1(e,o))throw new Error("unrecognized character "+l+" in "+e);a[a.length]={t:"G",v:"General"},o+=7;break;case'"':for(i="";(h=e.charCodeAt(++o))!==34&&o<e.length;)i+=String.fromCharCode(h);a[a.length]={t:"t",v:i},++o;break;case"\\":var f=e.charAt(++o),x=f==="("||f===")"?f:"t";a[a.length]={t:x,v:f},++o;break;case"_":a[a.length]={t:"t",v:" "},o+=2;break;case"@":a[a.length]={t:"T",v:t},++o;break;case"B":case"b":if(e.charAt(o+1)==="1"||e.charAt(o+1)==="2"){if(d==null&&(d=nu(t,r,e.charAt(o+1)==="2"),d==null))return"";a[a.length]={t:"X",v:e.substr(o,2)},c=l,o+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":l=l.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0||d==null&&(d=nu(t,r),d==null))return"";for(i=l;++o<e.length&&e.charAt(o).toLowerCase()===l;)i+=l;l==="m"&&c.toLowerCase()==="h"&&(l="M"),l==="h"&&(l=p),a[a.length]={t:l,v:i},c=l;break;case"A":case"a":case"":var g={t:l,v:l};if(d==null&&(d=nu(t,r)),e.substr(o,3).toUpperCase()==="A/P"?(d!=null&&(g.v=d.H>=12?"P":"A"),g.t="T",p="h",o+=3):e.substr(o,5).toUpperCase()==="AM/PM"?(d!=null&&(g.v=d.H>=12?"PM":"AM"),g.t="T",o+=5,p="h"):e.substr(o,5).toUpperCase()==="/"?(d!=null&&(g.v=d.H>=12?"":""),g.t="T",o+=5,p="h"):(g.t="t",++o),d==null&&g.t==="T")return"";a[a.length]=g,c=l;break;case"[":for(i=l;e.charAt(o++)!=="]"&&o<e.length;)i+=e.charAt(o);if(i.slice(-1)!=="]")throw'unterminated "[" block: |'+i+"|";if(i.match(wA)){if(d==null&&(d=nu(t,r),d==null))return"";a[a.length]={t:"Z",v:i.toLowerCase()},c=i.charAt(1)}else i.indexOf("$")>-1&&(i=(i.match(/\$([^-\[\]]*)/)||[])[1]||"$",j0(e)||(a[a.length]={t:"t",v:i}));break;case".":if(d!=null){for(i=l;++o<e.length&&(l=e.charAt(o))==="0";)i+=l;a[a.length]={t:"s",v:i};break}case"0":case"#":for(i=l;++o<e.length&&"0#?.,E+-%".indexOf(l=e.charAt(o))>-1;)i+=l;a[a.length]={t:"n",v:i};break;case"?":for(i=l;e.charAt(++o)===l;)i+=l;a[a.length]={t:l,v:i},c=l;break;case"*":++o,(e.charAt(o)==" "||e.charAt(o)=="*")&&++o;break;case"(":case")":a[a.length]={t:s===1?"t":l,v:l},++o;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(i=l;o<e.length&&"0123456789".indexOf(e.charAt(++o))>-1;)i+=e.charAt(o);a[a.length]={t:"D",v:i};break;case" ":a[a.length]={t:l,v:l},++o;break;case"$":a[a.length]={t:"t",v:"$"},++o;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(l)===-1)throw new Error("unrecognized character "+l+" in "+e);a[a.length]={t:"t",v:l},++o;break}var y=0,m=0,w;for(o=a.length-1,c="t";o>=0;--o)switch(a[o].t){case"h":case"H":a[o].t=p,c="h",y<1&&(y=1);break;case"s":(w=a[o].v.match(/\.0+$/))&&(m=Math.max(m,w[0].length-1)),y<3&&(y=3);case"d":case"y":case"M":case"e":c=a[o].t;break;case"m":c==="s"&&(a[o].t="M",y<2&&(y=2));break;case"X":break;case"Z":y<1&&a[o].v.match(/[Hh]/)&&(y=1),y<2&&a[o].v.match(/[Mm]/)&&(y=2),y<3&&a[o].v.match(/[Ss]/)&&(y=3)}switch(y){case 0:break;case 1:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M),d.M>=60&&(d.M=0,++d.H);break;case 2:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M);break}var S="",k;for(o=0;o<a.length;++o)switch(a[o].t){case"t":case"T":case" ":case"D":break;case"X":a[o].v="",a[o].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":a[o].v=ZP(a[o].t.charCodeAt(0),a[o].v,d,m),a[o].t="t";break;case"n":case"?":for(k=o+1;a[k]!=null&&((l=a[k].t)==="?"||l==="D"||(l===" "||l==="t")&&a[k+1]!=null&&(a[k+1].t==="?"||a[k+1].t==="t"&&a[k+1].v==="/")||a[o].t==="("&&(l===" "||l==="n"||l===")")||l==="t"&&(a[k].v==="/"||a[k].v===" "&&a[k+1]!=null&&a[k+1].t=="?"));)a[o].v+=a[k].v,a[k]={v:"",t:";"},++k;S+=a[o].v,o=k-1;break;case"G":a[o].t="t",a[o].v=wu(t,r);break}var F="",L,C;if(S.length>0){S.charCodeAt(0)==40?(L=t<0&&S.charCodeAt(0)===45?-t:t,C=gc("n",S,L)):(L=t<0&&s>1?-t:t,C=gc("n",S,L),L<0&&a[0]&&a[0].t=="t"&&(C=C.substr(1),a[0].v="-"+a[0].v)),k=C.length-1;var O=a.length;for(o=0;o<a.length;++o)if(a[o]!=null&&a[o].t!="t"&&a[o].v.indexOf(".")>-1){O=o;break}var T=a.length;if(O===a.length&&C.indexOf("E")===-1){for(o=a.length-1;o>=0;--o)a[o]==null||"n?".indexOf(a[o].t)===-1||(k>=a[o].v.length-1?(k-=a[o].v.length,a[o].v=C.substr(k+1,a[o].v.length)):k<0?a[o].v="":(a[o].v=C.substr(0,k+1),k=-1),a[o].t="t",T=o);k>=0&&T<a.length&&(a[T].v=C.substr(0,k+1)+a[T].v)}else if(O!==a.length&&C.indexOf("E")===-1){for(k=C.indexOf(".")-1,o=O;o>=0;--o)if(!(a[o]==null||"n?".indexOf(a[o].t)===-1)){for(u=a[o].v.indexOf(".")>-1&&o===O?a[o].v.indexOf(".")-1:a[o].v.length-1,F=a[o].v.substr(u+1);u>=0;--u)k>=0&&(a[o].v.charAt(u)==="0"||a[o].v.charAt(u)==="#")&&(F=C.charAt(k--)+F);a[o].v=F,a[o].t="t",T=o}for(k>=0&&T<a.length&&(a[T].v=C.substr(0,k+1)+a[T].v),k=C.indexOf(".")+1,o=O;o<a.length;++o)if(!(a[o]==null||"n?(".indexOf(a[o].t)===-1&&o!==O)){for(u=a[o].v.indexOf(".")>-1&&o===O?a[o].v.indexOf(".")+1:0,F=a[o].v.substr(0,u);u<a[o].v.length;++u)k<C.length&&(F+=C.charAt(k++));a[o].v=F,a[o].t="t",T=o}}}for(o=0;o<a.length;++o)a[o]!=null&&"n?".indexOf(a[o].t)>-1&&(L=s>1&&t<0&&o>0&&a[o-1].v==="-"?-t:t,a[o].v=gc(a[o].t,a[o].v,L),a[o].t="t");var W="";for(o=0;o!==a.length;++o)a[o]!=null&&(W+=a[o].v);return W}var F_=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function M_(e,t){if(t==null)return!1;var r=parseFloat(t[2]);switch(t[1]){case"=":if(e==r)return!0;break;case">":if(e>r)return!0;break;case"<":if(e<r)return!0;break;case"<>":if(e!=r)return!0;break;case">=":if(e>=r)return!0;break;case"<=":if(e<=r)return!0;break}return!1}function dO(e,t){var r=lO(e),s=r.length,a=r[s-1].indexOf("@");if(s<4&&a>-1&&--s,r.length>4)throw new Error("cannot find right format for |"+r.join("|")+"|");if(typeof t!="number")return[4,r.length===4||a>-1?r[r.length-1]:"@"];switch(r.length){case 1:r=a>-1?["General","General","General",r[0]]:[r[0],r[0],r[0],"@"];break;case 2:r=a>-1?[r[0],r[0],r[0],r[1]]:[r[0],r[1],r[0],"@"];break;case 3:r=a>-1?[r[0],r[1],r[0],r[2]]:[r[0],r[1],r[2],"@"];break}var i=t>0?r[0]:t<0?r[1]:r[2];if(r[0].indexOf("[")===-1&&r[1].indexOf("[")===-1)return[s,i];if(r[0].match(/\[[=<>]/)!=null||r[1].match(/\[[=<>]/)!=null){var o=r[0].match(F_),l=r[1].match(F_);return M_(t,o)?[s,r[0]]:M_(t,l)?[s,r[1]]:[s,r[o!=null&&l!=null?2:1]]}return[s,i]}function Yo(e,t,r){r==null&&(r={});var s="";switch(typeof e){case"string":e=="m/d/yy"&&r.dateNF?s=r.dateNF:s=e;break;case"number":e==14&&r.dateNF?s=r.dateNF:s=(r.table!=null?r.table:vn)[e],s==null&&(s=r.table&&r.table[E_[e]]||vn[E_[e]]),s==null&&(s=VP[e]||"General");break}if(v1(s,0))return wu(t,r);t instanceof Date&&(t=hA(t,r.date1904));var a=dO(s,t);if(v1(a[1]))return wu(t,r);if(t===!0)t="TRUE";else if(t===!1)t="FALSE";else if(t===""||t==null)return"";return cO(a[1],t,r,a[0])}function yc(e,t){if(typeof t!="number"){t=+t||-1;for(var r=0;r<392;++r){if(vn[r]==null){t<0&&(t=r);continue}if(vn[r]==e){t=r;break}}t<0&&(t=391)}return vn[t]=e,t}function fg(e){for(var t=0;t!=392;++t)e[t]!==void 0&&yc(e[t],t)}function N0(){vn=HP()}var uO={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},SA=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function fO(e){var t=typeof e=="number"?vn[e]:e;return t=t.replace(SA,"(\\d+)"),new RegExp("^"+t+"$")}function hO(e,t,r){var s=-1,a=-1,i=-1,o=-1,l=-1,c=-1;(t.match(SA)||[]).forEach(function(h,p){var f=parseInt(r[p+1],10);switch(h.toLowerCase().charAt(0)){case"y":s=f;break;case"d":i=f;break;case"h":o=f;break;case"s":c=f;break;case"m":o>=0?l=f:a=f;break}}),c>=0&&l==-1&&a>=0&&(l=a,a=-1);var d=(""+(s>=0?s:new Date().getFullYear())).slice(-4)+"-"+("00"+(a>=1?a:1)).slice(-2)+"-"+("00"+(i>=1?i:1)).slice(-2);d.length==7&&(d="0"+d),d.length==8&&(d="20"+d);var u=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return o==-1&&l==-1&&c==-1?d:s==-1&&a==-1&&i==-1?u:d+"T"+u}var pO=function(){var e={};e.version="1.2.0";function t(){for(var C=0,O=new Array(256),T=0;T!=256;++T)C=T,C=C&1?-306674912^C>>>1:C>>>1,C=C&1?-306674912^C>>>1:C>>>1,C=C&1?-306674912^C>>>1:C>>>1,C=C&1?-306674912^C>>>1:C>>>1,C=C&1?-306674912^C>>>1:C>>>1,C=C&1?-306674912^C>>>1:C>>>1,C=C&1?-306674912^C>>>1:C>>>1,C=C&1?-306674912^C>>>1:C>>>1,O[T]=C;return typeof Int32Array<"u"?new Int32Array(O):O}var r=t();function s(C){var O=0,T=0,W=0,A=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(W=0;W!=256;++W)A[W]=C[W];for(W=0;W!=256;++W)for(T=C[W],O=256+W;O<4096;O+=256)T=A[O]=T>>>8^C[T&255];var N=[];for(W=1;W!=16;++W)N[W-1]=typeof Int32Array<"u"?A.subarray(W*256,W*256+256):A.slice(W*256,W*256+256);return N}var a=s(r),i=a[0],o=a[1],l=a[2],c=a[3],d=a[4],u=a[5],h=a[6],p=a[7],f=a[8],x=a[9],g=a[10],y=a[11],m=a[12],w=a[13],S=a[14];function k(C,O){for(var T=O^-1,W=0,A=C.length;W<A;)T=T>>>8^r[(T^C.charCodeAt(W++))&255];return~T}function F(C,O){for(var T=O^-1,W=C.length-15,A=0;A<W;)T=S[C[A++]^T&255]^w[C[A++]^T>>8&255]^m[C[A++]^T>>16&255]^y[C[A++]^T>>>24]^g[C[A++]]^x[C[A++]]^f[C[A++]]^p[C[A++]]^h[C[A++]]^u[C[A++]]^d[C[A++]]^c[C[A++]]^l[C[A++]]^o[C[A++]]^i[C[A++]]^r[C[A++]];for(W+=15;A<W;)T=T>>>8^r[(T^C[A++])&255];return~T}function L(C,O){for(var T=O^-1,W=0,A=C.length,N=0,P=0;W<A;)N=C.charCodeAt(W++),N<128?T=T>>>8^r[(T^N)&255]:N<2048?(T=T>>>8^r[(T^(192|N>>6&31))&255],T=T>>>8^r[(T^(128|N&63))&255]):N>=55296&&N<57344?(N=(N&1023)+64,P=C.charCodeAt(W++)&1023,T=T>>>8^r[(T^(240|N>>8&7))&255],T=T>>>8^r[(T^(128|N>>2&63))&255],T=T>>>8^r[(T^(128|P>>6&15|(N&3)<<4))&255],T=T>>>8^r[(T^(128|P&63))&255]):(T=T>>>8^r[(T^(224|N>>12&15))&255],T=T>>>8^r[(T^(128|N>>6&63))&255],T=T>>>8^r[(T^(128|N&63))&255]);return~T}return e.table=r,e.bstr=k,e.buf=F,e.str=L,e}(),mn=function(){var t={};t.version="1.2.1";function r(Z,pe){for(var ee=Z.split("/"),ue=pe.split("/"),Ae=0,Le=0,ct=Math.min(ee.length,ue.length);Ae<ct;++Ae){if(Le=ee[Ae].length-ue[Ae].length)return Le;if(ee[Ae]!=ue[Ae])return ee[Ae]<ue[Ae]?-1:1}return ee.length-ue.length}function s(Z){if(Z.charAt(Z.length-1)=="/")return Z.slice(0,-1).indexOf("/")===-1?Z:s(Z.slice(0,-1));var pe=Z.lastIndexOf("/");return pe===-1?Z:Z.slice(0,pe+1)}function a(Z){if(Z.charAt(Z.length-1)=="/")return a(Z.slice(0,-1));var pe=Z.lastIndexOf("/");return pe===-1?Z:Z.slice(pe+1)}function i(Z,pe){typeof pe=="string"&&(pe=new Date(pe));var ee=pe.getHours();ee=ee<<6|pe.getMinutes(),ee=ee<<5|pe.getSeconds()>>>1,Z.write_shift(2,ee);var ue=pe.getFullYear()-1980;ue=ue<<4|pe.getMonth()+1,ue=ue<<5|pe.getDate(),Z.write_shift(2,ue)}function o(Z){var pe=Z.read_shift(2)&65535,ee=Z.read_shift(2)&65535,ue=new Date,Ae=ee&31;ee>>>=5;var Le=ee&15;ee>>>=4,ue.setMilliseconds(0),ue.setFullYear(ee+1980),ue.setMonth(Le-1),ue.setDate(Ae);var ct=pe&31;pe>>>=5;var ce=pe&63;return pe>>>=6,ue.setHours(pe),ue.setMinutes(ce),ue.setSeconds(ct<<1),ue}function l(Z){Ja(Z,0);for(var pe={},ee=0;Z.l<=Z.length-4;){var ue=Z.read_shift(2),Ae=Z.read_shift(2),Le=Z.l+Ae,ct={};switch(ue){case 21589:ee=Z.read_shift(1),ee&1&&(ct.mtime=Z.read_shift(4)),Ae>5&&(ee&2&&(ct.atime=Z.read_shift(4)),ee&4&&(ct.ctime=Z.read_shift(4))),ct.mtime&&(ct.mt=new Date(ct.mtime*1e3));break}Z.l=Le,pe[ue]=ct}return pe}var c;function d(){return c||(c={})}function u(Z,pe){if(Z[0]==80&&Z[1]==75)return gr(Z,pe);if((Z[0]|32)==109&&(Z[1]|32)==105)return qe(Z,pe);if(Z.length<512)throw new Error("CFB file size "+Z.length+" < 512");var ee=3,ue=512,Ae=0,Le=0,ct=0,ce=0,xe=0,se=[],Se=Z.slice(0,512);Ja(Se,0);var Ze=h(Se);switch(ee=Ze[0],ee){case 3:ue=512;break;case 4:ue=4096;break;case 0:if(Ze[1]==0)return gr(Z,pe);default:throw new Error("Major Version: Expected 3 or 4 saw "+ee)}ue!==512&&(Se=Z.slice(0,ue),Ja(Se,28));var et=Z.slice(0,ue);p(Se,ee);var Et=Se.read_shift(4,"i");if(ee===3&&Et!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Et);Se.l+=4,ct=Se.read_shift(4,"i"),Se.l+=4,Se.chk("00100000","Mini Stream Cutoff Size: "),ce=Se.read_shift(4,"i"),Ae=Se.read_shift(4,"i"),xe=Se.read_shift(4,"i"),Le=Se.read_shift(4,"i");for(var wt=-1,gt=0;gt<109&&(wt=Se.read_shift(4,"i"),!(wt<0));++gt)se[gt]=wt;var zt=f(Z,ue);y(xe,Le,zt,ue,se);var Dt=w(zt,ct,se,ue);Dt[ct].name="!Directory",Ae>0&&ce!==P&&(Dt[ce].name="!MiniFAT"),Dt[se[0]].name="!FAT",Dt.fat_addrs=se,Dt.ssz=ue;var mr={},pt=[],Xt=[],Rt=[];S(ct,Dt,zt,pt,Ae,mr,Xt,ce),x(Xt,Rt,pt),pt.shift();var _t={FileIndex:Xt,FullPaths:Rt};return pe&&pe.raw&&(_t.raw={header:et,sectors:zt}),_t}function h(Z){if(Z[Z.l]==80&&Z[Z.l+1]==75)return[0,0];Z.chk(K,"Header Signature: "),Z.l+=16;var pe=Z.read_shift(2,"u");return[Z.read_shift(2,"u"),pe]}function p(Z,pe){var ee=9;switch(Z.l+=2,ee=Z.read_shift(2)){case 9:if(pe!=3)throw new Error("Sector Shift: Expected 9 saw "+ee);break;case 12:if(pe!=4)throw new Error("Sector Shift: Expected 12 saw "+ee);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+ee)}Z.chk("0600","Mini Sector Shift: "),Z.chk("000000000000","Reserved: ")}function f(Z,pe){for(var ee=Math.ceil(Z.length/pe)-1,ue=[],Ae=1;Ae<ee;++Ae)ue[Ae-1]=Z.slice(Ae*pe,(Ae+1)*pe);return ue[ee-1]=Z.slice(ee*pe),ue}function x(Z,pe,ee){for(var ue=0,Ae=0,Le=0,ct=0,ce=0,xe=ee.length,se=[],Se=[];ue<xe;++ue)se[ue]=Se[ue]=ue,pe[ue]=ee[ue];for(;ce<Se.length;++ce)ue=Se[ce],Ae=Z[ue].L,Le=Z[ue].R,ct=Z[ue].C,se[ue]===ue&&(Ae!==-1&&se[Ae]!==Ae&&(se[ue]=se[Ae]),Le!==-1&&se[Le]!==Le&&(se[ue]=se[Le])),ct!==-1&&(se[ct]=ue),Ae!==-1&&ue!=se[ue]&&(se[Ae]=se[ue],Se.lastIndexOf(Ae)<ce&&Se.push(Ae)),Le!==-1&&ue!=se[ue]&&(se[Le]=se[ue],Se.lastIndexOf(Le)<ce&&Se.push(Le));for(ue=1;ue<xe;++ue)se[ue]===ue&&(Le!==-1&&se[Le]!==Le?se[ue]=se[Le]:Ae!==-1&&se[Ae]!==Ae&&(se[ue]=se[Ae]));for(ue=1;ue<xe;++ue)if(Z[ue].type!==0){if(ce=ue,ce!=se[ce])do ce=se[ce],pe[ue]=pe[ce]+"/"+pe[ue];while(ce!==0&&se[ce]!==-1&&ce!=se[ce]);se[ue]=-1}for(pe[0]+="/",ue=1;ue<xe;++ue)Z[ue].type!==2&&(pe[ue]+="/")}function g(Z,pe,ee){for(var ue=Z.start,Ae=Z.size,Le=[],ct=ue;ee&&Ae>0&&ct>=0;)Le.push(pe.slice(ct*N,ct*N+N)),Ae-=N,ct=Yd(ee,ct*4);return Le.length===0?xr(0):Ia(Le).slice(0,Z.size)}function y(Z,pe,ee,ue,Ae){var Le=P;if(Z===P){if(pe!==0)throw new Error("DIFAT chain shorter than expected")}else if(Z!==-1){var ct=ee[Z],ce=(ue>>>2)-1;if(!ct)return;for(var xe=0;xe<ce&&(Le=Yd(ct,xe*4))!==P;++xe)Ae.push(Le);y(Yd(ct,ue-4),pe-1,ee,ue,Ae)}}function m(Z,pe,ee,ue,Ae){var Le=[],ct=[];Ae||(Ae=[]);var ce=ue-1,xe=0,se=0;for(xe=pe;xe>=0;){Ae[xe]=!0,Le[Le.length]=xe,ct.push(Z[xe]);var Se=ee[Math.floor(xe*4/ue)];if(se=xe*4&ce,ue<4+se)throw new Error("FAT boundary crossed: "+xe+" 4 "+ue);if(!Z[Se])break;xe=Yd(Z[Se],se)}return{nodes:Le,data:H_([ct])}}function w(Z,pe,ee,ue){var Ae=Z.length,Le=[],ct=[],ce=[],xe=[],se=ue-1,Se=0,Ze=0,et=0,Et=0;for(Se=0;Se<Ae;++Se)if(ce=[],et=Se+pe,et>=Ae&&(et-=Ae),!ct[et]){xe=[];var wt=[];for(Ze=et;Ze>=0;){wt[Ze]=!0,ct[Ze]=!0,ce[ce.length]=Ze,xe.push(Z[Ze]);var gt=ee[Math.floor(Ze*4/ue)];if(Et=Ze*4&se,ue<4+Et)throw new Error("FAT boundary crossed: "+Ze+" 4 "+ue);if(!Z[gt]||(Ze=Yd(Z[gt],Et),wt[Ze]))break}Le[et]={nodes:ce,data:H_([xe])}}return Le}function S(Z,pe,ee,ue,Ae,Le,ct,ce){for(var xe=0,se=ue.length?2:0,Se=pe[Z].data,Ze=0,et=0,Et;Ze<Se.length;Ze+=128){var wt=Se.slice(Ze,Ze+128);Ja(wt,64),et=wt.read_shift(2),Et=xw(wt,0,et-se),ue.push(Et);var gt={name:Et,type:wt.read_shift(1),color:wt.read_shift(1),L:wt.read_shift(4,"i"),R:wt.read_shift(4,"i"),C:wt.read_shift(4,"i"),clsid:wt.read_shift(16),state:wt.read_shift(4,"i"),start:0,size:0},zt=wt.read_shift(2)+wt.read_shift(2)+wt.read_shift(2)+wt.read_shift(2);zt!==0&&(gt.ct=k(wt,wt.l-8));var Dt=wt.read_shift(2)+wt.read_shift(2)+wt.read_shift(2)+wt.read_shift(2);Dt!==0&&(gt.mt=k(wt,wt.l-8)),gt.start=wt.read_shift(4,"i"),gt.size=wt.read_shift(4,"i"),gt.size<0&&gt.start<0&&(gt.size=gt.type=0,gt.start=P,gt.name=""),gt.type===5?(xe=gt.start,Ae>0&&xe!==P&&(pe[xe].name="!StreamData")):gt.size>=4096?(gt.storage="fat",pe[gt.start]===void 0&&(pe[gt.start]=m(ee,gt.start,pe.fat_addrs,pe.ssz)),pe[gt.start].name=gt.name,gt.content=pe[gt.start].data.slice(0,gt.size)):(gt.storage="minifat",gt.size<0?gt.size=0:xe!==P&&gt.start!==P&&pe[xe]&&(gt.content=g(gt,pe[xe].data,(pe[ce]||{}).data))),gt.content&&Ja(gt.content,0),Le[Et]=gt,ct.push(gt)}}function k(Z,pe){return new Date((xo(Z,pe+4)/1e7*Math.pow(2,32)+xo(Z,pe)/1e7-11644473600)*1e3)}function F(Z,pe){return d(),u(c.readFileSync(Z),pe)}function L(Z,pe){var ee=pe&&pe.type;switch(ee||Un&&Buffer.isBuffer(Z)&&(ee="buffer"),ee||"base64"){case"file":return F(Z,pe);case"base64":return u(go(ko(Z)),pe);case"binary":return u(go(Z),pe)}return u(Z,pe)}function C(Z,pe){var ee=pe||{},ue=ee.root||"Root Entry";if(Z.FullPaths||(Z.FullPaths=[]),Z.FileIndex||(Z.FileIndex=[]),Z.FullPaths.length!==Z.FileIndex.length)throw new Error("inconsistent CFB structure");Z.FullPaths.length===0&&(Z.FullPaths[0]=ue+"/",Z.FileIndex[0]={name:ue,type:5}),ee.CLSID&&(Z.FileIndex[0].clsid=ee.CLSID),O(Z)}function O(Z){var pe="Sh33tJ5";if(!mn.find(Z,"/"+pe)){var ee=xr(4);ee[0]=55,ee[1]=ee[3]=50,ee[2]=54,Z.FileIndex.push({name:pe,type:2,content:ee,size:4,L:69,R:69,C:69}),Z.FullPaths.push(Z.FullPaths[0]+pe),T(Z)}}function T(Z,pe){C(Z);for(var ee=!1,ue=!1,Ae=Z.FullPaths.length-1;Ae>=0;--Ae){var Le=Z.FileIndex[Ae];switch(Le.type){case 0:ue?ee=!0:(Z.FileIndex.pop(),Z.FullPaths.pop());break;case 1:case 2:case 5:ue=!0,isNaN(Le.R*Le.L*Le.C)&&(ee=!0),Le.R>-1&&Le.L>-1&&Le.R==Le.L&&(ee=!0);break;default:ee=!0;break}}if(!(!ee&&!pe)){var ct=new Date(1987,1,19),ce=0,xe=Object.create?Object.create(null):{},se=[];for(Ae=0;Ae<Z.FullPaths.length;++Ae)xe[Z.FullPaths[Ae]]=!0,Z.FileIndex[Ae].type!==0&&se.push([Z.FullPaths[Ae],Z.FileIndex[Ae]]);for(Ae=0;Ae<se.length;++Ae){var Se=s(se[Ae][0]);ue=xe[Se],ue||(se.push([Se,{name:a(Se).replace("/",""),type:1,clsid:ge,ct,mt:ct,content:null}]),xe[Se]=!0)}for(se.sort(function(Et,wt){return r(Et[0],wt[0])}),Z.FullPaths=[],Z.FileIndex=[],Ae=0;Ae<se.length;++Ae)Z.FullPaths[Ae]=se[Ae][0],Z.FileIndex[Ae]=se[Ae][1];for(Ae=0;Ae<se.length;++Ae){var Ze=Z.FileIndex[Ae],et=Z.FullPaths[Ae];if(Ze.name=a(et).replace("/",""),Ze.L=Ze.R=Ze.C=-(Ze.color=1),Ze.size=Ze.content?Ze.content.length:0,Ze.start=0,Ze.clsid=Ze.clsid||ge,Ae===0)Ze.C=se.length>1?1:-1,Ze.size=0,Ze.type=5;else if(et.slice(-1)=="/"){for(ce=Ae+1;ce<se.length&&s(Z.FullPaths[ce])!=et;++ce);for(Ze.C=ce>=se.length?-1:ce,ce=Ae+1;ce<se.length&&s(Z.FullPaths[ce])!=s(et);++ce);Ze.R=ce>=se.length?-1:ce,Ze.type=1}else s(Z.FullPaths[Ae+1]||"")==s(et)&&(Ze.R=Ae+1),Ze.type=2}}}function W(Z,pe){var ee=pe||{};if(ee.fileType=="mad")return Lt(Z,ee);switch(T(Z),ee.fileType){case"zip":return $r(Z,ee)}var ue=function(Et){for(var wt=0,gt=0,zt=0;zt<Et.FileIndex.length;++zt){var Dt=Et.FileIndex[zt];if(Dt.content){var mr=Dt.content.length;mr>0&&(mr<4096?wt+=mr+63>>6:gt+=mr+511>>9)}}for(var pt=Et.FullPaths.length+3>>2,Xt=wt+7>>3,Rt=wt+127>>7,_t=Xt+gt+pt+Rt,jr=_t+127>>7,Gr=jr<=109?0:Math.ceil((jr-109)/127);_t+jr+Gr+127>>7>jr;)Gr=++jr<=109?0:Math.ceil((jr-109)/127);var Cr=[1,Gr,jr,Rt,pt,gt,wt,0];return Et.FileIndex[0].size=wt<<6,Cr[7]=(Et.FileIndex[0].start=Cr[0]+Cr[1]+Cr[2]+Cr[3]+Cr[4]+Cr[5])+(Cr[6]+7>>3),Cr}(Z),Ae=xr(ue[7]<<9),Le=0,ct=0;{for(Le=0;Le<8;++Le)Ae.write_shift(1,re[Le]);for(Le=0;Le<8;++Le)Ae.write_shift(2,0);for(Ae.write_shift(2,62),Ae.write_shift(2,3),Ae.write_shift(2,65534),Ae.write_shift(2,9),Ae.write_shift(2,6),Le=0;Le<3;++Le)Ae.write_shift(2,0);for(Ae.write_shift(4,0),Ae.write_shift(4,ue[2]),Ae.write_shift(4,ue[0]+ue[1]+ue[2]+ue[3]-1),Ae.write_shift(4,0),Ae.write_shift(4,4096),Ae.write_shift(4,ue[3]?ue[0]+ue[1]+ue[2]-1:P),Ae.write_shift(4,ue[3]),Ae.write_shift(-4,ue[1]?ue[0]-1:P),Ae.write_shift(4,ue[1]),Le=0;Le<109;++Le)Ae.write_shift(-4,Le<ue[2]?ue[1]+Le:-1)}if(ue[1])for(ct=0;ct<ue[1];++ct){for(;Le<236+ct*127;++Le)Ae.write_shift(-4,Le<ue[2]?ue[1]+Le:-1);Ae.write_shift(-4,ct===ue[1]-1?P:ct+1)}var ce=function(Et){for(ct+=Et;Le<ct-1;++Le)Ae.write_shift(-4,Le+1);Et&&(++Le,Ae.write_shift(-4,P))};for(ct=Le=0,ct+=ue[1];Le<ct;++Le)Ae.write_shift(-4,Fe.DIFSECT);for(ct+=ue[2];Le<ct;++Le)Ae.write_shift(-4,Fe.FATSECT);ce(ue[3]),ce(ue[4]);for(var xe=0,se=0,Se=Z.FileIndex[0];xe<Z.FileIndex.length;++xe)Se=Z.FileIndex[xe],Se.content&&(se=Se.content.length,!(se<4096)&&(Se.start=ct,ce(se+511>>9)));for(ce(ue[6]+7>>3);Ae.l&511;)Ae.write_shift(-4,Fe.ENDOFCHAIN);for(ct=Le=0,xe=0;xe<Z.FileIndex.length;++xe)Se=Z.FileIndex[xe],Se.content&&(se=Se.content.length,!(!se||se>=4096)&&(Se.start=ct,ce(se+63>>6)));for(;Ae.l&511;)Ae.write_shift(-4,Fe.ENDOFCHAIN);for(Le=0;Le<ue[4]<<2;++Le){var Ze=Z.FullPaths[Le];if(!Ze||Ze.length===0){for(xe=0;xe<17;++xe)Ae.write_shift(4,0);for(xe=0;xe<3;++xe)Ae.write_shift(4,-1);for(xe=0;xe<12;++xe)Ae.write_shift(4,0);continue}Se=Z.FileIndex[Le],Le===0&&(Se.start=Se.size?Se.start-1:P);var et=Le===0&&ee.root||Se.name;if(se=2*(et.length+1),Ae.write_shift(64,et,"utf16le"),Ae.write_shift(2,se),Ae.write_shift(1,Se.type),Ae.write_shift(1,Se.color),Ae.write_shift(-4,Se.L),Ae.write_shift(-4,Se.R),Ae.write_shift(-4,Se.C),Se.clsid)Ae.write_shift(16,Se.clsid,"hex");else for(xe=0;xe<4;++xe)Ae.write_shift(4,0);Ae.write_shift(4,Se.state||0),Ae.write_shift(4,0),Ae.write_shift(4,0),Ae.write_shift(4,0),Ae.write_shift(4,0),Ae.write_shift(4,Se.start),Ae.write_shift(4,Se.size),Ae.write_shift(4,0)}for(Le=1;Le<Z.FileIndex.length;++Le)if(Se=Z.FileIndex[Le],Se.size>=4096)if(Ae.l=Se.start+1<<9,Un&&Buffer.isBuffer(Se.content))Se.content.copy(Ae,Ae.l,0,Se.size),Ae.l+=Se.size+511&-512;else{for(xe=0;xe<Se.size;++xe)Ae.write_shift(1,Se.content[xe]);for(;xe&511;++xe)Ae.write_shift(1,0)}for(Le=1;Le<Z.FileIndex.length;++Le)if(Se=Z.FileIndex[Le],Se.size>0&&Se.size<4096)if(Un&&Buffer.isBuffer(Se.content))Se.content.copy(Ae,Ae.l,0,Se.size),Ae.l+=Se.size+63&-64;else{for(xe=0;xe<Se.size;++xe)Ae.write_shift(1,Se.content[xe]);for(;xe&63;++xe)Ae.write_shift(1,0)}if(Un)Ae.l=Ae.length;else for(;Ae.l<Ae.length;)Ae.write_shift(1,0);return Ae}function A(Z,pe){var ee=Z.FullPaths.map(function(xe){return xe.toUpperCase()}),ue=ee.map(function(xe){var se=xe.split("/");return se[se.length-(xe.slice(-1)=="/"?2:1)]}),Ae=!1;pe.charCodeAt(0)===47?(Ae=!0,pe=ee[0].slice(0,-1)+pe):Ae=pe.indexOf("/")!==-1;var Le=pe.toUpperCase(),ct=Ae===!0?ee.indexOf(Le):ue.indexOf(Le);if(ct!==-1)return Z.FileIndex[ct];var ce=!Le.match(yh);for(Le=Le.replace(Li,""),ce&&(Le=Le.replace(yh,"!")),ct=0;ct<ee.length;++ct)if((ce?ee[ct].replace(yh,"!"):ee[ct]).replace(Li,"")==Le||(ce?ue[ct].replace(yh,"!"):ue[ct]).replace(Li,"")==Le)return Z.FileIndex[ct];return null}var N=64,P=-2,K="d0cf11e0a1b11ae1",re=[208,207,17,224,161,177,26,225],ge="00000000000000000000000000000000",Fe={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:P,FREESECT:-1,HEADER_SIGNATURE:K,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:ge,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function R(Z,pe,ee){d();var ue=W(Z,ee);c.writeFileSync(pe,ue)}function q(Z){for(var pe=new Array(Z.length),ee=0;ee<Z.length;++ee)pe[ee]=String.fromCharCode(Z[ee]);return pe.join("")}function me(Z,pe){var ee=W(Z,pe);switch(pe&&pe.type||"buffer"){case"file":return d(),c.writeFileSync(pe.filename,ee),ee;case"binary":return typeof ee=="string"?ee:q(ee);case"base64":return dp(typeof ee=="string"?ee:q(ee));case"buffer":if(Un)return Buffer.isBuffer(ee)?ee:Tc(ee);case"array":return typeof ee=="string"?go(ee):ee}return ee}var fe;function E(Z){try{var pe=Z.InflateRaw,ee=new pe;if(ee._processChunk(new Uint8Array([3,0]),ee._finishFlushFlag),ee.bytesRead)fe=Z;else throw new Error("zlib does not expose bytesRead")}catch(ue){console.error("cannot use native zlib: "+(ue.message||ue))}}function U(Z,pe){if(!fe)return It(Z,pe);var ee=fe.InflateRaw,ue=new ee,Ae=ue._processChunk(Z.slice(Z.l),ue._finishFlushFlag);return Z.l+=ue.bytesRead,Ae}function I(Z){return fe?fe.deflateRawSync(Z):we(Z)}var M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],te=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function G(Z){var pe=(Z<<1|Z<<11)&139536|(Z<<5|Z<<15)&558144;return(pe>>16|pe>>8|pe)&255}for(var ne=typeof Uint8Array<"u",z=ne?new Uint8Array(256):[],he=0;he<256;++he)z[he]=G(he);function X(Z,pe){var ee=z[Z&255];return pe<=8?ee>>>8-pe:(ee=ee<<8|z[Z>>8&255],pe<=16?ee>>>16-pe:(ee=ee<<8|z[Z>>16&255],ee>>>24-pe))}function H(Z,pe){var ee=pe&7,ue=pe>>>3;return(Z[ue]|(ee<=6?0:Z[ue+1]<<8))>>>ee&3}function oe(Z,pe){var ee=pe&7,ue=pe>>>3;return(Z[ue]|(ee<=5?0:Z[ue+1]<<8))>>>ee&7}function D(Z,pe){var ee=pe&7,ue=pe>>>3;return(Z[ue]|(ee<=4?0:Z[ue+1]<<8))>>>ee&15}function Y(Z,pe){var ee=pe&7,ue=pe>>>3;return(Z[ue]|(ee<=3?0:Z[ue+1]<<8))>>>ee&31}function le(Z,pe){var ee=pe&7,ue=pe>>>3;return(Z[ue]|(ee<=1?0:Z[ue+1]<<8))>>>ee&127}function $e(Z,pe,ee){var ue=pe&7,Ae=pe>>>3,Le=(1<<ee)-1,ct=Z[Ae]>>>ue;return ee<8-ue||(ct|=Z[Ae+1]<<8-ue,ee<16-ue)||(ct|=Z[Ae+2]<<16-ue,ee<24-ue)||(ct|=Z[Ae+3]<<24-ue),ct&Le}function je(Z,pe,ee){var ue=pe&7,Ae=pe>>>3;return ue<=5?Z[Ae]|=(ee&7)<<ue:(Z[Ae]|=ee<<ue&255,Z[Ae+1]=(ee&7)>>8-ue),pe+3}function We(Z,pe,ee){var ue=pe&7,Ae=pe>>>3;return ee=(ee&1)<<ue,Z[Ae]|=ee,pe+1}function Ee(Z,pe,ee){var ue=pe&7,Ae=pe>>>3;return ee<<=ue,Z[Ae]|=ee&255,ee>>>=8,Z[Ae+1]=ee,pe+8}function Re(Z,pe,ee){var ue=pe&7,Ae=pe>>>3;return ee<<=ue,Z[Ae]|=ee&255,ee>>>=8,Z[Ae+1]=ee&255,Z[Ae+2]=ee>>>8,pe+16}function Ve(Z,pe){var ee=Z.length,ue=2*ee>pe?2*ee:pe+5,Ae=0;if(ee>=pe)return Z;if(Un){var Le=N_(ue);if(Z.copy)Z.copy(Le);else for(;Ae<Z.length;++Ae)Le[Ae]=Z[Ae];return Le}else if(ne){var ct=new Uint8Array(ue);if(ct.set)ct.set(Z);else for(;Ae<ee;++Ae)ct[Ae]=Z[Ae];return ct}return Z.length=ue,Z}function St(Z){for(var pe=new Array(Z),ee=0;ee<Z;++ee)pe[ee]=0;return pe}function rt(Z,pe,ee){var ue=1,Ae=0,Le=0,ct=0,ce=0,xe=Z.length,se=ne?new Uint16Array(32):St(32);for(Le=0;Le<32;++Le)se[Le]=0;for(Le=xe;Le<ee;++Le)Z[Le]=0;xe=Z.length;var Se=ne?new Uint16Array(xe):St(xe);for(Le=0;Le<xe;++Le)se[Ae=Z[Le]]++,ue<Ae&&(ue=Ae),Se[Le]=0;for(se[0]=0,Le=1;Le<=ue;++Le)se[Le+16]=ce=ce+se[Le-1]<<1;for(Le=0;Le<xe;++Le)ce=Z[Le],ce!=0&&(Se[Le]=se[ce+16]++);var Ze=0;for(Le=0;Le<xe;++Le)if(Ze=Z[Le],Ze!=0)for(ce=X(Se[Le],ue)>>ue-Ze,ct=(1<<ue+4-Ze)-1;ct>=0;--ct)pe[ce|ct<<Ze]=Ze&15|Le<<4;return ue}var ze=ne?new Uint16Array(512):St(512),Ie=ne?new Uint16Array(32):St(32);if(!ne){for(var ot=0;ot<512;++ot)ze[ot]=0;for(ot=0;ot<32;++ot)Ie[ot]=0}(function(){for(var Z=[],pe=0;pe<32;pe++)Z.push(5);rt(Z,Ie,32);var ee=[];for(pe=0;pe<=143;pe++)ee.push(8);for(;pe<=255;pe++)ee.push(9);for(;pe<=279;pe++)ee.push(7);for(;pe<=287;pe++)ee.push(8);rt(ee,ze,288)})();var be=function(){for(var pe=ne?new Uint8Array(32768):[],ee=0,ue=0;ee<Q.length-1;++ee)for(;ue<Q[ee+1];++ue)pe[ue]=ee;for(;ue<32768;++ue)pe[ue]=29;var Ae=ne?new Uint8Array(259):[];for(ee=0,ue=0;ee<te.length-1;++ee)for(;ue<te[ee+1];++ue)Ae[ue]=ee;function Le(ce,xe){for(var se=0;se<ce.length;){var Se=Math.min(65535,ce.length-se),Ze=se+Se==ce.length;for(xe.write_shift(1,+Ze),xe.write_shift(2,Se),xe.write_shift(2,~Se&65535);Se-- >0;)xe[xe.l++]=ce[se++]}return xe.l}function ct(ce,xe){for(var se=0,Se=0,Ze=ne?new Uint16Array(32768):[];Se<ce.length;){var et=Math.min(65535,ce.length-Se);if(et<10){for(se=je(xe,se,+(Se+et==ce.length)),se&7&&(se+=8-(se&7)),xe.l=se/8|0,xe.write_shift(2,et),xe.write_shift(2,~et&65535);et-- >0;)xe[xe.l++]=ce[Se++];se=xe.l*8;continue}se=je(xe,se,+(Se+et==ce.length)+2);for(var Et=0;et-- >0;){var wt=ce[Se];Et=(Et<<5^wt)&32767;var gt=-1,zt=0;if((gt=Ze[Et])&&(gt|=Se&-32768,gt>Se&&(gt-=32768),gt<Se))for(;ce[gt+zt]==ce[Se+zt]&&zt<250;)++zt;if(zt>2){wt=Ae[zt],wt<=22?se=Ee(xe,se,z[wt+1]>>1)-1:(Ee(xe,se,3),se+=5,Ee(xe,se,z[wt-23]>>5),se+=3);var Dt=wt<8?0:wt-4>>2;Dt>0&&(Re(xe,se,zt-te[wt]),se+=Dt),wt=pe[Se-gt],se=Ee(xe,se,z[wt]>>3),se-=3;var mr=wt<4?0:wt-2>>1;mr>0&&(Re(xe,se,Se-gt-Q[wt]),se+=mr);for(var pt=0;pt<zt;++pt)Ze[Et]=Se&32767,Et=(Et<<5^ce[Se])&32767,++Se;et-=zt-1}else wt<=143?wt=wt+48:se=We(xe,se,1),se=Ee(xe,se,z[wt]),Ze[Et]=Se&32767,++Se}se=Ee(xe,se,0)-1}return xe.l=(se+7)/8|0,xe.l}return function(xe,se){return xe.length<8?Le(xe,se):ct(xe,se)}}();function we(Z){var pe=xr(50+Math.floor(Z.length*1.1)),ee=be(Z,pe);return pe.slice(0,ee)}var Me=ne?new Uint16Array(32768):St(32768),Wt=ne?new Uint16Array(32768):St(32768),Ct=ne?new Uint16Array(128):St(128),pr=1,fr=1;function Be(Z,pe){var ee=Y(Z,pe)+257;pe+=5;var ue=Y(Z,pe)+1;pe+=5;var Ae=D(Z,pe)+4;pe+=4;for(var Le=0,ct=ne?new Uint8Array(19):St(19),ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],xe=1,se=ne?new Uint8Array(8):St(8),Se=ne?new Uint8Array(8):St(8),Ze=ct.length,et=0;et<Ae;++et)ct[M[et]]=Le=oe(Z,pe),xe<Le&&(xe=Le),se[Le]++,pe+=3;var Et=0;for(se[0]=0,et=1;et<=xe;++et)Se[et]=Et=Et+se[et-1]<<1;for(et=0;et<Ze;++et)(Et=ct[et])!=0&&(ce[et]=Se[Et]++);var wt=0;for(et=0;et<Ze;++et)if(wt=ct[et],wt!=0){Et=z[ce[et]]>>8-wt;for(var gt=(1<<7-wt)-1;gt>=0;--gt)Ct[Et|gt<<wt]=wt&7|et<<3}var zt=[];for(xe=1;zt.length<ee+ue;)switch(Et=Ct[le(Z,pe)],pe+=Et&7,Et>>>=3){case 16:for(Le=3+H(Z,pe),pe+=2,Et=zt[zt.length-1];Le-- >0;)zt.push(Et);break;case 17:for(Le=3+oe(Z,pe),pe+=3;Le-- >0;)zt.push(0);break;case 18:for(Le=11+le(Z,pe),pe+=7;Le-- >0;)zt.push(0);break;default:zt.push(Et),xe<Et&&(xe=Et);break}var Dt=zt.slice(0,ee),mr=zt.slice(ee);for(et=ee;et<286;++et)Dt[et]=0;for(et=ue;et<30;++et)mr[et]=0;return pr=rt(Dt,Me,286),fr=rt(mr,Wt,30),pe}function mt(Z,pe){if(Z[0]==3&&!(Z[1]&3))return[jd(pe),2];for(var ee=0,ue=0,Ae=N_(pe||1<<18),Le=0,ct=Ae.length>>>0,ce=0,xe=0;!(ue&1);){if(ue=oe(Z,ee),ee+=3,ue>>>1)ue>>1==1?(ce=9,xe=5):(ee=Be(Z,ee),ce=pr,xe=fr);else{ee&7&&(ee+=8-(ee&7));var se=Z[ee>>>3]|Z[(ee>>>3)+1]<<8;if(ee+=32,se>0)for(!pe&&ct<Le+se&&(Ae=Ve(Ae,Le+se),ct=Ae.length);se-- >0;)Ae[Le++]=Z[ee>>>3],ee+=8;continue}for(;;){!pe&&ct<Le+32767&&(Ae=Ve(Ae,Le+32767),ct=Ae.length);var Se=$e(Z,ee,ce),Ze=ue>>>1==1?ze[Se]:Me[Se];if(ee+=Ze&15,Ze>>>=4,!(Ze>>>8&255))Ae[Le++]=Ze;else{if(Ze==256)break;Ze-=257;var et=Ze<8?0:Ze-4>>2;et>5&&(et=0);var Et=Le+te[Ze];et>0&&(Et+=$e(Z,ee,et),ee+=et),Se=$e(Z,ee,xe),Ze=ue>>>1==1?Ie[Se]:Wt[Se],ee+=Ze&15,Ze>>>=4;var wt=Ze<4?0:Ze-2>>1,gt=Q[Ze];for(wt>0&&(gt+=$e(Z,ee,wt),ee+=wt),!pe&&ct<Et&&(Ae=Ve(Ae,Et+100),ct=Ae.length);Le<Et;)Ae[Le]=Ae[Le-gt],++Le}}}return pe?[Ae,ee+7>>>3]:[Ae.slice(0,Le),ee+7>>>3]}function It(Z,pe){var ee=Z.slice(Z.l||0),ue=mt(ee,pe);return Z.l+=ue[1],ue[0]}function ft(Z,pe){if(Z)typeof console<"u"&&console.error(pe);else throw new Error(pe)}function gr(Z,pe){var ee=Z;Ja(ee,0);var ue=[],Ae=[],Le={FileIndex:ue,FullPaths:Ae};C(Le,{root:pe.root});for(var ct=ee.length-4;(ee[ct]!=80||ee[ct+1]!=75||ee[ct+2]!=5||ee[ct+3]!=6)&&ct>=0;)--ct;ee.l=ct+4,ee.l+=4;var ce=ee.read_shift(2);ee.l+=6;var xe=ee.read_shift(4);for(ee.l=xe,ct=0;ct<ce;++ct){ee.l+=20;var se=ee.read_shift(4),Se=ee.read_shift(4),Ze=ee.read_shift(2),et=ee.read_shift(2),Et=ee.read_shift(2);ee.l+=8;var wt=ee.read_shift(4),gt=l(ee.slice(ee.l+Ze,ee.l+Ze+et));ee.l+=Ze+et+Et;var zt=ee.l;ee.l=wt+4,Mr(ee,se,Se,Le,gt),ee.l=zt}return Le}function Mr(Z,pe,ee,ue,Ae){Z.l+=2;var Le=Z.read_shift(2),ct=Z.read_shift(2),ce=o(Z);if(Le&8257)throw new Error("Unsupported ZIP encryption");for(var xe=Z.read_shift(4),se=Z.read_shift(4),Se=Z.read_shift(4),Ze=Z.read_shift(2),et=Z.read_shift(2),Et="",wt=0;wt<Ze;++wt)Et+=String.fromCharCode(Z[Z.l++]);if(et){var gt=l(Z.slice(Z.l,Z.l+et));(gt[21589]||{}).mt&&(ce=gt[21589].mt),((Ae||{})[21589]||{}).mt&&(ce=Ae[21589].mt)}Z.l+=et;var zt=Z.slice(Z.l,Z.l+se);switch(ct){case 8:zt=U(Z,Se);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+ct)}var Dt=!1;Le&8&&(xe=Z.read_shift(4),xe==134695760&&(xe=Z.read_shift(4),Dt=!0),se=Z.read_shift(4),Se=Z.read_shift(4)),se!=pe&&ft(Dt,"Bad compressed size: "+pe+" != "+se),Se!=ee&&ft(Dt,"Bad uncompressed size: "+ee+" != "+Se),He(ue,Et,zt,{unsafe:!0,mt:ce})}function $r(Z,pe){var ee=pe||{},ue=[],Ae=[],Le=xr(1),ct=ee.compression?8:0,ce=0,xe=0,se=0,Se=0,Ze=0,et=Z.FullPaths[0],Et=et,wt=Z.FileIndex[0],gt=[],zt=0;for(xe=1;xe<Z.FullPaths.length;++xe)if(Et=Z.FullPaths[xe].slice(et.length),wt=Z.FileIndex[xe],!(!wt.size||!wt.content||Et=="Sh33tJ5")){var Dt=Se,mr=xr(Et.length);for(se=0;se<Et.length;++se)mr.write_shift(1,Et.charCodeAt(se)&127);mr=mr.slice(0,mr.l),gt[Ze]=pO.buf(wt.content,0);var pt=wt.content;ct==8&&(pt=I(pt)),Le=xr(30),Le.write_shift(4,67324752),Le.write_shift(2,20),Le.write_shift(2,ce),Le.write_shift(2,ct),wt.mt?i(Le,wt.mt):Le.write_shift(4,0),Le.write_shift(-4,gt[Ze]),Le.write_shift(4,pt.length),Le.write_shift(4,wt.content.length),Le.write_shift(2,mr.length),Le.write_shift(2,0),Se+=Le.length,ue.push(Le),Se+=mr.length,ue.push(mr),Se+=pt.length,ue.push(pt),Le=xr(46),Le.write_shift(4,33639248),Le.write_shift(2,0),Le.write_shift(2,20),Le.write_shift(2,ce),Le.write_shift(2,ct),Le.write_shift(4,0),Le.write_shift(-4,gt[Ze]),Le.write_shift(4,pt.length),Le.write_shift(4,wt.content.length),Le.write_shift(2,mr.length),Le.write_shift(2,0),Le.write_shift(2,0),Le.write_shift(2,0),Le.write_shift(2,0),Le.write_shift(4,0),Le.write_shift(4,Dt),zt+=Le.l,Ae.push(Le),zt+=mr.length,Ae.push(mr),++Ze}return Le=xr(22),Le.write_shift(4,101010256),Le.write_shift(2,0),Le.write_shift(2,0),Le.write_shift(2,Ze),Le.write_shift(2,Ze),Le.write_shift(4,zt),Le.write_shift(4,Se),Le.write_shift(2,0),Ia([Ia(ue),Ia(Ae),Le])}var _r={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Vr(Z,pe){if(Z.ctype)return Z.ctype;var ee=Z.name||"",ue=ee.match(/\.([^\.]+)$/);return ue&&_r[ue[1]]||pe&&(ue=(ee=pe).match(/[\.\\]([^\.\\])+$/),ue&&_r[ue[1]])?_r[ue[1]]:"application/octet-stream"}function en(Z){for(var pe=dp(Z),ee=[],ue=0;ue<pe.length;ue+=76)ee.push(pe.slice(ue,ue+76));return ee.join(`\r
`)+`\r
`}function Xr(Z){var pe=Z.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(se){var Se=se.charCodeAt(0).toString(16).toUpperCase();return"="+(Se.length==1?"0"+Se:Se)});pe=pe.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),pe.charAt(0)==`
`&&(pe="=0D"+pe.slice(1)),pe=pe.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var ee=[],ue=pe.split(`\r
`),Ae=0;Ae<ue.length;++Ae){var Le=ue[Ae];if(Le.length==0){ee.push("");continue}for(var ct=0;ct<Le.length;){var ce=76,xe=Le.slice(ct,ct+ce);xe.charAt(ce-1)=="="?ce--:xe.charAt(ce-2)=="="?ce-=2:xe.charAt(ce-3)=="="&&(ce-=3),xe=Le.slice(ct,ct+ce),ct+=ce,ct<Le.length&&(xe+="="),ee.push(xe)}}return ee.join(`\r
`)}function gn(Z){for(var pe=[],ee=0;ee<Z.length;++ee){for(var ue=Z[ee];ee<=Z.length&&ue.charAt(ue.length-1)=="=";)ue=ue.slice(0,ue.length-1)+Z[++ee];pe.push(ue)}for(var Ae=0;Ae<pe.length;++Ae)pe[Ae]=pe[Ae].replace(/[=][0-9A-Fa-f]{2}/g,function(Le){return String.fromCharCode(parseInt(Le.slice(1),16))});return go(pe.join(`\r
`))}function Oe(Z,pe,ee){for(var ue="",Ae="",Le="",ct,ce=0;ce<10;++ce){var xe=pe[ce];if(!xe||xe.match(/^\s*$/))break;var se=xe.match(/^(.*?):\s*([^\s].*)$/);if(se)switch(se[1].toLowerCase()){case"content-location":ue=se[2].trim();break;case"content-type":Le=se[2].trim();break;case"content-transfer-encoding":Ae=se[2].trim();break}}switch(++ce,Ae.toLowerCase()){case"base64":ct=go(ko(pe.slice(ce).join("")));break;case"quoted-printable":ct=gn(pe.slice(ce));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Ae)}var Se=He(Z,ue.slice(ee.length),ct,{unsafe:!0});Le&&(Se.ctype=Le)}function qe(Z,pe){if(q(Z.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var ee=pe&&pe.root||"",ue=(Un&&Buffer.isBuffer(Z)?Z.toString("binary"):q(Z)).split(`\r
`),Ae=0,Le="";for(Ae=0;Ae<ue.length;++Ae)if(Le=ue[Ae],!!/^Content-Location:/i.test(Le)&&(Le=Le.slice(Le.indexOf("file")),ee||(ee=Le.slice(0,Le.lastIndexOf("/")+1)),Le.slice(0,ee.length)!=ee))for(;ee.length>0&&(ee=ee.slice(0,ee.length-1),ee=ee.slice(0,ee.lastIndexOf("/")+1),Le.slice(0,ee.length)!=ee););var ct=(ue[1]||"").match(/boundary="(.*?)"/);if(!ct)throw new Error("MAD cannot find boundary");var ce="--"+(ct[1]||""),xe=[],se=[],Se={FileIndex:xe,FullPaths:se};C(Se);var Ze,et=0;for(Ae=0;Ae<ue.length;++Ae){var Et=ue[Ae];Et!==ce&&Et!==ce+"--"||(et++&&Oe(Se,ue.slice(Ze,Ae),ee),Ze=Ae)}return Se}function Lt(Z,pe){var ee=pe||{},ue=ee.boundary||"SheetJS";ue="------="+ue;for(var Ae=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+ue.slice(2)+'"',"","",""],Le=Z.FullPaths[0],ct=Le,ce=Z.FileIndex[0],xe=1;xe<Z.FullPaths.length;++xe)if(ct=Z.FullPaths[xe].slice(Le.length),ce=Z.FileIndex[xe],!(!ce.size||!ce.content||ct=="Sh33tJ5")){ct=ct.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(zt){return"_x"+zt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(zt){return"_u"+zt.charCodeAt(0).toString(16)+"_"});for(var se=ce.content,Se=Un&&Buffer.isBuffer(se)?se.toString("binary"):q(se),Ze=0,et=Math.min(1024,Se.length),Et=0,wt=0;wt<=et;++wt)(Et=Se.charCodeAt(wt))>=32&&Et<128&&++Ze;var gt=Ze>=et*4/5;Ae.push(ue),Ae.push("Content-Location: "+(ee.root||"file:///C:/SheetJS/")+ct),Ae.push("Content-Transfer-Encoding: "+(gt?"quoted-printable":"base64")),Ae.push("Content-Type: "+Vr(ce,ct)),Ae.push(""),Ae.push(gt?Xr(Se):en(Se))}return Ae.push(ue+`--\r
`),Ae.join(`\r
`)}function dt(Z){var pe={};return C(pe,Z),pe}function He(Z,pe,ee,ue){var Ae=ue&&ue.unsafe;Ae||C(Z);var Le=!Ae&&mn.find(Z,pe);if(!Le){var ct=Z.FullPaths[0];pe.slice(0,ct.length)==ct?ct=pe:(ct.slice(-1)!="/"&&(ct+="/"),ct=(ct+pe).replace("//","/")),Le={name:a(pe),type:2},Z.FileIndex.push(Le),Z.FullPaths.push(ct),Ae||mn.utils.cfb_gc(Z)}return Le.content=ee,Le.size=ee?ee.length:0,ue&&(ue.CLSID&&(Le.clsid=ue.CLSID),ue.mt&&(Le.mt=ue.mt),ue.ct&&(Le.ct=ue.ct)),Le}function $t(Z,pe){C(Z);var ee=mn.find(Z,pe);if(ee){for(var ue=0;ue<Z.FileIndex.length;++ue)if(Z.FileIndex[ue]==ee)return Z.FileIndex.splice(ue,1),Z.FullPaths.splice(ue,1),!0}return!1}function Ue(Z,pe,ee){C(Z);var ue=mn.find(Z,pe);if(ue){for(var Ae=0;Ae<Z.FileIndex.length;++Ae)if(Z.FileIndex[Ae]==ue)return Z.FileIndex[Ae].name=a(ee),Z.FullPaths[Ae]=ee,!0}return!1}function er(Z){T(Z,!0)}return t.find=A,t.read=L,t.parse=u,t.write=me,t.writeFile=R,t.utils={cfb_new:dt,cfb_add:He,cfb_del:$t,cfb_mov:Ue,cfb_gc:er,ReadShift:Eh,CheckField:qA,prep_blob:Ja,bconcat:Ia,use_zlib:E,_deflateRaw:we,_inflateRaw:It,consts:Fe},t}();function mO(e){return typeof e=="string"?ug(e):Array.isArray(e)?$P(e):e}function Dp(e,t,r){if(typeof Deno<"u"){if(r&&typeof t=="string")switch(r){case"utf8":t=new TextEncoder(r).encode(t);break;case"binary":t=ug(t);break;default:throw new Error("Unsupported encoding "+r)}return Deno.writeFileSync(e,t)}var s=r=="utf8"?zl(t):t;if(typeof IE_SaveFile<"u")return IE_SaveFile(s,e);if(typeof Blob<"u"){var a=new Blob([mO(s)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(a,e);if(typeof saveAs<"u")return saveAs(a,e);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var i=URL.createObjectURL(a);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),chrome.downloads.download({url:i,filename:e,saveAs:!0});var o=document.createElement("a");if(o.download!=null)return o.download=e,o.href=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),i}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var l=File(e);return l.open("w"),l.encoding="binary",Array.isArray(t)&&(t=Rd(t)),l.write(t),l.close(),t}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("cannot save file "+e)}function xO(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var t=File(e);t.open("r"),t.encoding="binary";var r=t.read();return t.close(),r}catch(s){if(!s.message||!s.message.match(/onstruct/))throw s}throw new Error("Cannot access file "+e)}function Ys(e){for(var t=Object.keys(e),r=[],s=0;s<t.length;++s)Object.prototype.hasOwnProperty.call(e,t[s])&&r.push(t[s]);return r}function R_(e,t){for(var r=[],s=Ys(e),a=0;a!==s.length;++a)r[e[s[a]][t]]==null&&(r[e[s[a]][t]]=s[a]);return r}function hg(e){for(var t=[],r=Ys(e),s=0;s!==r.length;++s)t[e[r[s]]]=r[s];return t}function pg(e){for(var t=[],r=Ys(e),s=0;s!==r.length;++s)t[e[r[s]]]=parseInt(r[s],10);return t}function gO(e){for(var t=[],r=Ys(e),s=0;s!==r.length;++s)t[e[r[s]]]==null&&(t[e[r[s]]]=[]),t[e[r[s]]].push(r[s]);return t}var S1=new Date(1899,11,30,0,0,0);function La(e,t){var r=e.getTime(),s=S1.getTime()+(e.getTimezoneOffset()-S1.getTimezoneOffset())*6e4;return(r-s)/(24*60*60*1e3)}var _A=new Date,yO=S1.getTime()+(_A.getTimezoneOffset()-S1.getTimezoneOffset())*6e4,B_=_A.getTimezoneOffset();function mg(e){var t=new Date;return t.setTime(e*24*60*60*1e3+yO),t.getTimezoneOffset()!==B_&&t.setTime(t.getTime()+(t.getTimezoneOffset()-B_)*6e4),t}function bO(e){var t=0,r=0,s=!1,a=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!a)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var i=1;i!=a.length;++i)if(a[i]){switch(r=1,i>3&&(s=!0),a[i].slice(a[i].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+a[i].slice(a[i].length-1));case"D":r*=24;case"H":r*=60;case"M":if(s)r*=60;else throw new Error("Unsupported ISO Duration Field: M")}t+=r*parseInt(a[i],10)}return t}var P_=new Date("2017-02-19T19:06:09.000Z"),kA=isNaN(P_.getFullYear())?new Date("2/19/17"):P_,vO=kA.getFullYear()==2017;function As(e,t){var r=new Date(e);if(vO)return t>0?r.setTime(r.getTime()+r.getTimezoneOffset()*60*1e3):t<0&&r.setTime(r.getTime()-r.getTimezoneOffset()*60*1e3),r;if(e instanceof Date)return e;if(kA.getFullYear()==1917&&!isNaN(r.getFullYear())){var s=r.getFullYear();return e.indexOf(""+s)>-1||r.setFullYear(r.getFullYear()+100),r}var a=e.match(/\d+/g)||["2017","2","19","0","0","0"],i=new Date(+a[0],+a[1]-1,+a[2],+a[3]||0,+a[4]||0,+a[5]||0);return e.indexOf("Z")>-1&&(i=new Date(i.getTime()-i.getTimezoneOffset()*60*1e3)),i}function Su(e,t){if(Un&&Buffer.isBuffer(e)){if(t){if(e[0]==255&&e[1]==254)return zl(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return zl(uA(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(t){if(e[0]==255&&e[1]==254)return zl(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return zl(new TextDecoder("utf-16be").decode(e.slice(2)))}var r={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[]/g,function(i){return r[i]||i})}catch{}for(var s=[],a=0;a!=e.length;++a)s.push(String.fromCharCode(e[a]));return s.join("")}function Cs(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=Cs(e[r]));return t}function Gs(e,t){for(var r="";r.length<t;)r+=e;return r}function xl(e){var t=Number(e);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(e))return t;var r=1,s=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return r*=100,""});return!isNaN(t=Number(s))||(s=s.replace(/[(](.*)[)]/,function(a,i){return r=-r,i}),!isNaN(t=Number(s)))?t/r:t}var wO=["january","february","march","april","may","june","july","august","september","october","november","december"];function l0(e){var t=new Date(e),r=new Date(NaN),s=t.getYear(),a=t.getMonth(),i=t.getDate();if(isNaN(i))return r;var o=e.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),o.length>3&&wO.indexOf(o)==-1)return r}else if(o.match(/[a-z]/))return r;return s<0||s>8099?r:(a>0||i>1)&&s!=101?t:e.match(/[^-0-9:,\/\\]/)?r:t}var SO=function(){var e="abacaba".split(/(:?b)/i).length==5;return function(r,s,a){if(e||typeof s=="string")return r.split(s);for(var i=r.split(s),o=[i[0]],l=1;l<i.length;++l)o.push(a),o.push(i[l]);return o}}();function jA(e){return e?e.content&&e.type?Su(e.content,!0):e.data?gh(e.data):e.asNodeBuffer&&Un?gh(e.asNodeBuffer().toString("binary")):e.asBinary?gh(e.asBinary()):e._data&&e._data.getContent?gh(Su(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function NA(e){if(!e)return null;if(e.data)return k_(e.data);if(e.asNodeBuffer&&Un)return e.asNodeBuffer();if(e._data&&e._data.getContent){var t=e._data.getContent();return typeof t=="string"?k_(t):Array.prototype.slice.call(t)}return e.content&&e.type?e.content:null}function _O(e){return e&&e.name.slice(-4)===".bin"?NA(e):jA(e)}function Do(e,t){for(var r=e.FullPaths||Ys(e.files),s=t.toLowerCase().replace(/[\/]/g,"\\"),a=s.replace(/\\/g,"/"),i=0;i<r.length;++i){var o=r[i].replace(/^Root Entry[\/]/,"").toLowerCase();if(s==o||a==o)return e.files?e.files[r[i]]:e.FileIndex[i]}return null}function dw(e,t){var r=Do(e,t);if(r==null)throw new Error("Cannot find file "+t+" in zip");return r}function ga(e,t,r){if(!r)return _O(dw(e,t));if(!t)return null;try{return ga(e,t)}catch{return null}}function yo(e,t,r){if(!r)return jA(dw(e,t));if(!t)return null;try{return yo(e,t)}catch{return null}}function kO(e,t,r){return NA(dw(e,t))}function O_(e){for(var t=e.FullPaths||Ys(e.files),r=[],s=0;s<t.length;++s)t[s].slice(-1)!="/"&&r.push(t[s].replace(/^Root Entry[\/]/,""));return r.sort()}function Rn(e,t,r){if(e.FullPaths){if(typeof r=="string"){var s;return Un?s=Tc(r):s=WP(r),mn.utils.cfb_add(e,t,s)}mn.utils.cfb_add(e,t,r)}else e.file(t,r)}function uw(){return mn.utils.cfb_new()}function AA(e,t){switch(t.type){case"base64":return mn.read(e,{type:"base64"});case"binary":return mn.read(e,{type:"binary"});case"buffer":case"array":return mn.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+t.type)}function bh(e,t){if(e.charAt(0)=="/")return e.slice(1);var r=t.split("/");t.slice(-1)!="/"&&r.pop();for(var s=e.split("/");s.length!==0;){var a=s.shift();a===".."?r.pop():a!=="."&&r.push(a)}return r.join("/")}var fa=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,jO=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,I_=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,NO=/<[^>]*>/g,wi=fa.match(I_)?I_:NO,AO=/<\w*:/,CO=/<(\/?)\w+:/;function kn(e,t,r){for(var s={},a=0,i=0;a!==e.length&&!((i=e.charCodeAt(a))===32||i===10||i===13);++a);if(t||(s[0]=e.slice(0,a)),a===e.length)return s;var o=e.match(jO),l=0,c="",d=0,u="",h="",p=1;if(o)for(d=0;d!=o.length;++d){for(h=o[d],i=0;i!=h.length&&h.charCodeAt(i)!==61;++i);for(u=h.slice(0,i).trim();h.charCodeAt(i+1)==32;)++i;for(p=(a=h.charCodeAt(i+1))==34||a==39?1:0,c=h.slice(i+1+p,h.length-p),l=0;l!=u.length&&u.charCodeAt(l)!==58;++l);if(l===u.length)u.indexOf("_")>0&&(u=u.slice(0,u.indexOf("_"))),s[u]=c,s[u.toLowerCase()]=c;else{var f=(l===5&&u.slice(0,5)==="xmlns"?"xmlns":"")+u.slice(l+1);if(s[f]&&u.slice(l-3,l)=="ext")continue;s[f]=c,s[f.toLowerCase()]=c}}return s}function Gl(e){return e.replace(CO,"<$1")}var CA={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},fw=hg(CA),Kn=function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,t=/_x([\da-fA-F]{4})_/ig;return function r(s){var a=s+"",i=a.indexOf("<![CDATA[");if(i==-1)return a.replace(e,function(l,c){return CA[l]||String.fromCharCode(parseInt(c,l.indexOf("x")>-1?16:10))||l}).replace(t,function(l,c){return String.fromCharCode(parseInt(c,16))});var o=a.indexOf("]]>");return r(a.slice(0,i))+a.slice(i+9,o)+r(a.slice(o+3))}}(),hw=/[&<>'"]/g,EO=/[\u0000-\u0008\u000b-\u001f]/g;function us(e){var t=e+"";return t.replace(hw,function(r){return fw[r]}).replace(EO,function(r){return"_x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+"_"})}function D_(e){return us(e).replace(/ /g,"_x0020_")}var EA=/[\u0000-\u001f]/g;function pw(e){var t=e+"";return t.replace(hw,function(r){return fw[r]}).replace(/\n/g,"<br/>").replace(EA,function(r){return"&#x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+";"})}function TO(e){var t=e+"";return t.replace(hw,function(r){return fw[r]}).replace(EA,function(r){return"&#x"+r.charCodeAt(0).toString(16).toUpperCase()+";"})}var U_=function(){var e=/&#(\d+);/g;function t(r,s){return String.fromCharCode(parseInt(s,10))}return function(s){return s.replace(e,t)}}();function LO(e){return e.replace(/(\r\n|[\r\n])/g,"&#10;")}function ks(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function wy(e){for(var t="",r=0,s=0,a=0,i=0,o=0,l=0;r<e.length;){if(s=e.charCodeAt(r++),s<128){t+=String.fromCharCode(s);continue}if(a=e.charCodeAt(r++),s>191&&s<224){o=(s&31)<<6,o|=a&63,t+=String.fromCharCode(o);continue}if(i=e.charCodeAt(r++),s<240){t+=String.fromCharCode((s&15)<<12|(a&63)<<6|i&63);continue}o=e.charCodeAt(r++),l=((s&7)<<18|(a&63)<<12|(i&63)<<6|o&63)-65536,t+=String.fromCharCode(55296+(l>>>10&1023)),t+=String.fromCharCode(56320+(l&1023))}return t}function $_(e){var t=jd(2*e.length),r,s,a=1,i=0,o=0,l;for(s=0;s<e.length;s+=a)a=1,(l=e.charCodeAt(s))<128?r=l:l<224?(r=(l&31)*64+(e.charCodeAt(s+1)&63),a=2):l<240?(r=(l&15)*4096+(e.charCodeAt(s+1)&63)*64+(e.charCodeAt(s+2)&63),a=3):(a=4,r=(l&7)*262144+(e.charCodeAt(s+1)&63)*4096+(e.charCodeAt(s+2)&63)*64+(e.charCodeAt(s+3)&63),r-=65536,o=55296+(r>>>10&1023),r=56320+(r&1023)),o!==0&&(t[i++]=o&255,t[i++]=o>>>8,o=0),t[i++]=r%256,t[i++]=r>>>8;return t.slice(0,i).toString("ucs2")}function W_(e){return Tc(e,"binary").toString("utf8")}var Mm="foo bar baz",hs=Un&&(W_(Mm)==wy(Mm)&&W_||$_(Mm)==wy(Mm)&&$_)||wy,zl=Un?function(e){return Tc(e,"utf8").toString("binary")}:function(e){for(var t=[],r=0,s=0,a=0;r<e.length;)switch(s=e.charCodeAt(r++),!0){case s<128:t.push(String.fromCharCode(s));break;case s<2048:t.push(String.fromCharCode(192+(s>>6))),t.push(String.fromCharCode(128+(s&63)));break;case(s>=55296&&s<57344):s-=55296,a=e.charCodeAt(r++)-56320+(s<<10),t.push(String.fromCharCode(240+(a>>18&7))),t.push(String.fromCharCode(144+(a>>12&63))),t.push(String.fromCharCode(128+(a>>6&63))),t.push(String.fromCharCode(128+(a&63)));break;default:t.push(String.fromCharCode(224+(s>>12))),t.push(String.fromCharCode(128+(s>>6&63))),t.push(String.fromCharCode(128+(s&63)))}return t.join("")},fp=function(){var e={};return function(r,s){var a=r+"|"+(s||"");return e[a]?e[a]:e[a]=new RegExp("<(?:\\w+:)?"+r+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+r+">",s||"")}}(),TA=function(){var e=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(t){return[new RegExp("&"+t[0]+";","ig"),t[1]]});return function(r){for(var s=r.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),a=0;a<e.length;++a)s=s.replace(e[a][0],e[a][1]);return s}}(),FO=function(){var e={};return function(r){return e[r]!==void 0?e[r]:e[r]=new RegExp("<(?:vt:)?"+r+">([\\s\\S]*?)</(?:vt:)?"+r+">","g")}}(),MO=/<\/?(?:vt:)?variant>/g,RO=/<(?:vt:)([^>]*)>([\s\S]*)</;function z_(e,t){var r=kn(e),s=e.match(FO(r.baseType))||[],a=[];if(s.length!=r.size){if(t.WTF)throw new Error("unexpected vector length "+s.length+" != "+r.size);return a}return s.forEach(function(i){var o=i.replace(MO,"").match(RO);o&&a.push({v:hs(o[2]),t:o[1]})}),a}var LA=/(^\s|\s$|\n)/;function Za(e,t){return"<"+e+(t.match(LA)?' xml:space="preserve"':"")+">"+t+"</"+e+">"}function hp(e){return Ys(e).map(function(t){return" "+t+'="'+e[t]+'"'}).join("")}function qr(e,t,r){return"<"+e+(r!=null?hp(r):"")+(t!=null?(t.match(LA)?' xml:space="preserve"':"")+">"+t+"</"+e:"/")+">"}function S2(e,t){try{return e.toISOString().replace(/\.\d*/,"")}catch(r){if(t)throw r}return""}function BO(e,t){switch(typeof e){case"string":var r=qr("vt:lpwstr",us(e));return r=r.replace(/&quot;/g,"_x0022_"),r;case"number":return qr((e|0)==e?"vt:i4":"vt:r8",us(String(e)));case"boolean":return qr("vt:bool",e?"true":"false")}if(e instanceof Date)return qr("vt:filetime",S2(e));throw new Error("Unable to serialize "+e)}function mw(e){if(Un&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return hs(Rd(ow(e)));throw new Error("Bad input format: expected Buffer or string")}var pp=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,Ea={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},Pu=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],mo={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function PO(e,t){for(var r=1-2*(e[t+7]>>>7),s=((e[t+7]&127)<<4)+(e[t+6]>>>4&15),a=e[t+6]&15,i=5;i>=0;--i)a=a*256+e[t+i];return s==2047?a==0?r*(1/0):NaN:(s==0?s=-1022:(s-=1023,a+=Math.pow(2,52)),r*Math.pow(2,s-52)*a)}function OO(e,t,r){var s=(t<0||1/t==-1/0?1:0)<<7,a=0,i=0,o=s?-t:t;isFinite(o)?o==0?a=i=0:(a=Math.floor(Math.log(o)/Math.LN2),i=o*Math.pow(2,52-a),a<=-1023&&(!isFinite(i)||i<Math.pow(2,52))?a=-1022:(i-=Math.pow(2,52),a+=1023)):(a=2047,i=isNaN(t)?26985:0);for(var l=0;l<=5;++l,i/=256)e[r+l]=i&255;e[r+6]=(a&15)<<4|i&15,e[r+7]=a>>4|s}var q_=function(e){for(var t=[],r=10240,s=0;s<e[0].length;++s)if(e[0][s])for(var a=0,i=e[0][s].length;a<i;a+=r)t.push.apply(t,e[0][s].slice(a,a+r));return t},H_=Un?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(t){return Buffer.isBuffer(t)?t:Tc(t)})):q_(e)}:q_,V_=function(e,t,r){for(var s=[],a=t;a<r;a+=2)s.push(String.fromCharCode(mc(e,a)));return s.join("").replace(Li,"")},xw=Un?function(e,t,r){return Buffer.isBuffer(e)?e.toString("utf16le",t,r).replace(Li,""):V_(e,t,r)}:V_,G_=function(e,t,r){for(var s=[],a=t;a<t+r;++a)s.push(("0"+e[a].toString(16)).slice(-2));return s.join("")},FA=Un?function(e,t,r){return Buffer.isBuffer(e)?e.toString("hex",t,t+r):G_(e,t,r)}:G_,Q_=function(e,t,r){for(var s=[],a=t;a<r;a++)s.push(String.fromCharCode(pf(e,a)));return s.join("")},Up=Un?function(t,r,s){return Buffer.isBuffer(t)?t.toString("utf8",r,s):Q_(t,r,s)}:Q_,MA=function(e,t){var r=xo(e,t);return r>0?Up(e,t+4,t+4+r-1):""},RA=MA,BA=function(e,t){var r=xo(e,t);return r>0?Up(e,t+4,t+4+r-1):""},PA=BA,OA=function(e,t){var r=2*xo(e,t);return r>0?Up(e,t+4,t+4+r-1):""},IA=OA,DA=function(t,r){var s=xo(t,r);return s>0?xw(t,r+4,r+4+s):""},UA=DA,$A=function(e,t){var r=xo(e,t);return r>0?Up(e,t+4,t+4+r):""},WA=$A,zA=function(e,t){return PO(e,t)},_1=zA,gw=function(t){return Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array};Un&&(RA=function(t,r){if(!Buffer.isBuffer(t))return MA(t,r);var s=t.readUInt32LE(r);return s>0?t.toString("utf8",r+4,r+4+s-1):""},PA=function(t,r){if(!Buffer.isBuffer(t))return BA(t,r);var s=t.readUInt32LE(r);return s>0?t.toString("utf8",r+4,r+4+s-1):""},IA=function(t,r){if(!Buffer.isBuffer(t))return OA(t,r);var s=2*t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+s-1)},UA=function(t,r){if(!Buffer.isBuffer(t))return DA(t,r);var s=t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+s)},WA=function(t,r){if(!Buffer.isBuffer(t))return $A(t,r);var s=t.readUInt32LE(r);return t.toString("utf8",r+4,r+4+s)},_1=function(t,r){return Buffer.isBuffer(t)?t.readDoubleLE(r):zA(t,r)},gw=function(t){return Buffer.isBuffer(t)||Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array});var pf=function(e,t){return e[t]},mc=function(e,t){return e[t+1]*256+e[t]},IO=function(e,t){var r=e[t+1]*256+e[t];return r<32768?r:(65535-r+1)*-1},xo=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]},Yd=function(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]},DO=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]};function Eh(e,t){var r="",s,a,i=[],o,l,c,d;switch(t){case"dbcs":if(d=this.l,Un&&Buffer.isBuffer(this))r=this.slice(this.l,this.l+2*e).toString("utf16le");else for(c=0;c<e;++c)r+=String.fromCharCode(mc(this,d)),d+=2;e*=2;break;case"utf8":r=Up(this,this.l,this.l+e);break;case"utf16le":e*=2,r=xw(this,this.l,this.l+e);break;case"wstr":return Eh.call(this,e,"dbcs");case"lpstr-ansi":r=RA(this,this.l),e=4+xo(this,this.l);break;case"lpstr-cp":r=PA(this,this.l),e=4+xo(this,this.l);break;case"lpwstr":r=IA(this,this.l),e=4+2*xo(this,this.l);break;case"lpp4":e=4+xo(this,this.l),r=UA(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+xo(this,this.l),r=WA(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,r="";(o=pf(this,this.l+e++))!==0;)i.push(Fm(o));r=i.join("");break;case"_wstr":for(e=0,r="";(o=mc(this,this.l+e))!==0;)i.push(Fm(o)),e+=2;e+=2,r=i.join("");break;case"dbcs-cont":for(r="",d=this.l,c=0;c<e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return o=pf(this,d),this.l=d+1,l=Eh.call(this,e-c,o?"dbcs-cont":"sbcs-cont"),i.join("")+l;i.push(Fm(mc(this,d))),d+=2}r=i.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(r="",d=this.l,c=0;c!=e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return o=pf(this,d),this.l=d+1,l=Eh.call(this,e-c,o?"dbcs-cont":"sbcs-cont"),i.join("")+l;i.push(Fm(pf(this,d))),d+=1}r=i.join("");break;default:switch(e){case 1:return s=pf(this,this.l),this.l++,s;case 2:return s=(t==="i"?IO:mc)(this,this.l),this.l+=2,s;case 4:case-4:return t==="i"||!(this[this.l+3]&128)?(s=(e>0?Yd:DO)(this,this.l),this.l+=4,s):(a=xo(this,this.l),this.l+=4,a);case 8:case-8:if(t==="f")return e==8?a=_1(this,this.l):a=_1([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,a;e=8;case 16:r=FA(this,this.l,e);break}}return this.l+=e,r}var UO=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24&255},$O=function(e,t,r){e[r]=t&255,e[r+1]=t>>8&255,e[r+2]=t>>16&255,e[r+3]=t>>24&255},WO=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255};function zO(e,t,r){var s=0,a=0;if(r==="dbcs"){for(a=0;a!=t.length;++a)WO(this,t.charCodeAt(a),this.l+2*a);s=2*t.length}else if(r==="sbcs"){for(t=t.replace(/[^\x00-\x7F]/g,"_"),a=0;a!=t.length;++a)this[this.l+a]=t.charCodeAt(a)&255;s=t.length}else if(r==="hex"){for(;a<e;++a)this[this.l++]=parseInt(t.slice(2*a,2*a+2),16)||0;return this}else if(r==="utf16le"){var i=Math.min(this.l+e,this.length);for(a=0;a<Math.min(t.length,e);++a){var o=t.charCodeAt(a);this[this.l++]=o&255,this[this.l++]=o>>8}for(;this.l<i;)this[this.l++]=0;return this}else switch(e){case 1:s=1,this[this.l]=t&255;break;case 2:s=2,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255;break;case 3:s=3,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255,t>>>=8,this[this.l+2]=t&255;break;case 4:s=4,UO(this,t,this.l);break;case 8:if(s=8,r==="f"){OO(this,t,this.l);break}case 16:break;case-4:s=4,$O(this,t,this.l);break}return this.l+=s,this}function qA(e,t){var r=FA(this,this.l,e.length>>1);if(r!==e)throw new Error(t+"Expected "+e+" saw "+r);this.l+=e.length>>1}function Ja(e,t){e.l=t,e.read_shift=Eh,e.chk=qA,e.write_shift=zO}function vi(e,t){e.l+=t}function xr(e){var t=jd(e);return Ja(t,0),t}function Lc(e,t,r){if(e){var s,a,i;Ja(e,e.l||0);for(var o=e.length,l=0,c=0;e.l<o;){l=e.read_shift(1),l&128&&(l=(l&127)+((e.read_shift(1)&127)<<7));var d=vp[l]||vp[65535];for(s=e.read_shift(1),i=s&127,a=1;a<4&&s&128;++a)i+=((s=e.read_shift(1))&127)<<7*a;c=e.l+i;var u=d.f&&d.f(e,i,r);if(e.l=c,t(u,d,l))return}}}function Xi(){var e=[],t=Un?256:2048,r=function(d){var u=xr(d);return Ja(u,0),u},s=r(t),a=function(){s&&(s.length>s.l&&(s=s.slice(0,s.l),s.l=s.length),s.length>0&&e.push(s),s=null)},i=function(d){return s&&d<s.length-s.l?s:(a(),s=r(Math.max(d+1,t)))},o=function(){return a(),Ia(e)},l=function(d){a(),s=d,s.l==null&&(s.l=s.length),i(t)};return{next:i,push:l,end:o,_bufs:e}}function Ar(e,t,r,s){var a=+t,i;if(!isNaN(a)){s||(s=vp[a].p||(r||[]).length||0),i=1+(a>=128?1:0)+1,s>=128&&++i,s>=16384&&++i,s>=2097152&&++i;var o=e.next(i);a<=127?o.write_shift(1,a):(o.write_shift(1,(a&127)+128),o.write_shift(1,a>>7));for(var l=0;l!=4;++l)if(s>=128)o.write_shift(1,(s&127)+128),s>>=7;else{o.write_shift(1,s);break}s>0&&gw(r)&&e.push(r)}}function Th(e,t,r){var s=Cs(e);if(t.s?(s.cRel&&(s.c+=t.s.c),s.rRel&&(s.r+=t.s.r)):(s.cRel&&(s.c+=t.c),s.rRel&&(s.r+=t.r)),!r||r.biff<12){for(;s.c>=256;)s.c-=256;for(;s.r>=65536;)s.r-=65536}return s}function X_(e,t,r){var s=Cs(e);return s.s=Th(s.s,t.s,r),s.e=Th(s.e,t.s,r),s}function Lh(e,t){if(e.cRel&&e.c<0)for(e=Cs(e);e.c<0;)e.c+=t>8?16384:256;if(e.rRel&&e.r<0)for(e=Cs(e);e.r<0;)e.r+=t>8?1048576:t>5?65536:16384;var r=Sn(e);return!e.cRel&&e.cRel!=null&&(r=VO(r)),!e.rRel&&e.rRel!=null&&(r=qO(r)),r}function Sy(e,t){return e.s.r==0&&!e.s.rRel&&e.e.r==(t.biff>=12?1048575:t.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+Os(e.s.c)+":"+(e.e.cRel?"":"$")+Os(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(t.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+ua(e.s.r)+":"+(e.e.rRel?"":"$")+ua(e.e.r):Lh(e.s,t.biff)+":"+Lh(e.e,t.biff)}function yw(e){return parseInt(HO(e),10)-1}function ua(e){return""+(e+1)}function qO(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function HO(e){return e.replace(/\$(\d+)$/,"$1")}function bw(e){for(var t=GO(e),r=0,s=0;s!==t.length;++s)r=26*r+t.charCodeAt(s)-64;return r-1}function Os(e){if(e<0)throw new Error("invalid column "+e);var t="";for(++e;e;e=Math.floor((e-1)/26))t=String.fromCharCode((e-1)%26+65)+t;return t}function VO(e){return e.replace(/^([A-Z])/,"$$$1")}function GO(e){return e.replace(/^\$([A-Z])/,"$1")}function QO(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Is(e){for(var t=0,r=0,s=0;s<e.length;++s){var a=e.charCodeAt(s);a>=48&&a<=57?t=10*t+(a-48):a>=65&&a<=90&&(r=26*r+(a-64))}return{c:r-1,r:t-1}}function Sn(e){for(var t=e.c+1,r="";t;t=(t-1)/26|0)r=String.fromCharCode((t-1)%26+65)+r;return r+(e.r+1)}function Ki(e){var t=e.indexOf(":");return t==-1?{s:Is(e),e:Is(e)}:{s:Is(e.slice(0,t)),e:Is(e.slice(t+1))}}function Ln(e,t){return typeof t>"u"||typeof t=="number"?Ln(e.s,e.e):(typeof e!="string"&&(e=Sn(e)),typeof t!="string"&&(t=Sn(t)),e==t?e:e+":"+t)}function Jn(e){var t={s:{c:0,r:0},e:{c:0,r:0}},r=0,s=0,a=0,i=e.length;for(r=0;s<i&&!((a=e.charCodeAt(s)-64)<1||a>26);++s)r=26*r+a;for(t.s.c=--r,r=0;s<i&&!((a=e.charCodeAt(s)-48)<0||a>9);++s)r=10*r+a;if(t.s.r=--r,s===i||a!=10)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++s,r=0;s!=i&&!((a=e.charCodeAt(s)-64)<1||a>26);++s)r=26*r+a;for(t.e.c=--r,r=0;s!=i&&!((a=e.charCodeAt(s)-48)<0||a>9);++s)r=10*r+a;return t.e.r=--r,t}function Y_(e,t){var r=e.t=="d"&&t instanceof Date;if(e.z!=null)try{return e.w=Yo(e.z,r?La(t):t)}catch{}try{return e.w=Yo((e.XF||{}).numFmtId||(r?14:0),r?La(t):t)}catch{return""+t}}function Nc(e,t,r){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&r&&r.dateNF&&(e.z=r.dateNF),e.t=="e"?Fc[e.v]||e.v:t==null?Y_(e,e.v):Y_(e,t))}function Bd(e,t){var r=t&&t.sheet?t.sheet:"Sheet1",s={};return s[r]=e,{SheetNames:[r],Sheets:s}}function HA(e,t,r){var s=r||{},a=e?Array.isArray(e):s.dense,i=e||(a?[]:{}),o=0,l=0;if(i&&s.origin!=null){if(typeof s.origin=="number")o=s.origin;else{var c=typeof s.origin=="string"?Is(s.origin):s.origin;o=c.r,l=c.c}i["!ref"]||(i["!ref"]="A1:A1")}var d={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(i["!ref"]){var u=Jn(i["!ref"]);d.s.c=u.s.c,d.s.r=u.s.r,d.e.c=Math.max(d.e.c,u.e.c),d.e.r=Math.max(d.e.r,u.e.r),o==-1&&(d.e.r=o=u.e.r+1)}for(var h=0;h!=t.length;++h)if(t[h]){if(!Array.isArray(t[h]))throw new Error("aoa_to_sheet expects an array of arrays");for(var p=0;p!=t[h].length;++p)if(!(typeof t[h][p]>"u")){var f={v:t[h][p]},x=o+h,g=l+p;if(d.s.r>x&&(d.s.r=x),d.s.c>g&&(d.s.c=g),d.e.r<x&&(d.e.r=x),d.e.c<g&&(d.e.c=g),t[h][p]&&typeof t[h][p]=="object"&&!Array.isArray(t[h][p])&&!(t[h][p]instanceof Date))f=t[h][p];else if(Array.isArray(f.v)&&(f.f=t[h][p][1],f.v=f.v[0]),f.v===null)if(f.f)f.t="n";else if(s.nullError)f.t="e",f.v=0;else if(s.sheetStubs)f.t="z";else continue;else typeof f.v=="number"?f.t="n":typeof f.v=="boolean"?f.t="b":f.v instanceof Date?(f.z=s.dateNF||vn[14],s.cellDates?(f.t="d",f.w=Yo(f.z,La(f.v))):(f.t="n",f.v=La(f.v),f.w=Yo(f.z,f.v))):f.t="s";if(a)i[x]||(i[x]=[]),i[x][g]&&i[x][g].z&&(f.z=i[x][g].z),i[x][g]=f;else{var y=Sn({c:g,r:x});i[y]&&i[y].z&&(f.z=i[y].z),i[y]=f}}}return d.s.c<1e7&&(i["!ref"]=Ln(d)),i}function A0(e,t){return HA(null,e,t)}function XO(e){return e.read_shift(4,"i")}function gl(e,t){return t||(t=xr(4)),t.write_shift(4,e),t}function yi(e){var t=e.read_shift(4);return t===0?"":e.read_shift(t,"dbcs")}function Da(e,t){var r=!1;return t==null&&(r=!0,t=xr(4+2*e.length)),t.write_shift(4,e.length),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}function YO(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function KO(e,t){return t||(t=xr(4)),t.write_shift(2,0),t.write_shift(2,0),t}function vw(e,t){var r=e.l,s=e.read_shift(1),a=yi(e),i=[],o={t:a,h:a};if(s&1){for(var l=e.read_shift(4),c=0;c!=l;++c)i.push(YO(e));o.r=i}else o.r=[{ich:0,ifnt:0}];return e.l=r+t,o}function JO(e,t){var r=!1;return t==null&&(r=!0,t=xr(15+4*e.t.length)),t.write_shift(1,0),Da(e.t,t),r?t.slice(0,t.l):t}var ZO=vw;function e9(e,t){var r=!1;return t==null&&(r=!0,t=xr(23+4*e.t.length)),t.write_shift(1,1),Da(e.t,t),t.write_shift(4,1),KO({},t),r?t.slice(0,t.l):t}function Zo(e){var t=e.read_shift(4),r=e.read_shift(2);return r+=e.read_shift(1)<<16,e.l++,{c:t,iStyleRef:r}}function Ou(e,t){return t==null&&(t=xr(8)),t.write_shift(-4,e.c),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}function Iu(e){var t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:t}}function Du(e,t){return t==null&&(t=xr(4)),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}var t9=yi,VA=Da;function ww(e){var t=e.read_shift(4);return t===0||t===4294967295?"":e.read_shift(t,"dbcs")}function k1(e,t){var r=!1;return t==null&&(r=!0,t=xr(127)),t.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}var r9=yi,_2=ww,Sw=k1;function _w(e){var t=e.slice(e.l,e.l+4),r=t[0]&1,s=t[0]&2;e.l+=4;var a=s===0?_1([0,0,0,0,t[0]&252,t[1],t[2],t[3]],0):Yd(t,0)>>2;return r?a/100:a}function GA(e,t){t==null&&(t=xr(4));var r=0,s=0,a=e*100;if(e==(e|0)&&e>=-536870912&&e<1<<29?s=1:a==(a|0)&&a>=-536870912&&a<1<<29&&(s=1,r=1),s)t.write_shift(-4,((r?a:e)<<2)+(r+2));else throw new Error("unsupported RkNumber "+e)}function QA(e){var t={s:{},e:{}};return t.s.r=e.read_shift(4),t.e.r=e.read_shift(4),t.s.c=e.read_shift(4),t.e.c=e.read_shift(4),t}function n9(e,t){return t||(t=xr(16)),t.write_shift(4,e.s.r),t.write_shift(4,e.e.r),t.write_shift(4,e.s.c),t.write_shift(4,e.e.c),t}var Uu=QA,C0=n9;function xi(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function _u(e,t){return(t||xr(8)).write_shift(8,e,"f")}function s9(e){var t={},r=e.read_shift(1),s=r>>>1,a=e.read_shift(1),i=e.read_shift(2,"i"),o=e.read_shift(1),l=e.read_shift(1),c=e.read_shift(1);switch(e.l++,s){case 0:t.auto=1;break;case 1:t.index=a;var d=lu[a];d&&(t.rgb=xp(d));break;case 2:t.rgb=xp([o,l,c]);break;case 3:t.theme=a;break}return i!=0&&(t.tint=i>0?i/32767:i/32768),t}function j1(e,t){if(t||(t=xr(8)),!e||e.auto)return t.write_shift(4,0),t.write_shift(4,0),t;e.index!=null?(t.write_shift(1,2),t.write_shift(1,e.index)):e.theme!=null?(t.write_shift(1,6),t.write_shift(1,e.theme)):(t.write_shift(1,5),t.write_shift(1,0));var r=e.tint||0;if(r>0?r*=32767:r<0&&(r*=32768),t.write_shift(2,r),!e.rgb||e.theme!=null)t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);else{var s=e.rgb||"FFFFFF";typeof s=="number"&&(s=("000000"+s.toString(16)).slice(-6)),t.write_shift(1,parseInt(s.slice(0,2),16)),t.write_shift(1,parseInt(s.slice(2,4),16)),t.write_shift(1,parseInt(s.slice(4,6),16)),t.write_shift(1,255)}return t}function a9(e){var t=e.read_shift(1);e.l++;var r={fBold:t&1,fItalic:t&2,fUnderline:t&4,fStrikeout:t&8,fOutline:t&16,fShadow:t&32,fCondense:t&64,fExtend:t&128};return r}function i9(e,t){t||(t=xr(2));var r=(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0);return t.write_shift(1,r),t.write_shift(1,0),t}function XA(e,t){var r={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},s=e.read_shift(4);switch(s){case 0:return"";case 4294967295:case 4294967294:return r[e.read_shift(4)]||""}if(s>400)throw new Error("Unsupported Clipboard: "+s.toString(16));return e.l-=4,e.read_shift(0,t==1?"lpstr":"lpwstr")}function o9(e){return XA(e,1)}function l9(e){return XA(e,2)}var kw=2,Di=3,Rm=11,K_=12,N1=19,Bm=64,c9=65,d9=71,u9=4108,f9=4126,Ba=80,YA=81,h9=[Ba,YA],k2={1:{n:"CodePage",t:kw},2:{n:"Category",t:Ba},3:{n:"PresentationFormat",t:Ba},4:{n:"ByteCount",t:Di},5:{n:"LineCount",t:Di},6:{n:"ParagraphCount",t:Di},7:{n:"SlideCount",t:Di},8:{n:"NoteCount",t:Di},9:{n:"HiddenCount",t:Di},10:{n:"MultimediaClipCount",t:Di},11:{n:"ScaleCrop",t:Rm},12:{n:"HeadingPairs",t:u9},13:{n:"TitlesOfParts",t:f9},14:{n:"Manager",t:Ba},15:{n:"Company",t:Ba},16:{n:"LinksUpToDate",t:Rm},17:{n:"CharacterCount",t:Di},19:{n:"SharedDoc",t:Rm},22:{n:"HyperlinksChanged",t:Rm},23:{n:"AppVersion",t:Di,p:"version"},24:{n:"DigSig",t:c9},26:{n:"ContentType",t:Ba},27:{n:"ContentStatus",t:Ba},28:{n:"Language",t:Ba},29:{n:"Version",t:Ba},255:{},2147483648:{n:"Locale",t:N1},2147483651:{n:"Behavior",t:N1},1919054434:{}},j2={1:{n:"CodePage",t:kw},2:{n:"Title",t:Ba},3:{n:"Subject",t:Ba},4:{n:"Author",t:Ba},5:{n:"Keywords",t:Ba},6:{n:"Comments",t:Ba},7:{n:"Template",t:Ba},8:{n:"LastAuthor",t:Ba},9:{n:"RevNumber",t:Ba},10:{n:"EditTime",t:Bm},11:{n:"LastPrinted",t:Bm},12:{n:"CreatedDate",t:Bm},13:{n:"ModifiedDate",t:Bm},14:{n:"PageCount",t:Di},15:{n:"WordCount",t:Di},16:{n:"CharCount",t:Di},17:{n:"Thumbnail",t:d9},18:{n:"Application",t:Ba},19:{n:"DocSecurity",t:Di},255:{},2147483648:{n:"Locale",t:N1},2147483651:{n:"Behavior",t:N1},1919054434:{}},J_={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},p9=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function m9(e){return e.map(function(t){return[t>>16&255,t>>8&255,t&255]})}var x9=m9([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),lu=Cs(x9),Fc={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},KA={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},N2={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Pm={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function jw(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function g9(e){var t=jw();if(!e||!e.match)return t;var r={};if((e.match(wi)||[]).forEach(function(s){var a=kn(s);switch(a[0].replace(AO,"<")){case"<?xml":break;case"<Types":t.xmlns=a["xmlns"+(a[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":r[a.Extension]=a.ContentType;break;case"<Override":t[N2[a.ContentType]]!==void 0&&t[N2[a.ContentType]].push(a.PartName);break}}),t.xmlns!==Ea.CT)throw new Error("Unknown Namespace: "+t.xmlns);return t.calcchain=t.calcchains.length>0?t.calcchains[0]:"",t.sst=t.strs.length>0?t.strs[0]:"",t.style=t.styles.length>0?t.styles[0]:"",t.defaults=r,delete t.calcchains,t}function JA(e,t){var r=gO(N2),s=[],a;s[s.length]=fa,s[s.length]=qr("Types",null,{xmlns:Ea.CT,"xmlns:xsd":Ea.xsd,"xmlns:xsi":Ea.xsi}),s=s.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(c){return qr("Default",null,{Extension:c[0],ContentType:c[1]})}));var i=function(c){e[c]&&e[c].length>0&&(a=e[c][0],s[s.length]=qr("Override",null,{PartName:(a[0]=="/"?"":"/")+a,ContentType:Pm[c][t.bookType]||Pm[c].xlsx}))},o=function(c){(e[c]||[]).forEach(function(d){s[s.length]=qr("Override",null,{PartName:(d[0]=="/"?"":"/")+d,ContentType:Pm[c][t.bookType]||Pm[c].xlsx})})},l=function(c){(e[c]||[]).forEach(function(d){s[s.length]=qr("Override",null,{PartName:(d[0]=="/"?"":"/")+d,ContentType:r[c][0]})})};return i("workbooks"),o("sheets"),o("charts"),l("themes"),["strs","styles"].forEach(i),["coreprops","extprops","custprops"].forEach(l),l("vba"),l("comments"),l("threadedcomments"),l("drawings"),o("metadata"),l("people"),s.length>2&&(s[s.length]="</Types>",s[1]=s[1].replace("/>",">")),s.join("")}var Wn={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function mp(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)+"_rels/"+e.slice(t+1)+".rels"}function Fh(e,t){var r={"!id":{}};if(!e)return r;t.charAt(0)!=="/"&&(t="/"+t);var s={};return(e.match(wi)||[]).forEach(function(a){var i=kn(a);if(i[0]==="<Relationship"){var o={};o.Type=i.Type,o.Target=i.Target,o.Id=i.Id,i.TargetMode&&(o.TargetMode=i.TargetMode);var l=i.TargetMode==="External"?i.Target:bh(i.Target,t);r[l]=o,s[i.Id]=o}}),r["!id"]=s,r}function Vf(e){var t=[fa,qr("Relationships",null,{xmlns:Ea.RELS})];return Ys(e["!id"]).forEach(function(r){t[t.length]=qr("Relationship",null,e["!id"][r])}),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function cs(e,t,r,s,a,i){if(a||(a={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),t<0)for(t=e["!idx"];e["!id"]["rId"+t];++t);if(e["!idx"]=t+1,a.Id="rId"+t,a.Type=s,a.Target=r,[Wn.HLINK,Wn.XPATH,Wn.XMISS].indexOf(a.Type)>-1&&(a.TargetMode="External"),e["!id"][a.Id])throw new Error("Cannot rewrite rId "+t);return e["!id"][a.Id]=a,e[("/"+a.Target).replace("//","/")]=a,t}var y9="application/vnd.oasis.opendocument.spreadsheet";function b9(e,t){for(var r=mw(e),s,a;s=pp.exec(r);)switch(s[3]){case"manifest":break;case"file-entry":if(a=kn(s[0],!1),a.path=="/"&&a.type!==y9)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(t&&t.WTF)throw s}}function v9(e){var t=[fa];t.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),t.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var r=0;r<e.length;++r)t.push('  <manifest:file-entry manifest:full-path="'+e[r][0]+'" manifest:media-type="'+e[r][1]+`"/>
`);return t.push("</manifest:manifest>"),t.join("")}function Z_(e,t,r){return['  <rdf:Description rdf:about="'+e+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(r||"odf")+"#"+t+`"/>
`,`  </rdf:Description>
`].join("")}function w9(e,t){return['  <rdf:Description rdf:about="'+e+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+t+`"/>
`,`  </rdf:Description>
`].join("")}function S9(e){var t=[fa];t.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var r=0;r!=e.length;++r)t.push(Z_(e[r][0],e[r][1])),t.push(w9("",e[r][0]));return t.push(Z_("","Document","pkg")),t.push("</rdf:RDF>"),t.join("")}function ZA(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+y1.version+"</meta:generator></office:meta></office:document-meta>"}var Ho=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],_9=function(){for(var e=new Array(Ho.length),t=0;t<Ho.length;++t){var r=Ho[t],s="(?:"+r[0].slice(0,r[0].indexOf(":"))+":)"+r[0].slice(r[0].indexOf(":")+1);e[t]=new RegExp("<"+s+"[^>]*>([\\s\\S]*?)</"+s+">")}return e}();function eC(e){var t={};e=hs(e);for(var r=0;r<Ho.length;++r){var s=Ho[r],a=e.match(_9[r]);a!=null&&a.length>0&&(t[s[1]]=Kn(a[1])),s[2]==="date"&&t[s[1]]&&(t[s[1]]=As(t[s[1]]))}return t}function _y(e,t,r,s,a){a[e]!=null||t==null||t===""||(a[e]=t,t=us(t),s[s.length]=r?qr(e,t,r):Za(e,t))}function tC(e,t){var r=t||{},s=[fa,qr("cp:coreProperties",null,{"xmlns:cp":Ea.CORE_PROPS,"xmlns:dc":Ea.dc,"xmlns:dcterms":Ea.dcterms,"xmlns:dcmitype":Ea.dcmitype,"xmlns:xsi":Ea.xsi})],a={};if(!e&&!r.Props)return s.join("");e&&(e.CreatedDate!=null&&_y("dcterms:created",typeof e.CreatedDate=="string"?e.CreatedDate:S2(e.CreatedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},s,a),e.ModifiedDate!=null&&_y("dcterms:modified",typeof e.ModifiedDate=="string"?e.ModifiedDate:S2(e.ModifiedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},s,a));for(var i=0;i!=Ho.length;++i){var o=Ho[i],l=r.Props&&r.Props[o[1]]!=null?r.Props[o[1]]:e?e[o[1]]:null;l===!0?l="1":l===!1?l="0":typeof l=="number"&&(l=String(l)),l!=null&&_y(o[0],l,null,s,a)}return s.length>2&&(s[s.length]="</cp:coreProperties>",s[1]=s[1].replace("/>",">")),s.join("")}var cu=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],rC=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function nC(e,t,r,s){var a=[];if(typeof e=="string")a=z_(e,s);else for(var i=0;i<e.length;++i)a=a.concat(e[i].map(function(u){return{v:u}}));var o=typeof t=="string"?z_(t,s).map(function(u){return u.v}):t,l=0,c=0;if(o.length>0)for(var d=0;d!==a.length;d+=2){switch(c=+a[d+1].v,a[d].v){case"Worksheets":case"":case"":case" ":case"":case" ":case"Arbeitsbltter":case"alma Sayfalar":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de clculo":case"Planilhas":case"Regneark":case"Hojas de clculo":case"Werkbladen":r.Worksheets=c,r.SheetNames=o.slice(l,l+c);break;case"Named Ranges":case"Rangos con nombre":case"":case"Benannte Bereiche":case"Navngivne omrder":r.NamedRanges=c,r.DefinedNames=o.slice(l,l+c);break;case"Charts":case"Diagramme":r.Chartsheets=c,r.ChartNames=o.slice(l,l+c);break}l+=c}}function k9(e,t,r){var s={};return t||(t={}),e=hs(e),cu.forEach(function(a){var i=(e.match(fp(a[0]))||[])[1];switch(a[2]){case"string":i&&(t[a[1]]=Kn(i));break;case"bool":t[a[1]]=i==="true";break;case"raw":var o=e.match(new RegExp("<"+a[0]+"[^>]*>([\\s\\S]*?)</"+a[0]+">"));o&&o.length>0&&(s[a[1]]=o[1]);break}}),s.HeadingPairs&&s.TitlesOfParts&&nC(s.HeadingPairs,s.TitlesOfParts,t,r),t}function sC(e){var t=[],r=qr;return e||(e={}),e.Application="SheetJS",t[t.length]=fa,t[t.length]=qr("Properties",null,{xmlns:Ea.EXT_PROPS,"xmlns:vt":Ea.vt}),cu.forEach(function(s){if(e[s[1]]!==void 0){var a;switch(s[2]){case"string":a=us(String(e[s[1]]));break;case"bool":a=e[s[1]]?"true":"false";break}a!==void 0&&(t[t.length]=r(s[0],a))}}),t[t.length]=r("HeadingPairs",r("vt:vector",r("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+r("vt:variant",r("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=r("TitlesOfParts",r("vt:vector",e.SheetNames.map(function(s){return"<vt:lpstr>"+us(s)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var j9=/<[^>]+>[^<]*/g;function N9(e,t){var r={},s="",a=e.match(j9);if(a)for(var i=0;i!=a.length;++i){var o=a[i],l=kn(o);switch(l[0]){case"<?xml":break;case"<Properties":break;case"<property":s=Kn(l.name);break;case"</property>":s=null;break;default:if(o.indexOf("<vt:")===0){var c=o.split(">"),d=c[0].slice(4),u=c[1];switch(d){case"lpstr":case"bstr":case"lpwstr":r[s]=Kn(u);break;case"bool":r[s]=ks(u);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":r[s]=parseInt(u,10);break;case"r4":case"r8":case"decimal":r[s]=parseFloat(u);break;case"filetime":case"date":r[s]=As(u);break;case"cy":case"error":r[s]=Kn(u);break;default:if(d.slice(-1)=="/")break;t.WTF&&typeof console<"u"&&console.warn("Unexpected",o,d,c)}}else if(o.slice(0,2)!=="</"){if(t.WTF)throw new Error(o)}}}return r}function aC(e){var t=[fa,qr("Properties",null,{xmlns:Ea.CUST_PROPS,"xmlns:vt":Ea.vt})];if(!e)return t.join("");var r=1;return Ys(e).forEach(function(a){++r,t[t.length]=qr("property",BO(e[a]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:r,name:us(a)})}),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var A2={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},ky;function A9(e,t,r){ky||(ky=hg(A2)),t=ky[t]||t,e[t]=r}function C9(e,t){var r=[];return Ys(A2).map(function(s){for(var a=0;a<Ho.length;++a)if(Ho[a][1]==s)return Ho[a];for(a=0;a<cu.length;++a)if(cu[a][1]==s)return cu[a];throw s}).forEach(function(s){if(e[s[1]]!=null){var a=t&&t.Props&&t.Props[s[1]]!=null?t.Props[s[1]]:e[s[1]];switch(s[2]){case"date":a=new Date(a).toISOString().replace(/\.\d*Z/,"Z");break}typeof a=="number"?a=String(a):a===!0||a===!1?a=a?"1":"0":a instanceof Date&&(a=new Date(a).toISOString().replace(/\.\d*Z/,"")),r.push(Za(A2[s[1]]||s[1],a))}}),qr("DocumentProperties",r.join(""),{xmlns:mo.o})}function E9(e,t){var r=["Worksheets","SheetNames"],s="CustomDocumentProperties",a=[];return e&&Ys(e).forEach(function(i){if(Object.prototype.hasOwnProperty.call(e,i)){for(var o=0;o<Ho.length;++o)if(i==Ho[o][1])return;for(o=0;o<cu.length;++o)if(i==cu[o][1])return;for(o=0;o<r.length;++o)if(i==r[o])return;var l=e[i],c="string";typeof l=="number"?(c="float",l=String(l)):l===!0||l===!1?(c="boolean",l=l?"1":"0"):l=String(l),a.push(qr(D_(i),l,{"dt:dt":c}))}}),t&&Ys(t).forEach(function(i){if(Object.prototype.hasOwnProperty.call(t,i)&&!(e&&Object.prototype.hasOwnProperty.call(e,i))){var o=t[i],l="string";typeof o=="number"?(l="float",o=String(o)):o===!0||o===!1?(l="boolean",o=o?"1":"0"):o instanceof Date?(l="dateTime.tz",o=o.toISOString()):o=String(o),a.push(qr(D_(i),o,{"dt:dt":l}))}}),"<"+s+' xmlns="'+mo.o+'">'+a.join("")+"</"+s+">"}function Nw(e){var t=e.read_shift(4),r=e.read_shift(4);return new Date((r/1e7*Math.pow(2,32)+t/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function T9(e){var t=typeof e=="string"?new Date(Date.parse(e)):e,r=t.getTime()/1e3+11644473600,s=r%Math.pow(2,32),a=(r-s)/Math.pow(2,32);s*=1e7,a*=1e7;var i=s/Math.pow(2,32)|0;i>0&&(s=s%Math.pow(2,32),a+=i);var o=xr(8);return o.write_shift(4,s),o.write_shift(4,a),o}function iC(e,t,r){var s=e.l,a=e.read_shift(0,"lpstr-cp");if(r)for(;e.l-s&3;)++e.l;return a}function oC(e,t,r){var s=e.read_shift(0,"lpwstr");return s}function lC(e,t,r){return t===31?oC(e):iC(e,t,r)}function C2(e,t,r){return lC(e,t,r===!1?0:4)}function L9(e,t){if(!t)throw new Error("VtUnalignedString must have positive length");return lC(e,t,0)}function F9(e){for(var t=e.read_shift(4),r=[],s=0;s!=t;++s){var a=e.l;r[s]=e.read_shift(0,"lpwstr").replace(Li,""),e.l-a&2&&(e.l+=2)}return r}function M9(e){for(var t=e.read_shift(4),r=[],s=0;s!=t;++s)r[s]=e.read_shift(0,"lpstr-cp").replace(Li,"");return r}function R9(e){var t=e.l,r=A1(e,YA);e[e.l]==0&&e[e.l+1]==0&&e.l-t&2&&(e.l+=2);var s=A1(e,Di);return[r,s]}function B9(e){for(var t=e.read_shift(4),r=[],s=0;s<t/2;++s)r.push(R9(e));return r}function ek(e,t){for(var r=e.read_shift(4),s={},a=0;a!=r;++a){var i=e.read_shift(4),o=e.read_shift(4);s[i]=e.read_shift(o,t===1200?"utf16le":"utf8").replace(Li,"").replace(yh,"!"),t===1200&&o%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>3<<2),s}function cC(e){var t=e.read_shift(4),r=e.slice(e.l,e.l+t);return e.l+=t,(t&3)>0&&(e.l+=4-(t&3)&3),r}function P9(e){var t={};return t.Size=e.read_shift(4),e.l+=t.Size+3-(t.Size-1)%4,t}function A1(e,t,r){var s=e.read_shift(2),a,i=r||{};if(e.l+=2,t!==K_&&s!==t&&h9.indexOf(t)===-1&&!((t&65534)==4126&&(s&65534)==4126))throw new Error("Expected type "+t+" saw "+s);switch(t===K_?s:t){case 2:return a=e.read_shift(2,"i"),i.raw||(e.l+=2),a;case 3:return a=e.read_shift(4,"i"),a;case 11:return e.read_shift(4)!==0;case 19:return a=e.read_shift(4),a;case 30:return iC(e,s,4).replace(Li,"");case 31:return oC(e);case 64:return Nw(e);case 65:return cC(e);case 71:return P9(e);case 80:return C2(e,s,!i.raw).replace(Li,"");case 81:return L9(e,s).replace(Li,"");case 4108:return B9(e);case 4126:case 4127:return s==4127?F9(e):M9(e);default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+s)}}function tk(e,t){var r=xr(4),s=xr(4);switch(r.write_shift(4,e==80?31:e),e){case 3:s.write_shift(-4,t);break;case 5:s=xr(8),s.write_shift(8,t,"f");break;case 11:s.write_shift(4,t?1:0);break;case 64:s=T9(t);break;case 31:case 80:for(s=xr(4+2*(t.length+1)+(t.length%2?0:2)),s.write_shift(4,t.length+1),s.write_shift(0,t,"dbcs");s.l!=s.length;)s.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}return Ia([r,s])}function rk(e,t){var r=e.l,s=e.read_shift(4),a=e.read_shift(4),i=[],o=0,l=0,c=-1,d={};for(o=0;o!=a;++o){var u=e.read_shift(4),h=e.read_shift(4);i[o]=[u,h+r]}i.sort(function(w,S){return w[1]-S[1]});var p={};for(o=0;o!=a;++o){if(e.l!==i[o][1]){var f=!0;if(o>0&&t)switch(t[i[o-1][0]].t){case 2:e.l+2===i[o][1]&&(e.l+=2,f=!1);break;case 80:e.l<=i[o][1]&&(e.l=i[o][1],f=!1);break;case 4108:e.l<=i[o][1]&&(e.l=i[o][1],f=!1);break}if((!t||o==0)&&e.l<=i[o][1]&&(f=!1,e.l=i[o][1]),f)throw new Error("Read Error: Expected address "+i[o][1]+" at "+e.l+" :"+o)}if(t){var x=t[i[o][0]];if(p[x.n]=A1(e,x.t,{raw:!0}),x.p==="version"&&(p[x.n]=String(p[x.n]>>16)+"."+("0000"+String(p[x.n]&65535)).slice(-4)),x.n=="CodePage")switch(p[x.n]){case 0:p[x.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:ul(l=p[x.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+p[x.n])}}else if(i[o][0]===1){if(l=p.CodePage=A1(e,kw),ul(l),c!==-1){var g=e.l;e.l=i[c][1],d=ek(e,l),e.l=g}}else if(i[o][0]===0){if(l===0){c=o,e.l=i[o+1][1];continue}d=ek(e,l)}else{var y=d[i[o][0]],m;switch(e[e.l]){case 65:e.l+=4,m=cC(e);break;case 30:e.l+=4,m=C2(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,m=C2(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,m=e.read_shift(4,"i");break;case 19:e.l+=4,m=e.read_shift(4);break;case 5:e.l+=4,m=e.read_shift(8,"f");break;case 11:e.l+=4,m=na(e,4);break;case 64:e.l+=4,m=As(Nw(e));break;default:throw new Error("unparsed value: "+e[e.l])}p[y]=m}}return e.l=r+s,p}var dC=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function O9(e){switch(typeof e){case"boolean":return 11;case"number":return(e|0)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64;break}return-1}function nk(e,t,r){var s=xr(8),a=[],i=[],o=8,l=0,c=xr(8),d=xr(8);if(c.write_shift(4,2),c.write_shift(4,1200),d.write_shift(4,1),i.push(c),a.push(d),o+=8+c.length,!t){d=xr(8),d.write_shift(4,0),a.unshift(d);var u=[xr(4)];for(u[0].write_shift(4,e.length),l=0;l<e.length;++l){var h=e[l][0];for(c=xr(8+2*(h.length+1)+(h.length%2?0:2)),c.write_shift(4,l+2),c.write_shift(4,h.length+1),c.write_shift(0,h,"dbcs");c.l!=c.length;)c.write_shift(1,0);u.push(c)}c=Ia(u),i.unshift(c),o+=8+c.length}for(l=0;l<e.length;++l)if(!(t&&!t[e[l][0]])&&!(dC.indexOf(e[l][0])>-1||rC.indexOf(e[l][0])>-1)&&e[l][1]!=null){var p=e[l][1],f=0;if(t){f=+t[e[l][0]];var x=r[f];if(x.p=="version"&&typeof p=="string"){var g=p.split(".");p=(+g[0]<<16)+(+g[1]||0)}c=tk(x.t,p)}else{var y=O9(p);y==-1&&(y=31,p=String(p)),c=tk(y,p)}i.push(c),d=xr(8),d.write_shift(4,t?f:2+l),a.push(d),o+=8+c.length}var m=8*(i.length+1);for(l=0;l<i.length;++l)a[l].write_shift(4,m),m+=i[l].length;return s.write_shift(4,o),s.write_shift(4,i.length),Ia([s].concat(a).concat(i))}function sk(e,t,r){var s=e.content;if(!s)return{};Ja(s,0);var a,i,o,l,c=0;s.chk("feff","Byte Order: "),s.read_shift(2);var d=s.read_shift(4),u=s.read_shift(16);if(u!==mn.utils.consts.HEADER_CLSID&&u!==r)throw new Error("Bad PropertySet CLSID "+u);if(a=s.read_shift(4),a!==1&&a!==2)throw new Error("Unrecognized #Sets: "+a);if(i=s.read_shift(16),l=s.read_shift(4),a===1&&l!==s.l)throw new Error("Length mismatch: "+l+" !== "+s.l);a===2&&(o=s.read_shift(16),c=s.read_shift(4));var h=rk(s,t),p={SystemIdentifier:d};for(var f in h)p[f]=h[f];if(p.FMTID=i,a===1)return p;if(c-s.l==2&&(s.l+=2),s.l!==c)throw new Error("Length mismatch 2: "+s.l+" !== "+c);var x;try{x=rk(s,null)}catch{}for(f in x)p[f]=x[f];return p.FMTID=[i,o],p}function ak(e,t,r,s,a,i){var o=xr(a?68:48),l=[o];o.write_shift(2,65534),o.write_shift(2,0),o.write_shift(4,842412599),o.write_shift(16,mn.utils.consts.HEADER_CLSID,"hex"),o.write_shift(4,a?2:1),o.write_shift(16,t,"hex"),o.write_shift(4,a?68:48);var c=nk(e,r,s);if(l.push(c),a){var d=nk(a,null,null);o.write_shift(16,i,"hex"),o.write_shift(4,68+c.length),l.push(d)}return Ia(l)}function Gc(e,t){return e.read_shift(t),null}function I9(e,t){t||(t=xr(e));for(var r=0;r<e;++r)t.write_shift(1,0);return t}function D9(e,t,r){for(var s=[],a=e.l+t;e.l<a;)s.push(r(e,a-e.l));if(a!==e.l)throw new Error("Slurp error");return s}function na(e,t){return e.read_shift(t)===1}function Ei(e,t){return t||(t=xr(2)),t.write_shift(2,+!!e),t}function ya(e){return e.read_shift(2,"u")}function Uo(e,t){return t||(t=xr(2)),t.write_shift(2,e),t}function uC(e,t){return D9(e,t,ya)}function U9(e){var t=e.read_shift(1),r=e.read_shift(1);return r===1?t:t===1}function fC(e,t,r){return r||(r=xr(2)),r.write_shift(1,t=="e"?+e:+!!e),r.write_shift(1,t=="e"?1:0),r}function $p(e,t,r){var s=e.read_shift(r&&r.biff>=12?2:1),a="sbcs-cont";if(r&&r.biff>=8,!r||r.biff==8){var i=e.read_shift(1);i&&(a="dbcs-cont")}else r.biff==12&&(a="wstr");r.biff>=2&&r.biff<=5&&(a="cpstr");var o=s?e.read_shift(s,a):"";return o}function $9(e){var t=e.read_shift(2),r=e.read_shift(1),s=r&4,a=r&8,i=1+(r&1),o=0,l,c={};a&&(o=e.read_shift(2)),s&&(l=e.read_shift(4));var d=i==2?"dbcs-cont":"sbcs-cont",u=t===0?"":e.read_shift(t,d);return a&&(e.l+=4*o),s&&(e.l+=l),c.t=u,a||(c.raw="<t>"+c.t+"</t>",c.r=c.t),c}function W9(e){var t=e.t||"",r=xr(3);r.write_shift(2,t.length),r.write_shift(1,1);var s=xr(2*t.length);s.write_shift(2*t.length,t,"utf16le");var a=[r,s];return Ia(a)}function ku(e,t,r){var s;if(r){if(r.biff>=2&&r.biff<=5)return e.read_shift(t,"cpstr");if(r.biff>=12)return e.read_shift(t,"dbcs-cont")}var a=e.read_shift(1);return a===0?s=e.read_shift(t,"sbcs-cont"):s=e.read_shift(t,"dbcs-cont"),s}function Wp(e,t,r){var s=e.read_shift(r&&r.biff==2?1:2);return s===0?(e.l++,""):ku(e,s,r)}function $u(e,t,r){if(r.biff>5)return Wp(e,t,r);var s=e.read_shift(1);return s===0?(e.l++,""):e.read_shift(s,r.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function hC(e,t,r){return r||(r=xr(3+2*e.length)),r.write_shift(2,e.length),r.write_shift(1,1),r.write_shift(31,e,"utf16le"),r}function z9(e){var t=e.read_shift(1);e.l++;var r=e.read_shift(2);return e.l+=2,[t,r]}function q9(e){var t=e.read_shift(4),r=e.l,s=!1;t>24&&(e.l+=t-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(s=!0),e.l=r);var a=e.read_shift((s?t-24:t)>>1,"utf16le").replace(Li,"");return s&&(e.l+=24),a}function H9(e){for(var t=e.read_shift(2),r="";t-- >0;)r+="../";var s=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var a=e.read_shift(4);if(a===0)return r+s.replace(/\\/g,"/");var i=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var o=e.read_shift(i>>1,"utf16le").replace(Li,"");return r+o}function V9(e,t){var r=e.read_shift(16);switch(r){case"e0c9ea79f9bace118c8200aa004ba90b":return q9(e);case"0303000000000000c000000000000046":return H9(e);default:throw new Error("Unsupported Moniker "+r)}}function Om(e){var t=e.read_shift(4),r=t>0?e.read_shift(t,"utf16le").replace(Li,""):"";return r}function ik(e,t){t||(t=xr(6+e.length*2)),t.write_shift(4,1+e.length);for(var r=0;r<e.length;++r)t.write_shift(2,e.charCodeAt(r));return t.write_shift(2,0),t}function G9(e,t){var r=e.l+t,s=e.read_shift(4);if(s!==2)throw new Error("Unrecognized streamVersion: "+s);var a=e.read_shift(2);e.l+=2;var i,o,l,c,d="",u,h;a&16&&(i=Om(e,r-e.l)),a&128&&(o=Om(e,r-e.l)),(a&257)===257&&(l=Om(e,r-e.l)),(a&257)===1&&(c=V9(e,r-e.l)),a&8&&(d=Om(e,r-e.l)),a&32&&(u=e.read_shift(16)),a&64&&(h=Nw(e)),e.l=r;var p=o||l||c||"";p&&d&&(p+="#"+d),p||(p="#"+d),a&2&&p.charAt(0)=="/"&&p.charAt(1)!="/"&&(p="file://"+p);var f={Target:p};return u&&(f.guid=u),h&&(f.time=h),i&&(f.Tooltip=i),f}function Q9(e){var t=xr(512),r=0,s=e.Target;s.slice(0,7)=="file://"&&(s=s.slice(7));var a=s.indexOf("#"),i=a>-1?31:23;switch(s.charAt(0)){case"#":i=28;break;case".":i&=-3;break}t.write_shift(4,2),t.write_shift(4,i);var o=[8,6815827,6619237,4849780,83];for(r=0;r<o.length;++r)t.write_shift(4,o[r]);if(i==28)s=s.slice(1),ik(s,t);else if(i&2){for(o="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<o.length;++r)t.write_shift(1,parseInt(o[r],16));var l=a>-1?s.slice(0,a):s;for(t.write_shift(4,2*(l.length+1)),r=0;r<l.length;++r)t.write_shift(2,l.charCodeAt(r));t.write_shift(2,0),i&8&&ik(a>-1?s.slice(a+1):"",t)}else{for(o="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),r=0;r<o.length;++r)t.write_shift(1,parseInt(o[r],16));for(var c=0;s.slice(c*3,c*3+3)=="../"||s.slice(c*3,c*3+3)=="..\\";)++c;for(t.write_shift(2,c),t.write_shift(4,s.length-3*c+1),r=0;r<s.length-3*c;++r)t.write_shift(1,s.charCodeAt(r+3*c)&255);for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),r=0;r<6;++r)t.write_shift(4,0)}return t.slice(0,t.l)}function pC(e){var t=e.read_shift(1),r=e.read_shift(1),s=e.read_shift(1),a=e.read_shift(1);return[t,r,s,a]}function mC(e,t){var r=pC(e);return r[3]=0,r}function Ql(e){var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(2);return{r:t,c:r,ixfe:s}}function ju(e,t,r,s){return s||(s=xr(6)),s.write_shift(2,e),s.write_shift(2,t),s.write_shift(2,r||0),s}function X9(e){var t=e.read_shift(2),r=e.read_shift(2);return e.l+=8,{type:t,flags:r}}function Y9(e,t,r){return t===0?"":$u(e,t,r)}function K9(e,t,r){var s=r.biff>8?4:2,a=e.read_shift(s),i=e.read_shift(s,"i"),o=e.read_shift(s,"i");return[a,i,o]}function xC(e){var t=e.read_shift(2),r=_w(e);return[t,r]}function J9(e,t,r){e.l+=4,t-=4;var s=e.l+t,a=$p(e,t,r),i=e.read_shift(2);if(s-=e.l,i!==s)throw new Error("Malformed AddinUdf: padding = "+s+" != "+i);return e.l+=i,a}function xg(e){var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2);return{s:{c:s,r:t},e:{c:a,r}}}function gC(e,t){return t||(t=xr(8)),t.write_shift(2,e.s.r),t.write_shift(2,e.e.r),t.write_shift(2,e.s.c),t.write_shift(2,e.e.c),t}function yC(e){var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(1),a=e.read_shift(1);return{s:{c:s,r:t},e:{c:a,r}}}var Z9=yC;function bC(e){e.l+=4;var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(2);return e.l+=12,[r,t,s]}function eI(e){var t={};return e.l+=4,e.l+=16,t.fSharedNote=e.read_shift(2),e.l+=4,t}function tI(e){var t={};return e.l+=4,e.cf=e.read_shift(2),t}function ai(e){e.l+=2,e.l+=e.read_shift(2)}var rI={0:ai,4:ai,5:ai,6:ai,7:tI,8:ai,9:ai,10:ai,11:ai,12:ai,13:eI,14:ai,15:ai,16:ai,17:ai,18:ai,19:ai,20:ai,21:bC};function nI(e,t){for(var r=e.l+t,s=[];e.l<r;){var a=e.read_shift(2);e.l-=2;try{s.push(rI[a](e,r-e.l))}catch{return e.l=r,s}}return e.l!=r&&(e.l=r),s}function Im(e,t){var r={BIFFVer:0,dt:0};switch(r.BIFFVer=e.read_shift(2),t-=2,t>=2&&(r.dt=e.read_shift(2),e.l-=2),r.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(t>6)throw new Error("Unexpected BIFF Ver "+r.BIFFVer)}return e.read_shift(t),r}function Aw(e,t,r){var s=1536,a=16;switch(r.bookType){case"biff8":break;case"biff5":s=1280,a=8;break;case"biff4":s=4,a=6;break;case"biff3":s=3,a=6;break;case"biff2":s=2,a=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var i=xr(a);return i.write_shift(2,s),i.write_shift(2,t),a>4&&i.write_shift(2,29282),a>6&&i.write_shift(2,1997),a>8&&(i.write_shift(2,49161),i.write_shift(2,1),i.write_shift(2,1798),i.write_shift(2,0)),i}function sI(e,t){return t===0||e.read_shift(2),1200}function aI(e,t,r){if(r.enc)return e.l+=t,"";var s=e.l,a=$u(e,0,r);return e.read_shift(t+s-e.l),a}function iI(e,t){var r=!t||t.biff==8,s=xr(r?112:54);for(s.write_shift(t.biff==8?2:1,7),r&&s.write_shift(1,0),s.write_shift(4,859007059),s.write_shift(4,5458548|(r?0:536870912));s.l<s.length;)s.write_shift(1,r?0:32);return s}function oI(e,t,r){var s=r&&r.biff==8||t==2?e.read_shift(2):(e.l+=t,0);return{fDialog:s&16,fBelow:s&64,fRight:s&128}}function lI(e,t,r){var s=e.read_shift(4),a=e.read_shift(1)&3,i=e.read_shift(1);switch(i){case 0:i="Worksheet";break;case 1:i="Macrosheet";break;case 2:i="Chartsheet";break;case 6:i="VBAModule";break}var o=$p(e,0,r);return o.length===0&&(o="Sheet1"),{pos:s,hs:a,dt:i,name:o}}function cI(e,t){var r=!t||t.biff>=8?2:1,s=xr(8+r*e.name.length);s.write_shift(4,e.pos),s.write_shift(1,e.hs||0),s.write_shift(1,e.dt),s.write_shift(1,e.name.length),t.biff>=8&&s.write_shift(1,1),s.write_shift(r*e.name.length,e.name,t.biff<8?"sbcs":"utf16le");var a=s.slice(0,s.l);return a.l=s.l,a}function dI(e,t){for(var r=e.l+t,s=e.read_shift(4),a=e.read_shift(4),i=[],o=0;o!=a&&e.l<r;++o)i.push($9(e));return i.Count=s,i.Unique=a,i}function uI(e,t){var r=xr(8);r.write_shift(4,e.Count),r.write_shift(4,e.Unique);for(var s=[],a=0;a<e.length;++a)s[a]=W9(e[a]);var i=Ia([r].concat(s));return i.parts=[r.length].concat(s.map(function(o){return o.length})),i}function fI(e,t){var r={};return r.dsst=e.read_shift(2),e.l+=t-2,r}function hI(e){var t={};t.r=e.read_shift(2),t.c=e.read_shift(2),t.cnt=e.read_shift(2)-t.c;var r=e.read_shift(2);e.l+=4;var s=e.read_shift(1);return e.l+=3,s&7&&(t.level=s&7),s&32&&(t.hidden=!0),s&64&&(t.hpt=r/20),t}function pI(e){var t=X9(e);if(t.type!=2211)throw new Error("Invalid Future Record "+t.type);var r=e.read_shift(4);return r!==0}function mI(e){return e.read_shift(2),e.read_shift(4)}function ok(e,t,r){var s=0;r&&r.biff==2||(s=e.read_shift(2));var a=e.read_shift(2);r&&r.biff==2&&(s=1-(a>>15),a&=32767);var i={Unsynced:s&1,DyZero:(s&2)>>1,ExAsc:(s&4)>>2,ExDsc:(s&8)>>3};return[i,a]}function xI(e){var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(2),a=e.read_shift(2),i=e.read_shift(2),o=e.read_shift(2),l=e.read_shift(2),c=e.read_shift(2),d=e.read_shift(2);return{Pos:[t,r],Dim:[s,a],Flags:i,CurTab:o,FirstTab:l,Selected:c,TabRatio:d}}function gI(){var e=xr(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}function yI(e,t,r){if(r&&r.biff>=2&&r.biff<5)return{};var s=e.read_shift(2);return{RTL:s&64}}function bI(e){var t=xr(18),r=1718;return e&&e.RTL&&(r|=64),t.write_shift(2,r),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}function vI(){}function wI(e,t,r){var s={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(r&&r.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return s.name=$p(e,0,r),s}function SI(e,t){var r=e.name||"Arial",s=t&&t.biff==5,a=s?15+r.length:16+2*r.length,i=xr(a);return i.write_shift(2,e.sz*20),i.write_shift(4,0),i.write_shift(2,400),i.write_shift(4,0),i.write_shift(2,0),i.write_shift(1,r.length),s||i.write_shift(1,1),i.write_shift((s?1:2)*r.length,r,s?"sbcs":"utf16le"),i}function _I(e){var t=Ql(e);return t.isst=e.read_shift(4),t}function kI(e,t,r,s){var a=xr(10);return ju(e,t,s,a),a.write_shift(4,r),a}function jI(e,t,r){r.biffguess&&r.biff==2&&(r.biff=5);var s=e.l+t,a=Ql(e);r.biff==2&&e.l++;var i=Wp(e,s-e.l,r);return a.val=i,a}function NI(e,t,r,s,a){var i=!a||a.biff==8,o=xr(8+ +i+(1+i)*r.length);return ju(e,t,s,o),o.write_shift(2,r.length),i&&o.write_shift(1,1),o.write_shift((1+i)*r.length,r,i?"utf16le":"sbcs"),o}function AI(e,t,r){var s=e.read_shift(2),a=$u(e,0,r);return[s,a]}function CI(e,t,r,s){var a=r&&r.biff==5;s||(s=xr(a?3+t.length:5+2*t.length)),s.write_shift(2,e),s.write_shift(a?1:2,t.length),a||s.write_shift(1,1),s.write_shift((a?1:2)*t.length,t,a?"sbcs":"utf16le");var i=s.length>s.l?s.slice(0,s.l):s;return i.l==null&&(i.l=i.length),i}var EI=$u;function lk(e,t,r){var s=e.l+t,a=r.biff==8||!r.biff?4:2,i=e.read_shift(a),o=e.read_shift(a),l=e.read_shift(2),c=e.read_shift(2);return e.l=s,{s:{r:i,c:l},e:{r:o,c}}}function TI(e,t){var r=t.biff==8||!t.biff?4:2,s=xr(2*r+6);return s.write_shift(r,e.s.r),s.write_shift(r,e.e.r+1),s.write_shift(2,e.s.c),s.write_shift(2,e.e.c+1),s.write_shift(2,0),s}function LI(e){var t=e.read_shift(2),r=e.read_shift(2),s=xC(e);return{r:t,c:r,ixfe:s[0],rknum:s[1]}}function FI(e,t){for(var r=e.l+t-2,s=e.read_shift(2),a=e.read_shift(2),i=[];e.l<r;)i.push(xC(e));if(e.l!==r)throw new Error("MulRK read error");var o=e.read_shift(2);if(i.length!=o-a+1)throw new Error("MulRK length mismatch");return{r:s,c:a,C:o,rkrec:i}}function MI(e,t){for(var r=e.l+t-2,s=e.read_shift(2),a=e.read_shift(2),i=[];e.l<r;)i.push(e.read_shift(2));if(e.l!==r)throw new Error("MulBlank read error");var o=e.read_shift(2);if(i.length!=o-a+1)throw new Error("MulBlank length mismatch");return{r:s,c:a,C:o,ixfe:i}}function RI(e,t,r,s){var a={},i=e.read_shift(4),o=e.read_shift(4),l=e.read_shift(4),c=e.read_shift(2);return a.patternType=p9[l>>26],s.cellStyles&&(a.alc=i&7,a.fWrap=i>>3&1,a.alcV=i>>4&7,a.fJustLast=i>>7&1,a.trot=i>>8&255,a.cIndent=i>>16&15,a.fShrinkToFit=i>>20&1,a.iReadOrder=i>>22&2,a.fAtrNum=i>>26&1,a.fAtrFnt=i>>27&1,a.fAtrAlc=i>>28&1,a.fAtrBdr=i>>29&1,a.fAtrPat=i>>30&1,a.fAtrProt=i>>31&1,a.dgLeft=o&15,a.dgRight=o>>4&15,a.dgTop=o>>8&15,a.dgBottom=o>>12&15,a.icvLeft=o>>16&127,a.icvRight=o>>23&127,a.grbitDiag=o>>30&3,a.icvTop=l&127,a.icvBottom=l>>7&127,a.icvDiag=l>>14&127,a.dgDiag=l>>21&15,a.icvFore=c&127,a.icvBack=c>>7&127,a.fsxButton=c>>14&1),a}function BI(e,t,r){var s={};return s.ifnt=e.read_shift(2),s.numFmtId=e.read_shift(2),s.flags=e.read_shift(2),s.fStyle=s.flags>>2&1,t-=6,s.data=RI(e,t,s.fStyle,r),s}function ck(e,t,r,s){var a=r&&r.biff==5;s||(s=xr(a?16:20)),s.write_shift(2,0),e.style?(s.write_shift(2,e.numFmtId||0),s.write_shift(2,65524)):(s.write_shift(2,e.numFmtId||0),s.write_shift(2,t<<4));var i=0;return e.numFmtId>0&&a&&(i|=1024),s.write_shift(4,i),s.write_shift(4,0),a||s.write_shift(4,0),s.write_shift(2,0),s}function PI(e){e.l+=4;var t=[e.read_shift(2),e.read_shift(2)];if(t[0]!==0&&t[0]--,t[1]!==0&&t[1]--,t[0]>7||t[1]>7)throw new Error("Bad Gutters: "+t.join("|"));return t}function OI(e){var t=xr(8);return t.write_shift(4,0),t.write_shift(2,0),t.write_shift(2,0),t}function dk(e,t,r){var s=Ql(e);(r.biff==2||t==9)&&++e.l;var a=U9(e);return s.val=a,s.t=a===!0||a===!1?"b":"e",s}function II(e,t,r,s,a,i){var o=xr(8);return ju(e,t,s,o),fC(r,i,o),o}function DI(e,t,r){r.biffguess&&r.biff==2&&(r.biff=5);var s=Ql(e),a=xi(e);return s.val=a,s}function UI(e,t,r,s){var a=xr(14);return ju(e,t,s,a),_u(r,a),a}var uk=Y9;function $I(e,t,r){var s=e.l+t,a=e.read_shift(2),i=e.read_shift(2);if(r.sbcch=i,i==1025||i==14849)return[i,a];if(i<1||i>255)throw new Error("Unexpected SupBook type: "+i);for(var o=ku(e,i),l=[];s>e.l;)l.push(Wp(e));return[i,a,o,l]}function fk(e,t,r){var s=e.read_shift(2),a,i={fBuiltIn:s&1,fWantAdvise:s>>>1&1,fWantPict:s>>>2&1,fOle:s>>>3&1,fOleLink:s>>>4&1,cf:s>>>5&1023,fIcon:s>>>15&1};return r.sbcch===14849&&(a=J9(e,t-2,r)),i.body=a||e.read_shift(t-2),typeof a=="string"&&(i.Name=a),i}var WI=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function hk(e,t,r){var s=e.l+t,a=e.read_shift(2),i=e.read_shift(1),o=e.read_shift(1),l=e.read_shift(r&&r.biff==2?1:2),c=0;(!r||r.biff>=5)&&(r.biff!=5&&(e.l+=2),c=e.read_shift(2),r.biff==5&&(e.l+=2),e.l+=4);var d=ku(e,o,r);a&32&&(d=WI[d.charCodeAt(0)]);var u=s-e.l;r&&r.biff==2&&--u;var h=s==e.l||l===0||!(u>0)?[]:nz(e,u,r,l);return{chKey:i,Name:d,itab:c,rgce:h}}function vC(e,t,r){if(r.biff<8)return zI(e,t,r);for(var s=[],a=e.l+t,i=e.read_shift(r.biff>8?4:2);i--!==0;)s.push(K9(e,r.biff>8?12:6,r));if(e.l!=a)throw new Error("Bad ExternSheet: "+e.l+" != "+a);return s}function zI(e,t,r){e[e.l+1]==3&&e[e.l]++;var s=$p(e,t,r);return s.charCodeAt(0)==3?s.slice(1):s}function qI(e,t,r){if(r.biff<8){e.l+=t;return}var s=e.read_shift(2),a=e.read_shift(2),i=ku(e,s,r),o=ku(e,a,r);return[i,o]}function HI(e,t,r){var s=yC(e);e.l++;var a=e.read_shift(1);return t-=8,[sz(e,t,r),a,s]}function pk(e,t,r){var s=Z9(e);switch(r.biff){case 2:e.l++,t-=7;break;case 3:case 4:e.l+=2,t-=8;break;default:e.l+=6,t-=12}return[s,tz(e,t,r)]}function VI(e){var t=e.read_shift(4)!==0,r=e.read_shift(4)!==0,s=e.read_shift(4);return[t,r,s]}function GI(e,t,r){if(!(r.biff<8)){var s=e.read_shift(2),a=e.read_shift(2),i=e.read_shift(2),o=e.read_shift(2),l=$u(e,0,r);return r.biff<8&&e.read_shift(1),[{r:s,c:a},l,o,i]}}function QI(e,t,r){return GI(e,t,r)}function XI(e,t){for(var r=[],s=e.read_shift(2);s--;)r.push(xg(e));return r}function YI(e){var t=xr(2+e.length*8);t.write_shift(2,e.length);for(var r=0;r<e.length;++r)gC(e[r],t);return t}function KI(e,t,r){if(r&&r.biff<8)return ZI(e,t,r);var s=bC(e),a=nI(e,t-22,s[1]);return{cmo:s,ft:a}}var JI={8:function(e,t){var r=e.l+t;e.l+=10;var s=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var a=e.read_shift(1);return e.l+=a,e.l=r,{fmt:s}}};function ZI(e,t,r){e.l+=4;var s=e.read_shift(2),a=e.read_shift(2),i=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,t-=36;var o=[];return o.push((JI[s]||vi)(e,t,r)),{cmo:[a,s,i],ft:o}}function eD(e,t,r){var s=e.l,a="";try{e.l+=4;var i=(r.lastobj||{cmo:[0,0]}).cmo[1],o;[0,5,7,11,12,14].indexOf(i)==-1?e.l+=6:o=z9(e,6,r);var l=e.read_shift(2);e.read_shift(2),ya(e,2);var c=e.read_shift(2);e.l+=c;for(var d=1;d<e.lens.length-1;++d){if(e.l-s!=e.lens[d])throw new Error("TxO: bad continue record");var u=e[e.l],h=ku(e,e.lens[d+1]-e.lens[d]-1);if(a+=h,a.length>=(u?l:2*l))break}if(a.length!==l&&a.length!==l*2)throw new Error("cchText: "+l+" != "+a.length);return e.l=s+t,{t:a}}catch{return e.l=s+t,{t:a}}}function tD(e,t){var r=xg(e);e.l+=16;var s=G9(e,t-24);return[r,s]}function rD(e){var t=xr(24),r=Is(e[0]);t.write_shift(2,r.r),t.write_shift(2,r.r),t.write_shift(2,r.c),t.write_shift(2,r.c);for(var s="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),a=0;a<16;++a)t.write_shift(1,parseInt(s[a],16));return Ia([t,Q9(e[1])])}function nD(e,t){e.read_shift(2);var r=xg(e),s=e.read_shift((t-10)/2,"dbcs-cont");return s=s.replace(Li,""),[r,s]}function sD(e){var t=e[1].Tooltip,r=xr(10+2*(t.length+1));r.write_shift(2,2048);var s=Is(e[0]);r.write_shift(2,s.r),r.write_shift(2,s.r),r.write_shift(2,s.c),r.write_shift(2,s.c);for(var a=0;a<t.length;++a)r.write_shift(2,t.charCodeAt(a));return r.write_shift(2,0),r}function aD(e){var t=[0,0],r;return r=e.read_shift(2),t[0]=J_[r]||r,r=e.read_shift(2),t[1]=J_[r]||r,t}function iD(e){return e||(e=xr(4)),e.write_shift(2,1),e.write_shift(2,1),e}function oD(e){for(var t=e.read_shift(2),r=[];t-- >0;)r.push(mC(e));return r}function lD(e){for(var t=e.read_shift(2),r=[];t-- >0;)r.push(mC(e));return r}function cD(e){e.l+=2;var t={cxfs:0,crc:0};return t.cxfs=e.read_shift(2),t.crc=e.read_shift(4),t}function wC(e,t,r){if(!r.cellStyles)return vi(e,t);var s=r&&r.biff>=12?4:2,a=e.read_shift(s),i=e.read_shift(s),o=e.read_shift(s),l=e.read_shift(s),c=e.read_shift(2);s==2&&(e.l+=2);var d={s:a,e:i,w:o,ixfe:l,flags:c};return(r.biff>=5||!r.biff)&&(d.level=c>>8&7),d}function dD(e,t){var r=xr(12);r.write_shift(2,t),r.write_shift(2,t),r.write_shift(2,e.width*256),r.write_shift(2,0);var s=0;return e.hidden&&(s|=1),r.write_shift(1,s),s=e.level||0,r.write_shift(1,s),r.write_shift(2,0),r}function uD(e,t){var r={};return t<32||(e.l+=16,r.header=xi(e),r.footer=xi(e),e.l+=2),r}function fD(e,t,r){var s={area:!1};if(r.biff!=5)return e.l+=t,s;var a=e.read_shift(1);return e.l+=3,a&16&&(s.area=!0),s}function hD(e){for(var t=xr(2*e),r=0;r<e;++r)t.write_shift(2,r+1);return t}var pD=Ql,mD=uC,xD=Wp;function gD(e){var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(4),a={fmt:t,env:r,len:s,data:e.slice(e.l,e.l+s)};return e.l+=s,a}function yD(e,t,r){r.biffguess&&r.biff==5&&(r.biff=2);var s=Ql(e);++e.l;var a=$u(e,t-7,r);return s.t="str",s.val=a,s}function bD(e){var t=Ql(e);++e.l;var r=xi(e);return t.t="n",t.val=r,t}function vD(e,t,r){var s=xr(15);return Vp(s,e,t),s.write_shift(8,r,"f"),s}function wD(e){var t=Ql(e);++e.l;var r=e.read_shift(2);return t.t="n",t.val=r,t}function SD(e,t,r){var s=xr(9);return Vp(s,e,t),s.write_shift(2,r),s}function _D(e){var t=e.read_shift(1);return t===0?(e.l++,""):e.read_shift(t,"sbcs-cont")}function kD(e,t){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=t-13}function jD(e,t,r){var s=e.l+t,a=Ql(e),i=e.read_shift(2),o=ku(e,i,r);return e.l=s,a.t="str",a.val=o,a}var ND=[2,3,48,49,131,139,140,245],E2=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=hg({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(l,c){var d=[],u=jd(1);switch(c.type){case"base64":u=go(ko(l));break;case"binary":u=go(l);break;case"buffer":case"array":u=l;break}Ja(u,0);var h=u.read_shift(1),p=!!(h&136),f=!1,x=!1;switch(h){case 2:break;case 3:break;case 48:f=!0,p=!0;break;case 49:f=!0,p=!0;break;case 131:break;case 139:break;case 140:x=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+h.toString(16))}var g=0,y=521;h==2&&(g=u.read_shift(2)),u.l+=3,h!=2&&(g=u.read_shift(4)),g>1048576&&(g=1e6),h!=2&&(y=u.read_shift(2));var m=u.read_shift(2),w=c.codepage||1252;h!=2&&(u.l+=16,u.read_shift(1),u[u.l]!==0&&(w=e[u[u.l]]),u.l+=1,u.l+=2),x&&(u.l+=36);for(var S=[],k={},F=Math.min(u.length,h==2?521:y-10-(f?264:0)),L=x?32:11;u.l<F&&u[u.l]!=13;)switch(k={},k.name=cp.utils.decode(w,u.slice(u.l,u.l+L)).replace(/[\u0000\r\n].*$/g,""),u.l+=L,k.type=String.fromCharCode(u.read_shift(1)),h!=2&&!x&&(k.offset=u.read_shift(4)),k.len=u.read_shift(1),h==2&&(k.offset=u.read_shift(2)),k.dec=u.read_shift(1),k.name.length&&S.push(k),h!=2&&(u.l+=x?13:14),k.type){case"B":(!f||k.len!=8)&&c.WTF&&console.log("Skipping "+k.name+":"+k.type);break;case"G":case"P":c.WTF&&console.log("Skipping "+k.name+":"+k.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+k.type)}if(u[u.l]!==13&&(u.l=y-1),u.read_shift(1)!==13)throw new Error("DBF Terminator not found "+u.l+" "+u[u.l]);u.l=y;var C=0,O=0;for(d[0]=[],O=0;O!=S.length;++O)d[0][O]=S[O].name;for(;g-- >0;){if(u[u.l]===42){u.l+=m;continue}for(++u.l,d[++C]=[],O=0,O=0;O!=S.length;++O){var T=u.slice(u.l,u.l+S[O].len);u.l+=S[O].len,Ja(T,0);var W=cp.utils.decode(w,T);switch(S[O].type){case"C":W.trim().length&&(d[C][O]=W.replace(/\s+$/,""));break;case"D":W.length===8?d[C][O]=new Date(+W.slice(0,4),+W.slice(4,6)-1,+W.slice(6,8)):d[C][O]=W;break;case"F":d[C][O]=parseFloat(W.trim());break;case"+":case"I":d[C][O]=x?T.read_shift(-4,"i")^2147483648:T.read_shift(4,"i");break;case"L":switch(W.trim().toUpperCase()){case"Y":case"T":d[C][O]=!0;break;case"N":case"F":d[C][O]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+W+"|")}break;case"M":if(!p)throw new Error("DBF Unexpected MEMO for type "+h.toString(16));d[C][O]="##MEMO##"+(x?parseInt(W.trim(),10):T.read_shift(4));break;case"N":W=W.replace(/\u0000/g,"").trim(),W&&W!="."&&(d[C][O]=+W||0);break;case"@":d[C][O]=new Date(T.read_shift(-8,"f")-621356832e5);break;case"T":d[C][O]=new Date((T.read_shift(4)-2440588)*864e5+T.read_shift(4));break;case"Y":d[C][O]=T.read_shift(4,"i")/1e4+T.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":d[C][O]=-T.read_shift(-8,"f");break;case"B":if(f&&S[O].len==8){d[C][O]=T.read_shift(8,"f");break}case"G":case"P":T.l+=S[O].len;break;case"0":if(S[O].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+S[O].type)}}}if(h!=2&&u.l<u.length&&u[u.l++]!=26)throw new Error("DBF EOF Marker missing "+(u.l-1)+" of "+u.length+" "+u[u.l-1].toString(16));return c&&c.sheetRows&&(d=d.slice(0,c.sheetRows)),c.DBF=S,d}function s(l,c){var d=c||{};d.dateNF||(d.dateNF="yyyymmdd");var u=A0(r(l,d),d);return u["!cols"]=d.DBF.map(function(h){return{wch:h.len,DBF:h}}),delete d.DBF,u}function a(l,c){try{return Bd(s(l,c),c)}catch(d){if(c&&c.WTF)throw d}return{SheetNames:[],Sheets:{}}}var i={B:8,C:250,L:1,D:8,"?":0,"":0};function o(l,c){var d=c||{};if(+d.codepage>=0&&ul(+d.codepage),d.type=="string")throw new Error("Cannot write DBF to JS string");var u=Xi(),h=T1(l,{header:1,raw:!0,cellDates:!0}),p=h[0],f=h.slice(1),x=l["!cols"]||[],g=0,y=0,m=0,w=1;for(g=0;g<p.length;++g){if(((x[g]||{}).DBF||{}).name){p[g]=x[g].DBF.name,++m;continue}if(p[g]!=null){if(++m,typeof p[g]=="number"&&(p[g]=p[g].toString(10)),typeof p[g]!="string")throw new Error("DBF Invalid column name "+p[g]+" |"+typeof p[g]+"|");if(p.indexOf(p[g])!==g){for(y=0;y<1024;++y)if(p.indexOf(p[g]+"_"+y)==-1){p[g]+="_"+y;break}}}}var S=Jn(l["!ref"]),k=[],F=[],L=[];for(g=0;g<=S.e.c-S.s.c;++g){var C="",O="",T=0,W=[];for(y=0;y<f.length;++y)f[y][g]!=null&&W.push(f[y][g]);if(W.length==0||p[g]==null){k[g]="?";continue}for(y=0;y<W.length;++y){switch(typeof W[y]){case"number":O="B";break;case"string":O="C";break;case"boolean":O="L";break;case"object":O=W[y]instanceof Date?"D":"C";break;default:O="C"}T=Math.max(T,String(W[y]).length),C=C&&C!=O?"C":O}T>250&&(T=250),O=((x[g]||{}).DBF||{}).type,O=="C"&&x[g].DBF.len>T&&(T=x[g].DBF.len),C=="B"&&O=="N"&&(C="N",L[g]=x[g].DBF.dec,T=x[g].DBF.len),F[g]=C=="C"||O=="N"?T:i[C]||0,w+=F[g],k[g]=C}var A=u.next(32);for(A.write_shift(4,318902576),A.write_shift(4,f.length),A.write_shift(2,296+32*m),A.write_shift(2,w),g=0;g<4;++g)A.write_shift(4,0);for(A.write_shift(4,0|(+t[dA]||3)<<8),g=0,y=0;g<p.length;++g)if(p[g]!=null){var N=u.next(32),P=(p[g].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);N.write_shift(1,P,"sbcs"),N.write_shift(1,k[g]=="?"?"C":k[g],"sbcs"),N.write_shift(4,y),N.write_shift(1,F[g]||i[k[g]]||0),N.write_shift(1,L[g]||0),N.write_shift(1,2),N.write_shift(4,0),N.write_shift(1,0),N.write_shift(4,0),N.write_shift(4,0),y+=F[g]||i[k[g]]||0}var K=u.next(264);for(K.write_shift(4,13),g=0;g<65;++g)K.write_shift(4,0);for(g=0;g<f.length;++g){var re=u.next(w);for(re.write_shift(1,0),y=0;y<p.length;++y)if(p[y]!=null)switch(k[y]){case"L":re.write_shift(1,f[g][y]==null?63:f[g][y]?84:70);break;case"B":re.write_shift(8,f[g][y]||0,"f");break;case"N":var ge="0";for(typeof f[g][y]=="number"&&(ge=f[g][y].toFixed(L[y]||0)),m=0;m<F[y]-ge.length;++m)re.write_shift(1,32);re.write_shift(1,ge,"sbcs");break;case"D":f[g][y]?(re.write_shift(4,("0000"+f[g][y].getFullYear()).slice(-4),"sbcs"),re.write_shift(2,("00"+(f[g][y].getMonth()+1)).slice(-2),"sbcs"),re.write_shift(2,("00"+f[g][y].getDate()).slice(-2),"sbcs")):re.write_shift(8,"00000000","sbcs");break;case"C":var Fe=String(f[g][y]!=null?f[g][y]:"").slice(0,F[y]);for(re.write_shift(1,Fe,"sbcs"),m=0;m<F[y]-Fe.length;++m)re.write_shift(1,32);break}}return u.next(1).write_shift(1,26),u.end()}return{to_workbook:a,to_sheet:s,from_sheet:o}}(),SC=function(){var e={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1BN("+Ys(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),r=function(p,f){var x=e[f];return typeof x=="number"?j_(x):x},s=function(p,f,x){var g=f.charCodeAt(0)-32<<4|x.charCodeAt(0)-48;return g==59?p:j_(g)};e["|"]=254;function a(p,f){switch(f.type){case"base64":return i(ko(p),f);case"binary":return i(p,f);case"buffer":return i(Un&&Buffer.isBuffer(p)?p.toString("binary"):Rd(p),f);case"array":return i(Su(p),f)}throw new Error("Unrecognized type "+f.type)}function i(p,f){var x=p.split(/[\n\r]+/),g=-1,y=-1,m=0,w=0,S=[],k=[],F=null,L={},C=[],O=[],T=[],W=0,A;for(+f.codepage>=0&&ul(+f.codepage);m!==x.length;++m){W=0;var N=x[m].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,s).replace(t,r),P=N.replace(/;;/g,"\0").split(";").map(function(M){return M.replace(/\u0000/g,";")}),K=P[0],re;if(N.length>0)switch(K){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":P[1].charAt(0)=="P"&&k.push(N.slice(3).replace(/;;/g,";"));break;case"C":var ge=!1,Fe=!1,R=!1,q=!1,me=-1,fe=-1;for(w=1;w<P.length;++w)switch(P[w].charAt(0)){case"A":break;case"X":y=parseInt(P[w].slice(1))-1,Fe=!0;break;case"Y":for(g=parseInt(P[w].slice(1))-1,Fe||(y=0),A=S.length;A<=g;++A)S[A]=[];break;case"K":re=P[w].slice(1),re.charAt(0)==='"'?re=re.slice(1,re.length-1):re==="TRUE"?re=!0:re==="FALSE"?re=!1:isNaN(xl(re))?isNaN(l0(re).getDate())||(re=As(re)):(re=xl(re),F!==null&&j0(F)&&(re=mg(re))),ge=!0;break;case"E":q=!0;var E=Gf(P[w].slice(1),{r:g,c:y});S[g][y]=[S[g][y],E];break;case"S":R=!0,S[g][y]=[S[g][y],"S5S"];break;case"G":break;case"R":me=parseInt(P[w].slice(1))-1;break;case"C":fe=parseInt(P[w].slice(1))-1;break;default:if(f&&f.WTF)throw new Error("SYLK bad record "+N)}if(ge&&(S[g][y]&&S[g][y].length==2?S[g][y][0]=re:S[g][y]=re,F=null),R){if(q)throw new Error("SYLK shared formula cannot have own formula");var U=me>-1&&S[me][fe];if(!U||!U[1])throw new Error("SYLK shared formula cannot find base");S[g][y][1]=UC(U[1],{r:g-me,c:y-fe})}break;case"F":var I=0;for(w=1;w<P.length;++w)switch(P[w].charAt(0)){case"X":y=parseInt(P[w].slice(1))-1,++I;break;case"Y":for(g=parseInt(P[w].slice(1))-1,A=S.length;A<=g;++A)S[A]=[];break;case"M":W=parseInt(P[w].slice(1))/20;break;case"F":break;case"G":break;case"P":F=k[parseInt(P[w].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(T=P[w].slice(1).split(" "),A=parseInt(T[0],10);A<=parseInt(T[1],10);++A)W=parseInt(T[2],10),O[A-1]=W===0?{hidden:!0}:{wch:W},Nd(O[A-1]);break;case"C":y=parseInt(P[w].slice(1))-1,O[y]||(O[y]={});break;case"R":g=parseInt(P[w].slice(1))-1,C[g]||(C[g]={}),W>0?(C[g].hpt=W,C[g].hpx=d0(W)):W===0&&(C[g].hidden=!0);break;default:if(f&&f.WTF)throw new Error("SYLK bad record "+N)}I<1&&(F=null);break;default:if(f&&f.WTF)throw new Error("SYLK bad record "+N)}}return C.length>0&&(L["!rows"]=C),O.length>0&&(L["!cols"]=O),f&&f.sheetRows&&(S=S.slice(0,f.sheetRows)),[S,L]}function o(p,f){var x=a(p,f),g=x[0],y=x[1],m=A0(g,f);return Ys(y).forEach(function(w){m[w]=y[w]}),m}function l(p,f){return Bd(o(p,f),f)}function c(p,f,x,g){var y="C;Y"+(x+1)+";X"+(g+1)+";K";switch(p.t){case"n":y+=p.v||0,p.f&&!p.F&&(y+=";E"+Mw(p.f,{r:x,c:g}));break;case"b":y+=p.v?"TRUE":"FALSE";break;case"e":y+=p.w||p.v;break;case"d":y+='"'+(p.w||p.v)+'"';break;case"s":y+='"'+p.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return y}function d(p,f){f.forEach(function(x,g){var y="F;W"+(g+1)+" "+(g+1)+" ";x.hidden?y+="0":(typeof x.width=="number"&&!x.wpx&&(x.wpx=gp(x.width)),typeof x.wpx=="number"&&!x.wch&&(x.wch=yp(x.wpx)),typeof x.wch=="number"&&(y+=Math.round(x.wch))),y.charAt(y.length-1)!=" "&&p.push(y)})}function u(p,f){f.forEach(function(x,g){var y="F;";x.hidden?y+="M0;":x.hpt?y+="M"+20*x.hpt+";":x.hpx&&(y+="M"+20*bp(x.hpx)+";"),y.length>2&&p.push(y+"R"+(g+1))})}function h(p,f){var x=["ID;PWXL;N;E"],g=[],y=Jn(p["!ref"]),m,w=Array.isArray(p),S=`\r
`;x.push("P;PGeneral"),x.push("F;P0;DG0G8;M255"),p["!cols"]&&d(x,p["!cols"]),p["!rows"]&&u(x,p["!rows"]),x.push("B;Y"+(y.e.r-y.s.r+1)+";X"+(y.e.c-y.s.c+1)+";D"+[y.s.c,y.s.r,y.e.c,y.e.r].join(" "));for(var k=y.s.r;k<=y.e.r;++k)for(var F=y.s.c;F<=y.e.c;++F){var L=Sn({r:k,c:F});m=w?(p[k]||[])[F]:p[L],!(!m||m.v==null&&(!m.f||m.F))&&g.push(c(m,p,k,F))}return x.join(S)+S+g.join(S)+S+"E"+S}return{to_workbook:l,to_sheet:o,from_sheet:h}}(),_C=function(){function e(i,o){switch(o.type){case"base64":return t(ko(i),o);case"binary":return t(i,o);case"buffer":return t(Un&&Buffer.isBuffer(i)?i.toString("binary"):Rd(i),o);case"array":return t(Su(i),o)}throw new Error("Unrecognized type "+o.type)}function t(i,o){for(var l=i.split(`
`),c=-1,d=-1,u=0,h=[];u!==l.length;++u){if(l[u].trim()==="BOT"){h[++c]=[],d=0;continue}if(!(c<0)){var p=l[u].trim().split(","),f=p[0],x=p[1];++u;for(var g=l[u]||"";(g.match(/["]/g)||[]).length&1&&u<l.length-1;)g+=`
`+l[++u];switch(g=g.trim(),+f){case-1:if(g==="BOT"){h[++c]=[],d=0;continue}else if(g!=="EOD")throw new Error("Unrecognized DIF special command "+g);break;case 0:g==="TRUE"?h[c][d]=!0:g==="FALSE"?h[c][d]=!1:isNaN(xl(x))?isNaN(l0(x).getDate())?h[c][d]=x:h[c][d]=As(x):h[c][d]=xl(x),++d;break;case 1:g=g.slice(1,g.length-1),g=g.replace(/""/g,'"'),g&&g.match(/^=".*"$/)&&(g=g.slice(2,-1)),h[c][d++]=g!==""?g:null;break}if(g==="EOD")break}}return o&&o.sheetRows&&(h=h.slice(0,o.sheetRows)),h}function r(i,o){return A0(e(i,o),o)}function s(i,o){return Bd(r(i,o),o)}var a=function(){var i=function(c,d,u,h,p){c.push(d),c.push(u+","+h),c.push('"'+p.replace(/"/g,'""')+'"')},o=function(c,d,u,h){c.push(d+","+u),c.push(d==1?'"'+h.replace(/"/g,'""')+'"':h)};return function(c){var d=[],u=Jn(c["!ref"]),h,p=Array.isArray(c);i(d,"TABLE",0,1,"sheetjs"),i(d,"VECTORS",0,u.e.r-u.s.r+1,""),i(d,"TUPLES",0,u.e.c-u.s.c+1,""),i(d,"DATA",0,0,"");for(var f=u.s.r;f<=u.e.r;++f){o(d,-1,0,"BOT");for(var x=u.s.c;x<=u.e.c;++x){var g=Sn({r:f,c:x});if(h=p?(c[f]||[])[x]:c[g],!h){o(d,1,0,"");continue}switch(h.t){case"n":var y=h.w;!y&&h.v!=null&&(y=h.v),y==null?h.f&&!h.F?o(d,1,0,"="+h.f):o(d,1,0,""):o(d,0,y,"V");break;case"b":o(d,0,h.v?1:0,h.v?"TRUE":"FALSE");break;case"s":o(d,1,0,isNaN(h.v)?h.v:'="'+h.v+'"');break;case"d":h.w||(h.w=Yo(h.z||vn[14],La(As(h.v)))),o(d,0,h.w,"V");break;default:o(d,1,0,"")}}}o(d,-1,0,"EOD");var m=`\r
`,w=d.join(m);return w}}();return{to_workbook:s,to_sheet:r,from_sheet:a}}(),kC=function(){function e(h){return h.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function t(h){return h.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(h,p){for(var f=h.split(`
`),x=-1,g=-1,y=0,m=[];y!==f.length;++y){var w=f[y].trim().split(":");if(w[0]==="cell"){var S=Is(w[1]);if(m.length<=S.r)for(x=m.length;x<=S.r;++x)m[x]||(m[x]=[]);switch(x=S.r,g=S.c,w[2]){case"t":m[x][g]=e(w[3]);break;case"v":m[x][g]=+w[3];break;case"vtf":var k=w[w.length-1];case"vtc":switch(w[3]){case"nl":m[x][g]=!!+w[4];break;default:m[x][g]=+w[4];break}w[2]=="vtf"&&(m[x][g]=[m[x][g],k])}}}return p&&p.sheetRows&&(m=m.slice(0,p.sheetRows)),m}function s(h,p){return A0(r(h,p),p)}function a(h,p){return Bd(s(h,p),p)}var i=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),o=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,l=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),c="--SocialCalcSpreadsheetControlSave--";function d(h){if(!h||!h["!ref"])return"";for(var p=[],f=[],x,g="",y=Ki(h["!ref"]),m=Array.isArray(h),w=y.s.r;w<=y.e.r;++w)for(var S=y.s.c;S<=y.e.c;++S)if(g=Sn({r:w,c:S}),x=m?(h[w]||[])[S]:h[g],!(!x||x.v==null||x.t==="z")){switch(f=["cell",g,"t"],x.t){case"s":case"str":f.push(t(x.v));break;case"n":x.f?(f[2]="vtf",f[3]="n",f[4]=x.v,f[5]=t(x.f)):(f[2]="v",f[3]=x.v);break;case"b":f[2]="vt"+(x.f?"f":"c"),f[3]="nl",f[4]=x.v?"1":"0",f[5]=t(x.f||(x.v?"TRUE":"FALSE"));break;case"d":var k=La(As(x.v));f[2]="vtc",f[3]="nd",f[4]=""+k,f[5]=x.w||Yo(x.z||vn[14],k);break;case"e":continue}p.push(f.join(":"))}return p.push("sheet:c:"+(y.e.c-y.s.c+1)+":r:"+(y.e.r-y.s.r+1)+":tvf:1"),p.push("valueformat:1:text-wiki"),p.join(`
`)}function u(h){return[i,o,l,o,d(h),c].join(`
`)}return{to_workbook:a,to_sheet:s,from_sheet:u}}(),c0=function(){function e(u,h,p,f,x){x.raw?h[p][f]=u:u===""||(u==="TRUE"?h[p][f]=!0:u==="FALSE"?h[p][f]=!1:isNaN(xl(u))?isNaN(l0(u).getDate())?h[p][f]=u:h[p][f]=As(u):h[p][f]=xl(u))}function t(u,h){var p=h||{},f=[];if(!u||u.length===0)return f;for(var x=u.split(/[\r\n]/),g=x.length-1;g>=0&&x[g].length===0;)--g;for(var y=10,m=0,w=0;w<=g;++w)m=x[w].indexOf(" "),m==-1?m=x[w].length:m++,y=Math.max(y,m);for(w=0;w<=g;++w){f[w]=[];var S=0;for(e(x[w].slice(0,y).trim(),f,w,S,p),S=1;S<=(x[w].length-y)/10+1;++S)e(x[w].slice(y+(S-1)*10,y+S*10).trim(),f,w,S,p)}return p.sheetRows&&(f=f.slice(0,p.sheetRows)),f}var r={44:",",9:"	",59:";",124:"|"},s={44:3,9:2,59:1,124:0};function a(u){for(var h={},p=!1,f=0,x=0;f<u.length;++f)(x=u.charCodeAt(f))==34?p=!p:!p&&x in r&&(h[x]=(h[x]||0)+1);x=[];for(f in h)Object.prototype.hasOwnProperty.call(h,f)&&x.push([h[f],f]);if(!x.length){h=s;for(f in h)Object.prototype.hasOwnProperty.call(h,f)&&x.push([h[f],f])}return x.sort(function(g,y){return g[0]-y[0]||s[g[1]]-s[y[1]]}),r[x.pop()[1]]||44}function i(u,h){var p=h||{},f="",x=p.dense?[]:{},g={s:{c:0,r:0},e:{c:0,r:0}};u.slice(0,4)=="sep="?u.charCodeAt(5)==13&&u.charCodeAt(6)==10?(f=u.charAt(4),u=u.slice(7)):u.charCodeAt(5)==13||u.charCodeAt(5)==10?(f=u.charAt(4),u=u.slice(6)):f=a(u.slice(0,1024)):p&&p.FS?f=p.FS:f=a(u.slice(0,1024));var y=0,m=0,w=0,S=0,k=0,F=f.charCodeAt(0),L=!1,C=0,O=u.charCodeAt(0);u=u.replace(/\r\n/mg,`
`);var T=p.dateNF!=null?fO(p.dateNF):null;function W(){var A=u.slice(S,k),N={};if(A.charAt(0)=='"'&&A.charAt(A.length-1)=='"'&&(A=A.slice(1,-1).replace(/""/g,'"')),A.length===0)N.t="z";else if(p.raw)N.t="s",N.v=A;else if(A.trim().length===0)N.t="s",N.v=A;else if(A.charCodeAt(0)==61)A.charCodeAt(1)==34&&A.charCodeAt(A.length-1)==34?(N.t="s",N.v=A.slice(2,-1).replace(/""/g,'"')):$$(A)?(N.t="n",N.f=A.slice(1)):(N.t="s",N.v=A);else if(A=="TRUE")N.t="b",N.v=!0;else if(A=="FALSE")N.t="b",N.v=!1;else if(!isNaN(w=xl(A)))N.t="n",p.cellText!==!1&&(N.w=A),N.v=w;else if(!isNaN(l0(A).getDate())||T&&A.match(T)){N.z=p.dateNF||vn[14];var P=0;T&&A.match(T)&&(A=hO(A,p.dateNF,A.match(T)||[]),P=1),p.cellDates?(N.t="d",N.v=As(A,P)):(N.t="n",N.v=La(As(A,P))),p.cellText!==!1&&(N.w=Yo(N.z,N.v instanceof Date?La(N.v):N.v)),p.cellNF||delete N.z}else N.t="s",N.v=A;if(N.t=="z"||(p.dense?(x[y]||(x[y]=[]),x[y][m]=N):x[Sn({c:m,r:y})]=N),S=k+1,O=u.charCodeAt(S),g.e.c<m&&(g.e.c=m),g.e.r<y&&(g.e.r=y),C==F)++m;else if(m=0,++y,p.sheetRows&&p.sheetRows<=y)return!0}e:for(;k<u.length;++k)switch(C=u.charCodeAt(k)){case 34:O===34&&(L=!L);break;case F:case 10:case 13:if(!L&&W())break e;break}return k-S>0&&W(),x["!ref"]=Ln(g),x}function o(u,h){return!(h&&h.PRN)||h.FS||u.slice(0,4)=="sep="||u.indexOf("	")>=0||u.indexOf(",")>=0||u.indexOf(";")>=0?i(u,h):A0(t(u,h),h)}function l(u,h){var p="",f=h.type=="string"?[0,0,0,0]:$w(u,h);switch(h.type){case"base64":p=ko(u);break;case"binary":p=u;break;case"buffer":h.codepage==65001?p=u.toString("utf8"):h.codepage&&typeof cp<"u"||(p=Un&&Buffer.isBuffer(u)?u.toString("binary"):Rd(u));break;case"array":p=Su(u);break;case"string":p=u;break;default:throw new Error("Unrecognized type "+h.type)}return f[0]==239&&f[1]==187&&f[2]==191?p=hs(p.slice(3)):h.type!="string"&&h.type!="buffer"&&h.codepage==65001?p=hs(p):h.type=="binary"&&typeof cp<"u",p.slice(0,19)=="socialcalc:version:"?kC.to_sheet(h.type=="string"?p:hs(p),h):o(p,h)}function c(u,h){return Bd(l(u,h),h)}function d(u){for(var h=[],p=Jn(u["!ref"]),f,x=Array.isArray(u),g=p.s.r;g<=p.e.r;++g){for(var y=[],m=p.s.c;m<=p.e.c;++m){var w=Sn({r:g,c:m});if(f=x?(u[g]||[])[m]:u[w],!f||f.v==null){y.push("          ");continue}for(var S=(f.w||(Nc(f),f.w)||"").slice(0,10);S.length<10;)S+=" ";y.push(S+(m===0?" ":""))}h.push(y.join(""))}return h.join(`
`)}return{to_workbook:c,to_sheet:l,from_sheet:d}}();function AD(e,t){var r=t||{},s=!!r.WTF;r.WTF=!0;try{var a=SC.to_workbook(e,r);return r.WTF=s,a}catch(i){if(r.WTF=s,!i.message.match(/SYLK bad record ID/)&&s)throw i;return c0.to_workbook(e,t)}}var du=function(){function e(E,U,I){if(E){Ja(E,E.l||0);for(var M=I.Enum||me;E.l<E.length;){var te=E.read_shift(2),Q=M[te]||M[65535],G=E.read_shift(2),ne=E.l+G,z=Q.f&&Q.f(E,G,I);if(E.l=ne,U(z,Q,te))return}}}function t(E,U){switch(U.type){case"base64":return r(go(ko(E)),U);case"binary":return r(go(E),U);case"buffer":case"array":return r(E,U)}throw"Unsupported type "+U.type}function r(E,U){if(!E)return E;var I=U||{},M=I.dense?[]:{},te="Sheet1",Q="",G=0,ne={},z=[],he=[],X={s:{r:0,c:0},e:{r:0,c:0}},H=I.sheetRows||0;if(E[2]==0&&(E[3]==8||E[3]==9)&&E.length>=16&&E[14]==5&&E[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(E[2]==2)I.Enum=me,e(E,function(le,$e,je){switch(je){case 0:I.vers=le,le>=4096&&(I.qpro=!0);break;case 6:X=le;break;case 204:le&&(Q=le);break;case 222:Q=le;break;case 15:case 51:I.qpro||(le[1].v=le[1].v.slice(1));case 13:case 14:case 16:je==14&&(le[2]&112)==112&&(le[2]&15)>1&&(le[2]&15)<15&&(le[1].z=I.dateNF||vn[14],I.cellDates&&(le[1].t="d",le[1].v=mg(le[1].v))),I.qpro&&le[3]>G&&(M["!ref"]=Ln(X),ne[te]=M,z.push(te),M=I.dense?[]:{},X={s:{r:0,c:0},e:{r:0,c:0}},G=le[3],te=Q||"Sheet"+(G+1),Q="");var We=I.dense?(M[le[0].r]||[])[le[0].c]:M[Sn(le[0])];if(We){We.t=le[1].t,We.v=le[1].v,le[1].z!=null&&(We.z=le[1].z),le[1].f!=null&&(We.f=le[1].f);break}I.dense?(M[le[0].r]||(M[le[0].r]=[]),M[le[0].r][le[0].c]=le[1]):M[Sn(le[0])]=le[1];break}},I);else if(E[2]==26||E[2]==14)I.Enum=fe,E[2]==14&&(I.qpro=!0,E.l=0),e(E,function(le,$e,je){switch(je){case 204:te=le;break;case 22:le[1].v=le[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(le[3]>G&&(M["!ref"]=Ln(X),ne[te]=M,z.push(te),M=I.dense?[]:{},X={s:{r:0,c:0},e:{r:0,c:0}},G=le[3],te="Sheet"+(G+1)),H>0&&le[0].r>=H)break;I.dense?(M[le[0].r]||(M[le[0].r]=[]),M[le[0].r][le[0].c]=le[1]):M[Sn(le[0])]=le[1],X.e.c<le[0].c&&(X.e.c=le[0].c),X.e.r<le[0].r&&(X.e.r=le[0].r);break;case 27:le[14e3]&&(he[le[14e3][0]]=le[14e3][1]);break;case 1537:he[le[0]]=le[1],le[0]==G&&(te=le[1]);break}},I);else throw new Error("Unrecognized LOTUS BOF "+E[2]);if(M["!ref"]=Ln(X),ne[Q||te]=M,z.push(Q||te),!he.length)return{SheetNames:z,Sheets:ne};for(var oe={},D=[],Y=0;Y<he.length;++Y)ne[z[Y]]?(D.push(he[Y]||z[Y]),oe[he[Y]]=ne[he[Y]]||ne[z[Y]]):(D.push(he[Y]),oe[he[Y]]={"!ref":"A1"});return{SheetNames:D,Sheets:oe}}function s(E,U){var I=U||{};if(+I.codepage>=0&&ul(+I.codepage),I.type=="string")throw new Error("Cannot write WK1 to JS string");var M=Xi(),te=Jn(E["!ref"]),Q=Array.isArray(E),G=[];Hr(M,0,i(1030)),Hr(M,6,c(te));for(var ne=Math.min(te.e.r,8191),z=te.s.r;z<=ne;++z)for(var he=ua(z),X=te.s.c;X<=te.e.c;++X){z===te.s.r&&(G[X]=Os(X));var H=G[X]+he,oe=Q?(E[z]||[])[X]:E[H];if(!(!oe||oe.t=="z"))if(oe.t=="n")(oe.v|0)==oe.v&&oe.v>=-32768&&oe.v<=32767?Hr(M,13,f(z,X,oe.v)):Hr(M,14,g(z,X,oe.v));else{var D=Nc(oe);Hr(M,15,h(z,X,D.slice(0,239)))}}return Hr(M,1),M.end()}function a(E,U){var I=U||{};if(+I.codepage>=0&&ul(+I.codepage),I.type=="string")throw new Error("Cannot write WK3 to JS string");var M=Xi();Hr(M,0,o(E));for(var te=0,Q=0;te<E.SheetNames.length;++te)(E.Sheets[E.SheetNames[te]]||{})["!ref"]&&Hr(M,27,q(E.SheetNames[te],Q++));var G=0;for(te=0;te<E.SheetNames.length;++te){var ne=E.Sheets[E.SheetNames[te]];if(!(!ne||!ne["!ref"])){for(var z=Jn(ne["!ref"]),he=Array.isArray(ne),X=[],H=Math.min(z.e.r,8191),oe=z.s.r;oe<=H;++oe)for(var D=ua(oe),Y=z.s.c;Y<=z.e.c;++Y){oe===z.s.r&&(X[Y]=Os(Y));var le=X[Y]+D,$e=he?(ne[oe]||[])[Y]:ne[le];if(!(!$e||$e.t=="z"))if($e.t=="n")Hr(M,23,W(oe,Y,G,$e.v));else{var je=Nc($e);Hr(M,22,C(oe,Y,G,je.slice(0,239)))}}++G}}return Hr(M,1),M.end()}function i(E){var U=xr(2);return U.write_shift(2,E),U}function o(E){var U=xr(26);U.write_shift(2,4096),U.write_shift(2,4),U.write_shift(4,0);for(var I=0,M=0,te=0,Q=0;Q<E.SheetNames.length;++Q){var G=E.SheetNames[Q],ne=E.Sheets[G];if(!(!ne||!ne["!ref"])){++te;var z=Ki(ne["!ref"]);I<z.e.r&&(I=z.e.r),M<z.e.c&&(M=z.e.c)}}return I>8191&&(I=8191),U.write_shift(2,I),U.write_shift(1,te),U.write_shift(1,M),U.write_shift(2,0),U.write_shift(2,0),U.write_shift(1,1),U.write_shift(1,2),U.write_shift(4,0),U.write_shift(4,0),U}function l(E,U,I){var M={s:{c:0,r:0},e:{c:0,r:0}};return U==8&&I.qpro?(M.s.c=E.read_shift(1),E.l++,M.s.r=E.read_shift(2),M.e.c=E.read_shift(1),E.l++,M.e.r=E.read_shift(2),M):(M.s.c=E.read_shift(2),M.s.r=E.read_shift(2),U==12&&I.qpro&&(E.l+=2),M.e.c=E.read_shift(2),M.e.r=E.read_shift(2),U==12&&I.qpro&&(E.l+=2),M.s.c==65535&&(M.s.c=M.e.c=M.s.r=M.e.r=0),M)}function c(E){var U=xr(8);return U.write_shift(2,E.s.c),U.write_shift(2,E.s.r),U.write_shift(2,E.e.c),U.write_shift(2,E.e.r),U}function d(E,U,I){var M=[{c:0,r:0},{t:"n",v:0},0,0];return I.qpro&&I.vers!=20768?(M[0].c=E.read_shift(1),M[3]=E.read_shift(1),M[0].r=E.read_shift(2),E.l+=2):(M[2]=E.read_shift(1),M[0].c=E.read_shift(2),M[0].r=E.read_shift(2)),M}function u(E,U,I){var M=E.l+U,te=d(E,U,I);if(te[1].t="s",I.vers==20768){E.l++;var Q=E.read_shift(1);return te[1].v=E.read_shift(Q,"utf8"),te}return I.qpro&&E.l++,te[1].v=E.read_shift(M-E.l,"cstr"),te}function h(E,U,I){var M=xr(7+I.length);M.write_shift(1,255),M.write_shift(2,U),M.write_shift(2,E),M.write_shift(1,39);for(var te=0;te<M.length;++te){var Q=I.charCodeAt(te);M.write_shift(1,Q>=128?95:Q)}return M.write_shift(1,0),M}function p(E,U,I){var M=d(E,U,I);return M[1].v=E.read_shift(2,"i"),M}function f(E,U,I){var M=xr(7);return M.write_shift(1,255),M.write_shift(2,U),M.write_shift(2,E),M.write_shift(2,I,"i"),M}function x(E,U,I){var M=d(E,U,I);return M[1].v=E.read_shift(8,"f"),M}function g(E,U,I){var M=xr(13);return M.write_shift(1,255),M.write_shift(2,U),M.write_shift(2,E),M.write_shift(8,I,"f"),M}function y(E,U,I){var M=E.l+U,te=d(E,U,I);if(te[1].v=E.read_shift(8,"f"),I.qpro)E.l=M;else{var Q=E.read_shift(2);k(E.slice(E.l,E.l+Q),te),E.l+=Q}return te}function m(E,U,I){var M=U&32768;return U&=-32769,U=(M?E:0)+(U>=8192?U-16384:U),(M?"":"$")+(I?Os(U):ua(U))}var w={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},S=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function k(E,U){Ja(E,0);for(var I=[],M=0,te="",Q="",G="",ne="";E.l<E.length;){var z=E[E.l++];switch(z){case 0:I.push(E.read_shift(8,"f"));break;case 1:Q=m(U[0].c,E.read_shift(2),!0),te=m(U[0].r,E.read_shift(2),!1),I.push(Q+te);break;case 2:{var he=m(U[0].c,E.read_shift(2),!0),X=m(U[0].r,E.read_shift(2),!1);Q=m(U[0].c,E.read_shift(2),!0),te=m(U[0].r,E.read_shift(2),!1),I.push(he+X+":"+Q+te)}break;case 3:if(E.l<E.length){console.error("WK1 premature formula end");return}break;case 4:I.push("("+I.pop()+")");break;case 5:I.push(E.read_shift(2));break;case 6:{for(var H="";z=E[E.l++];)H+=String.fromCharCode(z);I.push('"'+H.replace(/"/g,'""')+'"')}break;case 8:I.push("-"+I.pop());break;case 23:I.push("+"+I.pop());break;case 22:I.push("NOT("+I.pop()+")");break;case 20:case 21:ne=I.pop(),G=I.pop(),I.push(["AND","OR"][z-20]+"("+G+","+ne+")");break;default:if(z<32&&S[z])ne=I.pop(),G=I.pop(),I.push(G+S[z]+ne);else if(w[z]){if(M=w[z][1],M==69&&(M=E[E.l++]),M>I.length){console.error("WK1 bad formula parse 0x"+z.toString(16)+":|"+I.join("|")+"|");return}var oe=I.slice(-M);I.length-=M,I.push(w[z][0]+"("+oe.join(",")+")")}else return z<=7?console.error("WK1 invalid opcode "+z.toString(16)):z<=24?console.error("WK1 unsupported op "+z.toString(16)):z<=30?console.error("WK1 invalid opcode "+z.toString(16)):z<=115?console.error("WK1 unsupported function opcode "+z.toString(16)):console.error("WK1 unrecognized opcode "+z.toString(16))}}I.length==1?U[1].f=""+I[0]:console.error("WK1 bad formula parse |"+I.join("|")+"|")}function F(E){var U=[{c:0,r:0},{t:"n",v:0},0];return U[0].r=E.read_shift(2),U[3]=E[E.l++],U[0].c=E[E.l++],U}function L(E,U){var I=F(E);return I[1].t="s",I[1].v=E.read_shift(U-4,"cstr"),I}function C(E,U,I,M){var te=xr(6+M.length);te.write_shift(2,E),te.write_shift(1,I),te.write_shift(1,U),te.write_shift(1,39);for(var Q=0;Q<M.length;++Q){var G=M.charCodeAt(Q);te.write_shift(1,G>=128?95:G)}return te.write_shift(1,0),te}function O(E,U){var I=F(E);I[1].v=E.read_shift(2);var M=I[1].v>>1;if(I[1].v&1)switch(M&7){case 0:M=(M>>3)*5e3;break;case 1:M=(M>>3)*500;break;case 2:M=(M>>3)/20;break;case 3:M=(M>>3)/200;break;case 4:M=(M>>3)/2e3;break;case 5:M=(M>>3)/2e4;break;case 6:M=(M>>3)/16;break;case 7:M=(M>>3)/64;break}return I[1].v=M,I}function T(E,U){var I=F(E),M=E.read_shift(4),te=E.read_shift(4),Q=E.read_shift(2);if(Q==65535)return M===0&&te===3221225472?(I[1].t="e",I[1].v=15):M===0&&te===3489660928?(I[1].t="e",I[1].v=42):I[1].v=0,I;var G=Q&32768;return Q=(Q&32767)-16446,I[1].v=(1-G*2)*(te*Math.pow(2,Q+32)+M*Math.pow(2,Q)),I}function W(E,U,I,M){var te=xr(14);if(te.write_shift(2,E),te.write_shift(1,I),te.write_shift(1,U),M==0)return te.write_shift(4,0),te.write_shift(4,0),te.write_shift(2,65535),te;var Q=0,G=0,ne=0,z=0;return M<0&&(Q=1,M=-M),G=Math.log2(M)|0,M/=Math.pow(2,G-31),z=M>>>0,z&2147483648||(M/=2,++G,z=M>>>0),M-=z,z|=2147483648,z>>>=0,M*=Math.pow(2,32),ne=M>>>0,te.write_shift(4,ne),te.write_shift(4,z),G+=16383+(Q?32768:0),te.write_shift(2,G),te}function A(E,U){var I=T(E);return E.l+=U-14,I}function N(E,U){var I=F(E),M=E.read_shift(4);return I[1].v=M>>6,I}function P(E,U){var I=F(E),M=E.read_shift(8,"f");return I[1].v=M,I}function K(E,U){var I=P(E);return E.l+=U-10,I}function re(E,U){return E[E.l+U-1]==0?E.read_shift(U,"cstr"):""}function ge(E,U){var I=E[E.l++];I>U-1&&(I=U-1);for(var M="";M.length<I;)M+=String.fromCharCode(E[E.l++]);return M}function Fe(E,U,I){if(!(!I.qpro||U<21)){var M=E.read_shift(1);E.l+=17,E.l+=1,E.l+=2;var te=E.read_shift(U-21,"cstr");return[M,te]}}function R(E,U){for(var I={},M=E.l+U;E.l<M;){var te=E.read_shift(2);if(te==14e3){for(I[te]=[0,""],I[te][0]=E.read_shift(2);E[E.l];)I[te][1]+=String.fromCharCode(E[E.l]),E.l++;E.l++}}return I}function q(E,U){var I=xr(5+E.length);I.write_shift(2,14e3),I.write_shift(2,U);for(var M=0;M<E.length;++M){var te=E.charCodeAt(M);I[I.l++]=te>127?95:te}return I[I.l++]=0,I}var me={0:{n:"BOF",f:ya},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:l},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:p},14:{n:"NUMBER",f:x},15:{n:"LABEL",f:u},16:{n:"FORMULA",f:y},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:u},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:re},222:{n:"SHEETNAMELP",f:ge},65535:{n:""}},fe={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:L},23:{n:"NUMBER17",f:T},24:{n:"NUMBER18",f:O},25:{n:"FORMULA19",f:A},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:R},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:N},38:{n:"??"},39:{n:"NUMBER27",f:P},40:{n:"FORMULA28",f:K},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:re},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Fe},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:s,book_to_wk3:a,to_workbook:t}}();function CD(e){var t={},r=e.match(wi),s=0,a=!1;if(r)for(;s!=r.length;++s){var i=kn(r[s]);switch(i[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!i.val)break;case"<shadow>":case"<shadow/>":t.shadow=1;break;case"</shadow>":break;case"<charset":if(i.val=="1")break;t.cp=sw[parseInt(i.val,10)];break;case"<outline":if(!i.val)break;case"<outline>":case"<outline/>":t.outline=1;break;case"</outline>":break;case"<rFont":t.name=i.val;break;case"<sz":t.sz=i.val;break;case"<strike":if(!i.val)break;case"<strike>":case"<strike/>":t.strike=1;break;case"</strike>":break;case"<u":if(!i.val)break;switch(i.val){case"double":t.uval="double";break;case"singleAccounting":t.uval="single-accounting";break;case"doubleAccounting":t.uval="double-accounting";break}case"<u>":case"<u/>":t.u=1;break;case"</u>":break;case"<b":if(i.val=="0")break;case"<b>":case"<b/>":t.b=1;break;case"</b>":break;case"<i":if(i.val=="0")break;case"<i>":case"<i/>":t.i=1;break;case"</i>":break;case"<color":i.rgb&&(t.color=i.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":t.family=i.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":t.valign=i.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(i[0].charCodeAt(1)!==47&&!a)throw new Error("Unrecognized rich format "+i[0])}}return t}var ED=function(){var e=fp("t"),t=fp("rPr");function r(i){var o=i.match(e);if(!o)return{t:"s",v:""};var l={t:"s",v:Kn(o[1])},c=i.match(t);return c&&(l.s=CD(c[1])),l}var s=/<(?:\w+:)?r>/g,a=/<\/(?:\w+:)?r>/;return function(o){return o.replace(s,"").split(a).map(r).filter(function(l){return l.v})}}(),TD=function(){var t=/(\r\n|\n)/g;function r(a,i,o){var l=[];a.u&&l.push("text-decoration: underline;"),a.uval&&l.push("text-underline-style:"+a.uval+";"),a.sz&&l.push("font-size:"+a.sz+"pt;"),a.outline&&l.push("text-effect: outline;"),a.shadow&&l.push("text-shadow: auto;"),i.push('<span style="'+l.join("")+'">'),a.b&&(i.push("<b>"),o.push("</b>")),a.i&&(i.push("<i>"),o.push("</i>")),a.strike&&(i.push("<s>"),o.push("</s>"));var c=a.valign||"";return c=="superscript"||c=="super"?c="sup":c=="subscript"&&(c="sub"),c!=""&&(i.push("<"+c+">"),o.push("</"+c+">")),o.push("</span>"),a}function s(a){var i=[[],a.v,[]];return a.v?(a.s&&r(a.s,i[0],i[2]),i[0].join("")+i[1].replace(t,"<br/>")+i[2].join("")):""}return function(i){return i.map(s).join("")}}(),LD=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,FD=/<(?:\w+:)?r>/,MD=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function Cw(e,t){var r=t?t.cellHTML:!0,s={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(s.t=Kn(hs(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),s.r=hs(e),r&&(s.h=pw(s.t))):e.match(FD)&&(s.r=hs(e),s.t=Kn(hs((e.replace(MD,"").match(LD)||[]).join("").replace(wi,""))),r&&(s.h=TD(ED(s.r)))),s):{t:""}}var RD=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,BD=/<(?:\w+:)?(?:si|sstItem)>/g,PD=/<\/(?:\w+:)?(?:si|sstItem)>/;function OD(e,t){var r=[],s="";if(!e)return r;var a=e.match(RD);if(a){s=a[2].replace(BD,"").split(PD);for(var i=0;i!=s.length;++i){var o=Cw(s[i].trim(),t);o!=null&&(r[r.length]=o)}a=kn(a[1]),r.Count=a.count,r.Unique=a.uniqueCount}return r}var ID=/^\s|\s$|[\t\n\r]/;function jC(e,t){if(!t.bookSST)return"";var r=[fa];r[r.length]=qr("sst",null,{xmlns:Pu[0],count:e.Count,uniqueCount:e.Unique});for(var s=0;s!=e.length;++s)if(e[s]!=null){var a=e[s],i="<si>";a.r?i+=a.r:(i+="<t",a.t||(a.t=""),a.t.match(ID)&&(i+=' xml:space="preserve"'),i+=">"+us(a.t)+"</t>"),i+="</si>",r[r.length]=i}return r.length>2&&(r[r.length]="</sst>",r[1]=r[1].replace("/>",">")),r.join("")}function DD(e){return[e.read_shift(4),e.read_shift(4)]}function UD(e,t){var r=[],s=!1;return Lc(e,function(i,o,l){switch(l){case 159:r.Count=i[0],r.Unique=i[1];break;case 19:r.push(i);break;case 160:return!0;case 35:s=!0;break;case 36:s=!1;break;default:if(o.T,!s||t.WTF)throw new Error("Unexpected record 0x"+l.toString(16))}}),r}function $D(e,t){return t||(t=xr(8)),t.write_shift(4,e.Count),t.write_shift(4,e.Unique),t}var WD=JO;function zD(e){var t=Xi();Ar(t,159,$D(e));for(var r=0;r<e.length;++r)Ar(t,19,WD(e[r]));return Ar(t,160),t.end()}function NC(e){for(var t=[],r=e.split(""),s=0;s<r.length;++s)t[s]=r[s].charCodeAt(0);return t}function bc(e,t){var r={};return r.Major=e.read_shift(2),r.Minor=e.read_shift(2),t>=4&&(e.l+=t-4),r}function qD(e){var t={};return t.id=e.read_shift(0,"lpp4"),t.R=bc(e,4),t.U=bc(e,4),t.W=bc(e,4),t}function HD(e){for(var t=e.read_shift(4),r=e.l+t-4,s={},a=e.read_shift(4),i=[];a-- >0;)i.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(s.name=e.read_shift(0,"lpp4"),s.comps=i,e.l!=r)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+r);return s}function VD(e){var t=[];e.l+=4;for(var r=e.read_shift(4);r-- >0;)t.push(HD(e));return t}function GD(e){var t=[];e.l+=4;for(var r=e.read_shift(4);r-- >0;)t.push(e.read_shift(0,"lpp4"));return t}function QD(e){var t={};return e.read_shift(4),e.l+=4,t.id=e.read_shift(0,"lpp4"),t.name=e.read_shift(0,"lpp4"),t.R=bc(e,4),t.U=bc(e,4),t.W=bc(e,4),t}function XD(e){var t=QD(e);if(t.ename=e.read_shift(0,"8lpp4"),t.blksz=e.read_shift(4),t.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return t}function AC(e,t){var r=e.l+t,s={};s.Flags=e.read_shift(4)&63,e.l+=4,s.AlgID=e.read_shift(4);var a=!1;switch(s.AlgID){case 26126:case 26127:case 26128:a=s.Flags==36;break;case 26625:a=s.Flags==4;break;case 0:a=s.Flags==16||s.Flags==4||s.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+s.AlgID}if(!a)throw new Error("Encryption Flags/AlgID mismatch");return s.AlgIDHash=e.read_shift(4),s.KeySize=e.read_shift(4),s.ProviderType=e.read_shift(4),e.l+=8,s.CSPName=e.read_shift(r-e.l>>1,"utf16le"),e.l=r,s}function CC(e,t){var r={},s=e.l+t;return e.l+=4,r.Salt=e.slice(e.l,e.l+16),e.l+=16,r.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),r.VerifierHash=e.slice(e.l,s),e.l=s,r}function YD(e){var t=bc(e);switch(t.Minor){case 2:return[t.Minor,KD(e)];case 3:return[t.Minor,JD()];case 4:return[t.Minor,ZD(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+t.Minor)}function KD(e){var t=e.read_shift(4);if((t&63)!=36)throw new Error("EncryptionInfo mismatch");var r=e.read_shift(4),s=AC(e,r),a=CC(e,e.length-e.l);return{t:"Std",h:s,v:a}}function JD(){throw new Error("File is password-protected: ECMA-376 Extensible")}function ZD(e){var t=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var r=e.read_shift(e.length-e.l,"utf8"),s={};return r.replace(wi,function(i){var o=kn(i);switch(Gl(o[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":t.forEach(function(l){s[l]=o[l]});break;case"<dataIntegrity":s.encryptedHmacKey=o.encryptedHmacKey,s.encryptedHmacValue=o.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":s.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":s.uri=o.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":s.encs.push(o);break;default:throw o[0]}}),s}function eU(e,t){var r={},s=r.EncryptionVersionInfo=bc(e,4);if(t-=4,s.Minor!=2)throw new Error("unrecognized minor version code: "+s.Minor);if(s.Major>4||s.Major<2)throw new Error("unrecognized major version code: "+s.Major);r.Flags=e.read_shift(4),t-=4;var a=e.read_shift(4);return t-=4,r.EncryptionHeader=AC(e,a),t-=a,r.EncryptionVerifier=CC(e,t),r}function tU(e){var t={},r=t.EncryptionVersionInfo=bc(e,4);if(r.Major!=1||r.Minor!=1)throw"unrecognized version code "+r.Major+" : "+r.Minor;return t.Salt=e.read_shift(16),t.EncryptedVerifier=e.read_shift(16),t.EncryptedVerifierHash=e.read_shift(16),t}function Ew(e){var t=0,r,s=NC(e),a=s.length+1,i,o,l,c,d;for(r=jd(a),r[0]=s.length,i=1;i!=a;++i)r[i]=s[i-1];for(i=a-1;i>=0;--i)o=r[i],l=t&16384?1:0,c=t<<1&32767,d=l|c,t=d^o;return t^52811}var EC=function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],t=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],r=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],s=function(o){return(o/2|o*128)&255},a=function(o,l){return s(o^l)},i=function(o){for(var l=t[o.length-1],c=104,d=o.length-1;d>=0;--d)for(var u=o[d],h=0;h!=7;++h)u&64&&(l^=r[c]),u*=2,--c;return l};return function(o){for(var l=NC(o),c=i(l),d=l.length,u=jd(16),h=0;h!=16;++h)u[h]=0;var p,f,x;for((d&1)===1&&(p=c>>8,u[d]=a(e[0],p),--d,p=c&255,f=l[l.length-1],u[d]=a(f,p));d>0;)--d,p=c>>8,u[d]=a(l[d],p),--d,p=c&255,u[d]=a(l[d],p);for(d=15,x=15-l.length;x>0;)p=c>>8,u[d]=a(e[x],p),--d,--x,p=c&255,u[d]=a(l[d],p),--d,--x;return u}}(),rU=function(e,t,r,s,a){a||(a=t),s||(s=EC(e));var i,o;for(i=0;i!=t.length;++i)o=t[i],o^=s[r],o=(o>>5|o<<3)&255,a[i]=o,++r;return[a,r,s]},nU=function(e){var t=0,r=EC(e);return function(s){var a=rU("",s,t,r);return t=a[1],a[0]}};function sU(e,t,r,s){var a={key:ya(e),verificationBytes:ya(e)};return r.password&&(a.verifier=Ew(r.password)),s.valid=a.verificationBytes===a.verifier,s.valid&&(s.insitu=nU(r.password)),a}function aU(e,t,r){var s=r||{};return s.Info=e.read_shift(2),e.l-=2,s.Info===1?s.Data=tU(e):s.Data=eU(e,t),s}function iU(e,t,r){var s={Type:r.biff>=8?e.read_shift(2):0};return s.Type?aU(e,t-2,s):sU(e,r.biff>=8?t:t-2,r,s),s}var TC=function(){function e(a,i){switch(i.type){case"base64":return t(ko(a),i);case"binary":return t(a,i);case"buffer":return t(Un&&Buffer.isBuffer(a)?a.toString("binary"):Rd(a),i);case"array":return t(Su(a),i)}throw new Error("Unrecognized type "+i.type)}function t(a,i){var o=i||{},l=o.dense?[]:{},c=a.match(/\\trowd.*?\\row\b/g);if(!c.length)throw new Error("RTF missing table");var d={s:{c:0,r:0},e:{c:0,r:c.length-1}};return c.forEach(function(u,h){Array.isArray(l)&&(l[h]=[]);for(var p=/\\\w+\b/g,f=0,x,g=-1;x=p.exec(u);){switch(x[0]){case"\\cell":var y=u.slice(f,p.lastIndex-x[0].length);if(y[0]==" "&&(y=y.slice(1)),++g,y.length){var m={v:y,t:"s"};Array.isArray(l)?l[h][g]=m:l[Sn({r:h,c:g})]=m}break}f=p.lastIndex}g>d.e.c&&(d.e.c=g)}),l["!ref"]=Ln(d),l}function r(a,i){return Bd(e(a,i),i)}function s(a){for(var i=["{\\rtf1\\ansi"],o=Jn(a["!ref"]),l,c=Array.isArray(a),d=o.s.r;d<=o.e.r;++d){i.push("\\trowd\\trautofit1");for(var u=o.s.c;u<=o.e.c;++u)i.push("\\cellx"+(u+1));for(i.push("\\pard\\intbl"),u=o.s.c;u<=o.e.c;++u){var h=Sn({r:d,c:u});l=c?(a[d]||[])[u]:a[h],!(!l||l.v==null&&(!l.f||l.F))&&(i.push(" "+(l.w||(Nc(l),l.w))),i.push("\\cell"))}i.push("\\pard\\intbl\\row")}return i.join("")+"}"}return{to_workbook:r,to_sheet:e,from_sheet:s}}();function oU(e){var t=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function xp(e){for(var t=0,r=1;t!=3;++t)r=r*256+(e[t]>255?255:e[t]<0?0:e[t]);return r.toString(16).toUpperCase().slice(1)}function lU(e){var t=e[0]/255,r=e[1]/255,s=e[2]/255,a=Math.max(t,r,s),i=Math.min(t,r,s),o=a-i;if(o===0)return[0,0,t];var l=0,c=0,d=a+i;switch(c=o/(d>1?2-d:d),a){case t:l=((r-s)/o+6)%6;break;case r:l=(s-t)/o+2;break;case s:l=(t-r)/o+4;break}return[l/6,c,d/2]}function cU(e){var t=e[0],r=e[1],s=e[2],a=r*2*(s<.5?s:1-s),i=s-a/2,o=[i,i,i],l=6*t,c;if(r!==0)switch(l|0){case 0:case 6:c=a*l,o[0]+=a,o[1]+=c;break;case 1:c=a*(2-l),o[0]+=c,o[1]+=a;break;case 2:c=a*(l-2),o[1]+=a,o[2]+=c;break;case 3:c=a*(4-l),o[1]+=c,o[2]+=a;break;case 4:c=a*(l-4),o[2]+=a,o[0]+=c;break;case 5:c=a*(6-l),o[2]+=c,o[0]+=a;break}for(var d=0;d!=3;++d)o[d]=Math.round(o[d]*255);return o}function C1(e,t){if(t===0)return e;var r=lU(oU(e));return t<0?r[2]=r[2]*(1+t):r[2]=1-(1-r[2])*(1-t),xp(cU(r))}var LC=6,dU=15,uU=1,hi=LC;function gp(e){return Math.floor((e+Math.round(128/hi)/256)*hi)}function yp(e){return Math.floor((e-5)/hi*100+.5)/100}function E1(e){return Math.round((e*hi+5)/hi*256)/256}function jy(e){return E1(yp(gp(e)))}function Tw(e){var t=Math.abs(e-jy(e)),r=hi;if(t>.005)for(hi=uU;hi<dU;++hi)Math.abs(e-jy(e))<=t&&(t=Math.abs(e-jy(e)),r=hi);hi=r}function Nd(e){e.width?(e.wpx=gp(e.width),e.wch=yp(e.wpx),e.MDW=hi):e.wpx?(e.wch=yp(e.wpx),e.width=E1(e.wch),e.MDW=hi):typeof e.wch=="number"&&(e.width=E1(e.wch),e.wpx=gp(e.width),e.MDW=hi),e.customWidth&&delete e.customWidth}var fU=96,FC=fU;function bp(e){return e*96/FC}function d0(e){return e*FC/96}var hU={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function pU(e,t,r,s){t.Borders=[];var a={},i=!1;(e[0].match(wi)||[]).forEach(function(o){var l=kn(o);switch(Gl(l[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":a={},l.diagonalUp&&(a.diagonalUp=ks(l.diagonalUp)),l.diagonalDown&&(a.diagonalDown=ks(l.diagonalDown)),t.Borders.push(a);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(s&&s.WTF&&!i)throw new Error("unrecognized "+l[0]+" in borders")}})}function mU(e,t,r,s){t.Fills=[];var a={},i=!1;(e[0].match(wi)||[]).forEach(function(o){var l=kn(o);switch(Gl(l[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":a={},t.Fills.push(a);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":t.Fills.push(a),a={};break;case"<patternFill":case"<patternFill>":l.patternType&&(a.patternType=l.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":a.bgColor||(a.bgColor={}),l.indexed&&(a.bgColor.indexed=parseInt(l.indexed,10)),l.theme&&(a.bgColor.theme=parseInt(l.theme,10)),l.tint&&(a.bgColor.tint=parseFloat(l.tint)),l.rgb&&(a.bgColor.rgb=l.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":a.fgColor||(a.fgColor={}),l.theme&&(a.fgColor.theme=parseInt(l.theme,10)),l.tint&&(a.fgColor.tint=parseFloat(l.tint)),l.rgb!=null&&(a.fgColor.rgb=l.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(s&&s.WTF&&!i)throw new Error("unrecognized "+l[0]+" in fills")}})}function xU(e,t,r,s){t.Fonts=[];var a={},i=!1;(e[0].match(wi)||[]).forEach(function(o){var l=kn(o);switch(Gl(l[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":t.Fonts.push(a),a={};break;case"<name":l.val&&(a.name=hs(l.val));break;case"<name/>":case"</name>":break;case"<b":a.bold=l.val?ks(l.val):1;break;case"<b/>":a.bold=1;break;case"<i":a.italic=l.val?ks(l.val):1;break;case"<i/>":a.italic=1;break;case"<u":switch(l.val){case"none":a.underline=0;break;case"single":a.underline=1;break;case"double":a.underline=2;break;case"singleAccounting":a.underline=33;break;case"doubleAccounting":a.underline=34;break}break;case"<u/>":a.underline=1;break;case"<strike":a.strike=l.val?ks(l.val):1;break;case"<strike/>":a.strike=1;break;case"<outline":a.outline=l.val?ks(l.val):1;break;case"<outline/>":a.outline=1;break;case"<shadow":a.shadow=l.val?ks(l.val):1;break;case"<shadow/>":a.shadow=1;break;case"<condense":a.condense=l.val?ks(l.val):1;break;case"<condense/>":a.condense=1;break;case"<extend":a.extend=l.val?ks(l.val):1;break;case"<extend/>":a.extend=1;break;case"<sz":l.val&&(a.sz=+l.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":l.val&&(a.vertAlign=l.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":l.val&&(a.family=parseInt(l.val,10));break;case"<family/>":case"</family>":break;case"<scheme":l.val&&(a.scheme=l.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(l.val=="1")break;l.codepage=sw[parseInt(l.val,10)];break;case"<color":if(a.color||(a.color={}),l.auto&&(a.color.auto=ks(l.auto)),l.rgb)a.color.rgb=l.rgb.slice(-6);else if(l.indexed){a.color.index=parseInt(l.indexed,10);var c=lu[a.color.index];a.color.index==81&&(c=lu[1]),c||(c=lu[1]),a.color.rgb=c[0].toString(16)+c[1].toString(16)+c[2].toString(16)}else l.theme&&(a.color.theme=parseInt(l.theme,10),l.tint&&(a.color.tint=parseFloat(l.tint)),l.theme&&r.themeElements&&r.themeElements.clrScheme&&(a.color.rgb=C1(r.themeElements.clrScheme[a.color.theme].rgb,a.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":i=!0;break;case"</AlternateContent>":i=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(s&&s.WTF&&!i)throw new Error("unrecognized "+l[0]+" in fonts")}})}function gU(e,t,r){t.NumberFmt=[];for(var s=Ys(vn),a=0;a<s.length;++a)t.NumberFmt[s[a]]=vn[s[a]];var i=e[0].match(wi);if(i)for(a=0;a<i.length;++a){var o=kn(i[a]);switch(Gl(o[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var l=Kn(hs(o.formatCode)),c=parseInt(o.numFmtId,10);if(t.NumberFmt[c]=l,c>0){if(c>392){for(c=392;c>60&&t.NumberFmt[c]!=null;--c);t.NumberFmt[c]=l}yc(l,c)}}break;case"</numFmt>":break;default:if(r.WTF)throw new Error("unrecognized "+o[0]+" in numFmts")}}}function yU(e){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var s=r[0];s<=r[1];++s)e[s]!=null&&(t[t.length]=qr("numFmt",null,{numFmtId:s,formatCode:us(e[s])}))}),t.length===1?"":(t[t.length]="</numFmts>",t[0]=qr("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}var Dm=["numFmtId","fillId","fontId","borderId","xfId"],Um=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function bU(e,t,r){t.CellXf=[];var s,a=!1;(e[0].match(wi)||[]).forEach(function(i){var o=kn(i),l=0;switch(Gl(o[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(s=o,delete s[0],l=0;l<Dm.length;++l)s[Dm[l]]&&(s[Dm[l]]=parseInt(s[Dm[l]],10));for(l=0;l<Um.length;++l)s[Um[l]]&&(s[Um[l]]=ks(s[Um[l]]));if(t.NumberFmt&&s.numFmtId>392){for(l=392;l>60;--l)if(t.NumberFmt[s.numFmtId]==t.NumberFmt[l]){s.numFmtId=l;break}}t.CellXf.push(s);break;case"</xf>":break;case"<alignment":case"<alignment/>":var c={};o.vertical&&(c.vertical=o.vertical),o.horizontal&&(c.horizontal=o.horizontal),o.textRotation!=null&&(c.textRotation=o.textRotation),o.indent&&(c.indent=o.indent),o.wrapText&&(c.wrapText=ks(o.wrapText)),s.alignment=c;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":a=!0;break;case"</AlternateContent>":a=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(r&&r.WTF&&!a)throw new Error("unrecognized "+o[0]+" in cellXfs")}})}function vU(e){var t=[];return t[t.length]=qr("cellXfs",null),e.forEach(function(r){t[t.length]=qr("xf",null,r)}),t[t.length]="</cellXfs>",t.length===2?"":(t[0]=qr("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}var wU=function(){var t=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,r=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,s=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,a=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,i=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(l,c,d){var u={};if(!l)return u;l=l.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var h;return(h=l.match(t))&&gU(h,u,d),(h=l.match(a))&&xU(h,u,c,d),(h=l.match(s))&&mU(h,u,c,d),(h=l.match(i))&&pU(h,u,c,d),(h=l.match(r))&&bU(h,u,d),u}}();function MC(e,t){var r=[fa,qr("styleSheet",null,{xmlns:Pu[0],"xmlns:vt":Ea.vt})],s;return e.SSF&&(s=yU(e.SSF))!=null&&(r[r.length]=s),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(s=vU(t.cellXfs))&&(r[r.length]=s),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function SU(e,t){var r=e.read_shift(2),s=yi(e);return[r,s]}function _U(e,t,r){r||(r=xr(6+4*t.length)),r.write_shift(2,e),Da(t,r);var s=r.length>r.l?r.slice(0,r.l):r;return r.l==null&&(r.l=r.length),s}function kU(e,t,r){var s={};s.sz=e.read_shift(2)/20;var a=a9(e);a.fItalic&&(s.italic=1),a.fCondense&&(s.condense=1),a.fExtend&&(s.extend=1),a.fShadow&&(s.shadow=1),a.fOutline&&(s.outline=1),a.fStrikeout&&(s.strike=1);var i=e.read_shift(2);switch(i===700&&(s.bold=1),e.read_shift(2)){case 1:s.vertAlign="superscript";break;case 2:s.vertAlign="subscript";break}var o=e.read_shift(1);o!=0&&(s.underline=o);var l=e.read_shift(1);l>0&&(s.family=l);var c=e.read_shift(1);switch(c>0&&(s.charset=c),e.l++,s.color=s9(e),e.read_shift(1)){case 1:s.scheme="major";break;case 2:s.scheme="minor";break}return s.name=yi(e),s}function jU(e,t){t||(t=xr(25+4*32)),t.write_shift(2,e.sz*20),i9(e,t),t.write_shift(2,e.bold?700:400);var r=0;e.vertAlign=="superscript"?r=1:e.vertAlign=="subscript"&&(r=2),t.write_shift(2,r),t.write_shift(1,e.underline||0),t.write_shift(1,e.family||0),t.write_shift(1,e.charset||0),t.write_shift(1,0),j1(e.color,t);var s=0;return s=2,t.write_shift(1,s),Da(e.name,t),t.length>t.l?t.slice(0,t.l):t}var NU=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],Ny,AU=vi;function mk(e,t){t||(t=xr(4*3+8*7+16*1)),Ny||(Ny=hg(NU));var r=Ny[e.patternType];r==null&&(r=40),t.write_shift(4,r);var s=0;if(r!=40)for(j1({auto:1},t),j1({auto:1},t);s<12;++s)t.write_shift(4,0);else{for(;s<4;++s)t.write_shift(4,0);for(;s<12;++s)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function CU(e,t){var r=e.l+t,s=e.read_shift(2),a=e.read_shift(2);return e.l=r,{ixfe:s,numFmtId:a}}function RC(e,t,r){r||(r=xr(16)),r.write_shift(2,t||0),r.write_shift(2,e.numFmtId||0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);var s=0;return r.write_shift(1,s),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r}function ah(e,t){return t||(t=xr(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var EU=vi;function TU(e,t){return t||(t=xr(51)),t.write_shift(1,0),ah(null,t),ah(null,t),ah(null,t),ah(null,t),ah(null,t),t.length>t.l?t.slice(0,t.l):t}function LU(e,t){return t||(t=xr(12+4*10)),t.write_shift(4,e.xfId),t.write_shift(2,1),t.write_shift(1,0),t.write_shift(1,0),k1(e.name||"",t),t.length>t.l?t.slice(0,t.l):t}function FU(e,t,r){var s=xr(2052);return s.write_shift(4,e),k1(t,s),k1(r,s),s.length>s.l?s.slice(0,s.l):s}function MU(e,t,r){var s={};s.NumberFmt=[];for(var a in vn)s.NumberFmt[a]=vn[a];s.CellXf=[],s.Fonts=[];var i=[],o=!1;return Lc(e,function(c,d,u){switch(u){case 44:s.NumberFmt[c[0]]=c[1],yc(c[1],c[0]);break;case 43:s.Fonts.push(c),c.color.theme!=null&&t&&t.themeElements&&t.themeElements.clrScheme&&(c.color.rgb=C1(t.themeElements.clrScheme[c.color.theme].rgb,c.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:i[i.length-1]==617&&s.CellXf.push(c);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:o=!0;break;case 36:o=!1;break;case 37:i.push(u),o=!0;break;case 38:i.pop(),o=!1;break;default:if(d.T>0)i.push(u);else if(d.T<0)i.pop();else if(!o||r.WTF&&i[i.length-1]!=37)throw new Error("Unexpected record 0x"+u.toString(16))}}),s}function RU(e,t){if(t){var r=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)t[a]!=null&&++r}),r!=0&&(Ar(e,615,gl(r)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)t[a]!=null&&Ar(e,44,_U(a,t[a]))}),Ar(e,616))}}function BU(e){var t=1;Ar(e,611,gl(t)),Ar(e,43,jU({sz:12,color:{theme:1},name:"Calibri",family:2})),Ar(e,612)}function PU(e){var t=2;Ar(e,603,gl(t)),Ar(e,45,mk({patternType:"none"})),Ar(e,45,mk({patternType:"gray125"})),Ar(e,604)}function OU(e){var t=1;Ar(e,613,gl(t)),Ar(e,46,TU()),Ar(e,614)}function IU(e){var t=1;Ar(e,626,gl(t)),Ar(e,47,RC({numFmtId:0},65535)),Ar(e,627)}function DU(e,t){Ar(e,617,gl(t.length)),t.forEach(function(r){Ar(e,47,RC(r,0))}),Ar(e,618)}function UU(e){var t=1;Ar(e,619,gl(t)),Ar(e,48,LU({xfId:0,name:"Normal"})),Ar(e,620)}function $U(e){var t=0;Ar(e,505,gl(t)),Ar(e,506)}function WU(e){var t=0;Ar(e,508,FU(t,"TableStyleMedium9","PivotStyleMedium4")),Ar(e,509)}function zU(e,t){var r=Xi();return Ar(r,278),RU(r,e.SSF),BU(r),PU(r),OU(r),IU(r),DU(r,t.cellXfs),UU(r),$U(r),WU(r),Ar(r,279),r.end()}var qU=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function HU(e,t,r){t.themeElements.clrScheme=[];var s={};(e[0].match(wi)||[]).forEach(function(a){var i=kn(a);switch(i[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":s.rgb=i.val;break;case"<a:sysClr":s.rgb=i.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":i[0].charAt(1)==="/"?(t.themeElements.clrScheme[qU.indexOf(i[0])]=s,s={}):s.name=i[0].slice(3,i[0].length-1);break;default:if(r&&r.WTF)throw new Error("Unrecognized "+i[0]+" in clrScheme")}})}function VU(){}function GU(){}var QU=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,XU=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,YU=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function KU(e,t,r){t.themeElements={};var s;[["clrScheme",QU,HU],["fontScheme",XU,VU],["fmtScheme",YU,GU]].forEach(function(a){if(!(s=e.match(a[1])))throw new Error(a[0]+" not found in themeElements");a[2](s,t,r)})}var JU=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function BC(e,t){(!e||e.length===0)&&(e=Lw());var r,s={};if(!(r=e.match(JU)))throw new Error("themeElements not found in theme");return KU(r[0],s,t),s.raw=e,s}function Lw(e,t){if(t&&t.themeXLSX)return t.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var r=[fa];return r[r.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',r[r.length]="<a:themeElements>",r[r.length]='<a:clrScheme name="Office">',r[r.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',r[r.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',r[r.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',r[r.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',r[r.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',r[r.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',r[r.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',r[r.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',r[r.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',r[r.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',r[r.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',r[r.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',r[r.length]="</a:clrScheme>",r[r.length]='<a:fontScheme name="Office">',r[r.length]="<a:majorFont>",r[r.length]='<a:latin typeface="Cambria"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Times New Roman"/>',r[r.length]='<a:font script="Hebr" typeface="Times New Roman"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="MoolBoran"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Times New Roman"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:majorFont>",r[r.length]="<a:minorFont>",r[r.length]='<a:latin typeface="Calibri"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Arial"/>',r[r.length]='<a:font script="Hebr" typeface="Arial"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="DaunPenh"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Arial"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:minorFont>",r[r.length]="</a:fontScheme>",r[r.length]='<a:fmtScheme name="Office">',r[r.length]="<a:fillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="1"/>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="0"/>',r[r.length]="</a:gradFill>",r[r.length]="</a:fillStyleLst>",r[r.length]="<a:lnStyleLst>",r[r.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]="</a:lnStyleLst>",r[r.length]="<a:effectStyleLst>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',r[r.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',r[r.length]="</a:effectStyle>",r[r.length]="</a:effectStyleLst>",r[r.length]="<a:bgFillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]="</a:bgFillStyleLst>",r[r.length]="</a:fmtScheme>",r[r.length]="</a:themeElements>",r[r.length]="<a:objectDefaults>",r[r.length]="<a:spDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',r[r.length]="</a:spDef>",r[r.length]="<a:lnDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',r[r.length]="</a:lnDef>",r[r.length]="</a:objectDefaults>",r[r.length]="<a:extraClrSchemeLst/>",r[r.length]="</a:theme>",r.join("")}function ZU(e,t,r){var s=e.l+t,a=e.read_shift(4);if(a!==124226){if(!r.cellStyles){e.l=s;return}var i=e.slice(e.l);e.l=s;var o;try{o=AA(i,{type:"array"})}catch{return}var l=yo(o,"theme/theme/theme1.xml",!0);if(l)return BC(l,r)}}function e$(e){return e.read_shift(4)}function t$(e){var t={};switch(t.xclrType=e.read_shift(2),t.nTintShade=e.read_shift(2),t.xclrType){case 0:e.l+=4;break;case 1:t.xclrValue=r$(e,4);break;case 2:t.xclrValue=pC(e);break;case 3:t.xclrValue=e$(e);break;case 4:e.l+=4;break}return e.l+=8,t}function r$(e,t){return vi(e,t)}function n$(e,t){return vi(e,t)}function s$(e){var t=e.read_shift(2),r=e.read_shift(2)-4,s=[t];switch(t){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:s[1]=t$(e);break;case 6:s[1]=n$(e,r);break;case 14:case 15:s[1]=e.read_shift(r===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+t+" "+r)}return s}function a$(e,t){var r=e.l+t;e.l+=2;var s=e.read_shift(2);e.l+=2;for(var a=e.read_shift(2),i=[];a-- >0;)i.push(s$(e,r-e.l));return{ixfe:s,ext:i}}function i$(e,t){t.forEach(function(r){switch(r[0]){}})}function o$(e,t){return{flags:e.read_shift(4),version:e.read_shift(4),name:yi(e)}}function l$(e){var t=xr(12+2*e.name.length);return t.write_shift(4,e.flags),t.write_shift(4,e.version),Da(e.name,t),t.slice(0,t.l)}function c$(e){for(var t=[],r=e.read_shift(4);r-- >0;)t.push([e.read_shift(4),e.read_shift(4)]);return t}function d$(e){var t=xr(4+8*e.length);t.write_shift(4,e.length);for(var r=0;r<e.length;++r)t.write_shift(4,e[r][0]),t.write_shift(4,e[r][1]);return t}function u$(e,t){var r=xr(8+2*t.length);return r.write_shift(4,e),Da(t,r),r.slice(0,r.l)}function f$(e){return e.l+=4,e.read_shift(4)!=0}function h$(e,t){var r=xr(8);return r.write_shift(4,e),r.write_shift(4,1),r}function p$(e,t,r){var s={Types:[],Cell:[],Value:[]},a=r||{},i=[],o=!1,l=2;return Lc(e,function(c,d,u){switch(u){case 335:s.Types.push({name:c.name});break;case 51:c.forEach(function(h){l==1?s.Cell.push({type:s.Types[h[0]-1].name,index:h[1]}):l==0&&s.Value.push({type:s.Types[h[0]-1].name,index:h[1]})});break;case 337:l=c?1:0;break;case 338:l=2;break;case 35:i.push(u),o=!0;break;case 36:i.pop(),o=!1;break;default:if(!d.T){if(!o||a.WTF&&i[i.length-1]!=35)throw new Error("Unexpected record 0x"+u.toString(16))}}}),s}function m$(){var e=Xi();return Ar(e,332),Ar(e,334,gl(1)),Ar(e,335,l$({name:"XLDAPR",version:12e4,flags:3496657072})),Ar(e,336),Ar(e,339,u$(1,"XLDAPR")),Ar(e,52),Ar(e,35,gl(514)),Ar(e,4096,gl(0)),Ar(e,4097,Uo(1)),Ar(e,36),Ar(e,53),Ar(e,340),Ar(e,337,h$(1)),Ar(e,51,d$([[1,0]])),Ar(e,338),Ar(e,333),e.end()}function x$(e,t,r){var s={Types:[],Cell:[],Value:[]};if(!e)return s;var a=!1,i=2,o;return e.replace(wi,function(l){var c=kn(l);switch(Gl(c[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":s.Types.push({name:c.name});break;case"</metadataType>":break;case"<futureMetadata":for(var d=0;d<s.Types.length;++d)s.Types[d].name==c.name&&(o=s.Types[d]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":i==1?s.Cell.push({type:s.Types[c.t-1].name,index:+c.v}):i==0&&s.Value.push({type:s.Types[c.t-1].name,index:+c.v});break;case"</rc>":break;case"<cellMetadata":i=1;break;case"</cellMetadata>":i=2;break;case"<valueMetadata":i=0;break;case"</valueMetadata>":i=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;case"<rvb":if(!o)break;o.offsets||(o.offsets=[]),o.offsets.push(+c.i);break;default:if(!a&&r.WTF)throw new Error("unrecognized "+c[0]+" in metadata")}return l}),s}function PC(){var e=[fa];return e.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),e.join("")}function g$(e){var t=[];if(!e)return t;var r=1;return(e.match(wi)||[]).forEach(function(s){var a=kn(s);switch(a[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete a[0],a.i?r=a.i:a.i=r,t.push(a);break}}),t}function y$(e){var t={};t.i=e.read_shift(4);var r={};r.r=e.read_shift(4),r.c=e.read_shift(4),t.r=Sn(r);var s=e.read_shift(1);return s&2&&(t.l="1"),s&8&&(t.a="1"),t}function b$(e,t,r){var s=[];return Lc(e,function(i,o,l){switch(l){case 63:s.push(i);break;default:if(!o.T)throw new Error("Unexpected record 0x"+l.toString(16))}}),s}function v$(e,t,r,s){if(!e)return e;var a=s||{},i=!1;Lc(e,function(l,c,d){switch(d){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:i=!0;break;case 36:i=!1;break;default:if(!c.T){if(!i||a.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}},a)}function w$(e,t){if(!e)return"??";var r=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return t["!id"][r].Target}var Ff=1024;function OC(e,t){for(var r=[21600,21600],s=["m0,0l0",r[1],r[0],r[1],r[0],"0xe"].join(","),a=[qr("xml",null,{"xmlns:v":mo.v,"xmlns:o":mo.o,"xmlns:x":mo.x,"xmlns:mv":mo.mv}).replace(/\/>/,">"),qr("o:shapelayout",qr("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),qr("v:shapetype",[qr("v:stroke",null,{joinstyle:"miter"}),qr("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:r.join(","),path:s})];Ff<e*1e3;)Ff+=1e3;return t.forEach(function(i){var o=Is(i[0]),l={color2:"#BEFF82",type:"gradient"};l.type=="gradient"&&(l.angle="-180");var c=l.type=="gradient"?qr("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,d=qr("v:fill",c,l),u={on:"t",obscured:"t"};++Ff,a=a.concat(["<v:shape"+hp({id:"_x0000_s"+Ff,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(i[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",d,qr("v:shadow",null,u),qr("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Za("x:Anchor",[o.c+1,0,o.r+1,0,o.c+3,20,o.r+5,20].join(",")),Za("x:AutoFill","False"),Za("x:Row",String(o.r)),Za("x:Column",String(o.c)),i[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),a.push("</xml>"),a.join("")}function xk(e,t,r,s){var a=Array.isArray(e),i;t.forEach(function(o){var l=Is(o.ref);if(a?(e[l.r]||(e[l.r]=[]),i=e[l.r][l.c]):i=e[o.ref],!i){i={t:"z"},a?e[l.r][l.c]=i:e[o.ref]=i;var c=Jn(e["!ref"]||"BDWGO1000001:A1");c.s.r>l.r&&(c.s.r=l.r),c.e.r<l.r&&(c.e.r=l.r),c.s.c>l.c&&(c.s.c=l.c),c.e.c<l.c&&(c.e.c=l.c);var d=Ln(c);d!==e["!ref"]&&(e["!ref"]=d)}i.c||(i.c=[]);var u={a:o.author,t:o.t,r:o.r,T:r};o.h&&(u.h=o.h);for(var h=i.c.length-1;h>=0;--h){if(!r&&i.c[h].T)return;r&&!i.c[h].T&&i.c.splice(h,1)}if(r&&s){for(h=0;h<s.length;++h)if(u.a==s[h].id){u.a=s[h].name||u.a;break}}i.c.push(u)})}function S$(e,t){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var r=[],s=[],a=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);a&&a[1]&&a[1].split(/<\/\w*:?author>/).forEach(function(o){if(!(o===""||o.trim()==="")){var l=o.match(/<(?:\w+:)?author[^>]*>(.*)/);l&&r.push(l[1])}});var i=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return i&&i[1]&&i[1].split(/<\/\w*:?comment>/).forEach(function(o){if(!(o===""||o.trim()==="")){var l=o.match(/<(?:\w+:)?comment[^>]*>/);if(l){var c=kn(l[0]),d={author:c.authorId&&r[c.authorId]||"sheetjsghost",ref:c.ref,guid:c.guid},u=Is(c.ref);if(!(t.sheetRows&&t.sheetRows<=u.r)){var h=o.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),p=!!h&&!!h[1]&&Cw(h[1])||{r:"",t:"",h:""};d.r=p.r,p.r=="<t></t>"&&(p.t=p.h=""),d.t=(p.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),t.cellHTML&&(d.h=p.h),s.push(d)}}}}),s}function IC(e){var t=[fa,qr("comments",null,{xmlns:Pu[0]})],r=[];return t.push("<authors>"),e.forEach(function(s){s[1].forEach(function(a){var i=us(a.a);r.indexOf(i)==-1&&(r.push(i),t.push("<author>"+i+"</author>")),a.T&&a.ID&&r.indexOf("tc="+a.ID)==-1&&(r.push("tc="+a.ID),t.push("<author>tc="+a.ID+"</author>"))})}),r.length==0&&(r.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),e.forEach(function(s){var a=0,i=[];if(s[1][0]&&s[1][0].T&&s[1][0].ID?a=r.indexOf("tc="+s[1][0].ID):s[1].forEach(function(c){c.a&&(a=r.indexOf(us(c.a))),i.push(c.t||"")}),t.push('<comment ref="'+s[0]+'" authorId="'+a+'"><text>'),i.length<=1)t.push(Za("t",us(i[0]||"")));else{for(var o=`Comment:
    `+i[0]+`
`,l=1;l<i.length;++l)o+=`Reply:
    `+i[l]+`
`;t.push(Za("t",us(o)))}t.push("</text></comment>")}),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function _$(e,t){var r=[],s=!1,a={},i=0;return e.replace(wi,function(l,c){var d=kn(l);switch(Gl(d[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":a={author:d.personId,guid:d.id,ref:d.ref,T:1};break;case"</threadedComment>":a.t!=null&&r.push(a);break;case"<text>":case"<text":i=c+l.length;break;case"</text>":a.t=e.slice(i,c).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":s=!0;break;case"</mentions>":s=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(!s&&t.WTF)throw new Error("unrecognized "+d[0]+" in threaded comments")}return l}),r}function k$(e,t,r){var s=[fa,qr("ThreadedComments",null,{xmlns:Ea.TCMNT}).replace(/[\/]>/,">")];return e.forEach(function(a){var i="";(a[1]||[]).forEach(function(o,l){if(!o.T){delete o.ID;return}o.a&&t.indexOf(o.a)==-1&&t.push(o.a);var c={ref:a[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+r.tcid++).slice(-12)+"}"};l==0?i=c.id:c.parentId=i,o.ID=c.id,o.a&&(c.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(o.a)).slice(-12)+"}"),s.push(qr("threadedComment",Za("text",o.t||""),c))})}),s.push("</ThreadedComments>"),s.join("")}function j$(e,t){var r=[],s=!1;return e.replace(wi,function(i){var o=kn(i);switch(Gl(o[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":r.push({name:o.displayname,id:o.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(!s&&t.WTF)throw new Error("unrecognized "+o[0]+" in threaded comments")}return i}),r}function N$(e){var t=[fa,qr("personList",null,{xmlns:Ea.TCMNT,"xmlns:x":Pu[0]}).replace(/[\/]>/,">")];return e.forEach(function(r,s){t.push(qr("person",null,{displayName:r,id:"{54EE7950-7262-4200-6969-"+("000000000000"+s).slice(-12)+"}",userId:r,providerId:"None"}))}),t.push("</personList>"),t.join("")}function A$(e){var t={};t.iauthor=e.read_shift(4);var r=Uu(e);return t.rfx=r.s,t.ref=Sn(r.s),e.l+=16,t}function C$(e,t){return t==null&&(t=xr(36)),t.write_shift(4,e[1].iauthor),C0(e[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}var E$=yi;function T$(e){return Da(e.slice(0,54))}function L$(e,t){var r=[],s=[],a={},i=!1;return Lc(e,function(l,c,d){switch(d){case 632:s.push(l);break;case 635:a=l;break;case 637:a.t=l.t,a.h=l.h,a.r=l.r;break;case 636:if(a.author=s[a.iauthor],delete a.iauthor,t.sheetRows&&a.rfx&&t.sheetRows<=a.rfx.r)break;a.t||(a.t=""),delete a.rfx,r.push(a);break;case 3072:break;case 35:i=!0;break;case 36:i=!1;break;case 37:break;case 38:break;default:if(!c.T){if(!i||t.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}}),r}function F$(e){var t=Xi(),r=[];return Ar(t,628),Ar(t,630),e.forEach(function(s){s[1].forEach(function(a){r.indexOf(a.a)>-1||(r.push(a.a.slice(0,54)),Ar(t,632,T$(a.a)))})}),Ar(t,631),Ar(t,633),e.forEach(function(s){s[1].forEach(function(a){a.iauthor=r.indexOf(a.a);var i={s:Is(s[0]),e:Is(s[0])};Ar(t,635,C$([i,a])),a.t&&a.t.length>0&&Ar(t,637,e9(a)),Ar(t,636),delete a.iauthor})}),Ar(t,634),Ar(t,629),t.end()}var M$="application/vnd.ms-office.vbaProject";function R$(e){var t=mn.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(r,s){if(!(r.slice(-1)==="/"||!r.match(/_VBA_PROJECT_CUR/))){var a=r.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");mn.utils.cfb_add(t,a,e.FileIndex[s].content)}}),mn.write(t)}function B$(e,t){t.FullPaths.forEach(function(r,s){if(s!=0){var a=r.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");a.slice(-1)!=="/"&&mn.utils.cfb_add(e,a,t.FileIndex[s].content)}})}var DC=["xlsb","xlsm","xlam","biff8","xla"];function P$(){return{"!type":"dialog"}}function O$(){return{"!type":"dialog"}}function I$(){return{"!type":"macro"}}function D$(){return{"!type":"macro"}}var Gf=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function r(s,a,i,o){var l=!1,c=!1;i.length==0?c=!0:i.charAt(0)=="["&&(c=!0,i=i.slice(1,-1)),o.length==0?l=!0:o.charAt(0)=="["&&(l=!0,o=o.slice(1,-1));var d=i.length>0?parseInt(i,10)|0:0,u=o.length>0?parseInt(o,10)|0:0;return l?u+=t.c:--u,c?d+=t.r:--d,a+(l?"":"$")+Os(u)+(c?"":"$")+ua(d)}return function(a,i){return t=i,a.replace(e,r)}}(),Fw=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,Mw=function(){return function(t,r){return t.replace(Fw,function(s,a,i,o,l,c){var d=bw(o)-(i?0:r.c),u=yw(c)-(l?0:r.r),h=u==0?"":l?u+1:"["+u+"]",p=d==0?"":i?d+1:"["+d+"]";return a+"R"+h+"C"+p})}}();function UC(e,t){return e.replace(Fw,function(r,s,a,i,o,l){return s+(a=="$"?a+i:Os(bw(i)+t.c))+(o=="$"?o+l:ua(yw(l)+t.r))})}function U$(e,t,r){var s=Ki(t),a=s.s,i=Is(r),o={r:i.r-a.r,c:i.c-a.c};return UC(e,o)}function $$(e){return e.length!=1}function gk(e){return e.replace(/_xlfn\./g,"")}function pa(e){e.l+=1}function Ad(e,t){var r=e.read_shift(2);return[r&16383,r>>14&1,r>>15&1]}function $C(e,t,r){var s=2;if(r){if(r.biff>=2&&r.biff<=5)return WC(e);r.biff==12&&(s=4)}var a=e.read_shift(s),i=e.read_shift(s),o=Ad(e),l=Ad(e);return{s:{r:a,c:o[0],cRel:o[1],rRel:o[2]},e:{r:i,c:l[0],cRel:l[1],rRel:l[2]}}}function WC(e){var t=Ad(e),r=Ad(e),s=e.read_shift(1),a=e.read_shift(1);return{s:{r:t[0],c:s,cRel:t[1],rRel:t[2]},e:{r:r[0],c:a,cRel:r[1],rRel:r[2]}}}function W$(e,t,r){if(r.biff<8)return WC(e);var s=e.read_shift(r.biff==12?4:2),a=e.read_shift(r.biff==12?4:2),i=Ad(e),o=Ad(e);return{s:{r:s,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:o[0],cRel:o[1],rRel:o[2]}}}function zC(e,t,r){if(r&&r.biff>=2&&r.biff<=5)return z$(e);var s=e.read_shift(r&&r.biff==12?4:2),a=Ad(e);return{r:s,c:a[0],cRel:a[1],rRel:a[2]}}function z$(e){var t=Ad(e),r=e.read_shift(1);return{r:t[0],c:r,cRel:t[1],rRel:t[2]}}function q$(e){var t=e.read_shift(2),r=e.read_shift(2);return{r:t,c:r&255,fQuoted:!!(r&16384),cRel:r>>15,rRel:r>>15}}function H$(e,t,r){var s=r&&r.biff?r.biff:8;if(s>=2&&s<=5)return V$(e);var a=e.read_shift(s>=12?4:2),i=e.read_shift(2),o=(i&16384)>>14,l=(i&32768)>>15;if(i&=16383,l==1)for(;a>524287;)a-=1048576;if(o==1)for(;i>8191;)i=i-16384;return{r:a,c:i,cRel:o,rRel:l}}function V$(e){var t=e.read_shift(2),r=e.read_shift(1),s=(t&32768)>>15,a=(t&16384)>>14;return t&=16383,s==1&&t>=8192&&(t=t-16384),a==1&&r>=128&&(r=r-256),{r:t,c:r,cRel:a,rRel:s}}function G$(e,t,r){var s=(e[e.l++]&96)>>5,a=$C(e,r.biff>=2&&r.biff<=5?6:8,r);return[s,a]}function Q$(e,t,r){var s=(e[e.l++]&96)>>5,a=e.read_shift(2,"i"),i=8;if(r)switch(r.biff){case 5:e.l+=12,i=6;break;case 12:i=12;break}var o=$C(e,i,r);return[s,a,o]}function X$(e,t,r){var s=(e[e.l++]&96)>>5;return e.l+=r&&r.biff>8?12:r.biff<8?6:8,[s]}function Y$(e,t,r){var s=(e[e.l++]&96)>>5,a=e.read_shift(2),i=8;if(r)switch(r.biff){case 5:e.l+=12,i=6;break;case 12:i=12;break}return e.l+=i,[s,a]}function K$(e,t,r){var s=(e[e.l++]&96)>>5,a=W$(e,t-1,r);return[s,a]}function J$(e,t,r){var s=(e[e.l++]&96)>>5;return e.l+=r.biff==2?6:r.biff==12?14:7,[s]}function yk(e){var t=e[e.l+1]&1,r=1;return e.l+=4,[t,r]}function Z$(e,t,r){e.l+=2;for(var s=e.read_shift(r&&r.biff==2?1:2),a=[],i=0;i<=s;++i)a.push(e.read_shift(r&&r.biff==2?1:2));return a}function eW(e,t,r){var s=e[e.l+1]&255?1:0;return e.l+=2,[s,e.read_shift(r&&r.biff==2?1:2)]}function tW(e,t,r){var s=e[e.l+1]&255?1:0;return e.l+=2,[s,e.read_shift(r&&r.biff==2?1:2)]}function rW(e){var t=e[e.l+1]&255?1:0;return e.l+=2,[t,e.read_shift(2)]}function nW(e,t,r){var s=e[e.l+1]&255?1:0;return e.l+=r&&r.biff==2?3:4,[s]}function qC(e){var t=e.read_shift(1),r=e.read_shift(1);return[t,r]}function sW(e){return e.read_shift(2),qC(e)}function aW(e){return e.read_shift(2),qC(e)}function iW(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var a=zC(e,0,r);return[s,a]}function oW(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var a=H$(e,0,r);return[s,a]}function lW(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var a=e.read_shift(2);r&&r.biff==5&&(e.l+=12);var i=zC(e,0,r);return[s,a,i]}function cW(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var a=e.read_shift(r&&r.biff<=3?1:2);return[fz[a],GC[a],s]}function dW(e,t,r){var s=e[e.l++],a=e.read_shift(1),i=r&&r.biff<=3?[s==88?-1:0,e.read_shift(1)]:uW(e);return[a,(i[0]===0?GC:uz)[i[1]]]}function uW(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function fW(e,t,r){e.l+=r&&r.biff==2?3:4}function hW(e,t,r){if(e.l++,r&&r.biff==12)return[e.read_shift(4,"i"),0];var s=e.read_shift(2),a=e.read_shift(r&&r.biff==2?1:2);return[s,a]}function pW(e){return e.l++,Fc[e.read_shift(1)]}function mW(e){return e.l++,e.read_shift(2)}function xW(e){return e.l++,e.read_shift(1)!==0}function gW(e){return e.l++,xi(e)}function yW(e,t,r){return e.l++,$p(e,t-1,r)}function bW(e,t){var r=[e.read_shift(1)];if(t==12)switch(r[0]){case 2:r[0]=4;break;case 4:r[0]=16;break;case 0:r[0]=1;break;case 1:r[0]=2;break}switch(r[0]){case 4:r[1]=na(e,1)?"TRUE":"FALSE",t!=12&&(e.l+=7);break;case 37:case 16:r[1]=Fc[e[e.l]],e.l+=t==12?4:8;break;case 0:e.l+=8;break;case 1:r[1]=xi(e);break;case 2:r[1]=$u(e,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+r[0])}return r}function vW(e,t,r){for(var s=e.read_shift(r.biff==12?4:2),a=[],i=0;i!=s;++i)a.push((r.biff==12?Uu:xg)(e));return a}function wW(e,t,r){var s=0,a=0;r.biff==12?(s=e.read_shift(4),a=e.read_shift(4)):(a=1+e.read_shift(1),s=1+e.read_shift(2)),r.biff>=2&&r.biff<8&&(--s,--a==0&&(a=256));for(var i=0,o=[];i!=s&&(o[i]=[]);++i)for(var l=0;l!=a;++l)o[i][l]=bW(e,r.biff);return o}function SW(e,t,r){var s=e.read_shift(1)>>>5&3,a=!r||r.biff>=8?4:2,i=e.read_shift(a);switch(r.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[s,0,i]}function _W(e,t,r){if(r.biff==5)return kW(e);var s=e.read_shift(1)>>>5&3,a=e.read_shift(2),i=e.read_shift(4);return[s,a,i]}function kW(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2,"i");e.l+=8;var s=e.read_shift(2);return e.l+=12,[t,r,s]}function jW(e,t,r){var s=e.read_shift(1)>>>5&3;e.l+=r&&r.biff==2?3:4;var a=e.read_shift(r&&r.biff==2?1:2);return[s,a]}function NW(e,t,r){var s=e.read_shift(1)>>>5&3,a=e.read_shift(r&&r.biff==2?1:2);return[s,a]}function AW(e,t,r){var s=e.read_shift(1)>>>5&3;return e.l+=4,r.biff<8&&e.l--,r.biff==12&&(e.l+=2),[s]}function CW(e,t,r){var s=(e[e.l++]&96)>>5,a=e.read_shift(2),i=4;if(r)switch(r.biff){case 5:i=15;break;case 12:i=6;break}return e.l+=i,[s,a]}var EW=vi,TW=vi,LW=vi;function zp(e,t,r){return e.l+=2,[q$(e)]}function Rw(e){return e.l+=6,[]}var FW=zp,MW=Rw,RW=Rw,BW=zp;function HC(e){return e.l+=2,[ya(e),e.read_shift(2)&1]}var PW=zp,OW=HC,IW=Rw,DW=zp,UW=zp,$W=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function WW(e){e.l+=2;var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(4),a=e.read_shift(2),i=e.read_shift(2),o=$W[r>>2&31];return{ixti:t,coltype:r&3,rt:o,idx:s,c:a,C:i}}function zW(e){return e.l+=2,[e.read_shift(4)]}function qW(e,t,r){return e.l+=5,e.l+=2,e.l+=r.biff==2?1:4,["PTGSHEET"]}function HW(e,t,r){return e.l+=r.biff==2?4:5,["PTGENDSHEET"]}function VW(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function GW(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function QW(e){return e.l+=4,[0,0]}var bk={1:{n:"PtgExp",f:hW},2:{n:"PtgTbl",f:LW},3:{n:"PtgAdd",f:pa},4:{n:"PtgSub",f:pa},5:{n:"PtgMul",f:pa},6:{n:"PtgDiv",f:pa},7:{n:"PtgPower",f:pa},8:{n:"PtgConcat",f:pa},9:{n:"PtgLt",f:pa},10:{n:"PtgLe",f:pa},11:{n:"PtgEq",f:pa},12:{n:"PtgGe",f:pa},13:{n:"PtgGt",f:pa},14:{n:"PtgNe",f:pa},15:{n:"PtgIsect",f:pa},16:{n:"PtgUnion",f:pa},17:{n:"PtgRange",f:pa},18:{n:"PtgUplus",f:pa},19:{n:"PtgUminus",f:pa},20:{n:"PtgPercent",f:pa},21:{n:"PtgParen",f:pa},22:{n:"PtgMissArg",f:pa},23:{n:"PtgStr",f:yW},26:{n:"PtgSheet",f:qW},27:{n:"PtgEndSheet",f:HW},28:{n:"PtgErr",f:pW},29:{n:"PtgBool",f:xW},30:{n:"PtgInt",f:mW},31:{n:"PtgNum",f:gW},32:{n:"PtgArray",f:J$},33:{n:"PtgFunc",f:cW},34:{n:"PtgFuncVar",f:dW},35:{n:"PtgName",f:SW},36:{n:"PtgRef",f:iW},37:{n:"PtgArea",f:G$},38:{n:"PtgMemArea",f:jW},39:{n:"PtgMemErr",f:EW},40:{n:"PtgMemNoMem",f:TW},41:{n:"PtgMemFunc",f:NW},42:{n:"PtgRefErr",f:AW},43:{n:"PtgAreaErr",f:X$},44:{n:"PtgRefN",f:oW},45:{n:"PtgAreaN",f:K$},46:{n:"PtgMemAreaN",f:VW},47:{n:"PtgMemNoMemN",f:GW},57:{n:"PtgNameX",f:_W},58:{n:"PtgRef3d",f:lW},59:{n:"PtgArea3d",f:Q$},60:{n:"PtgRefErr3d",f:CW},61:{n:"PtgAreaErr3d",f:Y$},255:{}},XW={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},YW={1:{n:"PtgElfLel",f:HC},2:{n:"PtgElfRw",f:DW},3:{n:"PtgElfCol",f:FW},6:{n:"PtgElfRwV",f:UW},7:{n:"PtgElfColV",f:BW},10:{n:"PtgElfRadical",f:PW},11:{n:"PtgElfRadicalS",f:IW},13:{n:"PtgElfColS",f:MW},15:{n:"PtgElfColSV",f:RW},16:{n:"PtgElfRadicalLel",f:OW},25:{n:"PtgList",f:WW},29:{n:"PtgSxName",f:zW},255:{}},KW={0:{n:"PtgAttrNoop",f:QW},1:{n:"PtgAttrSemi",f:nW},2:{n:"PtgAttrIf",f:tW},4:{n:"PtgAttrChoose",f:Z$},8:{n:"PtgAttrGoto",f:eW},16:{n:"PtgAttrSum",f:fW},32:{n:"PtgAttrBaxcel",f:yk},33:{n:"PtgAttrBaxcel",f:yk},64:{n:"PtgAttrSpace",f:sW},65:{n:"PtgAttrSpaceSemi",f:aW},128:{n:"PtgAttrIfError",f:rW},255:{}};function qp(e,t,r,s){if(s.biff<8)return vi(e,t);for(var a=e.l+t,i=[],o=0;o!==r.length;++o)switch(r[o][0]){case"PtgArray":r[o][1]=wW(e,0,s),i.push(r[o][1]);break;case"PtgMemArea":r[o][2]=vW(e,r[o][1],s),i.push(r[o][2]);break;case"PtgExp":s&&s.biff==12&&(r[o][1][1]=e.read_shift(4),i.push(r[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+r[o][0]}return t=a-e.l,t!==0&&i.push(vi(e,t)),i}function Hp(e,t,r){for(var s=e.l+t,a,i,o=[];s!=e.l;)t=s-e.l,i=e[e.l],a=bk[i]||bk[XW[i]],(i===24||i===25)&&(a=(i===24?YW:KW)[e[e.l+1]]),!a||!a.f?vi(e,t):o.push([a.n,a.f(e,t,r)]);return o}function JW(e){for(var t=[],r=0;r<e.length;++r){for(var s=e[r],a=[],i=0;i<s.length;++i){var o=s[i];if(o)switch(o[0]){case 2:a.push('"'+o[1].replace(/"/g,'""')+'"');break;default:a.push(o[1])}else a.push("")}t.push(a.join(","))}return t.join(";")}var ZW={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function ez(e,t){if(!e&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function VC(e,t,r){if(!e)return"SH33TJSERR0";if(r.biff>8&&(!e.XTI||!e.XTI[t]))return e.SheetNames[t];if(!e.XTI)return"SH33TJSERR6";var s=e.XTI[t];if(r.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),t==0?"":e.XTI[t-1];if(!s)return"SH33TJSERR1";var a="";if(r.biff>8)switch(e[s[0]][0]){case 357:return a=s[1]==-1?"#REF":e.SheetNames[s[1]],s[1]==s[2]?a:a+":"+e.SheetNames[s[2]];case 358:return r.SID!=null?e.SheetNames[r.SID]:"SH33TJSSAME"+e[s[0]][0];case 355:default:return"SH33TJSSRC"+e[s[0]][0]}switch(e[s[0]][0][0]){case 1025:return a=s[1]==-1?"#REF":e.SheetNames[s[1]]||"SH33TJSERR3",s[1]==s[2]?a:a+":"+e.SheetNames[s[2]];case 14849:return e[s[0]].slice(1).map(function(i){return i.Name}).join(";;");default:return e[s[0]][0][3]?(a=s[1]==-1?"#REF":e[s[0]][0][3][s[1]]||"SH33TJSERR4",s[1]==s[2]?a:a+":"+e[s[0]][0][3][s[2]]):"SH33TJSERR2"}}function vk(e,t,r){var s=VC(e,t,r);return s=="#REF"?s:ez(s,r)}function ui(e,t,r,s,a){var i=a&&a.biff||8,o={s:{c:0,r:0}},l=[],c,d,u,h=0,p=0,f,x="";if(!e[0]||!e[0][0])return"";for(var g=-1,y="",m=0,w=e[0].length;m<w;++m){var S=e[0][m];switch(S[0]){case"PtgUminus":l.push("-"+l.pop());break;case"PtgUplus":l.push("+"+l.pop());break;case"PtgPercent":l.push(l.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(c=l.pop(),d=l.pop(),g>=0){switch(e[0][g][1][0]){case 0:y=Gs(" ",e[0][g][1][1]);break;case 1:y=Gs("\r",e[0][g][1][1]);break;default:if(y="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][g][1][0])}d=d+y,g=-1}l.push(d+ZW[S[0]]+c);break;case"PtgIsect":c=l.pop(),d=l.pop(),l.push(d+" "+c);break;case"PtgUnion":c=l.pop(),d=l.pop(),l.push(d+","+c);break;case"PtgRange":c=l.pop(),d=l.pop(),l.push(d+":"+c);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":u=Th(S[1][1],o,a),l.push(Lh(u,i));break;case"PtgRefN":u=r?Th(S[1][1],r,a):S[1][1],l.push(Lh(u,i));break;case"PtgRef3d":h=S[1][1],u=Th(S[1][2],o,a),x=vk(s,h,a),l.push(x+"!"+Lh(u,i));break;case"PtgFunc":case"PtgFuncVar":var k=S[1][0],F=S[1][1];k||(k=0),k&=127;var L=k==0?[]:l.slice(-k);l.length-=k,F==="User"&&(F=L.shift()),l.push(F+"("+L.join(",")+")");break;case"PtgBool":l.push(S[1]?"TRUE":"FALSE");break;case"PtgInt":l.push(S[1]);break;case"PtgNum":l.push(String(S[1]));break;case"PtgStr":l.push('"'+S[1].replace(/"/g,'""')+'"');break;case"PtgErr":l.push(S[1]);break;case"PtgAreaN":f=X_(S[1][1],r?{s:r}:o,a),l.push(Sy(f,a));break;case"PtgArea":f=X_(S[1][1],o,a),l.push(Sy(f,a));break;case"PtgArea3d":h=S[1][1],f=S[1][2],x=vk(s,h,a),l.push(x+"!"+Sy(f,a));break;case"PtgAttrSum":l.push("SUM("+l.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":p=S[1][2];var C=(s.names||[])[p-1]||(s[0]||[])[p],O=C?C.Name:"SH33TJSNAME"+String(p);O&&O.slice(0,6)=="_xlfn."&&!a.xlfn&&(O=O.slice(6)),l.push(O);break;case"PtgNameX":var T=S[1][1];p=S[1][2];var W;if(a.biff<=5)T<0&&(T=-T),s[T]&&(W=s[T][p]);else{var A="";if(((s[T]||[])[0]||[])[0]==14849||(((s[T]||[])[0]||[])[0]==1025?s[T][p]&&s[T][p].itab>0&&(A=s.SheetNames[s[T][p].itab-1]+"!"):A=s.SheetNames[p-1]+"!"),s[T]&&s[T][p])A+=s[T][p].Name;else if(s[0]&&s[0][p])A+=s[0][p].Name;else{var N=(VC(s,T,a)||"").split(";;");N[p-1]?A=N[p-1]:A+="SH33TJSERRX"}l.push(A);break}W||(W={Name:"SH33TJSERRY"}),l.push(W.Name);break;case"PtgParen":var P="(",K=")";if(g>=0){switch(y="",e[0][g][1][0]){case 2:P=Gs(" ",e[0][g][1][1])+P;break;case 3:P=Gs("\r",e[0][g][1][1])+P;break;case 4:K=Gs(" ",e[0][g][1][1])+K;break;case 5:K=Gs("\r",e[0][g][1][1])+K;break;default:if(a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][g][1][0])}g=-1}l.push(P+l.pop()+K);break;case"PtgRefErr":l.push("#REF!");break;case"PtgRefErr3d":l.push("#REF!");break;case"PtgExp":u={c:S[1][1],r:S[1][0]};var re={c:r.c,r:r.r};if(s.sharedf[Sn(u)]){var ge=s.sharedf[Sn(u)];l.push(ui(ge,o,re,s,a))}else{var Fe=!1;for(c=0;c!=s.arrayf.length;++c)if(d=s.arrayf[c],!(u.c<d[0].s.c||u.c>d[0].e.c)&&!(u.r<d[0].s.r||u.r>d[0].e.r)){l.push(ui(d[1],o,re,s,a)),Fe=!0;break}Fe||l.push(S[1])}break;case"PtgArray":l.push("{"+JW(S[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":g=m;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":l.push("");break;case"PtgAreaErr":l.push("#REF!");break;case"PtgAreaErr3d":l.push("#REF!");break;case"PtgList":l.push("Table"+S[1].idx+"[#"+S[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(S));default:throw new Error("Unrecognized Formula Token: "+String(S))}var R=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(a.biff!=3&&g>=0&&R.indexOf(e[0][m][0])==-1){S=e[0][g];var q=!0;switch(S[1][0]){case 4:q=!1;case 0:y=Gs(" ",S[1][1]);break;case 5:q=!1;case 1:y=Gs("\r",S[1][1]);break;default:if(y="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+S[1][0])}l.push((q?y:"")+l.pop()+(q?"":y)),g=-1}}if(l.length>1&&a.WTF)throw new Error("bad formula stack");return l[0]}function tz(e,t,r){var s=e.l+t,a=r.biff==2?1:2,i,o=e.read_shift(a);if(o==65535)return[[],vi(e,t-2)];var l=Hp(e,o,r);return t!==o+a&&(i=qp(e,t-o-a,l,r)),e.l=s,[l,i]}function rz(e,t,r){var s=e.l+t,a=r.biff==2?1:2,i,o=e.read_shift(a);if(o==65535)return[[],vi(e,t-2)];var l=Hp(e,o,r);return t!==o+a&&(i=qp(e,t-o-a,l,r)),e.l=s,[l,i]}function nz(e,t,r,s){var a=e.l+t,i=Hp(e,s,r),o;return a!==e.l&&(o=qp(e,a-e.l,i,r)),[i,o]}function sz(e,t,r){var s=e.l+t,a,i=e.read_shift(2),o=Hp(e,i,r);return i==65535?[[],vi(e,t-2)]:(t!==i+2&&(a=qp(e,s-i-2,o,r)),[o,a])}function az(e){var t;if(mc(e,e.l+6)!==65535)return[xi(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return t=e[e.l+2]===1,e.l+=8,[t,"b"];case 2:return t=e[e.l+2],e.l+=8,[t,"e"];case 3:return e.l+=8,["","s"]}return[]}function iz(e){if(e==null){var t=xr(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}else if(typeof e=="number")return _u(e);return _u(0)}function Ay(e,t,r){var s=e.l+t,a=Ql(e);r.biff==2&&++e.l;var i=az(e),o=e.read_shift(1);r.biff!=2&&(e.read_shift(1),r.biff>=5&&e.read_shift(4));var l=rz(e,s-e.l,r);return{cell:a,val:i[0],formula:l,shared:o>>3&1,tt:i[1]}}function oz(e,t,r,s,a){var i=ju(t,r,a),o=iz(e.v),l=xr(6),c=33;l.write_shift(2,c),l.write_shift(4,0);for(var d=xr(e.bf.length),u=0;u<e.bf.length;++u)d[u]=e.bf[u];var h=Ia([i,o,l,d]);return h}function gg(e,t,r){var s=e.read_shift(4),a=Hp(e,s,r),i=e.read_shift(4),o=i>0?qp(e,i,a,r):null;return[a,o]}var lz=gg,yg=gg,cz=gg,dz=gg,uz={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},GC={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},fz={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function wk(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(t,r){return r.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function hz(e){var t="of:="+e.replace(Fw,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return t.replace(/;/g,"|").replace(/,/g,";")}function Cy(e){var t=e.split(":"),r=t[0].split(".")[0];return[r,t[0].split(".")[1]+(t.length>1?":"+(t[1].split(".")[1]||t[1].split(".")[0]):"")]}function pz(e){return e.replace(/\./,"!")}var Mh={},Qf={},Rh=typeof Map<"u";function Bw(e,t,r){var s=0,a=e.length;if(r){if(Rh?r.has(t):Object.prototype.hasOwnProperty.call(r,t)){for(var i=Rh?r.get(t):r[t];s<i.length;++s)if(e[i[s]].t===t)return e.Count++,i[s]}}else for(;s<a;++s)if(e[s].t===t)return e.Count++,s;return e[a]={t},e.Count++,e.Unique++,r&&(Rh?(r.has(t)||r.set(t,[]),r.get(t).push(a)):(Object.prototype.hasOwnProperty.call(r,t)||(r[t]=[]),r[t].push(a))),a}function bg(e,t){var r={min:e+1,max:e+1},s=-1;return t.MDW&&(hi=t.MDW),t.width!=null?r.customWidth=1:t.wpx!=null?s=yp(t.wpx):t.wch!=null&&(s=t.wch),s>-1?(r.width=E1(s),r.customWidth=1):t.width!=null&&(r.width=t.width),t.hidden&&(r.hidden=!0),t.level!=null&&(r.outlineLevel=r.level=t.level),r}function uu(e,t){if(e){var r=[.7,.7,.75,.75,.3,.3];t=="xlml"&&(r=[1,1,1,1,.5,.5]),e.left==null&&(e.left=r[0]),e.right==null&&(e.right=r[1]),e.top==null&&(e.top=r[2]),e.bottom==null&&(e.bottom=r[3]),e.header==null&&(e.header=r[4]),e.footer==null&&(e.footer=r[5])}}function Pd(e,t,r){var s=r.revssf[t.z!=null?t.z:"General"],a=60,i=e.length;if(s==null&&r.ssf){for(;a<392;++a)if(r.ssf[a]==null){yc(t.z,a),r.ssf[a]=t.z,r.revssf[t.z]=s=a;break}}for(a=0;a!=i;++a)if(e[a].numFmtId===s)return a;return e[i]={numFmtId:s,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},i}function QC(e,t,r,s,a,i){try{s.cellNF&&(e.z=vn[t])}catch(l){if(s.WTF)throw l}if(!(e.t==="z"&&!s.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=As(e.v)),(!s||s.cellText!==!1)&&e.t!=="z")try{if(vn[t]==null&&yc(uO[t]||"General",t),e.t==="e")e.w=e.w||Fc[e.v];else if(t===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=up(e.v);else if(e.t==="d"){var o=La(e.v);(o|0)===o?e.w=o.toString(10):e.w=up(o)}else{if(e.v===void 0)return"";e.w=wu(e.v,Qf)}else e.t==="d"?e.w=Yo(t,La(e.v),Qf):e.w=Yo(t,e.v,Qf)}catch(l){if(s.WTF)throw l}if(s.cellStyles&&r!=null)try{e.s=i.Fills[r],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=C1(a.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),s.WTF&&(e.s.fgColor.raw_rgb=a.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=C1(a.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),s.WTF&&(e.s.bgColor.raw_rgb=a.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(l){if(s.WTF&&i.Fills)throw l}}}function mz(e,t,r){if(e&&e["!ref"]){var s=Jn(e["!ref"]);if(s.e.c<s.s.c||s.e.r<s.s.r)throw new Error("Bad range ("+r+"): "+e["!ref"])}}function xz(e,t){var r=Jn(t);r.s.r<=r.e.r&&r.s.c<=r.e.c&&r.s.r>=0&&r.s.c>=0&&(e["!ref"]=Ln(r))}var gz=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,yz=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,bz=/<(?:\w:)?hyperlink [^>]*>/mg,vz=/"(\w*:\w*)"/,wz=/<(?:\w:)?col\b[^>]*[\/]?>/g,Sz=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,_z=/<(?:\w:)?pageMargins[^>]*\/>/g,XC=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,kz=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,jz=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function Nz(e,t,r,s,a,i,o){if(!e)return e;s||(s={"!id":{}});var l=t.dense?[]:{},c={s:{r:2e6,c:2e6},e:{r:0,c:0}},d="",u="",h=e.match(yz);h?(d=e.slice(0,h.index),u=e.slice(h.index+h[0].length)):d=u=e;var p=d.match(XC);p?Pw(p[0],l,a,r):(p=d.match(kz))&&Cz(p[0],p[1]||"",l,a,r);var f=(d.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(f>0){var x=d.slice(f,f+50).match(vz);x&&xz(l,x[1])}var g=d.match(jz);g&&g[1]&&$z(g[1],a);var y=[];if(t.cellStyles){var m=d.match(wz);m&&Pz(y,m)}h&&qz(h[1],l,t,c,i,o);var w=u.match(Sz);w&&(l["!autofilter"]=Iz(w[0]));var S=[],k=u.match(gz);if(k)for(f=0;f!=k.length;++f)S[f]=Jn(k[f].slice(k[f].indexOf('"')+1));var F=u.match(bz);F&&Mz(l,F,s);var L=u.match(_z);if(L&&(l["!margins"]=Rz(kn(L[0]))),!l["!ref"]&&c.e.c>=c.s.c&&c.e.r>=c.s.r&&(l["!ref"]=Ln(c)),t.sheetRows>0&&l["!ref"]){var C=Jn(l["!ref"]);t.sheetRows<=+C.e.r&&(C.e.r=t.sheetRows-1,C.e.r>c.e.r&&(C.e.r=c.e.r),C.e.r<C.s.r&&(C.s.r=C.e.r),C.e.c>c.e.c&&(C.e.c=c.e.c),C.e.c<C.s.c&&(C.s.c=C.e.c),l["!fullref"]=l["!ref"],l["!ref"]=Ln(C))}return y.length>0&&(l["!cols"]=y),S.length>0&&(l["!merges"]=S),l}function Az(e){if(e.length===0)return"";for(var t='<mergeCells count="'+e.length+'">',r=0;r!=e.length;++r)t+='<mergeCell ref="'+Ln(e[r])+'"/>';return t+"</mergeCells>"}function Pw(e,t,r,s){var a=kn(e);r.Sheets[s]||(r.Sheets[s]={}),a.codeName&&(r.Sheets[s].CodeName=Kn(hs(a.codeName)))}function Cz(e,t,r,s,a){Pw(e.slice(0,e.indexOf(">")),r,s,a)}function Ez(e,t,r,s,a){var i=!1,o={},l=null;if(s.bookType!=="xlsx"&&t.vbaraw){var c=t.SheetNames[r];try{t.Workbook&&(c=t.Workbook.Sheets[r].CodeName||c)}catch{}i=!0,o.codeName=zl(us(c))}if(e&&e["!outline"]){var d={summaryBelow:1,summaryRight:1};e["!outline"].above&&(d.summaryBelow=0),e["!outline"].left&&(d.summaryRight=0),l=(l||"")+qr("outlinePr",null,d)}!i&&!l||(a[a.length]=qr("sheetPr",l,o))}var Tz=["objects","scenarios","selectLockedCells","selectUnlockedCells"],Lz=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function Fz(e){var t={sheet:1};return Tz.forEach(function(r){e[r]!=null&&e[r]&&(t[r]="1")}),Lz.forEach(function(r){e[r]!=null&&!e[r]&&(t[r]="0")}),e.password&&(t.password=Ew(e.password).toString(16).toUpperCase()),qr("sheetProtection",null,t)}function Mz(e,t,r){for(var s=Array.isArray(e),a=0;a!=t.length;++a){var i=kn(hs(t[a]),!0);if(!i.ref)return;var o=((r||{})["!id"]||[])[i.id];o?(i.Target=o.Target,i.location&&(i.Target+="#"+Kn(i.location))):(i.Target="#"+Kn(i.location),o={Target:i.Target,TargetMode:"Internal"}),i.Rel=o,i.tooltip&&(i.Tooltip=i.tooltip,delete i.tooltip);for(var l=Jn(i.ref),c=l.s.r;c<=l.e.r;++c)for(var d=l.s.c;d<=l.e.c;++d){var u=Sn({c:d,r:c});s?(e[c]||(e[c]=[]),e[c][d]||(e[c][d]={t:"z",v:void 0}),e[c][d].l=i):(e[u]||(e[u]={t:"z",v:void 0}),e[u].l=i)}}}function Rz(e){var t={};return["left","right","top","bottom","header","footer"].forEach(function(r){e[r]&&(t[r]=parseFloat(e[r]))}),t}function Bz(e){return uu(e),qr("pageMargins",null,e)}function Pz(e,t){for(var r=!1,s=0;s!=t.length;++s){var a=kn(t[s],!0);a.hidden&&(a.hidden=ks(a.hidden));var i=parseInt(a.min,10)-1,o=parseInt(a.max,10)-1;for(a.outlineLevel&&(a.level=+a.outlineLevel||0),delete a.min,delete a.max,a.width=+a.width,!r&&a.width&&(r=!0,Tw(a.width)),Nd(a);i<=o;)e[i++]=Cs(a)}}function Oz(e,t){for(var r=["<cols>"],s,a=0;a!=t.length;++a)(s=t[a])&&(r[r.length]=qr("col",null,bg(a,s)));return r[r.length]="</cols>",r.join("")}function Iz(e){var t={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return t}function Dz(e,t,r,s){var a=typeof e.ref=="string"?e.ref:Ln(e.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var i=r.Workbook.Names,o=Ki(a);o.s.r==o.e.r&&(o.e.r=Ki(t["!ref"]).e.r,a=Ln(o));for(var l=0;l<i.length;++l){var c=i[l];if(c.Name=="_xlnm._FilterDatabase"&&c.Sheet==s){c.Ref="'"+r.SheetNames[s]+"'!"+a;break}}return l==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+r.SheetNames[s]+"'!"+a}),qr("autoFilter",null,{ref:a})}var Uz=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function $z(e,t){t.Views||(t.Views=[{}]),(e.match(Uz)||[]).forEach(function(r,s){var a=kn(r);t.Views[s]||(t.Views[s]={}),+a.zoomScale&&(t.Views[s].zoom=+a.zoomScale),ks(a.rightToLeft)&&(t.Views[s].RTL=!0)})}function Wz(e,t,r,s){var a={workbookViewId:"0"};return(((s||{}).Workbook||{}).Views||[])[0]&&(a.rightToLeft=s.Workbook.Views[0].RTL?"1":"0"),qr("sheetViews",qr("sheetView",null,a),{})}function zz(e,t,r,s){if(e.c&&r["!comments"].push([t,e.c]),e.v===void 0&&typeof e.f!="string"||e.t==="z"&&!e.f)return"";var a="",i=e.t,o=e.v;if(e.t!=="z")switch(e.t){case"b":a=e.v?"1":"0";break;case"n":a=""+e.v;break;case"e":a=Fc[e.v];break;case"d":s&&s.cellDates?a=As(e.v,-1).toISOString():(e=Cs(e),e.t="n",a=""+(e.v=La(As(e.v)))),typeof e.z>"u"&&(e.z=vn[14]);break;default:a=e.v;break}var l=Za("v",us(a)),c={r:t},d=Pd(s.cellXfs,e,s);switch(d!==0&&(c.s=d),e.t){case"n":break;case"d":c.t="d";break;case"b":c.t="b";break;case"e":c.t="e";break;case"z":break;default:if(e.v==null){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(s&&s.bookSST){l=Za("v",""+Bw(s.Strings,e.v,s.revStrings)),c.t="s";break}c.t="str";break}if(e.t!=i&&(e.t=i,e.v=o),typeof e.f=="string"&&e.f){var u=e.F&&e.F.slice(0,t.length)==t?{t:"array",ref:e.F}:null;l=qr("f",us(e.f),u)+(e.v!=null?l:"")}return e.l&&r["!links"].push([t,e.l]),e.D&&(c.cm=1),qr("c",l,c)}var qz=function(){var e=/<(?:\w+:)?c[ \/>]/,t=/<\/(?:\w+:)?row>/,r=/r=["']([^"']*)["']/,s=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,a=/ref=["']([^"']*)["']/,i=fp("v"),o=fp("f");return function(c,d,u,h,p,f){for(var x=0,g="",y=[],m=[],w=0,S=0,k=0,F="",L,C,O=0,T=0,W,A,N=0,P=0,K=Array.isArray(f.CellXf),re,ge=[],Fe=[],R=Array.isArray(d),q=[],me={},fe=!1,E=!!u.sheetStubs,U=c.split(t),I=0,M=U.length;I!=M;++I){g=U[I].trim();var te=g.length;if(te!==0){var Q=0;e:for(x=0;x<te;++x)switch(g[x]){case">":if(g[x-1]!="/"){++x;break e}if(u&&u.cellStyles){if(C=kn(g.slice(Q,x),!0),O=C.r!=null?parseInt(C.r,10):O+1,T=-1,u.sheetRows&&u.sheetRows<O)continue;me={},fe=!1,C.ht&&(fe=!0,me.hpt=parseFloat(C.ht),me.hpx=d0(me.hpt)),C.hidden=="1"&&(fe=!0,me.hidden=!0),C.outlineLevel!=null&&(fe=!0,me.level=+C.outlineLevel),fe&&(q[O-1]=me)}break;case"<":Q=x;break}if(Q>=x)break;if(C=kn(g.slice(Q,x),!0),O=C.r!=null?parseInt(C.r,10):O+1,T=-1,!(u.sheetRows&&u.sheetRows<O)){h.s.r>O-1&&(h.s.r=O-1),h.e.r<O-1&&(h.e.r=O-1),u&&u.cellStyles&&(me={},fe=!1,C.ht&&(fe=!0,me.hpt=parseFloat(C.ht),me.hpx=d0(me.hpt)),C.hidden=="1"&&(fe=!0,me.hidden=!0),C.outlineLevel!=null&&(fe=!0,me.level=+C.outlineLevel),fe&&(q[O-1]=me)),y=g.slice(x).split(e);for(var G=0;G!=y.length&&y[G].trim().charAt(0)=="<";++G);for(y=y.slice(G),x=0;x!=y.length;++x)if(g=y[x].trim(),g.length!==0){if(m=g.match(r),w=x,S=0,k=0,g="<c "+(g.slice(0,1)=="<"?">":"")+g,m!=null&&m.length===2){for(w=0,F=m[1],S=0;S!=F.length&&!((k=F.charCodeAt(S)-64)<1||k>26);++S)w=26*w+k;--w,T=w}else++T;for(S=0;S!=g.length&&g.charCodeAt(S)!==62;++S);if(++S,C=kn(g.slice(0,S),!0),C.r||(C.r=Sn({r:O-1,c:T})),F=g.slice(S),L={t:""},(m=F.match(i))!=null&&m[1]!==""&&(L.v=Kn(m[1])),u.cellFormula){if((m=F.match(o))!=null&&m[1]!==""){if(L.f=Kn(hs(m[1])).replace(/\r\n/g,`
`),u.xlfn||(L.f=gk(L.f)),m[0].indexOf('t="array"')>-1)L.F=(F.match(a)||[])[1],L.F.indexOf(":")>-1&&ge.push([Jn(L.F),L.F]);else if(m[0].indexOf('t="shared"')>-1){A=kn(m[0]);var ne=Kn(hs(m[1]));u.xlfn||(ne=gk(ne)),Fe[parseInt(A.si,10)]=[A,ne,C.r]}}else(m=F.match(/<f[^>]*\/>/))&&(A=kn(m[0]),Fe[A.si]&&(L.f=U$(Fe[A.si][1],Fe[A.si][2],C.r)));var z=Is(C.r);for(S=0;S<ge.length;++S)z.r>=ge[S][0].s.r&&z.r<=ge[S][0].e.r&&z.c>=ge[S][0].s.c&&z.c<=ge[S][0].e.c&&(L.F=ge[S][1])}if(C.t==null&&L.v===void 0)if(L.f||L.F)L.v=0,L.t="n";else if(E)L.t="z";else continue;else L.t=C.t||"n";switch(h.s.c>T&&(h.s.c=T),h.e.c<T&&(h.e.c=T),L.t){case"n":if(L.v==""||L.v==null){if(!E)continue;L.t="z"}else L.v=parseFloat(L.v);break;case"s":if(typeof L.v>"u"){if(!E)continue;L.t="z"}else W=Mh[parseInt(L.v,10)],L.v=W.t,L.r=W.r,u.cellHTML&&(L.h=W.h);break;case"str":L.t="s",L.v=L.v!=null?hs(L.v):"",u.cellHTML&&(L.h=pw(L.v));break;case"inlineStr":m=F.match(s),L.t="s",m!=null&&(W=Cw(m[1]))?(L.v=W.t,u.cellHTML&&(L.h=W.h)):L.v="";break;case"b":L.v=ks(L.v);break;case"d":u.cellDates?L.v=As(L.v,1):(L.v=La(As(L.v,1)),L.t="n");break;case"e":(!u||u.cellText!==!1)&&(L.w=L.v),L.v=KA[L.v];break}if(N=P=0,re=null,K&&C.s!==void 0&&(re=f.CellXf[C.s],re!=null&&(re.numFmtId!=null&&(N=re.numFmtId),u.cellStyles&&re.fillId!=null&&(P=re.fillId))),QC(L,N,P,u,p,f),u.cellDates&&K&&L.t=="n"&&j0(vn[N])&&(L.t="d",L.v=mg(L.v)),C.cm&&u.xlmeta){var he=(u.xlmeta.Cell||[])[+C.cm-1];he&&he.type=="XLDAPR"&&(L.D=!0)}if(R){var X=Is(C.r);d[X.r]||(d[X.r]=[]),d[X.r][X.c]=L}else d[C.r]=L}}}}q.length>0&&(d["!rows"]=q)}}();function Hz(e,t,r,s){var a=[],i=[],o=Jn(e["!ref"]),l="",c,d="",u=[],h=0,p=0,f=e["!rows"],x=Array.isArray(e),g={r:d},y,m=-1;for(p=o.s.c;p<=o.e.c;++p)u[p]=Os(p);for(h=o.s.r;h<=o.e.r;++h){for(i=[],d=ua(h),p=o.s.c;p<=o.e.c;++p){c=u[p]+d;var w=x?(e[h]||[])[p]:e[c];w!==void 0&&(l=zz(w,c,e,t))!=null&&i.push(l)}(i.length>0||f&&f[h])&&(g={r:d},f&&f[h]&&(y=f[h],y.hidden&&(g.hidden=1),m=-1,y.hpx?m=bp(y.hpx):y.hpt&&(m=y.hpt),m>-1&&(g.ht=m,g.customHeight=1),y.level&&(g.outlineLevel=y.level)),a[a.length]=qr("row",i.join(""),g))}if(f)for(;h<f.length;++h)f&&f[h]&&(g={r:h+1},y=f[h],y.hidden&&(g.hidden=1),m=-1,y.hpx?m=bp(y.hpx):y.hpt&&(m=y.hpt),m>-1&&(g.ht=m,g.customHeight=1),y.level&&(g.outlineLevel=y.level),a[a.length]=qr("row","",g));return a.join("")}function YC(e,t,r,s){var a=[fa,qr("worksheet",null,{xmlns:Pu[0],"xmlns:r":Ea.r})],i=r.SheetNames[e],o=0,l="",c=r.Sheets[i];c==null&&(c={});var d=c["!ref"]||"A1",u=Jn(d);if(u.e.c>16383||u.e.r>1048575){if(t.WTF)throw new Error("Range "+d+" exceeds format limit A1:XFD1048576");u.e.c=Math.min(u.e.c,16383),u.e.r=Math.min(u.e.c,1048575),d=Ln(u)}s||(s={}),c["!comments"]=[];var h=[];Ez(c,r,e,t,a),a[a.length]=qr("dimension",null,{ref:d}),a[a.length]=Wz(c,t,e,r),t.sheetFormat&&(a[a.length]=qr("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),c["!cols"]!=null&&c["!cols"].length>0&&(a[a.length]=Oz(c,c["!cols"])),a[o=a.length]="<sheetData/>",c["!links"]=[],c["!ref"]!=null&&(l=Hz(c,t),l.length>0&&(a[a.length]=l)),a.length>o+1&&(a[a.length]="</sheetData>",a[o]=a[o].replace("/>",">")),c["!protect"]&&(a[a.length]=Fz(c["!protect"])),c["!autofilter"]!=null&&(a[a.length]=Dz(c["!autofilter"],c,r,e)),c["!merges"]!=null&&c["!merges"].length>0&&(a[a.length]=Az(c["!merges"]));var p=-1,f,x=-1;return c["!links"].length>0&&(a[a.length]="<hyperlinks>",c["!links"].forEach(function(g){g[1].Target&&(f={ref:g[0]},g[1].Target.charAt(0)!="#"&&(x=cs(s,-1,us(g[1].Target).replace(/#.*$/,""),Wn.HLINK),f["r:id"]="rId"+x),(p=g[1].Target.indexOf("#"))>-1&&(f.location=us(g[1].Target.slice(p+1))),g[1].Tooltip&&(f.tooltip=us(g[1].Tooltip)),a[a.length]=qr("hyperlink",null,f))}),a[a.length]="</hyperlinks>"),delete c["!links"],c["!margins"]!=null&&(a[a.length]=Bz(c["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&(a[a.length]=Za("ignoredErrors",qr("ignoredError",null,{numberStoredAsText:1,sqref:d}))),h.length>0&&(x=cs(s,-1,"../drawings/drawing"+(e+1)+".xml",Wn.DRAW),a[a.length]=qr("drawing",null,{"r:id":"rId"+x}),c["!drawing"]=h),c["!comments"].length>0&&(x=cs(s,-1,"../drawings/vmlDrawing"+(e+1)+".vml",Wn.VML),a[a.length]=qr("legacyDrawing",null,{"r:id":"rId"+x}),c["!legacy"]=x),a.length>1&&(a[a.length]="</worksheet>",a[1]=a[1].replace("/>",">")),a.join("")}function Vz(e,t){var r={},s=e.l+t;r.r=e.read_shift(4),e.l+=4;var a=e.read_shift(2);e.l+=1;var i=e.read_shift(1);return e.l=s,i&7&&(r.level=i&7),i&16&&(r.hidden=!0),i&32&&(r.hpt=a/20),r}function Gz(e,t,r){var s=xr(145),a=(r["!rows"]||[])[e]||{};s.write_shift(4,e),s.write_shift(4,0);var i=320;a.hpx?i=bp(a.hpx)*20:a.hpt&&(i=a.hpt*20),s.write_shift(2,i),s.write_shift(1,0);var o=0;a.level&&(o|=a.level),a.hidden&&(o|=16),(a.hpx||a.hpt)&&(o|=32),s.write_shift(1,o),s.write_shift(1,0);var l=0,c=s.l;s.l+=4;for(var d={r:e,c:0},u=0;u<16;++u)if(!(t.s.c>u+1<<10||t.e.c<u<<10)){for(var h=-1,p=-1,f=u<<10;f<u+1<<10;++f){d.c=f;var x=Array.isArray(r)?(r[d.r]||[])[d.c]:r[Sn(d)];x&&(h<0&&(h=f),p=f)}h<0||(++l,s.write_shift(4,h),s.write_shift(4,p))}var g=s.l;return s.l=c,s.write_shift(4,l),s.l=g,s.length>s.l?s.slice(0,s.l):s}function Qz(e,t,r,s){var a=Gz(s,r,t);(a.length>17||(t["!rows"]||[])[s])&&Ar(e,0,a)}var Xz=Uu,Yz=C0;function Kz(){}function Jz(e,t){var r={},s=e[e.l];return++e.l,r.above=!(s&64),r.left=!(s&128),e.l+=18,r.name=t9(e),r}function Zz(e,t,r){r==null&&(r=xr(84+4*e.length));var s=192;t&&(t.above&&(s&=-65),t.left&&(s&=-129)),r.write_shift(1,s);for(var a=1;a<3;++a)r.write_shift(1,0);return j1({auto:1},r),r.write_shift(-4,-1),r.write_shift(-4,-1),VA(e,r),r.slice(0,r.l)}function eq(e){var t=Zo(e);return[t]}function tq(e,t,r){return r==null&&(r=xr(8)),Ou(t,r)}function rq(e){var t=Iu(e);return[t]}function nq(e,t,r){return r==null&&(r=xr(4)),Du(t,r)}function sq(e){var t=Zo(e),r=e.read_shift(1);return[t,r,"b"]}function aq(e,t,r){return r==null&&(r=xr(9)),Ou(t,r),r.write_shift(1,e.v?1:0),r}function iq(e){var t=Iu(e),r=e.read_shift(1);return[t,r,"b"]}function oq(e,t,r){return r==null&&(r=xr(5)),Du(t,r),r.write_shift(1,e.v?1:0),r}function lq(e){var t=Zo(e),r=e.read_shift(1);return[t,r,"e"]}function cq(e,t,r){return r==null&&(r=xr(9)),Ou(t,r),r.write_shift(1,e.v),r}function dq(e){var t=Iu(e),r=e.read_shift(1);return[t,r,"e"]}function uq(e,t,r){return r==null&&(r=xr(8)),Du(t,r),r.write_shift(1,e.v),r.write_shift(2,0),r.write_shift(1,0),r}function fq(e){var t=Zo(e),r=e.read_shift(4);return[t,r,"s"]}function hq(e,t,r){return r==null&&(r=xr(12)),Ou(t,r),r.write_shift(4,t.v),r}function pq(e){var t=Iu(e),r=e.read_shift(4);return[t,r,"s"]}function mq(e,t,r){return r==null&&(r=xr(8)),Du(t,r),r.write_shift(4,t.v),r}function xq(e){var t=Zo(e),r=xi(e);return[t,r,"n"]}function gq(e,t,r){return r==null&&(r=xr(16)),Ou(t,r),_u(e.v,r),r}function KC(e){var t=Iu(e),r=xi(e);return[t,r,"n"]}function yq(e,t,r){return r==null&&(r=xr(12)),Du(t,r),_u(e.v,r),r}function bq(e){var t=Zo(e),r=_w(e);return[t,r,"n"]}function vq(e,t,r){return r==null&&(r=xr(12)),Ou(t,r),GA(e.v,r),r}function wq(e){var t=Iu(e),r=_w(e);return[t,r,"n"]}function Sq(e,t,r){return r==null&&(r=xr(8)),Du(t,r),GA(e.v,r),r}function _q(e){var t=Zo(e),r=vw(e);return[t,r,"is"]}function kq(e){var t=Zo(e),r=yi(e);return[t,r,"str"]}function jq(e,t,r){return r==null&&(r=xr(12+4*e.v.length)),Ou(t,r),Da(e.v,r),r.length>r.l?r.slice(0,r.l):r}function Nq(e){var t=Iu(e),r=yi(e);return[t,r,"str"]}function Aq(e,t,r){return r==null&&(r=xr(8+4*e.v.length)),Du(t,r),Da(e.v,r),r.length>r.l?r.slice(0,r.l):r}function Cq(e,t,r){var s=e.l+t,a=Zo(e);a.r=r["!row"];var i=e.read_shift(1),o=[a,i,"b"];if(r.cellFormula){e.l+=2;var l=yg(e,s-e.l,r);o[3]=ui(l,null,a,r.supbooks,r)}else e.l=s;return o}function Eq(e,t,r){var s=e.l+t,a=Zo(e);a.r=r["!row"];var i=e.read_shift(1),o=[a,i,"e"];if(r.cellFormula){e.l+=2;var l=yg(e,s-e.l,r);o[3]=ui(l,null,a,r.supbooks,r)}else e.l=s;return o}function Tq(e,t,r){var s=e.l+t,a=Zo(e);a.r=r["!row"];var i=xi(e),o=[a,i,"n"];if(r.cellFormula){e.l+=2;var l=yg(e,s-e.l,r);o[3]=ui(l,null,a,r.supbooks,r)}else e.l=s;return o}function Lq(e,t,r){var s=e.l+t,a=Zo(e);a.r=r["!row"];var i=yi(e),o=[a,i,"str"];if(r.cellFormula){e.l+=2;var l=yg(e,s-e.l,r);o[3]=ui(l,null,a,r.supbooks,r)}else e.l=s;return o}var Fq=Uu,Mq=C0;function Rq(e,t){return t==null&&(t=xr(4)),t.write_shift(4,e),t}function Bq(e,t){var r=e.l+t,s=Uu(e),a=ww(e),i=yi(e),o=yi(e),l=yi(e);e.l=r;var c={rfx:s,relId:a,loc:i,display:l};return o&&(c.Tooltip=o),c}function Pq(e,t){var r=xr(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));C0({s:Is(e[0]),e:Is(e[0])},r),Sw("rId"+t,r);var s=e[1].Target.indexOf("#"),a=s==-1?"":e[1].Target.slice(s+1);return Da(a||"",r),Da(e[1].Tooltip||"",r),Da("",r),r.slice(0,r.l)}function Oq(){}function Iq(e,t,r){var s=e.l+t,a=QA(e),i=e.read_shift(1),o=[a];if(o[2]=i,r.cellFormula){var l=lz(e,s-e.l,r);o[1]=l}else e.l=s;return o}function Dq(e,t,r){var s=e.l+t,a=Uu(e),i=[a];if(r.cellFormula){var o=dz(e,s-e.l,r);i[1]=o,e.l=s}else e.l=s;return i}function Uq(e,t,r){r==null&&(r=xr(18));var s=bg(e,t);r.write_shift(-4,e),r.write_shift(-4,e),r.write_shift(4,(s.width||10)*256),r.write_shift(4,0);var a=0;return t.hidden&&(a|=1),typeof s.width=="number"&&(a|=2),t.level&&(a|=t.level<<8),r.write_shift(2,a),r}var JC=["left","right","top","bottom","header","footer"];function $q(e){var t={};return JC.forEach(function(r){t[r]=xi(e)}),t}function Wq(e,t){return t==null&&(t=xr(6*8)),uu(e),JC.forEach(function(r){_u(e[r],t)}),t}function zq(e){var t=e.read_shift(2);return e.l+=28,{RTL:t&32}}function qq(e,t,r){r==null&&(r=xr(30));var s=924;return(((t||{}).Views||[])[0]||{}).RTL&&(s|=32),r.write_shift(2,s),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,100),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(4,0),r}function Hq(e){var t=xr(24);return t.write_shift(4,4),t.write_shift(4,1),C0(e,t),t}function Vq(e,t){return t==null&&(t=xr(16*4+2)),t.write_shift(2,e.password?Ew(e.password):0),t.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(r){r[1]?t.write_shift(4,e[r[0]]!=null&&!e[r[0]]?1:0):t.write_shift(4,e[r[0]]!=null&&e[r[0]]?0:1)}),t}function Gq(){}function Qq(){}function Xq(e,t,r,s,a,i,o){if(!e)return e;var l=t||{};s||(s={"!id":{}});var c=l.dense?[]:{},d,u={s:{r:2e6,c:2e6},e:{r:0,c:0}},h=!1,p=!1,f,x,g,y,m,w,S,k,F,L=[];l.biff=12,l["!row"]=0;var C=0,O=!1,T=[],W={},A=l.supbooks||a.supbooks||[[]];if(A.sharedf=W,A.arrayf=T,A.SheetNames=a.SheetNames||a.Sheets.map(function(R){return R.name}),!l.supbooks&&(l.supbooks=A,a.Names))for(var N=0;N<a.Names.length;++N)A[0][N+1]=a.Names[N];var P=[],K=[],re=!1;vp[16]={n:"BrtShortReal",f:KC};var ge;if(Lc(e,function(q,me,fe){if(!p)switch(fe){case 148:d=q;break;case 0:f=q,l.sheetRows&&l.sheetRows<=f.r&&(p=!0),k=ua(y=f.r),l["!row"]=f.r,(q.hidden||q.hpt||q.level!=null)&&(q.hpt&&(q.hpx=d0(q.hpt)),K[q.r]=q);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(x={t:q[2]},q[2]){case"n":x.v=q[1];break;case"s":S=Mh[q[1]],x.v=S.t,x.r=S.r;break;case"b":x.v=!!q[1];break;case"e":x.v=q[1],l.cellText!==!1&&(x.w=Fc[x.v]);break;case"str":x.t="s",x.v=q[1];break;case"is":x.t="s",x.v=q[1].t;break}if((g=o.CellXf[q[0].iStyleRef])&&QC(x,g.numFmtId,null,l,i,o),m=q[0].c==-1?m+1:q[0].c,l.dense?(c[y]||(c[y]=[]),c[y][m]=x):c[Os(m)+k]=x,l.cellFormula){for(O=!1,C=0;C<T.length;++C){var E=T[C];f.r>=E[0].s.r&&f.r<=E[0].e.r&&m>=E[0].s.c&&m<=E[0].e.c&&(x.F=Ln(E[0]),O=!0)}!O&&q.length>3&&(x.f=q[3])}if(u.s.r>f.r&&(u.s.r=f.r),u.s.c>m&&(u.s.c=m),u.e.r<f.r&&(u.e.r=f.r),u.e.c<m&&(u.e.c=m),l.cellDates&&g&&x.t=="n"&&j0(vn[g.numFmtId])){var U=nu(x.v);U&&(x.t="d",x.v=new Date(U.y,U.m-1,U.d,U.H,U.M,U.S,U.u))}ge&&(ge.type=="XLDAPR"&&(x.D=!0),ge=void 0);break;case 1:case 12:if(!l.sheetStubs||h)break;x={t:"z",v:void 0},m=q[0].c==-1?m+1:q[0].c,l.dense?(c[y]||(c[y]=[]),c[y][m]=x):c[Os(m)+k]=x,u.s.r>f.r&&(u.s.r=f.r),u.s.c>m&&(u.s.c=m),u.e.r<f.r&&(u.e.r=f.r),u.e.c<m&&(u.e.c=m),ge&&(ge.type=="XLDAPR"&&(x.D=!0),ge=void 0);break;case 176:L.push(q);break;case 49:ge=((l.xlmeta||{}).Cell||[])[q-1];break;case 494:var I=s["!id"][q.relId];for(I?(q.Target=I.Target,q.loc&&(q.Target+="#"+q.loc),q.Rel=I):q.relId==""&&(q.Target="#"+q.loc),y=q.rfx.s.r;y<=q.rfx.e.r;++y)for(m=q.rfx.s.c;m<=q.rfx.e.c;++m)l.dense?(c[y]||(c[y]=[]),c[y][m]||(c[y][m]={t:"z",v:void 0}),c[y][m].l=q):(w=Sn({c:m,r:y}),c[w]||(c[w]={t:"z",v:void 0}),c[w].l=q);break;case 426:if(!l.cellFormula)break;T.push(q),F=l.dense?c[y][m]:c[Os(m)+k],F.f=ui(q[1],u,{r:f.r,c:m},A,l),F.F=Ln(q[0]);break;case 427:if(!l.cellFormula)break;W[Sn(q[0].s)]=q[1],F=l.dense?c[y][m]:c[Os(m)+k],F.f=ui(q[1],u,{r:f.r,c:m},A,l);break;case 60:if(!l.cellStyles)break;for(;q.e>=q.s;)P[q.e--]={width:q.w/256,hidden:!!(q.flags&1),level:q.level},re||(re=!0,Tw(q.w/256)),Nd(P[q.e+1]);break;case 161:c["!autofilter"]={ref:Ln(q)};break;case 476:c["!margins"]=q;break;case 147:a.Sheets[r]||(a.Sheets[r]={}),q.name&&(a.Sheets[r].CodeName=q.name),(q.above||q.left)&&(c["!outline"]={above:q.above,left:q.left});break;case 137:a.Views||(a.Views=[{}]),a.Views[0]||(a.Views[0]={}),q.RTL&&(a.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:h=!0;break;case 36:h=!1;break;case 37:h=!0;break;case 38:h=!1;break;default:if(!me.T){if(!h||l.WTF)throw new Error("Unexpected record 0x"+fe.toString(16))}}},l),delete l.supbooks,delete l["!row"],!c["!ref"]&&(u.s.r<2e6||d&&(d.e.r>0||d.e.c>0||d.s.r>0||d.s.c>0))&&(c["!ref"]=Ln(d||u)),l.sheetRows&&c["!ref"]){var Fe=Jn(c["!ref"]);l.sheetRows<=+Fe.e.r&&(Fe.e.r=l.sheetRows-1,Fe.e.r>u.e.r&&(Fe.e.r=u.e.r),Fe.e.r<Fe.s.r&&(Fe.s.r=Fe.e.r),Fe.e.c>u.e.c&&(Fe.e.c=u.e.c),Fe.e.c<Fe.s.c&&(Fe.s.c=Fe.e.c),c["!fullref"]=c["!ref"],c["!ref"]=Ln(Fe))}return L.length>0&&(c["!merges"]=L),P.length>0&&(c["!cols"]=P),K.length>0&&(c["!rows"]=K),c}function Yq(e,t,r,s,a,i,o){if(t.v===void 0)return!1;var l="";switch(t.t){case"b":l=t.v?"1":"0";break;case"d":t=Cs(t),t.z=t.z||vn[14],t.v=La(As(t.v)),t.t="n";break;case"n":case"e":l=""+t.v;break;default:l=t.v;break}var c={r,c:s};switch(c.s=Pd(a.cellXfs,t,a),t.l&&i["!links"].push([Sn(c),t.l]),t.c&&i["!comments"].push([Sn(c),t.c]),t.t){case"s":case"str":return a.bookSST?(l=Bw(a.Strings,t.v,a.revStrings),c.t="s",c.v=l,o?Ar(e,18,mq(t,c)):Ar(e,7,hq(t,c))):(c.t="str",o?Ar(e,17,Aq(t,c)):Ar(e,6,jq(t,c))),!0;case"n":return t.v==(t.v|0)&&t.v>-1e3&&t.v<1e3?o?Ar(e,13,Sq(t,c)):Ar(e,2,vq(t,c)):o?Ar(e,16,yq(t,c)):Ar(e,5,gq(t,c)),!0;case"b":return c.t="b",o?Ar(e,15,oq(t,c)):Ar(e,4,aq(t,c)),!0;case"e":return c.t="e",o?Ar(e,14,uq(t,c)):Ar(e,3,cq(t,c)),!0}return o?Ar(e,12,nq(t,c)):Ar(e,1,tq(t,c)),!0}function Kq(e,t,r,s){var a=Jn(t["!ref"]||"A1"),i,o="",l=[];Ar(e,145);var c=Array.isArray(t),d=a.e.r;t["!rows"]&&(d=Math.max(a.e.r,t["!rows"].length-1));for(var u=a.s.r;u<=d;++u){o=ua(u),Qz(e,t,a,u);var h=!1;if(u<=a.e.r)for(var p=a.s.c;p<=a.e.c;++p){u===a.s.r&&(l[p]=Os(p)),i=l[p]+o;var f=c?(t[u]||[])[p]:t[i];if(!f){h=!1;continue}h=Yq(e,f,u,p,s,t,h)}}Ar(e,146)}function Jq(e,t){!t||!t["!merges"]||(Ar(e,177,Rq(t["!merges"].length)),t["!merges"].forEach(function(r){Ar(e,176,Mq(r))}),Ar(e,178))}function Zq(e,t){!t||!t["!cols"]||(Ar(e,390),t["!cols"].forEach(function(r,s){r&&Ar(e,60,Uq(s,r))}),Ar(e,391))}function eH(e,t){!t||!t["!ref"]||(Ar(e,648),Ar(e,649,Hq(Jn(t["!ref"]))),Ar(e,650))}function tH(e,t,r){t["!links"].forEach(function(s){if(s[1].Target){var a=cs(r,-1,s[1].Target.replace(/#.*$/,""),Wn.HLINK);Ar(e,494,Pq(s,a))}}),delete t["!links"]}function rH(e,t,r,s){if(t["!comments"].length>0){var a=cs(s,-1,"../drawings/vmlDrawing"+(r+1)+".vml",Wn.VML);Ar(e,551,Sw("rId"+a)),t["!legacy"]=a}}function nH(e,t,r,s){if(t["!autofilter"]){var a=t["!autofilter"],i=typeof a.ref=="string"?a.ref:Ln(a.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var o=r.Workbook.Names,l=Ki(i);l.s.r==l.e.r&&(l.e.r=Ki(t["!ref"]).e.r,i=Ln(l));for(var c=0;c<o.length;++c){var d=o[c];if(d.Name=="_xlnm._FilterDatabase"&&d.Sheet==s){d.Ref="'"+r.SheetNames[s]+"'!"+i;break}}c==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+r.SheetNames[s]+"'!"+i}),Ar(e,161,C0(Jn(i))),Ar(e,162)}}function sH(e,t,r){Ar(e,133),Ar(e,137,qq(t,r)),Ar(e,138),Ar(e,134)}function aH(e,t){t["!protect"]&&Ar(e,535,Vq(t["!protect"]))}function iH(e,t,r,s){var a=Xi(),i=r.SheetNames[e],o=r.Sheets[i]||{},l=i;try{r&&r.Workbook&&(l=r.Workbook.Sheets[e].CodeName||l)}catch{}var c=Jn(o["!ref"]||"A1");if(c.e.c>16383||c.e.r>1048575){if(t.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");c.e.c=Math.min(c.e.c,16383),c.e.r=Math.min(c.e.c,1048575)}return o["!links"]=[],o["!comments"]=[],Ar(a,129),(r.vbaraw||o["!outline"])&&Ar(a,147,Zz(l,o["!outline"])),Ar(a,148,Yz(c)),sH(a,o,r.Workbook),Zq(a,o),Kq(a,o,e,t),aH(a,o),nH(a,o,r,e),Jq(a,o),tH(a,o,s),o["!margins"]&&Ar(a,476,Wq(o["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&eH(a,o),rH(a,o,e,s),Ar(a,130),a.end()}function oH(e){var t=[],r=e.match(/^<c:numCache>/),s;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(i){var o=i.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);o&&(t[+o[1]]=r?+o[2]:o[2])});var a=Kn((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(i){s=i.replace(/<.*?>/g,"")}),[t,a,s]}function lH(e,t,r,s,a,i){var o=i||{"!type":"chart"};if(!e)return i;var l=0,c=0,d="A",u={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(h){var p=oH(h);u.s.r=u.s.c=0,u.e.c=l,d=Os(l),p[0].forEach(function(f,x){o[d+ua(x)]={t:"n",v:f,z:p[1]},c=x}),u.e.r<c&&(u.e.r=c),++l}),l>0&&(o["!ref"]=Ln(u)),o}function cH(e,t,r,s,a){if(!e)return e;s||(s={"!id":{}});var i={"!type":"chart","!drawel":null,"!rel":""},o,l=e.match(XC);return l&&Pw(l[0],i,a,r),(o=e.match(/drawing r:id="(.*?)"/))&&(i["!rel"]=o[1]),s["!id"][i["!rel"]]&&(i["!drawel"]=s["!id"][i["!rel"]]),i}function dH(e,t){e.l+=10;var r=yi(e);return{name:r}}function uH(e,t,r,s,a){if(!e)return e;s||(s={"!id":{}});var i={"!type":"chart","!drawel":null,"!rel":""},o=!1;return Lc(e,function(c,d,u){switch(u){case 550:i["!rel"]=c;break;case 651:a.Sheets[r]||(a.Sheets[r]={}),c.name&&(a.Sheets[r].CodeName=c.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:o=!0;break;case 36:o=!1;break;case 37:break;case 38:break;default:if(!(d.T>0)){if(!(d.T<0)){if(!o||t.WTF)throw new Error("Unexpected record 0x"+u.toString(16))}}}},t),s["!id"][i["!rel"]]&&(i["!drawel"]=s["!id"][i["!rel"]]),i}var Ow=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],fH=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],hH=[],pH=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function Sk(e,t){for(var r=0;r!=e.length;++r)for(var s=e[r],a=0;a!=t.length;++a){var i=t[a];if(s[i[0]]==null)s[i[0]]=i[1];else switch(i[2]){case"bool":typeof s[i[0]]=="string"&&(s[i[0]]=ks(s[i[0]]));break;case"int":typeof s[i[0]]=="string"&&(s[i[0]]=parseInt(s[i[0]],10));break}}}function _k(e,t){for(var r=0;r!=t.length;++r){var s=t[r];if(e[s[0]]==null)e[s[0]]=s[1];else switch(s[2]){case"bool":typeof e[s[0]]=="string"&&(e[s[0]]=ks(e[s[0]]));break;case"int":typeof e[s[0]]=="string"&&(e[s[0]]=parseInt(e[s[0]],10));break}}}function ZC(e){_k(e.WBProps,Ow),_k(e.CalcPr,pH),Sk(e.WBView,fH),Sk(e.Sheets,hH),Qf.date1904=ks(e.WBProps.date1904)}function mH(e){return!e.Workbook||!e.Workbook.WBProps?"false":ks(e.Workbook.WBProps.date1904)?"true":"false"}var xH="][*?/\\".split("");function eE(e,t){if(e.length>31)throw new Error("Sheet names cannot exceed 31 chars");var r=!0;return xH.forEach(function(s){if(e.indexOf(s)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),r}function gH(e,t,r){e.forEach(function(s,a){eE(s);for(var i=0;i<a;++i)if(s==e[i])throw new Error("Duplicate Sheet Name: "+s);if(r){var o=t&&t[a]&&t[a].CodeName||s;if(o.charCodeAt(0)==95&&o.length>22)throw new Error("Bad Code Name: Worksheet"+o)}})}function yH(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");var t=e.Workbook&&e.Workbook.Sheets||[];gH(e.SheetNames,t,!!e.vbaraw);for(var r=0;r<e.SheetNames.length;++r)mz(e.Sheets[e.SheetNames[r]],e.SheetNames[r],r)}var bH=/<\w+:workbook/;function vH(e,t){if(!e)throw new Error("Could not find file");var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},s=!1,a="xmlns",i={},o=0;if(e.replace(wi,function(c,d){var u=kn(c);switch(Gl(u[0])){case"<?xml":break;case"<workbook":c.match(bH)&&(a="xmlns"+c.match(/<(\w+):/)[1]),r.xmlns=u[a];break;case"</workbook>":break;case"<fileVersion":delete u[0],r.AppVersion=u;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":Ow.forEach(function(h){if(u[h[0]]!=null)switch(h[2]){case"bool":r.WBProps[h[0]]=ks(u[h[0]]);break;case"int":r.WBProps[h[0]]=parseInt(u[h[0]],10);break;default:r.WBProps[h[0]]=u[h[0]]}}),u.codeName&&(r.WBProps.CodeName=hs(u.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete u[0],r.WBView.push(u);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(u.state){case"hidden":u.Hidden=1;break;case"veryHidden":u.Hidden=2;break;default:u.Hidden=0}delete u.state,u.name=Kn(hs(u.name)),delete u[0],r.Sheets.push(u);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":s=!0;break;case"</definedNames>":s=!1;break;case"<definedName":i={},i.Name=hs(u.name),u.comment&&(i.Comment=u.comment),u.localSheetId&&(i.Sheet=+u.localSheetId),ks(u.hidden||"0")&&(i.Hidden=!0),o=d+c.length;break;case"</definedName>":i.Ref=Kn(hs(e.slice(o,d))),r.Names.push(i);break;case"<definedName/>":break;case"<calcPr":delete u[0],r.CalcPr=u;break;case"<calcPr/>":delete u[0],r.CalcPr=u;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":s=!0;break;case"</AlternateContent>":s=!1;break;case"<revisionPtr":break;default:if(!s&&t.WTF)throw new Error("unrecognized "+u[0]+" in workbook")}return c}),Pu.indexOf(r.xmlns)===-1)throw new Error("Unknown Namespace: "+r.xmlns);return ZC(r),r}function tE(e){var t=[fa];t[t.length]=qr("workbook",null,{xmlns:Pu[0],"xmlns:r":Ea.r});var r=e.Workbook&&(e.Workbook.Names||[]).length>0,s={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(Ow.forEach(function(l){e.Workbook.WBProps[l[0]]!=null&&e.Workbook.WBProps[l[0]]!=l[1]&&(s[l[0]]=e.Workbook.WBProps[l[0]])}),e.Workbook.WBProps.CodeName&&(s.codeName=e.Workbook.WBProps.CodeName,delete s.CodeName)),t[t.length]=qr("workbookPr",null,s);var a=e.Workbook&&e.Workbook.Sheets||[],i=0;if(a&&a[0]&&a[0].Hidden){for(t[t.length]="<bookViews>",i=0;i!=e.SheetNames.length&&!(!a[i]||!a[i].Hidden);++i);i==e.SheetNames.length&&(i=0),t[t.length]='<workbookView firstSheet="'+i+'" activeTab="'+i+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",i=0;i!=e.SheetNames.length;++i){var o={name:us(e.SheetNames[i].slice(0,31))};if(o.sheetId=""+(i+1),o["r:id"]="rId"+(i+1),a[i])switch(a[i].Hidden){case 1:o.state="hidden";break;case 2:o.state="veryHidden";break}t[t.length]=qr("sheet",null,o)}return t[t.length]="</sheets>",r&&(t[t.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(l){var c={name:l.Name};l.Comment&&(c.comment=l.Comment),l.Sheet!=null&&(c.localSheetId=""+l.Sheet),l.Hidden&&(c.hidden="1"),l.Ref&&(t[t.length]=qr("definedName",us(l.Ref),c))}),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function wH(e,t){var r={};return r.Hidden=e.read_shift(4),r.iTabID=e.read_shift(4),r.strRelID=_2(e),r.name=yi(e),r}function SH(e,t){return t||(t=xr(127)),t.write_shift(4,e.Hidden),t.write_shift(4,e.iTabID),Sw(e.strRelID,t),Da(e.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function _H(e,t){var r={},s=e.read_shift(4);r.defaultThemeVersion=e.read_shift(4);var a=t>8?yi(e):"";return a.length>0&&(r.CodeName=a),r.autoCompressPictures=!!(s&65536),r.backupFile=!!(s&64),r.checkCompatibility=!!(s&4096),r.date1904=!!(s&1),r.filterPrivacy=!!(s&8),r.hidePivotFieldList=!!(s&1024),r.promptedSolutions=!!(s&16),r.publishItems=!!(s&2048),r.refreshAllConnections=!!(s&262144),r.saveExternalLinkValues=!!(s&128),r.showBorderUnselectedTables=!!(s&4),r.showInkAnnotation=!!(s&32),r.showObjects=["all","placeholders","none"][s>>13&3],r.showPivotChartFilter=!!(s&32768),r.updateLinks=["userSet","never","always"][s>>8&3],r}function kH(e,t){t||(t=xr(72));var r=0;return e&&e.filterPrivacy&&(r|=8),t.write_shift(4,r),t.write_shift(4,0),VA(e&&e.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}function jH(e,t){var r={};return e.read_shift(4),r.ArchID=e.read_shift(4),e.l+=t-8,r}function NH(e,t,r){var s=e.l+t;e.l+=4,e.l+=1;var a=e.read_shift(4),i=r9(e),o=cz(e,0,r),l=ww(e);e.l=s;var c={Name:i,Ptg:o};return a<268435455&&(c.Sheet=a),l&&(c.Comment=l),c}function AH(e,t){var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},s=[],a=!1;t||(t={}),t.biff=12;var i=[],o=[[]];return o.SheetNames=[],o.XTI=[],vp[16]={n:"BrtFRTArchID$",f:jH},Lc(e,function(c,d,u){switch(u){case 156:o.SheetNames.push(c.name),r.Sheets.push(c);break;case 153:r.WBProps=c;break;case 39:c.Sheet!=null&&(t.SID=c.Sheet),c.Ref=ui(c.Ptg,null,null,o,t),delete t.SID,delete c.Ptg,i.push(c);break;case 1036:break;case 357:case 358:case 355:case 667:o[0].length?o.push([u,c]):o[0]=[u,c],o[o.length-1].XTI=[];break;case 362:o.length===0&&(o[0]=[],o[0].XTI=[]),o[o.length-1].XTI=o[o.length-1].XTI.concat(c),o.XTI=o.XTI.concat(c);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:s.push(u),a=!0;break;case 36:s.pop(),a=!1;break;case 37:s.push(u),a=!0;break;case 38:s.pop(),a=!1;break;case 16:break;default:if(!d.T){if(!a||t.WTF&&s[s.length-1]!=37&&s[s.length-1]!=35)throw new Error("Unexpected record 0x"+u.toString(16))}}},t),ZC(r),r.Names=i,r.supbooks=o,r}function CH(e,t){Ar(e,143);for(var r=0;r!=t.SheetNames.length;++r){var s=t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[r]&&t.Workbook.Sheets[r].Hidden||0,a={Hidden:s,iTabID:r+1,strRelID:"rId"+(r+1),name:t.SheetNames[r]};Ar(e,156,SH(a))}Ar(e,144)}function EH(e,t){t||(t=xr(127));for(var r=0;r!=4;++r)t.write_shift(4,0);return Da("SheetJS",t),Da(y1.version,t),Da(y1.version,t),Da("7262",t),t.length>t.l?t.slice(0,t.l):t}function TH(e,t){t||(t=xr(29)),t.write_shift(-4,0),t.write_shift(-4,460),t.write_shift(4,28800),t.write_shift(4,17600),t.write_shift(4,500),t.write_shift(4,e),t.write_shift(4,e);var r=120;return t.write_shift(1,r),t.length>t.l?t.slice(0,t.l):t}function LH(e,t){if(!(!t.Workbook||!t.Workbook.Sheets)){for(var r=t.Workbook.Sheets,s=0,a=-1,i=-1;s<r.length;++s)!r[s]||!r[s].Hidden&&a==-1?a=s:r[s].Hidden==1&&i==-1&&(i=s);i>a||(Ar(e,135),Ar(e,158,TH(a)),Ar(e,136))}}function FH(e,t){var r=Xi();return Ar(r,131),Ar(r,128,EH()),Ar(r,153,kH(e.Workbook&&e.Workbook.WBProps||null)),LH(r,e),CH(r,e),Ar(r,132),r.end()}function MH(e,t,r){return t.slice(-4)===".bin"?AH(e,r):vH(e,r)}function RH(e,t,r,s,a,i,o,l){return t.slice(-4)===".bin"?Xq(e,s,r,a,i,o,l):Nz(e,s,r,a,i,o,l)}function BH(e,t,r,s,a,i,o,l){return t.slice(-4)===".bin"?uH(e,s,r,a,i):cH(e,s,r,a,i)}function PH(e,t,r,s,a,i,o,l){return t.slice(-4)===".bin"?I$():D$()}function OH(e,t,r,s,a,i,o,l){return t.slice(-4)===".bin"?P$():O$()}function IH(e,t,r,s){return t.slice(-4)===".bin"?MU(e,r,s):wU(e,r,s)}function DH(e,t,r){return BC(e,r)}function UH(e,t,r){return t.slice(-4)===".bin"?UD(e,r):OD(e,r)}function $H(e,t,r){return t.slice(-4)===".bin"?L$(e,r):S$(e,r)}function WH(e,t,r){return t.slice(-4)===".bin"?b$(e):g$(e)}function zH(e,t,r,s){return r.slice(-4)===".bin"?v$(e,t,r,s):void 0}function qH(e,t,r){return t.slice(-4)===".bin"?p$(e,t,r):x$(e,t,r)}function HH(e,t,r){return(t.slice(-4)===".bin"?FH:tE)(e)}function VH(e,t,r,s,a){return(t.slice(-4)===".bin"?iH:YC)(e,r,s,a)}function GH(e,t,r){return(t.slice(-4)===".bin"?zU:MC)(e,r)}function QH(e,t,r){return(t.slice(-4)===".bin"?zD:jC)(e,r)}function XH(e,t,r){return(t.slice(-4)===".bin"?F$:IC)(e)}function YH(e){return(e.slice(-4)===".bin"?m$:PC)()}var rE=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,nE=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function sl(e,t){var r=e.split(/\s+/),s=[];if(s[0]=r[0],r.length===1)return s;var a=e.match(rE),i,o,l,c;if(a)for(c=0;c!=a.length;++c)i=a[c].match(nE),(o=i[1].indexOf(":"))===-1?s[i[1]]=i[2].slice(1,i[2].length-1):(i[1].slice(0,6)==="xmlns:"?l="xmlns"+i[1].slice(6):l=i[1].slice(o+1),s[l]=i[2].slice(1,i[2].length-1));return s}function KH(e){var t=e.split(/\s+/),r={};if(t.length===1)return r;var s=e.match(rE),a,i,o,l;if(s)for(l=0;l!=s.length;++l)a=s[l].match(nE),(i=a[1].indexOf(":"))===-1?r[a[1]]=a[2].slice(1,a[2].length-1):(a[1].slice(0,6)==="xmlns:"?o="xmlns"+a[1].slice(6):o=a[1].slice(i+1),r[o]=a[2].slice(1,a[2].length-1));return r}var Bh;function JH(e,t){var r=Bh[e]||Kn(e);return r==="General"?wu(t):Yo(r,t)}function ZH(e,t,r,s){var a=s;switch((r[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":a=ks(s);break;case"i2":case"int":a=parseInt(s,10);break;case"r4":case"float":a=parseFloat(s);break;case"date":case"dateTime.tz":a=As(s);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+r[0])}e[Kn(t)]=a}function eV(e,t,r){if(e.t!=="z"){if(!r||r.cellText!==!1)try{e.t==="e"?e.w=e.w||Fc[e.v]:t==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=up(e.v):e.w=wu(e.v):e.w=JH(t||"General",e.v)}catch(i){if(r.WTF)throw i}try{var s=Bh[t]||t||"General";if(r.cellNF&&(e.z=s),r.cellDates&&e.t=="n"&&j0(s)){var a=nu(e.v);a&&(e.t="d",e.v=new Date(a.y,a.m-1,a.d,a.H,a.M,a.S,a.u))}}catch(i){if(r.WTF)throw i}}}function tV(e,t,r){if(r.cellStyles&&t.Interior){var s=t.Interior;s.Pattern&&(s.patternType=hU[s.Pattern]||s.Pattern)}e[t.ID]=t}function rV(e,t,r,s,a,i,o,l,c,d){var u="General",h=s.StyleID,p={};d=d||{};var f=[],x=0;for(h===void 0&&l&&(h=l.StyleID),h===void 0&&o&&(h=o.StyleID);i[h]!==void 0&&(i[h].nf&&(u=i[h].nf),i[h].Interior&&f.push(i[h].Interior),!!i[h].Parent);)h=i[h].Parent;switch(r.Type){case"Boolean":s.t="b",s.v=ks(e);break;case"String":s.t="s",s.r=U_(Kn(e)),s.v=e.indexOf("<")>-1?Kn(t||e).replace(/<.*?>/g,""):s.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),s.v=(As(e)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),s.v!==s.v?s.v=Kn(e):s.v<60&&(s.v=s.v-1),(!u||u=="General")&&(u="yyyy-mm-dd");case"Number":s.v===void 0&&(s.v=+e),s.t||(s.t="n");break;case"Error":s.t="e",s.v=KA[e],d.cellText!==!1&&(s.w=e);break;default:e==""&&t==""?s.t="z":(s.t="s",s.v=U_(t||e));break}if(eV(s,u,d),d.cellFormula!==!1)if(s.Formula){var g=Kn(s.Formula);g.charCodeAt(0)==61&&(g=g.slice(1)),s.f=Gf(g,a),delete s.Formula,s.ArrayRange=="RC"?s.F=Gf("RC:RC",a):s.ArrayRange&&(s.F=Gf(s.ArrayRange,a),c.push([Jn(s.F),s.F]))}else for(x=0;x<c.length;++x)a.r>=c[x][0].s.r&&a.r<=c[x][0].e.r&&a.c>=c[x][0].s.c&&a.c<=c[x][0].e.c&&(s.F=c[x][1]);d.cellStyles&&(f.forEach(function(y){!p.patternType&&y.patternType&&(p.patternType=y.patternType)}),s.s=p),s.StyleID!==void 0&&(s.ixfe=s.StyleID)}function nV(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function Ey(e,t){var r=t||{};N0();var s=gh(mw(e));(r.type=="binary"||r.type=="array"||r.type=="base64")&&(s=hs(s));var a=s.slice(0,1024).toLowerCase(),i=!1;if(a=a.replace(/".*?"/g,""),(a.indexOf(">")&1023)>Math.min(a.indexOf(",")&1023,a.indexOf(";")&1023)){var o=Cs(r);return o.type="string",c0.to_workbook(s,o)}if(a.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function($e){a.indexOf("<"+$e)>=0&&(i=!0)}),i)return WV(s,r);Bh={"General Number":"General","General Date":vn[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":vn[15],"Short Date":vn[14],"Long Time":vn[19],"Medium Time":vn[18],"Short Time":vn[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:vn[2],Standard:vn[4],Percent:vn[10],Scientific:vn[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var l,c=[],d,u={},h=[],p=r.dense?[]:{},f="",x={},g={},y=sl('<Data ss:Type="String">'),m=0,w=0,S=0,k={s:{r:2e6,c:2e6},e:{r:0,c:0}},F={},L={},C="",O=0,T=[],W={},A={},N=0,P=[],K=[],re={},ge=[],Fe,R=!1,q=[],me=[],fe={},E=0,U=0,I={Sheets:[],WBProps:{date1904:!1}},M={};pp.lastIndex=0,s=s.replace(/<!--([\s\S]*?)-->/mg,"");for(var te="";l=pp.exec(s);)switch(l[3]=(te=l[3]).toLowerCase()){case"data":if(te=="data"){if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break}if(c[c.length-1][1])break;l[1]==="/"?rV(s.slice(m,l.index),C,y,c[c.length-1][0]=="comment"?re:x,{c:w,r:S},F,ge[w],g,q,r):(C="",y=sl(l[0]),m=l.index+l[0].length);break;case"cell":if(l[1]==="/")if(K.length>0&&(x.c=K),(!r.sheetRows||r.sheetRows>S)&&x.v!==void 0&&(r.dense?(p[S]||(p[S]=[]),p[S][w]=x):p[Os(w)+ua(S)]=x),x.HRef&&(x.l={Target:Kn(x.HRef)},x.HRefScreenTip&&(x.l.Tooltip=x.HRefScreenTip),delete x.HRef,delete x.HRefScreenTip),(x.MergeAcross||x.MergeDown)&&(E=w+(parseInt(x.MergeAcross,10)|0),U=S+(parseInt(x.MergeDown,10)|0),T.push({s:{c:w,r:S},e:{c:E,r:U}})),!r.sheetStubs)x.MergeAcross?w=E+1:++w;else if(x.MergeAcross||x.MergeDown){for(var Q=w;Q<=E;++Q)for(var G=S;G<=U;++G)(Q>w||G>S)&&(r.dense?(p[G]||(p[G]=[]),p[G][Q]={t:"z"}):p[Os(Q)+ua(G)]={t:"z"});w=E+1}else++w;else x=KH(l[0]),x.Index&&(w=+x.Index-1),w<k.s.c&&(k.s.c=w),w>k.e.c&&(k.e.c=w),l[0].slice(-2)==="/>"&&++w,K=[];break;case"row":l[1]==="/"||l[0].slice(-2)==="/>"?(S<k.s.r&&(k.s.r=S),S>k.e.r&&(k.e.r=S),l[0].slice(-2)==="/>"&&(g=sl(l[0]),g.Index&&(S=+g.Index-1)),w=0,++S):(g=sl(l[0]),g.Index&&(S=+g.Index-1),fe={},(g.AutoFitHeight=="0"||g.Height)&&(fe.hpx=parseInt(g.Height,10),fe.hpt=bp(fe.hpx),me[S]=fe),g.Hidden=="1"&&(fe.hidden=!0,me[S]=fe));break;case"worksheet":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));h.push(f),k.s.r<=k.e.r&&k.s.c<=k.e.c&&(p["!ref"]=Ln(k),r.sheetRows&&r.sheetRows<=k.e.r&&(p["!fullref"]=p["!ref"],k.e.r=r.sheetRows-1,p["!ref"]=Ln(k))),T.length&&(p["!merges"]=T),ge.length>0&&(p["!cols"]=ge),me.length>0&&(p["!rows"]=me),u[f]=p}else k={s:{r:2e6,c:2e6},e:{r:0,c:0}},S=w=0,c.push([l[3],!1]),d=sl(l[0]),f=Kn(d.Name),p=r.dense?[]:{},T=[],q=[],me=[],M={name:f,Hidden:0},I.Sheets.push(M);break;case"table":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else{if(l[0].slice(-2)=="/>")break;c.push([l[3],!1]),ge=[],R=!1}break;case"style":l[1]==="/"?tV(F,L,r):L=sl(l[0]);break;case"numberformat":L.nf=Kn(sl(l[0]).Format||"General"),Bh[L.nf]&&(L.nf=Bh[L.nf]);for(var ne=0;ne!=392&&vn[ne]!=L.nf;++ne);if(ne==392){for(ne=57;ne!=392;++ne)if(vn[ne]==null){yc(L.nf,ne);break}}break;case"column":if(c[c.length-1][0]!=="table")break;if(Fe=sl(l[0]),Fe.Hidden&&(Fe.hidden=!0,delete Fe.Hidden),Fe.Width&&(Fe.wpx=parseInt(Fe.Width,10)),!R&&Fe.wpx>10){R=!0,hi=LC;for(var z=0;z<ge.length;++z)ge[z]&&Nd(ge[z])}R&&Nd(Fe),ge[Fe.Index-1||ge.length]=Fe;for(var he=0;he<+Fe.Span;++he)ge[ge.length]=Cs(Fe);break;case"namedrange":if(l[1]==="/")break;I.Names||(I.Names=[]);var X=kn(l[0]),H={Name:X.Name,Ref:Gf(X.RefersTo.slice(1),{r:0,c:0})};I.Sheets.length>0&&(H.Sheet=I.Sheets.length-1),I.Names.push(H);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(l[0].slice(-2)==="/>")break;l[1]==="/"?C+=s.slice(O,l.index):O=l.index+l[0].length;break;case"interior":if(!r.cellStyles)break;L.Interior=sl(l[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(l[0].slice(-2)==="/>")break;l[1]==="/"?A9(W,te,s.slice(N,l.index)):N=l.index+l[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else c.push([l[3],!1]);break;case"comment":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));nV(re),K.push(re)}else c.push([l[3],!1]),d=sl(l[0]),re={a:d.Author};break;case"autofilter":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else if(l[0].charAt(l[0].length-2)!=="/"){var oe=sl(l[0]);p["!autofilter"]={ref:Gf(oe.Range).replace(/\$/g,"")},c.push([l[3],!0])}break;case"name":break;case"datavalidation":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"null":break;default:if(c.length==0&&l[3]=="document"||c.length==0&&l[3]=="uof")return Ck(s,r);var D=!0;switch(c[c.length-1][0]){case"officedocumentsettings":switch(l[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:D=!1}break;case"componentoptions":switch(l[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:D=!1}break;case"excelworkbook":switch(l[3]){case"date1904":I.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:D=!1}break;case"workbookoptions":switch(l[3]){case"owcversion":break;case"height":break;case"width":break;default:D=!1}break;case"worksheetoptions":switch(l[3]){case"visible":if(l[0].slice(-2)!=="/>")if(l[1]==="/")switch(s.slice(N,l.index)){case"SheetHidden":M.Hidden=1;break;case"SheetVeryHidden":M.Hidden=2;break}else N=l.index+l[0].length;break;case"header":p["!margins"]||uu(p["!margins"]={},"xlml"),isNaN(+kn(l[0]).Margin)||(p["!margins"].header=+kn(l[0]).Margin);break;case"footer":p["!margins"]||uu(p["!margins"]={},"xlml"),isNaN(+kn(l[0]).Margin)||(p["!margins"].footer=+kn(l[0]).Margin);break;case"pagemargins":var Y=kn(l[0]);p["!margins"]||uu(p["!margins"]={},"xlml"),isNaN(+Y.Top)||(p["!margins"].top=+Y.Top),isNaN(+Y.Left)||(p["!margins"].left=+Y.Left),isNaN(+Y.Right)||(p["!margins"].right=+Y.Right),isNaN(+Y.Bottom)||(p["!margins"].bottom=+Y.Bottom);break;case"displayrighttoleft":I.Views||(I.Views=[]),I.Views[0]||(I.Views[0]={}),I.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":p["!outline"]||(p["!outline"]={}),p["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":p["!outline"]||(p["!outline"]={}),p["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:D=!1}break;case"pivottable":case"pivotcache":switch(l[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:D=!1}break;case"pagebreaks":switch(l[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:D=!1}break;case"autofilter":switch(l[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:D=!1}break;case"querytable":switch(l[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:D=!1}break;case"datavalidation":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:D=!1}break;case"sorting":case"conditionalformatting":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:D=!1}break;case"mapinfo":case"schema":case"data":switch(l[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:D=!1}break;case"smarttags":break;default:D=!1;break}if(D||l[3].match(/!\[CDATA/))break;if(!c[c.length-1][1])throw"Unrecognized tag: "+l[3]+"|"+c.join("|");if(c[c.length-1][0]==="customdocumentproperties"){if(l[0].slice(-2)==="/>")break;l[1]==="/"?ZH(A,te,P,s.slice(N,l.index)):(P=l,N=l.index+l[0].length);break}if(r.WTF)throw"Unrecognized tag: "+l[3]+"|"+c.join("|")}var le={};return!r.bookSheets&&!r.bookProps&&(le.Sheets=u),le.SheetNames=h,le.Workbook=I,le.SSF=Cs(vn),le.Props=W,le.Custprops=A,le}function T2(e,t){switch(Dw(t=t||{}),t.type||"base64"){case"base64":return Ey(ko(e),t);case"binary":case"buffer":case"file":return Ey(e,t);case"array":return Ey(Rd(e),t)}}function sV(e,t){var r=[];return e.Props&&r.push(C9(e.Props,t)),e.Custprops&&r.push(E9(e.Props,e.Custprops)),r.join("")}function aV(){return""}function iV(e,t){var r=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach(function(s,a){var i=[];i.push(qr("NumberFormat",null,{"ss:Format":us(vn[s.numFmtId])}));var o={"ss:ID":"s"+(21+a)};r.push(qr("Style",i.join(""),o))}),qr("Styles",r.join(""))}function sE(e){return qr("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+Mw(e.Ref,{r:0,c:0})})}function oV(e){if(!((e||{}).Workbook||{}).Names)return"";for(var t=e.Workbook.Names,r=[],s=0;s<t.length;++s){var a=t[s];a.Sheet==null&&(a.Name.match(/^_xlfn\./)||r.push(sE(a)))}return qr("Names",r.join(""))}function lV(e,t,r,s){if(!e||!((s||{}).Workbook||{}).Names)return"";for(var a=s.Workbook.Names,i=[],o=0;o<a.length;++o){var l=a[o];l.Sheet==r&&(l.Name.match(/^_xlfn\./)||i.push(sE(l)))}return i.join("")}function cV(e,t,r,s){if(!e)return"";var a=[];if(e["!margins"]&&(a.push("<PageSetup>"),e["!margins"].header&&a.push(qr("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&a.push(qr("Footer",null,{"x:Margin":e["!margins"].footer})),a.push(qr("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),a.push("</PageSetup>")),s&&s.Workbook&&s.Workbook.Sheets&&s.Workbook.Sheets[r])if(s.Workbook.Sheets[r].Hidden)a.push(qr("Visible",s.Workbook.Sheets[r].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var i=0;i<r&&!(s.Workbook.Sheets[i]&&!s.Workbook.Sheets[i].Hidden);++i);i==r&&a.push("<Selected/>")}return((((s||{}).Workbook||{}).Views||[])[0]||{}).RTL&&a.push("<DisplayRightToLeft/>"),e["!protect"]&&(a.push(Za("ProtectContents","True")),e["!protect"].objects&&a.push(Za("ProtectObjects","True")),e["!protect"].scenarios&&a.push(Za("ProtectScenarios","True")),e["!protect"].selectLockedCells!=null&&!e["!protect"].selectLockedCells?a.push(Za("EnableSelection","NoSelection")):e["!protect"].selectUnlockedCells!=null&&!e["!protect"].selectUnlockedCells&&a.push(Za("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(o){e["!protect"][o[0]]&&a.push("<"+o[1]+"/>")})),a.length==0?"":qr("WorksheetOptions",a.join(""),{xmlns:mo.x})}function dV(e){return e.map(function(t){var r=LO(t.t||""),s=qr("ss:Data",r,{xmlns:"http://www.w3.org/TR/REC-html40"});return qr("Comment",s,{"ss:Author":t.a})}).join("")}function uV(e,t,r,s,a,i,o){if(!e||e.v==null&&e.f==null)return"";var l={};if(e.f&&(l["ss:Formula"]="="+us(Mw(e.f,o))),e.F&&e.F.slice(0,t.length)==t){var c=Is(e.F.slice(t.length+1));l["ss:ArrayRange"]="RC:R"+(c.r==o.r?"":"["+(c.r-o.r)+"]")+"C"+(c.c==o.c?"":"["+(c.c-o.c)+"]")}if(e.l&&e.l.Target&&(l["ss:HRef"]=us(e.l.Target),e.l.Tooltip&&(l["x:HRefScreenTip"]=us(e.l.Tooltip))),r["!merges"])for(var d=r["!merges"],u=0;u!=d.length;++u)d[u].s.c!=o.c||d[u].s.r!=o.r||(d[u].e.c>d[u].s.c&&(l["ss:MergeAcross"]=d[u].e.c-d[u].s.c),d[u].e.r>d[u].s.r&&(l["ss:MergeDown"]=d[u].e.r-d[u].s.r));var h="",p="";switch(e.t){case"z":if(!s.sheetStubs)return"";break;case"n":h="Number",p=String(e.v);break;case"b":h="Boolean",p=e.v?"1":"0";break;case"e":h="Error",p=Fc[e.v];break;case"d":h="DateTime",p=new Date(e.v).toISOString(),e.z==null&&(e.z=e.z||vn[14]);break;case"s":h="String",p=TO(e.v||"");break}var f=Pd(s.cellXfs,e,s);l["ss:StyleID"]="s"+(21+f),l["ss:Index"]=o.c+1;var x=e.v!=null?p:"",g=e.t=="z"?"":'<Data ss:Type="'+h+'">'+x+"</Data>";return(e.c||[]).length>0&&(g+=dV(e.c)),qr("Cell",g,l)}function fV(e,t){var r='<Row ss:Index="'+(e+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=d0(t.hpt)),t.hpx&&(r+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(r+=' ss:Hidden="1"')),r+">"}function hV(e,t,r,s){if(!e["!ref"])return"";var a=Jn(e["!ref"]),i=e["!merges"]||[],o=0,l=[];e["!cols"]&&e["!cols"].forEach(function(y,m){Nd(y);var w=!!y.width,S=bg(m,y),k={"ss:Index":m+1};w&&(k["ss:Width"]=gp(S.width)),y.hidden&&(k["ss:Hidden"]="1"),l.push(qr("Column",null,k))});for(var c=Array.isArray(e),d=a.s.r;d<=a.e.r;++d){for(var u=[fV(d,(e["!rows"]||[])[d])],h=a.s.c;h<=a.e.c;++h){var p=!1;for(o=0;o!=i.length;++o)if(!(i[o].s.c>h)&&!(i[o].s.r>d)&&!(i[o].e.c<h)&&!(i[o].e.r<d)){(i[o].s.c!=h||i[o].s.r!=d)&&(p=!0);break}if(!p){var f={r:d,c:h},x=Sn(f),g=c?(e[d]||[])[h]:e[x];u.push(uV(g,x,e,t,r,s,f))}}u.push("</Row>"),u.length>2&&l.push(u.join(""))}return l.join("")}function pV(e,t,r){var s=[],a=r.SheetNames[e],i=r.Sheets[a],o=i?lV(i,t,e,r):"";return o.length>0&&s.push("<Names>"+o+"</Names>"),o=i?hV(i,t,e,r):"",o.length>0&&s.push("<Table>"+o+"</Table>"),s.push(cV(i,t,e,r)),s.join("")}function mV(e,t){t||(t={}),e.SSF||(e.SSF=Cs(vn)),e.SSF&&(N0(),fg(e.SSF),t.revssf=pg(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF,t.cellXfs=[],Pd(t.cellXfs,{},{revssf:{General:0}}));var r=[];r.push(sV(e,t)),r.push(aV()),r.push(""),r.push("");for(var s=0;s<e.SheetNames.length;++s)r.push(qr("Worksheet",pV(s,t,e),{"ss:Name":us(e.SheetNames[s])}));return r[2]=iV(e,t),r[3]=oV(e),fa+qr("Workbook",r.join(""),{xmlns:mo.ss,"xmlns:o":mo.o,"xmlns:x":mo.x,"xmlns:ss":mo.ss,"xmlns:dt":mo.dt,"xmlns:html":mo.html})}function xV(e){var t={},r=e.content;if(r.l=28,t.AnsiUserType=r.read_shift(0,"lpstr-ansi"),t.AnsiClipboardFormat=o9(r),r.length-r.l<=4)return t;var s=r.read_shift(4);if(s==0||s>40||(r.l-=4,t.Reserved1=r.read_shift(0,"lpstr-ansi"),r.length-r.l<=4)||(s=r.read_shift(4),s!==1907505652)||(t.UnicodeClipboardFormat=l9(r),s=r.read_shift(4),s==0||s>40))return t;r.l-=4,t.Reserved2=r.read_shift(0,"lpwstr")}var gV=[60,1084,2066,2165,2175];function yV(e,t,r,s,a){var i=s,o=[],l=r.slice(r.l,r.l+i);if(a&&a.enc&&a.enc.insitu&&l.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:a.enc.insitu(l)}o.push(l),r.l+=i;for(var c=mc(r,r.l),d=L2[c],u=0;d!=null&&gV.indexOf(c)>-1;)i=mc(r,r.l+2),u=r.l+4,c==2066?u+=4:(c==2165||c==2175)&&(u+=12),l=r.slice(u,r.l+4+i),o.push(l),r.l+=4+i,d=L2[c=mc(r,r.l)];var h=Ia(o);Ja(h,0);var p=0;h.lens=[];for(var f=0;f<o.length;++f)h.lens.push(p),p+=o[f].length;if(h.length<s)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+h.length+" < "+s;return t.f(h,h.length,a)}function Fl(e,t,r){if(e.t!=="z"&&e.XF){var s=0;try{s=e.z||e.XF.numFmtId||0,t.cellNF&&(e.z=vn[s])}catch(i){if(t.WTF)throw i}if(!t||t.cellText!==!1)try{e.t==="e"?e.w=e.w||Fc[e.v]:s===0||s=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=up(e.v):e.w=wu(e.v):e.w=Yo(s,e.v,{date1904:!!r,dateNF:t&&t.dateNF})}catch(i){if(t.WTF)throw i}if(t.cellDates&&s&&e.t=="n"&&j0(vn[s]||String(s))){var a=nu(e.v);a&&(e.t="d",e.v=new Date(a.y,a.m-1,a.d,a.H,a.M,a.S,a.u))}}}function $m(e,t,r){return{v:e,ixfe:t,t:r}}function bV(e,t){var r={opts:{}},s={},a=t.dense?[]:{},i={},o={},l=null,c=[],d="",u={},h,p="",f,x,g,y,m={},w=[],S,k,F=[],L=[],C={Sheets:[],WBProps:{date1904:!1},Views:[{}]},O={},T=function(we){return we<8?lu[we]:we<64&&L[we-8]||lu[we]},W=function(we,Me,Wt){var Ct=Me.XF.data;if(!(!Ct||!Ct.patternType||!Wt||!Wt.cellStyles)){Me.s={},Me.s.patternType=Ct.patternType;var pr;(pr=xp(T(Ct.icvFore)))&&(Me.s.fgColor={rgb:pr}),(pr=xp(T(Ct.icvBack)))&&(Me.s.bgColor={rgb:pr})}},A=function(we,Me,Wt){if(!(fe>1)&&!(Wt.sheetRows&&we.r>=Wt.sheetRows)){if(Wt.cellStyles&&Me.XF&&Me.XF.data&&W(we,Me,Wt),delete Me.ixfe,delete Me.XF,h=we,p=Sn(we),(!o||!o.s||!o.e)&&(o={s:{r:0,c:0},e:{r:0,c:0}}),we.r<o.s.r&&(o.s.r=we.r),we.c<o.s.c&&(o.s.c=we.c),we.r+1>o.e.r&&(o.e.r=we.r+1),we.c+1>o.e.c&&(o.e.c=we.c+1),Wt.cellFormula&&Me.f){for(var Ct=0;Ct<w.length;++Ct)if(!(w[Ct][0].s.c>we.c||w[Ct][0].s.r>we.r)&&!(w[Ct][0].e.c<we.c||w[Ct][0].e.r<we.r)){Me.F=Ln(w[Ct][0]),(w[Ct][0].s.c!=we.c||w[Ct][0].s.r!=we.r)&&delete Me.f,Me.f&&(Me.f=""+ui(w[Ct][1],o,we,q,N));break}}Wt.dense?(a[we.r]||(a[we.r]=[]),a[we.r][we.c]=Me):a[p]=Me}},N={enc:!1,sbcch:0,snames:[],sharedf:m,arrayf:w,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!t&&!!t.cellStyles,WTF:!!t&&!!t.wtf};t.password&&(N.password=t.password);var P,K=[],re=[],ge=[],Fe=[],R=!1,q=[];q.SheetNames=N.snames,q.sharedf=N.sharedf,q.arrayf=N.arrayf,q.names=[],q.XTI=[];var me=0,fe=0,E=0,U=[],I=[],M;N.codepage=1200,ul(1200);for(var te=!1;e.l<e.length-1;){var Q=e.l,G=e.read_shift(2);if(G===0&&me===10)break;var ne=e.l===e.length?0:e.read_shift(2),z=L2[G];if(z&&z.f){if(t.bookSheets&&me===133&&G!==133)break;if(me=G,z.r===2||z.r==12){var he=e.read_shift(2);if(ne-=2,!N.enc&&he!==G&&((he&255)<<8|he>>8)!==G)throw new Error("rt mismatch: "+he+"!="+G);z.r==12&&(e.l+=10,ne-=10)}var X={};if(G===10?X=z.f(e,ne,N):X=yV(G,z,e,ne,N),fe==0&&[9,521,1033,2057].indexOf(me)===-1)continue;switch(G){case 34:r.opts.Date1904=C.WBProps.date1904=X;break;case 134:r.opts.WriteProtect=!0;break;case 47:if(N.enc||(e.l=0),N.enc=X,!t.password)throw new Error("File is password-protected");if(X.valid==null)throw new Error("Encryption scheme unsupported");if(!X.valid)throw new Error("Password is incorrect");break;case 92:N.lastuser=X;break;case 66:var H=Number(X);switch(H){case 21010:H=1200;break;case 32768:H=1e4;break;case 32769:H=1252;break}ul(N.codepage=H),te=!0;break;case 317:N.rrtabid=X;break;case 25:N.winlocked=X;break;case 439:r.opts.RefreshAll=X;break;case 12:r.opts.CalcCount=X;break;case 16:r.opts.CalcDelta=X;break;case 17:r.opts.CalcIter=X;break;case 13:r.opts.CalcMode=X;break;case 14:r.opts.CalcPrecision=X;break;case 95:r.opts.CalcSaveRecalc=X;break;case 15:N.CalcRefMode=X;break;case 2211:r.opts.FullCalc=X;break;case 129:X.fDialog&&(a["!type"]="dialog"),X.fBelow||((a["!outline"]||(a["!outline"]={})).above=!0),X.fRight||((a["!outline"]||(a["!outline"]={})).left=!0);break;case 224:F.push(X);break;case 430:q.push([X]),q[q.length-1].XTI=[];break;case 35:case 547:q[q.length-1].push(X);break;case 24:case 536:M={Name:X.Name,Ref:ui(X.rgce,o,null,q,N)},X.itab>0&&(M.Sheet=X.itab-1),q.names.push(M),q[0]||(q[0]=[],q[0].XTI=[]),q[q.length-1].push(X),X.Name=="_xlnm._FilterDatabase"&&X.itab>0&&X.rgce&&X.rgce[0]&&X.rgce[0][0]&&X.rgce[0][0][0]=="PtgArea3d"&&(I[X.itab-1]={ref:Ln(X.rgce[0][0][1][2])});break;case 22:N.ExternCount=X;break;case 23:q.length==0&&(q[0]=[],q[0].XTI=[]),q[q.length-1].XTI=q[q.length-1].XTI.concat(X),q.XTI=q.XTI.concat(X);break;case 2196:if(N.biff<8)break;M!=null&&(M.Comment=X[1]);break;case 18:a["!protect"]=X;break;case 19:X!==0&&N.WTF&&console.error("Password verifier: "+X);break;case 133:i[X.pos]=X,N.snames.push(X.name);break;case 10:{if(--fe)break;if(o.e){if(o.e.r>0&&o.e.c>0){if(o.e.r--,o.e.c--,a["!ref"]=Ln(o),t.sheetRows&&t.sheetRows<=o.e.r){var oe=o.e.r;o.e.r=t.sheetRows-1,a["!fullref"]=a["!ref"],a["!ref"]=Ln(o),o.e.r=oe}o.e.r++,o.e.c++}K.length>0&&(a["!merges"]=K),re.length>0&&(a["!objects"]=re),ge.length>0&&(a["!cols"]=ge),Fe.length>0&&(a["!rows"]=Fe),C.Sheets.push(O)}d===""?u=a:s[d]=a,a=t.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(N.biff===8&&(N.biff={9:2,521:3,1033:4}[G]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[X.BIFFVer]||8),N.biffguess=X.BIFFVer==0,X.BIFFVer==0&&X.dt==4096&&(N.biff=5,te=!0,ul(N.codepage=28591)),N.biff==8&&X.BIFFVer==0&&X.dt==16&&(N.biff=2),fe++)break;if(a=t.dense?[]:{},N.biff<8&&!te&&(te=!0,ul(N.codepage=t.codepage||1252)),N.biff<5||X.BIFFVer==0&&X.dt==4096){d===""&&(d="Sheet1"),o={s:{r:0,c:0},e:{r:0,c:0}};var D={pos:e.l-ne,name:d};i[D.pos]=D,N.snames.push(d)}else d=(i[Q]||{name:""}).name;X.dt==32&&(a["!type"]="chart"),X.dt==64&&(a["!type"]="macro"),K=[],re=[],N.arrayf=w=[],ge=[],Fe=[],R=!1,O={Hidden:(i[Q]||{hs:0}).hs,name:d}}break;case 515:case 3:case 2:a["!type"]=="chart"&&(t.dense?(a[X.r]||[])[X.c]:a[Sn({c:X.c,r:X.r})])&&++X.c,S={ixfe:X.ixfe,XF:F[X.ixfe]||{},v:X.val,t:"n"},E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:X.c,r:X.r},S,t);break;case 5:case 517:S={ixfe:X.ixfe,XF:F[X.ixfe],v:X.val,t:X.t},E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:X.c,r:X.r},S,t);break;case 638:S={ixfe:X.ixfe,XF:F[X.ixfe],v:X.rknum,t:"n"},E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:X.c,r:X.r},S,t);break;case 189:for(var Y=X.c;Y<=X.C;++Y){var le=X.rkrec[Y-X.c][0];S={ixfe:le,XF:F[le],v:X.rkrec[Y-X.c][1],t:"n"},E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:Y,r:X.r},S,t)}break;case 6:case 518:case 1030:{if(X.val=="String"){l=X;break}if(S=$m(X.val,X.cell.ixfe,X.tt),S.XF=F[S.ixfe],t.cellFormula){var $e=X.formula;if($e&&$e[0]&&$e[0][0]&&$e[0][0][0]=="PtgExp"){var je=$e[0][0][1][0],We=$e[0][0][1][1],Ee=Sn({r:je,c:We});m[Ee]?S.f=""+ui(X.formula,o,X.cell,q,N):S.F=((t.dense?(a[je]||[])[We]:a[Ee])||{}).F}else S.f=""+ui(X.formula,o,X.cell,q,N)}E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A(X.cell,S,t),l=X}break;case 7:case 519:if(l)l.val=X,S=$m(X,l.cell.ixfe,"s"),S.XF=F[S.ixfe],t.cellFormula&&(S.f=""+ui(l.formula,o,l.cell,q,N)),E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A(l.cell,S,t),l=null;else throw new Error("String record expects Formula");break;case 33:case 545:{w.push(X);var Re=Sn(X[0].s);if(f=t.dense?(a[X[0].s.r]||[])[X[0].s.c]:a[Re],t.cellFormula&&f){if(!l||!Re||!f)break;f.f=""+ui(X[1],o,X[0],q,N),f.F=Ln(X[0])}}break;case 1212:{if(!t.cellFormula)break;if(p){if(!l)break;m[Sn(l.cell)]=X[0],f=t.dense?(a[l.cell.r]||[])[l.cell.c]:a[Sn(l.cell)],(f||{}).f=""+ui(X[0],o,h,q,N)}}break;case 253:S=$m(c[X.isst].t,X.ixfe,"s"),c[X.isst].h&&(S.h=c[X.isst].h),S.XF=F[S.ixfe],E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:X.c,r:X.r},S,t);break;case 513:t.sheetStubs&&(S={ixfe:X.ixfe,XF:F[X.ixfe],t:"z"},E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:X.c,r:X.r},S,t));break;case 190:if(t.sheetStubs)for(var Ve=X.c;Ve<=X.C;++Ve){var St=X.ixfe[Ve-X.c];S={ixfe:St,XF:F[St],t:"z"},E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:Ve,r:X.r},S,t)}break;case 214:case 516:case 4:S=$m(X.val,X.ixfe,"s"),S.XF=F[S.ixfe],E>0&&(S.z=U[S.ixfe>>8&63]),Fl(S,t,r.opts.Date1904),A({c:X.c,r:X.r},S,t);break;case 0:case 512:fe===1&&(o=X);break;case 252:c=X;break;case 1054:if(N.biff==4){U[E++]=X[1];for(var rt=0;rt<E+163&&vn[rt]!=X[1];++rt);rt>=163&&yc(X[1],E+163)}else yc(X[1],X[0]);break;case 30:{U[E++]=X;for(var ze=0;ze<E+163&&vn[ze]!=X;++ze);ze>=163&&yc(X,E+163)}break;case 229:K=K.concat(X);break;case 93:re[X.cmo[0]]=N.lastobj=X;break;case 438:N.lastobj.TxO=X;break;case 127:N.lastobj.ImData=X;break;case 440:for(y=X[0].s.r;y<=X[0].e.r;++y)for(g=X[0].s.c;g<=X[0].e.c;++g)f=t.dense?(a[y]||[])[g]:a[Sn({c:g,r:y})],f&&(f.l=X[1]);break;case 2048:for(y=X[0].s.r;y<=X[0].e.r;++y)for(g=X[0].s.c;g<=X[0].e.c;++g)f=t.dense?(a[y]||[])[g]:a[Sn({c:g,r:y})],f&&f.l&&(f.l.Tooltip=X[1]);break;case 28:{if(N.biff<=5&&N.biff>=2)break;f=t.dense?(a[X[0].r]||[])[X[0].c]:a[Sn(X[0])];var Ie=re[X[2]];f||(t.dense?(a[X[0].r]||(a[X[0].r]=[]),f=a[X[0].r][X[0].c]={t:"z"}):f=a[Sn(X[0])]={t:"z"},o.e.r=Math.max(o.e.r,X[0].r),o.s.r=Math.min(o.s.r,X[0].r),o.e.c=Math.max(o.e.c,X[0].c),o.s.c=Math.min(o.s.c,X[0].c)),f.c||(f.c=[]),x={a:X[1],t:Ie.TxO.t},f.c.push(x)}break;case 2173:i$(F[X.ixfe],X.ext);break;case 125:{if(!N.cellStyles)break;for(;X.e>=X.s;)ge[X.e--]={width:X.w/256,level:X.level||0,hidden:!!(X.flags&1)},R||(R=!0,Tw(X.w/256)),Nd(ge[X.e+1])}break;case 520:{var ot={};X.level!=null&&(Fe[X.r]=ot,ot.level=X.level),X.hidden&&(Fe[X.r]=ot,ot.hidden=!0),X.hpt&&(Fe[X.r]=ot,ot.hpt=X.hpt,ot.hpx=d0(X.hpt))}break;case 38:case 39:case 40:case 41:a["!margins"]||uu(a["!margins"]={}),a["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[G]]=X;break;case 161:a["!margins"]||uu(a["!margins"]={}),a["!margins"].header=X.header,a["!margins"].footer=X.footer;break;case 574:X.RTL&&(C.Views[0].RTL=!0);break;case 146:L=X;break;case 2198:P=X;break;case 140:k=X;break;case 442:d?O.CodeName=X||O.name:C.WBProps.CodeName=X||"ThisWorkbook";break}}else z||console.error("Missing Info for XLS Record 0x"+G.toString(16)),e.l+=ne}return r.SheetNames=Ys(i).sort(function(be,we){return Number(be)-Number(we)}).map(function(be){return i[be].name}),t.bookSheets||(r.Sheets=s),!r.SheetNames.length&&u["!ref"]?(r.SheetNames.push("Sheet1"),r.Sheets&&(r.Sheets.Sheet1=u)):r.Preamble=u,r.Sheets&&I.forEach(function(be,we){r.Sheets[r.SheetNames[we]]["!autofilter"]=be}),r.Strings=c,r.SSF=Cs(vn),N.enc&&(r.Encryption=N.enc),P&&(r.Themes=P),r.Metadata={},k!==void 0&&(r.Metadata.Country=k),q.names.length>0&&(C.Names=q.names),r.Workbook=C,r}var Ph={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function vV(e,t,r){var s=mn.find(e,"/!DocumentSummaryInformation");if(s&&s.size>0)try{var a=sk(s,k2,Ph.DSI);for(var i in a)t[i]=a[i]}catch(d){if(r.WTF)throw d}var o=mn.find(e,"/!SummaryInformation");if(o&&o.size>0)try{var l=sk(o,j2,Ph.SI);for(var c in l)t[c]==null&&(t[c]=l[c])}catch(d){if(r.WTF)throw d}t.HeadingPairs&&t.TitlesOfParts&&(nC(t.HeadingPairs,t.TitlesOfParts,t,r),delete t.HeadingPairs,delete t.TitlesOfParts)}function wV(e,t){var r=[],s=[],a=[],i=0,o,l=R_(k2,"n"),c=R_(j2,"n");if(e.Props)for(o=Ys(e.Props),i=0;i<o.length;++i)(Object.prototype.hasOwnProperty.call(l,o[i])?r:Object.prototype.hasOwnProperty.call(c,o[i])?s:a).push([o[i],e.Props[o[i]]]);if(e.Custprops)for(o=Ys(e.Custprops),i=0;i<o.length;++i)Object.prototype.hasOwnProperty.call(e.Props||{},o[i])||(Object.prototype.hasOwnProperty.call(l,o[i])?r:Object.prototype.hasOwnProperty.call(c,o[i])?s:a).push([o[i],e.Custprops[o[i]]]);var d=[];for(i=0;i<a.length;++i)dC.indexOf(a[i][0])>-1||rC.indexOf(a[i][0])>-1||a[i][1]!=null&&d.push(a[i]);s.length&&mn.utils.cfb_add(t,"/SummaryInformation",ak(s,Ph.SI,c,j2)),(r.length||d.length)&&mn.utils.cfb_add(t,"/DocumentSummaryInformation",ak(r,Ph.DSI,l,k2,d.length?d:null,Ph.UDI))}function aE(e,t){t||(t={}),Dw(t),iw(),t.codepage&&aw(t.codepage);var r,s;if(e.FullPaths){if(mn.find(e,"/encryption"))throw new Error("File is password-protected");r=mn.find(e,"!CompObj"),s=mn.find(e,"/Workbook")||mn.find(e,"/Book")}else{switch(t.type){case"base64":e=go(ko(e));break;case"binary":e=go(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}Ja(e,0),s={content:e}}var a,i;if(r&&xV(r),t.bookProps&&!t.bookSheets)a={};else{var o=Un?"buffer":"array";if(s&&s.content)a=bV(s.content,t);else if((i=mn.find(e,"PerfectOffice_MAIN"))&&i.content)a=du.to_workbook(i.content,(t.type=o,t));else if((i=mn.find(e,"NativeContent_MAIN"))&&i.content)a=du.to_workbook(i.content,(t.type=o,t));else throw(i=mn.find(e,"MN0"))&&i.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");t.bookVBA&&e.FullPaths&&mn.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(a.vbaraw=R$(e))}var l={};return e.FullPaths&&vV(e,l,t),a.Props=a.Custprops=l,t.bookFiles&&(a.cfb=e),a}function SV(e,t){var r=t||{},s=mn.utils.cfb_new({root:"R"}),a="/Workbook";switch(r.bookType||"xls"){case"xls":r.bookType="biff8";case"xla":r.bookType||(r.bookType="xla");case"biff8":a="/Workbook",r.biff=8;break;case"biff5":a="/Book",r.biff=5;break;default:throw new Error("invalid type "+r.bookType+" for XLS CFB")}return mn.utils.cfb_add(s,a,iE(e,r)),r.biff==8&&(e.Props||e.Custprops)&&wV(e,s),r.biff==8&&e.vbaraw&&B$(s,mn.read(e.vbaraw,{type:typeof e.vbaraw=="string"?"binary":"buffer"})),s}var vp={0:{f:Vz},1:{f:eq},2:{f:bq},3:{f:lq},4:{f:sq},5:{f:xq},6:{f:kq},7:{f:fq},8:{f:Lq},9:{f:Tq},10:{f:Cq},11:{f:Eq},12:{f:rq},13:{f:wq},14:{f:dq},15:{f:iq},16:{f:KC},17:{f:Nq},18:{f:pq},19:{f:vw},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:NH},40:{},42:{},43:{f:kU},44:{f:SU},45:{f:AU},46:{f:EU},47:{f:CU},48:{},49:{f:XO},50:{},51:{f:c$},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:wC},62:{f:_q},63:{f:y$},64:{f:Gq},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:vi,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:zq},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:Jz},148:{f:Xz,p:16},151:{f:Oq},152:{},153:{f:_H},154:{},155:{},156:{f:wH},157:{},158:{},159:{T:1,f:DD},160:{T:-1},161:{T:1,f:Uu},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:Fq},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:o$},336:{T:-1},337:{f:f$,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:_2},357:{},358:{},359:{},360:{T:1},361:{},362:{f:vC},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:Iq},427:{f:Dq},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:$q},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:Kz},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:Bq},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:_2},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:E$},633:{T:1},634:{T:-1},635:{T:1,f:A$},636:{T:-1},637:{f:ZO},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:dH},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:Qq},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},L2={6:{f:Ay},10:{f:Gc},12:{f:ya},13:{f:ya},14:{f:na},15:{f:na},16:{f:xi},17:{f:na},18:{f:na},19:{f:ya},20:{f:uk},21:{f:uk},23:{f:vC},24:{f:hk},25:{f:na},26:{},27:{},28:{f:QI},29:{},34:{f:na},35:{f:fk},38:{f:xi},39:{f:xi},40:{f:xi},41:{f:xi},42:{f:na},43:{f:na},47:{f:iU},49:{f:wI},51:{f:ya},60:{},61:{f:xI},64:{f:na},65:{f:vI},66:{f:ya},77:{},80:{},81:{},82:{},85:{f:ya},89:{},90:{},91:{},92:{f:aI},93:{f:KI},94:{},95:{f:na},96:{},97:{},99:{f:na},125:{f:wC},128:{f:PI},129:{f:oI},130:{f:ya},131:{f:na},132:{f:na},133:{f:lI},134:{},140:{f:aD},141:{f:ya},144:{},146:{f:lD},151:{},152:{},153:{},154:{},155:{},156:{f:ya},157:{},158:{},160:{f:mD},161:{f:uD},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:FI},190:{f:MI},193:{f:Gc},197:{},198:{},199:{},200:{},201:{},202:{f:na},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:ya},220:{},221:{f:na},222:{},224:{f:BI},225:{f:sI},226:{f:Gc},227:{},229:{f:XI},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:dI},253:{f:_I},255:{f:fI},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:uC},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:na},353:{f:Gc},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:$I},431:{f:na},432:{},433:{},434:{},437:{},438:{f:eD},439:{f:na},440:{f:tD},441:{},442:{f:Wp},443:{},444:{f:ya},445:{},446:{},448:{f:Gc},449:{f:mI,r:2},450:{f:Gc},512:{f:lk},513:{f:pD},515:{f:DI},516:{f:jI},517:{f:dk},519:{f:xD},520:{f:hI},523:{},545:{f:pk},549:{f:ok},566:{},574:{f:yI},638:{f:LI},659:{},1048:{},1054:{f:AI},1084:{},1212:{f:HI},2048:{f:nD},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:Im},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:Gc},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:cD,r:12},2173:{f:a$,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:na,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:qI,r:12},2197:{},2198:{f:ZU,r:12},2199:{},2200:{},2201:{},2202:{f:VI,r:12},2203:{f:Gc},2204:{},2205:{},2206:{},2207:{},2211:{f:pI},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:ya},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:fD},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:oD},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:lk},1:{},2:{f:wD},3:{f:bD},4:{f:yD},5:{f:dk},7:{f:_D},8:{},9:{f:Im},11:{},22:{f:ya},30:{f:EI},31:{},32:{},33:{f:pk},36:{},37:{f:ok},50:{f:kD},62:{},52:{},67:{},68:{f:ya},69:{},86:{},126:{},127:{f:gD},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:jD},223:{},234:{},354:{},421:{},518:{f:Ay},521:{f:Im},536:{f:hk},547:{f:fk},561:{},579:{},1030:{f:Ay},1033:{f:Im},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function Hr(e,t,r,s){var a=t;if(!isNaN(a)){var i=s||(r||[]).length||0,o=e.next(4);o.write_shift(2,a),o.write_shift(2,i),i>0&&gw(r)&&e.push(r)}}function _V(e,t,r,s){var a=(r||[]).length||0;if(a<=8224)return Hr(e,t,r,a);var i=t;if(!isNaN(i)){for(var o=r.parts||[],l=0,c=0,d=0;d+(o[l]||8224)<=8224;)d+=o[l]||8224,l++;var u=e.next(4);for(u.write_shift(2,i),u.write_shift(2,d),e.push(r.slice(c,c+d)),c+=d;c<a;){for(u=e.next(4),u.write_shift(2,60),d=0;d+(o[l]||8224)<=8224;)d+=o[l]||8224,l++;u.write_shift(2,d),e.push(r.slice(c,c+d)),c+=d}}}function Vp(e,t,r){return e||(e=xr(7)),e.write_shift(2,t),e.write_shift(2,r),e.write_shift(2,0),e.write_shift(1,0),e}function kV(e,t,r,s){var a=xr(9);return Vp(a,e,t),fC(r,s||"b",a),a}function jV(e,t,r){var s=xr(8+2*r.length);return Vp(s,e,t),s.write_shift(1,r.length),s.write_shift(r.length,r,"sbcs"),s.l<s.length?s.slice(0,s.l):s}function NV(e,t,r,s){if(t.v!=null)switch(t.t){case"d":case"n":var a=t.t=="d"?La(As(t.v)):t.v;a==(a|0)&&a>=0&&a<65536?Hr(e,2,SD(r,s,a)):Hr(e,3,vD(r,s,a));return;case"b":case"e":Hr(e,5,kV(r,s,t.v,t.t));return;case"s":case"str":Hr(e,4,jV(r,s,(t.v||"").slice(0,255)));return}Hr(e,1,Vp(null,r,s))}function AV(e,t,r,s){var a=Array.isArray(t),i=Jn(t["!ref"]||"A1"),o,l="",c=[];if(i.e.c>255||i.e.r>16383){if(s.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");i.e.c=Math.min(i.e.c,255),i.e.r=Math.min(i.e.c,16383),o=Ln(i)}for(var d=i.s.r;d<=i.e.r;++d){l=ua(d);for(var u=i.s.c;u<=i.e.c;++u){d===i.s.r&&(c[u]=Os(u)),o=c[u]+l;var h=a?(t[d]||[])[u]:t[o];h&&NV(e,h,d,u)}}}function CV(e,t){for(var r=t||{},s=Xi(),a=0,i=0;i<e.SheetNames.length;++i)e.SheetNames[i]==r.sheet&&(a=i);if(a==0&&r.sheet&&e.SheetNames[0]!=r.sheet)throw new Error("Sheet not found: "+r.sheet);return Hr(s,r.biff==4?1033:r.biff==3?521:9,Aw(e,16,r)),AV(s,e.Sheets[e.SheetNames[a]],a,r),Hr(s,10),s.end()}function EV(e,t,r){Hr(e,49,SI({sz:12,name:"Arial"},r))}function TV(e,t,r){t&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)t[a]!=null&&Hr(e,1054,CI(a,t[a],r))})}function LV(e,t){var r=xr(19);r.write_shift(4,2151),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,1),r.write_shift(4,0),Hr(e,2151,r),r=xr(39),r.write_shift(4,2152),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(2,1),r.write_shift(4,4),r.write_shift(2,0),gC(Jn(t["!ref"]||"A1"),r),r.write_shift(4,4),Hr(e,2152,r)}function FV(e,t){for(var r=0;r<16;++r)Hr(e,224,ck({numFmtId:0,style:!0},0,t));t.cellXfs.forEach(function(s){Hr(e,224,ck(s,0,t))})}function MV(e,t){for(var r=0;r<t["!links"].length;++r){var s=t["!links"][r];Hr(e,440,rD(s)),s[1].Tooltip&&Hr(e,2048,sD(s))}delete t["!links"]}function RV(e,t){if(t){var r=0;t.forEach(function(s,a){++r<=256&&s&&Hr(e,125,dD(bg(a,s),a))})}}function BV(e,t,r,s,a){var i=16+Pd(a.cellXfs,t,a);if(t.v==null&&!t.bf){Hr(e,513,ju(r,s,i));return}if(t.bf)Hr(e,6,oz(t,r,s,a,i));else switch(t.t){case"d":case"n":var o=t.t=="d"?La(As(t.v)):t.v;Hr(e,515,UI(r,s,o,i));break;case"b":case"e":Hr(e,517,II(r,s,t.v,i,a,t.t));break;case"s":case"str":if(a.bookSST){var l=Bw(a.Strings,t.v,a.revStrings);Hr(e,253,kI(r,s,l,i))}else Hr(e,516,NI(r,s,(t.v||"").slice(0,255),i,a));break;default:Hr(e,513,ju(r,s,i))}}function PV(e,t,r){var s=Xi(),a=r.SheetNames[e],i=r.Sheets[a]||{},o=(r||{}).Workbook||{},l=(o.Sheets||[])[e]||{},c=Array.isArray(i),d=t.biff==8,u,h="",p=[],f=Jn(i["!ref"]||"A1"),x=d?65536:16384;if(f.e.c>255||f.e.r>=x){if(t.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:IV16384");f.e.c=Math.min(f.e.c,255),f.e.r=Math.min(f.e.c,x-1)}Hr(s,2057,Aw(r,16,t)),Hr(s,13,Uo(1)),Hr(s,12,Uo(100)),Hr(s,15,Ei(!0)),Hr(s,17,Ei(!1)),Hr(s,16,_u(.001)),Hr(s,95,Ei(!0)),Hr(s,42,Ei(!1)),Hr(s,43,Ei(!1)),Hr(s,130,Uo(1)),Hr(s,128,OI()),Hr(s,131,Ei(!1)),Hr(s,132,Ei(!1)),d&&RV(s,i["!cols"]),Hr(s,512,TI(f,t)),d&&(i["!links"]=[]);for(var g=f.s.r;g<=f.e.r;++g){h=ua(g);for(var y=f.s.c;y<=f.e.c;++y){g===f.s.r&&(p[y]=Os(y)),u=p[y]+h;var m=c?(i[g]||[])[y]:i[u];m&&(BV(s,m,g,y,t),d&&m.l&&i["!links"].push([u,m.l]))}}var w=l.CodeName||l.name||a;return d&&Hr(s,574,bI((o.Views||[])[0])),d&&(i["!merges"]||[]).length&&Hr(s,229,YI(i["!merges"])),d&&MV(s,i),Hr(s,442,hC(w)),d&&LV(s,i),Hr(s,10),s.end()}function OV(e,t,r){var s=Xi(),a=(e||{}).Workbook||{},i=a.Sheets||[],o=a.WBProps||{},l=r.biff==8,c=r.biff==5;if(Hr(s,2057,Aw(e,5,r)),r.bookType=="xla"&&Hr(s,135),Hr(s,225,l?Uo(1200):null),Hr(s,193,I9(2)),c&&Hr(s,191),c&&Hr(s,192),Hr(s,226),Hr(s,92,iI("SheetJS",r)),Hr(s,66,Uo(l?1200:1252)),l&&Hr(s,353,Uo(0)),l&&Hr(s,448),Hr(s,317,hD(e.SheetNames.length)),l&&e.vbaraw&&Hr(s,211),l&&e.vbaraw){var d=o.CodeName||"ThisWorkbook";Hr(s,442,hC(d))}Hr(s,156,Uo(17)),Hr(s,25,Ei(!1)),Hr(s,18,Ei(!1)),Hr(s,19,Uo(0)),l&&Hr(s,431,Ei(!1)),l&&Hr(s,444,Uo(0)),Hr(s,61,gI()),Hr(s,64,Ei(!1)),Hr(s,141,Uo(0)),Hr(s,34,Ei(mH(e)=="true")),Hr(s,14,Ei(!0)),l&&Hr(s,439,Ei(!1)),Hr(s,218,Uo(0)),EV(s,e,r),TV(s,e.SSF,r),FV(s,r),l&&Hr(s,352,Ei(!1));var u=s.end(),h=Xi();l&&Hr(h,140,iD()),l&&r.Strings&&_V(h,252,uI(r.Strings)),Hr(h,10);var p=h.end(),f=Xi(),x=0,g=0;for(g=0;g<e.SheetNames.length;++g)x+=(l?12:11)+(l?2:1)*e.SheetNames[g].length;var y=u.length+x+p.length;for(g=0;g<e.SheetNames.length;++g){var m=i[g]||{};Hr(f,133,cI({pos:y,hs:m.Hidden||0,dt:0,name:e.SheetNames[g]},r)),y+=t[g].length}var w=f.end();if(x!=w.length)throw new Error("BS8 "+x+" != "+w.length);var S=[];return u.length&&S.push(u),w.length&&S.push(w),p.length&&S.push(p),Ia(S)}function IV(e,t){var r=t||{},s=[];e&&!e.SSF&&(e.SSF=Cs(vn)),e&&e.SSF&&(N0(),fg(e.SSF),r.revssf=pg(e.SSF),r.revssf[e.SSF[65535]]=0,r.ssf=e.SSF),r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,Uw(r),r.cellXfs=[],Pd(r.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var a=0;a<e.SheetNames.length;++a)s[s.length]=PV(a,r,e);return s.unshift(OV(e,s,r)),Ia(s)}function iE(e,t){for(var r=0;r<=e.SheetNames.length;++r){var s=e.Sheets[e.SheetNames[r]];if(!(!s||!s["!ref"])){var a=Ki(s["!ref"]);a.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+e.SheetNames[r]+"' extends beyond column IV (255).  Data may be lost.")}}var i=t||{};switch(i.biff||2){case 8:case 5:return IV(e,t);case 4:case 3:case 2:return CV(e,t)}throw new Error("invalid type "+i.bookType+" for BIFF")}function kk(e,t){var r=t||{},s=r.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var a=e.match(/<table/i);if(!a)throw new Error("Invalid HTML: could not find <table>");var i=e.match(/<\/table/i),o=a.index,l=i&&i.index||e.length,c=SO(e.slice(o,l),/(:?<tr[^>]*>)/i,"<tr>"),d=-1,u=0,h=0,p=0,f={s:{r:1e7,c:1e7},e:{r:0,c:0}},x=[];for(o=0;o<c.length;++o){var g=c[o].trim(),y=g.slice(0,3).toLowerCase();if(y=="<tr"){if(++d,r.sheetRows&&r.sheetRows<=d){--d;break}u=0;continue}if(!(y!="<td"&&y!="<th")){var m=g.split(/<\/t[dh]>/i);for(l=0;l<m.length;++l){var w=m[l].trim();if(w.match(/<t[dh]/i)){for(var S=w,k=0;S.charAt(0)=="<"&&(k=S.indexOf(">"))>-1;)S=S.slice(k+1);for(var F=0;F<x.length;++F){var L=x[F];L.s.c==u&&L.s.r<d&&d<=L.e.r&&(u=L.e.c+1,F=-1)}var C=kn(w.slice(0,w.indexOf(">")));p=C.colspan?+C.colspan:1,((h=+C.rowspan)>1||p>1)&&x.push({s:{r:d,c:u},e:{r:d+(h||1)-1,c:u+p-1}});var O=C.t||C["data-t"]||"";if(!S.length){u+=p;continue}if(S=TA(S),f.s.r>d&&(f.s.r=d),f.e.r<d&&(f.e.r=d),f.s.c>u&&(f.s.c=u),f.e.c<u&&(f.e.c=u),!S.length){u+=p;continue}var T={t:"s",v:S};r.raw||!S.trim().length||O=="s"||(S==="TRUE"?T={t:"b",v:!0}:S==="FALSE"?T={t:"b",v:!1}:isNaN(xl(S))?isNaN(l0(S).getDate())||(T={t:"d",v:As(S)},r.cellDates||(T={t:"n",v:La(T.v)}),T.z=r.dateNF||vn[14]):T={t:"n",v:xl(S)}),r.dense?(s[d]||(s[d]=[]),s[d][u]=T):s[Sn({r:d,c:u})]=T,u+=p}}}}return s["!ref"]=Ln(f),x.length&&(s["!merges"]=x),s}function DV(e,t,r,s){for(var a=e["!merges"]||[],i=[],o=t.s.c;o<=t.e.c;++o){for(var l=0,c=0,d=0;d<a.length;++d)if(!(a[d].s.r>r||a[d].s.c>o)&&!(a[d].e.r<r||a[d].e.c<o)){if(a[d].s.r<r||a[d].s.c<o){l=-1;break}l=a[d].e.r-a[d].s.r+1,c=a[d].e.c-a[d].s.c+1;break}if(!(l<0)){var u=Sn({r,c:o}),h=s.dense?(e[r]||[])[o]:e[u],p=h&&h.v!=null&&(h.h||pw(h.w||(Nc(h),h.w)||""))||"",f={};l>1&&(f.rowspan=l),c>1&&(f.colspan=c),s.editable?p='<span contenteditable="true">'+p+"</span>":h&&(f["data-t"]=h&&h.t||"z",h.v!=null&&(f["data-v"]=h.v),h.z!=null&&(f["data-z"]=h.z),h.l&&(h.l.Target||"#").charAt(0)!="#"&&(p='<a href="'+h.l.Target+'">'+p+"</a>")),f.id=(s.id||"sjs")+"-"+u,i.push(qr("td",p,f))}}var x="<tr>";return x+i.join("")+"</tr>"}var UV='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',$V="</body></html>";function WV(e,t){var r=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!r||r.length==0)throw new Error("Invalid HTML: could not find <table>");if(r.length==1)return Bd(kk(r[0],t),t);var s=zw();return r.forEach(function(a,i){qw(s,kk(a,t),"Sheet"+(i+1))}),s}function zV(e,t,r){var s=[];return s.join("")+"<table"+(r&&r.id?' id="'+r.id+'"':"")+">"}function oE(e,t){var r=t||{},s=r.header!=null?r.header:UV,a=r.footer!=null?r.footer:$V,i=[s],o=Ki(e["!ref"]);r.dense=Array.isArray(e),i.push(zV(e,o,r));for(var l=o.s.r;l<=o.e.r;++l)i.push(DV(e,o,l,r));return i.push("</table>"+a),i.join("")}function lE(e,t,r){var s=r||{},a=0,i=0;if(s.origin!=null)if(typeof s.origin=="number")a=s.origin;else{var o=typeof s.origin=="string"?Is(s.origin):s.origin;a=o.r,i=o.c}var l=t.getElementsByTagName("tr"),c=Math.min(s.sheetRows||1e7,l.length),d={s:{r:0,c:0},e:{r:a,c:i}};if(e["!ref"]){var u=Ki(e["!ref"]);d.s.r=Math.min(d.s.r,u.s.r),d.s.c=Math.min(d.s.c,u.s.c),d.e.r=Math.max(d.e.r,u.e.r),d.e.c=Math.max(d.e.c,u.e.c),a==-1&&(d.e.r=a=u.e.r+1)}var h=[],p=0,f=e["!rows"]||(e["!rows"]=[]),x=0,g=0,y=0,m=0,w=0,S=0;for(e["!cols"]||(e["!cols"]=[]);x<l.length&&g<c;++x){var k=l[x];if(jk(k)){if(s.display)continue;f[g]={hidden:!0}}var F=k.children;for(y=m=0;y<F.length;++y){var L=F[y];if(!(s.display&&jk(L))){var C=L.hasAttribute("data-v")?L.getAttribute("data-v"):L.hasAttribute("v")?L.getAttribute("v"):TA(L.innerHTML),O=L.getAttribute("data-z")||L.getAttribute("z");for(p=0;p<h.length;++p){var T=h[p];T.s.c==m+i&&T.s.r<g+a&&g+a<=T.e.r&&(m=T.e.c+1-i,p=-1)}S=+L.getAttribute("colspan")||1,((w=+L.getAttribute("rowspan")||1)>1||S>1)&&h.push({s:{r:g+a,c:m+i},e:{r:g+a+(w||1)-1,c:m+i+(S||1)-1}});var W={t:"s",v:C},A=L.getAttribute("data-t")||L.getAttribute("t")||"";C!=null&&(C.length==0?W.t=A||"z":s.raw||C.trim().length==0||A=="s"||(C==="TRUE"?W={t:"b",v:!0}:C==="FALSE"?W={t:"b",v:!1}:isNaN(xl(C))?isNaN(l0(C).getDate())||(W={t:"d",v:As(C)},s.cellDates||(W={t:"n",v:La(W.v)}),W.z=s.dateNF||vn[14]):W={t:"n",v:xl(C)})),W.z===void 0&&O!=null&&(W.z=O);var N="",P=L.getElementsByTagName("A");if(P&&P.length)for(var K=0;K<P.length&&!(P[K].hasAttribute("href")&&(N=P[K].getAttribute("href"),N.charAt(0)!="#"));++K);N&&N.charAt(0)!="#"&&(W.l={Target:N}),s.dense?(e[g+a]||(e[g+a]=[]),e[g+a][m+i]=W):e[Sn({c:m+i,r:g+a})]=W,d.e.c<m+i&&(d.e.c=m+i),m+=S}}++g}return h.length&&(e["!merges"]=(e["!merges"]||[]).concat(h)),d.e.r=Math.max(d.e.r,g-1+a),e["!ref"]=Ln(d),g>=c&&(e["!fullref"]=Ln((d.e.r=l.length-x+g-1+a,d))),e}function cE(e,t){var r=t||{},s=r.dense?[]:{};return lE(s,e,t)}function qV(e,t){return Bd(cE(e,t),t)}function jk(e){var t="",r=HV(e);return r&&(t=r(e).getPropertyValue("display")),t||(t=e.style&&e.style.display),t==="none"}function HV(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function VV(e){var t=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(s,a){return Array(parseInt(a,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),r=Kn(t.replace(/<[^>]*>/g,""));return[r]}var Nk={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function dE(e,t){var r=t||{},s=mw(e),a=[],i,o,l={name:""},c="",d=0,u,h,p={},f=[],x=r.dense?[]:{},g,y,m={value:""},w="",S=0,k=[],F=-1,L=-1,C={s:{r:1e6,c:1e7},e:{r:0,c:0}},O=0,T={},W=[],A={},N=0,P=0,K=[],re=1,ge=1,Fe=[],R={Names:[]},q={},me=["",""],fe=[],E={},U="",I=0,M=!1,te=!1,Q=0;for(pp.lastIndex=0,s=s.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");g=pp.exec(s);)switch(g[3]=g[3].replace(/_.*$/,"")){case"table":case"":g[1]==="/"?(C.e.c>=C.s.c&&C.e.r>=C.s.r?x["!ref"]=Ln(C):x["!ref"]="A1:A1",r.sheetRows>0&&r.sheetRows<=C.e.r&&(x["!fullref"]=x["!ref"],C.e.r=r.sheetRows-1,x["!ref"]=Ln(C)),W.length&&(x["!merges"]=W),K.length&&(x["!rows"]=K),u.name=u.||u.name,typeof JSON<"u"&&JSON.stringify(u),f.push(u.name),p[u.name]=x,te=!1):g[0].charAt(g[0].length-2)!=="/"&&(u=kn(g[0],!1),F=L=-1,C.s.r=C.s.c=1e7,C.e.r=C.e.c=0,x=r.dense?[]:{},W=[],K=[],te=!0);break;case"table-row-group":g[1]==="/"?--O:++O;break;case"table-row":case"":if(g[1]==="/"){F+=re,re=1;break}if(h=kn(g[0],!1),h.?F=h.-1:F==-1&&(F=0),re=+h["number-rows-repeated"]||1,re<10)for(Q=0;Q<re;++Q)O>0&&(K[F+Q]={level:O});L=-1;break;case"covered-table-cell":g[1]!=="/"&&++L,r.sheetStubs&&(r.dense?(x[F]||(x[F]=[]),x[F][L]={t:"z"}):x[Sn({r:F,c:L})]={t:"z"}),w="",k=[];break;case"table-cell":case"":if(g[0].charAt(g[0].length-2)==="/")++L,m=kn(g[0],!1),ge=parseInt(m["number-columns-repeated"]||"1",10),y={t:"z",v:null},m.formula&&r.cellFormula!=!1&&(y.f=wk(Kn(m.formula))),(m.||m["value-type"])=="string"&&(y.t="s",y.v=Kn(m["string-value"]||""),r.dense?(x[F]||(x[F]=[]),x[F][L]=y):x[Sn({r:F,c:L})]=y),L+=ge-1;else if(g[1]!=="/"){++L,w="",S=0,k=[],ge=1;var G=re?F+re-1:F;if(L>C.e.c&&(C.e.c=L),L<C.s.c&&(C.s.c=L),F<C.s.r&&(C.s.r=F),G>C.e.r&&(C.e.r=G),m=kn(g[0],!1),fe=[],E={},y={t:m.||m["value-type"],v:null},r.cellFormula)if(m.formula&&(m.formula=Kn(m.formula)),m["number-matrix-columns-spanned"]&&m["number-matrix-rows-spanned"]&&(N=parseInt(m["number-matrix-rows-spanned"],10)||0,P=parseInt(m["number-matrix-columns-spanned"],10)||0,A={s:{r:F,c:L},e:{r:F+N-1,c:L+P-1}},y.F=Ln(A),Fe.push([A,y.F])),m.formula)y.f=wk(m.formula);else for(Q=0;Q<Fe.length;++Q)F>=Fe[Q][0].s.r&&F<=Fe[Q][0].e.r&&L>=Fe[Q][0].s.c&&L<=Fe[Q][0].e.c&&(y.F=Fe[Q][1]);switch((m["number-columns-spanned"]||m["number-rows-spanned"])&&(N=parseInt(m["number-rows-spanned"],10)||0,P=parseInt(m["number-columns-spanned"],10)||0,A={s:{r:F,c:L},e:{r:F+N-1,c:L+P-1}},W.push(A)),m["number-columns-repeated"]&&(ge=parseInt(m["number-columns-repeated"],10)),y.t){case"boolean":y.t="b",y.v=ks(m["boolean-value"]);break;case"float":y.t="n",y.v=parseFloat(m.value);break;case"percentage":y.t="n",y.v=parseFloat(m.value);break;case"currency":y.t="n",y.v=parseFloat(m.value);break;case"date":y.t="d",y.v=As(m["date-value"]),r.cellDates||(y.t="n",y.v=La(y.v)),y.z="m/d/yy";break;case"time":y.t="n",y.v=bO(m["time-value"])/86400,r.cellDates&&(y.t="d",y.v=mg(y.v)),y.z="HH:MM:SS";break;case"number":y.t="n",y.v=parseFloat(m.);break;default:if(y.t==="string"||y.t==="text"||!y.t)y.t="s",m["string-value"]!=null&&(w=Kn(m["string-value"]),k=[]);else throw new Error("Unsupported value type "+y.t)}}else{if(M=!1,y.t==="s"&&(y.v=w||"",k.length&&(y.R=k),M=S==0),q.Target&&(y.l=q),fe.length>0&&(y.c=fe,fe=[]),w&&r.cellText!==!1&&(y.w=w),M&&(y.t="z",delete y.v),(!M||r.sheetStubs)&&!(r.sheetRows&&r.sheetRows<=F))for(var ne=0;ne<re;++ne){if(ge=parseInt(m["number-columns-repeated"]||"1",10),r.dense)for(x[F+ne]||(x[F+ne]=[]),x[F+ne][L]=ne==0?y:Cs(y);--ge>0;)x[F+ne][L+ge]=Cs(y);else for(x[Sn({r:F+ne,c:L})]=y;--ge>0;)x[Sn({r:F+ne,c:L+ge})]=Cs(y);C.e.c<=L&&(C.e.c=L)}ge=parseInt(m["number-columns-repeated"]||"1",10),L+=ge-1,ge=0,y={},w="",k=[]}q={};break;case"document":case"document-content":case"":case"spreadsheet":case"":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(g[1]==="/"){if((i=a.pop())[0]!==g[3])throw"Bad state: "+i}else g[0].charAt(g[0].length-2)!=="/"&&a.push([g[3],!0]);break;case"annotation":if(g[1]==="/"){if((i=a.pop())[0]!==g[3])throw"Bad state: "+i;E.t=w,k.length&&(E.R=k),E.a=U,fe.push(E)}else g[0].charAt(g[0].length-2)!=="/"&&a.push([g[3],!1]);U="",I=0,w="",S=0,k=[];break;case"creator":g[1]==="/"?U=s.slice(I,g.index):I=g.index+g[0].length;break;case"meta":case"":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(g[1]==="/"){if((i=a.pop())[0]!==g[3])throw"Bad state: "+i}else g[0].charAt(g[0].length-2)!=="/"&&a.push([g[3],!1]);w="",S=0,k=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(g[1]==="/"){if(T[l.name]=c,(i=a.pop())[0]!==g[3])throw"Bad state: "+i}else g[0].charAt(g[0].length-2)!=="/"&&(c="",l=kn(g[0],!1),a.push([g[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(a[a.length-1][0]){case"time-style":case"date-style":o=kn(g[0],!1),c+=Nk[g[3]][o.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(a[a.length-1][0]){case"time-style":case"date-style":o=kn(g[0],!1),c+=Nk[g[3]][o.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(g[0].slice(-2)==="/>")break;if(g[1]==="/")switch(a[a.length-1][0]){case"number-style":case"date-style":case"time-style":c+=s.slice(d,g.index);break}else d=g.index+g[0].length;break;case"named-range":o=kn(g[0],!1),me=Cy(o["cell-range-address"]);var z={Name:o.name,Ref:me[0]+"!"+me[1]};te&&(z.Sheet=f.length),R.Names.push(z);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"":if(["master-styles"].indexOf(a[a.length-1][0])>-1)break;if(g[1]==="/"&&(!m||!m["string-value"])){var he=VV(s.slice(S,g.index));w=(w.length>0?w+`
`:"")+he[0]}else kn(g[0],!1),S=g.index+g[0].length;break;case"s":break;case"database-range":if(g[1]==="/")break;try{me=Cy(kn(g[0])["target-range-address"]),p[me[0]]["!autofilter"]={ref:me[1]}}catch{}break;case"date":break;case"object":break;case"title":case"":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(g[1]!=="/"){if(q=kn(g[0],!1),!q.href)break;q.Target=Kn(q.href),delete q.href,q.Target.charAt(0)=="#"&&q.Target.indexOf(".")>-1?(me=Cy(q.Target.slice(1)),q.Target="#"+me[0]+"!"+me[1]):q.Target.match(/^\.\.[\\\/]/)&&(q.Target=q.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(g[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case":":case":":break;default:if(r.WTF)throw new Error(g)}}var X={Sheets:p,SheetNames:f,Workbook:R};return r.bookSheets&&delete X.Sheets,X}function Ak(e,t){t=t||{},Do(e,"META-INF/manifest.xml")&&b9(ga(e,"META-INF/manifest.xml"),t);var r=yo(e,"content.xml");if(!r)throw new Error("Missing content.xml in ODS / UOF file");var s=dE(hs(r),t);return Do(e,"meta.xml")&&(s.Props=eC(ga(e,"meta.xml"))),s}function Ck(e,t){return dE(e,t)}var GV=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+hp({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return fa+t}}(),Ek=function(){var e=function(i){return us(i).replace(/  +/g,function(o){return'<text:s text:c="'+o.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},t=`          <table:table-cell />
`,r=`          <table:covered-table-cell/>
`,s=function(i,o,l){var c=[];c.push('      <table:table table:name="'+us(o.SheetNames[l])+`" table:style-name="ta1">
`);var d=0,u=0,h=Ki(i["!ref"]||"A1"),p=i["!merges"]||[],f=0,x=Array.isArray(i);if(i["!cols"])for(u=0;u<=h.e.c;++u)c.push("        <table:table-column"+(i["!cols"][u]?' table:style-name="co'+i["!cols"][u].ods+'"':"")+`></table:table-column>
`);var g="",y=i["!rows"]||[];for(d=0;d<h.s.r;++d)g=y[d]?' table:style-name="ro'+y[d].ods+'"':"",c.push("        <table:table-row"+g+`></table:table-row>
`);for(;d<=h.e.r;++d){for(g=y[d]?' table:style-name="ro'+y[d].ods+'"':"",c.push("        <table:table-row"+g+`>
`),u=0;u<h.s.c;++u)c.push(t);for(;u<=h.e.c;++u){var m=!1,w={},S="";for(f=0;f!=p.length;++f)if(!(p[f].s.c>u)&&!(p[f].s.r>d)&&!(p[f].e.c<u)&&!(p[f].e.r<d)){(p[f].s.c!=u||p[f].s.r!=d)&&(m=!0),w["table:number-columns-spanned"]=p[f].e.c-p[f].s.c+1,w["table:number-rows-spanned"]=p[f].e.r-p[f].s.r+1;break}if(m){c.push(r);continue}var k=Sn({r:d,c:u}),F=x?(i[d]||[])[u]:i[k];if(F&&F.f&&(w["table:formula"]=us(hz(F.f)),F.F&&F.F.slice(0,k.length)==k)){var L=Ki(F.F);w["table:number-matrix-columns-spanned"]=L.e.c-L.s.c+1,w["table:number-matrix-rows-spanned"]=L.e.r-L.s.r+1}if(!F){c.push(t);continue}switch(F.t){case"b":S=F.v?"TRUE":"FALSE",w["office:value-type"]="boolean",w["office:boolean-value"]=F.v?"true":"false";break;case"n":S=F.w||String(F.v||0),w["office:value-type"]="float",w["office:value"]=F.v||0;break;case"s":case"str":S=F.v==null?"":F.v,w["office:value-type"]="string";break;case"d":S=F.w||As(F.v).toISOString(),w["office:value-type"]="date",w["office:date-value"]=As(F.v).toISOString(),w["table:style-name"]="ce1";break;default:c.push(t);continue}var C=e(S);if(F.l&&F.l.Target){var O=F.l.Target;O=O.charAt(0)=="#"?"#"+pz(O.slice(1)):O,O.charAt(0)!="#"&&!O.match(/^\w+:/)&&(O="../"+O),C=qr("text:a",C,{"xlink:href":O.replace(/&/g,"&amp;")})}c.push("          "+qr("table:table-cell",qr("text:p",C,{}),w)+`
`)}c.push(`        </table:table-row>
`)}return c.push(`      </table:table>
`),c.join("")},a=function(i,o){i.push(` <office:automatic-styles>
`),i.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),i.push(`   <number:month number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:day number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:year/>
`),i.push(`  </number:date-style>
`);var l=0;o.SheetNames.map(function(d){return o.Sheets[d]}).forEach(function(d){if(d&&d["!cols"]){for(var u=0;u<d["!cols"].length;++u)if(d["!cols"][u]){var h=d["!cols"][u];if(h.width==null&&h.wpx==null&&h.wch==null)continue;Nd(h),h.ods=l;var p=d["!cols"][u].wpx+"px";i.push('  <style:style style:name="co'+l+`" style:family="table-column">
`),i.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+p+`"/>
`),i.push(`  </style:style>
`),++l}}});var c=0;o.SheetNames.map(function(d){return o.Sheets[d]}).forEach(function(d){if(d&&d["!rows"]){for(var u=0;u<d["!rows"].length;++u)if(d["!rows"][u]){d["!rows"][u].ods=c;var h=d["!rows"][u].hpx+"px";i.push('  <style:style style:name="ro'+c+`" style:family="table-row">
`),i.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+h+`"/>
`),i.push(`  </style:style>
`),++c}}}),i.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),i.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),i.push(`  </style:style>
`),i.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),i.push(` </office:automatic-styles>
`)};return function(o,l){var c=[fa],d=hp({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),u=hp({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});l.bookType=="fods"?(c.push("<office:document"+d+u+`>
`),c.push(ZA().replace(/office:document-meta/g,"office:meta"))):c.push("<office:document-content"+d+`>
`),a(c,o),c.push(`  <office:body>
`),c.push(`    <office:spreadsheet>
`);for(var h=0;h!=o.SheetNames.length;++h)c.push(s(o.Sheets[o.SheetNames[h]],o,h));return c.push(`    </office:spreadsheet>
`),c.push(`  </office:body>
`),l.bookType=="fods"?c.push("</office:document>"):c.push("</office:document-content>"),c.join("")}}();function uE(e,t){if(t.bookType=="fods")return Ek(e,t);var r=uw(),s="",a=[],i=[];return s="mimetype",Rn(r,s,"application/vnd.oasis.opendocument.spreadsheet"),s="content.xml",Rn(r,s,Ek(e,t)),a.push([s,"text/xml"]),i.push([s,"ContentFile"]),s="styles.xml",Rn(r,s,GV(e,t)),a.push([s,"text/xml"]),i.push([s,"StylesFile"]),s="meta.xml",Rn(r,s,fa+ZA()),a.push([s,"text/xml"]),i.push([s,"MetadataFile"]),s="manifest.rdf",Rn(r,s,S9(i)),a.push([s,"application/rdf+xml"]),s="META-INF/manifest.xml",Rn(r,s,v9(a)),r}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function Nu(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function F2(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):hs(Rd(e))}function QV(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):go(zl(e))}function XV(e,t){e:for(var r=0;r<=e.length-t.length;++r){for(var s=0;s<t.length;++s)if(e[r+s]!=t[s])continue e;return!0}return!1}function Cd(e){var t=e.reduce(function(a,i){return a+i.length},0),r=new Uint8Array(t),s=0;return e.forEach(function(a){r.set(a,s),s+=a.length}),r}function Tk(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function YV(e,t){for(var r=(e[t+15]&127)<<7|e[t+14]>>1,s=e[t+14]&1,a=t+13;a>=t;--a)s=s*256+e[a];return(e[t+15]&128?-s:s)*Math.pow(10,r-6176)}function KV(e,t,r){var s=Math.floor(r==0?0:Math.LOG10E*Math.log(Math.abs(r)))+6176-20,a=r/Math.pow(10,s-6176);e[t+15]|=s>>7,e[t+14]|=(s&127)<<1;for(var i=0;a>=1;++i,a/=256)e[t+i]=a&255;e[t+15]|=r>=0?0:128}function wp(e,t){var r=t?t[0]:0,s=e[r]&127;e:if(e[r++]>=128&&(s|=(e[r]&127)<<7,e[r++]<128||(s|=(e[r]&127)<<14,e[r++]<128)||(s|=(e[r]&127)<<21,e[r++]<128)||(s+=(e[r]&127)*Math.pow(2,28),++r,e[r++]<128)||(s+=(e[r]&127)*Math.pow(2,35),++r,e[r++]<128)||(s+=(e[r]&127)*Math.pow(2,42),++r,e[r++]<128)))break e;return t&&(t[0]=r),s}function ls(e){var t=new Uint8Array(7);t[0]=e&127;var r=1;e:if(e>127){if(t[r-1]|=128,t[r]=e>>7&127,++r,e<=16383||(t[r-1]|=128,t[r]=e>>14&127,++r,e<=2097151)||(t[r-1]|=128,t[r]=e>>21&127,++r,e<=268435455)||(t[r-1]|=128,t[r]=e/256>>>21&127,++r,e<=34359738367)||(t[r-1]|=128,t[r]=e/65536>>>21&127,++r,e<=4398046511103))break e;t[r-1]|=128,t[r]=e/16777216>>>21&127,++r}return t.slice(0,r)}function Xs(e){var t=0,r=e[t]&127;e:if(e[t++]>=128){if(r|=(e[t]&127)<<7,e[t++]<128||(r|=(e[t]&127)<<14,e[t++]<128)||(r|=(e[t]&127)<<21,e[t++]<128))break e;r|=(e[t]&127)<<28}return r}function es(e){for(var t=[],r=[0];r[0]<e.length;){var s=r[0],a=wp(e,r),i=a&7;a=Math.floor(a/8);var o=0,l;if(a==0)break;switch(i){case 0:{for(var c=r[0];e[r[0]++]>=128;);l=e.slice(c,r[0])}break;case 5:o=4,l=e.slice(r[0],r[0]+o),r[0]+=o;break;case 1:o=8,l=e.slice(r[0],r[0]+o),r[0]+=o;break;case 2:o=wp(e,r),l=e.slice(r[0],r[0]+o),r[0]+=o;break;case 3:case 4:default:throw new Error("PB Type ".concat(i," for Field ").concat(a," at offset ").concat(s))}var d={data:l,type:i};t[a]==null?t[a]=[d]:t[a].push(d)}return t}function Xa(e){var t=[];return e.forEach(function(r,s){r.forEach(function(a){a.data&&(t.push(ls(s*8+a.type)),a.type==2&&t.push(ls(a.data.length)),t.push(a.data))})}),Cd(t)}function Iw(e,t){return(e==null?void 0:e.map(function(r){return t(r.data)}))||[]}function Po(e){for(var t,r=[],s=[0];s[0]<e.length;){var a=wp(e,s),i=es(e.slice(s[0],s[0]+a));s[0]+=a;var o={id:Xs(i[1][0].data),messages:[]};i[2].forEach(function(l){var c=es(l.data),d=Xs(c[3][0].data);o.messages.push({meta:c,data:e.slice(s[0],s[0]+d)}),s[0]+=d}),(t=i[3])!=null&&t[0]&&(o.merge=Xs(i[3][0].data)>>>0>0),r.push(o)}return r}function Ku(e){var t=[];return e.forEach(function(r){var s=[];s[1]=[{data:ls(r.id),type:0}],s[2]=[],r.merge!=null&&(s[3]=[{data:ls(+!!r.merge),type:0}]);var a=[];r.messages.forEach(function(o){a.push(o.data),o.meta[3]=[{type:0,data:ls(o.data.length)}],s[2].push({data:Xa(o.meta),type:2})});var i=Xa(s);t.push(ls(i.length)),t.push(i),a.forEach(function(o){return t.push(o)})}),Cd(t)}function JV(e,t){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var r=[0],s=wp(t,r),a=[];r[0]<t.length;){var i=t[r[0]]&3;if(i==0){var o=t[r[0]++]>>2;if(o<60)++o;else{var l=o-59;o=t[r[0]],l>1&&(o|=t[r[0]+1]<<8),l>2&&(o|=t[r[0]+2]<<16),l>3&&(o|=t[r[0]+3]<<24),o>>>=0,o++,r[0]+=l}a.push(t.slice(r[0],r[0]+o)),r[0]+=o;continue}else{var c=0,d=0;if(i==1?(d=(t[r[0]]>>2&7)+4,c=(t[r[0]++]&224)<<3,c|=t[r[0]++]):(d=(t[r[0]++]>>2)+1,i==2?(c=t[r[0]]|t[r[0]+1]<<8,r[0]+=2):(c=(t[r[0]]|t[r[0]+1]<<8|t[r[0]+2]<<16|t[r[0]+3]<<24)>>>0,r[0]+=4)),a=[Cd(a)],c==0)throw new Error("Invalid offset 0");if(c>a[0].length)throw new Error("Invalid offset beyond length");if(d>=c)for(a.push(a[0].slice(-c)),d-=c;d>=a[a.length-1].length;)a.push(a[a.length-1]),d-=a[a.length-1].length;a.push(a[0].slice(-c,-c+d))}}var u=Cd(a);if(u.length!=s)throw new Error("Unexpected length: ".concat(u.length," != ").concat(s));return u}function Oo(e){for(var t=[],r=0;r<e.length;){var s=e[r++],a=e[r]|e[r+1]<<8|e[r+2]<<16;r+=3,t.push(JV(s,e.slice(r,r+a))),r+=a}if(r!==e.length)throw new Error("data is not a valid framed stream!");return Cd(t)}function Ju(e){for(var t=[],r=0;r<e.length;){var s=Math.min(e.length-r,268435455),a=new Uint8Array(4);t.push(a);var i=ls(s),o=i.length;t.push(i),s<=60?(o++,t.push(new Uint8Array([s-1<<2]))):s<=256?(o+=2,t.push(new Uint8Array([240,s-1&255]))):s<=65536?(o+=3,t.push(new Uint8Array([244,s-1&255,s-1>>8&255]))):s<=16777216?(o+=4,t.push(new Uint8Array([248,s-1&255,s-1>>8&255,s-1>>16&255]))):s<=4294967296&&(o+=5,t.push(new Uint8Array([252,s-1&255,s-1>>8&255,s-1>>16&255,s-1>>>24&255]))),t.push(e.slice(r,r+s)),o+=s,a[0]=0,a[1]=o&255,a[2]=o>>8&255,a[3]=o>>16&255,r+=s}return Cd(t)}function ZV(e,t,r,s){var a=Nu(e),i=a.getUint32(4,!0),o=(s>1?12:8)+Tk(i&(s>1?3470:398))*4,l=-1,c=-1,d=NaN,u=new Date(2001,0,1);i&512&&(l=a.getUint32(o,!0),o+=4),o+=Tk(i&(s>1?12288:4096))*4,i&16&&(c=a.getUint32(o,!0),o+=4),i&32&&(d=a.getFloat64(o,!0),o+=8),i&64&&(u.setTime(u.getTime()+a.getFloat64(o,!0)*1e3),o+=8);var h;switch(e[2]){case 0:break;case 2:h={t:"n",v:d};break;case 3:h={t:"s",v:t[c]};break;case 5:h={t:"d",v:u};break;case 6:h={t:"b",v:d>0};break;case 7:h={t:"n",v:d/86400};break;case 8:h={t:"e",v:0};break;case 9:if(l>-1)h={t:"s",v:r[l]};else if(c>-1)h={t:"s",v:t[c]};else if(!isNaN(d))h={t:"n",v:d};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return h}function eG(e,t,r){var s=Nu(e),a=s.getUint32(8,!0),i=12,o=-1,l=-1,c=NaN,d=NaN,u=new Date(2001,0,1);a&1&&(c=YV(e,i),i+=16),a&2&&(d=s.getFloat64(i,!0),i+=8),a&4&&(u.setTime(u.getTime()+s.getFloat64(i,!0)*1e3),i+=8),a&8&&(l=s.getUint32(i,!0),i+=4),a&16&&(o=s.getUint32(i,!0),i+=4);var h;switch(e[1]){case 0:break;case 2:h={t:"n",v:c};break;case 3:h={t:"s",v:t[l]};break;case 5:h={t:"d",v:u};break;case 6:h={t:"b",v:d>0};break;case 7:h={t:"n",v:d/86400};break;case 8:h={t:"e",v:0};break;case 9:if(o>-1)h={t:"s",v:r[o]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(a&31," : ").concat(e.slice(0,4)));break;case 10:h={t:"n",v:c};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(a&31," : ").concat(e.slice(0,4)))}return h}function Ty(e,t){var r=new Uint8Array(32),s=Nu(r),a=12,i=0;switch(r[0]=5,e.t){case"n":r[1]=2,KV(r,a,e.v),i|=1,a+=16;break;case"b":r[1]=6,s.setFloat64(a,e.v?1:0,!0),i|=2,a+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[1]=3,s.setUint32(a,t.indexOf(e.v),!0),i|=8,a+=4;break;default:throw"unsupported cell type "+e.t}return s.setUint32(8,i,!0),r.slice(0,a)}function Ly(e,t){var r=new Uint8Array(32),s=Nu(r),a=12,i=0;switch(r[0]=3,e.t){case"n":r[2]=2,s.setFloat64(a,e.v,!0),i|=32,a+=8;break;case"b":r[2]=6,s.setFloat64(a,e.v?1:0,!0),i|=32,a+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[2]=3,s.setUint32(a,t.indexOf(e.v),!0),i|=16,a+=4;break;default:throw"unsupported cell type "+e.t}return s.setUint32(4,i,!0),r.slice(0,a)}function tG(e,t,r){switch(e[0]){case 0:case 1:case 2:case 3:return ZV(e,t,r,e[0]);case 5:return eG(e,t,r);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function di(e){var t=es(e);return wp(t[1][0].data)}function Lk(e,t){var r=es(t.data),s=Xs(r[1][0].data),a=r[3],i=[];return(a||[]).forEach(function(o){var l=es(o.data),c=Xs(l[1][0].data)>>>0;switch(s){case 1:i[c]=F2(l[3][0].data);break;case 8:{var d=e[di(l[9][0].data)][0],u=es(d.data),h=e[di(u[1][0].data)][0],p=Xs(h.meta[1][0].data);if(p!=2001)throw new Error("2000 unexpected reference to ".concat(p));var f=es(h.data);i[c]=f[3].map(function(x){return F2(x.data)}).join("")}break}}),i}function rG(e,t){var r,s,a,i,o,l,c,d,u,h,p,f,x,g,y=es(e),m=Xs(y[1][0].data)>>>0,w=Xs(y[2][0].data)>>>0,S=((s=(r=y[8])==null?void 0:r[0])==null?void 0:s.data)&&Xs(y[8][0].data)>0||!1,k,F;if((i=(a=y[7])==null?void 0:a[0])!=null&&i.data&&t!=0)k=(l=(o=y[7])==null?void 0:o[0])==null?void 0:l.data,F=(d=(c=y[6])==null?void 0:c[0])==null?void 0:d.data;else if((h=(u=y[4])==null?void 0:u[0])!=null&&h.data&&t!=1)k=(f=(p=y[4])==null?void 0:p[0])==null?void 0:f.data,F=(g=(x=y[3])==null?void 0:x[0])==null?void 0:g.data;else throw"NUMBERS Tile missing ".concat(t," cell storage");for(var L=S?4:1,C=Nu(k),O=[],T=0;T<k.length/2;++T){var W=C.getUint16(T*2,!0);W<65535&&O.push([T,W])}if(O.length!=w)throw"Expected ".concat(w," cells, found ").concat(O.length);var A=[];for(T=0;T<O.length-1;++T)A[O[T][0]]=F.subarray(O[T][1]*L,O[T+1][1]*L);return O.length>=1&&(A[O[O.length-1][0]]=F.subarray(O[O.length-1][1]*L)),{R:m,cells:A}}function nG(e,t){var r,s=es(t.data),a=(r=s==null?void 0:s[7])!=null&&r[0]?Xs(s[7][0].data)>>>0>0?1:0:-1,i=Iw(s[5],function(o){return rG(o,a)});return{nrows:Xs(s[4][0].data)>>>0,data:i.reduce(function(o,l){return o[l.R]||(o[l.R]=[]),l.cells.forEach(function(c,d){if(o[l.R][d])throw new Error("Duplicate cell r=".concat(l.R," c=").concat(d));o[l.R][d]=c}),o},[])}}function sG(e,t,r){var s,a=es(t.data),i={s:{r:0,c:0},e:{r:0,c:0}};if(i.e.r=(Xs(a[6][0].data)>>>0)-1,i.e.r<0)throw new Error("Invalid row varint ".concat(a[6][0].data));if(i.e.c=(Xs(a[7][0].data)>>>0)-1,i.e.c<0)throw new Error("Invalid col varint ".concat(a[7][0].data));r["!ref"]=Ln(i);var o=es(a[4][0].data),l=Lk(e,e[di(o[4][0].data)][0]),c=(s=o[17])!=null&&s[0]?Lk(e,e[di(o[17][0].data)][0]):[],d=es(o[3][0].data),u=0;d[1].forEach(function(h){var p=es(h.data),f=e[di(p[2][0].data)][0],x=Xs(f.meta[1][0].data);if(x!=6002)throw new Error("6001 unexpected reference to ".concat(x));var g=nG(e,f);g.data.forEach(function(y,m){y.forEach(function(w,S){var k=Sn({r:u+m,c:S}),F=tG(w,l,c);F&&(r[k]=F)})}),u+=g.nrows})}function aG(e,t){var r=es(t.data),s={"!ref":"A1"},a=e[di(r[2][0].data)],i=Xs(a[0].meta[1][0].data);if(i!=6001)throw new Error("6000 unexpected reference to ".concat(i));return sG(e,a[0],s),s}function iG(e,t){var r,s=es(t.data),a={name:(r=s[1])!=null&&r[0]?F2(s[1][0].data):"",sheets:[]},i=Iw(s[2],di);return i.forEach(function(o){e[o].forEach(function(l){var c=Xs(l.meta[1][0].data);c==6e3&&a.sheets.push(aG(e,l))})}),a}function oG(e,t){var r=zw(),s=es(t.data),a=Iw(s[1],di);if(a.forEach(function(i){e[i].forEach(function(o){var l=Xs(o.meta[1][0].data);if(l==2){var c=iG(e,o);c.sheets.forEach(function(d,u){qw(r,d,u==0?c.name:c.name+"_"+u,!0)})}})}),r.SheetNames.length==0)throw new Error("Empty NUMBERS file");return r}function Fy(e){var t,r,s,a,i={},o=[];if(e.FullPaths.forEach(function(c){if(c.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(c){if(c.name.match(/\.iwa$/)){var d;try{d=Oo(c.content)}catch(h){return console.log("?? "+c.content.length+" "+(h.message||h))}var u;try{u=Po(d)}catch(h){return console.log("## "+(h.message||h))}u.forEach(function(h){i[h.id]=h.messages,o.push(h.id)})}}),!o.length)throw new Error("File has no messages");var l=((a=(s=(r=(t=i==null?void 0:i[1])==null?void 0:t[0])==null?void 0:r.meta)==null?void 0:s[1])==null?void 0:a[0].data)&&Xs(i[1][0].meta[1][0].data)==1&&i[1][0];if(l||o.forEach(function(c){i[c].forEach(function(d){var u=Xs(d.meta[1][0].data)>>>0;if(u==1)if(!l)l=d;else throw new Error("Document has multiple roots")})}),!l)throw new Error("Cannot find Document root");return oG(i,l)}function lG(e,t,r){var s,a,i,o;if(!((s=e[6])!=null&&s[0])||!((a=e[7])!=null&&a[0]))throw"Mutation only works on post-BNC storages!";var l=((o=(i=e[8])==null?void 0:i[0])==null?void 0:o.data)&&Xs(e[8][0].data)>0||!1;if(l)throw"Math only works with normal offsets";for(var c=0,d=Nu(e[7][0].data),u=0,h=[],p=Nu(e[4][0].data),f=0,x=[],g=0;g<t.length;++g){if(t[g]==null){d.setUint16(g*2,65535,!0),p.setUint16(g*2,65535);continue}d.setUint16(g*2,u,!0),p.setUint16(g*2,f,!0);var y,m;switch(typeof t[g]){case"string":y=Ty({t:"s",v:t[g]},r),m=Ly({t:"s",v:t[g]},r);break;case"number":y=Ty({t:"n",v:t[g]},r),m=Ly({t:"n",v:t[g]},r);break;case"boolean":y=Ty({t:"b",v:t[g]},r),m=Ly({t:"b",v:t[g]},r);break;default:throw new Error("Unsupported value "+t[g])}h.push(y),u+=y.length,x.push(m),f+=m.length,++c}for(e[2][0].data=ls(c);g<e[7][0].data.length/2;++g)d.setUint16(g*2,65535,!0),p.setUint16(g*2,65535,!0);return e[6][0].data=Cd(h),e[3][0].data=Cd(x),c}function cG(e,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var r=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var s=Ki(r["!ref"]);s.s.r=s.s.c=0;var a=!1;s.e.c>9&&(a=!0,s.e.c=9),s.e.r>49&&(a=!0,s.e.r=49),a&&console.error("The Numbers writer is currently limited to ".concat(Ln(s)));var i=T1(r,{range:s,header:1}),o=["~Sh33tJ5~"];i.forEach(function(U){return U.forEach(function(I){typeof I=="string"&&o.push(I)})});var l={},c=[],d=mn.read(t.numbers,{type:"base64"});d.FileIndex.map(function(U,I){return[U,d.FullPaths[I]]}).forEach(function(U){var I=U[0],M=U[1];if(I.type==2&&I.name.match(/\.iwa/)){var te=I.content,Q=Oo(te),G=Po(Q);G.forEach(function(ne){c.push(ne.id),l[ne.id]={deps:[],location:M,type:Xs(ne.messages[0].meta[1][0].data)}})}}),c.sort(function(U,I){return U-I});var u=c.filter(function(U){return U>1}).map(function(U){return[U,ls(U)]});d.FileIndex.map(function(U,I){return[U,d.FullPaths[I]]}).forEach(function(U){var I=U[0];if(U[1],!!I.name.match(/\.iwa/)){var M=Po(Oo(I.content));M.forEach(function(te){te.messages.forEach(function(Q){u.forEach(function(G){te.messages.some(function(ne){return Xs(ne.meta[1][0].data)!=11006&&XV(ne.data,G[1])})&&l[G[0]].deps.push(te.id)})})})}});for(var h=mn.find(d,l[1].location),p=Po(Oo(h.content)),f,x=0;x<p.length;++x){var g=p[x];g.id==1&&(f=g)}var y=di(es(f.messages[0].data)[1][0].data);for(h=mn.find(d,l[y].location),p=Po(Oo(h.content)),x=0;x<p.length;++x)g=p[x],g.id==y&&(f=g);for(y=di(es(f.messages[0].data)[2][0].data),h=mn.find(d,l[y].location),p=Po(Oo(h.content)),x=0;x<p.length;++x)g=p[x],g.id==y&&(f=g);for(y=di(es(f.messages[0].data)[2][0].data),h=mn.find(d,l[y].location),p=Po(Oo(h.content)),x=0;x<p.length;++x)g=p[x],g.id==y&&(f=g);var m=es(f.messages[0].data);{m[6][0].data=ls(s.e.r+1),m[7][0].data=ls(s.e.c+1);var w=di(m[46][0].data),S=mn.find(d,l[w].location),k=Po(Oo(S.content));{for(var F=0;F<k.length&&k[F].id!=w;++F);if(k[F].id!=w)throw"Bad ColumnRowUIDMapArchive";var L=es(k[F].messages[0].data);L[1]=[],L[2]=[],L[3]=[];for(var C=0;C<=s.e.c;++C){var O=[];O[1]=O[2]=[{type:0,data:ls(C+420690)}],L[1].push({type:2,data:Xa(O)}),L[2].push({type:0,data:ls(C)}),L[3].push({type:0,data:ls(C)})}L[4]=[],L[5]=[],L[6]=[];for(var T=0;T<=s.e.r;++T)O=[],O[1]=O[2]=[{type:0,data:ls(T+726270)}],L[4].push({type:2,data:Xa(O)}),L[5].push({type:0,data:ls(T)}),L[6].push({type:0,data:ls(T)});k[F].messages[0].data=Xa(L)}S.content=Ju(Ku(k)),S.size=S.content.length,delete m[46];var W=es(m[4][0].data);{W[7][0].data=ls(s.e.r+1);var A=es(W[1][0].data),N=di(A[2][0].data);S=mn.find(d,l[N].location),k=Po(Oo(S.content));{if(k[0].id!=N)throw"Bad HeaderStorageBucket";var P=es(k[0].messages[0].data);for(T=0;T<i.length;++T){var K=es(P[2][0].data);K[1][0].data=ls(T),K[4][0].data=ls(i[T].length),P[2][T]={type:P[2][0].type,data:Xa(K)}}k[0].messages[0].data=Xa(P)}S.content=Ju(Ku(k)),S.size=S.content.length;var re=di(W[2][0].data);S=mn.find(d,l[re].location),k=Po(Oo(S.content));{if(k[0].id!=re)throw"Bad HeaderStorageBucket";for(P=es(k[0].messages[0].data),C=0;C<=s.e.c;++C)K=es(P[2][0].data),K[1][0].data=ls(C),K[4][0].data=ls(s.e.r+1),P[2][C]={type:P[2][0].type,data:Xa(K)};k[0].messages[0].data=Xa(P)}S.content=Ju(Ku(k)),S.size=S.content.length;var ge=di(W[4][0].data);(function(){for(var U=mn.find(d,l[ge].location),I=Po(Oo(U.content)),M,te=0;te<I.length;++te){var Q=I[te];Q.id==ge&&(M=Q)}var G=es(M.messages[0].data);{G[3]=[];var ne=[];o.forEach(function(X,H){ne[1]=[{type:0,data:ls(H)}],ne[2]=[{type:0,data:ls(1)}],ne[3]=[{type:2,data:QV(X)}],G[3].push({type:2,data:Xa(ne)})})}M.messages[0].data=Xa(G);var z=Ku(I),he=Ju(z);U.content=he,U.size=U.content.length})();var Fe=es(W[3][0].data);{var R=Fe[1][0];delete Fe[2];var q=es(R.data);{var me=di(q[2][0].data);(function(){for(var U=mn.find(d,l[me].location),I=Po(Oo(U.content)),M,te=0;te<I.length;++te){var Q=I[te];Q.id==me&&(M=Q)}var G=es(M.messages[0].data);{delete G[6],delete Fe[7];var ne=new Uint8Array(G[5][0].data);G[5]=[];for(var z=0,he=0;he<=s.e.r;++he){var X=es(ne);z+=lG(X,i[he],o),X[1][0].data=ls(he),G[5].push({data:Xa(X),type:2})}G[1]=[{type:0,data:ls(s.e.c+1)}],G[2]=[{type:0,data:ls(s.e.r+1)}],G[3]=[{type:0,data:ls(z)}],G[4]=[{type:0,data:ls(s.e.r+1)}]}M.messages[0].data=Xa(G);var H=Ku(I),oe=Ju(H);U.content=oe,U.size=U.content.length})()}R.data=Xa(q)}W[3][0].data=Xa(Fe)}m[4][0].data=Xa(W)}f.messages[0].data=Xa(m);var fe=Ku(p),E=Ju(fe);return h.content=E,h.size=h.content.length,d}function fE(e){return function(r){for(var s=0;s!=e.length;++s){var a=e[s];r[a[0]]===void 0&&(r[a[0]]=a[1]),a[2]==="n"&&(r[a[0]]=Number(r[a[0]]))}}}function Dw(e){fE([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function Uw(e){fE([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function dG(e){return Wn.WS.indexOf(e)>-1?"sheet":e==Wn.CS?"chart":e==Wn.DS?"dialog":e==Wn.MS?"macro":e&&e.length?e:"sheet"}function uG(e,t){if(!e)return 0;try{e=t.map(function(s){return s.id||(s.id=s.strRelID),[s.name,e["!id"][s.id].Target,dG(e["!id"][s.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function fG(e,t,r,s,a,i,o,l,c,d,u,h){try{i[s]=Fh(yo(e,r,!0),t);var p=ga(e,t),f;switch(l){case"sheet":f=RH(p,t,a,c,i[s],d,u,h);break;case"chart":if(f=BH(p,t,a,c,i[s],d,u,h),!f||!f["!drawel"])break;var x=bh(f["!drawel"].Target,t),g=mp(x),y=w$(yo(e,x,!0),Fh(yo(e,g,!0),x)),m=bh(y,x),w=mp(m);f=lH(yo(e,m,!0),m,c,Fh(yo(e,w,!0),m),d,f);break;case"macro":f=PH(p,t,a,c,i[s],d,u,h);break;case"dialog":f=OH(p,t,a,c,i[s],d,u,h);break;default:throw new Error("Unrecognized sheet type "+l)}o[s]=f;var S=[];i&&i[s]&&Ys(i[s]).forEach(function(k){var F="";if(i[s][k].Type==Wn.CMNT){F=bh(i[s][k].Target,t);var L=$H(ga(e,F,!0),F,c);if(!L||!L.length)return;xk(f,L,!1)}i[s][k].Type==Wn.TCMNT&&(F=bh(i[s][k].Target,t),S=S.concat(_$(ga(e,F,!0),c)))}),S&&S.length&&xk(f,S,!0,c.people||[])}catch(k){if(c.WTF)throw k}}function Fo(e){return e.charAt(0)=="/"?e.slice(1):e}function hG(e,t){if(N0(),t=t||{},Dw(t),Do(e,"META-INF/manifest.xml")||Do(e,"objectdata.xml"))return Ak(e,t);if(Do(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof Fy<"u"){if(e.FileIndex)return Fy(e);var r=mn.utils.cfb_new();return O_(e).forEach(function(K){Rn(r,K,kO(e,K))}),Fy(r)}throw new Error("Unsupported NUMBERS file")}if(!Do(e,"[Content_Types].xml"))throw Do(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):Do(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var s=O_(e),a=g9(yo(e,"[Content_Types].xml")),i=!1,o,l;if(a.workbooks.length===0&&(l="xl/workbook.xml",ga(e,l,!0)&&a.workbooks.push(l)),a.workbooks.length===0){if(l="xl/workbook.bin",!ga(e,l,!0))throw new Error("Could not find workbook");a.workbooks.push(l),i=!0}a.workbooks[0].slice(-3)=="bin"&&(i=!0);var c={},d={};if(!t.bookSheets&&!t.bookProps){if(Mh=[],a.sst)try{Mh=UH(ga(e,Fo(a.sst)),a.sst,t)}catch(K){if(t.WTF)throw K}t.cellStyles&&a.themes.length&&(c=DH(yo(e,a.themes[0].replace(/^\//,""),!0)||"",a.themes[0],t)),a.style&&(d=IH(ga(e,Fo(a.style)),a.style,c,t))}a.links.map(function(K){try{var re=Fh(yo(e,mp(Fo(K))),K);return zH(ga(e,Fo(K)),re,K,t)}catch{}});var u=MH(ga(e,Fo(a.workbooks[0])),a.workbooks[0],t),h={},p="";a.coreprops.length&&(p=ga(e,Fo(a.coreprops[0]),!0),p&&(h=eC(p)),a.extprops.length!==0&&(p=ga(e,Fo(a.extprops[0]),!0),p&&k9(p,h,t)));var f={};(!t.bookSheets||t.bookProps)&&a.custprops.length!==0&&(p=yo(e,Fo(a.custprops[0]),!0),p&&(f=N9(p,t)));var x={};if((t.bookSheets||t.bookProps)&&(u.Sheets?o=u.Sheets.map(function(re){return re.name}):h.Worksheets&&h.SheetNames.length>0&&(o=h.SheetNames),t.bookProps&&(x.Props=h,x.Custprops=f),t.bookSheets&&typeof o<"u"&&(x.SheetNames=o),t.bookSheets?x.SheetNames:t.bookProps))return x;o={};var g={};t.bookDeps&&a.calcchain&&(g=WH(ga(e,Fo(a.calcchain)),a.calcchain));var y=0,m={},w,S;{var k=u.Sheets;h.Worksheets=k.length,h.SheetNames=[];for(var F=0;F!=k.length;++F)h.SheetNames[F]=k[F].name}var L=i?"bin":"xml",C=a.workbooks[0].lastIndexOf("/"),O=(a.workbooks[0].slice(0,C+1)+"_rels/"+a.workbooks[0].slice(C+1)+".rels").replace(/^\//,"");Do(e,O)||(O="xl/_rels/workbook."+L+".rels");var T=Fh(yo(e,O,!0),O.replace(/_rels.*/,"s5s"));(a.metadata||[]).length>=1&&(t.xlmeta=qH(ga(e,Fo(a.metadata[0])),a.metadata[0],t)),(a.people||[]).length>=1&&(t.people=j$(ga(e,Fo(a.people[0])),t)),T&&(T=uG(T,u.Sheets));var W=ga(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(y=0;y!=h.Worksheets;++y){var A="sheet";if(T&&T[y]?(w="xl/"+T[y][1].replace(/[\/]?xl\//,""),Do(e,w)||(w=T[y][1]),Do(e,w)||(w=O.replace(/_rels\/.*$/,"")+T[y][1]),A=T[y][2]):(w="xl/worksheets/sheet"+(y+1-W)+"."+L,w=w.replace(/sheet0\./,"sheet.")),S=w.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),t&&t.sheets!=null)switch(typeof t.sheets){case"number":if(y!=t.sheets)continue e;break;case"string":if(h.SheetNames[y].toLowerCase()!=t.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(t.sheets)){for(var N=!1,P=0;P!=t.sheets.length;++P)typeof t.sheets[P]=="number"&&t.sheets[P]==y&&(N=1),typeof t.sheets[P]=="string"&&t.sheets[P].toLowerCase()==h.SheetNames[y].toLowerCase()&&(N=1);if(!N)continue e}}fG(e,w,S,h.SheetNames[y],y,m,o,A,t,u,c,d)}return x={Directory:a,Workbook:u,Props:h,Custprops:f,Deps:g,Sheets:o,SheetNames:h.SheetNames,Strings:Mh,Styles:d,Themes:c,SSF:Cs(vn)},t&&t.bookFiles&&(e.files?(x.keys=s,x.files=e.files):(x.keys=[],x.files={},e.FullPaths.forEach(function(K,re){K=K.replace(/^Root Entry[\/]/,""),x.keys.push(K),x.files[K]=e.FileIndex[re]}))),t&&t.bookVBA&&(a.vba.length>0?x.vbaraw=ga(e,Fo(a.vba[0]),!0):a.defaults&&a.defaults.bin===M$&&(x.vbaraw=ga(e,"xl/vbaProject.bin",!0))),x}function pG(e,t){var r=t||{},s="Workbook",a=mn.find(e,s);try{if(s="/!DataSpaces/Version",a=mn.find(e,s),!a||!a.content)throw new Error("ECMA-376 Encrypted file missing "+s);if(qD(a.content),s="/!DataSpaces/DataSpaceMap",a=mn.find(e,s),!a||!a.content)throw new Error("ECMA-376 Encrypted file missing "+s);var i=VD(a.content);if(i.length!==1||i[0].comps.length!==1||i[0].comps[0].t!==0||i[0].name!=="StrongEncryptionDataSpace"||i[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+s);if(s="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",a=mn.find(e,s),!a||!a.content)throw new Error("ECMA-376 Encrypted file missing "+s);var o=GD(a.content);if(o.length!=1||o[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+s);if(s="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",a=mn.find(e,s),!a||!a.content)throw new Error("ECMA-376 Encrypted file missing "+s);XD(a.content)}catch{}if(s="/EncryptionInfo",a=mn.find(e,s),!a||!a.content)throw new Error("ECMA-376 Encrypted file missing "+s);var l=YD(a.content);if(s="/EncryptedPackage",a=mn.find(e,s),!a||!a.content)throw new Error("ECMA-376 Encrypted file missing "+s);if(l[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(l[1],a.content,r.password||"",r);if(l[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(l[1],a.content,r.password||"",r);throw new Error("File is password-protected")}function mG(e,t){return t.bookType=="ods"?uE(e,t):t.bookType=="numbers"?cG(e,t):t.bookType=="xlsb"?xG(e,t):gG(e,t)}function xG(e,t){Ff=1024,e&&!e.SSF&&(e.SSF=Cs(vn)),e&&e.SSF&&(N0(),fg(e.SSF),t.revssf=pg(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Rh?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r=t.bookType=="xlsb"?"bin":"xml",s=DC.indexOf(t.bookType)>-1,a=jw();Uw(t=t||{});var i=uw(),o="",l=0;if(t.cellXfs=[],Pd(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),o="docProps/core.xml",Rn(i,o,tC(e.Props,t)),a.coreprops.push(o),cs(t.rels,2,o,Wn.CORE_PROPS),o="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var c=[],d=0;d<e.SheetNames.length;++d)(e.Workbook.Sheets[d]||{}).Hidden!=2&&c.push(e.SheetNames[d]);e.Props.SheetNames=c}for(e.Props.Worksheets=e.Props.SheetNames.length,Rn(i,o,sC(e.Props)),a.extprops.push(o),cs(t.rels,3,o,Wn.EXT_PROPS),e.Custprops!==e.Props&&Ys(e.Custprops||{}).length>0&&(o="docProps/custom.xml",Rn(i,o,aC(e.Custprops)),a.custprops.push(o),cs(t.rels,4,o,Wn.CUST_PROPS)),l=1;l<=e.SheetNames.length;++l){var u={"!id":{}},h=e.Sheets[e.SheetNames[l-1]],p=(h||{})["!type"]||"sheet";switch(p){case"chart":default:o="xl/worksheets/sheet"+l+"."+r,Rn(i,o,VH(l-1,o,t,e,u)),a.sheets.push(o),cs(t.wbrels,-1,"worksheets/sheet"+l+"."+r,Wn.WS[0])}if(h){var f=h["!comments"],x=!1,g="";f&&f.length>0&&(g="xl/comments"+l+"."+r,Rn(i,g,XH(f,g)),a.comments.push(g),cs(u,-1,"../comments"+l+"."+r,Wn.CMNT),x=!0),h["!legacy"]&&x&&Rn(i,"xl/drawings/vmlDrawing"+l+".vml",OC(l,h["!comments"])),delete h["!comments"],delete h["!legacy"]}u["!id"].rId1&&Rn(i,mp(o),Vf(u))}return t.Strings!=null&&t.Strings.length>0&&(o="xl/sharedStrings."+r,Rn(i,o,QH(t.Strings,o,t)),a.strs.push(o),cs(t.wbrels,-1,"sharedStrings."+r,Wn.SST)),o="xl/workbook."+r,Rn(i,o,HH(e,o)),a.workbooks.push(o),cs(t.rels,1,o,Wn.WB),o="xl/theme/theme1.xml",Rn(i,o,Lw(e.Themes,t)),a.themes.push(o),cs(t.wbrels,-1,"theme/theme1.xml",Wn.THEME),o="xl/styles."+r,Rn(i,o,GH(e,o,t)),a.styles.push(o),cs(t.wbrels,-1,"styles."+r,Wn.STY),e.vbaraw&&s&&(o="xl/vbaProject.bin",Rn(i,o,e.vbaraw),a.vba.push(o),cs(t.wbrels,-1,"vbaProject.bin",Wn.VBA)),o="xl/metadata."+r,Rn(i,o,YH(o)),a.metadata.push(o),cs(t.wbrels,-1,"metadata."+r,Wn.XLMETA),Rn(i,"[Content_Types].xml",JA(a,t)),Rn(i,"_rels/.rels",Vf(t.rels)),Rn(i,"xl/_rels/workbook."+r+".rels",Vf(t.wbrels)),delete t.revssf,delete t.ssf,i}function gG(e,t){Ff=1024,e&&!e.SSF&&(e.SSF=Cs(vn)),e&&e.SSF&&(N0(),fg(e.SSF),t.revssf=pg(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Rh?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r="xml",s=DC.indexOf(t.bookType)>-1,a=jw();Uw(t=t||{});var i=uw(),o="",l=0;if(t.cellXfs=[],Pd(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),o="docProps/core.xml",Rn(i,o,tC(e.Props,t)),a.coreprops.push(o),cs(t.rels,2,o,Wn.CORE_PROPS),o="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var c=[],d=0;d<e.SheetNames.length;++d)(e.Workbook.Sheets[d]||{}).Hidden!=2&&c.push(e.SheetNames[d]);e.Props.SheetNames=c}e.Props.Worksheets=e.Props.SheetNames.length,Rn(i,o,sC(e.Props)),a.extprops.push(o),cs(t.rels,3,o,Wn.EXT_PROPS),e.Custprops!==e.Props&&Ys(e.Custprops||{}).length>0&&(o="docProps/custom.xml",Rn(i,o,aC(e.Custprops)),a.custprops.push(o),cs(t.rels,4,o,Wn.CUST_PROPS));var u=["SheetJ5"];for(t.tcid=0,l=1;l<=e.SheetNames.length;++l){var h={"!id":{}},p=e.Sheets[e.SheetNames[l-1]],f=(p||{})["!type"]||"sheet";switch(f){case"chart":default:o="xl/worksheets/sheet"+l+"."+r,Rn(i,o,YC(l-1,t,e,h)),a.sheets.push(o),cs(t.wbrels,-1,"worksheets/sheet"+l+"."+r,Wn.WS[0])}if(p){var x=p["!comments"],g=!1,y="";if(x&&x.length>0){var m=!1;x.forEach(function(w){w[1].forEach(function(S){S.T==!0&&(m=!0)})}),m&&(y="xl/threadedComments/threadedComment"+l+"."+r,Rn(i,y,k$(x,u,t)),a.threadedcomments.push(y),cs(h,-1,"../threadedComments/threadedComment"+l+"."+r,Wn.TCMNT)),y="xl/comments"+l+"."+r,Rn(i,y,IC(x)),a.comments.push(y),cs(h,-1,"../comments"+l+"."+r,Wn.CMNT),g=!0}p["!legacy"]&&g&&Rn(i,"xl/drawings/vmlDrawing"+l+".vml",OC(l,p["!comments"])),delete p["!comments"],delete p["!legacy"]}h["!id"].rId1&&Rn(i,mp(o),Vf(h))}return t.Strings!=null&&t.Strings.length>0&&(o="xl/sharedStrings."+r,Rn(i,o,jC(t.Strings,t)),a.strs.push(o),cs(t.wbrels,-1,"sharedStrings."+r,Wn.SST)),o="xl/workbook."+r,Rn(i,o,tE(e)),a.workbooks.push(o),cs(t.rels,1,o,Wn.WB),o="xl/theme/theme1.xml",Rn(i,o,Lw(e.Themes,t)),a.themes.push(o),cs(t.wbrels,-1,"theme/theme1.xml",Wn.THEME),o="xl/styles."+r,Rn(i,o,MC(e,t)),a.styles.push(o),cs(t.wbrels,-1,"styles."+r,Wn.STY),e.vbaraw&&s&&(o="xl/vbaProject.bin",Rn(i,o,e.vbaraw),a.vba.push(o),cs(t.wbrels,-1,"vbaProject.bin",Wn.VBA)),o="xl/metadata."+r,Rn(i,o,PC()),a.metadata.push(o),cs(t.wbrels,-1,"metadata."+r,Wn.XLMETA),u.length>1&&(o="xl/persons/person.xml",Rn(i,o,N$(u)),a.people.push(o),cs(t.wbrels,-1,"persons/person.xml",Wn.PEOPLE)),Rn(i,"[Content_Types].xml",JA(a,t)),Rn(i,"_rels/.rels",Vf(t.rels)),Rn(i,"xl/_rels/workbook."+r+".rels",Vf(t.wbrels)),delete t.revssf,delete t.ssf,i}function $w(e,t){var r="";switch((t||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":r=ko(e.slice(0,12));break;case"binary":r=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3),r.charCodeAt(4),r.charCodeAt(5),r.charCodeAt(6),r.charCodeAt(7)]}function yG(e,t){return mn.find(e,"EncryptedPackage")?pG(e,t):aE(e,t)}function bG(e,t){var r,s=e,a=t||{};return a.type||(a.type=Un&&Buffer.isBuffer(e)?"buffer":"base64"),r=AA(s,a),hG(r,a)}function hE(e,t){var r=0;e:for(;r<e.length;)switch(e.charCodeAt(r)){case 10:case 13:case 32:++r;break;case 60:return T2(e.slice(r),t);default:break e}return c0.to_workbook(e,t)}function vG(e,t){var r="",s=$w(e,t);switch(t.type){case"base64":r=ko(e);break;case"binary":r=e;break;case"buffer":r=e.toString("binary");break;case"array":r=Su(e);break;default:throw new Error("Unrecognized type "+t.type)}return s[0]==239&&s[1]==187&&s[2]==191&&(r=hs(r)),t.type="binary",hE(r,t)}function wG(e,t){var r=e;return t.type=="base64"&&(r=ko(r)),r=cp.utils.decode(1200,r.slice(2),"str"),t.type="binary",hE(r,t)}function SG(e){return e.match(/[^\x00-\x7F]/)?zl(e):e}function My(e,t,r,s){return s?(r.type="string",c0.to_workbook(e,r)):c0.to_workbook(t,r)}function u0(e,t){iw();var r=t||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return u0(new Uint8Array(e),(r=Cs(r),r.type="array",r));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!r.type&&(r.type=typeof Deno<"u"?"buffer":"array");var s=e,a=[0,0,0,0],i=!1;if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),Qf={},r.dateNF&&(Qf.dateNF=r.dateNF),r.type||(r.type=Un&&Buffer.isBuffer(e)?"buffer":"base64"),r.type=="file"&&(r.type=Un?"buffer":"binary",s=xO(e),typeof Uint8Array<"u"&&!Un&&(r.type="array")),r.type=="string"&&(i=!0,r.type="binary",r.codepage=65001,s=SG(e)),r.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var o=new ArrayBuffer(3),l=new Uint8Array(o);if(l.foo="bar",!l.foo)return r=Cs(r),r.type="array",u0(ow(s),r)}switch((a=$w(s,r))[0]){case 208:if(a[1]===207&&a[2]===17&&a[3]===224&&a[4]===161&&a[5]===177&&a[6]===26&&a[7]===225)return yG(mn.read(s,r),r);break;case 9:if(a[1]<=8)return aE(s,r);break;case 60:return T2(s,r);case 73:if(a[1]===73&&a[2]===42&&a[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(a[1]===68)return AD(s,r);break;case 84:if(a[1]===65&&a[2]===66&&a[3]===76)return _C.to_workbook(s,r);break;case 80:return a[1]===75&&a[2]<9&&a[3]<9?bG(s,r):My(e,s,r,i);case 239:return a[3]===60?T2(s,r):My(e,s,r,i);case 255:if(a[1]===254)return wG(s,r);if(a[1]===0&&a[2]===2&&a[3]===0)return du.to_workbook(s,r);break;case 0:if(a[1]===0&&(a[2]>=2&&a[3]===0||a[2]===0&&(a[3]===8||a[3]===9)))return du.to_workbook(s,r);break;case 3:case 131:case 139:case 140:return E2.to_workbook(s,r);case 123:if(a[1]===92&&a[2]===114&&a[3]===116)return TC.to_workbook(s,r);break;case 10:case 13:case 32:return vG(s,r);case 137:if(a[1]===80&&a[2]===78&&a[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return ND.indexOf(a[0])>-1&&a[2]<=12&&a[3]<=31?E2.to_workbook(s,r):My(e,s,r,i)}function pE(e,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return Dp(t.file,mn.write(e,{type:Un?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return mn.write(e,t)}function _G(e,t){var r=Cs(t||{}),s=mG(e,r);return kG(s,r)}function kG(e,t){var r={},s=Un?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(t.compression&&(r.compression="DEFLATE"),t.password)r.type=s;else switch(t.type){case"base64":r.type="base64";break;case"binary":r.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":r.type=s;break;default:throw new Error("Unrecognized type "+t.type)}var a=e.FullPaths?mn.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[r.type]||r.type,compression:!!t.compression}):e.generate(r);if(typeof Deno<"u"&&typeof a=="string"){if(t.type=="binary"||t.type=="base64")return a;a=new Uint8Array(ug(a))}return t.password&&typeof encrypt_agile<"u"?pE(encrypt_agile(a,t.password),t):t.type==="file"?Dp(t.file,a):t.type=="string"?hs(a):a}function jG(e,t){var r=t||{},s=SV(e,r);return pE(s,r)}function Pl(e,t,r){r||(r="");var s=r+e;switch(t.type){case"base64":return dp(zl(s));case"binary":return zl(s);case"string":return e;case"file":return Dp(t.file,s,"utf8");case"buffer":return Un?Tc(s,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(s):Pl(s,{type:"binary"}).split("").map(function(a){return a.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function NG(e,t){switch(t.type){case"base64":return dp(e);case"binary":return e;case"string":return e;case"file":return Dp(t.file,e,"binary");case"buffer":return Un?Tc(e,"binary"):e.split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function Wm(e,t){switch(t.type){case"string":case"base64":case"binary":for(var r="",s=0;s<e.length;++s)r+=String.fromCharCode(e[s]);return t.type=="base64"?dp(r):t.type=="string"?hs(r):r;case"file":return Dp(t.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+t.type)}}function mE(e,t){iw(),yH(e);var r=Cs(t||{});if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),r.type=="array"){r.type="binary";var s=mE(e,r);return r.type="array",ug(s)}var a=0;if(r.sheet&&(typeof r.sheet=="number"?a=r.sheet:a=e.SheetNames.indexOf(r.sheet),!e.SheetNames[a]))throw new Error("Sheet not found: "+r.sheet+" : "+typeof r.sheet);switch(r.bookType||"xlsb"){case"xml":case"xlml":return Pl(mV(e,r),r);case"slk":case"sylk":return Pl(SC.from_sheet(e.Sheets[e.SheetNames[a]],r),r);case"htm":case"html":return Pl(oE(e.Sheets[e.SheetNames[a]],r),r);case"txt":return NG(xE(e.Sheets[e.SheetNames[a]],r),r);case"csv":return Pl(Ww(e.Sheets[e.SheetNames[a]],r),r,"\uFEFF");case"dif":return Pl(_C.from_sheet(e.Sheets[e.SheetNames[a]],r),r);case"dbf":return Wm(E2.from_sheet(e.Sheets[e.SheetNames[a]],r),r);case"prn":return Pl(c0.from_sheet(e.Sheets[e.SheetNames[a]],r),r);case"rtf":return Pl(TC.from_sheet(e.Sheets[e.SheetNames[a]],r),r);case"eth":return Pl(kC.from_sheet(e.Sheets[e.SheetNames[a]],r),r);case"fods":return Pl(uE(e,r),r);case"wk1":return Wm(du.sheet_to_wk1(e.Sheets[e.SheetNames[a]],r),r);case"wk3":return Wm(du.book_to_wk3(e,r),r);case"biff2":r.biff||(r.biff=2);case"biff3":r.biff||(r.biff=3);case"biff4":return r.biff||(r.biff=4),Wm(iE(e,r),r);case"biff5":r.biff||(r.biff=5);case"biff8":case"xla":case"xls":return r.biff||(r.biff=8),jG(e,r);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return _G(e,r);default:throw new Error("Unrecognized bookType |"+r.bookType+"|")}}function AG(e){if(!e.bookType){var t={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},r=e.file.slice(e.file.lastIndexOf(".")).toLowerCase();r.match(/^\.[a-z]+$/)&&(e.bookType=r.slice(1)),e.bookType=t[e.bookType]||e.bookType}}function vg(e,t,r){var s={};return s.type="file",s.file=t,AG(s),mE(e,s)}function CG(e,t,r,s,a,i,o,l){var c=ua(r),d=l.defval,u=l.raw||!Object.prototype.hasOwnProperty.call(l,"raw"),h=!0,p=a===1?[]:{};if(a!==1)if(Object.defineProperty)try{Object.defineProperty(p,"__rowNum__",{value:r,enumerable:!1})}catch{p.__rowNum__=r}else p.__rowNum__=r;if(!o||e[r])for(var f=t.s.c;f<=t.e.c;++f){var x=o?e[r][f]:e[s[f]+c];if(x===void 0||x.t===void 0){if(d===void 0)continue;i[f]!=null&&(p[i[f]]=d);continue}var g=x.v;switch(x.t){case"z":if(g==null)break;continue;case"e":g=g==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+x.t)}if(i[f]!=null){if(g==null)if(x.t=="e"&&g===null)p[i[f]]=null;else if(d!==void 0)p[i[f]]=d;else if(u&&g===null)p[i[f]]=null;else continue;else p[i[f]]=u&&(x.t!=="n"||x.t==="n"&&l.rawNumbers!==!1)?g:Nc(x,g,l);g!=null&&(h=!1)}}return{row:p,isempty:h}}function T1(e,t){if(e==null||e["!ref"]==null)return[];var r={t:"n",v:0},s=0,a=1,i=[],o=0,l="",c={s:{r:0,c:0},e:{r:0,c:0}},d=t||{},u=d.range!=null?d.range:e["!ref"];switch(d.header===1?s=1:d.header==="A"?s=2:Array.isArray(d.header)?s=3:d.header==null&&(s=0),typeof u){case"string":c=Jn(u);break;case"number":c=Jn(e["!ref"]),c.s.r=u;break;default:c=u}s>0&&(a=0);var h=ua(c.s.r),p=[],f=[],x=0,g=0,y=Array.isArray(e),m=c.s.r,w=0,S={};y&&!e[m]&&(e[m]=[]);var k=d.skipHidden&&e["!cols"]||[],F=d.skipHidden&&e["!rows"]||[];for(w=c.s.c;w<=c.e.c;++w)if(!(k[w]||{}).hidden)switch(p[w]=Os(w),r=y?e[m][w]:e[p[w]+h],s){case 1:i[w]=w-c.s.c;break;case 2:i[w]=p[w];break;case 3:i[w]=d.header[w-c.s.c];break;default:if(r==null&&(r={w:"__EMPTY",t:"s"}),l=o=Nc(r,null,d),g=S[o]||0,!g)S[o]=1;else{do l=o+"_"+g++;while(S[l]);S[o]=g,S[l]=1}i[w]=l}for(m=c.s.r+a;m<=c.e.r;++m)if(!(F[m]||{}).hidden){var L=CG(e,c,m,p,s,i,y,d);(L.isempty===!1||(s===1?d.blankrows!==!1:d.blankrows))&&(f[x++]=L.row)}return f.length=x,f}var Fk=/"/g;function EG(e,t,r,s,a,i,o,l){for(var c=!0,d=[],u="",h=ua(r),p=t.s.c;p<=t.e.c;++p)if(s[p]){var f=l.dense?(e[r]||[])[p]:e[s[p]+h];if(f==null)u="";else if(f.v!=null){c=!1,u=""+(l.rawNumbers&&f.t=="n"?f.v:Nc(f,null,l));for(var x=0,g=0;x!==u.length;++x)if((g=u.charCodeAt(x))===a||g===i||g===34||l.forceQuotes){u='"'+u.replace(Fk,'""')+'"';break}u=="ID"&&(u='"ID"')}else f.f!=null&&!f.F?(c=!1,u="="+f.f,u.indexOf(",")>=0&&(u='"'+u.replace(Fk,'""')+'"')):u="";d.push(u)}return l.blankrows===!1&&c?null:d.join(o)}function Ww(e,t){var r=[],s=t??{};if(e==null||e["!ref"]==null)return"";var a=Jn(e["!ref"]),i=s.FS!==void 0?s.FS:",",o=i.charCodeAt(0),l=s.RS!==void 0?s.RS:`
`,c=l.charCodeAt(0),d=new RegExp((i=="|"?"\\|":i)+"+$"),u="",h=[];s.dense=Array.isArray(e);for(var p=s.skipHidden&&e["!cols"]||[],f=s.skipHidden&&e["!rows"]||[],x=a.s.c;x<=a.e.c;++x)(p[x]||{}).hidden||(h[x]=Os(x));for(var g=0,y=a.s.r;y<=a.e.r;++y)(f[y]||{}).hidden||(u=EG(e,a,y,h,o,c,i,s),u!=null&&(s.strip&&(u=u.replace(d,"")),(u||s.blankrows!==!1)&&r.push((g++?l:"")+u)));return delete s.dense,r.join("")}function xE(e,t){t||(t={}),t.FS="	",t.RS=`
`;var r=Ww(e,t);return r}function TG(e){var t="",r,s="";if(e==null||e["!ref"]==null)return[];var a=Jn(e["!ref"]),i="",o=[],l,c=[],d=Array.isArray(e);for(l=a.s.c;l<=a.e.c;++l)o[l]=Os(l);for(var u=a.s.r;u<=a.e.r;++u)for(i=ua(u),l=a.s.c;l<=a.e.c;++l)if(t=o[l]+i,r=d?(e[u]||[])[l]:e[t],s="",r!==void 0){if(r.F!=null){if(t=r.F,!r.f)continue;s=r.f,t.indexOf(":")==-1&&(t=t+":"+t)}if(r.f!=null)s=r.f;else{if(r.t=="z")continue;if(r.t=="n"&&r.v!=null)s=""+r.v;else if(r.t=="b")s=r.v?"TRUE":"FALSE";else if(r.w!==void 0)s="'"+r.w;else{if(r.v===void 0)continue;r.t=="s"?s="'"+r.v:s=""+r.v}}c[c.length]=t+"="+s}return c}function gE(e,t,r){var s=r||{},a=+!s.skipHeader,i=e||{},o=0,l=0;if(i&&s.origin!=null)if(typeof s.origin=="number")o=s.origin;else{var c=typeof s.origin=="string"?Is(s.origin):s.origin;o=c.r,l=c.c}var d,u={s:{c:0,r:0},e:{c:l,r:o+t.length-1+a}};if(i["!ref"]){var h=Jn(i["!ref"]);u.e.c=Math.max(u.e.c,h.e.c),u.e.r=Math.max(u.e.r,h.e.r),o==-1&&(o=h.e.r+1,u.e.r=o+t.length-1+a)}else o==-1&&(o=0,u.e.r=t.length-1+a);var p=s.header||[],f=0;t.forEach(function(g,y){Ys(g).forEach(function(m){(f=p.indexOf(m))==-1&&(p[f=p.length]=m);var w=g[m],S="z",k="",F=Sn({c:l+f,r:o+y+a});d=Sp(i,F),w&&typeof w=="object"&&!(w instanceof Date)?i[F]=w:(typeof w=="number"?S="n":typeof w=="boolean"?S="b":typeof w=="string"?S="s":w instanceof Date?(S="d",s.cellDates||(S="n",w=La(w)),k=s.dateNF||vn[14]):w===null&&s.nullError&&(S="e",w=0),d?(d.t=S,d.v=w,delete d.w,delete d.R,k&&(d.z=k)):i[F]=d={t:S,v:w},k&&(d.z=k))})}),u.e.c=Math.max(u.e.c,l+p.length-1);var x=ua(o);if(a)for(f=0;f<p.length;++f)i[Os(f+l)+x]={t:"s",v:p[f]};return i["!ref"]=Ln(u),i}function LG(e,t){return gE(null,e,t)}function Sp(e,t,r){if(typeof t=="string"){if(Array.isArray(e)){var s=Is(t);return e[s.r]||(e[s.r]=[]),e[s.r][s.c]||(e[s.r][s.c]={t:"z"})}return e[t]||(e[t]={t:"z"})}return typeof t!="number"?Sp(e,Sn(t)):Sp(e,Sn({r:t,c:r||0}))}function FG(e,t){if(typeof t=="number"){if(t>=0&&e.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}else if(typeof t=="string"){var r=e.SheetNames.indexOf(t);if(r>-1)return r;throw new Error("Cannot find sheet name |"+t+"|")}else throw new Error("Cannot find sheet |"+t+"|")}function zw(){return{SheetNames:[],Sheets:{}}}function qw(e,t,r,s){var a=1;if(!r)for(;a<=65535&&e.SheetNames.indexOf(r="Sheet"+a)!=-1;++a,r=void 0);if(!r||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(s&&e.SheetNames.indexOf(r)>=0){var i=r.match(/(^.*?)(\d+)$/);a=i&&+i[2]||0;var o=i&&i[1]||r;for(++a;a<=65535&&e.SheetNames.indexOf(r=o+a)!=-1;++a);}if(eE(r),e.SheetNames.indexOf(r)>=0)throw new Error("Worksheet with name |"+r+"| already exists!");return e.SheetNames.push(r),e.Sheets[r]=t,r}function MG(e,t,r){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var s=FG(e,t);switch(e.Workbook.Sheets[s]||(e.Workbook.Sheets[s]={}),r){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+r)}e.Workbook.Sheets[s].Hidden=r}function RG(e,t){return e.z=t,e}function yE(e,t,r){return t?(e.l={Target:t},r&&(e.l.Tooltip=r)):delete e.l,e}function BG(e,t,r){return yE(e,"#"+t,r)}function PG(e,t,r){e.c||(e.c=[]),e.c.push({t,a:r||"SheetJS"})}function OG(e,t,r,s){for(var a=typeof t!="string"?t:Jn(t),i=typeof t=="string"?t:Ln(t),o=a.s.r;o<=a.e.r;++o)for(var l=a.s.c;l<=a.e.c;++l){var c=Sp(e,o,l);c.t="n",c.F=i,delete c.v,o==a.s.r&&l==a.s.c&&(c.f=r,s&&(c.D=!0))}return e}var gi={encode_col:Os,encode_row:ua,encode_cell:Sn,encode_range:Ln,decode_col:bw,decode_row:yw,split_cell:QO,decode_cell:Is,decode_range:Ki,format_cell:Nc,sheet_add_aoa:HA,sheet_add_json:gE,sheet_add_dom:lE,aoa_to_sheet:A0,json_to_sheet:LG,table_to_sheet:cE,table_to_book:qV,sheet_to_csv:Ww,sheet_to_txt:xE,sheet_to_json:T1,sheet_to_html:oE,sheet_to_formulae:TG,sheet_to_row_object_array:T1,sheet_get_cell:Sp,book_new:zw,book_append_sheet:qw,book_set_sheet_visibility:MG,cell_set_number_format:RG,cell_set_hyperlink:yE,cell_set_internal_link:BG,cell_add_comment:PG,sheet_set_array_formula:OG,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function ds(e){"@babel/helpers - typeof";return ds=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ds(e)}var bl=Uint8Array,wo=Uint16Array,Hw=Int32Array,Vw=new bl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Gw=new bl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mk=new bl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bE=function(e,t){for(var r=new wo(31),s=0;s<31;++s)r[s]=t+=1<<e[s-1];for(var a=new Hw(r[30]),s=1;s<30;++s)for(var i=r[s];i<r[s+1];++i)a[i]=i-r[s]<<5|s;return{b:r,r:a}},vE=bE(Vw,2),IG=vE.b,M2=vE.r;IG[28]=258,M2[258]=28;var DG=bE(Gw,0),Rk=DG.r,R2=new wo(32768);for(var js=0;js<32768;++js){var Qc=(js&43690)>>1|(js&21845)<<1;Qc=(Qc&52428)>>2|(Qc&13107)<<2,Qc=(Qc&61680)>>4|(Qc&3855)<<4,R2[js]=((Qc&65280)>>8|(Qc&255)<<8)>>1}var Oh=function(e,t,r){for(var s=e.length,a=0,i=new wo(t);a<s;++a)e[a]&&++i[e[a]-1];var o=new wo(t);for(a=1;a<t;++a)o[a]=o[a-1]+i[a-1]<<1;var l;if(r){l=new wo(1<<t);var c=15-t;for(a=0;a<s;++a)if(e[a])for(var d=a<<4|e[a],u=t-e[a],h=o[e[a]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)l[R2[h]>>c]=d}else for(l=new wo(s),a=0;a<s;++a)e[a]&&(l[a]=R2[o[e[a]-1]++]>>15-e[a]);return l},Au=new bl(288);for(var js=0;js<144;++js)Au[js]=8;for(var js=144;js<256;++js)Au[js]=9;for(var js=256;js<280;++js)Au[js]=7;for(var js=280;js<288;++js)Au[js]=8;var L1=new bl(32);for(var js=0;js<32;++js)L1[js]=5;var UG=Oh(Au,9,0),$G=Oh(L1,5,0),wE=function(e){return(e+7)/8|0},WG=function(e,t,r){return(r==null||r>e.length)&&(r=e.length),new bl(e.subarray(t,r))},sc=function(e,t,r){r<<=t&7;var s=t/8|0;e[s]|=r,e[s+1]|=r>>8},ih=function(e,t,r){r<<=t&7;var s=t/8|0;e[s]|=r,e[s+1]|=r>>8,e[s+2]|=r>>16},Ry=function(e,t){for(var r=[],s=0;s<e.length;++s)e[s]&&r.push({s,f:e[s]});var a=r.length,i=r.slice();if(!a)return{t:_E,l:0};if(a==1){var o=new bl(r[0].s+1);return o[r[0].s]=1,{t:o,l:1}}r.sort(function(F,L){return F.f-L.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],d=0,u=1,h=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};u!=a-1;)l=r[r[d].f<r[h].f?d++:h++],c=r[d!=u&&r[d].f<r[h].f?d++:h++],r[u++]={s:-1,f:l.f+c.f,l,r:c};for(var p=i[0].s,s=1;s<a;++s)i[s].s>p&&(p=i[s].s);var f=new wo(p+1),x=B2(r[u-1],f,0);if(x>t){var s=0,g=0,y=x-t,m=1<<y;for(i.sort(function(L,C){return f[C.s]-f[L.s]||L.f-C.f});s<a;++s){var w=i[s].s;if(f[w]>t)g+=m-(1<<x-f[w]),f[w]=t;else break}for(g>>=y;g>0;){var S=i[s].s;f[S]<t?g-=1<<t-f[S]++-1:++s}for(;s>=0&&g;--s){var k=i[s].s;f[k]==t&&(--f[k],++g)}x=t}return{t:new bl(f),l:x}},B2=function(e,t,r){return e.s==-1?Math.max(B2(e.l,t,r+1),B2(e.r,t,r+1)):t[e.s]=r},Bk=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new wo(++t),s=0,a=e[0],i=1,o=function(c){r[s++]=c},l=1;l<=t;++l)if(e[l]==a&&l!=t)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=e[l]}return{c:r.subarray(0,s),n:t}},oh=function(e,t){for(var r=0,s=0;s<t.length;++s)r+=e[s]*t[s];return r},SE=function(e,t,r){var s=r.length,a=wE(t+2);e[a]=s&255,e[a+1]=s>>8,e[a+2]=e[a]^255,e[a+3]=e[a+1]^255;for(var i=0;i<s;++i)e[a+i+4]=r[i];return(a+4+s)*8},Pk=function(e,t,r,s,a,i,o,l,c,d,u){sc(t,u++,r),++a[256];for(var h=Ry(a,15),p=h.t,f=h.l,x=Ry(i,15),g=x.t,y=x.l,m=Bk(p),w=m.c,S=m.n,k=Bk(g),F=k.c,L=k.n,C=new wo(19),O=0;O<w.length;++O)++C[w[O]&31];for(var O=0;O<F.length;++O)++C[F[O]&31];for(var T=Ry(C,7),W=T.t,A=T.l,N=19;N>4&&!W[Mk[N-1]];--N);var P=d+5<<3,K=oh(a,Au)+oh(i,L1)+o,re=oh(a,p)+oh(i,g)+o+14+3*N+oh(C,W)+2*C[16]+3*C[17]+7*C[18];if(c>=0&&P<=K&&P<=re)return SE(t,u,e.subarray(c,c+d));var ge,Fe,R,q;if(sc(t,u,1+(re<K)),u+=2,re<K){ge=Oh(p,f,0),Fe=p,R=Oh(g,y,0),q=g;var me=Oh(W,A,0);sc(t,u,S-257),sc(t,u+5,L-1),sc(t,u+10,N-4),u+=14;for(var O=0;O<N;++O)sc(t,u+3*O,W[Mk[O]]);u+=3*N;for(var fe=[w,F],E=0;E<2;++E)for(var U=fe[E],O=0;O<U.length;++O){var I=U[O]&31;sc(t,u,me[I]),u+=W[I],I>15&&(sc(t,u,U[O]>>5&127),u+=U[O]>>12)}}else ge=UG,Fe=Au,R=$G,q=L1;for(var O=0;O<l;++O){var M=s[O];if(M>255){var I=M>>18&31;ih(t,u,ge[I+257]),u+=Fe[I+257],I>7&&(sc(t,u,M>>23&31),u+=Vw[I]);var te=M&31;ih(t,u,R[te]),u+=q[te],te>3&&(ih(t,u,M>>5&8191),u+=Gw[te])}else ih(t,u,ge[M]),u+=Fe[M]}return ih(t,u,ge[256]),u+Fe[256]},zG=new Hw([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),_E=new bl(0),qG=function(e,t,r,s,a,i){var o=i.z||e.length,l=new bl(s+o+5*(1+Math.ceil(o/7e3))+a),c=l.subarray(s,l.length-a),d=i.l,u=(i.r||0)&7;if(t){u&&(c[0]=i.r>>3);for(var h=zG[t-1],p=h>>13,f=h&8191,x=(1<<r)-1,g=i.p||new wo(32768),y=i.h||new wo(x+1),m=Math.ceil(r/3),w=2*m,S=function(oe){return(e[oe]^e[oe+1]<<m^e[oe+2]<<w)&x},k=new Hw(25e3),F=new wo(288),L=new wo(32),C=0,O=0,T=i.i||0,W=0,A=i.w||0,N=0;T+2<o;++T){var P=S(T),K=T&32767,re=y[P];if(g[K]=re,y[P]=K,A<=T){var ge=o-T;if((C>7e3||W>24576)&&(ge>423||!d)){u=Pk(e,c,0,k,F,L,O,W,N,T-N,u),W=C=O=0,N=T;for(var Fe=0;Fe<286;++Fe)F[Fe]=0;for(var Fe=0;Fe<30;++Fe)L[Fe]=0}var R=2,q=0,me=f,fe=K-re&32767;if(ge>2&&P==S(T-fe))for(var E=Math.min(p,ge)-1,U=Math.min(32767,T),I=Math.min(258,ge);fe<=U&&--me&&K!=re;){if(e[T+R]==e[T+R-fe]){for(var M=0;M<I&&e[T+M]==e[T+M-fe];++M);if(M>R){if(R=M,q=fe,M>E)break;for(var te=Math.min(fe,M-2),Q=0,Fe=0;Fe<te;++Fe){var G=T-fe+Fe&32767,ne=g[G],z=G-ne&32767;z>Q&&(Q=z,re=G)}}}K=re,re=g[K],fe+=K-re&32767}if(q){k[W++]=268435456|M2[R]<<18|Rk[q];var he=M2[R]&31,X=Rk[q]&31;O+=Vw[he]+Gw[X],++F[257+he],++L[X],A=T+R,++C}else k[W++]=e[T],++F[e[T]]}}for(T=Math.max(T,A);T<o;++T)k[W++]=e[T],++F[e[T]];u=Pk(e,c,d,k,F,L,O,W,N,T-N,u),d||(i.r=u&7|c[u/8|0]<<3,u-=7,i.h=y,i.p=g,i.i=T,i.w=A)}else{for(var T=i.w||0;T<o+d;T+=65535){var H=T+65535;H>=o&&(c[u/8|0]=d,H=o),u=SE(c,u+1,e.subarray(T,H))}i.i=o}return WG(l,0,s+wE(u)+a)},kE=function(){var e=1,t=0;return{p:function(r){for(var s=e,a=t,i=r.length|0,o=0;o!=i;){for(var l=Math.min(o+2655,i);o<l;++o)a+=s+=r[o];s=(s&65535)+15*(s>>16),a=(a&65535)+15*(a>>16)}e=s,t=a},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},HG=function(e,t,r,s,a){if(!a&&(a={l:1},t.dictionary)){var i=t.dictionary.subarray(-32768),o=new bl(i.length+e.length);o.set(i),o.set(e,i.length),e=o,a.w=i.length}return qG(e,t.level==null?6:t.level,t.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,s,a)},jE=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},VG=function(e,t){var r=t.level,s=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=s<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var a=kE();a.p(t.dictionary),jE(e,2,a.d())}};function P2(e,t){t||(t={});var r=kE();r.p(e);var s=HG(e,t,t.dictionary?6:2,4);return VG(s,t),jE(s,s.length-4,r.d()),s}var GG=typeof TextDecoder<"u"&&new TextDecoder,QG=0;try{GG.decode(_E,{stream:!0}),QG=1}catch{}function XG(e){if(Array.isArray(e))return e}function YG(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var s,a,i,o,l=[],c=!0,d=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(c=(s=i.call(r)).done)&&(l.push(s.value),l.length!==t);c=!0);}catch(u){d=!0,a=u}finally{try{if(!c&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw a}}return l}}function Ok(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}function KG(e,t){if(e){if(typeof e=="string")return Ok(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ok(e,t):void 0}}function JG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ik(e,t){return XG(e)||YG(e,t)||KG(e,t)||JG()}function Dk(e,t="utf8"){return new TextDecoder(t).decode(e)}const ZG=new TextEncoder;function eQ(e){return ZG.encode(e)}const tQ=1024*8,rQ=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),By={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Qw{constructor(t=tQ,r={}){os(this,"buffer");os(this,"byteLength");os(this,"byteOffset");os(this,"length");os(this,"offset");os(this,"lastWrittenByte");os(this,"littleEndian");os(this,"_data");os(this,"_mark");os(this,"_marks");let s=!1;typeof t=="number"?t=new ArrayBuffer(t):(s=!0,this.lastWrittenByte=t.byteLength);const a=r.offset?r.offset>>>0:0,i=t.byteLength-a;let o=a;(ArrayBuffer.isView(t)||t instanceof Qw)&&(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+a),t=t.buffer),s?this.lastWrittenByte=i:this.lastWrittenByte=0,this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,i),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const s=(this.offset+t)*2,a=new Uint8Array(s);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=s,this.byteLength=s,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,r){const s=By[r].BYTES_PER_ELEMENT*t,a=this.byteOffset+this.offset,i=this.buffer.slice(a,a+s);if(this.littleEndian===rQ&&r!=="uint8"&&r!=="int8"){const l=new Uint8Array(this.buffer.slice(a,a+s));l.reverse();const c=new By[r](l.buffer);return this.offset+=s,c.reverse(),c}const o=new By[r](i);return this.offset+=s,o}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let s=0;s<t;s++)r+=this.readChar();return r}readUtf8(t=1){return Dk(this.readBytes(t))}decodeText(t=1,r="utf8"){return Dk(this.readBytes(t),r)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}writeUtf8(t){return this.writeBytes(eQ(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function E0(e){let t=e.length;for(;--t>=0;)e[t]=0}const nQ=3,sQ=258,NE=29,aQ=256,iQ=aQ+1+NE,AE=30,oQ=512,lQ=new Array((iQ+2)*2);E0(lQ);const cQ=new Array(AE*2);E0(cQ);const dQ=new Array(oQ);E0(dQ);const uQ=new Array(sQ-nQ+1);E0(uQ);const fQ=new Array(NE);E0(fQ);const hQ=new Array(AE);E0(hQ);const pQ=(e,t,r,s)=>{let a=e&65535|0,i=e>>>16&65535|0,o=0;for(;r!==0;){o=r>2e3?2e3:r,r-=o;do a=a+t[s++]|0,i=i+a|0;while(--o);a%=65521,i%=65521}return a|i<<16|0};var O2=pQ;const mQ=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var s=0;s<8;s++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},xQ=new Uint32Array(mQ()),gQ=(e,t,r,s)=>{const a=xQ,i=s+r;e^=-1;for(let o=s;o<i;o++)e=e>>>8^a[(e^t[o])&255];return e^-1};var Ml=gQ,I2={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},CE={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const yQ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var bQ=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const s in r)yQ(r,s)&&(e[s]=r[s])}}return e},vQ=e=>{let t=0;for(let s=0,a=e.length;s<a;s++)t+=e[s].length;const r=new Uint8Array(t);for(let s=0,a=0,i=e.length;s<i;s++){let o=e[s];r.set(o,a),a+=o.length}return r},EE={assign:bQ,flattenChunks:vQ};let TE=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{TE=!1}const _p=new Uint8Array(256);for(let e=0;e<256;e++)_p[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_p[254]=_p[254]=1;var wQ=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,s,a,i,o=e.length,l=0;for(a=0;a<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<o&&(s=e.charCodeAt(a+1),(s&64512)===56320&&(r=65536+(r-55296<<10)+(s-56320),a++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(l),i=0,a=0;i<l;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<o&&(s=e.charCodeAt(a+1),(s&64512)===56320&&(r=65536+(r-55296<<10)+(s-56320),a++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|r&63):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|r&63):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|r&63);return t};const SQ=(e,t)=>{if(t<65534&&e.subarray&&TE)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let s=0;s<t;s++)r+=String.fromCharCode(e[s]);return r};var _Q=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let s,a;const i=new Array(r*2);for(a=0,s=0;s<r;){let o=e[s++];if(o<128){i[a++]=o;continue}let l=_p[o];if(l>4){i[a++]=65533,s+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&s<r;)o=o<<6|e[s++]&63,l--;if(l>1){i[a++]=65533;continue}o<65536?i[a++]=o:(o-=65536,i[a++]=55296|o>>10&1023,i[a++]=56320|o&1023)}return SQ(i,a)},kQ=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+_p[e[r]]>t?r:t},D2={string2buf:wQ,buf2string:_Q,utf8border:kQ};function jQ(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var NQ=jQ;const zm=16209,AQ=16191;var CQ=function(t,r){let s,a,i,o,l,c,d,u,h,p,f,x,g,y,m,w,S,k,F,L,C,O,T,W;const A=t.state;s=t.next_in,T=t.input,a=s+(t.avail_in-5),i=t.next_out,W=t.output,o=i-(r-t.avail_out),l=i+(t.avail_out-257),c=A.dmax,d=A.wsize,u=A.whave,h=A.wnext,p=A.window,f=A.hold,x=A.bits,g=A.lencode,y=A.distcode,m=(1<<A.lenbits)-1,w=(1<<A.distbits)-1;e:do{x<15&&(f+=T[s++]<<x,x+=8,f+=T[s++]<<x,x+=8),S=g[f&m];t:for(;;){if(k=S>>>24,f>>>=k,x-=k,k=S>>>16&255,k===0)W[i++]=S&65535;else if(k&16){F=S&65535,k&=15,k&&(x<k&&(f+=T[s++]<<x,x+=8),F+=f&(1<<k)-1,f>>>=k,x-=k),x<15&&(f+=T[s++]<<x,x+=8,f+=T[s++]<<x,x+=8),S=y[f&w];r:for(;;){if(k=S>>>24,f>>>=k,x-=k,k=S>>>16&255,k&16){if(L=S&65535,k&=15,x<k&&(f+=T[s++]<<x,x+=8,x<k&&(f+=T[s++]<<x,x+=8)),L+=f&(1<<k)-1,L>c){t.msg="invalid distance too far back",A.mode=zm;break e}if(f>>>=k,x-=k,k=i-o,L>k){if(k=L-k,k>u&&A.sane){t.msg="invalid distance too far back",A.mode=zm;break e}if(C=0,O=p,h===0){if(C+=d-k,k<F){F-=k;do W[i++]=p[C++];while(--k);C=i-L,O=W}}else if(h<k){if(C+=d+h-k,k-=h,k<F){F-=k;do W[i++]=p[C++];while(--k);if(C=0,h<F){k=h,F-=k;do W[i++]=p[C++];while(--k);C=i-L,O=W}}}else if(C+=h-k,k<F){F-=k;do W[i++]=p[C++];while(--k);C=i-L,O=W}for(;F>2;)W[i++]=O[C++],W[i++]=O[C++],W[i++]=O[C++],F-=3;F&&(W[i++]=O[C++],F>1&&(W[i++]=O[C++]))}else{C=i-L;do W[i++]=W[C++],W[i++]=W[C++],W[i++]=W[C++],F-=3;while(F>2);F&&(W[i++]=W[C++],F>1&&(W[i++]=W[C++]))}}else if(k&64){t.msg="invalid distance code",A.mode=zm;break e}else{S=y[(S&65535)+(f&(1<<k)-1)];continue r}break}}else if(k&64)if(k&32){A.mode=AQ;break e}else{t.msg="invalid literal/length code",A.mode=zm;break e}else{S=g[(S&65535)+(f&(1<<k)-1)];continue t}break}}while(s<a&&i<l);F=x>>3,s-=F,x-=F<<3,f&=(1<<x)-1,t.next_in=s,t.next_out=i,t.avail_in=s<a?5+(a-s):5-(s-a),t.avail_out=i<l?257+(l-i):257-(i-l),A.hold=f,A.bits=x};const Zu=15,Uk=852,$k=592,Wk=0,Py=1,zk=2,EQ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),TQ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),LQ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),FQ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),MQ=(e,t,r,s,a,i,o,l)=>{const c=l.bits;let d=0,u=0,h=0,p=0,f=0,x=0,g=0,y=0,m=0,w=0,S,k,F,L,C,O=null,T;const W=new Uint16Array(Zu+1),A=new Uint16Array(Zu+1);let N=null,P,K,re;for(d=0;d<=Zu;d++)W[d]=0;for(u=0;u<s;u++)W[t[r+u]]++;for(f=c,p=Zu;p>=1&&W[p]===0;p--);if(f>p&&(f=p),p===0)return a[i++]=1<<24|64<<16|0,a[i++]=1<<24|64<<16|0,l.bits=1,0;for(h=1;h<p&&W[h]===0;h++);for(f<h&&(f=h),y=1,d=1;d<=Zu;d++)if(y<<=1,y-=W[d],y<0)return-1;if(y>0&&(e===Wk||p!==1))return-1;for(A[1]=0,d=1;d<Zu;d++)A[d+1]=A[d]+W[d];for(u=0;u<s;u++)t[r+u]!==0&&(o[A[t[r+u]]++]=u);if(e===Wk?(O=N=o,T=20):e===Py?(O=EQ,N=TQ,T=257):(O=LQ,N=FQ,T=0),w=0,u=0,d=h,C=i,x=f,g=0,F=-1,m=1<<f,L=m-1,e===Py&&m>Uk||e===zk&&m>$k)return 1;for(;;){P=d-g,o[u]+1<T?(K=0,re=o[u]):o[u]>=T?(K=N[o[u]-T],re=O[o[u]-T]):(K=96,re=0),S=1<<d-g,k=1<<x,h=k;do k-=S,a[C+(w>>g)+k]=P<<24|K<<16|re|0;while(k!==0);for(S=1<<d-1;w&S;)S>>=1;if(S!==0?(w&=S-1,w+=S):w=0,u++,--W[d]===0){if(d===p)break;d=t[r+o[u]]}if(d>f&&(w&L)!==F){for(g===0&&(g=f),C+=h,x=d-g,y=1<<x;x+g<p&&(y-=W[x+g],!(y<=0));)x++,y<<=1;if(m+=1<<x,e===Py&&m>Uk||e===zk&&m>$k)return 1;F=w&L,a[F]=f<<24|x<<16|C-i|0}}return w!==0&&(a[C+w]=d-g<<24|64<<16|0),l.bits=f,0};var Ih=MQ;const RQ=0,LE=1,FE=2,{Z_FINISH:qk,Z_BLOCK:BQ,Z_TREES:qm,Z_OK:Cu,Z_STREAM_END:PQ,Z_NEED_DICT:OQ,Z_STREAM_ERROR:Ko,Z_DATA_ERROR:ME,Z_MEM_ERROR:RE,Z_BUF_ERROR:IQ,Z_DEFLATED:Hk}=CE,wg=16180,Vk=16181,Gk=16182,Qk=16183,Xk=16184,Yk=16185,Kk=16186,Jk=16187,Zk=16188,ej=16189,F1=16190,ac=16191,Oy=16192,tj=16193,Iy=16194,rj=16195,nj=16196,sj=16197,aj=16198,Hm=16199,Vm=16200,ij=16201,oj=16202,lj=16203,cj=16204,dj=16205,Dy=16206,uj=16207,fj=16208,Es=16209,BE=16210,PE=16211,DQ=852,UQ=592,$Q=15,WQ=$Q,hj=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function zQ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Wu=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<wg||t.mode>PE?1:0},OE=e=>{if(Wu(e))return Ko;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=wg,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(DQ),t.distcode=t.distdyn=new Int32Array(UQ),t.sane=1,t.back=-1,Cu},IE=e=>{if(Wu(e))return Ko;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,OE(e)},DE=(e,t)=>{let r;if(Wu(e))return Ko;const s=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Ko:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=r,s.wbits=t,IE(e))},UE=(e,t)=>{if(!e)return Ko;const r=new zQ;e.state=r,r.strm=e,r.window=null,r.mode=wg;const s=DE(e,t);return s!==Cu&&(e.state=null),s},qQ=e=>UE(e,WQ);let pj=!0,Uy,$y;const HQ=e=>{if(pj){Uy=new Int32Array(512),$y=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ih(LE,e.lens,0,288,Uy,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ih(FE,e.lens,0,32,$y,0,e.work,{bits:5}),pj=!1}e.lencode=Uy,e.lenbits=9,e.distcode=$y,e.distbits=5},$E=(e,t,r,s)=>{let a;const i=e.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),s>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>s&&(a=s),i.window.set(t.subarray(r-s,r-s+a),i.wnext),s-=a,s?(i.window.set(t.subarray(r-s,r),0),i.wnext=s,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0},VQ=(e,t)=>{let r,s,a,i,o,l,c,d,u,h,p,f,x,g,y=0,m,w,S,k,F,L,C,O;const T=new Uint8Array(4);let W,A;const N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Wu(e)||!e.output||!e.input&&e.avail_in!==0)return Ko;r=e.state,r.mode===ac&&(r.mode=Oy),o=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,s=e.input,l=e.avail_in,d=r.hold,u=r.bits,h=l,p=c,O=Cu;e:for(;;)switch(r.mode){case wg:if(r.wrap===0){r.mode=Oy;break}for(;u<16;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(r.wrap&2&&d===35615){r.wbits===0&&(r.wbits=15),r.check=0,T[0]=d&255,T[1]=d>>>8&255,r.check=Ml(r.check,T,2,0),d=0,u=0,r.mode=Vk;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((d&255)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=Es;break}if((d&15)!==Hk){e.msg="unknown compression method",r.mode=Es;break}if(d>>>=4,u-=4,C=(d&15)+8,r.wbits===0&&(r.wbits=C),C>15||C>r.wbits){e.msg="invalid window size",r.mode=Es;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=d&512?ej:ac,d=0,u=0;break;case Vk:for(;u<16;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(r.flags=d,(r.flags&255)!==Hk){e.msg="unknown compression method",r.mode=Es;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=Es;break}r.head&&(r.head.text=d>>8&1),r.flags&512&&r.wrap&4&&(T[0]=d&255,T[1]=d>>>8&255,r.check=Ml(r.check,T,2,0)),d=0,u=0,r.mode=Gk;case Gk:for(;u<32;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}r.head&&(r.head.time=d),r.flags&512&&r.wrap&4&&(T[0]=d&255,T[1]=d>>>8&255,T[2]=d>>>16&255,T[3]=d>>>24&255,r.check=Ml(r.check,T,4,0)),d=0,u=0,r.mode=Qk;case Qk:for(;u<16;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}r.head&&(r.head.xflags=d&255,r.head.os=d>>8),r.flags&512&&r.wrap&4&&(T[0]=d&255,T[1]=d>>>8&255,r.check=Ml(r.check,T,2,0)),d=0,u=0,r.mode=Xk;case Xk:if(r.flags&1024){for(;u<16;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}r.length=d,r.head&&(r.head.extra_len=d),r.flags&512&&r.wrap&4&&(T[0]=d&255,T[1]=d>>>8&255,r.check=Ml(r.check,T,2,0)),d=0,u=0}else r.head&&(r.head.extra=null);r.mode=Yk;case Yk:if(r.flags&1024&&(f=r.length,f>l&&(f=l),f&&(r.head&&(C=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(i,i+f),C)),r.flags&512&&r.wrap&4&&(r.check=Ml(r.check,s,f,i)),l-=f,i+=f,r.length-=f),r.length))break e;r.length=0,r.mode=Kk;case Kk:if(r.flags&2048){if(l===0)break e;f=0;do C=s[i+f++],r.head&&C&&r.length<65536&&(r.head.name+=String.fromCharCode(C));while(C&&f<l);if(r.flags&512&&r.wrap&4&&(r.check=Ml(r.check,s,f,i)),l-=f,i+=f,C)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Jk;case Jk:if(r.flags&4096){if(l===0)break e;f=0;do C=s[i+f++],r.head&&C&&r.length<65536&&(r.head.comment+=String.fromCharCode(C));while(C&&f<l);if(r.flags&512&&r.wrap&4&&(r.check=Ml(r.check,s,f,i)),l-=f,i+=f,C)break e}else r.head&&(r.head.comment=null);r.mode=Zk;case Zk:if(r.flags&512){for(;u<16;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(r.wrap&4&&d!==(r.check&65535)){e.msg="header crc mismatch",r.mode=Es;break}d=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=ac;break;case ej:for(;u<32;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}e.adler=r.check=hj(d),d=0,u=0,r.mode=F1;case F1:if(r.havedict===0)return e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=l,r.hold=d,r.bits=u,OQ;e.adler=r.check=1,r.mode=ac;case ac:if(t===BQ||t===qm)break e;case Oy:if(r.last){d>>>=u&7,u-=u&7,r.mode=Dy;break}for(;u<3;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}switch(r.last=d&1,d>>>=1,u-=1,d&3){case 0:r.mode=tj;break;case 1:if(HQ(r),r.mode=Hm,t===qm){d>>>=2,u-=2;break e}break;case 2:r.mode=nj;break;case 3:e.msg="invalid block type",r.mode=Es}d>>>=2,u-=2;break;case tj:for(d>>>=u&7,u-=u&7;u<32;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if((d&65535)!==(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Es;break}if(r.length=d&65535,d=0,u=0,r.mode=Iy,t===qm)break e;case Iy:r.mode=rj;case rj:if(f=r.length,f){if(f>l&&(f=l),f>c&&(f=c),f===0)break e;a.set(s.subarray(i,i+f),o),l-=f,i+=f,c-=f,o+=f,r.length-=f;break}r.mode=ac;break;case nj:for(;u<14;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(r.nlen=(d&31)+257,d>>>=5,u-=5,r.ndist=(d&31)+1,d>>>=5,u-=5,r.ncode=(d&15)+4,d>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Es;break}r.have=0,r.mode=sj;case sj:for(;r.have<r.ncode;){for(;u<3;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}r.lens[N[r.have++]]=d&7,d>>>=3,u-=3}for(;r.have<19;)r.lens[N[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,W={bits:r.lenbits},O=Ih(RQ,r.lens,0,19,r.lencode,0,r.work,W),r.lenbits=W.bits,O){e.msg="invalid code lengths set",r.mode=Es;break}r.have=0,r.mode=aj;case aj:for(;r.have<r.nlen+r.ndist;){for(;y=r.lencode[d&(1<<r.lenbits)-1],m=y>>>24,w=y>>>16&255,S=y&65535,!(m<=u);){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(S<16)d>>>=m,u-=m,r.lens[r.have++]=S;else{if(S===16){for(A=m+2;u<A;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(d>>>=m,u-=m,r.have===0){e.msg="invalid bit length repeat",r.mode=Es;break}C=r.lens[r.have-1],f=3+(d&3),d>>>=2,u-=2}else if(S===17){for(A=m+3;u<A;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}d>>>=m,u-=m,C=0,f=3+(d&7),d>>>=3,u-=3}else{for(A=m+7;u<A;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}d>>>=m,u-=m,C=0,f=11+(d&127),d>>>=7,u-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Es;break}for(;f--;)r.lens[r.have++]=C}}if(r.mode===Es)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Es;break}if(r.lenbits=9,W={bits:r.lenbits},O=Ih(LE,r.lens,0,r.nlen,r.lencode,0,r.work,W),r.lenbits=W.bits,O){e.msg="invalid literal/lengths set",r.mode=Es;break}if(r.distbits=6,r.distcode=r.distdyn,W={bits:r.distbits},O=Ih(FE,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,W),r.distbits=W.bits,O){e.msg="invalid distances set",r.mode=Es;break}if(r.mode=Hm,t===qm)break e;case Hm:r.mode=Vm;case Vm:if(l>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=l,r.hold=d,r.bits=u,CQ(e,p),o=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,s=e.input,l=e.avail_in,d=r.hold,u=r.bits,r.mode===ac&&(r.back=-1);break}for(r.back=0;y=r.lencode[d&(1<<r.lenbits)-1],m=y>>>24,w=y>>>16&255,S=y&65535,!(m<=u);){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(w&&!(w&240)){for(k=m,F=w,L=S;y=r.lencode[L+((d&(1<<k+F)-1)>>k)],m=y>>>24,w=y>>>16&255,S=y&65535,!(k+m<=u);){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}d>>>=k,u-=k,r.back+=k}if(d>>>=m,u-=m,r.back+=m,r.length=S,w===0){r.mode=dj;break}if(w&32){r.back=-1,r.mode=ac;break}if(w&64){e.msg="invalid literal/length code",r.mode=Es;break}r.extra=w&15,r.mode=ij;case ij:if(r.extra){for(A=r.extra;u<A;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=oj;case oj:for(;y=r.distcode[d&(1<<r.distbits)-1],m=y>>>24,w=y>>>16&255,S=y&65535,!(m<=u);){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(!(w&240)){for(k=m,F=w,L=S;y=r.distcode[L+((d&(1<<k+F)-1)>>k)],m=y>>>24,w=y>>>16&255,S=y&65535,!(k+m<=u);){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}d>>>=k,u-=k,r.back+=k}if(d>>>=m,u-=m,r.back+=m,w&64){e.msg="invalid distance code",r.mode=Es;break}r.offset=S,r.extra=w&15,r.mode=lj;case lj:if(r.extra){for(A=r.extra;u<A;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Es;break}r.mode=cj;case cj:if(c===0)break e;if(f=p-c,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Es;break}f>r.wnext?(f-=r.wnext,x=r.wsize-f):x=r.wnext-f,f>r.length&&(f=r.length),g=r.window}else g=a,x=o-r.offset,f=r.length;f>c&&(f=c),c-=f,r.length-=f;do a[o++]=g[x++];while(--f);r.length===0&&(r.mode=Vm);break;case dj:if(c===0)break e;a[o++]=r.length,c--,r.mode=Vm;break;case Dy:if(r.wrap){for(;u<32;){if(l===0)break e;l--,d|=s[i++]<<u,u+=8}if(p-=c,e.total_out+=p,r.total+=p,r.wrap&4&&p&&(e.adler=r.check=r.flags?Ml(r.check,a,p,o-p):O2(r.check,a,p,o-p)),p=c,r.wrap&4&&(r.flags?d:hj(d))!==r.check){e.msg="incorrect data check",r.mode=Es;break}d=0,u=0}r.mode=uj;case uj:if(r.wrap&&r.flags){for(;u<32;){if(l===0)break e;l--,d+=s[i++]<<u,u+=8}if(r.wrap&4&&d!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=Es;break}d=0,u=0}r.mode=fj;case fj:O=PQ;break e;case Es:O=ME;break e;case BE:return RE;case PE:default:return Ko}return e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=l,r.hold=d,r.bits=u,(r.wsize||p!==e.avail_out&&r.mode<Es&&(r.mode<Dy||t!==qk))&&$E(e,e.output,e.next_out,p-e.avail_out),h-=e.avail_in,p-=e.avail_out,e.total_in+=h,e.total_out+=p,r.total+=p,r.wrap&4&&p&&(e.adler=r.check=r.flags?Ml(r.check,a,p,e.next_out-p):O2(r.check,a,p,e.next_out-p)),e.data_type=r.bits+(r.last?64:0)+(r.mode===ac?128:0)+(r.mode===Hm||r.mode===Iy?256:0),(h===0&&p===0||t===qk)&&O===Cu&&(O=IQ),O},GQ=e=>{if(Wu(e))return Ko;let t=e.state;return t.window&&(t.window=null),e.state=null,Cu},QQ=(e,t)=>{if(Wu(e))return Ko;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,Cu):Ko},XQ=(e,t)=>{const r=t.length;let s,a,i;return Wu(e)||(s=e.state,s.wrap!==0&&s.mode!==F1)?Ko:s.mode===F1&&(a=1,a=O2(a,t,r,0),a!==s.check)?ME:(i=$E(e,t,r,r),i?(s.mode=BE,RE):(s.havedict=1,Cu))};var YQ=IE,KQ=DE,JQ=OE,ZQ=qQ,eX=UE,tX=VQ,rX=GQ,nX=QQ,sX=XQ,aX="pako inflate (from Nodeca project)",fc={inflateReset:YQ,inflateReset2:KQ,inflateResetKeep:JQ,inflateInit:ZQ,inflateInit2:eX,inflate:tX,inflateEnd:rX,inflateGetHeader:nX,inflateSetDictionary:sX,inflateInfo:aX};function iX(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var oX=iX;const WE=Object.prototype.toString,{Z_NO_FLUSH:lX,Z_FINISH:cX,Z_OK:kp,Z_STREAM_END:Wy,Z_NEED_DICT:zy,Z_STREAM_ERROR:dX,Z_DATA_ERROR:mj,Z_MEM_ERROR:uX}=CE;function Gp(e){this.options=EE.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new NQ,this.strm.avail_out=0;let r=fc.inflateInit2(this.strm,t.windowBits);if(r!==kp)throw new Error(I2[r]);if(this.header=new oX,fc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=D2.string2buf(t.dictionary):WE.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=fc.inflateSetDictionary(this.strm,t.dictionary),r!==kp)))throw new Error(I2[r])}Gp.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize,a=this.options.dictionary;let i,o,l;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?cX:lX,WE.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),i=fc.inflate(r,o),i===zy&&a&&(i=fc.inflateSetDictionary(r,a),i===kp?i=fc.inflate(r,o):i===mj&&(i=zy));r.avail_in>0&&i===Wy&&r.state.wrap>0&&e[r.next_in]!==0;)fc.inflateReset(r),i=fc.inflate(r,o);switch(i){case dX:case mj:case zy:case uX:return this.onEnd(i),this.ended=!0,!1}if(l=r.avail_out,r.next_out&&(r.avail_out===0||i===Wy))if(this.options.to==="string"){let c=D2.utf8border(r.output,r.next_out),d=r.next_out-c,u=D2.buf2string(r.output,c);r.next_out=d,r.avail_out=s-d,d&&r.output.set(r.output.subarray(c,c+d),0),this.onData(u)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(i===kp&&l===0)){if(i===Wy)return i=fc.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Gp.prototype.onData=function(e){this.chunks.push(e)};Gp.prototype.onEnd=function(e){e===kp&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=EE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function fX(e,t){const r=new Gp(t);if(r.push(e),r.err)throw r.msg||I2[r.err];return r.result}var hX=Gp,pX=fX,mX={Inflate:hX,inflate:pX};const{Inflate:xX,inflate:gX}=mX;var xj=xX,yX=gX;const zE=[];for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;zE[e]=t}const gj=4294967295;function bX(e,t,r){let s=e;for(let a=0;a<r;a++)s=zE[(s^t[a])&255]^s>>>8;return s}function vX(e,t){return(bX(gj,e,t)^gj)>>>0}function yj(e,t,r){const s=e.readUint32(),a=vX(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(a!==s)throw new Error(`CRC mismatch for chunk ${r}. Expected ${s}, found ${a}`)}function qE(e,t,r){for(let s=0;s<r;s++)t[s]=e[s]}function HE(e,t,r,s){let a=0;for(;a<s;a++)t[a]=e[a];for(;a<r;a++)t[a]=e[a]+t[a-s]&255}function VE(e,t,r,s){let a=0;if(r.length===0)for(;a<s;a++)t[a]=e[a];else for(;a<s;a++)t[a]=e[a]+r[a]&255}function GE(e,t,r,s,a){let i=0;if(r.length===0){for(;i<a;i++)t[i]=e[i];for(;i<s;i++)t[i]=e[i]+(t[i-a]>>1)&255}else{for(;i<a;i++)t[i]=e[i]+(r[i]>>1)&255;for(;i<s;i++)t[i]=e[i]+(t[i-a]+r[i]>>1)&255}}function QE(e,t,r,s,a){let i=0;if(r.length===0){for(;i<a;i++)t[i]=e[i];for(;i<s;i++)t[i]=e[i]+t[i-a]&255}else{for(;i<a;i++)t[i]=e[i]+r[i]&255;for(;i<s;i++)t[i]=e[i]+wX(t[i-a],r[i],r[i-a])&255}}function wX(e,t,r){const s=e+t-r,a=Math.abs(s-e),i=Math.abs(s-t),o=Math.abs(s-r);return a<=i&&a<=o?e:i<=o?t:r}function SX(e,t,r,s,a,i){switch(e){case 0:qE(t,r,a);break;case 1:HE(t,r,a,i);break;case 2:VE(t,r,s,a);break;case 3:GE(t,r,s,a,i);break;case 4:QE(t,r,s,a,i);break;default:throw new Error(`Unsupported filter: ${e}`)}}const _X=new Uint16Array([255]),kX=new Uint8Array(_X.buffer),jX=kX[0]===255;function NX(e){const{data:t,width:r,height:s,channels:a,depth:i}=e,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(i/8)*a,c=new Uint8Array(s*r*l);let d=0;for(let u=0;u<7;u++){const h=o[u],p=Math.ceil((r-h.x)/h.xStep),f=Math.ceil((s-h.y)/h.yStep);if(p<=0||f<=0)continue;const x=p*l,g=new Uint8Array(x);for(let y=0;y<f;y++){const m=t[d++],w=t.subarray(d,d+x);d+=x;const S=new Uint8Array(x);SX(m,w,S,g,x,l),g.set(S);for(let k=0;k<p;k++){const F=h.x+k*h.xStep,L=h.y+y*h.yStep;if(!(F>=r||L>=s))for(let C=0;C<l;C++)c[(L*r+F)*l+C]=S[k*l+C]}}}if(i===16){const u=new Uint16Array(c.buffer);if(jX)for(let h=0;h<u.length;h++)u[h]=AX(u[h]);return u}else return c}function AX(e){return(e&255)<<8|e>>8&255}const CX=new Uint16Array([255]),EX=new Uint8Array(CX.buffer),TX=EX[0]===255,LX=new Uint8Array(0);function bj(e){const{data:t,width:r,height:s,channels:a,depth:i}=e,o=Math.ceil(i/8)*a,l=Math.ceil(i/8*a*r),c=new Uint8Array(s*l);let d=LX,u=0,h,p;for(let f=0;f<s;f++){switch(h=t.subarray(u+1,u+1+l),p=c.subarray(f*l,(f+1)*l),t[u]){case 0:qE(h,p,l);break;case 1:HE(h,p,l,o);break;case 2:VE(h,p,d,l);break;case 3:GE(h,p,d,l,o);break;case 4:QE(h,p,d,l,o);break;default:throw new Error(`Unsupported filter: ${t[u]}`)}d=p,u+=l+1}if(i===16){const f=new Uint16Array(c.buffer);if(TX)for(let x=0;x<f.length;x++)f[x]=FX(f[x]);return f}else return c}function FX(e){return(e&255)<<8|e>>8&255}const Ex=Uint8Array.of(137,80,78,71,13,10,26,10);function vj(e){if(!MX(e.readBytes(Ex.length)))throw new Error("wrong PNG signature")}function MX(e){if(e.length<Ex.length)return!1;for(let t=0;t<Ex.length;t++)if(e[t]!==Ex[t])return!1;return!0}const RX="tEXt",BX=0,XE=new TextDecoder("latin1");function PX(e){if(IX(e),e.length===0||e.length>79)throw new Error("keyword length must be between 1 and 79")}const OX=/^[\u0000-\u00FF]*$/;function IX(e){if(!OX.test(e))throw new Error("invalid latin1 text")}function DX(e,t,r){const s=YE(t);e[s]=UX(t,r-s.length-1)}function YE(e){for(e.mark();e.readByte()!==BX;);const t=e.offset;e.reset();const r=XE.decode(e.readBytes(t-e.offset-1));return e.skip(1),PX(r),r}function UX(e,t){return XE.decode(e.readBytes(t))}const co={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},qy={UNKNOWN:-1,DEFLATE:0},wj={UNKNOWN:-1,ADAPTIVE:0},Hy={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Gm={NONE:0,BACKGROUND:1,PREVIOUS:2},Vy={SOURCE:0,OVER:1};class $X extends Qw{constructor(r,s={}){super(r);os(this,"_checkCrc");os(this,"_inflator");os(this,"_png");os(this,"_apng");os(this,"_end");os(this,"_hasPalette");os(this,"_palette");os(this,"_hasTransparency");os(this,"_transparency");os(this,"_compressionMethod");os(this,"_filterMethod");os(this,"_interlaceMethod");os(this,"_colorType");os(this,"_isAnimated");os(this,"_numberOfFrames");os(this,"_numberOfPlays");os(this,"_frames");os(this,"_writingDataChunks");const{checkCrc:a=!1}=s;this._checkCrc=a,this._inflator=new xj,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=qy.UNKNOWN,this._filterMethod=wj.UNKNOWN,this._interlaceMethod=Hy.UNKNOWN,this._colorType=co.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(vj(this);!this._end;){const r=this.readUint32(),s=this.readChars(4);this.decodeChunk(r,s)}return this.decodeImage(),this._png}decodeApng(){for(vj(this);!this._end;){const r=this.readUint32(),s=this.readChars(4);this.decodeApngChunk(r,s)}return this.decodeApngImage(),this._apng}decodeChunk(r,s){const a=this.offset;switch(s){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(r);break;case"iCCP":this.decodeiCCP(r);break;case RX:DX(this._png.text,this,r);break;case"pHYs":this.decodepHYs();break;default:this.skip(r);break}if(this.offset-a!==r)throw new Error(`Length mismatch while decoding chunk ${s}`);this._checkCrc?yj(this,r+4,s):this.skip(4)}decodeApngChunk(r,s){const a=this.offset;switch(s!=="fdAT"&&s!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),s){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(r);break;default:this.decodeChunk(r,s),this.offset=a+r;break}if(this.offset-a!==r)throw new Error(`Length mismatch while decoding chunk ${s}`);this._checkCrc?yj(this,r+4,s):this.skip(4)}decodeIHDR(){const r=this._png;r.width=this.readUint32(),r.height=this.readUint32(),r.depth=WX(this.readUint8());const s=this.readUint8();this._colorType=s;let a;switch(s){case co.GREYSCALE:a=1;break;case co.TRUECOLOUR:a=3;break;case co.INDEXED_COLOUR:a=1;break;case co.GREYSCALE_ALPHA:a=2;break;case co.TRUECOLOUR_ALPHA:a=4;break;case co.UNKNOWN:default:throw new Error(`Unknown color type: ${s}`)}if(this._png.channels=a,this._compressionMethod=this.readUint8(),this._compressionMethod!==qy.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const r={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(r)}decodePLTE(r){if(r%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${r}`);const s=r/3;this._hasPalette=!0;const a=[];this._palette=a;for(let i=0;i<s;i++)a.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(r){this._writingDataChunks=!0;const s=r,a=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,a,s)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodeFDAT(r){this._writingDataChunks=!0;let s=r,a=this.offset+this.byteOffset;if(a+=4,s-=4,this._inflator.push(new Uint8Array(this.buffer,a,s)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodetRNS(r){switch(this._colorType){case co.GREYSCALE:case co.TRUECOLOUR:{if(r%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${r}`);if(r/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${r/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(r/2);for(let s=0;s<r/2;s++)this._transparency[s]=this.readUint16();break}case co.INDEXED_COLOUR:{if(r>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${r} vs ${this._palette.length})`);let s=0;for(;s<r;s++){const a=this.readByte();this._palette[s].push(a)}for(;s<this._palette.length;s++)this._palette[s].push(255);break}case co.UNKNOWN:case co.GREYSCALE_ALPHA:case co.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(r){const s=YE(this),a=this.readUint8();if(a!==qy.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const i=this.readBytes(r-s.length-2);this._png.iccEmbeddedProfile={name:s,profile:yX(i)}}decodepHYs(){const r=this.readUint32(),s=this.readUint32(),a=this.readByte();this._png.resolution={x:r,y:s,unit:a}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let r=0;r<this._numberOfFrames;r++){const s={sequenceNumber:this._frames[r].sequenceNumber,delayNumber:this._frames[r].delayNumber,delayDenominator:this._frames[r].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},a=this._frames.at(r);if(a){if(a.data=bj({data:a.data,width:a.width,height:a.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),r===0||a.xOffset===0&&a.yOffset===0&&a.width===this._png.width&&a.height===this._png.height)s.data=a.data;else{const i=this._apng.frames.at(r-1);this.disposeFrame(a,i,s),this.addFrameDataToCanvas(s,a)}this._apng.frames.push(s)}}return this._apng}disposeFrame(r,s,a){switch(r.disposeOp){case Gm.NONE:break;case Gm.BACKGROUND:for(let i=0;i<this._png.height;i++)for(let o=0;o<this._png.width;o++){const l=(i*r.width+o)*this._png.channels;for(let c=0;c<this._png.channels;c++)a.data[l+c]=0}break;case Gm.PREVIOUS:a.data.set(s.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(r,s){const a=1<<this._png.depth,i=(o,l)=>{const c=((o+s.yOffset)*this._png.width+s.xOffset+l)*this._png.channels,d=(o*s.width+l)*this._png.channels;return{index:c,frameIndex:d}};switch(s.blendOp){case Vy.SOURCE:for(let o=0;o<s.height;o++)for(let l=0;l<s.width;l++){const{index:c,frameIndex:d}=i(o,l);for(let u=0;u<this._png.channels;u++)r.data[c+u]=s.data[d+u]}break;case Vy.OVER:for(let o=0;o<s.height;o++)for(let l=0;l<s.width;l++){const{index:c,frameIndex:d}=i(o,l);for(let u=0;u<this._png.channels;u++){const h=s.data[d+this._png.channels-1]/a,p=u%(this._png.channels-1)===0?1:s.data[d+u],f=Math.floor(h*p+(1-h)*r.data[c+u]);r.data[c+u]+=f}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var s;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const r=this._isAnimated?((s=this._frames)==null?void 0:s.at(0)).data:this._inflator.result;if(this._filterMethod!==wj.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===Hy.NO_INTERLACE)this._png.data=bj({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===Hy.ADAM7)this._png.data=NX({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const r=this._inflator.result,s=this._frames.at(-1);s?s.data=r:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Gm.NONE,blendOp:Vy.SOURCE,data:r}),this._inflator=new xj,this._writingDataChunks=!1}}function WX(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}var Sj;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(Sj||(Sj={}));function zX(e,t){return new $X(e,t).decode()}var jn=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function Gy(){jn.console&&typeof jn.console.log=="function"&&jn.console.log.apply(jn.console,arguments)}var ys={log:Gy,warn:function(e){jn.console&&(typeof jn.console.warn=="function"?jn.console.warn.apply(jn.console,arguments):Gy.call(null,arguments))},error:function(e){jn.console&&(typeof jn.console.error=="function"?jn.console.error.apply(jn.console,arguments):Gy(e))}};function Qy(e,t,r){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){Xd(s.response,t,r)},s.onerror=function(){ys.error("could not download file")},s.send()}function _j(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Qm(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var Xd=jn.saveAs||((typeof window>"u"?"undefined":ds(window))!=="object"||window!==jn?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var s=jn.URL||jn.webkitURL,a=document.createElement("a");t=t||e.name||"download",a.download=t,a.rel="noopener",typeof e=="string"?(a.href=e,a.origin!==location.origin?_j(a.href)?Qy(e,t,r):Qm(a,a.target="_blank"):Qm(a)):(a.href=s.createObjectURL(e),setTimeout(function(){s.revokeObjectURL(a.href)},4e4),setTimeout(function(){Qm(a)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(_j(e))Qy(e,t,r);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout(function(){Qm(s)})}else navigator.msSaveOrOpenBlob(function(a,i){return i===void 0?i={autoBom:!1}:ds(i)!=="object"&&(ys.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}(e,r),t)}:function(e,t,r,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),typeof e=="string")return Qy(e,t,r);var a=e.type==="application/octet-stream",i=/constructor/i.test(jn.HTMLElement)||jn.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||a&&i)&&(typeof FileReader>"u"?"undefined":ds(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var u=l.result;u=o?u:u.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=u:location=u,s=null},l.readAsDataURL(e)}else{var c=jn.URL||jn.webkitURL,d=c.createObjectURL(e);s?s.location=d:location.href=d,s=null,setTimeout(function(){c.revokeObjectURL(d)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function KE(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],s=0;s<r.length;s++){var a=r[s].re,i=r[s].process,o=a.exec(e);o&&(t=i(o),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),d=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),d.length==1&&(d="0"+d),"#"+l+c+d}}var Tx=jn.atob.bind(jn),kj=jn.btoa.bind(jn);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function Xy(e,t){var r=e[0],s=e[1],a=e[2],i=e[3];r=ii(r,s,a,i,t[0],7,-680876936),i=ii(i,r,s,a,t[1],12,-389564586),a=ii(a,i,r,s,t[2],17,606105819),s=ii(s,a,i,r,t[3],22,-1044525330),r=ii(r,s,a,i,t[4],7,-176418897),i=ii(i,r,s,a,t[5],12,1200080426),a=ii(a,i,r,s,t[6],17,-1473231341),s=ii(s,a,i,r,t[7],22,-45705983),r=ii(r,s,a,i,t[8],7,1770035416),i=ii(i,r,s,a,t[9],12,-1958414417),a=ii(a,i,r,s,t[10],17,-42063),s=ii(s,a,i,r,t[11],22,-1990404162),r=ii(r,s,a,i,t[12],7,1804603682),i=ii(i,r,s,a,t[13],12,-40341101),a=ii(a,i,r,s,t[14],17,-1502002290),r=oi(r,s=ii(s,a,i,r,t[15],22,1236535329),a,i,t[1],5,-165796510),i=oi(i,r,s,a,t[6],9,-1069501632),a=oi(a,i,r,s,t[11],14,643717713),s=oi(s,a,i,r,t[0],20,-373897302),r=oi(r,s,a,i,t[5],5,-701558691),i=oi(i,r,s,a,t[10],9,38016083),a=oi(a,i,r,s,t[15],14,-660478335),s=oi(s,a,i,r,t[4],20,-405537848),r=oi(r,s,a,i,t[9],5,568446438),i=oi(i,r,s,a,t[14],9,-1019803690),a=oi(a,i,r,s,t[3],14,-187363961),s=oi(s,a,i,r,t[8],20,1163531501),r=oi(r,s,a,i,t[13],5,-1444681467),i=oi(i,r,s,a,t[2],9,-51403784),a=oi(a,i,r,s,t[7],14,1735328473),r=li(r,s=oi(s,a,i,r,t[12],20,-1926607734),a,i,t[5],4,-378558),i=li(i,r,s,a,t[8],11,-2022574463),a=li(a,i,r,s,t[11],16,1839030562),s=li(s,a,i,r,t[14],23,-35309556),r=li(r,s,a,i,t[1],4,-1530992060),i=li(i,r,s,a,t[4],11,1272893353),a=li(a,i,r,s,t[7],16,-155497632),s=li(s,a,i,r,t[10],23,-1094730640),r=li(r,s,a,i,t[13],4,681279174),i=li(i,r,s,a,t[0],11,-358537222),a=li(a,i,r,s,t[3],16,-722521979),s=li(s,a,i,r,t[6],23,76029189),r=li(r,s,a,i,t[9],4,-640364487),i=li(i,r,s,a,t[12],11,-421815835),a=li(a,i,r,s,t[15],16,530742520),r=ci(r,s=li(s,a,i,r,t[2],23,-995338651),a,i,t[0],6,-198630844),i=ci(i,r,s,a,t[7],10,1126891415),a=ci(a,i,r,s,t[14],15,-1416354905),s=ci(s,a,i,r,t[5],21,-57434055),r=ci(r,s,a,i,t[12],6,1700485571),i=ci(i,r,s,a,t[3],10,-1894986606),a=ci(a,i,r,s,t[10],15,-1051523),s=ci(s,a,i,r,t[1],21,-2054922799),r=ci(r,s,a,i,t[8],6,1873313359),i=ci(i,r,s,a,t[15],10,-30611744),a=ci(a,i,r,s,t[6],15,-1560198380),s=ci(s,a,i,r,t[13],21,1309151649),r=ci(r,s,a,i,t[4],6,-145523070),i=ci(i,r,s,a,t[11],10,-1120210379),a=ci(a,i,r,s,t[2],15,718787259),s=ci(s,a,i,r,t[9],21,-343485551),e[0]=ud(r,e[0]),e[1]=ud(s,e[1]),e[2]=ud(a,e[2]),e[3]=ud(i,e[3])}function Sg(e,t,r,s,a,i){return t=ud(ud(t,e),ud(s,i)),ud(t<<a|t>>>32-a,r)}function ii(e,t,r,s,a,i,o){return Sg(t&r|~t&s,e,t,a,i,o)}function oi(e,t,r,s,a,i,o){return Sg(t&s|r&~s,e,t,a,i,o)}function li(e,t,r,s,a,i,o){return Sg(t^r^s,e,t,a,i,o)}function ci(e,t,r,s,a,i,o){return Sg(r^(t|~s),e,t,a,i,o)}function JE(e){var t,r=e.length,s=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)Xy(s,qX(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(Xy(s,a),t=0;t<16;t++)a[t]=0;return a[14]=8*r,Xy(s,a),s}function qX(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}var jj="0123456789abcdef".split("");function HX(e){for(var t="",r=0;r<4;r++)t+=jj[e>>8*r+4&15]+jj[e>>8*r&15];return t}function VX(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function U2(e){return JE(e).map(VX).join("")}var GX=function(e){for(var t=0;t<e.length;t++)e[t]=HX(e[t]);return e.join("")}(JE("hello"))!="5d41402abc4b2a76b9719d911017c592";function ud(e,t){if(GX){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function $2(e,t){var r,s,a,i;if(e!==r){for(var o=(a=e,i=1+(256/e.length|0),new Array(i+1).join(a)),l=[],c=0;c<256;c++)l[c]=c;var d=0;for(c=0;c<256;c++){var u=l[c];d=(d+u+o.charCodeAt(c))%256,l[c]=l[d],l[d]=u}r=e,s=l}else l=s;var h=t.length,p=0,f=0,x="";for(c=0;c<h;c++)f=(f+(u=l[p=(p+1)%256]))%256,l[p]=l[f],l[f]=u,o=l[(l[p]+l[f])%256],x+=String.fromCharCode(t.charCodeAt(c)^o);return x}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var Nj={print:4,modify:8,copy:16,"annot-forms":32};function mf(e,t,r,s){this.v=1,this.r=2;var a=192;e.forEach(function(l){if(Nj.perm!==void 0)throw new Error("Invalid permission: "+l);a+=Nj[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var i=(t+this.padding).substr(0,32),o=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,o),this.P=-(1+(255^a)),this.encryptionKey=U2(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(s)).substr(0,5),this.U=$2(this.encryptionKey,this.padding)}function xf(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,s=0;s<r;s++){var a=e.charCodeAt(s);t+=a<33||a===35||a===37||a===40||a===41||a===47||a===60||a===62||a===91||a===93||a===123||a===125||a>126?"#"+("0"+a.toString(16)).slice(-2):e[s]}return t}function Aj(e){if(ds(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,s,a){if(a=a||!1,typeof r!="string"||typeof s!="function"||typeof a!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var i=Math.random().toString(35);return t[r][i]=[s,!!a],i},this.unsubscribe=function(r){for(var s in t)if(t[s][r])return delete t[s][r],Object.keys(t[s]).length===0&&delete t[s],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var s=Array.prototype.slice.call(arguments,1),a=[];for(var i in t[r]){var o=t[r][i];try{o[0].apply(e,s)}catch(l){jn.console&&ys.error("jsPDF PubSub Error",l.message,l)}o[1]&&a.push(i)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function M1(e){if(!(this instanceof M1))return new M1(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function ZE(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Kd(e,t,r,s,a){if(!(this instanceof Kd))return new Kd(e,t,r,s,a);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,ZE.call(this,s,a)}function Mf(e,t,r,s,a){if(!(this instanceof Mf))return new Mf(e,t,r,s,a);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,ZE.call(this,s,a)}function un(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",s=arguments[1],a=arguments[2],i=arguments[3],o=[],l=1,c=16,d="S",u=null;ds(e=e||{})==="object"&&(r=e.orientation,s=e.unit||s,a=e.format||a,i=e.compress||e.compressPdf||i,(u=e.encryption||null)!==null&&(u.userPassword=u.userPassword||"",u.ownerPassword=u.ownerPassword||"",u.userPermissions=u.userPermissions||[]),l=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(c=e.floatPrecision),d=e.defaultPathOperation||"S"),o=e.filters||(i===!0?["FlateEncode"]:o),s=s||"mm",r=(""+(r||"P")).toLowerCase();var h=e.putOnlyUsedFonts||!1,p={},f={internal:{},__private__:{}};f.__private__.PubSub=Aj;var x="1.3",g=f.__private__.getPdfVersion=function(){return x};f.__private__.setPdfVersion=function(j){x=j};var y={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};f.__private__.getPageFormats=function(){return y};var m=f.__private__.getPageFormat=function(j){return y[j]};a=a||"a4";var w="compat",S="advanced",k=w;function F(){this.saveGraphicsState(),D(new qe(we,0,0,-we,0,nr()*we).toString()+" cm"),this.setFontSize(this.getFontSize()/we),d="n",k=S}function L(){this.restoreGraphicsState(),d="S",k=w}var C=f.__private__.combineFontStyleAndFontWeight=function(j,ae){if(j=="bold"&&ae=="normal"||j=="bold"&&ae==400||j=="normal"&&ae=="italic"||j=="bold"&&ae=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ae&&(j=ae==400||ae==="normal"?j==="italic"?"italic":"normal":ae!=700&&ae!=="bold"||j!=="normal"?(ae==700?"bold":ae)+""+j:"bold"),j};f.advancedAPI=function(j){var ae=k===w;return ae&&F.call(this),typeof j!="function"||(j(this),ae&&L.call(this)),this},f.compatAPI=function(j){var ae=k===S;return ae&&L.call(this),typeof j!="function"||(j(this),ae&&F.call(this)),this},f.isAdvancedAPI=function(){return k===S};var O,T=function(j){if(k!==S)throw new Error(j+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},W=f.roundToPrecision=f.__private__.roundToPrecision=function(j,ae){var Ne=t||ae;if(isNaN(j)||isNaN(Ne))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return j.toFixed(Ne).replace(/0+$/,"")};O=f.hpf=f.__private__.hpf=typeof c=="number"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return W(j,c)}:c==="smart"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return W(j,j>-1&&j<1?16:5)}:function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return W(j,16)};var A=f.f2=f.__private__.f2=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f2");return W(j,2)},N=f.__private__.f3=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f3");return W(j,3)},P=f.scale=f.__private__.scale=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.scale");return k===w?j*we:k===S?j:void 0},K=function(j){return P(function(ae){return k===w?nr()-ae:k===S?ae:void 0}(j))};f.__private__.setPrecision=f.setPrecision=function(j){typeof parseInt(j,10)=="number"&&(t=parseInt(j,10))};var re,ge="00000000000000000000000000000000",Fe=f.__private__.getFileId=function(){return ge},R=f.__private__.setFileId=function(j){return ge=j!==void 0&&/^[a-fA-F0-9]{32}$/.test(j)?j.toUpperCase():ge.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),u!==null&&(Ht=new mf(u.userPermissions,u.userPassword,u.ownerPassword,ge)),ge};f.setFileId=function(j){return R(j),this},f.getFileId=function(){return Fe()};var q=f.__private__.convertDateToPDFDate=function(j){var ae=j.getTimezoneOffset(),Ne=ae<0?"+":"-",Xe=Math.floor(Math.abs(ae/60)),ut=Math.abs(ae%60),Jt=[Ne,I(Xe),"'",I(ut),"'"].join("");return["D:",j.getFullYear(),I(j.getMonth()+1),I(j.getDate()),I(j.getHours()),I(j.getMinutes()),I(j.getSeconds()),Jt].join("")},me=f.__private__.convertPDFDateToDate=function(j){var ae=parseInt(j.substr(2,4),10),Ne=parseInt(j.substr(6,2),10)-1,Xe=parseInt(j.substr(8,2),10),ut=parseInt(j.substr(10,2),10),Jt=parseInt(j.substr(12,2),10),ur=parseInt(j.substr(14,2),10);return new Date(ae,Ne,Xe,ut,Jt,ur,0)},fe=f.__private__.setCreationDate=function(j){var ae;if(j===void 0&&(j=new Date),j instanceof Date)ae=q(j);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(j))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ae=j}return re=ae},E=f.__private__.getCreationDate=function(j){var ae=re;return j==="jsDate"&&(ae=me(re)),ae};f.setCreationDate=function(j){return fe(j),this},f.getCreationDate=function(j){return E(j)};var U,I=f.__private__.padd2=function(j){return("0"+parseInt(j)).slice(-2)},M=f.__private__.padd2Hex=function(j){return("00"+(j=j.toString())).substr(j.length)},te=0,Q=[],G=[],ne=0,z=[],he=[],X=!1,H=G;f.__private__.setCustomOutputDestination=function(j){X=!0,H=j};var oe=function(j){X||(H=j)};f.__private__.resetCustomOutputDestination=function(){X=!1,H=G};var D=f.__private__.out=function(j){return j=j.toString(),ne+=j.length+1,H.push(j),H},Y=f.__private__.write=function(j){return D(arguments.length===1?j.toString():Array.prototype.join.call(arguments," "))},le=f.__private__.getArrayBuffer=function(j){for(var ae=j.length,Ne=new ArrayBuffer(ae),Xe=new Uint8Array(Ne);ae--;)Xe[ae]=j.charCodeAt(ae);return Ne},$e=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];f.__private__.getStandardFonts=function(){return $e};var je=e.fontSize||16;f.__private__.setFontSize=f.setFontSize=function(j){return je=k===S?j/we:j,this};var We,Ee=f.__private__.getFontSize=f.getFontSize=function(){return k===w?je:je*we},Re=e.R2L||!1;f.__private__.setR2L=f.setR2L=function(j){return Re=j,this},f.__private__.getR2L=f.getR2L=function(){return Re};var Ve,St=f.__private__.setZoomMode=function(j){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(j))We=j;else if(isNaN(j)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(j)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+j+'" is not recognized.');We=j}else We=parseInt(j,10)};f.__private__.getZoomMode=function(){return We};var rt,ze=f.__private__.setPageMode=function(j){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(j)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+j+'" is not recognized.');Ve=j};f.__private__.getPageMode=function(){return Ve};var Ie=f.__private__.setLayoutMode=function(j){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(j)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+j+'" is not recognized.');rt=j};f.__private__.getLayoutMode=function(){return rt},f.__private__.setDisplayMode=f.setDisplayMode=function(j,ae,Ne){return St(j),Ie(ae),ze(Ne),this};var ot={title:"",subject:"",author:"",keywords:"",creator:""};f.__private__.getDocumentProperty=function(j){if(Object.keys(ot).indexOf(j)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ot[j]},f.__private__.getDocumentProperties=function(){return ot},f.__private__.setDocumentProperties=f.setProperties=f.setDocumentProperties=function(j){for(var ae in ot)ot.hasOwnProperty(ae)&&j[ae]&&(ot[ae]=j[ae]);return this},f.__private__.setDocumentProperty=function(j,ae){if(Object.keys(ot).indexOf(j)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ot[j]=ae};var be,we,Me,Wt,Ct,pr={},fr={},Be=[],mt={},It={},ft={},gr={},Mr=null,$r=0,_r=[],Vr=new Aj(f),en=e.hotfixes||[],Xr={},gn={},Oe=[],qe=function j(ae,Ne,Xe,ut,Jt,ur){if(!(this instanceof j))return new j(ae,Ne,Xe,ut,Jt,ur);isNaN(ae)&&(ae=1),isNaN(Ne)&&(Ne=0),isNaN(Xe)&&(Xe=0),isNaN(ut)&&(ut=1),isNaN(Jt)&&(Jt=0),isNaN(ur)&&(ur=0),this._matrix=[ae,Ne,Xe,ut,Jt,ur]};Object.defineProperty(qe.prototype,"sx",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(qe.prototype,"shy",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(qe.prototype,"shx",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(qe.prototype,"sy",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(qe.prototype,"tx",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(qe.prototype,"ty",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(qe.prototype,"a",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(qe.prototype,"b",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(qe.prototype,"c",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(qe.prototype,"d",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(qe.prototype,"e",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(qe.prototype,"f",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(qe.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(qe.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(qe.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(qe.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),qe.prototype.join=function(j){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(O).join(j)},qe.prototype.multiply=function(j){var ae=j.sx*this.sx+j.shy*this.shx,Ne=j.sx*this.shy+j.shy*this.sy,Xe=j.shx*this.sx+j.sy*this.shx,ut=j.shx*this.shy+j.sy*this.sy,Jt=j.tx*this.sx+j.ty*this.shx+this.tx,ur=j.tx*this.shy+j.ty*this.sy+this.ty;return new qe(ae,Ne,Xe,ut,Jt,ur)},qe.prototype.decompose=function(){var j=this.sx,ae=this.shy,Ne=this.shx,Xe=this.sy,ut=this.tx,Jt=this.ty,ur=Math.sqrt(j*j+ae*ae),Kr=(j/=ur)*Ne+(ae/=ur)*Xe;Ne-=j*Kr,Xe-=ae*Kr;var Zr=Math.sqrt(Ne*Ne+Xe*Xe);return Kr/=Zr,j*(Xe/=Zr)<ae*(Ne/=Zr)&&(j=-j,ae=-ae,Kr=-Kr,ur=-ur),{scale:new qe(ur,0,0,Zr,0,0),translate:new qe(1,0,0,1,ut,Jt),rotate:new qe(j,ae,-ae,j,0,0),skew:new qe(1,0,Kr,1,0,0)}},qe.prototype.toString=function(j){return this.join(" ")},qe.prototype.inversed=function(){var j=this.sx,ae=this.shy,Ne=this.shx,Xe=this.sy,ut=this.tx,Jt=this.ty,ur=1/(j*Xe-ae*Ne),Kr=Xe*ur,Zr=-ae*ur,pn=-Ne*ur,wn=j*ur;return new qe(Kr,Zr,pn,wn,-Kr*ut-pn*Jt,-Zr*ut-wn*Jt)},qe.prototype.applyToPoint=function(j){var ae=j.x*this.sx+j.y*this.shx+this.tx,Ne=j.x*this.shy+j.y*this.sy+this.ty;return new rr(ae,Ne)},qe.prototype.applyToRectangle=function(j){var ae=this.applyToPoint(j),Ne=this.applyToPoint(new rr(j.x+j.w,j.y+j.h));return new vt(ae.x,ae.y,Ne.x-ae.x,Ne.y-ae.y)},qe.prototype.clone=function(){var j=this.sx,ae=this.shy,Ne=this.shx,Xe=this.sy,ut=this.tx,Jt=this.ty;return new qe(j,ae,Ne,Xe,ut,Jt)},f.Matrix=qe;var Lt=f.matrixMult=function(j,ae){return ae.multiply(j)},dt=new qe(1,0,0,1,0,0);f.unitMatrix=f.identityMatrix=dt;var He=function(j,ae){if(!It[j]){var Ne=(ae instanceof Kd?"Sh":"P")+(Object.keys(mt).length+1).toString(10);ae.id=Ne,It[j]=Ne,mt[Ne]=ae,Vr.publish("addPattern",ae)}};f.ShadingPattern=Kd,f.TilingPattern=Mf,f.addShadingPattern=function(j,ae){return T("addShadingPattern()"),He(j,ae),this},f.beginTilingPattern=function(j){T("beginTilingPattern()"),ir(j.boundingBox[0],j.boundingBox[1],j.boundingBox[2]-j.boundingBox[0],j.boundingBox[3]-j.boundingBox[1],j.matrix)},f.endTilingPattern=function(j,ae){T("endTilingPattern()"),ae.stream=he[U].join(`
`),He(j,ae),Vr.publish("endTilingPattern",ae),Oe.pop().restore()};var $t,Ue=f.__private__.newObject=function(){var j=er();return Z(j,!0),j},er=f.__private__.newObjectDeferred=function(){return te++,Q[te]=function(){return ne},te},Z=function(j,ae){return ae=typeof ae=="boolean"&&ae,Q[j]=ne,ae&&D(j+" 0 obj"),j},pe=f.__private__.newAdditionalObject=function(){var j={objId:er(),content:""};return z.push(j),j},ee=er(),ue=er(),Ae=f.__private__.decodeColorString=function(j){var ae=j.split(" ");if(ae.length!==2||ae[1]!=="g"&&ae[1]!=="G")ae.length!==5||ae[4]!=="k"&&ae[4]!=="K"||(ae=[(1-ae[0])*(1-ae[3]),(1-ae[1])*(1-ae[3]),(1-ae[2])*(1-ae[3]),"r"]);else{var Ne=parseFloat(ae[0]);ae=[Ne,Ne,Ne,"r"]}for(var Xe="#",ut=0;ut<3;ut++)Xe+=("0"+Math.floor(255*parseFloat(ae[ut])).toString(16)).slice(-2);return Xe},Le=f.__private__.encodeColorString=function(j){var ae;typeof j=="string"&&(j={ch1:j});var Ne=j.ch1,Xe=j.ch2,ut=j.ch3,Jt=j.ch4,ur=j.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ne=="string"&&Ne.charAt(0)!=="#"){var Kr=new KE(Ne);if(Kr.ok)Ne=Kr.toHex();else if(!/^\d*\.?\d*$/.test(Ne))throw new Error('Invalid color "'+Ne+'" passed to jsPDF.encodeColorString.')}if(typeof Ne=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ne)&&(Ne="#"+Ne[1]+Ne[1]+Ne[2]+Ne[2]+Ne[3]+Ne[3]),typeof Ne=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ne)){var Zr=parseInt(Ne.substr(1),16);Ne=Zr>>16&255,Xe=Zr>>8&255,ut=255&Zr}if(Xe===void 0||Jt===void 0&&Ne===Xe&&Xe===ut)ae=typeof Ne=="string"?Ne+" "+ur[0]:j.precision===2?A(Ne/255)+" "+ur[0]:N(Ne/255)+" "+ur[0];else if(Jt===void 0||ds(Jt)==="object"){if(Jt&&!isNaN(Jt.a)&&Jt.a===0)return["1.","1.","1.",ur[1]].join(" ");ae=typeof Ne=="string"?[Ne,Xe,ut,ur[1]].join(" "):j.precision===2?[A(Ne/255),A(Xe/255),A(ut/255),ur[1]].join(" "):[N(Ne/255),N(Xe/255),N(ut/255),ur[1]].join(" ")}else ae=typeof Ne=="string"?[Ne,Xe,ut,Jt,ur[2]].join(" "):j.precision===2?[A(Ne),A(Xe),A(ut),A(Jt),ur[2]].join(" "):[N(Ne),N(Xe),N(ut),N(Jt),ur[2]].join(" ");return ae},ct=f.__private__.getFilters=function(){return o},ce=f.__private__.putStream=function(j){var ae=(j=j||{}).data||"",Ne=j.filters||ct(),Xe=j.alreadyAppliedFilters||[],ut=j.addLength1||!1,Jt=ae.length,ur=j.objectId,Kr=function(ws){return ws};if(u!==null&&ur===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");u!==null&&(Kr=Ht.encryptor(ur,0));var Zr={};Ne===!0&&(Ne=["FlateEncode"]);var pn=j.additionalKeyValues||[],wn=(Zr=un.API.processDataByFilters!==void 0?un.API.processDataByFilters(ae,Ne):{data:ae,reverseChain:[]}).reverseChain+(Array.isArray(Xe)?Xe.join(" "):Xe.toString());if(Zr.data.length!==0&&(pn.push({key:"Length",value:Zr.data.length}),ut===!0&&pn.push({key:"Length1",value:Jt})),wn.length!=0)if(wn.split("/").length-1==1)pn.push({key:"Filter",value:wn});else{pn.push({key:"Filter",value:"["+wn+"]"});for(var _n=0;_n<pn.length;_n+=1)if(pn[_n].key==="DecodeParms"){for(var xn=[],An=0;An<Zr.reverseChain.split("/").length-1;An+=1)xn.push("null");xn.push(pn[_n].value),pn[_n].value="["+xn.join(" ")+"]"}}D("<<");for(var Dn=0;Dn<pn.length;Dn++)D("/"+pn[Dn].key+" "+pn[Dn].value);D(">>"),Zr.data.length!==0&&(D("stream"),D(Kr(Zr.data)),D("endstream"))},xe=f.__private__.putPage=function(j){var ae=j.number,Ne=j.data,Xe=j.objId,ut=j.contentsObjId;Z(Xe,!0),D("<</Type /Page"),D("/Parent "+j.rootDictionaryObjId+" 0 R"),D("/Resources "+j.resourceDictionaryObjId+" 0 R"),D("/MediaBox ["+parseFloat(O(j.mediaBox.bottomLeftX))+" "+parseFloat(O(j.mediaBox.bottomLeftY))+" "+O(j.mediaBox.topRightX)+" "+O(j.mediaBox.topRightY)+"]"),j.cropBox!==null&&D("/CropBox ["+O(j.cropBox.bottomLeftX)+" "+O(j.cropBox.bottomLeftY)+" "+O(j.cropBox.topRightX)+" "+O(j.cropBox.topRightY)+"]"),j.bleedBox!==null&&D("/BleedBox ["+O(j.bleedBox.bottomLeftX)+" "+O(j.bleedBox.bottomLeftY)+" "+O(j.bleedBox.topRightX)+" "+O(j.bleedBox.topRightY)+"]"),j.trimBox!==null&&D("/TrimBox ["+O(j.trimBox.bottomLeftX)+" "+O(j.trimBox.bottomLeftY)+" "+O(j.trimBox.topRightX)+" "+O(j.trimBox.topRightY)+"]"),j.artBox!==null&&D("/ArtBox ["+O(j.artBox.bottomLeftX)+" "+O(j.artBox.bottomLeftY)+" "+O(j.artBox.topRightX)+" "+O(j.artBox.topRightY)+"]"),typeof j.userUnit=="number"&&j.userUnit!==1&&D("/UserUnit "+j.userUnit),Vr.publish("putPage",{objId:Xe,pageContext:_r[ae],pageNumber:ae,page:Ne}),D("/Contents "+ut+" 0 R"),D(">>"),D("endobj");var Jt=Ne.join(`
`);return k===S&&(Jt+=`
Q`),Z(ut,!0),ce({data:Jt,filters:ct(),objectId:ut}),D("endobj"),Xe},se=f.__private__.putPages=function(){var j,ae,Ne=[];for(j=1;j<=$r;j++)_r[j].objId=er(),_r[j].contentsObjId=er();for(j=1;j<=$r;j++)Ne.push(xe({number:j,data:he[j],objId:_r[j].objId,contentsObjId:_r[j].contentsObjId,mediaBox:_r[j].mediaBox,cropBox:_r[j].cropBox,bleedBox:_r[j].bleedBox,trimBox:_r[j].trimBox,artBox:_r[j].artBox,userUnit:_r[j].userUnit,rootDictionaryObjId:ee,resourceDictionaryObjId:ue}));Z(ee,!0),D("<</Type /Pages");var Xe="/Kids [";for(ae=0;ae<$r;ae++)Xe+=Ne[ae]+" 0 R ";D(Xe+"]"),D("/Count "+$r),D(">>"),D("endobj"),Vr.publish("postPutPages")},Se=function(j){Vr.publish("putFont",{font:j,out:D,newObject:Ue,putStream:ce}),j.isAlreadyPutted!==!0&&(j.objectNumber=Ue(),D("<<"),D("/Type /Font"),D("/BaseFont /"+xf(j.postScriptName)),D("/Subtype /Type1"),typeof j.encoding=="string"&&D("/Encoding /"+j.encoding),D("/FirstChar 32"),D("/LastChar 255"),D(">>"),D("endobj"))},Ze=function(j){j.objectNumber=Ue();var ae=[];ae.push({key:"Type",value:"/XObject"}),ae.push({key:"Subtype",value:"/Form"}),ae.push({key:"BBox",value:"["+[O(j.x),O(j.y),O(j.x+j.width),O(j.y+j.height)].join(" ")+"]"}),ae.push({key:"Matrix",value:"["+j.matrix.toString()+"]"});var Ne=j.pages[1].join(`
`);ce({data:Ne,additionalKeyValues:ae,objectId:j.objectNumber}),D("endobj")},et=function(j,ae){ae||(ae=21);var Ne=Ue(),Xe=function(ur,Kr){var Zr,pn=[],wn=1/(Kr-1);for(Zr=0;Zr<1;Zr+=wn)pn.push(Zr);if(pn.push(1),ur[0].offset!=0){var _n={offset:0,color:ur[0].color};ur.unshift(_n)}if(ur[ur.length-1].offset!=1){var xn={offset:1,color:ur[ur.length-1].color};ur.push(xn)}for(var An="",Dn=0,ws=0;ws<pn.length;ws++){for(Zr=pn[ws];Zr>ur[Dn+1].offset;)Dn++;var ps=ur[Dn].offset,$n=(Zr-ps)/(ur[Dn+1].offset-ps),Sa=ur[Dn].color,Fa=ur[Dn+1].color;An+=M(Math.round((1-$n)*Sa[0]+$n*Fa[0]).toString(16))+M(Math.round((1-$n)*Sa[1]+$n*Fa[1]).toString(16))+M(Math.round((1-$n)*Sa[2]+$n*Fa[2]).toString(16))}return An.trim()}(j.colors,ae),ut=[];ut.push({key:"FunctionType",value:"0"}),ut.push({key:"Domain",value:"[0.0 1.0]"}),ut.push({key:"Size",value:"["+ae+"]"}),ut.push({key:"BitsPerSample",value:"8"}),ut.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ut.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ce({data:Xe,additionalKeyValues:ut,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ne}),D("endobj"),j.objectNumber=Ue(),D("<< /ShadingType "+j.type),D("/ColorSpace /DeviceRGB");var Jt="/Coords ["+O(parseFloat(j.coords[0]))+" "+O(parseFloat(j.coords[1]))+" ";j.type===2?Jt+=O(parseFloat(j.coords[2]))+" "+O(parseFloat(j.coords[3])):Jt+=O(parseFloat(j.coords[2]))+" "+O(parseFloat(j.coords[3]))+" "+O(parseFloat(j.coords[4]))+" "+O(parseFloat(j.coords[5])),D(Jt+="]"),j.matrix&&D("/Matrix ["+j.matrix.toString()+"]"),D("/Function "+Ne+" 0 R"),D("/Extend [true true]"),D(">>"),D("endobj")},Et=function(j,ae){var Ne=er(),Xe=Ue();ae.push({resourcesOid:Ne,objectOid:Xe}),j.objectNumber=Xe;var ut=[];ut.push({key:"Type",value:"/Pattern"}),ut.push({key:"PatternType",value:"1"}),ut.push({key:"PaintType",value:"1"}),ut.push({key:"TilingType",value:"1"}),ut.push({key:"BBox",value:"["+j.boundingBox.map(O).join(" ")+"]"}),ut.push({key:"XStep",value:O(j.xStep)}),ut.push({key:"YStep",value:O(j.yStep)}),ut.push({key:"Resources",value:Ne+" 0 R"}),j.matrix&&ut.push({key:"Matrix",value:"["+j.matrix.toString()+"]"}),ce({data:j.stream,additionalKeyValues:ut,objectId:j.objectNumber}),D("endobj")},wt=function(j){for(var ae in j.objectNumber=Ue(),D("<<"),j)switch(ae){case"opacity":D("/ca "+A(j[ae]));break;case"stroke-opacity":D("/CA "+A(j[ae]))}D(">>"),D("endobj")},gt=function(j){Z(j.resourcesOid,!0),D("<<"),D("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var ae in D("/Font <<"),pr)pr.hasOwnProperty(ae)&&(h===!1||h===!0&&p.hasOwnProperty(ae))&&D("/"+ae+" "+pr[ae].objectNumber+" 0 R");D(">>")}(),function(){if(Object.keys(mt).length>0){for(var ae in D("/Shading <<"),mt)mt.hasOwnProperty(ae)&&mt[ae]instanceof Kd&&mt[ae].objectNumber>=0&&D("/"+ae+" "+mt[ae].objectNumber+" 0 R");Vr.publish("putShadingPatternDict"),D(">>")}}(),function(ae){if(Object.keys(mt).length>0){for(var Ne in D("/Pattern <<"),mt)mt.hasOwnProperty(Ne)&&mt[Ne]instanceof f.TilingPattern&&mt[Ne].objectNumber>=0&&mt[Ne].objectNumber<ae&&D("/"+Ne+" "+mt[Ne].objectNumber+" 0 R");Vr.publish("putTilingPatternDict"),D(">>")}}(j.objectOid),function(){if(Object.keys(ft).length>0){var ae;for(ae in D("/ExtGState <<"),ft)ft.hasOwnProperty(ae)&&ft[ae].objectNumber>=0&&D("/"+ae+" "+ft[ae].objectNumber+" 0 R");Vr.publish("putGStateDict"),D(">>")}}(),function(){for(var ae in D("/XObject <<"),Xr)Xr.hasOwnProperty(ae)&&Xr[ae].objectNumber>=0&&D("/"+ae+" "+Xr[ae].objectNumber+" 0 R");Vr.publish("putXobjectDict"),D(">>")}(),D(">>"),D("endobj")},zt=function(j){fr[j.fontName]=fr[j.fontName]||{},fr[j.fontName][j.fontStyle]=j.id},Dt=function(j,ae,Ne,Xe,ut){var Jt={id:"F"+(Object.keys(pr).length+1).toString(10),postScriptName:j,fontName:ae,fontStyle:Ne,encoding:Xe,isStandardFont:ut||!1,metadata:{}};return Vr.publish("addFont",{font:Jt,instance:this}),pr[Jt.id]=Jt,zt(Jt),Jt.id},mr=f.__private__.pdfEscape=f.pdfEscape=function(j,ae){return function(Ne,Xe){var ut,Jt,ur,Kr,Zr,pn,wn,_n,xn;if(ur=(Xe=Xe||{}).sourceEncoding||"Unicode",Zr=Xe.outputEncoding,(Xe.autoencode||Zr)&&pr[be].metadata&&pr[be].metadata[ur]&&pr[be].metadata[ur].encoding&&(Kr=pr[be].metadata[ur].encoding,!Zr&&pr[be].encoding&&(Zr=pr[be].encoding),!Zr&&Kr.codePages&&(Zr=Kr.codePages[0]),typeof Zr=="string"&&(Zr=Kr[Zr]),Zr)){for(wn=!1,pn=[],ut=0,Jt=Ne.length;ut<Jt;ut++)(_n=Zr[Ne.charCodeAt(ut)])?pn.push(String.fromCharCode(_n)):pn.push(Ne[ut]),pn[ut].charCodeAt(0)>>8&&(wn=!0);Ne=pn.join("")}for(ut=Ne.length;wn===void 0&&ut!==0;)Ne.charCodeAt(ut-1)>>8&&(wn=!0),ut--;if(!wn)return Ne;for(pn=Xe.noBOM?[]:[254,255],ut=0,Jt=Ne.length;ut<Jt;ut++){if((xn=(_n=Ne.charCodeAt(ut))>>8)>>8)throw new Error("Character at position "+ut+" of string '"+Ne+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");pn.push(xn),pn.push(_n-(xn<<8))}return String.fromCharCode.apply(void 0,pn)}(j,ae).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},pt=f.__private__.beginPage=function(j){he[++$r]=[],_r[$r]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(j[0]),topRightY:Number(j[1])}},_t($r),oe(he[U])},Xt=function(j,ae){var Ne,Xe,ut;switch(r=ae||r,typeof j=="string"&&(Ne=m(j.toLowerCase()),Array.isArray(Ne)&&(Xe=Ne[0],ut=Ne[1])),Array.isArray(j)&&(Xe=j[0]*we,ut=j[1]*we),isNaN(Xe)&&(Xe=a[0],ut=a[1]),(Xe>14400||ut>14400)&&(ys.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Xe=Math.min(14400,Xe),ut=Math.min(14400,ut)),a=[Xe,ut],r.substr(0,1)){case"l":ut>Xe&&(a=[ut,Xe]);break;case"p":Xe>ut&&(a=[ut,Xe])}pt(a),Pt(Fr),D(Wr),at!==0&&D(at+" J"),nt!==0&&D(nt+" j"),Vr.publish("addPage",{pageNumber:$r})},Rt=function(j){j>0&&j<=$r&&(he.splice(j,1),_r.splice(j,1),$r--,U>$r&&(U=$r),this.setPage(U))},_t=function(j){j>0&&j<=$r&&(U=j)},jr=f.__private__.getNumberOfPages=f.getNumberOfPages=function(){return he.length-1},Gr=function(j,ae,Ne){var Xe,ut=void 0;return Ne=Ne||{},j=j!==void 0?j:pr[be].fontName,ae=ae!==void 0?ae:pr[be].fontStyle,Xe=j.toLowerCase(),fr[Xe]!==void 0&&fr[Xe][ae]!==void 0?ut=fr[Xe][ae]:fr[j]!==void 0&&fr[j][ae]!==void 0?ut=fr[j][ae]:Ne.disableWarning===!1&&ys.warn("Unable to look up font label for font '"+j+"', '"+ae+"'. Refer to getFontList() for available fonts."),ut||Ne.noFallback||(ut=fr.times[ae])==null&&(ut=fr.times.normal),ut},Cr=f.__private__.putInfo=function(){var j=Ue(),ae=function(Xe){return Xe};for(var Ne in u!==null&&(ae=Ht.encryptor(j,0)),D("<<"),D("/Producer ("+mr(ae("jsPDF "+un.version))+")"),ot)ot.hasOwnProperty(Ne)&&ot[Ne]&&D("/"+Ne.substr(0,1).toUpperCase()+Ne.substr(1)+" ("+mr(ae(ot[Ne]))+")");D("/CreationDate ("+mr(ae(re))+")"),D(">>"),D("endobj")},Rr=f.__private__.putCatalog=function(j){var ae=(j=j||{}).rootDictionaryObjId||ee;switch(Ue(),D("<<"),D("/Type /Catalog"),D("/Pages "+ae+" 0 R"),We||(We="fullwidth"),We){case"fullwidth":D("/OpenAction [3 0 R /FitH null]");break;case"fullheight":D("/OpenAction [3 0 R /FitV null]");break;case"fullpage":D("/OpenAction [3 0 R /Fit]");break;case"original":D("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ne=""+We;Ne.substr(Ne.length-1)==="%"&&(We=parseInt(We)/100),typeof We=="number"&&D("/OpenAction [3 0 R /XYZ null null "+A(We)+"]")}switch(rt||(rt="continuous"),rt){case"continuous":D("/PageLayout /OneColumn");break;case"single":D("/PageLayout /SinglePage");break;case"two":case"twoleft":D("/PageLayout /TwoColumnLeft");break;case"tworight":D("/PageLayout /TwoColumnRight")}Ve&&D("/PageMode /"+Ve),Vr.publish("putCatalog"),D(">>"),D("endobj")},De=f.__private__.putTrailer=function(){D("trailer"),D("<<"),D("/Size "+(te+1)),D("/Root "+te+" 0 R"),D("/Info "+(te-1)+" 0 R"),u!==null&&D("/Encrypt "+Ht.oid+" 0 R"),D("/ID [ <"+ge+"> <"+ge+"> ]"),D(">>")},Ke=f.__private__.putHeader=function(){D("%PDF-"+x),D("%")},Ce=f.__private__.putXRef=function(){var j="0000000000";D("xref"),D("0 "+(te+1)),D("0000000000 65535 f ");for(var ae=1;ae<=te;ae++)typeof Q[ae]=="function"?D((j+Q[ae]()).slice(-10)+" 00000 n "):Q[ae]!==void 0?D((j+Q[ae]).slice(-10)+" 00000 n "):D("0000000000 00000 n ")},it=f.__private__.buildDocument=function(){var j;te=0,ne=0,G=[],Q=[],z=[],ee=er(),ue=er(),oe(G),Vr.publish("buildDocument"),Ke(),se(),function(){Vr.publish("putAdditionalObjects");for(var Ne=0;Ne<z.length;Ne++){var Xe=z[Ne];Z(Xe.objId,!0),D(Xe.content),D("endobj")}Vr.publish("postPutAdditionalObjects")}(),j=[],function(){for(var Ne in pr)pr.hasOwnProperty(Ne)&&(h===!1||h===!0&&p.hasOwnProperty(Ne))&&Se(pr[Ne])}(),function(){var Ne;for(Ne in ft)ft.hasOwnProperty(Ne)&&wt(ft[Ne])}(),function(){for(var Ne in Xr)Xr.hasOwnProperty(Ne)&&Ze(Xr[Ne])}(),function(Ne){var Xe;for(Xe in mt)mt.hasOwnProperty(Xe)&&(mt[Xe]instanceof Kd?et(mt[Xe]):mt[Xe]instanceof Mf&&Et(mt[Xe],Ne))}(j),Vr.publish("putResources"),j.forEach(gt),gt({resourcesOid:ue,objectOid:Number.MAX_SAFE_INTEGER}),Vr.publish("postPutResources"),u!==null&&(Ht.oid=Ue(),D("<<"),D("/Filter /Standard"),D("/V "+Ht.v),D("/R "+Ht.r),D("/U <"+Ht.toHexString(Ht.U)+">"),D("/O <"+Ht.toHexString(Ht.O)+">"),D("/P "+Ht.P),D(">>"),D("endobj")),Cr(),Rr();var ae=ne;return Ce(),De(),D("startxref"),D(""+ae),D("%%EOF"),oe(he[U]),G.join(`
`)},tr=f.__private__.getBlob=function(j){return new Blob([le(j)],{type:"application/pdf"})},Kt=f.output=f.__private__.output=($t=function(j,ae){switch(typeof(ae=ae||{})=="string"?ae={filename:ae}:ae.filename=ae.filename||"generated.pdf",j){case void 0:return it();case"save":f.save(ae.filename);break;case"arraybuffer":return le(it());case"blob":return tr(it());case"bloburi":case"bloburl":if(jn.URL!==void 0&&typeof jn.URL.createObjectURL=="function")return jn.URL&&jn.URL.createObjectURL(tr(it()))||void 0;ys.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ne="",Xe=it();try{Ne=kj(Xe)}catch{Ne=kj(unescape(encodeURIComponent(Xe)))}return"data:application/pdf;filename="+ae.filename+";base64,"+Ne;case"pdfobjectnewwindow":if(Object.prototype.toString.call(jn)==="[object Window]"){var ut="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Jt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ae.pdfObjectUrl&&(ut=ae.pdfObjectUrl,Jt="");var ur='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+ut+'"'+Jt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ae)+");<\/script></body></html>",Kr=jn.open();return Kr!==null&&Kr.document.write(ur),Kr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(jn)==="[object Window]"){var Zr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ae.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ae.filename+'" width="500px" height="400px" /></body></html>',pn=jn.open();if(pn!==null){pn.document.write(Zr);var wn=this;pn.document.documentElement.querySelector("#pdfViewer").onload=function(){pn.document.title=ae.filename,pn.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(wn.output("bloburl"))}}return pn}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(jn)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var _n='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ae)+'"></iframe></body></html>',xn=jn.open();if(xn!==null&&(xn.document.write(_n),xn.document.title=ae.filename),xn||typeof safari>"u")return xn;break;case"datauri":case"dataurl":return jn.document.location.href=this.output("datauristring",ae);default:return null}},$t.foo=function(){try{return $t.apply(this,arguments)}catch(Ne){var j=Ne.stack||"";~j.indexOf(" at ")&&(j=j.split(" at ")[1]);var ae="Error in function "+j.split(`
`)[0].split("<")[0]+": "+Ne.message;if(!jn.console)throw new Error(ae);jn.console.error(ae,Ne),jn.alert&&alert(ae)}},$t.foo.bar=$t,$t.foo),yt=function(j){return Array.isArray(en)===!0&&en.indexOf(j)>-1};switch(s){case"pt":we=1;break;case"mm":we=72/25.4;break;case"cm":we=72/2.54;break;case"in":we=72;break;case"px":we=yt("px_scaling")==1?.75:96/72;break;case"pc":case"em":we=12;break;case"ex":we=6;break;default:if(typeof s!="number")throw new Error("Invalid unit: "+s);we=s}var Ht=null;fe(),R();var qt=f.__private__.getPageInfo=f.getPageInfo=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:_r[j].objId,pageNumber:j,pageContext:_r[j]}},lr=f.__private__.getPageInfoByObjId=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ae in _r)if(_r[ae].objId===j)break;return qt(ae)},Mt=f.__private__.getCurrentPageInfo=f.getCurrentPageInfo=function(){return{objId:_r[U].objId,pageNumber:U,pageContext:_r[U]}};f.addPage=function(){return Xt.apply(this,arguments),this},f.setPage=function(){return _t.apply(this,arguments),oe.call(this,he[U]),this},f.insertPage=function(j){return this.addPage(),this.movePage(U,j),this},f.movePage=function(j,ae){var Ne,Xe;if(j>ae){Ne=he[j],Xe=_r[j];for(var ut=j;ut>ae;ut--)he[ut]=he[ut-1],_r[ut]=_r[ut-1];he[ae]=Ne,_r[ae]=Xe,this.setPage(ae)}else if(j<ae){Ne=he[j],Xe=_r[j];for(var Jt=j;Jt<ae;Jt++)he[Jt]=he[Jt+1],_r[Jt]=_r[Jt+1];he[ae]=Ne,_r[ae]=Xe,this.setPage(ae)}return this},f.deletePage=function(){return Rt.apply(this,arguments),this},f.__private__.text=f.text=function(j,ae,Ne,Xe,ut){var Jt,ur,Kr,Zr,pn,wn,_n,xn,An,Dn=(Xe=Xe||{}).scope||this;if(typeof j=="number"&&typeof ae=="number"&&(typeof Ne=="string"||Array.isArray(Ne))){var ws=Ne;Ne=ae,ae=j,j=ws}if(arguments[3]instanceof qe==0?(Kr=arguments[4],Zr=arguments[5],ds(_n=arguments[3])==="object"&&_n!==null||(typeof Kr=="string"&&(Zr=Kr,Kr=null),typeof _n=="string"&&(Zr=_n,_n=null),typeof _n=="number"&&(Kr=_n,_n=null),Xe={flags:_n,angle:Kr,align:Zr})):(T("The transform parameter of text() with a Matrix value"),An=ut),isNaN(ae)||isNaN(Ne)||j==null)throw new Error("Invalid arguments passed to jsPDF.text");if(j.length===0)return Dn;var ps,$n="",Sa=typeof Xe.lineHeightFactor=="number"?Xe.lineHeightFactor:sr,Fa=Dn.internal.scaleFactor;function $a(ns){return ns=ns.split("	").join(Array(Xe.TabLen||9).join(" ")),mr(ns,_n)}function Ao(ns){for(var ms,Zs=ns.concat(),_a=[],ec=Zs.length;ec--;)typeof(ms=Zs.shift())=="string"?_a.push(ms):Array.isArray(ns)&&(ms.length===1||ms[1]===void 0&&ms[2]===void 0)?_a.push(ms[0]):_a.push([ms[0],ms[1],ms[2]]);return _a}function jl(ns,ms){var Zs;if(typeof ns=="string")Zs=ms(ns)[0];else if(Array.isArray(ns)){for(var _a,ec,U0=ns.concat(),Vu=[],Kp=U0.length;Kp--;)typeof(_a=U0.shift())=="string"?Vu.push(ms(_a)[0]):Array.isArray(_a)&&typeof _a[0]=="string"&&(ec=ms(_a[0],_a[1],_a[2]),Vu.push([ec[0],ec[1],ec[2]]));Zs=Vu}return Zs}var eo=!1,Yl=!0;if(typeof j=="string")eo=!0;else if(Array.isArray(j)){var Kl=j.concat();ur=[];for(var Nl,ha=Kl.length;ha--;)(typeof(Nl=Kl.shift())!="string"||Array.isArray(Nl)&&typeof Nl[0]!="string")&&(Yl=!1);eo=Yl}if(eo===!1)throw new Error('Type of text must be string or Array. "'+j+'" is not recognized.');typeof j=="string"&&(j=j.match(/[\r?\n]/)?j.split(/\r\n|\r|\n/g):[j]);var Od=je/Dn.internal.scaleFactor,Id=Od*(Sa-1);switch(Xe.baseline){case"bottom":Ne-=Id;break;case"top":Ne+=Od-Id;break;case"hanging":Ne+=Od-2*Id;break;case"middle":Ne+=Od/2-Id}if((wn=Xe.maxWidth||0)>0&&(typeof j=="string"?j=Dn.splitTextToSize(j,wn):Object.prototype.toString.call(j)==="[object Array]"&&(j=j.reduce(function(ns,ms){return ns.concat(Dn.splitTextToSize(ms,wn))},[]))),Jt={text:j,x:ae,y:Ne,options:Xe,mutex:{pdfEscape:mr,activeFontKey:be,fonts:pr,activeFontSize:je}},Vr.publish("preProcessText",Jt),j=Jt.text,Kr=(Xe=Jt.options).angle,An instanceof qe==0&&Kr&&typeof Kr=="number"){Kr*=Math.PI/180,Xe.rotationDirection===0&&(Kr=-Kr),k===S&&(Kr=-Kr);var L0=Math.cos(Kr),F0=Math.sin(Kr);An=new qe(L0,F0,-F0,L0,0,0)}else Kr&&Kr instanceof qe&&(An=Kr);k!==S||An||(An=dt),(pn=Xe.charSpace||Ye)!==void 0&&($n+=O(P(pn))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(xn=Xe.horizontalScale)!==void 0&&($n+=O(100*xn)+` Tz
`),Xe.lang;var Si=-1,Jl=Xe.renderingMode!==void 0?Xe.renderingMode:Xe.stroke,qu=Dn.internal.getCurrentPageInfo().pageContext;switch(Jl){case 0:case!1:case"fill":Si=0;break;case 1:case!0:case"stroke":Si=1;break;case 2:case"fillThenStroke":Si=2;break;case 3:case"invisible":Si=3;break;case 4:case"fillAndAddForClipping":Si=4;break;case 5:case"strokeAndAddPathForClipping":Si=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Si=6;break;case 7:case"addToPathForClipping":Si=7}var Xp=qu.usedRenderingMode!==void 0?qu.usedRenderingMode:-1;Si!==-1?$n+=Si+` Tr
`:Xp!==-1&&($n+=`0 Tr
`),Si!==-1&&(qu.usedRenderingMode=Si),Zr=Xe.align||"left";var Co,Dd=je*Sa,M0=Dn.internal.pageSize.getWidth(),R0=pr[be];pn=Xe.charSpace||Ye,wn=Xe.maxWidth||0,_n=Object.assign({autoencode:!0,noBOM:!0},Xe.flags);var Mc=[],Ud=function(ns){return Dn.getStringUnitWidth(ns,{font:R0,charSpace:pn,fontSize:je,doKerning:!1})*je/Fa};if(Object.prototype.toString.call(j)==="[object Array]"){var to;ur=Ao(j),Zr!=="left"&&(Co=ur.map(Ud));var ro,Rc=0;if(Zr==="right"){ae-=Co[0],j=[],ha=ur.length;for(var Zl=0;Zl<ha;Zl++)Zl===0?(ro=ye(ae),to=lt(Ne)):(ro=P(Rc-Co[Zl]),to=-Dd),j.push([ur[Zl],ro,to]),Rc=Co[Zl]}else if(Zr==="center"){ae-=Co[0]/2,j=[],ha=ur.length;for(var Bc=0;Bc<ha;Bc++)Bc===0?(ro=ye(ae),to=lt(Ne)):(ro=P((Rc-Co[Bc])/2),to=-Dd),j.push([ur[Bc],ro,to]),Rc=Co[Bc]}else if(Zr==="left"){j=[],ha=ur.length;for(var B0=0;B0<ha;B0++)j.push(ur[B0])}else if(Zr==="justify"&&R0.encoding==="Identity-H"){j=[],ha=ur.length,wn=wn!==0?wn:M0;for(var Hu=0,Js=0;Js<ha;Js++)if(to=Js===0?lt(Ne):-Dd,ro=Js===0?ye(ae):Hu,Js<ha-1){var Yp=P((wn-Co[Js])/(ur[Js].split(" ").length-1)),Al=ur[Js].split(" ");j.push([Al[0]+" ",ro,to]),Hu=0;for(var Cl=1;Cl<Al.length;Cl++){var P0=(Ud(Al[Cl-1]+" "+Al[Cl])-Ud(Al[Cl]))*Fa+Yp;Cl==Al.length-1?j.push([Al[Cl],P0,0]):j.push([Al[Cl]+" ",P0,0]),Hu-=P0}}else j.push([ur[Js],ro,to]);j.push(["",Hu,0])}else{if(Zr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(j=[],ha=ur.length,wn=wn!==0?wn:M0,Js=0;Js<ha;Js++){to=Js===0?lt(Ne):-Dd,ro=Js===0?ye(ae):0;var O0=ur[Js].split(" ").length-1,I0=O0>0?(wn-Co[Js])/O0:0;Js<ha-1?Mc.push(O(P(I0))):Mc.push(0),j.push([ur[Js],ro,to])}}}(typeof Xe.R2L=="boolean"?Xe.R2L:Re)===!0&&(j=jl(j,function(ns,ms,Zs){return[ns.split("").reverse().join(""),ms,Zs]})),Jt={text:j,x:ae,y:Ne,options:Xe,mutex:{pdfEscape:mr,activeFontKey:be,fonts:pr,activeFontSize:je}},Vr.publish("postProcessText",Jt),j=Jt.text,ps=Jt.mutex.isHex||!1;var D0=pr[be].encoding;D0!=="WinAnsiEncoding"&&D0!=="StandardEncoding"||(j=jl(j,function(ns,ms,Zs){return[$a(ns),ms,Zs]})),ur=Ao(j),j=[];for(var Pc,Oc,Ic,$d=Array.isArray(ur[0])?1:0,Dc="",Wd=function(ns,ms,Zs){var _a="";return Zs instanceof qe?(Zs=typeof Xe.angle=="number"?Lt(Zs,new qe(1,0,0,1,ns,ms)):Lt(new qe(1,0,0,1,ns,ms),Zs),k===S&&(Zs=Lt(new qe(1,0,0,-1,0,0),Zs)),_a=Zs.join(" ")+` Tm
`):_a=O(ns)+" "+O(ms)+` Td
`,_a},Eo=0;Eo<ur.length;Eo++){switch(Dc="",$d){case 1:Ic=(ps?"<":"(")+ur[Eo][0]+(ps?">":")"),Pc=parseFloat(ur[Eo][1]),Oc=parseFloat(ur[Eo][2]);break;case 0:Ic=(ps?"<":"(")+ur[Eo]+(ps?">":")"),Pc=ye(ae),Oc=lt(Ne)}Mc!==void 0&&Mc[Eo]!==void 0&&(Dc=Mc[Eo]+` Tw
`),Eo===0?j.push(Dc+Wd(Pc,Oc,An)+Ic):$d===0?j.push(Dc+Ic):$d===1&&j.push(Dc+Wd(Pc,Oc,An)+Ic)}j=$d===0?j.join(` Tj
T* `):j.join(` Tj
`),j+=` Tj
`;var El=`BT
/`;return El+=be+" "+je+` Tf
`,El+=O(je*Sa)+` TL
`,El+=fn+`
`,El+=$n,El+=j,D(El+="ET"),p[be]=!0,Dn};var tt=f.__private__.clip=f.clip=function(j){return D(j==="evenodd"?"W*":"W"),this};f.clipEvenOdd=function(){return tt("evenodd")},f.__private__.discardPath=f.discardPath=function(){return D("n"),this};var Ft=f.__private__.isValidStyle=function(j){var ae=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(j)!==-1&&(ae=!0),ae};f.__private__.setDefaultPathOperation=f.setDefaultPathOperation=function(j){return Ft(j)&&(d=j),this};var Qt=f.__private__.getStyle=f.getStyle=function(j){var ae=d;switch(j){case"D":case"S":ae="S";break;case"F":ae="f";break;case"FD":case"DF":ae="B";break;case"f":case"f*":case"B":case"B*":ae=j}return ae},At=f.close=function(){return D("h"),this};f.stroke=function(){return D("S"),this},f.fill=function(j){return bt("f",j),this},f.fillEvenOdd=function(j){return bt("f*",j),this},f.fillStroke=function(j){return bt("B",j),this},f.fillStrokeEvenOdd=function(j){return bt("B*",j),this};var bt=function(j,ae){ds(ae)==="object"?_e(ae,j):D(j)},V=function(j){j===null||k===S&&j===void 0||(j=Qt(j),D(j))};function ie(j,ae,Ne,Xe,ut){var Jt=new Mf(ae||this.boundingBox,Ne||this.xStep,Xe||this.yStep,this.gState,ut||this.matrix);Jt.stream=this.stream;var ur=j+"$$"+this.cloneIndex+++"$$";return He(ur,Jt),Jt}var _e=function(j,ae){var Ne=It[j.key],Xe=mt[Ne];if(Xe instanceof Kd)D("q"),D(Je(ae)),Xe.gState&&f.setGState(Xe.gState),D(j.matrix.toString()+" cm"),D("/"+Ne+" sh"),D("Q");else if(Xe instanceof Mf){var ut=new qe(1,0,0,-1,0,nr());j.matrix&&(ut=ut.multiply(j.matrix||dt),Ne=ie.call(Xe,j.key,j.boundingBox,j.xStep,j.yStep,ut).id),D("q"),D("/Pattern cs"),D("/"+Ne+" scn"),Xe.gState&&f.setGState(Xe.gState),D(ae),D("Q")}},Je=function(j){switch(j){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Nt=f.moveTo=function(j,ae){return D(O(P(j))+" "+O(K(ae))+" m"),this},Bt=f.lineTo=function(j,ae){return D(O(P(j))+" "+O(K(ae))+" l"),this},jt=f.curveTo=function(j,ae,Ne,Xe,ut,Jt){return D([O(P(j)),O(K(ae)),O(P(Ne)),O(K(Xe)),O(P(ut)),O(K(Jt)),"c"].join(" ")),this};f.__private__.line=f.line=function(j,ae,Ne,Xe,ut){if(isNaN(j)||isNaN(ae)||isNaN(Ne)||isNaN(Xe)||!Ft(ut))throw new Error("Invalid arguments passed to jsPDF.line");return k===w?this.lines([[Ne-j,Xe-ae]],j,ae,[1,1],ut||"S"):this.lines([[Ne-j,Xe-ae]],j,ae,[1,1]).stroke()},f.__private__.lines=f.lines=function(j,ae,Ne,Xe,ut,Jt){var ur,Kr,Zr,pn,wn,_n,xn,An,Dn,ws,ps,$n;if(typeof j=="number"&&($n=Ne,Ne=ae,ae=j,j=$n),Xe=Xe||[1,1],Jt=Jt||!1,isNaN(ae)||isNaN(Ne)||!Array.isArray(j)||!Array.isArray(Xe)||!Ft(ut)||typeof Jt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Nt(ae,Ne),ur=Xe[0],Kr=Xe[1],pn=j.length,ws=ae,ps=Ne,Zr=0;Zr<pn;Zr++)(wn=j[Zr]).length===2?(ws=wn[0]*ur+ws,ps=wn[1]*Kr+ps,Bt(ws,ps)):(_n=wn[0]*ur+ws,xn=wn[1]*Kr+ps,An=wn[2]*ur+ws,Dn=wn[3]*Kr+ps,ws=wn[4]*ur+ws,ps=wn[5]*Kr+ps,jt(_n,xn,An,Dn,ws,ps));return Jt&&At(),V(ut),this},f.path=function(j){for(var ae=0;ae<j.length;ae++){var Ne=j[ae],Xe=Ne.c;switch(Ne.op){case"m":Nt(Xe[0],Xe[1]);break;case"l":Bt(Xe[0],Xe[1]);break;case"c":jt.apply(this,Xe);break;case"h":At()}}return this},f.__private__.rect=f.rect=function(j,ae,Ne,Xe,ut){if(isNaN(j)||isNaN(ae)||isNaN(Ne)||isNaN(Xe)||!Ft(ut))throw new Error("Invalid arguments passed to jsPDF.rect");return k===w&&(Xe=-Xe),D([O(P(j)),O(K(ae)),O(P(Ne)),O(P(Xe)),"re"].join(" ")),V(ut),this},f.__private__.triangle=f.triangle=function(j,ae,Ne,Xe,ut,Jt,ur){if(isNaN(j)||isNaN(ae)||isNaN(Ne)||isNaN(Xe)||isNaN(ut)||isNaN(Jt)||!Ft(ur))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ne-j,Xe-ae],[ut-Ne,Jt-Xe],[j-ut,ae-Jt]],j,ae,[1,1],ur,!0),this},f.__private__.roundedRect=f.roundedRect=function(j,ae,Ne,Xe,ut,Jt,ur){if(isNaN(j)||isNaN(ae)||isNaN(Ne)||isNaN(Xe)||isNaN(ut)||isNaN(Jt)||!Ft(ur))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Kr=4/3*(Math.SQRT2-1);return ut=Math.min(ut,.5*Ne),Jt=Math.min(Jt,.5*Xe),this.lines([[Ne-2*ut,0],[ut*Kr,0,ut,Jt-Jt*Kr,ut,Jt],[0,Xe-2*Jt],[0,Jt*Kr,-ut*Kr,Jt,-ut,Jt],[2*ut-Ne,0],[-ut*Kr,0,-ut,-Jt*Kr,-ut,-Jt],[0,2*Jt-Xe],[0,-Jt*Kr,ut*Kr,-Jt,ut,-Jt]],j+ut,ae,[1,1],ur,!0),this},f.__private__.ellipse=f.ellipse=function(j,ae,Ne,Xe,ut){if(isNaN(j)||isNaN(ae)||isNaN(Ne)||isNaN(Xe)||!Ft(ut))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Jt=4/3*(Math.SQRT2-1)*Ne,ur=4/3*(Math.SQRT2-1)*Xe;return Nt(j+Ne,ae),jt(j+Ne,ae-ur,j+Jt,ae-Xe,j,ae-Xe),jt(j-Jt,ae-Xe,j-Ne,ae-ur,j-Ne,ae),jt(j-Ne,ae+ur,j-Jt,ae+Xe,j,ae+Xe),jt(j+Jt,ae+Xe,j+Ne,ae+ur,j+Ne,ae),V(ut),this},f.__private__.circle=f.circle=function(j,ae,Ne,Xe){if(isNaN(j)||isNaN(ae)||isNaN(Ne)||!Ft(Xe))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(j,ae,Ne,Ne,Xe)},f.setFont=function(j,ae,Ne){return Ne&&(ae=C(ae,Ne)),be=Gr(j,ae,{disableWarning:!1}),this};var cr=f.__private__.getFont=f.getFont=function(){return pr[Gr.apply(f,arguments)]};f.__private__.getFontList=f.getFontList=function(){var j,ae,Ne={};for(j in fr)if(fr.hasOwnProperty(j))for(ae in Ne[j]=[],fr[j])fr[j].hasOwnProperty(ae)&&Ne[j].push(ae);return Ne},f.addFont=function(j,ae,Ne,Xe,ut){var Jt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Jt.indexOf(arguments[3])!==-1?ut=arguments[3]:arguments[3]&&Jt.indexOf(arguments[3])==-1&&(Ne=C(Ne,Xe)),Dt.call(this,j,ae,Ne,ut=ut||"Identity-H")};var sr,Fr=e.lineWidth||.200025,Nr=f.__private__.getLineWidth=f.getLineWidth=function(){return Fr},Pt=f.__private__.setLineWidth=f.setLineWidth=function(j){return Fr=j,D(O(P(j))+" w"),this};f.__private__.setLineDash=un.API.setLineDash=un.API.setLineDashPattern=function(j,ae){if(j=j||[],ae=ae||0,isNaN(ae)||!Array.isArray(j))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return j=j.map(function(Ne){return O(P(Ne))}).join(" "),ae=O(P(ae)),D("["+j+"] "+ae+" d"),this};var Ot=f.__private__.getLineHeight=f.getLineHeight=function(){return je*sr};f.__private__.getLineHeight=f.getLineHeight=function(){return je*sr};var Tr=f.__private__.setLineHeightFactor=f.setLineHeightFactor=function(j){return typeof(j=j||1.15)=="number"&&(sr=j),this},vr=f.__private__.getLineHeightFactor=f.getLineHeightFactor=function(){return sr};Tr(e.lineHeight);var ye=f.__private__.getHorizontalCoordinate=function(j){return P(j)},lt=f.__private__.getVerticalCoordinate=function(j){return k===S?j:_r[U].mediaBox.topRightY-_r[U].mediaBox.bottomLeftY-P(j)},ht=f.__private__.getHorizontalCoordinateString=f.getHorizontalCoordinateString=function(j){return O(ye(j))},Vt=f.__private__.getVerticalCoordinateString=f.getVerticalCoordinateString=function(j){return O(lt(j))},Wr=e.strokeColor||"0 G";f.__private__.getStrokeColor=f.getDrawColor=function(){return Ae(Wr)},f.__private__.setStrokeColor=f.setDrawColor=function(j,ae,Ne,Xe){return Wr=Le({ch1:j,ch2:ae,ch3:Ne,ch4:Xe,pdfColorType:"draw",precision:2}),D(Wr),this};var Yr=e.fillColor||"0 g";f.__private__.getFillColor=f.getFillColor=function(){return Ae(Yr)},f.__private__.setFillColor=f.setFillColor=function(j,ae,Ne,Xe){return Yr=Le({ch1:j,ch2:ae,ch3:Ne,ch4:Xe,pdfColorType:"fill",precision:2}),D(Yr),this};var fn=e.textColor||"0 g",In=f.__private__.getTextColor=f.getTextColor=function(){return Ae(fn)};f.__private__.setTextColor=f.setTextColor=function(j,ae,Ne,Xe){return fn=Le({ch1:j,ch2:ae,ch3:Ne,ch4:Xe,pdfColorType:"text",precision:3}),this};var Ye=e.charSpace,st=f.__private__.getCharSpace=f.getCharSpace=function(){return parseFloat(Ye||0)};f.__private__.setCharSpace=f.setCharSpace=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Ye=j,this};var at=0;f.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},f.__private__.setLineCap=f.setLineCap=function(j){var ae=f.CapJoinStyles[j];if(ae===void 0)throw new Error("Line cap style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return at=ae,D(ae+" J"),this};var nt=0;f.__private__.setLineJoin=f.setLineJoin=function(j){var ae=f.CapJoinStyles[j];if(ae===void 0)throw new Error("Line join style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return nt=ae,D(ae+" j"),this},f.__private__.setLineMiterLimit=f.__private__.setMiterLimit=f.setLineMiterLimit=f.setMiterLimit=function(j){if(j=j||0,isNaN(j))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return D(O(P(j))+" M"),this},f.GState=M1,f.setGState=function(j){(j=typeof j=="string"?ft[gr[j]]:xt(null,j)).equals(Mr)||(D("/"+j.id+" gs"),Mr=j)};var xt=function(j,ae){if(!j||!gr[j]){var Ne=!1;for(var Xe in ft)if(ft.hasOwnProperty(Xe)&&ft[Xe].equals(ae)){Ne=!0;break}if(Ne)ae=ft[Xe];else{var ut="GS"+(Object.keys(ft).length+1).toString(10);ft[ut]=ae,ae.id=ut}return j&&(gr[j]=ae.id),Vr.publish("addGState",ae),ae}};f.addGState=function(j,ae){return xt(j,ae),this},f.saveGraphicsState=function(){return D("q"),Be.push({key:be,size:je,color:fn}),this},f.restoreGraphicsState=function(){D("Q");var j=Be.pop();return be=j.key,je=j.size,fn=j.color,Mr=null,this},f.setCurrentTransformationMatrix=function(j){return D(j.toString()+" cm"),this},f.comment=function(j){return D("#"+j),this};var rr=function(j,ae){var Ne=j||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ne},set:function(Jt){isNaN(Jt)||(Ne=parseFloat(Jt))}});var Xe=ae||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Xe},set:function(Jt){isNaN(Jt)||(Xe=parseFloat(Jt))}});var ut="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return ut},set:function(Jt){ut=Jt.toString()}}),this},vt=function(j,ae,Ne,Xe){rr.call(this,j,ae),this.type="rect";var ut=Ne||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return ut},set:function(ur){isNaN(ur)||(ut=parseFloat(ur))}});var Jt=Xe||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Jt},set:function(ur){isNaN(ur)||(Jt=parseFloat(ur))}}),this},dr=function(){this.page=$r,this.currentPage=U,this.pages=he.slice(0),this.pagesContext=_r.slice(0),this.x=Me,this.y=Wt,this.matrix=Ct,this.width=kr(U),this.height=zr(U),this.outputDestination=H,this.id="",this.objectNumber=-1};dr.prototype.restore=function(){$r=this.page,U=this.currentPage,_r=this.pagesContext,he=this.pages,Me=this.x,Wt=this.y,Ct=this.matrix,Ur(U,this.width),Or(U,this.height),H=this.outputDestination};var ir=function(j,ae,Ne,Xe,ut){Oe.push(new dr),$r=U=0,he=[],Me=j,Wt=ae,Ct=ut,pt([Ne,Xe])};for(var Br in f.beginFormObject=function(j,ae,Ne,Xe,ut){return ir(j,ae,Ne,Xe,ut),this},f.endFormObject=function(j){return function(ae){if(gn[ae])Oe.pop().restore();else{var Ne=new dr,Xe="Xo"+(Object.keys(Xr).length+1).toString(10);Ne.id=Xe,gn[ae]=Xe,Xr[Xe]=Ne,Vr.publish("addFormObject",Ne),Oe.pop().restore()}}(j),this},f.doFormObject=function(j,ae){var Ne=Xr[gn[j]];return D("q"),D(ae.toString()+" cm"),D("/"+Ne.id+" Do"),D("Q"),this},f.getFormObject=function(j){var ae=Xr[gn[j]];return{x:ae.x,y:ae.y,width:ae.width,height:ae.height,matrix:ae.matrix}},f.save=function(j,ae){return j=j||"generated.pdf",(ae=ae||{}).returnPromise=ae.returnPromise||!1,ae.returnPromise===!1?(Xd(tr(it()),j),typeof Xd.unload=="function"&&jn.setTimeout&&setTimeout(Xd.unload,911),this):new Promise(function(Ne,Xe){try{var ut=Xd(tr(it()),j);typeof Xd.unload=="function"&&jn.setTimeout&&setTimeout(Xd.unload,911),Ne(ut)}catch(Jt){Xe(Jt.message)}})},un.API)un.API.hasOwnProperty(Br)&&(Br==="events"&&un.API.events.length?function(j,ae){var Ne,Xe,ut;for(ut=ae.length-1;ut!==-1;ut--)Ne=ae[ut][0],Xe=ae[ut][1],j.subscribe.apply(j,[Ne].concat(typeof Xe=="function"?[Xe]:Xe))}(Vr,un.API.events):f[Br]=un.API[Br]);function kr(j){return _r[j].mediaBox.topRightX-_r[j].mediaBox.bottomLeftX}function Ur(j,ae){_r[j].mediaBox.topRightX=ae+_r[j].mediaBox.bottomLeftX}function zr(j){return _r[j].mediaBox.topRightY-_r[j].mediaBox.bottomLeftY}function Or(j,ae){_r[j].mediaBox.topRightY=ae+_r[j].mediaBox.bottomLeftY}var Lr=f.getPageWidth=function(j){return kr(j=j||U)/we},cn=f.setPageWidth=function(j,ae){Ur(j,ae*we)},nr=f.getPageHeight=function(j){return zr(j=j||U)/we},ar=f.setPageHeight=function(j,ae){Or(j,ae*we)};return f.internal={pdfEscape:mr,getStyle:Qt,getFont:cr,getFontSize:Ee,getCharSpace:st,getTextColor:In,getLineHeight:Ot,getLineHeightFactor:vr,getLineWidth:Nr,write:Y,getHorizontalCoordinate:ye,getVerticalCoordinate:lt,getCoordinateString:ht,getVerticalCoordinateString:Vt,collections:{},newObject:Ue,newAdditionalObject:pe,newObjectDeferred:er,newObjectDeferredBegin:Z,getFilters:ct,putStream:ce,events:Vr,scaleFactor:we,pageSize:{getWidth:function(){return Lr(U)},setWidth:function(j){cn(U,j)},getHeight:function(){return nr(U)},setHeight:function(j){ar(U,j)}},encryptionOptions:u,encryption:Ht,getEncryptor:function(j){return u!==null?Ht.encryptor(j,0):function(ae){return ae}},output:Kt,getNumberOfPages:jr,get pages(){return he},out:D,f2:A,f3:N,getPageInfo:qt,getPageInfoByObjId:lr,getCurrentPageInfo:Mt,getPDFVersion:g,Point:rr,Rectangle:vt,Matrix:qe,hasHotfix:yt},Object.defineProperty(f.internal.pageSize,"width",{get:function(){return Lr(U)},set:function(j){cn(U,j)},enumerable:!0,configurable:!0}),Object.defineProperty(f.internal.pageSize,"height",{get:function(){return nr(U)},set:function(j){ar(U,j)},enumerable:!0,configurable:!0}),(function(j){for(var ae=0,Ne=$e.length;ae<Ne;ae++){var Xe=Dt.call(this,j[ae][0],j[ae][1],j[ae][2],$e[ae][3],!0);h===!1&&(p[Xe]=!0);var ut=j[ae][0].split("-");zt({id:Xe,fontName:ut[0],fontStyle:ut[1]||""})}Vr.publish("addFonts",{fonts:pr,dictionary:fr})}).call(f,$e),be="F1",Xt(a,r),Vr.publish("initialized"),f}mf.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},mf.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},mf.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},mf.prototype.processOwnerPassword=function(e,t){return $2(U2(t).substr(0,5),e)},mf.prototype.encryptor=function(e,t){var r=U2(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(s){return $2(r,s)}},M1.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||ds(e)!==ds(this))return!1;var s=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;s++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&s--;return s===0},un.API={events:[]},un.version="4.1.0";var Hs=un.API,Xw=1,zu=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ef=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},R1=function(e){return e.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(t){var r=t.charCodeAt(0).toString(16).toUpperCase();return"#"+(r.length===1?"0"+r:r)})},Nn=function(e){return e.toFixed(2)},Xc=function(e){return e.toFixed(5)};Hs.__acroform__={};var Zi=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},Cj=function(e){return e*Xw},Ol=function(e){var t=new t8,r=nn.internal.getHeight(e)||0,s=nn.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Nn(s)),Number(Nn(r))],t},QX=Hs.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},XX=Hs.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},YX=Hs.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},ia=Hs.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return YX(e,t-1)},oa=Hs.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return QX(e,t-1)},la=Hs.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return XX(e,t-1)},KX=Hs.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,s=t.internal.getVerticalCoordinate,a=e[0],i=e[1],o=e[2],l=e[3],c={};return c.lowerLeft_X=r(a)||0,c.lowerLeft_Y=s(i+l)||0,c.upperRight_X=r(a+o)||0,c.upperRight_Y=s(i)||0,[Number(Nn(c.lowerLeft_X)),Number(Nn(c.lowerLeft_Y)),Number(Nn(c.upperRight_X)),Number(Nn(c.upperRight_Y))]},JX=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,s=W2(e,r),a=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+a+" "+Nn(s.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(s.text),t.push("ET"),t.push("Q"),t.push("EMC");var i=Ol(e);return i.scope=e.scope,i.stream=t.join(`
`),i}},W2=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,s={text:"",fontSize:""},a=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");a=e.multiline?a.map(function(A){return A.split(`
`)}):a.map(function(A){return[A]});var i=r,o=nn.internal.getHeight(e)||0;o=o<0?-o:o;var l=nn.internal.getWidth(e)||0;l=l<0?-l:l;var c=function(A,N,P){if(A+1<a.length){var K=N+" "+a[A+1][0];return Xm(K,e,P).width<=l-4}return!1};i++;e:for(;i>0;){t="",i--;var d,u,h=Xm("3",e,i).height,p=e.multiline?o-i:(o-h)/2,f=p+=2,x=0,g=0,y=0;if(i<=0){t=`(...) Tj
`,t+="% Width of Text: "+Xm(t,e,i=12).width+", FieldWidth:"+l+`
`;break}for(var m="",w=0,S=0;S<a.length;S++)if(a.hasOwnProperty(S)){var k=!1;if(a[S].length!==1&&y!==a[S].length-1){if((h+2)*(w+2)+2>o)continue e;m+=a[S][y],k=!0,g=S,S--}else{m=(m+=a[S][y]+" ").substr(m.length-1)==" "?m.substr(0,m.length-1):m;var F=parseInt(S),L=c(F,m,i),C=S>=a.length-1;if(L&&!C){m+=" ",y=0;continue}if(L||C){if(C)g=F;else if(e.multiline&&(h+2)*(w+2)+2>o)continue e}else{if(!e.multiline||(h+2)*(w+2)+2>o)continue e;g=F}}for(var O="",T=x;T<=g;T++){var W=a[T];if(e.multiline){if(T===g){O+=W[y]+" ",y=(y+1)%W.length;continue}if(T===x){O+=W[W.length-1]+" ";continue}}O+=W[0]+" "}switch(O=O.substr(O.length-1)==" "?O.substr(0,O.length-1):O,u=Xm(O,e,i).width,e.textAlign){case"right":d=l-u-2;break;case"center":d=(l-u)/2;break;default:d=2}t+=Nn(d)+" "+Nn(f)+` Td
`,t+="("+zu(O)+`) Tj
`,t+=-Nn(d)+` 0 Td
`,f=-(i+2),u=0,x=k?g:g+1,w++,m=""}break}return s.text=t,s.fontSize=i,s},Xm=function(e,t,r){var s=t.scope.internal.getFont(t.fontName,t.fontStyle),a=t.scope.getStringUnitWidth(e,{font:s,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:s,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:a}},ZX={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},eY=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(s){return s.type===r.type&&s.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},tY=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(_l.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(ZX)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Xw=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new r8,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var s=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var a in s)if(s.hasOwnProperty(a)){var i=s[a];i.objId=void 0,i.hasAnnotation&&eY(i,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(s,a){var i=!s;for(var o in s||(a.internal.newObjectDeferredBegin(a.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),a.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),s=s||a.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(s.hasOwnProperty(o)){var l=s[o],c=[],d=l.Rect;if(l.Rect&&(l.Rect=KX(l.Rect,a)),a.internal.newObjectDeferredBegin(l.objId,!0),l.DA=nn.createDefaultAppearanceStream(l),ds(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=d,l.hasAppearanceStream&&!l.appearanceStreamContent){var u=JX(l);c.push({key:"AP",value:"<</N "+u+">>"}),a.internal.acroformPlugin.xForms.push(u)}if(l.appearanceStreamContent){var h="";for(var p in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(p)){var f=l.appearanceStreamContent[p];if(h+="/"+p+" ",h+="<<",Object.keys(f).length>=1||Array.isArray(f)){for(var o in f)if(f.hasOwnProperty(o)){var x=f[o];typeof x=="function"&&(x=x.call(a,l)),h+="/"+o+" "+x+" ",a.internal.acroformPlugin.xForms.indexOf(x)>=0||a.internal.acroformPlugin.xForms.push(x)}}else typeof(x=f)=="function"&&(x=x.call(a,l)),h+="/"+o+" "+x,a.internal.acroformPlugin.xForms.indexOf(x)>=0||a.internal.acroformPlugin.xForms.push(x);h+=">>"}c.push({key:"AP",value:`<<
`+h+">>"})}a.internal.putStream({additionalKeyValues:c,objectId:l.objId}),a.internal.out("endobj")}i&&function(g,y){for(var m in g)if(g.hasOwnProperty(m)){var w=m,S=g[m];y.internal.newObjectDeferredBegin(S.objId,!0),ds(S)==="object"&&typeof S.putStream=="function"&&S.putStream(),delete g[w]}}(a.internal.acroformPlugin.xForms,a)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},e8=Hs.__acroform__.arrayToPdfArray=function(e,t,r){var s=function(o){return o};if(Array.isArray(e)){for(var a="[",i=0;i<e.length;i++)switch(i!==0&&(a+=" "),ds(e[i])){case"boolean":case"number":case"object":a+=e[i].toString();break;case"string":e[i].substr(0,1)==="/"?a+="/"+R1(e[i].substr(1)):(t!==void 0&&r&&(s=r.internal.getEncryptor(t)),a+="("+zu(s(e[i].toString()))+")")}return a+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Yy=function(e,t,r){var s=function(a){return a};return t!==void 0&&r&&(s=r.internal.getEncryptor(t)),(e=e||"").toString(),"("+zu(s(e))+")"},ql=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};ql.prototype.toString=function(){return this.objId+" 0 R"},ql.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},ql.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(i){return i!="content"&&i!="appearanceStreamContent"&&i!="scope"&&i!="objId"&&i.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var s=t[r],a=this[s];a&&(Array.isArray(a)?e.push({key:s,value:e8(a,this.objId,this.scope)}):a instanceof ql?(a.scope=this.scope,e.push({key:s,value:a.objId+" 0 R"})):typeof a!="function"&&e.push({key:s,value:a}))}return e};var t8=function(){ql.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};Zi(t8,ql);var r8=function(){ql.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(s){return s};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+zu(r(e))+")"}},set:function(r){e=r}})};Zi(r8,ql);var _l=function e(){ql.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(m){if(isNaN(m))throw new Error('Invalid value "'+m+'" for attribute F supplied.');t=m}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!ia(t,3)},set:function(m){m?this.F=oa(t,3):this.F=la(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(m){if(isNaN(m))throw new Error('Invalid value "'+m+'" for attribute Ff supplied.');r=m}});var s=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(s.length!==0)return s},set:function(m){s=m!==void 0?m:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[0])?0:s[0]},set:function(m){s[0]=m}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[1])?0:s[1]},set:function(m){s[1]=m}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[2])?0:s[2]},set:function(m){s[2]=m}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[3])?0:s[3]},set:function(m){s[3]=m}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(m){switch(m){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=m;break;default:throw new Error('Invalid value "'+m+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof B1)return;i="FieldObject"+e.FieldNum++}var m=function(w){return w};return this.scope&&(m=this.scope.internal.getEncryptor(this.objId)),"("+zu(m(i))+")"},set:function(m){i=m.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(m){i=m}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(m){o=m}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(m){l=m}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(m){c=m}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/Xw:d},set:function(m){d=m}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(m){u=m}});var h="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!h||this instanceof B1||this instanceof fu))return Yy(h,this.objId,this.scope)},set:function(m){m=m.toString(),h=m}});var p=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof Oa==0?Yy(p,this.objId,this.scope):p},set:function(m){m=m.toString(),p=this instanceof Oa==0?m.substr(0,1)==="("?ef(m.substr(1,m.length-2)):ef(m):m}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Oa==1?ef(p.substr(1,p.length-1)):p},set:function(m){m=m.toString(),p=this instanceof Oa==1?"/"+R1(m):m}});var f=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(f)return f},set:function(m){this.V=m}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(f)return this instanceof Oa==0?Yy(f,this.objId,this.scope):f},set:function(m){m=m.toString(),f=this instanceof Oa==0?m.substr(0,1)==="("?ef(m.substr(1,m.length-2)):ef(m):m}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Oa==1?ef(f.substr(1,f.length-1)):f},set:function(m){m=m.toString(),f=this instanceof Oa==1?"/"+R1(m):m}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var x,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(m){m=!!m,g=m}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(x)return x},set:function(m){x=m}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,1)},set:function(m){m?this.Ff=oa(this.Ff,1):this.Ff=la(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,2)},set:function(m){m?this.Ff=oa(this.Ff,2):this.Ff=la(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,3)},set:function(m){m?this.Ff=oa(this.Ff,3):this.Ff=la(this.Ff,3)}});var y=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(y!==null)return y},set:function(m){if([0,1,2].indexOf(m)===-1)throw new Error('Invalid value "'+m+'" for attribute Q supplied.');y=m}}),Object.defineProperty(this,"textAlign",{get:function(){var m;switch(y){case 0:default:m="left";break;case 1:m="center";break;case 2:m="right"}return m},configurable:!0,enumerable:!0,set:function(m){switch(m){case"right":case 2:y=2;break;case"center":case 1:y=1;break;default:y=0}}})};Zi(_l,ql);var Xf=function(){_l.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return e8(t,this.objId,this.scope)},set:function(r){var s,a;a=[],typeof(s=r)=="string"&&(a=function(i,o,l){l||(l=1);for(var c,d=[];c=o.exec(i);)d.push(c[l]);return d}(s,/\((.*?)\)/g)),t=a}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,s){for(s=s||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),s!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,18)},set:function(r){r?this.Ff=oa(this.Ff,18):this.Ff=la(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=oa(this.Ff,19):this.Ff=la(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,20)},set:function(r){r?(this.Ff=oa(this.Ff,20),t.sort()):this.Ff=la(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,22)},set:function(r){r?this.Ff=oa(this.Ff,22):this.Ff=la(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,23)},set:function(r){r?this.Ff=oa(this.Ff,23):this.Ff=la(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,27)},set:function(r){r?this.Ff=oa(this.Ff,27):this.Ff=la(this.Ff,27)}}),this.hasAppearanceStream=!1};Zi(Xf,_l);var Yf=function(){Xf.call(this),this.fontName="helvetica",this.combo=!1};Zi(Yf,Xf);var Kf=function(){Yf.call(this),this.combo=!0};Zi(Kf,Yf);var Lx=function(){Kf.call(this),this.edit=!0};Zi(Lx,Kf);var Oa=function(){_l.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,15)},set:function(r){r?this.Ff=oa(this.Ff,15):this.Ff=la(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,16)},set:function(r){r?this.Ff=oa(this.Ff,16):this.Ff=la(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,17)},set:function(r){r?this.Ff=oa(this.Ff,17):this.Ff=la(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,26)},set:function(r){r?this.Ff=oa(this.Ff,26):this.Ff=la(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(i){return i};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var s,a=[];for(s in a.push("<<"),t)a.push("/"+s+" ("+zu(r(t[s]))+")");return a.push(">>"),a.join(`
`)}},set:function(r){ds(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+R1(r)}})};Zi(Oa,_l);var Fx=function(){Oa.call(this),this.pushButton=!0};Zi(Fx,Oa);var Jf=function(){Oa.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};Zi(Jf,Oa);var B1=function(){var e,t;_l.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(a){e=a}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(a){t=a}});var r,s={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var a=function(l){return l};this.scope&&(a=this.scope.internal.getEncryptor(this.objId));var i,o=[];for(i in o.push("<<"),s)o.push("/"+i+" ("+zu(a(s[i]))+")");return o.push(">>"),o.join(`
`)},set:function(a){ds(a)==="object"&&(s=a)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return s.CA||""},set:function(a){typeof a=="string"&&(s.CA=a)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(a){r=a}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(a){r="/"+a}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=nn.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Zi(B1,_l),Jf.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Jf.prototype.createOption=function(e){var t=new B1;return t.Parent=this,t.optionName=e,this.Kids.push(t),rY.call(this.scope,t),t};var Mx=function(){Oa.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=nn.CheckBox.createAppearanceStream()};Zi(Mx,Oa);var fu=function(){_l.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,13)},set:function(t){t?this.Ff=oa(this.Ff,13):this.Ff=la(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,21)},set:function(t){t?this.Ff=oa(this.Ff,21):this.Ff=la(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,23)},set:function(t){t?this.Ff=oa(this.Ff,23):this.Ff=la(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,24)},set:function(t){t?this.Ff=oa(this.Ff,24):this.Ff=la(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,25)},set:function(t){t?this.Ff=oa(this.Ff,25):this.Ff=la(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,26)},set:function(t){t?this.Ff=oa(this.Ff,26):this.Ff=la(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Zi(fu,_l);var Rx=function(){fu.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!ia(this.Ff,14)},set:function(e){e?this.Ff=oa(this.Ff,14):this.Ff=la(this.Ff,14)}}),this.password=!0};Zi(Rx,fu);var nn={CheckBox:{createAppearanceStream:function(){return{N:{On:nn.CheckBox.YesNormal},D:{On:nn.CheckBox.YesPushDown,Off:nn.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=Ol(e);t.scope=e.scope;var r=[],s=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),i=W2(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+Nn(nn.internal.getWidth(e))+" "+Nn(nn.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+s+" "+Nn(i.fontSize)+" Tf "+a),r.push("BT"),r.push(i.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=Ol(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,s=e.scope.__private__.encodeColorString(e.color),a=[],i=nn.internal.getHeight(e),o=nn.internal.getWidth(e),l=W2(e,e.caption);return a.push("1 g"),a.push("0 0 "+Nn(o)+" "+Nn(i)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+Nn(o-1)+" "+Nn(i-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+r+" "+Nn(l.fontSize)+" Tf "+s),a.push(l.text),a.push("ET"),a.push("Q"),t.stream=a.join(`
`),t},OffPushDown:function(e){var t=Ol(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Nn(nn.internal.getWidth(e))+" "+Nn(nn.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:nn.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=nn.RadioButton.Circle.YesNormal,t.D[e]=nn.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=Ol(e);t.scope=e.scope;var r=[],s=nn.internal.getWidth(e)<=nn.internal.getHeight(e)?nn.internal.getWidth(e)/4:nn.internal.getHeight(e)/4;s=Number((.9*s).toFixed(5));var a=nn.internal.Bezier_C,i=Number((s*a).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+Xc(nn.internal.getWidth(e)/2)+" "+Xc(nn.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+i+" "+i+" "+s+" 0 "+s+" c"),r.push("-"+i+" "+s+" -"+s+" "+i+" -"+s+" 0 c"),r.push("-"+s+" -"+i+" -"+i+" -"+s+" 0 -"+s+" c"),r.push(i+" -"+s+" "+s+" -"+i+" "+s+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=Ol(e);t.scope=e.scope;var r=[],s=nn.internal.getWidth(e)<=nn.internal.getHeight(e)?nn.internal.getWidth(e)/4:nn.internal.getHeight(e)/4;s=Number((.9*s).toFixed(5));var a=Number((2*s).toFixed(5)),i=Number((a*nn.internal.Bezier_C).toFixed(5)),o=Number((s*nn.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Xc(nn.internal.getWidth(e)/2)+" "+Xc(nn.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),r.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),r.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),r.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+Xc(nn.internal.getWidth(e)/2)+" "+Xc(nn.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),r.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),r.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),r.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=Ol(e);t.scope=e.scope;var r=[],s=nn.internal.getWidth(e)<=nn.internal.getHeight(e)?nn.internal.getWidth(e)/4:nn.internal.getHeight(e)/4;s=Number((.9*s).toFixed(5));var a=Number((2*s).toFixed(5)),i=Number((a*nn.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Xc(nn.internal.getWidth(e)/2)+" "+Xc(nn.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),r.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),r.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),r.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:nn.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=nn.RadioButton.Cross.YesNormal,t.D[e]=nn.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=Ol(e);t.scope=e.scope;var r=[],s=nn.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+Nn(nn.internal.getWidth(e)-2)+" "+Nn(nn.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Nn(s.x1.x)+" "+Nn(s.x1.y)+" m"),r.push(Nn(s.x2.x)+" "+Nn(s.x2.y)+" l"),r.push(Nn(s.x4.x)+" "+Nn(s.x4.y)+" m"),r.push(Nn(s.x3.x)+" "+Nn(s.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=Ol(e);t.scope=e.scope;var r=nn.internal.calculateCross(e),s=[];return s.push("0.749023 g"),s.push("0 0 "+Nn(nn.internal.getWidth(e))+" "+Nn(nn.internal.getHeight(e))+" re"),s.push("f"),s.push("q"),s.push("1 1 "+Nn(nn.internal.getWidth(e)-2)+" "+Nn(nn.internal.getHeight(e)-2)+" re"),s.push("W"),s.push("n"),s.push(Nn(r.x1.x)+" "+Nn(r.x1.y)+" m"),s.push(Nn(r.x2.x)+" "+Nn(r.x2.y)+" l"),s.push(Nn(r.x4.x)+" "+Nn(r.x4.y)+" m"),s.push(Nn(r.x3.x)+" "+Nn(r.x3.y)+" l"),s.push("s"),s.push("Q"),t.stream=s.join(`
`),t},OffPushDown:function(e){var t=Ol(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Nn(nn.internal.getWidth(e))+" "+Nn(nn.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};nn.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=nn.internal.getWidth(e),r=nn.internal.getHeight(e),s=Math.min(t,r);return{x1:{x:(t-s)/2,y:(r-s)/2+s},x2:{x:(t-s)/2+s,y:(r-s)/2},x3:{x:(t-s)/2,y:(r-s)/2},x4:{x:(t-s)/2+s,y:(r-s)/2+s}}}},nn.internal.getWidth=function(e){var t=0;return ds(e)==="object"&&(t=Cj(e.Rect[2])),t},nn.internal.getHeight=function(e){var t=0;return ds(e)==="object"&&(t=Cj(e.Rect[3])),t};var rY=Hs.addField=function(e){if(tY(this,e),!(e instanceof _l))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};Hs.AcroFormChoiceField=Xf,Hs.AcroFormListBox=Yf,Hs.AcroFormComboBox=Kf,Hs.AcroFormEditBox=Lx,Hs.AcroFormButton=Oa,Hs.AcroFormPushButton=Fx,Hs.AcroFormRadioButton=Jf,Hs.AcroFormCheckBox=Mx,Hs.AcroFormTextField=fu,Hs.AcroFormPasswordField=Rx,Hs.AcroFormAppearance=nn,Hs.AcroForm={ChoiceField:Xf,ListBox:Yf,ComboBox:Kf,EditBox:Lx,Button:Oa,PushButton:Fx,RadioButton:Jf,CheckBox:Mx,TextField:fu,PasswordField:Rx,Appearance:nn},un.AcroForm={ChoiceField:Xf,ListBox:Yf,ComboBox:Kf,EditBox:Lx,Button:Oa,PushButton:Fx,RadioButton:Jf,CheckBox:Mx,TextField:fu,PasswordField:Rx,Appearance:nn};un.AcroForm;function n8(e){return e.reduce(function(t,r,s){return t[r]=s,t},{})}(function(e){var t="addImage_";e.__addimage__={};var r="UNKNOWN",s={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=e.__addimage__.getImageFileTypeByImageData=function(A,N){var P,K,re,ge,Fe,R=r;if((N=N||r)==="RGBA"||A.data!==void 0&&A.data instanceof Uint8ClampedArray&&"height"in A&&"width"in A)return"RGBA";if(L(A))for(Fe in s)for(re=s[Fe],P=0;P<re.length;P+=1){for(ge=!0,K=0;K<re[P].length;K+=1)if(re[P][K]!==void 0&&re[P][K]!==A[K]){ge=!1;break}if(ge===!0){R=Fe;break}}else for(Fe in s)for(re=s[Fe],P=0;P<re.length;P+=1){for(ge=!0,K=0;K<re[P].length;K+=1)if(re[P][K]!==void 0&&re[P][K]!==A.charCodeAt(K)){ge=!1;break}if(ge===!0){R=Fe;break}}return R===r&&N!==r&&(R=N),R},i=function A(N){for(var P=this.internal.write,K=this.internal.putStream,re=(0,this.internal.getFilters)();re.indexOf("FlateEncode")!==-1;)re.splice(re.indexOf("FlateEncode"),1);N.objectId=this.internal.newObject();var ge=[];if(ge.push({key:"Type",value:"/XObject"}),ge.push({key:"Subtype",value:"/Image"}),ge.push({key:"Width",value:N.width}),ge.push({key:"Height",value:N.height}),N.colorSpace===m.INDEXED?ge.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(N.palette.length/3-1)+" "+("sMask"in N&&N.sMask!==void 0?N.objectId+2:N.objectId+1)+" 0 R]"}):(ge.push({key:"ColorSpace",value:"/"+N.colorSpace}),N.colorSpace===m.DEVICE_CMYK&&ge.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ge.push({key:"BitsPerComponent",value:N.bitsPerComponent}),"decodeParameters"in N&&N.decodeParameters!==void 0&&ge.push({key:"DecodeParms",value:"<<"+N.decodeParameters+">>"}),"transparency"in N&&Array.isArray(N.transparency)&&N.transparency.length>0){for(var Fe="",R=0,q=N.transparency.length;R<q;R++)Fe+=N.transparency[R]+" "+N.transparency[R]+" ";ge.push({key:"Mask",value:"["+Fe+"]"})}N.sMask!==void 0&&ge.push({key:"SMask",value:N.objectId+1+" 0 R"});var me=N.filter!==void 0?["/"+N.filter]:void 0;if(K({data:N.data,additionalKeyValues:ge,alreadyAppliedFilters:me,objectId:N.objectId}),P("endobj"),"sMask"in N&&N.sMask!==void 0){var fe,E=(fe=N.sMaskBitsPerComponent)!==null&&fe!==void 0?fe:N.bitsPerComponent,U={width:N.width,height:N.height,colorSpace:"DeviceGray",bitsPerComponent:E,data:N.sMask};"filter"in N&&(U.decodeParameters="/Predictor ".concat(N.predictor," /Colors 1 /BitsPerComponent ").concat(E," /Columns ").concat(N.width),U.filter=N.filter),A.call(this,U)}if(N.colorSpace===m.INDEXED){var I=this.internal.newObject();K({data:O(new Uint8Array(N.palette)),objectId:I}),P("endobj")}},o=function(){var A=this.internal.collections[t+"images"];for(var N in A)i.call(this,A[N])},l=function(){var A,N=this.internal.collections[t+"images"],P=this.internal.write;for(var K in N)P("/I"+(A=N[K]).index,A.objectId,"0","R")},c=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},d=function(){var A=this.internal.collections[t+"images"];return c.call(this),A},u=function(){return Object.keys(this.internal.collections[t+"images"]).length},h=function(A){return typeof e["process"+A.toUpperCase()]=="function"},p=function(A){return ds(A)==="object"&&A.nodeType===1},f=function(A,N){if(A.nodeName==="IMG"&&A.hasAttribute("src")){var P=""+A.getAttribute("src");if(P.indexOf("data:image/")===0)return Tx(unescape(P).split("base64,").pop());var K=e.loadFile(P,!0);if(K!==void 0)return K}if(A.nodeName==="CANVAS"){if(A.width===0||A.height===0)throw new Error("Given canvas must have data. Canvas width: "+A.width+", height: "+A.height);var re;switch(N){case"PNG":re="image/png";break;case"WEBP":re="image/webp";break;default:re="image/jpeg"}return Tx(A.toDataURL(re,1).split("base64,").pop())}},x=function(A){var N=this.internal.collections[t+"images"];if(N){for(var P in N)if(A===N[P].alias)return N[P]}},g=function(A,N,P){return A||N||(A=-96,N=-96),A<0&&(A=-1*P.width*72/A/this.internal.scaleFactor),N<0&&(N=-1*P.height*72/N/this.internal.scaleFactor),A===0&&(A=N*P.width/P.height),N===0&&(N=A*P.height/P.width),[A,N]},y=function(A,N,P,K,re,ge){var Fe=g.call(this,P,K,re),R=this.internal.getCoordinateString,q=this.internal.getVerticalCoordinateString,me=d.call(this);if(P=Fe[0],K=Fe[1],me[re.index]=re,ge){ge*=Math.PI/180;var fe=Math.cos(ge),E=Math.sin(ge),U=function(M){return M.toFixed(4)},I=[U(fe),U(E),U(-1*E),U(fe),0,0,"cm"]}this.internal.write("q"),ge?(this.internal.write([1,"0","0",1,R(A),q(N+K),"cm"].join(" ")),this.internal.write(I.join(" ")),this.internal.write([R(P),"0","0",R(K),"0","0","cm"].join(" "))):this.internal.write([R(P),"0","0",R(K),R(A),q(N+K),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+re.index+" Do"),this.internal.write("Q")},m=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var w=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},S=e.__addimage__.sHashCode=function(A){var N,P,K=0;if(typeof A=="string")for(P=A.length,N=0;N<P;N++)K=(K<<5)-K+A.charCodeAt(N),K|=0;else if(L(A))for(P=A.byteLength/2,N=0;N<P;N++)K=(K<<5)-K+A[N],K|=0;return K},k=e.__addimage__.validateStringAsBase64=function(A){(A=A||"").toString().trim();var N=!0;return A.length===0&&(N=!1),A.length%4!=0&&(N=!1),/^[A-Za-z0-9+/]+$/.test(A.substr(0,A.length-2))===!1&&(N=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(A.substr(-2))===!1&&(N=!1),N},F=e.__addimage__.extractImageFromDataUrl=function(A){if(A==null||!(A=A.trim()).startsWith("data:"))return null;var N=A.indexOf(",");return N<0?null:A.substring(0,N).trim().endsWith("base64")?A.substring(N+1):null};e.__addimage__.isArrayBuffer=function(A){return A instanceof ArrayBuffer};var L=e.__addimage__.isArrayBufferView=function(A){return A instanceof Int8Array||A instanceof Uint8Array||A instanceof Uint8ClampedArray||A instanceof Int16Array||A instanceof Uint16Array||A instanceof Int32Array||A instanceof Uint32Array||A instanceof Float32Array||A instanceof Float64Array},C=e.__addimage__.binaryStringToUint8Array=function(A){for(var N=A.length,P=new Uint8Array(N),K=0;K<N;K++)P[K]=A.charCodeAt(K);return P},O=e.__addimage__.arrayBufferToBinaryString=function(A){for(var N="",P=L(A)?A:new Uint8Array(A),K=0;K<P.length;K+=8192)N+=String.fromCharCode.apply(null,P.subarray(K,K+8192));return N};e.addImage=function(){var A,N,P,K,re,ge,Fe,R,q;if(typeof arguments[1]=="number"?(N=r,P=arguments[1],K=arguments[2],re=arguments[3],ge=arguments[4],Fe=arguments[5],R=arguments[6],q=arguments[7]):(N=arguments[1],P=arguments[2],K=arguments[3],re=arguments[4],ge=arguments[5],Fe=arguments[6],R=arguments[7],q=arguments[8]),ds(A=arguments[0])==="object"&&!p(A)&&"imageData"in A){var me=A;A=me.imageData,N=me.format||N||r,P=me.x||P||0,K=me.y||K||0,re=me.w||me.width||re,ge=me.h||me.height||ge,Fe=me.alias||Fe,R=me.compression||R,q=me.rotation||me.angle||q}var fe=this.internal.getFilters();if(R===void 0&&fe.indexOf("FlateEncode")!==-1&&(R="SLOW"),isNaN(P)||isNaN(K))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var E=T.call(this,A,N,Fe,R);return y.call(this,P,K,re,ge,E,q),this};var T=function(A,N,P,K){var re,ge,Fe;if(typeof A=="string"&&a(A)===r){A=unescape(A);var R=W(A,!1);(R!==""||(R=e.loadFile(A,!0))!==void 0)&&(A=R)}if(p(A)&&(A=f(A,N)),N=a(A,N),!h(N))throw new Error("addImage does not support files of type '"+N+"', please ensure that a plugin for '"+N+"' support is added.");if(((Fe=P)==null||Fe.length===0)&&(P=function(q){return typeof q=="string"||L(q)?S(q):L(q.data)?S(q.data):null}(A)),(re=x.call(this,P))||(A instanceof Uint8Array||N==="RGBA"||(ge=A,A=C(A)),re=this["process"+N.toUpperCase()](A,u.call(this),P,function(q){return q&&typeof q=="string"&&(q=q.toUpperCase()),q in e.image_compression?q:w.NONE}(K),ge)),!re)throw new Error("An unknown error occurred whilst processing the image.");return re},W=e.__addimage__.convertBase64ToBinaryString=function(A,N){N=typeof N!="boolean"||N;var P,K="";if(typeof A=="string"){var re;P=(re=F(A))!==null&&re!==void 0?re:A;try{K=Tx(P)}catch(ge){if(N)throw k(P)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ge.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return K};e.getImageProperties=function(A){var N,P,K="";if(p(A)&&(A=f(A)),typeof A=="string"&&a(A)===r&&((K=W(A,!1))===""&&(K=e.loadFile(A)||""),A=K),P=a(A),!h(P))throw new Error("addImage does not support files of type '"+P+"', please ensure that a plugin for '"+P+"' support is added.");if(A instanceof Uint8Array||(A=C(A)),!(N=this["process"+P.toUpperCase()](A)))throw new Error("An unknown error occurred whilst processing the image");return N.fileType=P,N}})(un.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};un.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var s,a,i,o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(r.objId),d=r.pageContext.annotations,u=!1,h=0;h<d.length&&!u;h++)switch((s=d[h]).type){case"link":(t(s.options.url)||t(s.options.pageNumber))&&(u=!0);break;case"reference":case"text":case"freetext":u=!0}if(u!=0){this.internal.write("/Annots [");for(var p=0;p<d.length;p++){s=d[p];var f=this.internal.pdfEscape,x=this.internal.getEncryptor(r.objId);switch(s.type){case"reference":this.internal.write(" "+s.object.objId+" 0 R ");break;case"text":var g=this.internal.newAdditionalObject(),y=this.internal.newAdditionalObject(),m=this.internal.getEncryptor(g.objId),w=s.title||"Note";i="<</Type /Annot /Subtype /Text "+(a="/Rect ["+o(s.bounds.x)+" "+l(s.bounds.y+s.bounds.h)+" "+o(s.bounds.x+s.bounds.w)+" "+l(s.bounds.y)+"] ")+"/Contents ("+f(m(s.contents))+")",i+=" /Popup "+y.objId+" 0 R",i+=" /P "+c.objId+" 0 R",i+=" /T ("+f(m(w))+") >>",g.content=i;var S=g.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(a="/Rect ["+o(s.bounds.x+30)+" "+l(s.bounds.y+s.bounds.h)+" "+o(s.bounds.x+s.bounds.w+30)+" "+l(s.bounds.y)+"] ")+" /Parent "+S,s.open&&(i+=" /Open true"),i+=" >>",y.content=i,this.internal.write(g.objId,"0 R",y.objId,"0 R");break;case"freetext":a="/Rect ["+o(s.bounds.x)+" "+l(s.bounds.y)+" "+o(s.bounds.x+s.bounds.w)+" "+l(s.bounds.y+s.bounds.h)+"] ";var k=s.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+a+"/Contents ("+f(x(s.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+k+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(s.options.name){var F=this.annotations._nameMap[s.options.name];s.options.pageNumber=F.page,s.options.top=F.y}else s.options.top||(s.options.top=0);if(a="/Rect ["+s.finalBounds.x+" "+s.finalBounds.y+" "+s.finalBounds.w+" "+s.finalBounds.h+"] ",i="",s.options.url)i="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /A <</S /URI /URI ("+f(x(s.options.url))+") >>";else if(s.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(s.options.pageNumber).objId+" 0 R",s.options.magFactor=s.options.magFactor||"XYZ",s.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+s.options.top+"]";break;case"FitV":s.options.left=s.options.left||0,i+=" /FitV "+s.options.left+"]";break;default:var L=l(s.options.top);s.options.left=s.options.left||0,s.options.zoom===void 0&&(s.options.zoom=0),i+=" /XYZ "+s.options.left+" "+L+" "+s.options.zoom+"]"}i!=""&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var s=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":s.pageContext.annotations.push(r)}},e.link=function(r,s,a,i,o){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(r),y:d(s),w:c(r+a),h:d(s+i)},options:o,type:"link"})},e.textWithLink=function(r,s,a,i){var o,l,c=this.getTextWidth(r),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(i.maxWidth!==void 0){l=i.maxWidth;var u=this.splitTextToSize(r,l).length;o=Math.ceil(d*u)}else l=c,o=d;return this.text(r,s,a,i),a+=.2*d,i.align==="center"&&(s-=c/2),i.align==="right"&&(s-=c),this.link(s,a-d,l,o,i),c},e.getTextWidth=function(r){var s=this.internal.getFontSize();return this.getStringUnitWidth(r)*s/this.internal.scaleFactor}}(un.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},s={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];e.__arabicParser__={};var i=e.__arabicParser__.isInArabicSubstitutionA=function(g){return t[g.charCodeAt(0)]!==void 0},o=e.__arabicParser__.isArabicLetter=function(g){return typeof g=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(g)},l=e.__arabicParser__.isArabicEndLetter=function(g){return o(g)&&i(g)&&t[g.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(g){return o(g)&&a.indexOf(g.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(g){return o(g)&&i(g)&&t[g.charCodeAt(0)].length>=1};var d=e.__arabicParser__.arabicLetterHasFinalForm=function(g){return o(g)&&i(g)&&t[g.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(g){return o(g)&&i(g)&&t[g.charCodeAt(0)].length>=3};var u=e.__arabicParser__.arabicLetterHasMedialForm=function(g){return o(g)&&i(g)&&t[g.charCodeAt(0)].length==4},h=e.__arabicParser__.resolveLigatures=function(g){var y=0,m=r,w="",S=0;for(y=0;y<g.length;y+=1)m[g.charCodeAt(y)]!==void 0?(S++,typeof(m=m[g.charCodeAt(y)])=="number"&&(w+=String.fromCharCode(m),m=r,S=0),y===g.length-1&&(m=r,w+=g.charAt(y-(S-1)),y-=S-1,S=0)):(m=r,w+=g.charAt(y-S),y-=S,S=0);return w};e.__arabicParser__.isArabicDiacritic=function(g){return g!==void 0&&s[g.charCodeAt(0)]!==void 0};var p=e.__arabicParser__.getCorrectForm=function(g,y,m){return o(g)?i(g)===!1?-1:!d(g)||!o(y)&&!o(m)||!o(m)&&l(y)||l(g)&&!o(y)||l(g)&&c(y)||l(g)&&l(y)?0:u(g)&&o(y)&&!l(y)&&o(m)&&d(m)?3:l(g)||!o(m)?1:2:-1},f=function(g){var y=0,m=0,w=0,S="",k="",F="",L=(g=g||"").split("\\s+"),C=[];for(y=0;y<L.length;y+=1){for(C.push(""),m=0;m<L[y].length;m+=1)S=L[y][m],k=L[y][m-1],F=L[y][m+1],o(S)?(w=p(S,k,F),C[y]+=w!==-1?String.fromCharCode(t[S.charCodeAt(0)][w]):S):C[y]+=S;C[y]=h(C[y])}return C.join(" ")},x=e.__arabicParser__.processArabic=e.processArabic=function(){var g,y=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,m=[];if(Array.isArray(y)){var w=0;for(m=[],w=0;w<y.length;w+=1)Array.isArray(y[w])?m.push([f(y[w][0]),y[w][1],y[w][2]]):m.push([f(y[w])]);g=m}else g=f(y);return typeof arguments[0]=="string"?g:(arguments[0].text=g,arguments[0])};e.events.push(["preProcessText",x])}(un.API),un.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform",e.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var s=150;Object.defineProperty(this,"width",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=s+1)}});var a=300;Object.defineProperty(this,"height",{get:function(){return a},set:function(l){a=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=a+1)}});var i=[];Object.defineProperty(this,"childNodes",{get:function(){return i},set:function(l){i=l}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(l){o=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,s){var a;if((r=r||"2d")!=="2d")return null;for(a in s)this.pdf.context2d.hasOwnProperty(a)&&(this.pdf.context2d[a]=s[a]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(un.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,s=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(g){c=g}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(g){d=g}});var u=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return u},set:function(g){u=g}});var h=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return h},set:function(g){h=g}});var p=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return p},set:function(g){p=g}});var f=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return f},set:function(g){f=g}});var x=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return x},set:function(g){x=g}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(c){return s.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},e.getTextDimensions=function(c,d){s.call(this);var u=(d=d||{}).fontSize||this.getFontSize(),h=d.font||this.getFont(),p=d.scaleFactor||this.internal.scaleFactor,f=0,x=0,g=0,y=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var m=d.maxWidth;m>0?typeof c=="string"?c=this.splitTextToSize(c,m):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(S,k){return S.concat(y.splitTextToSize(k,m))},[])):c=Array.isArray(c)?c:[c];for(var w=0;w<c.length;w++)f<(g=this.getStringUnitWidth(c[w],{font:h})*u)&&(f=g);return f!==0&&(x=c.length),{w:f/=p,h:Math.max((x*u*this.getLineHeightFactor()-u*(this.getLineHeightFactor()-1))/p,0)}},e.cellAddPage=function(){s.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new i(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=e.cell=function(){var c;c=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),s.call(this);var d=this.internal.__cell__.lastCell,u=this.internal.__cell__.padding,h=this.internal.__cell__.margins||t,p=this.internal.__cell__.tableHeaderRow,f=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===c.lineNumber?(c.x=(d.x||0)+(d.width||0),c.y=d.y||0):d.y+d.height+c.height+h.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=h.top,f&&p&&(this.printHeaderRow(c.lineNumber,!0),c.y+=p[0].height)):c.y=d.y+d.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,r===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-u,c.y+u,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+u,{align:"center",baseline:"top",maxWidth:c.width-u-u}):this.text(c.text,c.x+u,c.y+u,{align:"left",baseline:"top",maxWidth:c.width-u-u})),this.internal.__cell__.lastCell=c,this};e.table=function(c,d,u,h,p){if(s.call(this),!u)throw new Error("No data for PDF table.");var f,x,g,y,m=[],w=[],S=[],k={},F={},L=[],C=[],O=(p=p||{}).autoSize||!1,T=p.printHeaders!==!1,W=p.css&&p.css["font-size"]!==void 0?16*p.css["font-size"]:p.fontSize||12,A=p.margins||Object.assign({width:this.getPageWidth()},t),N=typeof p.padding=="number"?p.padding:3,P=p.headerBackgroundColor||"#c8c8c8",K=p.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=T,this.internal.__cell__.margins=A,this.internal.__cell__.table_font_size=W,this.internal.__cell__.padding=N,this.internal.__cell__.headerBackgroundColor=P,this.internal.__cell__.headerTextColor=K,this.setFontSize(W),h==null)w=m=Object.keys(u[0]),S=m.map(function(){return"left"});else if(Array.isArray(h)&&ds(h[0])==="object")for(m=h.map(function(me){return me.name}),w=h.map(function(me){return me.prompt||me.name||""}),S=h.map(function(me){return me.align||"left"}),f=0;f<h.length;f+=1)F[h[f].name]=.7499990551181103*h[f].width;else Array.isArray(h)&&typeof h[0]=="string"&&(w=m=h,S=m.map(function(){return"left"}));if(O||Array.isArray(h)&&typeof h[0]=="string")for(f=0;f<m.length;f+=1){for(k[y=m[f]]=u.map(function(me){return me[y]}),this.setFont(void 0,"bold"),L.push(this.getTextDimensions(w[f],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),x=k[y],this.setFont(void 0,"normal"),g=0;g<x.length;g+=1)L.push(this.getTextDimensions(x[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);F[y]=Math.max.apply(null,L)+N+N,L=[]}if(T){var re={};for(f=0;f<m.length;f+=1)re[m[f]]={},re[m[f]].text=w[f],re[m[f]].align=S[f];var ge=l.call(this,re,F);C=m.map(function(me){return new i(c,d,F[me],ge,re[me].text,void 0,re[me].align)}),this.setTableHeaderRow(C),this.printHeaderRow(1,!1)}var Fe=h.reduce(function(me,fe){return me[fe.name]=fe.align,me},{});for(f=0;f<u.length;f+=1){"rowStart"in p&&p.rowStart instanceof Function&&p.rowStart({row:f,data:u[f]},this);var R=l.call(this,u[f],F);for(g=0;g<m.length;g+=1){var q=u[f][m[g]];"cellStart"in p&&p.cellStart instanceof Function&&p.cellStart({row:f,col:g,data:q},this),o.call(this,new i(c,d,F[m[g]],R,q,f+2,Fe[m[g]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=d,this};var l=function(c,d){var u=this.internal.__cell__.padding,h=this.internal.__cell__.table_font_size,p=this.internal.scaleFactor;return Object.keys(c).map(function(f){var x=c[f];return this.splitTextToSize(x.hasOwnProperty("text")?x.text:x,d[f]-u-u)},this).map(function(f){return this.getLineHeightFactor()*f.length*h/p+u+u},this).reduce(function(f,x){return Math.max(f,x)},0)};e.setTableHeaderRow=function(c){s.call(this),this.internal.__cell__.tableHeaderRow=c},e.printHeaderRow=function(c,d){if(s.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var u;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var h=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(h[0],h[1],h[2],h[3],void 0,-1)}this.setFont(void 0,"bold");for(var p=[],f=0;f<this.internal.__cell__.tableHeaderRow.length;f+=1){u=this.internal.__cell__.tableHeaderRow[f].clone(),d&&(u.y=this.internal.__cell__.margins.top||0,p.push(u)),u.lineNumber=c;var x=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,u),this.setTextColor(x)}p.length>0&&this.setTableHeaderRow(p),this.setFont(void 0,"normal"),r=!1}}(un.API);var s8={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},a8=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],z2=n8(a8),i8=[100,200,300,400,500,600,700,800,900],nY=n8(i8);function Ky(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(i){return s8[i=i||"normal"]?i:"normal"}(e.style),s=function(i){return i?typeof i=="number"?i>=100&&i<=900&&i%100==0?i:400:/^\d00$/.test(i)?parseInt(i):i==="bold"?700:400:400}(e.weight),a=function(i){return typeof z2[i=i||"normal"]=="number"?i:"normal"}(e.stretch);return{family:t,style:r,weight:s,stretch:a,src:e.src||[],ref:e.ref||{name:t,style:[a,r,s].join(" ")}}}function Ej(e,t,r,s){var a;for(a=r;a>=0&&a<t.length;a+=s)if(e[t[a]])return e[t[a]];for(a=r;a>=0&&a<t.length;a-=s)if(e[t[a]])return e[t[a]]}var sY={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Tj={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Lj(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function Fj(e){return e.trimLeft()}function aY(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function iY(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var tf,Ym,Mj,Rj,Bj,Jy=["times"];function Pj(e,t,r,s,a){var i=4,o=Ij;switch(a){case un.API.image_compression.FAST:i=1,o=Oj;break;case un.API.image_compression.MEDIUM:i=6,o=Dj;break;case un.API.image_compression.SLOW:i=9,o=Uj}e=function(c,d,u,h){for(var p,f=c.length/d,x=new Uint8Array(c.length+f),g=[oY,Oj,Ij,Dj,Uj],y=0;y<f;y+=1){var m=y*d,w=c.subarray(m,m+d);if(h)x.set(h(w,u,p),m+y);else{for(var S=g.length,k=[],F=0;F<S;F+=1)k[F]=g[F](w,u,p);var L=cY(k.concat());x.set(k[L],m+y)}p=w}return x}(e,t,Math.ceil(r*s/8),o);var l=P2(e,{level:i});return un.API.__addimage__.arrayBufferToBinaryString(l)}function oY(e){var t=Array.apply([],e);return t.unshift(0),t}function Oj(e,t){var r=e.length,s=[];s[0]=1;for(var a=0;a<r;a+=1){var i=e[a-t]||0;s[a+1]=e[a]-i+256&255}return s}function Ij(e,t,r){var s=e.length,a=[];a[0]=2;for(var i=0;i<s;i+=1){var o=r&&r[i]||0;a[i+1]=e[i]-o+256&255}return a}function Dj(e,t,r){var s=e.length,a=[];a[0]=3;for(var i=0;i<s;i+=1){var o=e[i-t]||0,l=r&&r[i]||0;a[i+1]=e[i]+256-(o+l>>>1)&255}return a}function Uj(e,t,r){var s=e.length,a=[];a[0]=4;for(var i=0;i<s;i+=1){var o=lY(e[i-t]||0,r&&r[i]||0,r&&r[i-t]||0);a[i+1]=e[i]-o+256&255}return a}function lY(e,t,r){if(e===t&&t===r)return e;var s=Math.abs(t-r),a=Math.abs(e-r),i=Math.abs(e+t-r-r);return s<=a&&s<=i?e:a<=i?t:r}function cY(e){var t=e.map(function(r){return r.reduce(function(s,a){return s+Math.abs(a)},0)});return t.indexOf(Math.min.apply(null,t))}function Zy(e,t,r){var s=t*r,a=Math.floor(s/8),i=16-(s-8*a+r),o=(1<<r)-1;return o8(e,a)>>i&o}function $j(e,t,r,s){var a=r*s,i=Math.floor(a/8),o=16-(a-8*i+s),l=(1<<s)-1,c=(t&l)<<o;(function(d,u,h){if(u+1<d.byteLength)d.setUint16(u,h,!1);else{var p=h>>8&255;d.setUint8(u,p)}})(e,i,o8(e,i)&~(l<<o)&65535|c)}function o8(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function dY(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,s=e[t++]|e[t++]<<8,a=e[t++],i=a>>7,o=1<<1+(7&a);e[t++],e[t++];var l=null,c=null;i&&(l=t,c=o,t+=3*o);var d=!0,u=[],h=0,p=null,f=0,x=null;for(this.width=r,this.height=s;d&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,x=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((A=e[t++])>=0))throw Error("Invalid block size");if(A===0)break;t+=A}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var g=e[t++];h=e[t++]|e[t++]<<8,p=e[t++],1&g||(p=null),f=g>>2&7,t++;break;case 254:for(;;){if(!((A=e[t++])>=0))throw Error("Invalid block size");if(A===0)break;t+=A}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var y=e[t++]|e[t++]<<8,m=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,S=e[t++]|e[t++]<<8,k=e[t++],F=k>>6&1,L=1<<1+(7&k),C=l,O=c,T=!1;k>>7&&(T=!0,C=t,O=L,t+=3*L);var W=t;for(t++;;){var A;if(!((A=e[t++])>=0))throw Error("Invalid block size");if(A===0)break;t+=A}u.push({x:y,y:m,width:w,height:S,has_local_palette:T,palette_offset:C,palette_size:O,data_offset:W,data_length:t-W,transparent_index:p,interlaced:!!F,delay:h,disposal:f});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return x},this.frameInfo=function(N){if(N<0||N>=u.length)throw new Error("Frame index out of range.");return u[N]},this.decodeAndBlitFrameBGRA=function(N,P){var K=this.frameInfo(N),re=K.width*K.height,ge=new Uint8Array(re);Wj(e,K.data_offset,ge,re);var Fe=K.palette_offset,R=K.transparent_index;R===null&&(R=256);var q=K.width,me=r-q,fe=q,E=4*(K.y*r+K.x),U=4*((K.y+K.height)*r+K.x),I=E,M=4*me;K.interlaced===!0&&(M+=4*r*7);for(var te=8,Q=0,G=ge.length;Q<G;++Q){var ne=ge[Q];if(fe===0&&(fe=q,(I+=M)>=U&&(M=4*me+4*r*(te-1),I=E+(q+me)*(te<<1),te>>=1)),ne===R)I+=4;else{var z=e[Fe+3*ne],he=e[Fe+3*ne+1],X=e[Fe+3*ne+2];P[I++]=X,P[I++]=he,P[I++]=z,P[I++]=255}--fe}},this.decodeAndBlitFrameRGBA=function(N,P){var K=this.frameInfo(N),re=K.width*K.height,ge=new Uint8Array(re);Wj(e,K.data_offset,ge,re);var Fe=K.palette_offset,R=K.transparent_index;R===null&&(R=256);var q=K.width,me=r-q,fe=q,E=4*(K.y*r+K.x),U=4*((K.y+K.height)*r+K.x),I=E,M=4*me;K.interlaced===!0&&(M+=4*r*7);for(var te=8,Q=0,G=ge.length;Q<G;++Q){var ne=ge[Q];if(fe===0&&(fe=q,(I+=M)>=U&&(M=4*me+4*r*(te-1),I=E+(q+me)*(te<<1),te>>=1)),ne===R)I+=4;else{var z=e[Fe+3*ne],he=e[Fe+3*ne+1],X=e[Fe+3*ne+2];P[I++]=z,P[I++]=he,P[I++]=X,P[I++]=255}--fe}}}function Wj(e,t,r,s){for(var a=e[t++],i=1<<a,o=i+1,l=o+1,c=a+1,d=(1<<c)-1,u=0,h=0,p=0,f=e[t++],x=new Int32Array(4096),g=null;;){for(;u<16&&f!==0;)h|=e[t++]<<u,u+=8,f===1?f=e[t++]:--f;if(u<c)break;var y=h&d;if(h>>=c,u-=c,y!==i){if(y===o)break;for(var m=y<l?y:g,w=0,S=m;S>i;)S=x[S]>>8,++w;var k=S;if(p+w+(m!==y?1:0)>s)return void ys.log("Warning, gif stream longer than expected.");r[p++]=k;var F=p+=w;for(m!==y&&(r[p++]=k),S=m;w--;)S=x[S],r[--F]=255&S,S>>=8;g!==null&&l<4096&&(x[l++]=g<<8|k,l>=d+1&&c<12&&(++c,d=d<<1|1)),g=y}else l=o+1,d=(1<<(c=a+1))-1,g=null}return p!==s&&ys.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function eb(e){var t,r,s,a,i,o=Math.floor,l=new Array(64),c=new Array(64),d=new Array(64),u=new Array(64),h=new Array(65535),p=new Array(65535),f=new Array(64),x=new Array(64),g=[],y=0,m=7,w=new Array(64),S=new Array(64),k=new Array(64),F=new Array(256),L=new Array(2048),C=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],O=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],N=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],P=[0,1,2,3,4,5,6,7,8,9,10,11],K=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],re=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ge(E,U){for(var I=0,M=0,te=new Array,Q=1;Q<=16;Q++){for(var G=1;G<=E[Q];G++)te[U[M]]=[],te[U[M]][0]=I,te[U[M]][1]=Q,M++,I++;I*=2}return te}function Fe(E){for(var U=E[0],I=E[1]-1;I>=0;)U&1<<I&&(y|=1<<m),I--,--m<0&&(y==255?(R(255),R(0)):R(y),m=7,y=0)}function R(E){g.push(E)}function q(E){R(E>>8&255),R(255&E)}function me(E,U,I,M,te){for(var Q,G=te[0],ne=te[240],z=function(je,We){var Ee,Re,Ve,St,rt,ze,Ie,ot,be,we,Me=0;for(be=0;be<8;++be){Ee=je[Me],Re=je[Me+1],Ve=je[Me+2],St=je[Me+3],rt=je[Me+4],ze=je[Me+5],Ie=je[Me+6];var Wt=Ee+(ot=je[Me+7]),Ct=Ee-ot,pr=Re+Ie,fr=Re-Ie,Be=Ve+ze,mt=Ve-ze,It=St+rt,ft=St-rt,gr=Wt+It,Mr=Wt-It,$r=pr+Be,_r=pr-Be;je[Me]=gr+$r,je[Me+4]=gr-$r;var Vr=.707106781*(_r+Mr);je[Me+2]=Mr+Vr,je[Me+6]=Mr-Vr;var en=.382683433*((gr=ft+mt)-(_r=fr+Ct)),Xr=.5411961*gr+en,gn=1.306562965*_r+en,Oe=.707106781*($r=mt+fr),qe=Ct+Oe,Lt=Ct-Oe;je[Me+5]=Lt+Xr,je[Me+3]=Lt-Xr,je[Me+1]=qe+gn,je[Me+7]=qe-gn,Me+=8}for(Me=0,be=0;be<8;++be){Ee=je[Me],Re=je[Me+8],Ve=je[Me+16],St=je[Me+24],rt=je[Me+32],ze=je[Me+40],Ie=je[Me+48];var dt=Ee+(ot=je[Me+56]),He=Ee-ot,$t=Re+Ie,Ue=Re-Ie,er=Ve+ze,Z=Ve-ze,pe=St+rt,ee=St-rt,ue=dt+pe,Ae=dt-pe,Le=$t+er,ct=$t-er;je[Me]=ue+Le,je[Me+32]=ue-Le;var ce=.707106781*(ct+Ae);je[Me+16]=Ae+ce,je[Me+48]=Ae-ce;var xe=.382683433*((ue=ee+Z)-(ct=Ue+He)),se=.5411961*ue+xe,Se=1.306562965*ct+xe,Ze=.707106781*(Le=Z+Ue),et=He+Ze,Et=He-Ze;je[Me+40]=Et+se,je[Me+24]=Et-se,je[Me+8]=et+Se,je[Me+56]=et-Se,Me++}for(be=0;be<64;++be)we=je[be]*We[be],f[be]=we>0?we+.5|0:we-.5|0;return f}(E,U),he=0;he<64;++he)x[C[he]]=z[he];var X=x[0]-I;I=x[0],X==0?Fe(M[0]):(Fe(M[p[Q=32767+X]]),Fe(h[Q]));for(var H=63;H>0&&x[H]==0;)H--;if(H==0)return Fe(G),I;for(var oe,D=1;D<=H;){for(var Y=D;x[D]==0&&D<=H;)++D;var le=D-Y;if(le>=16){oe=le>>4;for(var $e=1;$e<=oe;++$e)Fe(ne);le&=15}Q=32767+x[D],Fe(te[(le<<4)+p[Q]]),Fe(h[Q]),D++}return H!=63&&Fe(G),I}function fe(E){E=Math.min(Math.max(E,1),100),i!=E&&(function(U){for(var I=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],M=0;M<64;M++){var te=o((I[M]*U+50)/100);te=Math.min(Math.max(te,1),255),l[C[M]]=te}for(var Q=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],G=0;G<64;G++){var ne=o((Q[G]*U+50)/100);ne=Math.min(Math.max(ne,1),255),c[C[G]]=ne}for(var z=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],he=0,X=0;X<8;X++)for(var H=0;H<8;H++)d[he]=1/(l[C[he]]*z[X]*z[H]*8),u[he]=1/(c[C[he]]*z[X]*z[H]*8),he++}(E<50?Math.floor(5e3/E):Math.floor(200-2*E)),i=E)}this.encode=function(E,U){U&&fe(U),g=new Array,y=0,m=7,q(65496),q(65504),q(16),R(74),R(70),R(73),R(70),R(0),R(1),R(1),R(0),q(1),q(1),R(0),R(0),function(){q(65499),q(132),R(0);for(var Re=0;Re<64;Re++)R(l[Re]);R(1);for(var Ve=0;Ve<64;Ve++)R(c[Ve])}(),function(Re,Ve){q(65472),q(17),R(8),q(Ve),q(Re),R(3),R(1),R(17),R(0),R(2),R(17),R(1),R(3),R(17),R(1)}(E.width,E.height),function(){q(65476),q(418),R(0);for(var Re=0;Re<16;Re++)R(O[Re+1]);for(var Ve=0;Ve<=11;Ve++)R(T[Ve]);R(16);for(var St=0;St<16;St++)R(W[St+1]);for(var rt=0;rt<=161;rt++)R(A[rt]);R(1);for(var ze=0;ze<16;ze++)R(N[ze+1]);for(var Ie=0;Ie<=11;Ie++)R(P[Ie]);R(17);for(var ot=0;ot<16;ot++)R(K[ot+1]);for(var be=0;be<=161;be++)R(re[be])}(),q(65498),q(12),R(3),R(1),R(0),R(2),R(17),R(3),R(17),R(0),R(63),R(0);var I=0,M=0,te=0;y=0,m=7,this.encode.displayName="_encode_";for(var Q,G,ne,z,he,X,H,oe,D,Y=E.data,le=E.width,$e=E.height,je=4*le,We=0;We<$e;){for(Q=0;Q<je;){for(he=je*We+Q,H=-1,oe=0,D=0;D<64;D++)X=he+(oe=D>>3)*je+(H=4*(7&D)),We+oe>=$e&&(X-=je*(We+1+oe-$e)),Q+H>=je&&(X-=Q+H-je+4),G=Y[X++],ne=Y[X++],z=Y[X++],w[D]=(L[G]+L[ne+256|0]+L[z+512|0]>>16)-128,S[D]=(L[G+768|0]+L[ne+1024|0]+L[z+1280|0]>>16)-128,k[D]=(L[G+1280|0]+L[ne+1536|0]+L[z+1792|0]>>16)-128;I=me(w,d,I,t,s),M=me(S,u,M,r,a),te=me(k,u,te,r,a),Q+=32}We+=8}if(m>=0){var Ee=[];Ee[1]=m+1,Ee[0]=(1<<m+1)-1,Fe(Ee)}return q(65497),new Uint8Array(g)},e=e||50,function(){for(var E=String.fromCharCode,U=0;U<256;U++)F[U]=E(U)}(),t=ge(O,T),r=ge(N,P),s=ge(W,A),a=ge(K,re),function(){for(var E=1,U=2,I=1;I<=15;I++){for(var M=E;M<U;M++)p[32767+M]=I,h[32767+M]=[],h[32767+M][1]=I,h[32767+M][0]=M;for(var te=-(U-1);te<=-E;te++)p[32767+te]=I,h[32767+te]=[],h[32767+te][1]=I,h[32767+te][0]=U-1+te;E<<=1,U<<=1}}(),function(){for(var E=0;E<256;E++)L[E]=19595*E,L[E+256|0]=38470*E,L[E+512|0]=7471*E+32768,L[E+768|0]=-11059*E,L[E+1024|0]=-21709*E,L[E+1280|0]=32768*E+8421375,L[E+1536|0]=-27439*E,L[E+1792|0]=-5329*E}(),fe(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function al(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function zj(e){function t(T){if(!T)throw Error("assert :P")}function r(T,W,A){for(var N=0;4>N;N++)if(T[W+N]!=A.charCodeAt(N))return!0;return!1}function s(T,W,A,N,P){for(var K=0;K<P;K++)T[W+K]=A[N+K]}function a(T,W,A,N){for(var P=0;P<N;P++)T[W+P]=A}function i(T){return new Int32Array(T)}function o(T,W){for(var A=[],N=0;N<T;N++)A.push(new W);return A}function l(T,W){var A=[];return function N(P,K,re){for(var ge=re[K],Fe=0;Fe<ge&&(P.push(re.length>K+1?[]:new W),!(re.length<K+1));Fe++)N(P[Fe],K+1,re)}(A,0,T),A}var c=function(){var T=this;function W(b,_){for(var B=1<<_-1>>>0;b&B;)B>>>=1;return B?(b&B-1)+B:b}function A(b,_,B,J,de){t(!(J%B));do b[_+(J-=B)]=de;while(0<J)}function N(b,_,B,J,de){if(t(2328>=de),512>=de)var ve=i(512);else if((ve=i(de))==null)return 0;return function(ke,Te,Pe,Ge,kt,Yt){var Qe,Tt,Ut=Te,yr=1<<Pe,Gt=i(16),br=i(16);for(t(kt!=0),t(Ge!=null),t(ke!=null),t(0<Pe),Tt=0;Tt<kt;++Tt){if(15<Ge[Tt])return 0;++Gt[Ge[Tt]]}if(Gt[0]==kt)return 0;for(br[1]=0,Qe=1;15>Qe;++Qe){if(Gt[Qe]>1<<Qe)return 0;br[Qe+1]=br[Qe]+Gt[Qe]}for(Tt=0;Tt<kt;++Tt)Qe=Ge[Tt],0<Ge[Tt]&&(Yt[br[Qe]++]=Tt);if(br[15]==1)return(Ge=new P).g=0,Ge.value=Yt[0],A(ke,Ut,1,yr,Ge),yr;var wr,Pr=-1,Er=yr-1,dn=0,rn=1,Fn=1,an=1<<Pe;for(Tt=0,Qe=1,kt=2;Qe<=Pe;++Qe,kt<<=1){if(rn+=Fn<<=1,0>(Fn-=Gt[Qe]))return 0;for(;0<Gt[Qe];--Gt[Qe])(Ge=new P).g=Qe,Ge.value=Yt[Tt++],A(ke,Ut+dn,kt,an,Ge),dn=W(dn,Qe)}for(Qe=Pe+1,kt=2;15>=Qe;++Qe,kt<<=1){if(rn+=Fn<<=1,0>(Fn-=Gt[Qe]))return 0;for(;0<Gt[Qe];--Gt[Qe]){if(Ge=new P,(dn&Er)!=Pr){for(Ut+=an,wr=1<<(Pr=Qe)-Pe;15>Pr&&!(0>=(wr-=Gt[Pr]));)++Pr,wr<<=1;yr+=an=1<<(wr=Pr-Pe),ke[Te+(Pr=dn&Er)].g=wr+Pe,ke[Te+Pr].value=Ut-Te-Pr}Ge.g=Qe-Pe,Ge.value=Yt[Tt++],A(ke,Ut+(dn>>Pe),kt,an,Ge),dn=W(dn,Qe)}}return rn!=2*br[15]-1?0:yr}(b,_,B,J,de,ve)}function P(){this.value=this.g=0}function K(){this.value=this.g=0}function re(){this.G=o(5,P),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Ud,K)}function ge(b,_,B,J){t(b!=null),t(_!=null),t(2147483648>J),b.Ca=254,b.I=0,b.b=-8,b.Ka=0,b.oa=_,b.pa=B,b.Jd=_,b.Yc=B+J,b.Zc=4<=J?B+J-4+1:B,G(b)}function Fe(b,_){for(var B=0;0<_--;)B|=z(b,128)<<_;return B}function R(b,_){var B=Fe(b,_);return ne(b)?-B:B}function q(b,_,B,J){var de,ve=0;for(t(b!=null),t(_!=null),t(4294967288>J),b.Sb=J,b.Ra=0,b.u=0,b.h=0,4<J&&(J=4),de=0;de<J;++de)ve+=_[B+de]<<8*de;b.Ra=ve,b.bb=J,b.oa=_,b.pa=B}function me(b){for(;8<=b.u&&b.bb<b.Sb;)b.Ra>>>=8,b.Ra+=b.oa[b.pa+b.bb]<<Rc-8>>>0,++b.bb,b.u-=8;M(b)&&(b.h=1,b.u=0)}function fe(b,_){if(t(0<=_),!b.h&&_<=ro){var B=I(b)&to[_];return b.u+=_,me(b),B}return b.h=1,b.u=0}function E(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function U(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function I(b){return b.Ra>>>(b.u&Rc-1)>>>0}function M(b){return t(b.bb<=b.Sb),b.h||b.bb==b.Sb&&b.u>Rc}function te(b,_){b.u=_,b.h=M(b)}function Q(b){b.u>=Zl&&(t(b.u>=Zl),me(b))}function G(b){t(b!=null&&b.oa!=null),b.pa<b.Zc?(b.I=(b.oa[b.pa++]|b.I<<8)>>>0,b.b+=8):(t(b!=null&&b.oa!=null),b.pa<b.Yc?(b.b+=8,b.I=b.oa[b.pa++]|b.I<<8):b.Ka?b.b=0:(b.I<<=8,b.b+=8,b.Ka=1))}function ne(b){return Fe(b,1)}function z(b,_){var B=b.Ca;0>b.b&&G(b);var J=b.b,de=B*_>>>8,ve=(b.I>>>J>de)+0;for(ve?(B-=de,b.I-=de+1<<J>>>0):B=de+1,J=B,de=0;256<=J;)de+=8,J>>=8;return J=7^de+Bc[J],b.b-=J,b.Ca=(B<<J)-1,ve}function he(b,_,B){b[_+0]=B>>24&255,b[_+1]=B>>16&255,b[_+2]=B>>8&255,b[_+3]=255&B}function X(b,_){return b[_+0]|b[_+1]<<8}function H(b,_){return X(b,_)|b[_+2]<<16}function oe(b,_){return X(b,_)|X(b,_+2)<<16}function D(b,_){var B=1<<_;return t(b!=null),t(0<_),b.X=i(B),b.X==null?0:(b.Mb=32-_,b.Xa=_,1)}function Y(b,_){t(b!=null),t(_!=null),t(b.Xa==_.Xa),s(_.X,0,b.X,0,1<<_.Xa)}function le(){this.X=[],this.Xa=this.Mb=0}function $e(b,_,B,J){t(B!=null),t(J!=null);var de=B[0],ve=J[0];return de==0&&(de=(b*ve+_/2)/_),ve==0&&(ve=(_*de+b/2)/b),0>=de||0>=ve?0:(B[0]=de,J[0]=ve,1)}function je(b,_){return b+(1<<_)-1>>>_}function We(b,_){return((4278255360&b)+(4278255360&_)>>>0&4278255360)+((16711935&b)+(16711935&_)>>>0&16711935)>>>0}function Ee(b,_){T[_]=function(B,J,de,ve,ke,Te,Pe){var Ge;for(Ge=0;Ge<ke;++Ge){var kt=T[b](Te[Pe+Ge-1],de,ve+Ge);Te[Pe+Ge]=We(B[J+Ge],kt)}}}function Re(){this.ud=this.hd=this.jd=0}function Ve(b,_){return((4278124286&(b^_))>>>1)+(b&_)>>>0}function St(b){return 0<=b&&256>b?b:0>b?0:255<b?255:void 0}function rt(b,_){return St(b+(b-_+.5>>1))}function ze(b,_,B){return Math.abs(_-B)-Math.abs(b-B)}function Ie(b,_,B,J,de,ve,ke){for(J=ve[ke-1],B=0;B<de;++B)ve[ke+B]=J=We(b[_+B],J)}function ot(b,_,B,J,de){var ve;for(ve=0;ve<B;++ve){var ke=b[_+ve],Te=ke>>8&255,Pe=16711935&(Pe=(Pe=16711935&ke)+((Te<<16)+Te));J[de+ve]=(4278255360&ke)+Pe>>>0}}function be(b,_){_.jd=255&b,_.hd=b>>8&255,_.ud=b>>16&255}function we(b,_,B,J,de,ve){var ke;for(ke=0;ke<J;++ke){var Te=_[B+ke],Pe=Te>>>8,Ge=Te,kt=255&(kt=(kt=Te>>>16)+((b.jd<<24>>24)*(Pe<<24>>24)>>>5));Ge=255&(Ge=(Ge+=(b.hd<<24>>24)*(Pe<<24>>24)>>>5)+((b.ud<<24>>24)*(kt<<24>>24)>>>5)),de[ve+ke]=(4278255360&Te)+(kt<<16)+Ge}}function Me(b,_,B,J,de){T[_]=function(ve,ke,Te,Pe,Ge,kt,Yt,Qe,Tt){for(Pe=Yt;Pe<Qe;++Pe)for(Yt=0;Yt<Tt;++Yt)Ge[kt++]=de(Te[J(ve[ke++])])},T[b]=function(ve,ke,Te,Pe,Ge,kt,Yt){var Qe=8>>ve.b,Tt=ve.Ea,Ut=ve.K[0],yr=ve.w;if(8>Qe)for(ve=(1<<ve.b)-1,yr=(1<<Qe)-1;ke<Te;++ke){var Gt,br=0;for(Gt=0;Gt<Tt;++Gt)Gt&ve||(br=J(Pe[Ge++])),kt[Yt++]=de(Ut[br&yr]),br>>=Qe}else T["VP8LMapColor"+B](Pe,Ge,Ut,yr,kt,Yt,ke,Te,Tt)}}function Wt(b,_,B,J,de){for(B=_+B;_<B;){var ve=b[_++];J[de++]=ve>>16&255,J[de++]=ve>>8&255,J[de++]=255&ve}}function Ct(b,_,B,J,de){for(B=_+B;_<B;){var ve=b[_++];J[de++]=ve>>16&255,J[de++]=ve>>8&255,J[de++]=255&ve,J[de++]=ve>>24&255}}function pr(b,_,B,J,de){for(B=_+B;_<B;){var ve=(ke=b[_++])>>16&240|ke>>12&15,ke=240&ke|ke>>28&15;J[de++]=ve,J[de++]=ke}}function fr(b,_,B,J,de){for(B=_+B;_<B;){var ve=(ke=b[_++])>>16&248|ke>>13&7,ke=ke>>5&224|ke>>3&31;J[de++]=ve,J[de++]=ke}}function Be(b,_,B,J,de){for(B=_+B;_<B;){var ve=b[_++];J[de++]=255&ve,J[de++]=ve>>8&255,J[de++]=ve>>16&255}}function mt(b,_,B,J,de,ve){if(ve==0)for(B=_+B;_<B;)he(J,((ve=b[_++])[0]>>24|ve[1]>>8&65280|ve[2]<<8&16711680|ve[3]<<24)>>>0),de+=32;else s(J,de,b,_,B)}function It(b,_){T[_][0]=T[b+"0"],T[_][1]=T[b+"1"],T[_][2]=T[b+"2"],T[_][3]=T[b+"3"],T[_][4]=T[b+"4"],T[_][5]=T[b+"5"],T[_][6]=T[b+"6"],T[_][7]=T[b+"7"],T[_][8]=T[b+"8"],T[_][9]=T[b+"9"],T[_][10]=T[b+"10"],T[_][11]=T[b+"11"],T[_][12]=T[b+"12"],T[_][13]=T[b+"13"],T[_][14]=T[b+"0"],T[_][15]=T[b+"0"]}function ft(b){return b==jg||b==Ng||b==nm||b==Ag}function gr(){this.eb=[],this.size=this.A=this.fb=0}function Mr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function $r(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new gr,this.f.kb=new Mr,this.sd=null}function _r(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Vr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function en(b){return alert("todo:WebPSamplerProcessPlane"),b.T}function Xr(b,_){var B=b.T,J=_.ba.f.RGBA,de=J.eb,ve=J.fb+b.ka*J.A,ke=Lo[_.ba.S],Te=b.y,Pe=b.O,Ge=b.f,kt=b.N,Yt=b.ea,Qe=b.W,Tt=_.cc,Ut=_.dc,yr=_.Mc,Gt=_.Nc,br=b.ka,wr=b.ka+b.T,Pr=b.U,Er=Pr+1>>1;for(br==0?ke(Te,Pe,null,null,Ge,kt,Yt,Qe,Ge,kt,Yt,Qe,de,ve,null,null,Pr):(ke(_.ec,_.fc,Te,Pe,Tt,Ut,yr,Gt,Ge,kt,Yt,Qe,de,ve-J.A,de,ve,Pr),++B);br+2<wr;br+=2)Tt=Ge,Ut=kt,yr=Yt,Gt=Qe,kt+=b.Rc,Qe+=b.Rc,ve+=2*J.A,ke(Te,(Pe+=2*b.fa)-b.fa,Te,Pe,Tt,Ut,yr,Gt,Ge,kt,Yt,Qe,de,ve-J.A,de,ve,Pr);return Pe+=b.fa,b.j+wr<b.o?(s(_.ec,_.fc,Te,Pe,Pr),s(_.cc,_.dc,Ge,kt,Er),s(_.Mc,_.Nc,Yt,Qe,Er),B--):1&wr||ke(Te,Pe,null,null,Ge,kt,Yt,Qe,Ge,kt,Yt,Qe,de,ve+J.A,null,null,Pr),B}function gn(b,_,B){var J=b.F,de=[b.J];if(J!=null){var ve=b.U,ke=_.ba.S,Te=ke==rm||ke==nm;_=_.ba.f.RGBA;var Pe=[0],Ge=b.ka;Pe[0]=b.T,b.Kb&&(Ge==0?--Pe[0]:(--Ge,de[0]-=b.width),b.j+b.ka+b.T==b.o&&(Pe[0]=b.o-b.j-Ge));var kt=_.eb;Ge=_.fb+Ge*_.A,b=s5(J,de[0],b.width,ve,Pe,kt,Ge+(Te?0:3),_.A),t(B==Pe),b&&ft(ke)&&$0(kt,Ge,Te,ve,Pe,_.A)}return 0}function Oe(b){var _=b.ma,B=_.ba.S,J=11>B,de=B==em||B==tm||B==rm||B==kg||B==12||ft(B);if(_.memory=null,_.Ib=null,_.Jb=null,_.Nd=null,!M0(_.Oa,b,de?11:12))return 0;if(de&&ft(B)&&Ao(),b.da)alert("todo:use_scaling");else{if(J){if(_.Ib=en,b.Kb){if(B=b.U+1>>1,_.memory=i(b.U+2*B),_.memory==null)return 0;_.ec=_.memory,_.fc=0,_.cc=_.ec,_.dc=_.fc+b.U,_.Mc=_.cc,_.Nc=_.dc+B,_.Ib=Xr,Ao()}}else alert("todo:EmitYUV");de&&(_.Jb=gn,J&&Fa())}if(J&&!v5){for(b=0;256>b;++b)U8[b]=89858*(b-128)+am>>sm,z8[b]=-22014*(b-128)+am,W8[b]=-45773*(b-128),$8[b]=113618*(b-128)+am>>sm;for(b=z0;b<Tg;++b)_=76283*(b-16)+am>>sm,q8[b-z0]=Cr(_,255),H8[b-z0]=Cr(_+8>>4,15);v5=1}return 1}function qe(b){var _=b.ma,B=b.U,J=b.T;return t(!(1&b.ka)),0>=B||0>=J?0:(B=_.Ib(b,_),_.Jb!=null&&_.Jb(b,_,B),_.Dc+=B,1)}function Lt(b){b.ma.memory=null}function dt(b,_,B,J){return fe(b,8)!=47?0:(_[0]=fe(b,14)+1,B[0]=fe(b,14)+1,J[0]=fe(b,1),fe(b,3)!=0?0:!b.h)}function He(b,_){if(4>b)return b+1;var B=b-2>>1;return(2+(1&b)<<B)+fe(_,B)+1}function $t(b,_){return 120<_?_-120:1<=(B=((B=N8[_-1])>>4)*b+(8-(15&B)))?B:1;var B}function Ue(b,_,B){var J=I(B),de=b[_+=255&J].g-8;return 0<de&&(te(B,B.u+8),J=I(B),_+=b[_].value,_+=J&(1<<de)-1),te(B,B.u+b[_].g),b[_].value}function er(b,_,B){return B.g+=b.g,B.value+=b.value<<_>>>0,t(8>=B.g),b.g}function Z(b,_,B){var J=b.xc;return t((_=J==0?0:b.vc[b.md*(B>>J)+(_>>J)])<b.Wb),b.Ya[_]}function pe(b,_,B,J){var de=b.ab,ve=b.c*_,ke=b.C;_=ke+_;var Te=B,Pe=J;for(J=b.Ta,B=b.Ua;0<de--;){var Ge=b.gc[de],kt=ke,Yt=_,Qe=Te,Tt=Pe,Ut=(Pe=J,Te=B,Ge.Ea);switch(t(kt<Yt),t(Yt<=Ge.nc),Ge.hc){case 2:Js(Qe,Tt,(Yt-kt)*Ut,Pe,Te);break;case 0:var yr=kt,Gt=Yt,br=Pe,wr=Te,Pr=(an=Ge).Ea;yr==0&&(B0(Qe,Tt,null,null,1,br,wr),Ie(Qe,Tt+1,0,0,Pr-1,br,wr+1),Tt+=Pr,wr+=Pr,++yr);for(var Er=1<<an.b,dn=Er-1,rn=je(Pr,an.b),Fn=an.K,an=an.w+(yr>>an.b)*rn;yr<Gt;){var Gn=Fn,ka=an,Mn=1;for(Hu(Qe,Tt,br,wr-Pr,1,br,wr);Mn<Pr;){var on=(Mn&~dn)+Er;on>Pr&&(on=Pr),(0,O0[Gn[ka++]>>8&15])(Qe,Tt+ +Mn,br,wr+Mn-Pr,on-Mn,br,wr+Mn),Mn=on}Tt+=Pr,wr+=Pr,++yr&dn||(an+=rn)}Yt!=Ge.nc&&s(Pe,Te-Ut,Pe,Te+(Yt-kt-1)*Ut,Ut);break;case 1:for(Ut=Qe,Gt=Tt,Pr=(Qe=Ge.Ea)-(wr=Qe&~(br=(Tt=1<<Ge.b)-1)),yr=je(Qe,Ge.b),Er=Ge.K,Ge=Ge.w+(kt>>Ge.b)*yr;kt<Yt;){for(dn=Er,rn=Ge,Fn=new Re,an=Gt+wr,Gn=Gt+Qe;Gt<an;)be(dn[rn++],Fn),I0(Fn,Ut,Gt,Tt,Pe,Te),Gt+=Tt,Te+=Tt;Gt<Gn&&(be(dn[rn++],Fn),I0(Fn,Ut,Gt,Pr,Pe,Te),Gt+=Pr,Te+=Pr),++kt&br||(Ge+=yr)}break;case 3:if(Qe==Pe&&Tt==Te&&0<Ge.b){for(Gt=Pe,Qe=Ut=Te+(Yt-kt)*Ut-(wr=(Yt-kt)*je(Ge.Ea,Ge.b)),Tt=Pe,br=Te,yr=[],wr=(Pr=wr)-1;0<=wr;--wr)yr[wr]=Tt[br+wr];for(wr=Pr-1;0<=wr;--wr)Gt[Qe+wr]=yr[wr];Yp(Ge,kt,Yt,Pe,Ut,Pe,Te)}else Yp(Ge,kt,Yt,Qe,Tt,Pe,Te)}Te=J,Pe=B}Pe!=B&&s(J,B,Te,Pe,ve)}function ee(b,_){var B=b.V,J=b.Ba+b.c*b.C,de=_-b.C;if(t(_<=b.l.o),t(16>=de),0<de){var ve=b.l,ke=b.Ta,Te=b.Ua,Pe=ve.width;if(pe(b,de,B,J),de=Te=[Te],t((B=b.C)<(J=_)),t(ve.v<ve.va),J>ve.o&&(J=ve.o),B<ve.j){var Ge=ve.j-B;B=ve.j,de[0]+=Ge*Pe}if(B>=J?B=0:(de[0]+=4*ve.v,ve.ka=B-ve.j,ve.U=ve.va-ve.v,ve.T=J-B,B=1),B){if(Te=Te[0],11>(B=b.ca).S){var kt=B.f.RGBA,Yt=(J=B.S,de=ve.U,ve=ve.T,Ge=kt.eb,kt.A),Qe=ve;for(kt=kt.fb+b.Ma*kt.A;0<Qe--;){var Tt=ke,Ut=Te,yr=de,Gt=Ge,br=kt;switch(J){case Zp:D0(Tt,Ut,yr,Gt,br);break;case em:Pc(Tt,Ut,yr,Gt,br);break;case jg:Pc(Tt,Ut,yr,Gt,br),$0(Gt,br,0,yr,1,0);break;case u5:$d(Tt,Ut,yr,Gt,br);break;case tm:mt(Tt,Ut,yr,Gt,br,1);break;case Ng:mt(Tt,Ut,yr,Gt,br,1),$0(Gt,br,0,yr,1,0);break;case rm:mt(Tt,Ut,yr,Gt,br,0);break;case nm:mt(Tt,Ut,yr,Gt,br,0),$0(Gt,br,1,yr,1,0);break;case kg:Oc(Tt,Ut,yr,Gt,br);break;case Ag:Oc(Tt,Ut,yr,Gt,br),n5(Gt,br,yr,1,0);break;case f5:Ic(Tt,Ut,yr,Gt,br);break;default:t(0)}Te+=Pe,kt+=Yt}b.Ma+=ve}else alert("todo:EmitRescaledRowsYUVA");t(b.Ma<=B.height)}}b.C=_,t(b.C<=b.i)}function ue(b){var _;if(0<b.ua)return 0;for(_=0;_<b.Wb;++_){var B=b.Ya[_].G,J=b.Ya[_].H;if(0<B[1][J[1]+0].g||0<B[2][J[2]+0].g||0<B[3][J[3]+0].g)return 0}return 1}function Ae(b,_,B,J,de,ve){if(b.Z!=0){var ke=b.qd,Te=b.rd;for(t($c[b.Z]!=null);_<B;++_)$c[b.Z](ke,Te,J,de,J,de,ve),ke=J,Te=de,de+=ve;b.qd=ke,b.rd=Te}}function Le(b,_){var B=b.l.ma,J=B.Z==0||B.Z==1?b.l.j:b.C;if(J=b.C<J?J:b.C,t(_<=b.l.o),_>J){var de=b.l.width,ve=B.ca,ke=B.tb+de*J,Te=b.V,Pe=b.Ba+b.c*J,Ge=b.gc;t(b.ab==1),t(Ge[0].hc==3),Cl(Ge[0],J,_,Te,Pe,ve,ke),Ae(B,J,_,ve,ke,de)}b.C=b.Ma=_}function ct(b,_,B,J,de,ve,ke){var Te=b.$/J,Pe=b.$%J,Ge=b.m,kt=b.s,Yt=B+b.$,Qe=Yt;de=B+J*de;var Tt=B+J*ve,Ut=280+kt.ua,yr=b.Pb?Te:16777216,Gt=0<kt.ua?kt.Wa:null,br=kt.wc,wr=Yt<Tt?Z(kt,Pe,Te):null;t(b.C<ve),t(Tt<=de);var Pr=!1;e:for(;;){for(;Pr||Yt<Tt;){var Er=0;if(Te>=yr){var dn=Yt-B;t((yr=b).Pb),yr.wd=yr.m,yr.xd=dn,0<yr.s.ua&&Y(yr.s.Wa,yr.s.vb),yr=Te+C8}if(Pe&br||(wr=Z(kt,Pe,Te)),t(wr!=null),wr.Qb&&(_[Yt]=wr.qb,Pr=!0),!Pr)if(Q(Ge),wr.jc){Er=Ge,dn=_;var rn=Yt,Fn=wr.pd[I(Er)&Ud-1];t(wr.jc),256>Fn.g?(te(Er,Er.u+Fn.g),dn[rn]=Fn.value,Er=0):(te(Er,Er.u+Fn.g-256),t(256<=Fn.value),Er=Fn.value),Er==0&&(Pr=!0)}else Er=Ue(wr.G[0],wr.H[0],Ge);if(Ge.h)break;if(Pr||256>Er){if(!Pr)if(wr.nd)_[Yt]=(wr.qb|Er<<8)>>>0;else{if(Q(Ge),Pr=Ue(wr.G[1],wr.H[1],Ge),Q(Ge),dn=Ue(wr.G[2],wr.H[2],Ge),rn=Ue(wr.G[3],wr.H[3],Ge),Ge.h)break;_[Yt]=(rn<<24|Pr<<16|Er<<8|dn)>>>0}if(Pr=!1,++Yt,++Pe>=J&&(Pe=0,++Te,ke!=null&&Te<=ve&&!(Te%16)&&ke(b,Te),Gt!=null))for(;Qe<Yt;)Er=_[Qe++],Gt.X[(506832829*Er&4294967295)>>>Gt.Mb]=Er}else if(280>Er){if(Er=He(Er-256,Ge),dn=Ue(wr.G[4],wr.H[4],Ge),Q(Ge),dn=$t(J,dn=He(dn,Ge)),Ge.h)break;if(Yt-B<dn||de-Yt<Er)break e;for(rn=0;rn<Er;++rn)_[Yt+rn]=_[Yt+rn-dn];for(Yt+=Er,Pe+=Er;Pe>=J;)Pe-=J,++Te,ke!=null&&Te<=ve&&!(Te%16)&&ke(b,Te);if(t(Yt<=de),Pe&br&&(wr=Z(kt,Pe,Te)),Gt!=null)for(;Qe<Yt;)Er=_[Qe++],Gt.X[(506832829*Er&4294967295)>>>Gt.Mb]=Er}else{if(!(Er<Ut))break e;for(Pr=Er-280,t(Gt!=null);Qe<Yt;)Er=_[Qe++],Gt.X[(506832829*Er&4294967295)>>>Gt.Mb]=Er;Er=Yt,t(!(Pr>>>(dn=Gt).Xa)),_[Er]=dn.X[Pr],Pr=!0}Pr||t(Ge.h==M(Ge))}if(b.Pb&&Ge.h&&Yt<de)t(b.m.h),b.a=5,b.m=b.wd,b.$=b.xd,0<b.s.ua&&Y(b.s.vb,b.s.Wa);else{if(Ge.h)break e;ke!=null&&ke(b,Te>ve?ve:Te),b.a=0,b.$=Yt-B}return 1}return b.a=3,0}function ce(b){t(b!=null),b.vc=null,b.yc=null,b.Ya=null;var _=b.Wa;_!=null&&(_.X=null),b.vb=null,t(b!=null)}function xe(){var b=new pn;return b==null?null:(b.a=0,b.xb=m5,It("Predictor","VP8LPredictors"),It("Predictor","VP8LPredictors_C"),It("PredictorAdd","VP8LPredictorsAdd"),It("PredictorAdd","VP8LPredictorsAdd_C"),Js=ot,I0=we,D0=Wt,Pc=Ct,Oc=pr,Ic=fr,$d=Be,T.VP8LMapColor32b=Al,T.VP8LMapColor8b=P0,b)}function se(b,_,B,J,de){var ve=1,ke=[b],Te=[_],Pe=J.m,Ge=J.s,kt=null,Yt=0;e:for(;;){if(B)for(;ve&&fe(Pe,1);){var Qe=ke,Tt=Te,Ut=J,yr=1,Gt=Ut.m,br=Ut.gc[Ut.ab],wr=fe(Gt,2);if(Ut.Oc&1<<wr)ve=0;else{switch(Ut.Oc|=1<<wr,br.hc=wr,br.Ea=Qe[0],br.nc=Tt[0],br.K=[null],++Ut.ab,t(4>=Ut.ab),wr){case 0:case 1:br.b=fe(Gt,3)+2,yr=se(je(br.Ea,br.b),je(br.nc,br.b),0,Ut,br.K),br.K=br.K[0];break;case 3:var Pr,Er=fe(Gt,8)+1,dn=16<Er?0:4<Er?1:2<Er?2:3;if(Qe[0]=je(br.Ea,dn),br.b=dn,Pr=yr=se(Er,1,0,Ut,br.K)){var rn,Fn=Er,an=br,Gn=1<<(8>>an.b),ka=i(Gn);if(ka==null)Pr=0;else{var Mn=an.K[0],on=an.w;for(ka[0]=an.K[0][0],rn=1;rn<1*Fn;++rn)ka[rn]=We(Mn[on+rn],ka[rn-1]);for(;rn<4*Gn;++rn)ka[rn]=0;an.K[0]=null,an.K[0]=ka,Pr=1}}yr=Pr;break;case 2:break;default:t(0)}ve=yr}}if(ke=ke[0],Te=Te[0],ve&&fe(Pe,1)&&!(ve=1<=(Yt=fe(Pe,4))&&11>=Yt)){J.a=3;break e}var Qr;if(Qr=ve)t:{var ea,Cn,Qn,Ss=J,Wa=ke,_i=Te,Ws=Yt,ri=B,ki=Ss.m,ja=Ss.s,Xn=[null],as=1,zs=0,is=A8[Ws];r:for(;;){if(ri&&fe(ki,1)){var za=fe(ki,3)+2,tl=je(Wa,za),ta=je(_i,za),Bi=tl*ta;if(!se(tl,ta,0,Ss,Xn))break r;for(Xn=Xn[0],ja.xc=za,ea=0;ea<Bi;++ea){var xs=Xn[ea]>>8&65535;Xn[ea]=xs,xs>=as&&(as=xs+1)}}if(ki.h)break r;for(Cn=0;5>Cn;++Cn){var Na=h5[Cn];!Cn&&0<Ws&&(Na+=1<<Ws),zs<Na&&(zs=Na)}var so=o(as*is,P),ji=as,ao=o(ji,re);if(ao==null)var io=null;else t(65536>=ji),io=ao;var Pi=i(zs);if(io==null||Pi==null||so==null){Ss.a=1;break r}var oo=so;for(ea=Qn=0;ea<as;++ea){var bs=io[ea],lo=bs.G,rl=bs.H,zd=0,rc=1,qa=0;for(Cn=0;5>Cn;++Cn){Na=h5[Cn],lo[Cn]=oo,rl[Cn]=Qn,!Cn&&0<Ws&&(Na+=1<<Ws);s:{var om,Lg=Na,lm=Ss,q0=Pi,Q8=oo,X8=Qn,Fg=0,Wc=lm.m,Y8=fe(Wc,1);if(a(q0,0,0,Lg),Y8){var K8=fe(Wc,1)+1,J8=fe(Wc,1),_5=fe(Wc,J8==0?1:8);q0[_5]=1,K8==2&&(q0[_5=fe(Wc,8)]=1);var cm=1}else{var k5=i(19),j5=fe(Wc,4)+4;if(19<j5){lm.a=3;var dm=0;break s}for(om=0;om<j5;++om)k5[j8[om]]=fe(Wc,3);var Mg=void 0,H0=void 0,N5=lm,Z8=k5,um=Lg,A5=q0,Rg=0,zc=N5.m,C5=8,E5=o(128,P);n:for(;N(E5,0,7,Z8,19);){if(fe(zc,1)){var eT=2+2*fe(zc,3);if((Mg=2+fe(zc,eT))>um)break n}else Mg=um;for(H0=0;H0<um&&Mg--;){Q(zc);var T5=E5[0+(127&I(zc))];te(zc,zc.u+T5.g);var Gu=T5.value;if(16>Gu)A5[H0++]=Gu,Gu!=0&&(C5=Gu);else{var tT=Gu==16,L5=Gu-16,rT=_8[L5],F5=fe(zc,S8[L5])+rT;if(H0+F5>um)break n;for(var nT=tT?C5:0;0<F5--;)A5[H0++]=nT}}Rg=1;break n}Rg||(N5.a=3),cm=Rg}(cm=cm&&!Wc.h)&&(Fg=N(Q8,X8,8,q0,Lg)),cm&&Fg!=0?dm=Fg:(lm.a=3,dm=0)}if(dm==0)break r;if(rc&&k8[Cn]==1&&(rc=oo[Qn].g==0),zd+=oo[Qn].g,Qn+=dm,3>=Cn){var V0,Bg=Pi[0];for(V0=1;V0<Na;++V0)Pi[V0]>Bg&&(Bg=Pi[V0]);qa+=Bg}}if(bs.nd=rc,bs.Qb=0,rc&&(bs.qb=(lo[3][rl[3]+0].value<<24|lo[1][rl[1]+0].value<<16|lo[2][rl[2]+0].value)>>>0,zd==0&&256>lo[0][rl[0]+0].value&&(bs.Qb=1,bs.qb+=lo[0][rl[0]+0].value<<8)),bs.jc=!bs.Qb&&6>qa,bs.jc){var fm,nc=bs;for(fm=0;fm<Ud;++fm){var qc=fm,Hc=nc.pd[qc],hm=nc.G[0][nc.H[0]+qc];256<=hm.value?(Hc.g=hm.g+256,Hc.value=hm.value):(Hc.g=0,Hc.value=0,qc>>=er(hm,8,Hc),qc>>=er(nc.G[1][nc.H[1]+qc],16,Hc),qc>>=er(nc.G[2][nc.H[2]+qc],0,Hc),er(nc.G[3][nc.H[3]+qc],24,Hc))}}}ja.vc=Xn,ja.Wb=as,ja.Ya=io,ja.yc=so,Qr=1;break t}Qr=0}if(!(ve=Qr)){J.a=3;break e}if(0<Yt){if(Ge.ua=1<<Yt,!D(Ge.Wa,Yt)){J.a=1,ve=0;break e}}else Ge.ua=0;var Pg=J,M5=ke,sT=Te,Og=Pg.s,Ig=Og.xc;if(Pg.c=M5,Pg.i=sT,Og.md=je(M5,Ig),Og.wc=Ig==0?-1:(1<<Ig)-1,B){J.xb=B8;break e}if((kt=i(ke*Te))==null){J.a=1,ve=0;break e}ve=(ve=ct(J,kt,0,ke,Te,Te,null))&&!Pe.h;break e}return ve?(de!=null?de[0]=kt:(t(kt==null),t(B)),J.$=0,B||ce(Ge)):ce(Ge),ve}function Se(b,_){var B=b.c*b.i,J=B+_+16*_;return t(b.c<=_),b.V=i(J),b.V==null?(b.Ta=null,b.Ua=0,b.a=1,0):(b.Ta=b.V,b.Ua=b.Ba+B+_,1)}function Ze(b,_){var B=b.C,J=_-B,de=b.V,ve=b.Ba+b.c*B;for(t(_<=b.l.o);0<J;){var ke=16<J?16:J,Te=b.l.ma,Pe=b.l.width,Ge=Pe*ke,kt=Te.ca,Yt=Te.tb+Pe*B,Qe=b.Ta,Tt=b.Ua;pe(b,ke,de,ve),a5(Qe,Tt,kt,Yt,Ge),Ae(Te,B,B+ke,kt,Yt,Pe),J-=ke,de+=ke*b.c,B+=ke}t(B==_),b.C=b.Ma=_}function et(){this.ub=this.yd=this.td=this.Rb=0}function Et(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function wt(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function gt(){this.Yb=function(){var b=[];return function _(B,J,de){for(var ve=de[J],ke=0;ke<ve&&(B.push(de.length>J+1?[]:0),!(de.length<J+1));ke++)_(B[ke],J+1,de)}(b,0,[3,11]),b}()}function zt(){this.jb=i(3),this.Wc=l([4,8],gt),this.Xc=l([4,17],gt)}function Dt(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function mr(){this.ld=this.La=this.dd=this.tc=0}function pt(){this.Na=this.la=0}function Xt(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Rt(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function _t(){this.uc=this.M=this.Nb=0,this.wa=Array(new mr),this.Y=0,this.ya=Array(new Rt),this.aa=0,this.l=new Rr}function jr(){this.y=i(16),this.f=i(8),this.ea=i(8)}function Gr(){this.cb=this.a=0,this.sc="",this.m=new E,this.Od=new et,this.Kc=new Et,this.ed=new Dt,this.Qa=new wt,this.Ic=this.$c=this.Aa=0,this.D=new _t,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,E),this.ia=0,this.pb=o(4,Xt),this.Pa=new zt,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new jr),this.Hd=0,this.rb=Array(new pt),this.sb=0,this.wa=Array(new mr),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Rt),this.L=this.aa=0,this.gd=l([4,2],mr),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Cr(b,_){return 0>b?0:b>_?_:b}function Rr(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function De(){var b=new Gr;return b!=null&&(b.a=0,b.sc="OK",b.cb=0,b.Xb=0,W0||(W0=tr)),b}function Ke(b,_,B){return b.a==0&&(b.a=_,b.sc=B,b.cb=0),0}function Ce(b,_,B){return 3<=B&&b[_+0]==157&&b[_+1]==1&&b[_+2]==42}function it(b,_){if(b==null)return 0;if(b.a=0,b.sc="OK",_==null)return Ke(b,2,"null VP8Io passed to VP8GetHeaders()");var B=_.data,J=_.w,de=_.ha;if(4>de)return Ke(b,7,"Truncated header.");var ve=B[J+0]|B[J+1]<<8|B[J+2]<<16,ke=b.Od;if(ke.Rb=!(1&ve),ke.td=ve>>1&7,ke.yd=ve>>4&1,ke.ub=ve>>5,3<ke.td)return Ke(b,3,"Incorrect keyframe parameters.");if(!ke.yd)return Ke(b,4,"Frame not displayable.");J+=3,de-=3;var Te=b.Kc;if(ke.Rb){if(7>de)return Ke(b,7,"cannot parse picture header");if(!Ce(B,J,de))return Ke(b,3,"Bad code word");Te.c=16383&(B[J+4]<<8|B[J+3]),Te.Td=B[J+4]>>6,Te.i=16383&(B[J+6]<<8|B[J+5]),Te.Ud=B[J+6]>>6,J+=7,de-=7,b.za=Te.c+15>>4,b.Ub=Te.i+15>>4,_.width=Te.c,_.height=Te.i,_.Da=0,_.j=0,_.v=0,_.va=_.width,_.o=_.height,_.da=0,_.ib=_.width,_.hb=_.height,_.U=_.width,_.T=_.height,a((ve=b.Pa).jb,0,255,ve.jb.length),t((ve=b.Qa)!=null),ve.Cb=0,ve.Bb=0,ve.Fb=1,a(ve.Zb,0,0,ve.Zb.length),a(ve.Lb,0,0,ve.Lb)}if(ke.ub>de)return Ke(b,7,"bad partition length");ge(ve=b.m,B,J,ke.ub),J+=ke.ub,de-=ke.ub,ke.Rb&&(Te.Ld=ne(ve),Te.Kd=ne(ve)),Te=b.Qa;var Pe,Ge=b.Pa;if(t(ve!=null),t(Te!=null),Te.Cb=ne(ve),Te.Cb){if(Te.Bb=ne(ve),ne(ve)){for(Te.Fb=ne(ve),Pe=0;4>Pe;++Pe)Te.Zb[Pe]=ne(ve)?R(ve,7):0;for(Pe=0;4>Pe;++Pe)Te.Lb[Pe]=ne(ve)?R(ve,6):0}if(Te.Bb)for(Pe=0;3>Pe;++Pe)Ge.jb[Pe]=ne(ve)?Fe(ve,8):255}else Te.Bb=0;if(ve.Ka)return Ke(b,3,"cannot parse segment header");if((Te=b.ed).zd=ne(ve),Te.Tb=Fe(ve,6),Te.wb=Fe(ve,3),Te.Pc=ne(ve),Te.Pc&&ne(ve)){for(Ge=0;4>Ge;++Ge)ne(ve)&&(Te.vd[Ge]=R(ve,6));for(Ge=0;4>Ge;++Ge)ne(ve)&&(Te.od[Ge]=R(ve,6))}if(b.L=Te.Tb==0?0:Te.zd?1:2,ve.Ka)return Ke(b,3,"cannot parse filter header");var kt=de;if(de=Pe=J,J=Pe+kt,Te=kt,b.Xb=(1<<Fe(b.m,2))-1,kt<3*(Ge=b.Xb))B=7;else{for(Pe+=3*Ge,Te-=3*Ge,kt=0;kt<Ge;++kt){var Yt=B[de+0]|B[de+1]<<8|B[de+2]<<16;Yt>Te&&(Yt=Te),ge(b.Jc[+kt],B,Pe,Yt),Pe+=Yt,Te-=Yt,de+=3}ge(b.Jc[+Ge],B,Pe,Te),B=Pe<J?0:5}if(B!=0)return Ke(b,B,"cannot parse partitions");for(B=Fe(Pe=b.m,7),de=ne(Pe)?R(Pe,4):0,J=ne(Pe)?R(Pe,4):0,Te=ne(Pe)?R(Pe,4):0,Ge=ne(Pe)?R(Pe,4):0,Pe=ne(Pe)?R(Pe,4):0,kt=b.Qa,Yt=0;4>Yt;++Yt){if(kt.Cb){var Qe=kt.Zb[Yt];kt.Fb||(Qe+=B)}else{if(0<Yt){b.pb[Yt]=b.pb[0];continue}Qe=B}var Tt=b.pb[Yt];Tt.Sc[0]=Cg[Cr(Qe+de,127)],Tt.Sc[1]=Eg[Cr(Qe+0,127)],Tt.Eb[0]=2*Cg[Cr(Qe+J,127)],Tt.Eb[1]=101581*Eg[Cr(Qe+Te,127)]>>16,8>Tt.Eb[1]&&(Tt.Eb[1]=8),Tt.Qc[0]=Cg[Cr(Qe+Ge,117)],Tt.Qc[1]=Eg[Cr(Qe+Pe,127)],Tt.lc=Qe+Pe}if(!ke.Rb)return Ke(b,4,"Not a key frame.");for(ne(ve),ke=b.Pa,B=0;4>B;++B){for(de=0;8>de;++de)for(J=0;3>J;++J)for(Te=0;11>Te;++Te)Ge=z(ve,M8[B][de][J][Te])?Fe(ve,8):L8[B][de][J][Te],ke.Wc[B][de].Yb[J][Te]=Ge;for(de=0;17>de;++de)ke.Xc[B][de]=ke.Wc[B][R8[de]]}return b.kc=ne(ve),b.kc&&(b.Bd=Fe(ve,8)),b.cb=1}function tr(b,_,B,J,de,ve,ke){var Te=_[de].Yb[B];for(B=0;16>de;++de){if(!z(b,Te[B+0]))return de;for(;!z(b,Te[B+1]);)if(Te=_[++de].Yb[0],B=0,de==16)return 16;var Pe=_[de+1].Yb;if(z(b,Te[B+2])){var Ge=b,kt=0;if(z(Ge,(Qe=Te)[(Yt=B)+3]))if(z(Ge,Qe[Yt+6])){for(Te=0,Yt=2*(kt=z(Ge,Qe[Yt+8]))+(Qe=z(Ge,Qe[Yt+9+kt])),kt=0,Qe=E8[Yt];Qe[Te];++Te)kt+=kt+z(Ge,Qe[Te]);kt+=3+(8<<Yt)}else z(Ge,Qe[Yt+7])?(kt=7+2*z(Ge,165),kt+=z(Ge,145)):kt=5+z(Ge,159);else kt=z(Ge,Qe[Yt+4])?3+z(Ge,Qe[Yt+5]):2;Te=Pe[2]}else kt=1,Te=Pe[1];Pe=ke+T8[de],0>(Ge=b).b&&G(Ge);var Yt,Qe=Ge.b,Tt=(Yt=Ge.Ca>>1)-(Ge.I>>Qe)>>31;--Ge.b,Ge.Ca+=Tt,Ge.Ca|=1,Ge.I-=(Yt+1&Tt)<<Qe,ve[Pe]=((kt^Tt)-Tt)*J[(0<de)+0]}return 16}function Kt(b){var _=b.rb[b.sb-1];_.la=0,_.Na=0,a(b.zc,0,0,b.zc.length),b.ja=0}function yt(b,_,B,J,de){de=b[_+B+32*J]+(de>>3),b[_+B+32*J]=-256&de?0>de?0:255:de}function Ht(b,_,B,J,de,ve){yt(b,_,0,B,J+de),yt(b,_,1,B,J+ve),yt(b,_,2,B,J-ve),yt(b,_,3,B,J-de)}function qt(b){return(20091*b>>16)+b}function lr(b,_,B,J){var de,ve=0,ke=i(16);for(de=0;4>de;++de){var Te=b[_+0]+b[_+8],Pe=b[_+0]-b[_+8],Ge=(35468*b[_+4]>>16)-qt(b[_+12]),kt=qt(b[_+4])+(35468*b[_+12]>>16);ke[ve+0]=Te+kt,ke[ve+1]=Pe+Ge,ke[ve+2]=Pe-Ge,ke[ve+3]=Te-kt,ve+=4,_++}for(de=ve=0;4>de;++de)Te=(b=ke[ve+0]+4)+ke[ve+8],Pe=b-ke[ve+8],Ge=(35468*ke[ve+4]>>16)-qt(ke[ve+12]),yt(B,J,0,0,Te+(kt=qt(ke[ve+4])+(35468*ke[ve+12]>>16))),yt(B,J,1,0,Pe+Ge),yt(B,J,2,0,Pe-Ge),yt(B,J,3,0,Te-kt),ve++,J+=32}function Mt(b,_,B,J){var de=b[_+0]+4,ve=35468*b[_+4]>>16,ke=qt(b[_+4]),Te=35468*b[_+1]>>16;Ht(B,J,0,de+ke,b=qt(b[_+1]),Te),Ht(B,J,1,de+ve,b,Te),Ht(B,J,2,de-ve,b,Te),Ht(B,J,3,de-ke,b,Te)}function tt(b,_,B,J,de){lr(b,_,B,J),de&&lr(b,_+16,B,J+4)}function Ft(b,_,B,J){Wd(b,_+0,B,J,1),Wd(b,_+32,B,J+128,1)}function Qt(b,_,B,J){var de;for(b=b[_+0]+4,de=0;4>de;++de)for(_=0;4>_;++_)yt(B,J,_,de,b)}function At(b,_,B,J){b[_+0]&&ns(b,_+0,B,J),b[_+16]&&ns(b,_+16,B,J+4),b[_+32]&&ns(b,_+32,B,J+128),b[_+48]&&ns(b,_+48,B,J+128+4)}function bt(b,_,B,J){var de,ve=i(16);for(de=0;4>de;++de){var ke=b[_+0+de]+b[_+12+de],Te=b[_+4+de]+b[_+8+de],Pe=b[_+4+de]-b[_+8+de],Ge=b[_+0+de]-b[_+12+de];ve[0+de]=ke+Te,ve[8+de]=ke-Te,ve[4+de]=Ge+Pe,ve[12+de]=Ge-Pe}for(de=0;4>de;++de)ke=(b=ve[0+4*de]+3)+ve[3+4*de],Te=ve[1+4*de]+ve[2+4*de],Pe=ve[1+4*de]-ve[2+4*de],Ge=b-ve[3+4*de],B[J+0]=ke+Te>>3,B[J+16]=Ge+Pe>>3,B[J+32]=ke-Te>>3,B[J+48]=Ge-Pe>>3,J+=64}function V(b,_,B){var J,de=_-32,ve=no,ke=255-b[de-1];for(J=0;J<B;++J){var Te,Pe=ve,Ge=ke+b[_-1];for(Te=0;Te<B;++Te)b[_+Te]=Pe[Ge+b[de+Te]];_+=32}}function ie(b,_){V(b,_,4)}function _e(b,_){V(b,_,8)}function Je(b,_){V(b,_,16)}function Nt(b,_){var B;for(B=0;16>B;++B)s(b,_+32*B,b,_-32,16)}function Bt(b,_){var B;for(B=16;0<B;--B)a(b,_,b[_-1],16),_+=32}function jt(b,_,B){var J;for(J=0;16>J;++J)a(_,B+32*J,b,16)}function cr(b,_){var B,J=16;for(B=0;16>B;++B)J+=b[_-1+32*B]+b[_+B-32];jt(J>>5,b,_)}function sr(b,_){var B,J=8;for(B=0;16>B;++B)J+=b[_-1+32*B];jt(J>>4,b,_)}function Fr(b,_){var B,J=8;for(B=0;16>B;++B)J+=b[_+B-32];jt(J>>4,b,_)}function Nr(b,_){jt(128,b,_)}function Pt(b,_,B){return b+2*_+B+2>>2}function Ot(b,_){var B,J=_-32;for(J=new Uint8Array([Pt(b[J-1],b[J+0],b[J+1]),Pt(b[J+0],b[J+1],b[J+2]),Pt(b[J+1],b[J+2],b[J+3]),Pt(b[J+2],b[J+3],b[J+4])]),B=0;4>B;++B)s(b,_+32*B,J,0,J.length)}function Tr(b,_){var B=b[_-1],J=b[_-1+32],de=b[_-1+64],ve=b[_-1+96];he(b,_+0,16843009*Pt(b[_-1-32],B,J)),he(b,_+32,16843009*Pt(B,J,de)),he(b,_+64,16843009*Pt(J,de,ve)),he(b,_+96,16843009*Pt(de,ve,ve))}function vr(b,_){var B,J=4;for(B=0;4>B;++B)J+=b[_+B-32]+b[_-1+32*B];for(J>>=3,B=0;4>B;++B)a(b,_+32*B,J,4)}function ye(b,_){var B=b[_-1+0],J=b[_-1+32],de=b[_-1+64],ve=b[_-1-32],ke=b[_+0-32],Te=b[_+1-32],Pe=b[_+2-32],Ge=b[_+3-32];b[_+0+96]=Pt(J,de,b[_-1+96]),b[_+1+96]=b[_+0+64]=Pt(B,J,de),b[_+2+96]=b[_+1+64]=b[_+0+32]=Pt(ve,B,J),b[_+3+96]=b[_+2+64]=b[_+1+32]=b[_+0+0]=Pt(ke,ve,B),b[_+3+64]=b[_+2+32]=b[_+1+0]=Pt(Te,ke,ve),b[_+3+32]=b[_+2+0]=Pt(Pe,Te,ke),b[_+3+0]=Pt(Ge,Pe,Te)}function lt(b,_){var B=b[_+1-32],J=b[_+2-32],de=b[_+3-32],ve=b[_+4-32],ke=b[_+5-32],Te=b[_+6-32],Pe=b[_+7-32];b[_+0+0]=Pt(b[_+0-32],B,J),b[_+1+0]=b[_+0+32]=Pt(B,J,de),b[_+2+0]=b[_+1+32]=b[_+0+64]=Pt(J,de,ve),b[_+3+0]=b[_+2+32]=b[_+1+64]=b[_+0+96]=Pt(de,ve,ke),b[_+3+32]=b[_+2+64]=b[_+1+96]=Pt(ve,ke,Te),b[_+3+64]=b[_+2+96]=Pt(ke,Te,Pe),b[_+3+96]=Pt(Te,Pe,Pe)}function ht(b,_){var B=b[_-1+0],J=b[_-1+32],de=b[_-1+64],ve=b[_-1-32],ke=b[_+0-32],Te=b[_+1-32],Pe=b[_+2-32],Ge=b[_+3-32];b[_+0+0]=b[_+1+64]=ve+ke+1>>1,b[_+1+0]=b[_+2+64]=ke+Te+1>>1,b[_+2+0]=b[_+3+64]=Te+Pe+1>>1,b[_+3+0]=Pe+Ge+1>>1,b[_+0+96]=Pt(de,J,B),b[_+0+64]=Pt(J,B,ve),b[_+0+32]=b[_+1+96]=Pt(B,ve,ke),b[_+1+32]=b[_+2+96]=Pt(ve,ke,Te),b[_+2+32]=b[_+3+96]=Pt(ke,Te,Pe),b[_+3+32]=Pt(Te,Pe,Ge)}function Vt(b,_){var B=b[_+0-32],J=b[_+1-32],de=b[_+2-32],ve=b[_+3-32],ke=b[_+4-32],Te=b[_+5-32],Pe=b[_+6-32],Ge=b[_+7-32];b[_+0+0]=B+J+1>>1,b[_+1+0]=b[_+0+64]=J+de+1>>1,b[_+2+0]=b[_+1+64]=de+ve+1>>1,b[_+3+0]=b[_+2+64]=ve+ke+1>>1,b[_+0+32]=Pt(B,J,de),b[_+1+32]=b[_+0+96]=Pt(J,de,ve),b[_+2+32]=b[_+1+96]=Pt(de,ve,ke),b[_+3+32]=b[_+2+96]=Pt(ve,ke,Te),b[_+3+64]=Pt(ke,Te,Pe),b[_+3+96]=Pt(Te,Pe,Ge)}function Wr(b,_){var B=b[_-1+0],J=b[_-1+32],de=b[_-1+64],ve=b[_-1+96];b[_+0+0]=B+J+1>>1,b[_+2+0]=b[_+0+32]=J+de+1>>1,b[_+2+32]=b[_+0+64]=de+ve+1>>1,b[_+1+0]=Pt(B,J,de),b[_+3+0]=b[_+1+32]=Pt(J,de,ve),b[_+3+32]=b[_+1+64]=Pt(de,ve,ve),b[_+3+64]=b[_+2+64]=b[_+0+96]=b[_+1+96]=b[_+2+96]=b[_+3+96]=ve}function Yr(b,_){var B=b[_-1+0],J=b[_-1+32],de=b[_-1+64],ve=b[_-1+96],ke=b[_-1-32],Te=b[_+0-32],Pe=b[_+1-32],Ge=b[_+2-32];b[_+0+0]=b[_+2+32]=B+ke+1>>1,b[_+0+32]=b[_+2+64]=J+B+1>>1,b[_+0+64]=b[_+2+96]=de+J+1>>1,b[_+0+96]=ve+de+1>>1,b[_+3+0]=Pt(Te,Pe,Ge),b[_+2+0]=Pt(ke,Te,Pe),b[_+1+0]=b[_+3+32]=Pt(B,ke,Te),b[_+1+32]=b[_+3+64]=Pt(J,B,ke),b[_+1+64]=b[_+3+96]=Pt(de,J,B),b[_+1+96]=Pt(ve,de,J)}function fn(b,_){var B;for(B=0;8>B;++B)s(b,_+32*B,b,_-32,8)}function In(b,_){var B;for(B=0;8>B;++B)a(b,_,b[_-1],8),_+=32}function Ye(b,_,B){var J;for(J=0;8>J;++J)a(_,B+32*J,b,8)}function st(b,_){var B,J=8;for(B=0;8>B;++B)J+=b[_+B-32]+b[_-1+32*B];Ye(J>>4,b,_)}function at(b,_){var B,J=4;for(B=0;8>B;++B)J+=b[_+B-32];Ye(J>>3,b,_)}function nt(b,_){var B,J=4;for(B=0;8>B;++B)J+=b[_-1+32*B];Ye(J>>3,b,_)}function xt(b,_){Ye(128,b,_)}function rr(b,_,B){var J=b[_-B],de=b[_+0],ve=3*(de-J)+_g[1020+b[_-2*B]-b[_+B]],ke=Jp[112+(ve+4>>3)];b[_-B]=no[255+J+Jp[112+(ve+3>>3)]],b[_+0]=no[255+de-ke]}function vt(b,_,B,J){var de=b[_+0],ve=b[_+B];return To[255+b[_-2*B]-b[_-B]]>J||To[255+ve-de]>J}function dr(b,_,B,J){return 4*To[255+b[_-B]-b[_+0]]+To[255+b[_-2*B]-b[_+B]]<=J}function ir(b,_,B,J,de){var ve=b[_-3*B],ke=b[_-2*B],Te=b[_-B],Pe=b[_+0],Ge=b[_+B],kt=b[_+2*B],Yt=b[_+3*B];return 4*To[255+Te-Pe]+To[255+ke-Ge]>J?0:To[255+b[_-4*B]-ve]<=de&&To[255+ve-ke]<=de&&To[255+ke-Te]<=de&&To[255+Yt-kt]<=de&&To[255+kt-Ge]<=de&&To[255+Ge-Pe]<=de}function Br(b,_,B,J){var de=2*J+1;for(J=0;16>J;++J)dr(b,_+J,B,de)&&rr(b,_+J,B)}function kr(b,_,B,J){var de=2*J+1;for(J=0;16>J;++J)dr(b,_+J*B,1,de)&&rr(b,_+J*B,1)}function Ur(b,_,B,J){var de;for(de=3;0<de;--de)Br(b,_+=4*B,B,J)}function zr(b,_,B,J){var de;for(de=3;0<de;--de)kr(b,_+=4,B,J)}function Or(b,_,B,J,de,ve,ke,Te){for(ve=2*ve+1;0<de--;){if(ir(b,_,B,ve,ke))if(vt(b,_,B,Te))rr(b,_,B);else{var Pe=b,Ge=_,kt=B,Yt=Pe[Ge-2*kt],Qe=Pe[Ge-kt],Tt=Pe[Ge+0],Ut=Pe[Ge+kt],yr=Pe[Ge+2*kt],Gt=27*(wr=_g[1020+3*(Tt-Qe)+_g[1020+Yt-Ut]])+63>>7,br=18*wr+63>>7,wr=9*wr+63>>7;Pe[Ge-3*kt]=no[255+Pe[Ge-3*kt]+wr],Pe[Ge-2*kt]=no[255+Yt+br],Pe[Ge-kt]=no[255+Qe+Gt],Pe[Ge+0]=no[255+Tt-Gt],Pe[Ge+kt]=no[255+Ut-br],Pe[Ge+2*kt]=no[255+yr-wr]}_+=J}}function Lr(b,_,B,J,de,ve,ke,Te){for(ve=2*ve+1;0<de--;){if(ir(b,_,B,ve,ke))if(vt(b,_,B,Te))rr(b,_,B);else{var Pe=b,Ge=_,kt=B,Yt=Pe[Ge-kt],Qe=Pe[Ge+0],Tt=Pe[Ge+kt],Ut=Jp[112+(4+(yr=3*(Qe-Yt))>>3)],yr=Jp[112+(yr+3>>3)],Gt=Ut+1>>1;Pe[Ge-2*kt]=no[255+Pe[Ge-2*kt]+Gt],Pe[Ge-kt]=no[255+Yt+yr],Pe[Ge+0]=no[255+Qe-Ut],Pe[Ge+kt]=no[255+Tt-Gt]}_+=J}}function cn(b,_,B,J,de,ve){Or(b,_,B,1,16,J,de,ve)}function nr(b,_,B,J,de,ve){Or(b,_,1,B,16,J,de,ve)}function ar(b,_,B,J,de,ve){var ke;for(ke=3;0<ke;--ke)Lr(b,_+=4*B,B,1,16,J,de,ve)}function j(b,_,B,J,de,ve){var ke;for(ke=3;0<ke;--ke)Lr(b,_+=4,1,B,16,J,de,ve)}function ae(b,_,B,J,de,ve,ke,Te){Or(b,_,de,1,8,ve,ke,Te),Or(B,J,de,1,8,ve,ke,Te)}function Ne(b,_,B,J,de,ve,ke,Te){Or(b,_,1,de,8,ve,ke,Te),Or(B,J,1,de,8,ve,ke,Te)}function Xe(b,_,B,J,de,ve,ke,Te){Lr(b,_+4*de,de,1,8,ve,ke,Te),Lr(B,J+4*de,de,1,8,ve,ke,Te)}function ut(b,_,B,J,de,ve,ke,Te){Lr(b,_+4,1,de,8,ve,ke,Te),Lr(B,J+4,1,de,8,ve,ke,Te)}function Jt(){this.ba=new $r,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Vr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function ur(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Kr(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Zr(){this.ua=0,this.Wa=new le,this.vb=new le,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new re,this.yc=new P}function pn(){this.xb=this.a=0,this.l=new Rr,this.ca=new $r,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new U,this.Pb=0,this.wd=new U,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Zr,this.ab=0,this.gc=o(4,Kr),this.Oc=0}function wn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Rr,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function _n(b,_,B,J,de,ve,ke){for(b=b==null?0:b[_+0],_=0;_<ke;++_)de[ve+_]=b+B[J+_]&255,b=de[ve+_]}function xn(b,_,B,J,de,ve,ke){var Te;if(b==null)_n(null,null,B,J,de,ve,ke);else for(Te=0;Te<ke;++Te)de[ve+Te]=b[_+Te]+B[J+Te]&255}function An(b,_,B,J,de,ve,ke){if(b==null)_n(null,null,B,J,de,ve,ke);else{var Te,Pe=b[_+0],Ge=Pe,kt=Pe;for(Te=0;Te<ke;++Te)Ge=kt+(Pe=b[_+Te])-Ge,kt=B[J+Te]+(-256&Ge?0>Ge?0:255:Ge)&255,Ge=Pe,de[ve+Te]=kt}}function Dn(b,_,B,J){var de=_.width,ve=_.o;if(t(b!=null&&_!=null),0>B||0>=J||B+J>ve)return null;if(!b.Cc){if(b.ga==null){var ke;if(b.ga=new wn,(ke=b.ga==null)||(ke=_.width*_.o,t(b.Gb.length==0),b.Gb=i(ke),b.Uc=0,b.Gb==null?ke=0:(b.mb=b.Gb,b.nb=b.Uc,b.rc=null,ke=1),ke=!ke),!ke){ke=b.ga;var Te=b.Fa,Pe=b.P,Ge=b.qc,kt=b.mb,Yt=b.nb,Qe=Pe+1,Tt=Ge-1,Ut=ke.l;if(t(Te!=null&&kt!=null&&_!=null),$c[0]=null,$c[1]=_n,$c[2]=xn,$c[3]=An,ke.ca=kt,ke.tb=Yt,ke.c=_.width,ke.i=_.height,t(0<ke.c&&0<ke.i),1>=Ge)_=0;else if(ke.$a=3&Te[Pe+0],ke.Z=Te[Pe+0]>>2&3,ke.Lc=Te[Pe+0]>>4&3,Pe=Te[Pe+0]>>6&3,0>ke.$a||1<ke.$a||4<=ke.Z||1<ke.Lc||Pe)_=0;else if(Ut.put=qe,Ut.ac=Oe,Ut.bc=Lt,Ut.ma=ke,Ut.width=_.width,Ut.height=_.height,Ut.Da=_.Da,Ut.v=_.v,Ut.va=_.va,Ut.j=_.j,Ut.o=_.o,ke.$a)e:{t(ke.$a==1),_=xe();t:for(;;){if(_==null){_=0;break e}if(t(ke!=null),ke.mc=_,_.c=ke.c,_.i=ke.i,_.l=ke.l,_.l.ma=ke,_.l.width=ke.c,_.l.height=ke.i,_.a=0,q(_.m,Te,Qe,Tt),!se(ke.c,ke.i,1,_,null)||(_.ab==1&&_.gc[0].hc==3&&ue(_.s)?(ke.ic=1,Te=_.c*_.i,_.Ta=null,_.Ua=0,_.V=i(Te),_.Ba=0,_.V==null?(_.a=1,_=0):_=1):(ke.ic=0,_=Se(_,ke.c)),!_))break t;_=1;break e}ke.mc=null,_=0}else _=Tt>=ke.c*ke.i;ke=!_}if(ke)return null;b.ga.Lc!=1?b.Ga=0:J=ve-B}t(b.ga!=null),t(B+J<=ve);e:{if(_=(Te=b.ga).c,ve=Te.l.o,Te.$a==0){if(Qe=b.rc,Tt=b.Vc,Ut=b.Fa,Pe=b.P+1+B*_,Ge=b.mb,kt=b.nb+B*_,t(Pe<=b.P+b.qc),Te.Z!=0)for(t($c[Te.Z]!=null),ke=0;ke<J;++ke)$c[Te.Z](Qe,Tt,Ut,Pe,Ge,kt,_),Qe=Ge,Tt=kt,kt+=_,Pe+=_;else for(ke=0;ke<J;++ke)s(Ge,kt,Ut,Pe,_),Qe=Ge,Tt=kt,kt+=_,Pe+=_;b.rc=Qe,b.Vc=Tt}else{if(t(Te.mc!=null),_=B+J,t((ke=Te.mc)!=null),t(_<=ke.i),ke.C>=_)_=1;else if(Te.ic||Fa(),Te.ic){Te=ke.V,Qe=ke.Ba,Tt=ke.c;var yr=ke.i,Gt=(Ut=1,Pe=ke.$/Tt,Ge=ke.$%Tt,kt=ke.m,Yt=ke.s,ke.$),br=Tt*yr,wr=Tt*_,Pr=Yt.wc,Er=Gt<wr?Z(Yt,Ge,Pe):null;t(Gt<=br),t(_<=yr),t(ue(Yt));t:for(;;){for(;!kt.h&&Gt<wr;){if(Ge&Pr||(Er=Z(Yt,Ge,Pe)),t(Er!=null),Q(kt),256>(yr=Ue(Er.G[0],Er.H[0],kt)))Te[Qe+Gt]=yr,++Gt,++Ge>=Tt&&(Ge=0,++Pe<=_&&!(Pe%16)&&Le(ke,Pe));else{if(!(280>yr)){Ut=0;break t}yr=He(yr-256,kt);var dn,rn=Ue(Er.G[4],Er.H[4],kt);if(Q(kt),!(Gt>=(rn=$t(Tt,rn=He(rn,kt)))&&br-Gt>=yr)){Ut=0;break t}for(dn=0;dn<yr;++dn)Te[Qe+Gt+dn]=Te[Qe+Gt+dn-rn];for(Gt+=yr,Ge+=yr;Ge>=Tt;)Ge-=Tt,++Pe<=_&&!(Pe%16)&&Le(ke,Pe);Gt<wr&&Ge&Pr&&(Er=Z(Yt,Ge,Pe))}t(kt.h==M(kt))}Le(ke,Pe>_?_:Pe);break t}!Ut||kt.h&&Gt<br?(Ut=0,ke.a=kt.h?5:3):ke.$=Gt,_=Ut}else _=ct(ke,ke.V,ke.Ba,ke.c,ke.i,_,Ze);if(!_){J=0;break e}}B+J>=ve&&(b.Cc=1),J=1}if(!J)return null;if(b.Cc&&((J=b.ga)!=null&&(J.mc=null),b.ga=null,0<b.Ga))return alert("todo:WebPDequantizeLevels"),null}return b.nb+B*de}function ws(b,_,B,J,de,ve){for(;0<de--;){var ke,Te=b,Pe=_+(B?1:0),Ge=b,kt=_+(B?0:3);for(ke=0;ke<J;++ke){var Yt=Ge[kt+4*ke];Yt!=255&&(Yt*=32897,Te[Pe+4*ke+0]=Te[Pe+4*ke+0]*Yt>>23,Te[Pe+4*ke+1]=Te[Pe+4*ke+1]*Yt>>23,Te[Pe+4*ke+2]=Te[Pe+4*ke+2]*Yt>>23)}_+=ve}}function ps(b,_,B,J,de){for(;0<J--;){var ve;for(ve=0;ve<B;++ve){var ke=b[_+2*ve+0],Te=15&(Ge=b[_+2*ve+1]),Pe=4369*Te,Ge=(240&Ge|Ge>>4)*Pe>>16;b[_+2*ve+0]=(240&ke|ke>>4)*Pe>>16&240|(15&ke|ke<<4)*Pe>>16>>4&15,b[_+2*ve+1]=240&Ge|Te}_+=de}}function $n(b,_,B,J,de,ve,ke,Te){var Pe,Ge,kt=255;for(Ge=0;Ge<de;++Ge){for(Pe=0;Pe<J;++Pe){var Yt=b[_+Pe];ve[ke+4*Pe]=Yt,kt&=Yt}_+=B,ke+=Te}return kt!=255}function Sa(b,_,B,J,de){var ve;for(ve=0;ve<de;++ve)B[J+ve]=b[_+ve]>>8}function Fa(){$0=ws,n5=ps,s5=$n,a5=Sa}function $a(b,_,B){T[b]=function(J,de,ve,ke,Te,Pe,Ge,kt,Yt,Qe,Tt,Ut,yr,Gt,br,wr,Pr){var Er,dn=Pr-1>>1,rn=Te[Pe+0]|Ge[kt+0]<<16,Fn=Yt[Qe+0]|Tt[Ut+0]<<16;t(J!=null);var an=3*rn+Fn+131074>>2;for(_(J[de+0],255&an,an>>16,yr,Gt),ve!=null&&(an=3*Fn+rn+131074>>2,_(ve[ke+0],255&an,an>>16,br,wr)),Er=1;Er<=dn;++Er){var Gn=Te[Pe+Er]|Ge[kt+Er]<<16,ka=Yt[Qe+Er]|Tt[Ut+Er]<<16,Mn=rn+Gn+Fn+ka+524296,on=Mn+2*(Gn+Fn)>>3;an=on+rn>>1,rn=(Mn=Mn+2*(rn+ka)>>3)+Gn>>1,_(J[de+2*Er-1],255&an,an>>16,yr,Gt+(2*Er-1)*B),_(J[de+2*Er-0],255&rn,rn>>16,yr,Gt+(2*Er-0)*B),ve!=null&&(an=Mn+Fn>>1,rn=on+ka>>1,_(ve[ke+2*Er-1],255&an,an>>16,br,wr+(2*Er-1)*B),_(ve[ke+2*Er+0],255&rn,rn>>16,br,wr+(2*Er+0)*B)),rn=Gn,Fn=ka}1&Pr||(an=3*rn+Fn+131074>>2,_(J[de+Pr-1],255&an,an>>16,yr,Gt+(Pr-1)*B),ve!=null&&(an=3*Fn+rn+131074>>2,_(ve[ke+Pr-1],255&an,an>>16,br,wr+(Pr-1)*B)))}}function Ao(){Lo[Zp]=P8,Lo[em]=x5,Lo[u5]=O8,Lo[tm]=g5,Lo[rm]=y5,Lo[kg]=b5,Lo[f5]=I8,Lo[jg]=x5,Lo[Ng]=g5,Lo[nm]=y5,Lo[Ag]=b5}function jl(b){return b&-16384?0>b?0:255:b>>D8}function eo(b,_){return jl((19077*b>>8)+(26149*_>>8)-14234)}function Yl(b,_,B){return jl((19077*b>>8)-(6419*_>>8)-(13320*B>>8)+8708)}function Kl(b,_){return jl((19077*b>>8)+(33050*_>>8)-17685)}function Nl(b,_,B,J,de){J[de+0]=eo(b,B),J[de+1]=Yl(b,_,B),J[de+2]=Kl(b,_)}function ha(b,_,B,J,de){J[de+0]=Kl(b,_),J[de+1]=Yl(b,_,B),J[de+2]=eo(b,B)}function Od(b,_,B,J,de){var ve=Yl(b,_,B);_=ve<<3&224|Kl(b,_)>>3,J[de+0]=248&eo(b,B)|ve>>5,J[de+1]=_}function Id(b,_,B,J,de){var ve=240&Kl(b,_)|15;J[de+0]=240&eo(b,B)|Yl(b,_,B)>>4,J[de+1]=ve}function L0(b,_,B,J,de){J[de+0]=255,Nl(b,_,B,J,de+1)}function F0(b,_,B,J,de){ha(b,_,B,J,de),J[de+3]=255}function Si(b,_,B,J,de){Nl(b,_,B,J,de),J[de+3]=255}function Jl(b,_,B){T[b]=function(J,de,ve,ke,Te,Pe,Ge,kt,Yt){for(var Qe=kt+(-2&Yt)*B;kt!=Qe;)_(J[de+0],ve[ke+0],Te[Pe+0],Ge,kt),_(J[de+1],ve[ke+0],Te[Pe+0],Ge,kt+B),de+=2,++ke,++Pe,kt+=2*B;1&Yt&&_(J[de+0],ve[ke+0],Te[Pe+0],Ge,kt)}}function qu(b,_,B){return B==0?b==0?_==0?6:5:_==0?4:0:B}function Xp(b,_,B,J,de){switch(b>>>30){case 3:Wd(_,B,J,de,0);break;case 2:Eo(_,B,J,de);break;case 1:ns(_,B,J,de)}}function Co(b,_){var B,J,de=_.M,ve=_.Nb,ke=b.oc,Te=b.pc+40,Pe=b.oc,Ge=b.pc+584,kt=b.oc,Yt=b.pc+600;for(B=0;16>B;++B)ke[Te+32*B-1]=129;for(B=0;8>B;++B)Pe[Ge+32*B-1]=129,kt[Yt+32*B-1]=129;for(0<de?ke[Te-1-32]=Pe[Ge-1-32]=kt[Yt-1-32]=129:(a(ke,Te-32-1,127,21),a(Pe,Ge-32-1,127,9),a(kt,Yt-32-1,127,9)),J=0;J<b.za;++J){var Qe=_.ya[_.aa+J];if(0<J){for(B=-1;16>B;++B)s(ke,Te+32*B-4,ke,Te+32*B+12,4);for(B=-1;8>B;++B)s(Pe,Ge+32*B-4,Pe,Ge+32*B+4,4),s(kt,Yt+32*B-4,kt,Yt+32*B+4,4)}var Tt=b.Gd,Ut=b.Hd+J,yr=Qe.ad,Gt=Qe.Hc;if(0<de&&(s(ke,Te-32,Tt[Ut].y,0,16),s(Pe,Ge-32,Tt[Ut].f,0,8),s(kt,Yt-32,Tt[Ut].ea,0,8)),Qe.Za){var br=ke,wr=Te-32+16;for(0<de&&(J>=b.za-1?a(br,wr,Tt[Ut].y[15],4):s(br,wr,Tt[Ut+1].y,0,4)),B=0;4>B;B++)br[wr+128+B]=br[wr+256+B]=br[wr+384+B]=br[wr+0+B];for(B=0;16>B;++B,Gt<<=2)br=ke,wr=Te+w5[B],el[Qe.Ob[B]](br,wr),Xp(Gt,yr,16*+B,br,wr)}else if(br=qu(J,de,Qe.Ob[0]),Uc[br](ke,Te),Gt!=0)for(B=0;16>B;++B,Gt<<=2)Xp(Gt,yr,16*+B,ke,Te+w5[B]);for(B=Qe.Gc,br=qu(J,de,Qe.Dd),tc[br](Pe,Ge),tc[br](kt,Yt),Gt=yr,br=Pe,wr=Ge,255&(Qe=0|B)&&(170&Qe?El(Gt,256,br,wr):ms(Gt,256,br,wr)),Qe=kt,Gt=Yt,255&(B>>=8)&&(170&B?El(yr,320,Qe,Gt):ms(yr,320,Qe,Gt)),de<b.Ub-1&&(s(Tt[Ut].y,0,ke,Te+480,16),s(Tt[Ut].f,0,Pe,Ge+224,8),s(Tt[Ut].ea,0,kt,Yt+224,8)),B=8*ve*b.B,Tt=b.sa,Ut=b.ta+16*J+16*ve*b.R,yr=b.qa,Qe=b.ra+8*J+B,Gt=b.Ha,br=b.Ia+8*J+B,B=0;16>B;++B)s(Tt,Ut+B*b.R,ke,Te+32*B,16);for(B=0;8>B;++B)s(yr,Qe+B*b.B,Pe,Ge+32*B,8),s(Gt,br+B*b.B,kt,Yt+32*B,8)}}function Dd(b,_,B,J,de,ve,ke,Te,Pe){var Ge=[0],kt=[0],Yt=0,Qe=Pe!=null?Pe.kd:0,Tt=Pe??new ur;if(b==null||12>B)return 7;Tt.data=b,Tt.w=_,Tt.ha=B,_=[_],B=[B],Tt.gb=[Tt.gb];e:{var Ut=_,yr=B,Gt=Tt.gb;if(t(b!=null),t(yr!=null),t(Gt!=null),Gt[0]=0,12<=yr[0]&&!r(b,Ut[0],"RIFF")){if(r(b,Ut[0]+8,"WEBP")){Gt=3;break e}var br=oe(b,Ut[0]+4);if(12>br||4294967286<br){Gt=3;break e}if(Qe&&br>yr[0]-8){Gt=7;break e}Gt[0]=br,Ut[0]+=12,yr[0]-=12}Gt=0}if(Gt!=0)return Gt;for(br=0<Tt.gb[0],B=B[0];;){e:{var wr=b;yr=_,Gt=B;var Pr=Ge,Er=kt,dn=Ut=[0];if((an=Yt=[Yt])[0]=0,8>Gt[0])Gt=7;else{if(!r(wr,yr[0],"VP8X")){if(oe(wr,yr[0]+4)!=10){Gt=3;break e}if(18>Gt[0]){Gt=7;break e}var rn=oe(wr,yr[0]+8),Fn=1+H(wr,yr[0]+12);if(2147483648<=Fn*(wr=1+H(wr,yr[0]+15))){Gt=3;break e}dn!=null&&(dn[0]=rn),Pr!=null&&(Pr[0]=Fn),Er!=null&&(Er[0]=wr),yr[0]+=18,Gt[0]-=18,an[0]=1}Gt=0}}if(Yt=Yt[0],Ut=Ut[0],Gt!=0)return Gt;if(yr=!!(2&Ut),!br&&Yt)return 3;if(ve!=null&&(ve[0]=!!(16&Ut)),ke!=null&&(ke[0]=yr),Te!=null&&(Te[0]=0),ke=Ge[0],Ut=kt[0],Yt&&yr&&Pe==null){Gt=0;break}if(4>B){Gt=7;break}if(br&&Yt||!br&&!Yt&&!r(b,_[0],"ALPH")){B=[B],Tt.na=[Tt.na],Tt.P=[Tt.P],Tt.Sa=[Tt.Sa];e:{rn=b,Gt=_,br=B;var an=Tt.gb;Pr=Tt.na,Er=Tt.P,dn=Tt.Sa,Fn=22,t(rn!=null),t(br!=null),wr=Gt[0];var Gn=br[0];for(t(Pr!=null),t(dn!=null),Pr[0]=null,Er[0]=null,dn[0]=0;;){if(Gt[0]=wr,br[0]=Gn,8>Gn){Gt=7;break e}var ka=oe(rn,wr+4);if(4294967286<ka){Gt=3;break e}var Mn=8+ka+1&-2;if(Fn+=Mn,0<an&&Fn>an){Gt=3;break e}if(!r(rn,wr,"VP8 ")||!r(rn,wr,"VP8L")){Gt=0;break e}if(Gn[0]<Mn){Gt=7;break e}r(rn,wr,"ALPH")||(Pr[0]=rn,Er[0]=wr+8,dn[0]=ka),wr+=Mn,Gn-=Mn}}if(B=B[0],Tt.na=Tt.na[0],Tt.P=Tt.P[0],Tt.Sa=Tt.Sa[0],Gt!=0)break}B=[B],Tt.Ja=[Tt.Ja],Tt.xa=[Tt.xa];e:if(an=b,Gt=_,br=B,Pr=Tt.gb[0],Er=Tt.Ja,dn=Tt.xa,rn=Gt[0],wr=!r(an,rn,"VP8 "),Fn=!r(an,rn,"VP8L"),t(an!=null),t(br!=null),t(Er!=null),t(dn!=null),8>br[0])Gt=7;else{if(wr||Fn){if(an=oe(an,rn+4),12<=Pr&&an>Pr-12){Gt=3;break e}if(Qe&&an>br[0]-8){Gt=7;break e}Er[0]=an,Gt[0]+=8,br[0]-=8,dn[0]=Fn}else dn[0]=5<=br[0]&&an[rn+0]==47&&!(an[rn+4]>>5),Er[0]=br[0];Gt=0}if(B=B[0],Tt.Ja=Tt.Ja[0],Tt.xa=Tt.xa[0],_=_[0],Gt!=0)break;if(4294967286<Tt.Ja)return 3;if(Te==null||yr||(Te[0]=Tt.xa?2:1),ke=[ke],Ut=[Ut],Tt.xa){if(5>B){Gt=7;break}Te=ke,Qe=Ut,yr=ve,b==null||5>B?b=0:5<=B&&b[_+0]==47&&!(b[_+4]>>5)?(br=[0],an=[0],Pr=[0],q(Er=new U,b,_,B),dt(Er,br,an,Pr)?(Te!=null&&(Te[0]=br[0]),Qe!=null&&(Qe[0]=an[0]),yr!=null&&(yr[0]=Pr[0]),b=1):b=0):b=0}else{if(10>B){Gt=7;break}Te=Ut,b==null||10>B||!Ce(b,_+3,B-3)?b=0:(Qe=b[_+0]|b[_+1]<<8|b[_+2]<<16,yr=16383&(b[_+7]<<8|b[_+6]),b=16383&(b[_+9]<<8|b[_+8]),1&Qe||3<(Qe>>1&7)||!(Qe>>4&1)||Qe>>5>=Tt.Ja||!yr||!b?b=0:(ke&&(ke[0]=yr),Te&&(Te[0]=b),b=1))}if(!b||(ke=ke[0],Ut=Ut[0],Yt&&(Ge[0]!=ke||kt[0]!=Ut)))return 3;Pe!=null&&(Pe[0]=Tt,Pe.offset=_-Pe.w,t(4294967286>_-Pe.w),t(Pe.offset==Pe.ha-B));break}return Gt==0||Gt==7&&Yt&&Pe==null?(ve!=null&&(ve[0]|=Tt.na!=null&&0<Tt.na.length),J!=null&&(J[0]=ke),de!=null&&(de[0]=Ut),0):Gt}function M0(b,_,B){var J=_.width,de=_.height,ve=0,ke=0,Te=J,Pe=de;if(_.Da=b!=null&&0<b.Da,_.Da&&(Te=b.cd,Pe=b.bd,ve=b.v,ke=b.j,11>B||(ve&=-2,ke&=-2),0>ve||0>ke||0>=Te||0>=Pe||ve+Te>J||ke+Pe>de))return 0;if(_.v=ve,_.j=ke,_.va=ve+Te,_.o=ke+Pe,_.U=Te,_.T=Pe,_.da=b!=null&&0<b.da,_.da){if(!$e(Te,Pe,B=[b.ib],ve=[b.hb]))return 0;_.ib=B[0],_.hb=ve[0]}return _.ob=b!=null&&b.ob,_.Kb=b==null||!b.Sd,_.da&&(_.ob=_.ib<3*J/4&&_.hb<3*de/4,_.Kb=0),1}function R0(b){if(b==null)return 2;if(11>b.S){var _=b.f.RGBA;_.fb+=(b.height-1)*_.A,_.A=-_.A}else _=b.f.kb,b=b.height,_.O+=(b-1)*_.fa,_.fa=-_.fa,_.N+=(b-1>>1)*_.Ab,_.Ab=-_.Ab,_.W+=(b-1>>1)*_.Db,_.Db=-_.Db,_.F!=null&&(_.J+=(b-1)*_.lb,_.lb=-_.lb);return 0}function Mc(b,_,B,J){if(J==null||0>=b||0>=_)return 2;if(B!=null){if(B.Da){var de=B.cd,ve=B.bd,ke=-2&B.v,Te=-2&B.j;if(0>ke||0>Te||0>=de||0>=ve||ke+de>b||Te+ve>_)return 2;b=de,_=ve}if(B.da){if(!$e(b,_,de=[B.ib],ve=[B.hb]))return 2;b=de[0],_=ve[0]}}J.width=b,J.height=_;e:{var Pe=J.width,Ge=J.height;if(b=J.S,0>=Pe||0>=Ge||!(b>=Zp&&13>b))b=2;else{if(0>=J.Rd&&J.sd==null){ke=ve=de=_=0;var kt=(Te=Pe*S5[b])*Ge;if(11>b||(ve=(Ge+1)/2*(_=(Pe+1)/2),b==12&&(ke=(de=Pe)*Ge)),(Ge=i(kt+2*ve+ke))==null){b=1;break e}J.sd=Ge,11>b?((Pe=J.f.RGBA).eb=Ge,Pe.fb=0,Pe.A=Te,Pe.size=kt):((Pe=J.f.kb).y=Ge,Pe.O=0,Pe.fa=Te,Pe.Fd=kt,Pe.f=Ge,Pe.N=0+kt,Pe.Ab=_,Pe.Cd=ve,Pe.ea=Ge,Pe.W=0+kt+ve,Pe.Db=_,Pe.Ed=ve,b==12&&(Pe.F=Ge,Pe.J=0+kt+2*ve),Pe.Tc=ke,Pe.lb=de)}if(_=1,de=J.S,ve=J.width,ke=J.height,de>=Zp&&13>de)if(11>de)b=J.f.RGBA,_&=(Te=Math.abs(b.A))*(ke-1)+ve<=b.size,_&=Te>=ve*S5[de],_&=b.eb!=null;else{b=J.f.kb,Te=(ve+1)/2,kt=(ke+1)/2,Pe=Math.abs(b.fa),Ge=Math.abs(b.Ab);var Yt=Math.abs(b.Db),Qe=Math.abs(b.lb),Tt=Qe*(ke-1)+ve;_&=Pe*(ke-1)+ve<=b.Fd,_&=Ge*(kt-1)+Te<=b.Cd,_=(_&=Yt*(kt-1)+Te<=b.Ed)&Pe>=ve&Ge>=Te&Yt>=Te,_&=b.y!=null,_&=b.f!=null,_&=b.ea!=null,de==12&&(_&=Qe>=ve,_&=Tt<=b.Tc,_&=b.F!=null)}else _=0;b=_?0:2}}return b!=0||B!=null&&B.fd&&(b=R0(J)),b}var Ud=64,to=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ro=24,Rc=32,Zl=8,Bc=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Ee("Predictor0","PredictorAdd0"),T.Predictor0=function(){return 4278190080},T.Predictor1=function(b){return b},T.Predictor2=function(b,_,B){return _[B+0]},T.Predictor3=function(b,_,B){return _[B+1]},T.Predictor4=function(b,_,B){return _[B-1]},T.Predictor5=function(b,_,B){return Ve(Ve(b,_[B+1]),_[B+0])},T.Predictor6=function(b,_,B){return Ve(b,_[B-1])},T.Predictor7=function(b,_,B){return Ve(b,_[B+0])},T.Predictor8=function(b,_,B){return Ve(_[B-1],_[B+0])},T.Predictor9=function(b,_,B){return Ve(_[B+0],_[B+1])},T.Predictor10=function(b,_,B){return Ve(Ve(b,_[B-1]),Ve(_[B+0],_[B+1]))},T.Predictor11=function(b,_,B){var J=_[B+0];return 0>=ze(J>>24&255,b>>24&255,(_=_[B-1])>>24&255)+ze(J>>16&255,b>>16&255,_>>16&255)+ze(J>>8&255,b>>8&255,_>>8&255)+ze(255&J,255&b,255&_)?J:b},T.Predictor12=function(b,_,B){var J=_[B+0];return(St((b>>24&255)+(J>>24&255)-((_=_[B-1])>>24&255))<<24|St((b>>16&255)+(J>>16&255)-(_>>16&255))<<16|St((b>>8&255)+(J>>8&255)-(_>>8&255))<<8|St((255&b)+(255&J)-(255&_)))>>>0},T.Predictor13=function(b,_,B){var J=_[B-1];return(rt((b=Ve(b,_[B+0]))>>24&255,J>>24&255)<<24|rt(b>>16&255,J>>16&255)<<16|rt(b>>8&255,J>>8&255)<<8|rt(255&b,255&J))>>>0};var B0=T.PredictorAdd0;T.PredictorAdd1=Ie,Ee("Predictor2","PredictorAdd2"),Ee("Predictor3","PredictorAdd3"),Ee("Predictor4","PredictorAdd4"),Ee("Predictor5","PredictorAdd5"),Ee("Predictor6","PredictorAdd6"),Ee("Predictor7","PredictorAdd7"),Ee("Predictor8","PredictorAdd8"),Ee("Predictor9","PredictorAdd9"),Ee("Predictor10","PredictorAdd10"),Ee("Predictor11","PredictorAdd11"),Ee("Predictor12","PredictorAdd12"),Ee("Predictor13","PredictorAdd13");var Hu=T.PredictorAdd2;Me("ColorIndexInverseTransform","MapARGB","32b",function(b){return b>>8&255},function(b){return b}),Me("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(b){return b},function(b){return b>>8&255});var Js,Yp=T.ColorIndexInverseTransform,Al=T.MapARGB,Cl=T.VP8LColorIndexInverseTransformAlpha,P0=T.MapAlpha,O0=T.VP8LPredictorsAdd=[];O0.length=16,(T.VP8LPredictors=[]).length=16,(T.VP8LPredictorsAdd_C=[]).length=16,(T.VP8LPredictors_C=[]).length=16;var I0,D0,Pc,Oc,Ic,$d,Dc,Wd,Eo,El,ns,ms,Zs,_a,ec,U0,Vu,Kp,Kw,Jw,Zw,e5,t5,r5,$0,n5,s5,a5,i5=i(511),o5=i(2041),l5=i(225),c5=i(767),d5=0,_g=o5,Jp=l5,no=c5,To=i5,Zp=0,em=1,u5=2,tm=3,rm=4,kg=5,f5=6,jg=7,Ng=8,nm=9,Ag=10,S8=[2,3,7],_8=[3,3,11],h5=[280,256,256,256,40],k8=[0,1,1,1,0],j8=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],N8=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],A8=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],C8=8,Cg=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Eg=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],W0=null,E8=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],T8=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],p5=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],L8=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],F8=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],M8=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],R8=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Uc=[],el=[],tc=[],B8=1,m5=2,$c=[],Lo=[];$a("UpsampleRgbLinePair",Nl,3),$a("UpsampleBgrLinePair",ha,3),$a("UpsampleRgbaLinePair",Si,4),$a("UpsampleBgraLinePair",F0,4),$a("UpsampleArgbLinePair",L0,4),$a("UpsampleRgba4444LinePair",Id,2),$a("UpsampleRgb565LinePair",Od,2);var P8=T.UpsampleRgbLinePair,O8=T.UpsampleBgrLinePair,x5=T.UpsampleRgbaLinePair,g5=T.UpsampleBgraLinePair,y5=T.UpsampleArgbLinePair,b5=T.UpsampleRgba4444LinePair,I8=T.UpsampleRgb565LinePair,sm=16,am=1<<sm-1,z0=-227,Tg=482,D8=6,v5=0,U8=i(256),$8=i(256),W8=i(256),z8=i(256),q8=i(Tg-z0),H8=i(Tg-z0);Jl("YuvToRgbRow",Nl,3),Jl("YuvToBgrRow",ha,3),Jl("YuvToRgbaRow",Si,4),Jl("YuvToBgraRow",F0,4),Jl("YuvToArgbRow",L0,4),Jl("YuvToRgba4444Row",Id,2),Jl("YuvToRgb565Row",Od,2);var w5=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],im=[0,2,8],V8=[8,7,6,4,4,2,2,2,1,1,1,1],G8=1;this.WebPDecodeRGBA=function(b,_,B,J,de){var ve=em,ke=new Jt,Te=new $r;ke.ba=Te,Te.S=ve,Te.width=[Te.width],Te.height=[Te.height];var Pe=Te.width,Ge=Te.height,kt=new _r;if(kt==null||b==null)var Yt=2;else t(kt!=null),Yt=Dd(b,_,B,kt.width,kt.height,kt.Pd,kt.Qd,kt.format,null);if(Yt!=0?Pe=0:(Pe!=null&&(Pe[0]=kt.width[0]),Ge!=null&&(Ge[0]=kt.height[0]),Pe=1),Pe){Te.width=Te.width[0],Te.height=Te.height[0],J!=null&&(J[0]=Te.width),de!=null&&(de[0]=Te.height);e:{if(J=new Rr,(de=new ur).data=b,de.w=_,de.ha=B,de.kd=1,_=[0],t(de!=null),((b=Dd(de.data,de.w,de.ha,null,null,null,_,null,de))==0||b==7)&&_[0]&&(b=4),(_=b)==0){if(t(ke!=null),J.data=de.data,J.w=de.w+de.offset,J.ha=de.ha-de.offset,J.put=qe,J.ac=Oe,J.bc=Lt,J.ma=ke,de.xa){if((b=xe())==null){ke=1;break e}if(function(Qe,Tt){var Ut=[0],yr=[0],Gt=[0];t:for(;;){if(Qe==null)return 0;if(Tt==null)return Qe.a=2,0;if(Qe.l=Tt,Qe.a=0,q(Qe.m,Tt.data,Tt.w,Tt.ha),!dt(Qe.m,Ut,yr,Gt)){Qe.a=3;break t}if(Qe.xb=m5,Tt.width=Ut[0],Tt.height=yr[0],!se(Ut[0],yr[0],1,Qe,null))break t;return 1}return t(Qe.a!=0),0}(b,J)){if(J=(_=Mc(J.width,J.height,ke.Oa,ke.ba))==0){t:{J=b;r:for(;;){if(J==null){J=0;break t}if(t(J.s.yc!=null),t(J.s.Ya!=null),t(0<J.s.Wb),t((B=J.l)!=null),t((de=B.ma)!=null),J.xb!=0){if(J.ca=de.ba,J.tb=de.tb,t(J.ca!=null),!M0(de.Oa,B,tm)){J.a=2;break r}if(!Se(J,B.width)||B.da)break r;if((B.da||ft(J.ca.S))&&Fa(),11>J.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),J.ca.f.kb.F!=null&&Fa()),J.Pb&&0<J.s.ua&&J.s.vb.X==null&&!D(J.s.vb,J.s.Wa.Xa)){J.a=1;break r}J.xb=0}if(!ct(J,J.V,J.Ba,J.c,J.i,B.o,ee))break r;de.Dc=J.Ma,J=1;break t}t(J.a!=0),J=0}J=!J}J&&(_=b.a)}else _=b.a}else{if((b=new De)==null){ke=1;break e}if(b.Fa=de.na,b.P=de.P,b.qc=de.Sa,it(b,J)){if((_=Mc(J.width,J.height,ke.Oa,ke.ba))==0){if(b.Aa=0,B=ke.Oa,t((de=b)!=null),B!=null){if(0<(Pe=0>(Pe=B.Md)?0:100<Pe?255:255*Pe/100)){for(Ge=kt=0;4>Ge;++Ge)12>(Yt=de.pb[Ge]).lc&&(Yt.ia=Pe*V8[0>Yt.lc?0:Yt.lc]>>3),kt|=Yt.ia;kt&&(alert("todo:VP8InitRandom"),de.ia=1)}de.Ga=B.Id,100<de.Ga?de.Ga=100:0>de.Ga&&(de.Ga=0)}(function(Qe,Tt){if(Qe==null)return 0;if(Tt==null)return Ke(Qe,2,"NULL VP8Io parameter in VP8Decode().");if(!Qe.cb&&!it(Qe,Tt))return 0;if(t(Qe.cb),Tt.ac==null||Tt.ac(Tt)){Tt.ob&&(Qe.L=0);var Ut=im[Qe.L];if(Qe.L==2?(Qe.yb=0,Qe.zb=0):(Qe.yb=Tt.v-Ut>>4,Qe.zb=Tt.j-Ut>>4,0>Qe.yb&&(Qe.yb=0),0>Qe.zb&&(Qe.zb=0)),Qe.Va=Tt.o+15+Ut>>4,Qe.Hb=Tt.va+15+Ut>>4,Qe.Hb>Qe.za&&(Qe.Hb=Qe.za),Qe.Va>Qe.Ub&&(Qe.Va=Qe.Ub),0<Qe.L){var yr=Qe.ed;for(Ut=0;4>Ut;++Ut){var Gt;if(Qe.Qa.Cb){var br=Qe.Qa.Lb[Ut];Qe.Qa.Fb||(br+=yr.Tb)}else br=yr.Tb;for(Gt=0;1>=Gt;++Gt){var wr=Qe.gd[Ut][Gt],Pr=br;if(yr.Pc&&(Pr+=yr.vd[0],Gt&&(Pr+=yr.od[0])),0<(Pr=0>Pr?0:63<Pr?63:Pr)){var Er=Pr;0<yr.wb&&(Er=4<yr.wb?Er>>2:Er>>1)>9-yr.wb&&(Er=9-yr.wb),1>Er&&(Er=1),wr.dd=Er,wr.tc=2*Pr+Er,wr.ld=40<=Pr?2:15<=Pr?1:0}else wr.tc=0;wr.La=Gt}}}Ut=0}else Ke(Qe,6,"Frame setup failed"),Ut=Qe.a;if(Ut=Ut==0){if(Ut){Qe.$c=0,0<Qe.Aa||(Qe.Ic=G8);t:{Ut=Qe.Ic,yr=4*(Er=Qe.za);var dn=32*Er,rn=Er+1,Fn=0<Qe.L?Er*(0<Qe.Aa?2:1):0,an=(Qe.Aa==2?2:1)*Er;if((wr=yr+832+(Gt=3*(16*Ut+im[Qe.L])/2*dn)+(br=Qe.Fa!=null&&0<Qe.Fa.length?Qe.Kc.c*Qe.Kc.i:0))!=wr)Ut=0;else{if(wr>Qe.Vb){if(Qe.Vb=0,Qe.Ec=i(wr),Qe.Fc=0,Qe.Ec==null){Ut=Ke(Qe,1,"no memory during frame initialization.");break t}Qe.Vb=wr}wr=Qe.Ec,Pr=Qe.Fc,Qe.Ac=wr,Qe.Bc=Pr,Pr+=yr,Qe.Gd=o(dn,jr),Qe.Hd=0,Qe.rb=o(rn+1,pt),Qe.sb=1,Qe.wa=Fn?o(Fn,mr):null,Qe.Y=0,Qe.D.Nb=0,Qe.D.wa=Qe.wa,Qe.D.Y=Qe.Y,0<Qe.Aa&&(Qe.D.Y+=Er),t(!0),Qe.oc=wr,Qe.pc=Pr,Pr+=832,Qe.ya=o(an,Rt),Qe.aa=0,Qe.D.ya=Qe.ya,Qe.D.aa=Qe.aa,Qe.Aa==2&&(Qe.D.aa+=Er),Qe.R=16*Er,Qe.B=8*Er,Er=(dn=im[Qe.L])*Qe.R,dn=dn/2*Qe.B,Qe.sa=wr,Qe.ta=Pr+Er,Qe.qa=Qe.sa,Qe.ra=Qe.ta+16*Ut*Qe.R+dn,Qe.Ha=Qe.qa,Qe.Ia=Qe.ra+8*Ut*Qe.B+dn,Qe.$c=0,Pr+=Gt,Qe.mb=br?wr:null,Qe.nb=br?Pr:null,t(Pr+br<=Qe.Fc+Qe.Vb),Kt(Qe),a(Qe.Ac,Qe.Bc,0,yr),Ut=1}}if(Ut){if(Tt.ka=0,Tt.y=Qe.sa,Tt.O=Qe.ta,Tt.f=Qe.qa,Tt.N=Qe.ra,Tt.ea=Qe.Ha,Tt.Vd=Qe.Ia,Tt.fa=Qe.R,Tt.Rc=Qe.B,Tt.F=null,Tt.J=0,!d5){for(Ut=-255;255>=Ut;++Ut)i5[255+Ut]=0>Ut?-Ut:Ut;for(Ut=-1020;1020>=Ut;++Ut)o5[1020+Ut]=-128>Ut?-128:127<Ut?127:Ut;for(Ut=-112;112>=Ut;++Ut)l5[112+Ut]=-16>Ut?-16:15<Ut?15:Ut;for(Ut=-255;510>=Ut;++Ut)c5[255+Ut]=0>Ut?0:255<Ut?255:Ut;d5=1}Dc=bt,Wd=tt,El=Ft,ns=Qt,ms=At,Eo=Mt,Zs=cn,_a=nr,ec=ae,U0=Ne,Vu=ar,Kp=j,Kw=Xe,Jw=ut,Zw=Br,e5=kr,t5=Ur,r5=zr,el[0]=vr,el[1]=ie,el[2]=Ot,el[3]=Tr,el[4]=ye,el[5]=ht,el[6]=lt,el[7]=Vt,el[8]=Yr,el[9]=Wr,Uc[0]=cr,Uc[1]=Je,Uc[2]=Nt,Uc[3]=Bt,Uc[4]=sr,Uc[5]=Fr,Uc[6]=Nr,tc[0]=st,tc[1]=_e,tc[2]=fn,tc[3]=In,tc[4]=nt,tc[5]=at,tc[6]=xt,Ut=1}else Ut=0}Ut&&(Ut=function(Gn,ka){for(Gn.M=0;Gn.M<Gn.Va;++Gn.M){var Mn,on=Gn.Jc[Gn.M&Gn.Xb],Qr=Gn.m,ea=Gn;for(Mn=0;Mn<ea.za;++Mn){var Cn=Qr,Qn=ea,Ss=Qn.Ac,Wa=Qn.Bc+4*Mn,_i=Qn.zc,Ws=Qn.ya[Qn.aa+Mn];if(Qn.Qa.Bb?Ws.$b=z(Cn,Qn.Pa.jb[0])?2+z(Cn,Qn.Pa.jb[2]):z(Cn,Qn.Pa.jb[1]):Ws.$b=0,Qn.kc&&(Ws.Ad=z(Cn,Qn.Bd)),Ws.Za=!z(Cn,145)+0,Ws.Za){var ri=Ws.Ob,ki=0;for(Qn=0;4>Qn;++Qn){var ja,Xn=_i[0+Qn];for(ja=0;4>ja;++ja){Xn=F8[Ss[Wa+ja]][Xn];for(var as=p5[z(Cn,Xn[0])];0<as;)as=p5[2*as+z(Cn,Xn[as])];Xn=-as,Ss[Wa+ja]=Xn}s(ri,ki,Ss,Wa,4),ki+=4,_i[0+Qn]=Xn}}else Xn=z(Cn,156)?z(Cn,128)?1:3:z(Cn,163)?2:0,Ws.Ob[0]=Xn,a(Ss,Wa,Xn,4),a(_i,0,Xn,4);Ws.Dd=z(Cn,142)?z(Cn,114)?z(Cn,183)?1:3:2:0}if(ea.m.Ka)return Ke(Gn,7,"Premature end-of-partition0 encountered.");for(;Gn.ja<Gn.za;++Gn.ja){if(ea=on,Cn=(Qr=Gn).rb[Qr.sb-1],Ss=Qr.rb[Qr.sb+Qr.ja],Mn=Qr.ya[Qr.aa+Qr.ja],Wa=Qr.kc?Mn.Ad:0)Cn.la=Ss.la=0,Mn.Za||(Cn.Na=Ss.Na=0),Mn.Hc=0,Mn.Gc=0,Mn.ia=0;else{var zs,is;if(Cn=Ss,Ss=ea,Wa=Qr.Pa.Xc,_i=Qr.ya[Qr.aa+Qr.ja],Ws=Qr.pb[_i.$b],Qn=_i.ad,ri=0,ki=Qr.rb[Qr.sb-1],Xn=ja=0,a(Qn,ri,0,384),_i.Za)var za=0,tl=Wa[3];else{as=i(16);var ta=Cn.Na+ki.Na;if(ta=W0(Ss,Wa[1],ta,Ws.Eb,0,as,0),Cn.Na=ki.Na=(0<ta)+0,1<ta)Dc(as,0,Qn,ri);else{var Bi=as[0]+3>>3;for(as=0;256>as;as+=16)Qn[ri+as]=Bi}za=1,tl=Wa[0]}var xs=15&Cn.la,Na=15&ki.la;for(as=0;4>as;++as){var so=1&Na;for(Bi=is=0;4>Bi;++Bi)xs=xs>>1|(so=(ta=W0(Ss,tl,ta=so+(1&xs),Ws.Sc,za,Qn,ri))>za)<<7,is=is<<2|(3<ta?3:1<ta?2:Qn[ri+0]!=0),ri+=16;xs>>=4,Na=Na>>1|so<<7,ja=(ja<<8|is)>>>0}for(tl=xs,za=Na>>4,zs=0;4>zs;zs+=2){for(is=0,xs=Cn.la>>4+zs,Na=ki.la>>4+zs,as=0;2>as;++as){for(so=1&Na,Bi=0;2>Bi;++Bi)ta=so+(1&xs),xs=xs>>1|(so=0<(ta=W0(Ss,Wa[2],ta,Ws.Qc,0,Qn,ri)))<<3,is=is<<2|(3<ta?3:1<ta?2:Qn[ri+0]!=0),ri+=16;xs>>=2,Na=Na>>1|so<<5}Xn|=is<<4*zs,tl|=xs<<4<<zs,za|=(240&Na)<<zs}Cn.la=tl,ki.la=za,_i.Hc=ja,_i.Gc=Xn,_i.ia=43690&Xn?0:Ws.ia,Wa=!(ja|Xn)}if(0<Qr.L&&(Qr.wa[Qr.Y+Qr.ja]=Qr.gd[Mn.$b][Mn.Za],Qr.wa[Qr.Y+Qr.ja].La|=!Wa),ea.Ka)return Ke(Gn,7,"Premature end-of-file encountered.")}if(Kt(Gn),Qr=ka,ea=1,Mn=(on=Gn).D,Cn=0<on.L&&on.M>=on.zb&&on.M<=on.Va,on.Aa==0)t:{if(Mn.M=on.M,Mn.uc=Cn,Co(on,Mn),ea=1,Mn=(is=on.D).Nb,Cn=(Xn=im[on.L])*on.R,Ss=Xn/2*on.B,as=16*Mn*on.R,Bi=8*Mn*on.B,Wa=on.sa,_i=on.ta-Cn+as,Ws=on.qa,Qn=on.ra-Ss+Bi,ri=on.Ha,ki=on.Ia-Ss+Bi,Na=(xs=is.M)==0,ja=xs>=on.Va-1,on.Aa==2&&Co(on,is),is.uc)for(so=(ta=on).D.M,t(ta.D.uc),is=ta.yb;is<ta.Hb;++is){za=is,tl=so;var ji=(ao=(qa=ta).D).Nb;zs=qa.R;var ao=ao.wa[ao.Y+za],io=qa.sa,Pi=qa.ta+16*ji*zs+16*za,oo=ao.dd,bs=ao.tc;if(bs!=0)if(t(3<=bs),qa.L==1)0<za&&e5(io,Pi,zs,bs+4),ao.La&&r5(io,Pi,zs,bs),0<tl&&Zw(io,Pi,zs,bs+4),ao.La&&t5(io,Pi,zs,bs);else{var lo=qa.B,rl=qa.qa,zd=qa.ra+8*ji*lo+8*za,rc=qa.Ha,qa=qa.Ia+8*ji*lo+8*za;ji=ao.ld,0<za&&(_a(io,Pi,zs,bs+4,oo,ji),U0(rl,zd,rc,qa,lo,bs+4,oo,ji)),ao.La&&(Kp(io,Pi,zs,bs,oo,ji),Jw(rl,zd,rc,qa,lo,bs,oo,ji)),0<tl&&(Zs(io,Pi,zs,bs+4,oo,ji),ec(rl,zd,rc,qa,lo,bs+4,oo,ji)),ao.La&&(Vu(io,Pi,zs,bs,oo,ji),Kw(rl,zd,rc,qa,lo,bs,oo,ji))}}if(on.ia&&alert("todo:DitherRow"),Qr.put!=null){if(is=16*xs,xs=16*(xs+1),Na?(Qr.y=on.sa,Qr.O=on.ta+as,Qr.f=on.qa,Qr.N=on.ra+Bi,Qr.ea=on.Ha,Qr.W=on.Ia+Bi):(is-=Xn,Qr.y=Wa,Qr.O=_i,Qr.f=Ws,Qr.N=Qn,Qr.ea=ri,Qr.W=ki),ja||(xs-=Xn),xs>Qr.o&&(xs=Qr.o),Qr.F=null,Qr.J=null,on.Fa!=null&&0<on.Fa.length&&is<xs&&(Qr.J=Dn(on,Qr,is,xs-is),Qr.F=on.mb,Qr.F==null&&Qr.F.length==0)){ea=Ke(on,3,"Could not decode alpha data.");break t}is<Qr.j&&(Xn=Qr.j-is,is=Qr.j,t(!(1&Xn)),Qr.O+=on.R*Xn,Qr.N+=on.B*(Xn>>1),Qr.W+=on.B*(Xn>>1),Qr.F!=null&&(Qr.J+=Qr.width*Xn)),is<xs&&(Qr.O+=Qr.v,Qr.N+=Qr.v>>1,Qr.W+=Qr.v>>1,Qr.F!=null&&(Qr.J+=Qr.v),Qr.ka=is-Qr.j,Qr.U=Qr.va-Qr.v,Qr.T=xs-is,ea=Qr.put(Qr))}Mn+1!=on.Ic||ja||(s(on.sa,on.ta-Cn,Wa,_i+16*on.R,Cn),s(on.qa,on.ra-Ss,Ws,Qn+8*on.B,Ss),s(on.Ha,on.Ia-Ss,ri,ki+8*on.B,Ss))}if(!ea)return Ke(Gn,6,"Output aborted.")}return 1}(Qe,Tt)),Tt.bc!=null&&Tt.bc(Tt),Ut&=1}return Ut?(Qe.cb=0,Ut):0})(b,J)||(_=b.a)}}else _=b.a}_==0&&ke.Oa!=null&&ke.Oa.fd&&(_=R0(ke.ba))}ke=_}ve=ke!=0?null:11>ve?Te.f.RGBA.eb:Te.f.kb.y}else ve=null;return ve};var S5=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(T,W){for(var A="",N=0;N<4;N++)A+=String.fromCharCode(T[W++]);return A}function u(T,W){return T[W+0]|T[W+1]<<8}function h(T,W){return(T[W+0]|T[W+1]<<8|T[W+2]<<16)>>>0}function p(T,W){return(T[W+0]|T[W+1]<<8|T[W+2]<<16|T[W+3]<<24)>>>0}new c;var f=[0],x=[0],g=[],y=new c,m=e,w=function(T,W){var A={},N=0,P=!1,K=0,re=0;if(A.frames=[],!function(E,U){for(var I=0;I<4;I++)if(E[U+I]!="RIFF".charCodeAt(I))return!0;return!1}(T,W)){for(p(T,W+=4),W+=8;W<T.length;){var ge=d(T,W),Fe=p(T,W+=4);W+=4;var R=Fe+(1&Fe);switch(ge){case"VP8 ":case"VP8L":A.frames[N]===void 0&&(A.frames[N]={}),(fe=A.frames[N]).src_off=P?re:W-8,fe.src_size=K+Fe+8,N++,P&&(P=!1,K=0,re=0);break;case"VP8X":(fe=A.header={}).feature_flags=T[W];var q=W+4;fe.canvas_width=1+h(T,q),q+=3,fe.canvas_height=1+h(T,q),q+=3;break;case"ALPH":P=!0,K=R+8,re=W-8;break;case"ANIM":(fe=A.header).bgcolor=p(T,W),q=W+4,fe.loop_count=u(T,q),q+=2;break;case"ANMF":var me,fe;(fe=A.frames[N]={}).offset_x=2*h(T,W),W+=3,fe.offset_y=2*h(T,W),W+=3,fe.width=1+h(T,W),W+=3,fe.height=1+h(T,W),W+=3,fe.duration=h(T,W),W+=3,me=T[W++],fe.dispose=1&me,fe.blend=me>>1&1}ge!="ANMF"&&(W+=R)}return A}}(m,0);w.response=m,w.rgbaoutput=!0,w.dataurl=!1;var S=w.header?w.header:null,k=w.frames?w.frames:null;if(S){S.loop_counter=S.loop_count,f=[S.canvas_height],x=[S.canvas_width];for(var F=0;F<k.length&&k[F].blend!=0;F++);}var L=k[0],C=y.WebPDecodeRGBA(m,L.src_off,L.src_size,x,f);L.rgba=C,L.imgwidth=x[0],L.imgheight=f[0];for(var O=0;O<x[0]*f[0]*4;O++)g[O]=C[O];return this.width=x,this.height=f,this.data=g,this}/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */function uY(){var e,t=this.internal.__metadata__.metadata,r=unescape(encodeURIComponent(t));e=this.internal.__metadata__.rawXml?r:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+e.length+" >>"),this.internal.write("stream"),this.internal.write(e),this.internal.write("endstream"),this.internal.write("endobj")}function fY(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(e){var t,r,s,a,i,o,l,c,d,u=function(E){return E=E||{},this.isStrokeTransparent=E.isStrokeTransparent||!1,this.strokeOpacity=E.strokeOpacity||1,this.strokeStyle=E.strokeStyle||"#000000",this.fillStyle=E.fillStyle||"#000000",this.isFillTransparent=E.isFillTransparent||!1,this.fillOpacity=E.fillOpacity||1,this.font=E.font||"10px sans-serif",this.textBaseline=E.textBaseline||"alphabetic",this.textAlign=E.textAlign||"left",this.lineWidth=E.lineWidth||1,this.lineJoin=E.lineJoin||"miter",this.lineCap=E.lineCap||"butt",this.path=E.path||[],this.transform=E.transform!==void 0?E.transform.clone():new c,this.globalCompositeOperation=E.globalCompositeOperation||"normal",this.globalAlpha=E.globalAlpha||1,this.clip_path=E.clip_path||[],this.currentPoint=E.currentPoint||new o,this.miterLimit=E.miterLimit||10,this.lastPoint=E.lastPoint||new o,this.lineDashOffset=E.lineDashOffset||0,this.lineDash=E.lineDash||[],this.margin=E.margin||[0,0,0,0],this.prevPageLastElemOffset=E.prevPageLastElemOffset||0,this.ignoreClearRect=typeof E.ignoreClearRect!="boolean"||E.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new h(this),t=this.internal.f2,r=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,o=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,d=new u}]);var h=function(E){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var U=E;Object.defineProperty(this,"pdf",{get:function(){return U}});var I=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return I},set:function(D){I=!!D}});var M=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return M},set:function(D){M=!!D}});var te=0;Object.defineProperty(this,"posX",{get:function(){return te},set:function(D){isNaN(D)||(te=D)}});var Q=0;Object.defineProperty(this,"posY",{get:function(){return Q},set:function(D){isNaN(D)||(Q=D)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function(D){var Y;typeof D=="number"?Y=[D,D,D,D]:((Y=new Array(4))[0]=D[0],Y[1]=D.length>=2?D[1]:Y[0],Y[2]=D.length>=3?D[2]:Y[0],Y[3]=D.length>=4?D[3]:Y[1]),d.margin=Y}});var G=!1;Object.defineProperty(this,"autoPaging",{get:function(){return G},set:function(D){G=D}});var ne=0;Object.defineProperty(this,"lastBreak",{get:function(){return ne},set:function(D){ne=D}});var z=[];Object.defineProperty(this,"pageBreaks",{get:function(){return z},set:function(D){z=D}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function(D){D instanceof u&&(d=D)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function(D){d.path=D}});var he=[];Object.defineProperty(this,"ctxStack",{get:function(){return he},set:function(D){he=D}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(D){var Y;Y=p(D),this.ctx.fillStyle=Y.style,this.ctx.isFillTransparent=Y.a===0,this.ctx.fillOpacity=Y.a,this.pdf.setFillColor(Y.r,Y.g,Y.b,{a:Y.a}),this.pdf.setTextColor(Y.r,Y.g,Y.b,{a:Y.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(D){var Y=p(D);this.ctx.strokeStyle=Y.style,this.ctx.isStrokeTransparent=Y.a===0,this.ctx.strokeOpacity=Y.a,Y.a===0?this.pdf.setDrawColor(255,255,255):(Y.a,this.pdf.setDrawColor(Y.r,Y.g,Y.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(D){["butt","round","square"].indexOf(D)!==-1&&(this.ctx.lineCap=D,this.pdf.setLineCap(D))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(D){isNaN(D)||(this.ctx.lineWidth=D,this.pdf.setLineWidth(D))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(D){["bevel","round","miter"].indexOf(D)!==-1&&(this.ctx.lineJoin=D,this.pdf.setLineJoin(D))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(D){isNaN(D)||(this.ctx.miterLimit=D,this.pdf.setMiterLimit(D))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(D){this.ctx.textBaseline=D}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(D){["right","end","center","left","start"].indexOf(D)!==-1&&(this.ctx.textAlign=D)}});var X=null,H=null,oe=null;Object.defineProperty(this,"fontFaces",{get:function(){return oe},set:function(D){X=null,H=null,oe=D}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(D){var Y;if(this.ctx.font=D,(Y=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(D))!==null){var le=Y[1];Y[2];var $e=Y[3],je=Y[4];Y[5];var We=Y[6],Ee=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(je)[2];je=Math.floor(Ee==="px"?parseFloat(je)*this.pdf.internal.scaleFactor:Ee==="em"?parseFloat(je)*this.pdf.getFontSize():parseFloat(je)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(je);var Re=function(Me){var Wt,Ct,pr=[],fr=Me.trim();if(fr==="")return Jy;if(fr in Tj)return[Tj[fr]];for(;fr!=="";){switch(Ct=null,Wt=(fr=Fj(fr)).charAt(0)){case'"':case"'":Ct=aY(fr.substring(1),Wt);break;default:Ct=iY(fr)}if(Ct===null||(pr.push(Ct[0]),(fr=Fj(Ct[1]))!==""&&fr.charAt(0)!==","))return Jy;fr=fr.replace(/^,/,"")}return pr}(We);if(this.fontFaces){var Ve=function(Me,Wt){var Ct=Me.getFontList(),pr=JSON.stringify(Ct);if(X===null||H!==pr){var fr=function(Be){var mt=[];return Object.keys(Be).forEach(function(It){Be[It].forEach(function(ft){var gr=null;switch(ft){case"bold":gr={family:It,weight:"bold"};break;case"italic":gr={family:It,style:"italic"};break;case"bolditalic":gr={family:It,weight:"bold",style:"italic"};break;case"":case"normal":gr={family:It}}gr!==null&&(gr.ref={name:It,style:ft},mt.push(gr))})}),mt}(Ct);X=function(Be){for(var mt={},It=0;It<Be.length;++It){var ft=Ky(Be[It]),gr=ft.family,Mr=ft.stretch,$r=ft.style,_r=ft.weight;mt[gr]=mt[gr]||{},mt[gr][Mr]=mt[gr][Mr]||{},mt[gr][Mr][$r]=mt[gr][Mr][$r]||{},mt[gr][Mr][$r][_r]=ft}return mt}(fr.concat(Wt)),H=pr}return X}(this.pdf,this.fontFaces),St=Re.map(function(Me){return{family:Me,stretch:"normal",weight:$e,style:le}}),rt=function(Me,Wt,Ct){for(var pr=(Ct=Ct||{}).defaultFontFamily||"times",fr=Object.assign({},sY,Ct.genericFontFamilies||{}),Be=null,mt=null,It=0;It<Wt.length;++It)if(fr[(Be=Ky(Wt[It])).family]&&(Be.family=fr[Be.family]),Me.hasOwnProperty(Be.family)){mt=Me[Be.family];break}if(!(mt=mt||Me[pr]))throw new Error("Could not find a font-family for the rule '"+Lj(Be)+"' and default family '"+pr+"'.");if(mt=function(ft,gr){if(gr[ft])return gr[ft];var Mr=z2[ft],$r=Mr<=z2.normal?-1:1,_r=Ej(gr,a8,Mr,$r);if(!_r)throw new Error("Could not find a matching font-stretch value for "+ft);return _r}(Be.stretch,mt),mt=function(ft,gr){if(gr[ft])return gr[ft];for(var Mr=s8[ft],$r=0;$r<Mr.length;++$r)if(gr[Mr[$r]])return gr[Mr[$r]];throw new Error("Could not find a matching font-style for "+ft)}(Be.style,mt),!(mt=function(ft,gr){if(gr[ft])return gr[ft];if(ft===400&&gr[500])return gr[500];if(ft===500&&gr[400])return gr[400];var Mr=nY[ft],$r=Ej(gr,i8,Mr,ft<400?-1:1);if(!$r)throw new Error("Could not find a matching font-weight for value "+ft);return $r}(Be.weight,mt)))throw new Error("Failed to resolve a font for the rule '"+Lj(Be)+"'.");return mt}(Ve,St);this.pdf.setFont(rt.ref.name,rt.ref.style)}else{var ze="";($e==="bold"||parseInt($e,10)>=700||le==="bold")&&(ze="bold"),le==="italic"&&(ze+="italic"),ze.length===0&&(ze="normal");for(var Ie="",ot={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},be=0;be<Re.length;be++){if(this.pdf.internal.getFont(Re[be],ze,{noFallback:!0,disableWarning:!0})!==void 0){Ie=Re[be];break}if(ze==="bolditalic"&&this.pdf.internal.getFont(Re[be],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ie=Re[be],ze="bold";else if(this.pdf.internal.getFont(Re[be],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ie=Re[be],ze="normal";break}}if(Ie===""){for(var we=0;we<Re.length;we++)if(ot[Re[we]]){Ie=ot[Re[we]];break}}Ie=Ie===""?"Times":Ie,this.pdf.setFont(Ie,ze)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(D){this.ctx.globalCompositeOperation=D}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(D){this.ctx.globalAlpha=D}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(D){this.ctx.lineDashOffset=D,fe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(D){this.ctx.lineDash=D,fe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(D){this.ctx.ignoreClearRect=!!D}})};h.prototype.setLineDash=function(E){this.lineDash=E},h.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},h.prototype.fill=function(){k.call(this,"fill",!1)},h.prototype.stroke=function(){k.call(this,"stroke",!1)},h.prototype.beginPath=function(){this.path=[{type:"begin"}]},h.prototype.moveTo=function(E,U){if(isNaN(E)||isNaN(U))throw ys.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var I=this.ctx.transform.applyToPoint(new o(E,U));this.path.push({type:"mt",x:I.x,y:I.y}),this.ctx.lastPoint=new o(E,U)},h.prototype.closePath=function(){var E=new o(0,0),U=0;for(U=this.path.length-1;U!==-1;U--)if(this.path[U].type==="begin"&&ds(this.path[U+1])==="object"&&typeof this.path[U+1].x=="number"){E=new o(this.path[U+1].x,this.path[U+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(E.x,E.y)},h.prototype.lineTo=function(E,U){if(isNaN(E)||isNaN(U))throw ys.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var I=this.ctx.transform.applyToPoint(new o(E,U));this.path.push({type:"lt",x:I.x,y:I.y}),this.ctx.lastPoint=new o(I.x,I.y)},h.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),k.call(this,null,!0)},h.prototype.quadraticCurveTo=function(E,U,I,M){if(isNaN(I)||isNaN(M)||isNaN(E)||isNaN(U))throw ys.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var te=this.ctx.transform.applyToPoint(new o(I,M)),Q=this.ctx.transform.applyToPoint(new o(E,U));this.path.push({type:"qct",x1:Q.x,y1:Q.y,x:te.x,y:te.y}),this.ctx.lastPoint=new o(te.x,te.y)},h.prototype.bezierCurveTo=function(E,U,I,M,te,Q){if(isNaN(te)||isNaN(Q)||isNaN(E)||isNaN(U)||isNaN(I)||isNaN(M))throw ys.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var G=this.ctx.transform.applyToPoint(new o(te,Q)),ne=this.ctx.transform.applyToPoint(new o(E,U)),z=this.ctx.transform.applyToPoint(new o(I,M));this.path.push({type:"bct",x1:ne.x,y1:ne.y,x2:z.x,y2:z.y,x:G.x,y:G.y}),this.ctx.lastPoint=new o(G.x,G.y)},h.prototype.arc=function(E,U,I,M,te,Q){if(isNaN(E)||isNaN(U)||isNaN(I)||isNaN(M)||isNaN(te))throw ys.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Q=!!Q,!this.ctx.transform.isIdentity){var G=this.ctx.transform.applyToPoint(new o(E,U));E=G.x,U=G.y;var ne=this.ctx.transform.applyToPoint(new o(0,I)),z=this.ctx.transform.applyToPoint(new o(0,0));I=Math.sqrt(Math.pow(ne.x-z.x,2)+Math.pow(ne.y-z.y,2))}Math.abs(te-M)>=2*Math.PI&&(M=0,te=2*Math.PI),this.path.push({type:"arc",x:E,y:U,radius:I,startAngle:M,endAngle:te,counterclockwise:Q})},h.prototype.arcTo=function(E,U,I,M,te){throw new Error("arcTo not implemented.")},h.prototype.rect=function(E,U,I,M){if(isNaN(E)||isNaN(U)||isNaN(I)||isNaN(M))throw ys.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(E,U),this.lineTo(E+I,U),this.lineTo(E+I,U+M),this.lineTo(E,U+M),this.lineTo(E,U),this.lineTo(E+I,U),this.lineTo(E,U)},h.prototype.fillRect=function(E,U,I,M){if(isNaN(E)||isNaN(U)||isNaN(I)||isNaN(M))throw ys.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!f.call(this)){var te={};this.lineCap!=="butt"&&(te.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(te.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(E,U,I,M),this.fill(),te.hasOwnProperty("lineCap")&&(this.lineCap=te.lineCap),te.hasOwnProperty("lineJoin")&&(this.lineJoin=te.lineJoin)}},h.prototype.strokeRect=function(E,U,I,M){if(isNaN(E)||isNaN(U)||isNaN(I)||isNaN(M))throw ys.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");x.call(this)||(this.beginPath(),this.rect(E,U,I,M),this.stroke())},h.prototype.clearRect=function(E,U,I,M){if(isNaN(E)||isNaN(U)||isNaN(I)||isNaN(M))throw ys.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(E,U,I,M))},h.prototype.save=function(E){E=typeof E!="boolean"||E;for(var U=this.pdf.internal.getCurrentPageInfo().pageNumber,I=0;I<this.pdf.internal.getNumberOfPages();I++)this.pdf.setPage(I+1),this.pdf.internal.out("q");if(this.pdf.setPage(U),E){this.ctx.fontSize=this.pdf.internal.getFontSize();var M=new u(this.ctx);this.ctxStack.push(this.ctx),this.ctx=M}},h.prototype.restore=function(E){E=typeof E!="boolean"||E;for(var U=this.pdf.internal.getCurrentPageInfo().pageNumber,I=0;I<this.pdf.internal.getNumberOfPages();I++)this.pdf.setPage(I+1),this.pdf.internal.out("Q");this.pdf.setPage(U),E&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},h.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var p=function(E){var U,I,M,te;if(E.isCanvasGradient===!0&&(E=E.getColor()),!E)return{r:0,g:0,b:0,a:0,style:E};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(E))U=0,I=0,M=0,te=0;else{var Q=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(E);if(Q!==null)U=parseInt(Q[1]),I=parseInt(Q[2]),M=parseInt(Q[3]),te=1;else if((Q=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(E))!==null)U=parseInt(Q[1]),I=parseInt(Q[2]),M=parseInt(Q[3]),te=parseFloat(Q[4]);else{if(te=1,typeof E=="string"&&E.charAt(0)!=="#"){var G=new KE(E);E=G.ok?G.toHex():"#000000"}E.length===4?(U=E.substring(1,2),U+=U,I=E.substring(2,3),I+=I,M=E.substring(3,4),M+=M):(U=E.substring(1,3),I=E.substring(3,5),M=E.substring(5,7)),U=parseInt(U,16),I=parseInt(I,16),M=parseInt(M,16)}}return{r:U,g:I,b:M,a:te,style:E}},f=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},x=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};h.prototype.fillText=function(E,U,I,M){if(isNaN(U)||isNaN(I)||typeof E!="string")throw ys.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(M=isNaN(M)?void 0:M,!f.call(this)){var te=R(this.ctx.transform.rotation),Q=this.ctx.transform.scaleX;N.call(this,{text:E,x:U,y:I,scale:Q,angle:te,align:this.textAlign,maxWidth:M})}},h.prototype.strokeText=function(E,U,I,M){if(isNaN(U)||isNaN(I)||typeof E!="string")throw ys.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!x.call(this)){M=isNaN(M)?void 0:M;var te=R(this.ctx.transform.rotation),Q=this.ctx.transform.scaleX;N.call(this,{text:E,x:U,y:I,scale:Q,renderingMode:"stroke",angle:te,align:this.textAlign,maxWidth:M})}},h.prototype.measureText=function(E){if(typeof E!="string")throw ys.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var U=this.pdf,I=this.pdf.internal.scaleFactor,M=U.internal.getFontSize(),te=U.getStringUnitWidth(E)*M/U.internal.scaleFactor;return new function(Q){var G=(Q=Q||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return G}}),this}({width:te*=Math.round(96*I/72*1e4)/1e4})},h.prototype.scale=function(E,U){if(isNaN(E)||isNaN(U))throw ys.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var I=new c(E,0,0,U,0,0);this.ctx.transform=this.ctx.transform.multiply(I)},h.prototype.rotate=function(E){if(isNaN(E))throw ys.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var U=new c(Math.cos(E),Math.sin(E),-Math.sin(E),Math.cos(E),0,0);this.ctx.transform=this.ctx.transform.multiply(U)},h.prototype.translate=function(E,U){if(isNaN(E)||isNaN(U))throw ys.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var I=new c(1,0,0,1,E,U);this.ctx.transform=this.ctx.transform.multiply(I)},h.prototype.transform=function(E,U,I,M,te,Q){if(isNaN(E)||isNaN(U)||isNaN(I)||isNaN(M)||isNaN(te)||isNaN(Q))throw ys.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var G=new c(E,U,I,M,te,Q);this.ctx.transform=this.ctx.transform.multiply(G)},h.prototype.setTransform=function(E,U,I,M,te,Q){E=isNaN(E)?1:E,U=isNaN(U)?0:U,I=isNaN(I)?0:I,M=isNaN(M)?1:M,te=isNaN(te)?0:te,Q=isNaN(Q)?0:Q,this.ctx.transform=new c(E,U,I,M,te,Q)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};h.prototype.drawImage=function(E,U,I,M,te,Q,G,ne,z){var he=this.pdf.getImageProperties(E),X=1,H=1,oe=1,D=1;M!==void 0&&ne!==void 0&&(oe=ne/M,D=z/te,X=he.width/M*ne/M,H=he.height/te*z/te),Q===void 0&&(Q=U,G=I,U=0,I=0),M!==void 0&&ne===void 0&&(ne=M,z=te),M===void 0&&ne===void 0&&(ne=he.width,z=he.height);var Y=this.ctx.transform.decompose(),le=R(Y.rotate.shx),$e=new c,je=($e=($e=($e=$e.multiply(Y.translate)).multiply(Y.skew)).multiply(Y.scale)).applyToRectangle(new l(Q-U*oe,G-I*D,M*X,te*H));if(this.autoPaging){for(var We,Ee=y.call(this,je),Re=[],Ve=0;Ve<Ee.length;Ve+=1)Re.indexOf(Ee[Ve])===-1&&Re.push(Ee[Ve]);S(Re);for(var St=Re[0],rt=Re[Re.length-1],ze=St;ze<rt+1;ze++){this.pdf.setPage(ze);var Ie=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ot=ze===1?this.posY+this.margin[0]:this.margin[0],be=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],we=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Me=ze===1?0:be+(ze-2)*we;if(this.ctx.clip_path.length!==0){var Wt=this.path;We=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=w(We,this.posX+this.margin[3],-Me+ot+this.ctx.prevPageLastElemOffset),F.call(this,"fill",!0),this.path=Wt}var Ct=JSON.parse(JSON.stringify(je));Ct=w([Ct],this.posX+this.margin[3],-Me+ot+this.ctx.prevPageLastElemOffset)[0];var pr=(ze>St||ze<rt)&&g.call(this);pr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ie,we,null).clip().discardPath()),this.pdf.addImage(E,"JPEG",Ct.x,Ct.y,Ct.w,Ct.h,null,null,le),pr&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(E,"JPEG",je.x,je.y,je.w,je.h,null,null,le)};var y=function(E,U,I){var M=[];U=U||this.pdf.internal.pageSize.width,I=I||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var te=this.posY+this.ctx.prevPageLastElemOffset;switch(E.type){default:case"mt":case"lt":M.push(Math.floor((E.y+te)/I)+1);break;case"arc":M.push(Math.floor((E.y+te-E.radius)/I)+1),M.push(Math.floor((E.y+te+E.radius)/I)+1);break;case"qct":var Q=q(this.ctx.lastPoint.x,this.ctx.lastPoint.y,E.x1,E.y1,E.x,E.y);M.push(Math.floor((Q.y+te)/I)+1),M.push(Math.floor((Q.y+Q.h+te)/I)+1);break;case"bct":var G=me(this.ctx.lastPoint.x,this.ctx.lastPoint.y,E.x1,E.y1,E.x2,E.y2,E.x,E.y);M.push(Math.floor((G.y+te)/I)+1),M.push(Math.floor((G.y+G.h+te)/I)+1);break;case"rect":M.push(Math.floor((E.y+te)/I)+1),M.push(Math.floor((E.y+E.h+te)/I)+1)}for(var ne=0;ne<M.length;ne+=1)for(;this.pdf.internal.getNumberOfPages()<M[ne];)m.call(this);return M},m=function(){var E=this.fillStyle,U=this.strokeStyle,I=this.font,M=this.lineCap,te=this.lineWidth,Q=this.lineJoin;this.pdf.addPage(),this.fillStyle=E,this.strokeStyle=U,this.font=I,this.lineCap=M,this.lineWidth=te,this.lineJoin=Q},w=function(E,U,I){for(var M=0;M<E.length;M++)switch(E[M].type){case"bct":E[M].x2+=U,E[M].y2+=I;case"qct":E[M].x1+=U,E[M].y1+=I;default:E[M].x+=U,E[M].y+=I}return E},S=function(E){return E.sort(function(U,I){return U-I})},k=function(E,U){var I=this.fillStyle,M=this.strokeStyle,te=this.lineCap,Q=this.lineWidth,G=Math.abs(Q*this.ctx.transform.scaleX),ne=this.lineJoin;if(this.autoPaging){for(var z,he,X=JSON.parse(JSON.stringify(this.path)),H=JSON.parse(JSON.stringify(this.path)),oe=[],D=0;D<H.length;D++)if(H[D].x!==void 0)for(var Y=y.call(this,H[D]),le=0;le<Y.length;le+=1)oe.indexOf(Y[le])===-1&&oe.push(Y[le]);for(var $e=0;$e<oe.length;$e++)for(;this.pdf.internal.getNumberOfPages()<oe[$e];)m.call(this);S(oe);for(var je=oe[0],We=oe[oe.length-1],Ee=je;Ee<We+1;Ee++){this.pdf.setPage(Ee),this.fillStyle=I,this.strokeStyle=M,this.lineCap=te,this.lineWidth=G,this.lineJoin=ne;var Re=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ve=Ee===1?this.posY+this.margin[0]:this.margin[0],St=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],rt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ze=Ee===1?0:St+(Ee-2)*rt;if(this.ctx.clip_path.length!==0){var Ie=this.path;z=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=w(z,this.posX+this.margin[3],-ze+Ve+this.ctx.prevPageLastElemOffset),F.call(this,E,!0),this.path=Ie}if(he=JSON.parse(JSON.stringify(X)),this.path=w(he,this.posX+this.margin[3],-ze+Ve+this.ctx.prevPageLastElemOffset),U===!1||Ee===0){var ot=(Ee>je||Ee<We)&&g.call(this);ot&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Re,rt,null).clip().discardPath()),F.call(this,E,U),ot&&this.pdf.restoreGraphicsState()}this.lineWidth=Q}this.path=X}else this.lineWidth=G,F.call(this,E,U),this.lineWidth=Q},F=function(E,U){if((E!=="stroke"||U||!x.call(this))&&(E==="stroke"||U||!f.call(this))){for(var I,M,te=[],Q=this.path,G=0;G<Q.length;G++){var ne=Q[G];switch(ne.type){case"begin":te.push({begin:!0});break;case"close":te.push({close:!0});break;case"mt":te.push({start:ne,deltas:[],abs:[]});break;case"lt":var z=te.length;if(Q[G-1]&&!isNaN(Q[G-1].x)&&(I=[ne.x-Q[G-1].x,ne.y-Q[G-1].y],z>0)){for(;z>=0;z--)if(te[z-1].close!==!0&&te[z-1].begin!==!0){te[z-1].deltas.push(I),te[z-1].abs.push(ne);break}}break;case"bct":I=[ne.x1-Q[G-1].x,ne.y1-Q[G-1].y,ne.x2-Q[G-1].x,ne.y2-Q[G-1].y,ne.x-Q[G-1].x,ne.y-Q[G-1].y],te[te.length-1].deltas.push(I);break;case"qct":var he=Q[G-1].x+2/3*(ne.x1-Q[G-1].x),X=Q[G-1].y+2/3*(ne.y1-Q[G-1].y),H=ne.x+2/3*(ne.x1-ne.x),oe=ne.y+2/3*(ne.y1-ne.y),D=ne.x,Y=ne.y;I=[he-Q[G-1].x,X-Q[G-1].y,H-Q[G-1].x,oe-Q[G-1].y,D-Q[G-1].x,Y-Q[G-1].y],te[te.length-1].deltas.push(I);break;case"arc":te.push({deltas:[],abs:[],arc:!0}),Array.isArray(te[te.length-1].abs)&&te[te.length-1].abs.push(ne)}}M=U?null:E==="stroke"?"stroke":"fill";for(var le=!1,$e=0;$e<te.length;$e++)if(te[$e].arc)for(var je=te[$e].abs,We=0;We<je.length;We++){var Ee=je[We];Ee.type==="arc"?O.call(this,Ee.x,Ee.y,Ee.radius,Ee.startAngle,Ee.endAngle,Ee.counterclockwise,void 0,U,!le):P.call(this,Ee.x,Ee.y),le=!0}else if(te[$e].close===!0)this.pdf.internal.out("h"),le=!1;else if(te[$e].begin!==!0){var Re=te[$e].start.x,Ve=te[$e].start.y;K.call(this,te[$e].deltas,Re,Ve),le=!0}M&&T.call(this,M),U&&W.call(this)}},L=function(E){var U=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,I=U*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return E-I;case"top":return E+U-I;case"hanging":return E+U-2*I;case"middle":return E+U/2-I;default:return E}},C=function(E){return E+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};h.prototype.createLinearGradient=function(){var E=function(){};return E.colorStops=[],E.addColorStop=function(U,I){this.colorStops.push([U,I])},E.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},E.isCanvasGradient=!0,E},h.prototype.createPattern=function(){return this.createLinearGradient()},h.prototype.createRadialGradient=function(){return this.createLinearGradient()};var O=function(E,U,I,M,te,Q,G,ne,z){for(var he=ge.call(this,I,M,te,Q),X=0;X<he.length;X++){var H=he[X];X===0&&(z?A.call(this,H.x1+E,H.y1+U):P.call(this,H.x1+E,H.y1+U)),re.call(this,E,U,H.x2,H.y2,H.x3,H.y3,H.x4,H.y4)}ne?W.call(this):T.call(this,G)},T=function(E){switch(E){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},W=function(){this.pdf.clip(),this.pdf.discardPath()},A=function(E,U){this.pdf.internal.out(r(E)+" "+s(U)+" m")},N=function(E){var U;switch(E.align){case"right":case"end":U="right";break;case"center":U="center";break;default:U="left"}var I,M,te,Q=this.pdf.getTextDimensions(E.text),G=L.call(this,E.y),ne=C.call(this,G)-Q.h,z=this.ctx.transform.applyToPoint(new o(E.x,G));if(this.autoPaging){var he=this.ctx.transform.decompose(),X=new c;X=(X=(X=X.multiply(he.translate)).multiply(he.skew)).multiply(he.scale);for(var H=this.ctx.transform.applyToRectangle(new l(E.x,G,Q.w,Q.h)),oe=X.applyToRectangle(new l(E.x,ne,Q.w,Q.h)),D=y.call(this,oe),Y=[],le=0;le<D.length;le+=1)Y.indexOf(D[le])===-1&&Y.push(D[le]);S(Y);for(var $e=Y[0],je=Y[Y.length-1],We=$e;We<je+1;We++){this.pdf.setPage(We);var Ee=We===1?this.posY+this.margin[0]:this.margin[0],Re=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ve=this.pdf.internal.pageSize.height-this.margin[2],St=Ve-this.margin[0],rt=this.pdf.internal.pageSize.width-this.margin[1],ze=rt-this.margin[3],Ie=We===1?0:Re+(We-2)*St;if(this.ctx.clip_path.length!==0){var ot=this.path;I=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=w(I,this.posX+this.margin[3],-1*Ie+Ee),F.call(this,"fill",!0),this.path=ot}var be=w([JSON.parse(JSON.stringify(oe))],this.posX+this.margin[3],-Ie+Ee+this.ctx.prevPageLastElemOffset)[0];E.scale>=.01&&(M=this.pdf.internal.getFontSize(),this.pdf.setFontSize(M*E.scale),te=this.lineWidth,this.lineWidth=te*E.scale);var we=this.autoPaging!=="text";if(we||be.y+be.h<=Ve){if(we||be.y>=Ee&&be.x<=rt){var Me=we?E.text:this.pdf.splitTextToSize(E.text,E.maxWidth||rt-be.x)[0],Wt=w([JSON.parse(JSON.stringify(H))],this.posX+this.margin[3],-Ie+Ee+this.ctx.prevPageLastElemOffset)[0],Ct=we&&(We>$e||We<je)&&g.call(this);Ct&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ze,St,null).clip().discardPath()),this.pdf.text(Me,Wt.x,Wt.y,{angle:E.angle,align:U,renderingMode:E.renderingMode}),Ct&&this.pdf.restoreGraphicsState()}}else be.y<Ve&&(this.ctx.prevPageLastElemOffset+=Ve-be.y);E.scale>=.01&&(this.pdf.setFontSize(M),this.lineWidth=te)}}else E.scale>=.01&&(M=this.pdf.internal.getFontSize(),this.pdf.setFontSize(M*E.scale),te=this.lineWidth,this.lineWidth=te*E.scale),this.pdf.text(E.text,z.x+this.posX,z.y+this.posY,{angle:E.angle,align:U,renderingMode:E.renderingMode,maxWidth:E.maxWidth}),E.scale>=.01&&(this.pdf.setFontSize(M),this.lineWidth=te)},P=function(E,U,I,M){I=I||0,M=M||0,this.pdf.internal.out(r(E+I)+" "+s(U+M)+" l")},K=function(E,U,I){return this.pdf.lines(E,U,I,null,null)},re=function(E,U,I,M,te,Q,G,ne){this.pdf.internal.out([t(a(I+E)),t(i(M+U)),t(a(te+E)),t(i(Q+U)),t(a(G+E)),t(i(ne+U)),"c"].join(" "))},ge=function(E,U,I,M){for(var te=2*Math.PI,Q=Math.PI/2;U>I;)U-=te;var G=Math.abs(I-U);G<te&&M&&(G=te-G);for(var ne=[],z=M?-1:1,he=U;G>1e-5;){var X=he+z*Math.min(G,Q);ne.push(Fe.call(this,E,he,X)),G-=Math.abs(X-he),he=X}return ne},Fe=function(E,U,I){var M=(I-U)/2,te=E*Math.cos(M),Q=E*Math.sin(M),G=te,ne=-Q,z=G*G+ne*ne,he=z+G*te+ne*Q,X=4/3*(Math.sqrt(2*z*he)-he)/(G*Q-ne*te),H=G-X*ne,oe=ne+X*G,D=H,Y=-oe,le=M+U,$e=Math.cos(le),je=Math.sin(le);return{x1:E*Math.cos(U),y1:E*Math.sin(U),x2:H*$e-oe*je,y2:H*je+oe*$e,x3:D*$e-Y*je,y3:D*je+Y*$e,x4:E*Math.cos(I),y4:E*Math.sin(I)}},R=function(E){return 180*E/Math.PI},q=function(E,U,I,M,te,Q){var G=E+.5*(I-E),ne=U+.5*(M-U),z=te+.5*(I-te),he=Q+.5*(M-Q),X=Math.min(E,te,G,z),H=Math.max(E,te,G,z),oe=Math.min(U,Q,ne,he),D=Math.max(U,Q,ne,he);return new l(X,oe,H-X,D-oe)},me=function(E,U,I,M,te,Q,G,ne){var z,he,X,H,oe,D,Y,le,$e,je,We,Ee,Re,Ve,St=I-E,rt=M-U,ze=te-I,Ie=Q-M,ot=G-te,be=ne-Q;for(he=0;he<41;he++)$e=(Y=(X=E+(z=he/40)*St)+z*((oe=I+z*ze)-X))+z*(oe+z*(te+z*ot-oe)-Y),je=(le=(H=U+z*rt)+z*((D=M+z*Ie)-H))+z*(D+z*(Q+z*be-D)-le),he==0?(We=$e,Ee=je,Re=$e,Ve=je):(We=Math.min(We,$e),Ee=Math.min(Ee,je),Re=Math.max(Re,$e),Ve=Math.max(Ve,je));return new l(Math.round(We),Math.round(Ee),Math.round(Re-We),Math.round(Ve-Ee))},fe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var E,U,I=(E=this.ctx.lineDash,U=this.ctx.lineDashOffset,JSON.stringify({lineDash:E,lineDashOffset:U}));this.prevLineDash!==I&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=I)}}})(un.API),function(e){var t=function(o){var l,c,d,u,h,p,f,x,g,y;for(c=[],d=0,u=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;u>d;d+=4)(h=(o.charCodeAt(d)<<24)+(o.charCodeAt(d+1)<<16)+(o.charCodeAt(d+2)<<8)+o.charCodeAt(d+3))!==0?(p=(h=((h=((h=((h=(h-(y=h%85))/85)-(g=h%85))/85)-(x=h%85))/85)-(f=h%85))/85)%85,c.push(p+33,f+33,x+33,g+33,y+33)):c.push(122);return function(m,w){for(var S=w;S>0;S--)m.pop()}(c,l.length),String.fromCharCode.apply(String,c)+"~>"},r=function(o){var l,c,d,u,h,p=String,f="length",x=255,g="charCodeAt",y="slice",m="replace";for(o[y](-2),o=o[y](0,-2)[m](/\s/g,"")[m]("z","!!!!!"),d=[],u=0,h=(o+=l="uuuuu"[y](o[f]%5||5))[f];h>u;u+=5)c=52200625*(o[g](u)-33)+614125*(o[g](u+1)-33)+7225*(o[g](u+2)-33)+85*(o[g](u+3)-33)+(o[g](u+4)-33),d.push(x&c>>24,x&c>>16,x&c>>8,x&c);return function(w,S){for(var k=S;k>0;k--)w.pop()}(d,l[f]),p.fromCharCode.apply(p,d)},s=function(o){return o.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},a=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var c="",d=0;d<o.length;d+=2)c+=String.fromCharCode("0x"+(o[d]+o[d+1]));return c},i=function(o){for(var l=new Uint8Array(o.length),c=o.length;c--;)l[c]=o.charCodeAt(c);return(l=P2(l)).reduce(function(d,u){return d+String.fromCharCode(u)},"")};e.processDataByFilters=function(o,l){var c=0,d=o||"",u=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":d=r(d),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=t(d),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=a(d),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=s(d),u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=i(d),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:d,reverseChain:u.reverse().join(" ")}}}(un.API),function(e){e.loadFile=function(t,r,s){return function(a,i,o){i=i!==!1,o=typeof o=="function"?o:function(){};var l=void 0;try{l=function(c,d,u){var h=new XMLHttpRequest,p=0,f=function(x){var g=x.length,y=[],m=String.fromCharCode;for(p=0;p<g;p+=1)y.push(m(255&x.charCodeAt(p)));return y.join("")};if(h.open("GET",c,!d),h.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(h.onload=function(){h.status===200?u(f(this.responseText)):u(void 0)}),h.send(null),d&&h.status===200)return f(h.responseText)}(a,i,o)}catch{}return l}(t,r,s)},e.allowFsRead=void 0,e.loadImageFile=e.loadFile}(un.API),function(e){function t(){return(jn.html2canvas?Promise.resolve(jn.html2canvas):Wf(()=>import("./html2canvas.esm-CBrSDip1.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function r(){return(jn.DOMPurify?Promise.resolve(jn.DOMPurify):Wf(()=>import("./purify.es-B9ZVCkUG.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var s=function(l){var c=ds(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},a=function(l,c){var d=document.createElement(l);for(var u in c.className&&(d.className=c.className),c.innerHTML&&c.dompurify&&(d.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)d.style[u]=c.style[u];return d},i=function l(c,d){for(var u=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),h=c.firstChild;h;h=h.nextSibling)d!==!0&&h.nodeType===1&&h.nodeName==="SCRIPT"||u.appendChild(l(h,d));return c.nodeType===1&&(c.nodeName==="CANVAS"?(u.width=c.width,u.height=c.height,u.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(u.value=c.value),u.addEventListener("load",function(){u.scrollTop=c.scrollTop,u.scrollLeft=c.scrollLeft},!0)),u},o=function l(c){var d=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),u=l.convert(Promise.resolve(),d);return(u=u.setProgress(1,l,1,[l])).set(c)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,c){return l.__proto__=c||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,c){return this.then(function(){switch(c=c||function(d){switch(s(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(l),c){case"string":return this.then(r).then(function(d){return this.set({src:a("div",{innerHTML:l,dompurify:d})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=i(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,c(this.prop.container,d)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=this.opt.jsPDF,u=this.opt.fontFaces,h=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,p=Object.assign({async:!0,allowTaint:!0,scale:h,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete p.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=u,u)for(var f=0;f<u.length;++f){var x=u[f],g=x.src.find(function(y){return y.format==="truetype"});g&&d.addFont(g.url,x.ref.name,x.ref.style)}return p.windowHeight=p.windowHeight||0,p.windowHeight=p.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):p.windowHeight,d.context2d.save(!0),c(this.prop.container,p)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,c,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},o.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(s(l)!=="object")return this;var c=Object.keys(l||{}).map(function(d){if(d in o.template.prop)return function(){this.prop[d]=l[d]};switch(d){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[d]=l[d]}}},this);return this.then(function(){return this.thenList(c)})},o.prototype.get=function(l,c){return this.then(function(){var d=l in o.template.prop?this.prop[l]:this.opt[l];return c?c(d):d})},o.prototype.setMargin=function(l){return this.then(function(){switch(s(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function c(d,u){return Math.floor(d*u/72*96)}return this.then(function(){(l=l||un.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,c,d,u){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),d!=null&&(this.progress.n=d),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,c,d,u){return this.setProgress(l?this.progress.val+l:null,c||null,d?this.progress.n+d:null,u?this.progress.stack.concat(u):null)},o.prototype.then=function(l,c){var d=this;return this.thenCore(l,c,function(u,h){return d.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,function(p){return d.updateProgress(null,u),p}).then(u,h).then(function(p){return d.updateProgress(1),p})})},o.prototype.thenCore=function(l,c,d){d=d||Promise.prototype.then;var u=this;l&&(l=l.bind(u)),c&&(c=c.bind(u));var h=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?u:o.convert(Object.assign({},u),Promise.prototype),p=d.call(h,l,c);return o.convert(p,u.__proto__)},o.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},o.prototype.thenList=function(l){var c=this;return l.forEach(function(d){c=c.thenCore(d)}),c},o.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return o.convert(c,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,un.getPageSize=function(l,c,d){if(ds(l)==="object"){var u=l;l=u.orientation,c=u.unit||c,d=u.format||d}c=c||"mm",d=d||"a4",l=(""+(l||"P")).toLowerCase();var h,p=(""+d).toLowerCase(),f={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":h=1;break;case"mm":h=72/25.4;break;case"cm":h=72/2.54;break;case"in":h=72;break;case"px":h=.75;break;case"pc":case"em":h=12;break;case"ex":h=6;break;default:throw"Invalid unit: "+c}var x,g=0,y=0;if(f.hasOwnProperty(p))g=f[p][1]/h,y=f[p][0]/h;else try{g=d[1],y=d[0]}catch{throw new Error("Invalid format: "+d)}if(l==="p"||l==="portrait")l="p",y>g&&(x=y,y=g,g=x);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",g>y&&(x=y,y=g,g=x)}return{width:y,height:g,unit:c,k:h,orientation:l}},e.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(Ky):null;var d=new o(c);return c.worker?d:d.from(l).doCallback()}}(un.API),un.API.addJS=function(e){var t,r,s=e;return this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(t+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),r=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+s+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){t!==void 0&&r!==void 0&&this.internal.out("/Names <</JavaScript "+t+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,s=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=r.outline.render().split(/\r\n/),i=0;i<a.length;i++){var o=a[i],l=s.exec(o);if(l!=null){var c=l[1];r.internal.newObjectDeferredBegin(c,!1)}r.internal.write(o)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,u=[];for(i=0;i<d;i++){var h=r.internal.newObject();u.push(h);var p=r.internal.getPageInfo(i+1);r.internal.write("<< /D["+p.objId+" 0 R /XYZ null null null]>> endobj")}var f=r.internal.newObject();for(r.internal.write("<< /Names [ "),i=0;i<u.length;i++)r.internal.write("(page_"+(i+1)+")"+u[i]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+f+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var r=this;r.outline.root.children.length>0&&(r.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&r.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(s,a,i){var o={title:a,options:i,children:[]};return s==null&&(s=this.root),s.children.push(o),o},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(s){s.id=r.internal.newObjectDeferred();for(var a=0;a<s.children.length;a++)this.genIds_r(s.children[a])},r.outline.renderRoot=function(s){this.objStart(s),this.line("/Type /Outlines"),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1]))),this.line("/Count "+this.count_r({count:0},s)),this.objEnd()},r.outline.renderItems=function(s){for(var a=this.ctx.pdf.internal.getVerticalCoordinateString,i=0;i<s.children.length;i++){var o=s.children[i];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(s)),i>0&&this.line("/Prev "+this.makeRef(s.children[i-1])),i<s.children.length-1&&this.line("/Next "+this.makeRef(s.children[i+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var l=this.count=this.count_r({count:0},o);if(l>0&&this.line("/Count "+l),o.options&&o.options.pageNumber){var c=r.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+a(0)+" 0]")}this.objEnd()}for(var d=0;d<s.children.length;d++)this.renderItems(s.children[d])},r.outline.line=function(s){this.ctx.val+=s+`\r
`},r.outline.makeRef=function(s){return s.id+" 0 R"},r.outline.makeString=function(s){return"("+r.internal.pdfEscape(s)+")"},r.outline.objStart=function(s){this.ctx.val+=`\r
`+s.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(s,a){for(var i=0;i<a.children.length;i++)s.count++,this.count_r(s,a.children[i]);return s.count}}])}(un.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,s,a,i,o,l){var c,d=this.decode.DCT_DECODE,u=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=o||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,c=function(h){for(var p,f=256*h.charCodeAt(4)+h.charCodeAt(5),x=h.length,g={width:0,height:0,numcomponents:1},y=4;y<x;y+=2){if(y+=f,t.indexOf(h.charCodeAt(y+1))!==-1){p=256*h.charCodeAt(y+5)+h.charCodeAt(y+6),g={width:256*h.charCodeAt(y+7)+h.charCodeAt(y+8),height:p,numcomponents:h.charCodeAt(y+9)};break}f=256*h.charCodeAt(y+2)+h.charCodeAt(y+3)}return g}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}u={data:r,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:d,index:s,alias:a}}return u}}(un.API),un.API.processPNG=function(e,t,r,s){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var a,i=zX(e,{checkCrc:!0}),o=i.width,l=i.height,c=i.channels,d=i.palette,u=i.depth;a=d&&c===1?function(O){for(var T=O.width,W=O.height,A=O.data,N=O.palette,P=O.depth,K=!1,re=[],ge=[],Fe=void 0,R=!1,q=0,me=0;me<N.length;me++){var fe=Ik(N[me],4),E=fe[0],U=fe[1],I=fe[2],M=fe[3];re.push(E,U,I),M!=null&&(M===0?(q++,ge.length<1&&ge.push(me)):M<255&&(R=!0))}if(R||q>1){K=!0,ge=void 0;var te=T*W;Fe=new Uint8Array(te);for(var Q=new DataView(A.buffer),G=0;G<te;G++){var ne=Zy(Q,G,P),z=Ik(N[ne],4)[3];Fe[G]=z}}else q===0&&(ge=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:K?8:void 0,colorBytes:A,alphaBytes:Fe,needSMask:K,palette:re,mask:ge}}(i):c===2||c===4?function(O){for(var T=O.data,W=O.width,A=O.height,N=O.channels,P=O.depth,K=N===2?"DeviceGray":"DeviceRGB",re=N-1,ge=W*A,Fe=re,R=ge*Fe,q=1*ge,me=Math.ceil(R*P/8),fe=Math.ceil(q*P/8),E=new Uint8Array(me),U=new Uint8Array(fe),I=new DataView(T.buffer),M=new DataView(E.buffer),te=new DataView(U.buffer),Q=!1,G=0;G<ge;G++){for(var ne=G*N,z=0;z<Fe;z++)$j(M,Zy(I,ne+z,P),G*Fe+z,P);var he=Zy(I,ne+Fe,P);he<(1<<P)-1&&(Q=!0),$j(te,he,1*G,P)}return{colorSpace:K,colorsPerPixel:re,sMaskBitsPerComponent:Q?P:void 0,colorBytes:E,alphaBytes:U,needSMask:Q}}(i):function(O){var T=O.data,W=O.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:W,colorsPerPixel:W==="DeviceGray"?1:3,colorBytes:T instanceof Uint16Array?function(A){for(var N=A.length,P=new Uint8Array(2*N),K=new DataView(P.buffer,P.byteOffset,P.byteLength),re=0;re<N;re++)K.setUint16(2*re,A[re],!1);return P}(T):T,needSMask:!1}}(i);var h,p,f,x=a,g=x.colorSpace,y=x.colorsPerPixel,m=x.sMaskBitsPerComponent,w=x.colorBytes,S=x.alphaBytes,k=x.needSMask,F=x.palette,L=x.mask,C=null;return s!==un.API.image_compression.NONE&&typeof P2=="function"?(C=function(O){var T;switch(O){case un.API.image_compression.FAST:T=11;break;case un.API.image_compression.MEDIUM:T=13;break;case un.API.image_compression.SLOW:T=14;break;default:T=12}return T}(s),h=this.decode.FLATE_DECODE,p="/Predictor ".concat(C," /Colors ").concat(y," /BitsPerComponent ").concat(u," /Columns ").concat(o),e=Pj(w,Math.ceil(o*y*u/8),y,u,s),k&&(f=Pj(S,Math.ceil(o*m/8),1,m,s))):(h=void 0,p=void 0,e=w,k&&(f=S)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(f&&this.__addimage__.isArrayBuffer(f)||this.__addimage__.isArrayBufferView(f))&&(f=this.__addimage__.arrayBufferToBinaryString(f)),{alias:r,data:e,index:t,filter:h,decodeParameters:p,transparency:L,palette:F,sMask:f,predictor:C,width:o,height:l,bitsPerComponent:u,sMaskBitsPerComponent:m,colorSpace:g}}},function(e){e.processGIF89A=function(t,r,s,a){var i=new dY(t),o=i.width,l=i.height,c=[];i.decodeAndBlitFrameRGBA(0,c);var d={data:c,width:o,height:l},u=new eb(100).encode(d,100);return e.processJPEG.call(this,u,r,s,a)},e.processGIF87A=e.processGIF89A}(un.API),al.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:a,green:s,blue:r,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},al.prototype.parseBGR=function(){this.pos=this.offset;var e="bit"+this.bitPP,t=this.width*this.height*4;if(t>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(t);try{this[e]()}catch(r){ys.log("bit decode error:"+r)}},al.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var s=this.bottom_up?e:this.height-1-e,a=0;a<t;a++)for(var i=this.datav.getUint8(this.pos++,!0),o=s*this.width*4+8*a*4,l=0;l<8&&8*a+l<this.width;l++){var c=this.palette[i>>7-l&1];this.data[o+4*l]=c.blue,this.data[o+4*l+1]=c.green,this.data[o+4*l+2]=c.red,this.data[o+4*l+3]=255}r!==0&&(this.pos+=4-r)}},al.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var s=this.bottom_up?r:this.height-1-r,a=0;a<e;a++){var i=this.datav.getUint8(this.pos++,!0),o=s*this.width*4+2*a*4,l=i>>4,c=15&i,d=this.palette[l];if(this.data[o]=d.blue,this.data[o+1]=d.green,this.data[o+2]=d.red,this.data[o+3]=255,2*a+1>=this.width)break;d=this.palette[c],this.data[o+4]=d.blue,this.data[o+4+1]=d.green,this.data[o+4+2]=d.red,this.data[o+4+3]=255}t!==0&&(this.pos+=4-t)}},al.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,s=0;s<this.width;s++){var a=this.datav.getUint8(this.pos++,!0),i=r*this.width*4+4*s;if(a<this.palette.length){var o=this.palette[a];this.data[i]=o.red,this.data[i+1]=o.green,this.data[i+2]=o.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}e!==0&&(this.pos+=4-e)}},al.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var s=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(i&t)/t*255|0,l=(i>>5&t)/t*255|0,c=(i>>10&t)/t*255|0,d=i>>15?255:0,u=s*this.width*4+4*a;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=o,this.data[u+3]=d}this.pos+=e}},al.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),s=this.height-1;s>=0;s--){for(var a=this.bottom_up?s:this.height-1-s,i=0;i<this.width;i++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&t)/t*255|0,c=(o>>5&r)/r*255|0,d=(o>>11)/t*255|0,u=a*this.width*4+4*i;this.data[u]=d,this.data[u+1]=c,this.data[u+2]=l,this.data[u+3]=255}this.pos+=e}},al.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*r;this.data[o]=i,this.data[o+1]=a,this.data[o+2]=s,this.data[o+3]=255}this.pos+=this.width%4}},al.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*r;this.data[l]=i,this.data[l+1]=a,this.data[l+2]=s,this.data[l+3]=o}},al.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,s,a){var i=new al(t,!1),o=i.width,l=i.height,c={data:i.getData(),width:o,height:l},d=new eb(100).encode(c,100);return e.processJPEG.call(this,d,r,s,a)}}(un.API),zj.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,s,a){var i=new zj(t),o=i.width,l=i.height,c={data:i.getData(),width:o,height:l},d=new eb(100).encode(c,100);return e.processJPEG.call(this,d,r,s,a)}}(un.API),un.API.processRGBA=function(e,t,r){for(var s=e.data,a=s.length,i=new Uint8Array(a/4*3),o=new Uint8Array(a/4),l=0,c=0,d=0;d<a;d+=4){var u=s[d],h=s[d+1],p=s[d+2],f=s[d+3];i[l++]=u,i[l++]=h,i[l++]=p,o[c++]=f}var x=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:x,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},un.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},tf=un.API,Ym=tf.getCharWidthsArray=function(e,t){var r,s,a=(t=t||{}).font||this.internal.getFont(),i=t.fontSize||this.internal.getFontSize(),o=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:a.metadata.Unicode.widths,c=l.fof?l.fof:1,d=t.kerning?t.kerning:a.metadata.Unicode.kerning,u=d.fof?d.fof:1,h=t.doKerning!==!1,p=0,f=e.length,x=0,g=l[0]||c,y=[];for(r=0;r<f;r++)s=e.charCodeAt(r),typeof a.metadata.widthOfString=="function"?y.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(s))+o*(1e3/i)||0)/1e3):(p=h&&ds(d[s])==="object"&&!isNaN(parseInt(d[s][x],10))?d[s][x]/u:0,y.push((l[s]||g)/c+p)),x=s;return y},Mj=tf.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),s=t.font||this.internal.getFont(),a=t.charSpace||this.internal.getCharSpace();return tf.processArabic&&(e=tf.processArabic(e)),typeof s.metadata.widthOfString=="function"?s.metadata.widthOfString(e,r,a)/r:Ym.apply(this,arguments).reduce(function(i,o){return i+o},0)},Rj=function(e,t,r,s){for(var a=[],i=0,o=e.length,l=0;i!==o&&l+t[i]<r;)l+=t[i],i++;a.push(e.slice(0,i));var c=i;for(l=0;i!==o;)l+t[i]>s&&(a.push(e.slice(c,i)),l=0,c=i),l+=t[i],i++;return c!==i&&a.push(e.slice(c,i)),a},Bj=function(e,t,r){r||(r={});var s,a,i,o,l,c,d,u=[],h=[u],p=r.textIndent||0,f=0,x=0,g=e.split(" "),y=Ym.apply(this,[" ",r])[0];if(c=r.lineIndent===-1?g[0].length+2:r.lineIndent||0){var m=Array(c).join(" "),w=[];g.map(function(k){(k=k.split(/\s*\n/)).length>1?w=w.concat(k.map(function(F,L){return(L&&F.length?`
`:"")+F})):w.push(k[0])}),g=w,c=Mj.apply(this,[m,r])}for(i=0,o=g.length;i<o;i++){var S=0;if(s=g[i],c&&s[0]==`
`&&(s=s.substr(1),S=1),p+f+(x=(a=Ym.apply(this,[s,r])).reduce(function(k,F){return k+F},0))>t||S){if(x>t){for(l=Rj.apply(this,[s,a,t-(p+f),t]),u.push(l.shift()),u=[l.pop()];l.length;)h.push([l.shift()]);x=a.slice(s.length-(u[0]?u[0].length:0)).reduce(function(k,F){return k+F},0)}else u=[s];h.push(u),p=x+c,f=y}else u.push(s),p+=f+x,f=y}return d=c?function(k,F){return(F?m:"")+k.join(" ")}:function(k){return k.join(" ")},h.map(d)},tf.splitTextToSize=function(e,t,r){var s,a=(r=r||{}).fontSize||this.internal.getFontSize(),i=(function(u){if(u.widths&&u.kerning)return{widths:u.widths,kerning:u.kerning};var h=this.internal.getFont(u.fontName,u.fontStyle),p="Unicode";return h.metadata[p]?{widths:h.metadata[p].widths||{0:1},kerning:h.metadata[p].kerning||{}}:{font:h.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);s=Array.isArray(e)?e:String(e).split(/\r?\n/);var o=1*this.internal.scaleFactor*t/a;i.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/a:0,i.lineIndent=r.lineIndent;var l,c,d=[];for(l=0,c=s.length;l<c;l++)d=d.concat(Bj.apply(this,[s[l],o,i]));return d},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",r="klmnopqrstuvwxyz",s={},a={},i=0;i<16;i++)s[r[i]]=t[i],a[t[i]]=r[i];var o=function(p){return"0x"+parseInt(p,10).toString(16)},l=e.__fontmetrics__.compress=function(p){var f,x,g,y,m=["{"];for(var w in p){if(f=p[w],isNaN(parseInt(w,10))?x="'"+w+"'":(w=parseInt(w,10),x=(x=o(w).slice(2)).slice(0,-1)+a[x.slice(-1)]),typeof f=="number")f<0?(g=o(f).slice(3),y="-"):(g=o(f).slice(2),y=""),g=y+g.slice(0,-1)+a[g.slice(-1)];else{if(ds(f)!=="object")throw new Error("Don't know what to do with value type "+ds(f)+".");g=l(f)}m.push(x+g)}return m.push("}"),m.join("")},c=e.__fontmetrics__.uncompress=function(p){if(typeof p!="string")throw new Error("Invalid argument passed to uncompress.");for(var f,x,g,y,m={},w=1,S=m,k=[],F="",L="",C=p.length-1,O=1;O<C;O+=1)(y=p[O])=="'"?f?(g=f.join(""),f=void 0):f=[]:f?f.push(y):y=="{"?(k.push([S,g]),S={},g=void 0):y=="}"?((x=k.pop())[0][x[1]]=S,g=void 0,S=x[0]):y=="-"?w=-1:g===void 0?s.hasOwnProperty(y)?(F+=s[y],g=parseInt(F,16)*w,w=1,F=""):F+=y:s.hasOwnProperty(y)?(L+=s[y],S[g]=parseInt(L,16)*w,w=1,g=void 0,L=""):L+=y;return m},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},h={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(p){var f=p.font,x=h.Unicode[f.postScriptName];x&&(f.metadata.Unicode={},f.metadata.Unicode.widths=x.widths,f.metadata.Unicode.kerning=x.kerning);var g=u.Unicode[f.postScriptName];g&&(f.metadata.Unicode.encoding=g,f.encoding=g.codePages[0])}])}(un.API),function(e){var t=function(r){for(var s=r.length,a=new Uint8Array(s),i=0;i<s;i++)a[i]=r.charCodeAt(i);return a};e.API.events.push(["addFont",function(r){var s=void 0,a=r.font,i=r.instance;if(!a.isStandardFont){if(i===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if(typeof(s=i.existsFileInVFS(a.postScriptName)===!1?i.loadFile(a.postScriptName):i.getFileFromVFS(a.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");(function(o,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(Tx(l)),o.metadata=e.API.TTFFont.open(l),o.metadata.Unicode=o.metadata.Unicode||{encoding:{},kerning:{},widths:[]},o.metadata.glyIdsUsed=[0]})(a,s)}}])}(un),un.API.addSvgAsImage=function(e,t,r,s,a,i,o,l){if(isNaN(t)||isNaN(r))throw ys.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw ys.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=s,c.height=a;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},h=this;return(jn.canvg?Promise.resolve(jn.canvg):Wf(()=>import("./index.es-DjsqX6WJ.js"),[])).catch(function(p){return Promise.reject(new Error("Could not load canvg: "+p))}).then(function(p){return p.default?p.default:p}).then(function(p){return p.fromString(d,e,u)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(p){return p.render(u)}).then(function(){h.addImage(c.toDataURL("image/jpeg",1),t,r,s,a,o,l)})},un.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var s=1;s<=this.internal.getNumberOfPages();s++)for(var a=0;a<this.internal.pages[s].length;a++)this.internal.pages[s][a]=this.internal.pages[s][a].replace(t,r);return this},un.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var s,a,i,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(o),c=[],d=0,u=0,h=0;function p(x,g){var y,m=!1;for(y=0;y<x.length;y+=1)x[y]===g&&(m=!0);return m}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var f=l.length;for(h=0;h<f;h+=1)r[l[h]].value=r[l[h]].defaultValue,r[l[h]].explicitSet=!1}if(ds(e)==="object"){for(a in e)if(i=e[a],p(l,a)&&i!==void 0){if(r[a].type==="boolean"&&typeof i=="boolean")r[a].value=i;else if(r[a].type==="name"&&p(r[a].valueSet,i))r[a].value=i;else if(r[a].type==="integer"&&Number.isInteger(i))r[a].value=i;else if(r[a].type==="array"){for(d=0;d<i.length;d+=1)if(s=!0,i[d].length===1&&typeof i[d][0]=="number")c.push(String(i[d]-1));else if(i[d].length>1){for(u=0;u<i[d].length;u+=1)typeof i[d][u]!="number"&&(s=!1);s===!0&&c.push([i[d][0]-1,i[d][1]-1].join(" "))}r[a].value="["+c.join(" ")+"]"}else r[a].value=r[a].defaultValue;r[a].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var x,g=[];for(x in r)r[x].explicitSet===!0&&(r[x].type==="name"?g.push("/"+x+" /"+r[x].value):g.push("/"+x+" "+r[x].value));g.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+g.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},un.API.addMetadata=function(e,t){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:e,namespaceUri:t??"http://jspdf.default.namespaceuri/",rawXml:typeof t=="boolean"&&t},this.internal.events.subscribe("putCatalog",fY),this.internal.events.subscribe("postPutResources",uY)),this},function(e){var t=e.API,r=t.pdfEscape16=function(i,o){for(var l,c=o.metadata.Unicode.widths,d=["","0","00","000","0000"],u=[""],h=0,p=i.length;h<p;++h){if(l=o.metadata.characterToGlyph(i.charCodeAt(h)),o.metadata.glyIdsUsed.push(l),o.metadata.toUnicode[l]=i.charCodeAt(h),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(o.metadata.widthOfGlyph(l),10)])),l=="0")return u.join("");l=l.toString(16),u.push(d[4-l.length],l)}return u.join("")},s=function(i){var o,l,c,d,u,h,p;for(u=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],h=0,p=(l=Object.keys(i).sort(function(f,x){return f-x})).length;h<p;h++)o=l[h],c.length>=100&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),i[o]!==void 0&&i[o]!==null&&typeof i[o].toString=="function"&&(d=("0000"+i[o].toString(16)).slice(-4),o=("0000"+(+o).toString(16)).slice(-4),c.push("<"+o+"><"+d+">"));return c.length&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),u+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(i){(function(o){var l=o.font,c=o.out,d=o.newObject,u=o.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="Identity-H"){for(var h=l.metadata.Unicode.widths,p=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),f="",x=0;x<p.length;x++)f+=String.fromCharCode(p[x]);var g=d();u({data:f,addLength1:!0,objectId:g}),c("endobj");var y=d();u({data:s(l.metadata.toUnicode),addLength1:!0,objectId:y}),c("endobj");var m=d();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+xf(l.fontName)),c("/FontFile2 "+g+" 0 R"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var w=d();c("<<"),c("/Type /Font"),c("/BaseFont /"+xf(l.fontName)),c("/FontDescriptor "+m+" 0 R"),c("/W "+e.API.PDFObject.convert(h)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=d(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+y+" 0 R"),c("/BaseFont /"+xf(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+w+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(i)}]),t.events.push(["putFont",function(i){(function(o){var l=o.font,c=o.out,d=o.newObject,u=o.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var h=l.metadata.rawData,p="",f=0;f<h.length;f++)p+=String.fromCharCode(h[f]);var x=d();u({data:p,addLength1:!0,objectId:x}),c("endobj");var g=d();u({data:s(l.metadata.toUnicode),addLength1:!0,objectId:g}),c("endobj");var y=d();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+x+" 0 R"),c("/Flags 96"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+xf(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=d();for(var m=0;m<l.metadata.hmtx.widths.length;m++)l.metadata.hmtx.widths[m]=parseInt(l.metadata.hmtx.widths[m]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+g+" 0 R/BaseFont/"+xf(l.fontName)+"/FontDescriptor "+y+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(i)}]);var a=function(i){var o,l=i.text||"",c=i.x,d=i.y,u=i.options||{},h=i.mutex||{},p=h.pdfEscape,f=h.activeFontKey,x=h.fonts,g=f,y="",m=0,w="",S=x[g].encoding;if(x[g].encoding!=="Identity-H")return{text:l,x:c,y:d,options:u,mutex:h};for(w=l,g=f,Array.isArray(l)&&(w=l[0]),m=0;m<w.length;m+=1)x[g].metadata.hasOwnProperty("cmap")&&(o=x[g].metadata.cmap.unicode.codeMap[w[m].charCodeAt(0)]),o||w[m].charCodeAt(0)<256&&x[g].metadata.hasOwnProperty("Unicode")?y+=w[m]:y+="";var k="";return parseInt(g.slice(1))<14||S==="WinAnsiEncoding"?k=p(y,g).split("").map(function(F){return F.charCodeAt(0).toString(16)}).join(""):S==="Identity-H"&&(k=r(y,x[g])),h.isHex=!0,{text:k,x:c,y:d,options:u,mutex:h}};t.events.push(["postProcessText",function(i){var o=i.text||"",l=[],c={text:o,x:i.x,y:i.y,options:i.options,mutex:i.mutex};if(Array.isArray(o)){var d=0;for(d=0;d<o.length;d+=1)Array.isArray(o[d])&&o[d].length===3?l.push([a(Object.assign({},c,{text:o[d][0]})).text,o[d][1],o[d][2]]):l.push(a(Object.assign({},c,{text:o[d]})).text);i.text=l}else i.text=a(Object.assign({},c,{text:o})).text}])}(un),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,s){return t.call(this),this.internal.vFS[r]=s,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(un.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(s){var a,i,o,l,c,d,u,h=t,p=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],f=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],x={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},g={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},y=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],m=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),w=!1,S=0;this.__bidiEngine__={};var k=function(A){var N=A.charCodeAt(),P=N>>8,K=g[P];return K!==void 0?h[256*K+(255&N)]:P===252||P===253?"AL":m.test(P)?"L":P===8?"R":"N"},F=function(A){for(var N,P=0;P<A.length;P++){if((N=k(A.charAt(P)))==="L")return!1;if(N==="R")return!0}return!1},L=function(A,N,P,K){var re,ge,Fe,R,q=N[K];switch(q){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":w=!1;break;case"N":case"AN":break;case"EN":w&&(q="AN");break;case"AL":w=!0,q="R";break;case"WS":case"BN":q="N";break;case"CS":K<1||K+1>=N.length||(re=P[K-1])!=="EN"&&re!=="AN"||(ge=N[K+1])!=="EN"&&ge!=="AN"?q="N":w&&(ge="AN"),q=ge===re?ge:"N";break;case"ES":q=(re=K>0?P[K-1]:"B")==="EN"&&K+1<N.length&&N[K+1]==="EN"?"EN":"N";break;case"ET":if(K>0&&P[K-1]==="EN"){q="EN";break}if(w){q="N";break}for(Fe=K+1,R=N.length;Fe<R&&N[Fe]==="ET";)Fe++;q=Fe<R&&N[Fe]==="EN"?"EN":"N";break;case"NSM":if(o&&!l){for(R=N.length,Fe=K+1;Fe<R&&N[Fe]==="NSM";)Fe++;if(Fe<R){var me=A[K],fe=me>=1425&&me<=2303||me===64286;if(re=N[Fe],fe&&(re==="R"||re==="AL")){q="R";break}}}q=K<1||(re=N[K-1])==="B"?"N":P[K-1];break;case"B":w=!1,a=!0,q=S;break;case"S":i=!0,q="N"}return q},C=function(A,N,P){var K=A.split("");return P&&O(K,P,{hiLevel:S}),K.reverse(),N&&N.reverse(),K.join("")},O=function(A,N,P){var K,re,ge,Fe,R,q=-1,me=A.length,fe=0,E=[],U=S?f:p,I=[];for(w=!1,a=!1,i=!1,re=0;re<me;re++)I[re]=k(A[re]);for(ge=0;ge<me;ge++){if(R=fe,E[ge]=L(A,I,E,ge),K=240&(fe=U[R][x[E[ge]]]),fe&=15,N[ge]=Fe=U[fe][5],K>0)if(K===16){for(re=q;re<ge;re++)N[re]=1;q=-1}else q=-1;if(U[fe][6])q===-1&&(q=ge);else if(q>-1){for(re=q;re<ge;re++)N[re]=Fe;q=-1}I[ge]==="B"&&(N[ge]=0),P.hiLevel|=Fe}i&&function(M,te,Q){for(var G=0;G<Q;G++)if(M[G]==="S"){te[G]=S;for(var ne=G-1;ne>=0&&M[ne]==="WS";ne--)te[ne]=S}}(I,N,me)},T=function(A,N,P,K,re){if(!(re.hiLevel<A)){if(A===1&&S===1&&!a)return N.reverse(),void(P&&P.reverse());for(var ge,Fe,R,q,me=N.length,fe=0;fe<me;){if(K[fe]>=A){for(R=fe+1;R<me&&K[R]>=A;)R++;for(q=fe,Fe=R-1;q<Fe;q++,Fe--)ge=N[q],N[q]=N[Fe],N[Fe]=ge,P&&(ge=P[q],P[q]=P[Fe],P[Fe]=ge);fe=R}fe++}}},W=function(A,N,P){var K=A.split(""),re={hiLevel:S};return P||(P=[]),O(K,P,re),function(ge,Fe,R){if(R.hiLevel!==0&&u)for(var q,me=0;me<ge.length;me++)Fe[me]===1&&(q=y.indexOf(ge[me]))>=0&&(ge[me]=y[q+1])}(K,P,re),T(2,K,N,P,re),T(1,K,N,P,re),K.join("")};return this.__bidiEngine__.doBidiReorder=function(A,N,P){if(function(re,ge){if(ge)for(var Fe=0;Fe<re.length;Fe++)ge[Fe]=Fe;l===void 0&&(l=F(re)),d===void 0&&(d=F(re))}(A,N),o||!c||d)if(o&&c&&l^d)S=l?1:0,A=C(A,N,P);else if(!o&&c&&d)S=l?1:0,A=W(A,N,P),A=C(A,N);else if(!o||l||c||d){if(o&&!c&&l^d)A=C(A,N),l?(S=0,A=W(A,N,P)):(S=1,A=W(A,N,P),A=C(A,N));else if(o&&l&&!c&&d)S=1,A=W(A,N,P),A=C(A,N);else if(!o&&!c&&l^d){var K=u;l?(S=1,A=W(A,N,P),S=0,u=!1,A=W(A,N,P),u=K):(S=0,A=W(A,N,P),A=C(A,N),S=1,u=!1,A=W(A,N,P),u=K,A=C(A,N))}}else S=0,A=W(A,N,P);else S=l?1:0,A=W(A,N,P);return A},this.__bidiEngine__.setOptions=function(A){A&&(o=A.isInputVisual,c=A.isOutputVisual,l=A.isInputRtl,d=A.isOutputRtl,u=A.isSymmetricSwapping)},this.__bidiEngine__.setOptions(s),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(s){var a=s.text;s.x,s.y;var i=s.options||{};s.mutex,i.lang;var o=[];if(i.isInputVisual=typeof i.isInputVisual!="boolean"||i.isInputVisual,r.setOptions(i),Object.prototype.toString.call(a)==="[object Array]"){var l=0;for(o=[],l=0;l<a.length;l+=1)Object.prototype.toString.call(a[l])==="[object Array]"?o.push([r.doBidiReorder(a[l][0]),a[l][1],a[l][2]]):o.push([r.doBidiReorder(a[l])]);s.text=o}else s.text=r.doBidiReorder(a);r.setOptions({isInputVisual:!0})}])}(un),un.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new Ed(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new AY(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new hY(this.contents),this.head=new mY(this),this.name=new vY(this),this.cmap=new l8(this),this.toUnicode={},this.hhea=new xY(this),this.maxp=new wY(this),this.hmtx=new SY(this),this.post=new yY(this),this.os2=new gY(this),this.loca=new NY(this),this.glyf=new _Y(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,s,a,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var o,l,c,d;for(d=[],o=0,l=(c=this.bbox).length;o<l;o++)t=c[o],d.push(Math.round(t*this.scaleFactor));return d}).call(this),this.stemV=0,this.post.exists?(s=255&(a=this.post.italic_angle),32768&(r=a>>16)&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+s)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(i=this.familyClass)===1||i===2||i===3||i===4||i===5||i===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,s){var a,i,o,l;for(o=0,i=0,l=(t=""+t).length;0<=l?i<l:i>l;i=0<=l?++i:--i)a=t.charCodeAt(i),o+=this.widthOfGlyph(this.characterToGlyph(a))+s*(1e3/r)||0;return o*(r/1e3)},e.prototype.lineHeight=function(t,r){var s;return r==null&&(r=!1),s=r?this.lineGap:0,(this.ascender+s-this.decender)/1e3*t},e}();var kl,Ed=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,s;for(s=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)s[r]=String.fromCharCode(this.readByte());return s.join("")},e.prototype.writeString=function(t){var r,s,a;for(a=[],r=0,s=t.length;0<=s?r<s:r>s;r=0<=s?++r:--r)a.push(this.writeByte(t.charCodeAt(r)));return a},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,s,a,i,o,l,c;return t=this.readByte(),r=this.readByte(),s=this.readByte(),a=this.readByte(),i=this.readByte(),o=this.readByte(),l=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^s)+4294967296*(255^a)+16777216*(255^i)+65536*(255^o)+256*(255^l)+(255^c)+1):72057594037927940*t+281474976710656*r+1099511627776*s+4294967296*a+16777216*i+65536*o+256*l+c},e.prototype.writeLongLong=function(t){var r,s;return r=Math.floor(t/4294967296),s=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(s>>24&255),this.writeByte(s>>16&255),this.writeByte(s>>8&255),this.writeByte(255&s)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,s;for(r=[],s=0;0<=t?s<t:s>t;s=0<=t?++s:--s)r.push(this.readByte());return r},e.prototype.write=function(t){var r,s,a,i;for(i=[],s=0,a=t.length;s<a;s++)r=t[s],i.push(this.writeByte(r));return i},e}(),hY=function(){var e;function t(r){var s,a,i;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},a=0,i=this.tableCount;0<=i?a<i:a>i;a=0<=i?++a:--a)s={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[s.tag]=s}return t.prototype.encode=function(r){var s,a,i,o,l,c,d,u,h,p,f,x,g;for(g in f=Object.keys(r).length,c=Math.log(2),h=16*Math.floor(Math.log(f)/c),o=Math.floor(h/c),u=16*f-h,(a=new Ed).writeInt(this.scalarType),a.writeShort(f),a.writeShort(h),a.writeShort(o),a.writeShort(u),i=16*f,d=a.pos+i,l=null,x=[],r)for(p=r[g],a.writeString(g),a.writeInt(e(p)),a.writeInt(d),a.writeInt(p.length),x=x.concat(p),g==="head"&&(l=d),d+=p.length;d%4;)x.push(0),d++;return a.write(x),s=2981146554-e(a.data),a.pos=l+8,a.writeUInt32(s),a.data},e=function(r){var s,a,i,o;for(r=c8.call(r);r.length%4;)r.push(0);for(i=new Ed(r),a=0,s=0,o=r.length;s<o;s=s+=4)a+=i.readUInt32();return 4294967295&a},t}(),pY={}.hasOwnProperty,Xl=function(e,t){for(var r in t)pY.call(t,r)&&(e[r]=t[r]);function s(){this.constructor=e}return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e};kl=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var mY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new Ed).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),qj=function(){function e(t,r){var s,a,i,o,l,c,d,u,h,p,f,x,g,y,m,w,S;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),h=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(f=t.readUInt16(),p=f/2,t.pos+=6,i=function(){var k,F;for(F=[],c=k=0;0<=p?k<p:k>p;c=0<=p?++k:--k)F.push(t.readUInt16());return F}(),t.pos+=2,g=function(){var k,F;for(F=[],c=k=0;0<=p?k<p:k>p;c=0<=p?++k:--k)F.push(t.readUInt16());return F}(),d=function(){var k,F;for(F=[],c=k=0;0<=p?k<p:k>p;c=0<=p?++k:--k)F.push(t.readUInt16());return F}(),u=function(){var k,F;for(F=[],c=k=0;0<=p?k<p:k>p;c=0<=p?++k:--k)F.push(t.readUInt16());return F}(),a=(this.length-t.pos+this.offset)/2,l=function(){var k,F;for(F=[],c=k=0;0<=a?k<a:k>a;c=0<=a?++k:--k)F.push(t.readUInt16());return F}(),c=m=0,S=i.length;m<S;c=++m)for(y=i[c],s=w=x=g[c];x<=y?w<=y:w>=y;s=x<=y?++w:--w)u[c]===0?o=s+d[c]:(o=l[u[c]/2+(s-x)-(p-c)]||0)!==0&&(o+=d[c]),this.codeMap[s]=65535&o}t.pos=h}return e.encode=function(t,r){var s,a,i,o,l,c,d,u,h,p,f,x,g,y,m,w,S,k,F,L,C,O,T,W,A,N,P,K,re,ge,Fe,R,q,me,fe,E,U,I,M,te,Q,G,ne,z,he,X;switch(K=new Ed,o=Object.keys(t).sort(function(H,oe){return H-oe}),r){case"macroman":for(g=0,y=function(){var H=[];for(x=0;x<256;++x)H.push(0);return H}(),w={0:0},i={},re=0,q=o.length;re<q;re++)w[ne=t[a=o[re]]]==null&&(w[ne]=++g),i[a]={old:t[a],new:w[t[a]]},y[a]=w[t[a]];return K.writeUInt16(1),K.writeUInt16(0),K.writeUInt32(12),K.writeUInt16(0),K.writeUInt16(262),K.writeUInt16(0),K.write(y),{charMap:i,subtable:K.data,maxGlyphID:g+1};case"unicode":for(N=[],h=[],S=0,w={},s={},m=d=null,ge=0,me=o.length;ge<me;ge++)w[F=t[a=o[ge]]]==null&&(w[F]=++S),s[a]={old:F,new:w[F]},l=w[F]-a,m!=null&&l===d||(m&&h.push(m),N.push(a),d=l),m=a;for(m&&h.push(m),h.push(65535),N.push(65535),W=2*(T=N.length),O=2*Math.pow(Math.log(T)/Math.LN2,2),p=Math.log(O/2)/Math.LN2,C=2*T-O,c=[],L=[],f=[],x=Fe=0,fe=N.length;Fe<fe;x=++Fe){if(A=N[x],u=h[x],A===65535){c.push(0),L.push(0);break}if(A-(P=s[A].new)>=32768)for(c.push(0),L.push(2*(f.length+T-x)),a=R=A;A<=u?R<=u:R>=u;a=A<=u?++R:--R)f.push(s[a].new);else c.push(P-A),L.push(0)}for(K.writeUInt16(3),K.writeUInt16(1),K.writeUInt32(12),K.writeUInt16(4),K.writeUInt16(16+8*T+2*f.length),K.writeUInt16(0),K.writeUInt16(W),K.writeUInt16(O),K.writeUInt16(p),K.writeUInt16(C),Q=0,E=h.length;Q<E;Q++)a=h[Q],K.writeUInt16(a);for(K.writeUInt16(0),G=0,U=N.length;G<U;G++)a=N[G],K.writeUInt16(a);for(z=0,I=c.length;z<I;z++)l=c[z],K.writeUInt16(l);for(he=0,M=L.length;he<M;he++)k=L[he],K.writeUInt16(k);for(X=0,te=f.length;X<te;X++)g=f[X],K.writeUInt16(g);return{charMap:s,subtable:K.data,maxGlyphID:S+1}}},e}(),l8=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,s,a;for(t.pos=this.offset,this.version=t.readUInt16(),a=t.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=a?s<a:s>a;s=0<=a?++s:--s)r=new qj(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var s,a;return r==null&&(r="macroman"),s=qj.encode(t,r),(a=new Ed).writeUInt16(0),a.writeUInt16(1),s.table=a.data.concat(s.subtable),s},e}(),xY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),gY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,s;for(s=[],r=0;r<10;++r)s.push(t.readByte());return s}(),this.charRange=function(){var r,s;for(s=[],r=0;r<4;++r)s.push(t.readInt());return s}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,s;for(s=[],r=0;r<2;r=++r)s.push(t.readInt());return s}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),yY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="post",e.prototype.parse=function(t){var r,s,a;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var i;for(s=t.readUInt16(),this.glyphNameIndex=[],i=0;0<=s?i<s:i>s;i=0<=s?++i:--i)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],a=[];t.pos<this.offset+this.length;)r=t.readByte(),a.push(this.names.push(t.readString(r)));return a;case 151552:return s=t.readUInt16(),this.offsets=t.read(s);case 262144:return this.map=(function(){var o,l,c;for(c=[],i=o=0,l=this.file.maxp.numGlyphs;0<=l?o<l:o>l;i=0<=l?++o:--o)c.push(t.readUInt32());return c}).call(this)}},e}(),bY=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},vY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="name",e.prototype.parse=function(t){var r,s,a,i,o,l,c,d,u,h,p;for(t.pos=this.offset,t.readShort(),r=t.readShort(),l=t.readShort(),s=[],i=0;0<=r?i<r:i>r;i=0<=r?++i:--i)s.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+l+t.readShort()});for(c={},i=u=0,h=s.length;u<h;i=++u)a=s[i],t.pos=a.offset,d=t.readString(a.length),o=new bY(d,a),c[p=a.nameID]==null&&(c[p]=[]),c[a.nameID].push(o);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},e}(),wY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),SY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,s,a,i,o,l,c;for(t.pos=this.offset,this.metrics=[],r=0,l=this.file.hhea.numberOfMetrics;0<=l?r<l:r>l;r=0<=l?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(a=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,u;for(u=[],r=d=0;0<=a?d<a:d>a;r=0<=a?++d:--d)u.push(t.readInt16());return u}(),this.widths=(function(){var d,u,h,p;for(p=[],d=0,u=(h=this.metrics).length;d<u;d++)i=h[d],p.push(i.advance);return p}).call(this),s=this.widths[this.widths.length-1],c=[],r=o=0;0<=a?o<a:o>a;r=0<=a?++o:--o)c.push(this.widths.push(s));return c},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),c8=[].slice,_Y=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,s,a,i,o,l,c,d,u,h;return t in this.cache?this.cache[t]:(i=this.file.loca,r=this.file.contents,s=i.indexOf(t),(a=i.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+s,o=(l=new Ed(r.read(a))).readShort(),d=l.readShort(),h=l.readShort(),c=l.readShort(),u=l.readShort(),this.cache[t]=o===-1?new jY(l,d,h,c,u):new kY(l,o,d,h,c,u),this.cache[t]))},e.prototype.encode=function(t,r,s){var a,i,o,l,c;for(o=[],i=[],l=0,c=r.length;l<c;l++)a=t[r[l]],i.push(o.length),a&&(o=o.concat(a.encode(s)));return i.push(o.length),{table:o,offsets:i}},e}(),kY=function(){function e(t,r,s,a,i,o){this.raw=t,this.numberOfContours=r,this.xMin=s,this.yMin=a,this.xMax=i,this.yMax=o,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),jY=function(){function e(t,r,s,a,i){var o,l;for(this.raw=t,this.xMin=r,this.yMin=s,this.xMax=a,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],o=this.raw;l=o.readShort(),this.glyphOffsets.push(o.pos),this.glyphIDs.push(o.readUInt16()),32&l;)o.pos+=1&l?4:2,128&l?o.pos+=8:64&l?o.pos+=4:8&l&&(o.pos+=2)}return e.prototype.encode=function(){var t,r,s;for(r=new Ed(c8.call(this.raw.data)),t=0,s=this.glyphIDs.length;t<s;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),NY=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Xl(e,kl),e.prototype.tag="loca",e.prototype.parse=function(t){var r,s;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var a,i;for(i=[],s=0,a=this.length;s<a;s+=2)i.push(2*t.readUInt16());return i}).call(this):(function(){var a,i;for(i=[],s=0,a=this.length;s<a;s+=4)i.push(t.readUInt32());return i}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var s=new Uint32Array(this.offsets.length),a=0,i=0,o=0;o<s.length;++o)if(s[o]=a,i<r.length&&r[i]==o){++i,s[o]=a;var l=this.offsets[o],c=this.offsets[o+1]-l;c>0&&(a+=c)}for(var d=new Array(4*s.length),u=0;u<s.length;++u)d[4*u+3]=255&s[u],d[4*u+2]=(65280&s[u])>>8,d[4*u+1]=(16711680&s[u])>>16,d[4*u]=(4278190080&s[u])>>24;return d},e}(),AY=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,s,a,i;for(r in a=this.font.cmap.tables[0].codeMap,t={},i=this.subset)s=i[r],t[r]=a[s];return t},e.prototype.glyphsFor=function(t){var r,s,a,i,o,l,c;for(a={},o=0,l=t.length;o<l;o++)a[i=t[o]]=this.font.glyf.glyphFor(i);for(i in r=[],a)(s=a[i])!=null&&s.compound&&r.push.apply(r,s.glyphIDs);if(r.length>0)for(i in c=this.glyphsFor(r))s=c[i],a[i]=s;return a},e.prototype.encode=function(t,r){var s,a,i,o,l,c,d,u,h,p,f,x,g,y,m;for(a in s=l8.encode(this.generateCmap(),"unicode"),o=this.glyphsFor(t),f={0:0},m=s.charMap)f[(c=m[a]).old]=c.new;for(x in p=s.maxGlyphID,o)x in f||(f[x]=p++);return u=function(w){var S,k;for(S in k={},w)k[w[S]]=S;return k}(f),h=Object.keys(u).sort(function(w,S){return w-S}),g=function(){var w,S,k;for(k=[],w=0,S=h.length;w<S;w++)l=h[w],k.push(u[l]);return k}(),i=this.font.glyf.encode(o,g,f),d=this.font.loca.encode(i.offsets,g),y={cmap:this.font.cmap.raw(),glyf:i.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(y["OS/2"]=this.font.os2.raw()),this.font.directory.encode(y)},e}();un.API.PDFObject=function(){var e;function t(){}return e=function(r,s){return(Array(s+1).join("0")+r).slice(-s)},t.convert=function(r){var s,a,i,o;if(Array.isArray(r))return"["+function(){var l,c,d;for(d=[],l=0,c=r.length;l<c;l++)s=r[l],d.push(t.convert(s));return d}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r!=null&&r.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(a in i=["<<"],r)o=r[a],i.push("/"+a+" "+t.convert(o));return i.push(">>"),i.join(`
`)}return""+r},t}();const CY="/assets/logo-BRcnjZP7.jpg",EY="K RAMAKRISHNAN COLLEGE OF TECHNOLOGY, Autonomous";function d8(e){return String(e||"").trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_-]/g,"").slice(0,64)}function Km(e,t,r){const s=String(t??"");if(!s)return"";if(e.getTextWidth(s)<=r)return s;const a="",i=e.getTextWidth(a);if(i>=r)return"";let o=0,l=s.length;for(;o<l;){const c=Math.ceil((o+l)/2),d=s.slice(0,c);e.getTextWidth(d)+i<=r?o=c:l=c-1}return s.slice(0,Math.max(0,o))+a}function Hj(e,t){const r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=e,s.click(),setTimeout(()=>URL.revokeObjectURL(r),500)}async function TY(){var e;try{const t=await hr("/api/accounts/me/",{method:"GET"});if(!t.ok)return"";const r=await t.json(),s=String((r==null?void 0:r.username)||"").trim(),a=String(((e=r==null?void 0:r.profile)==null?void 0:e.staff_id)||"").trim();return s||a||""}catch{return""}}function u8(e){const t=String(e.collegeName||EY).trim(),r=String(e.courseName||"").trim(),s=String(e.courseCode||"").trim(),a=String(e.staffName||"").trim(),i=String(e.className||"").trim();return[t,`Course Name: ${r||"-"}`,`Course Code: ${s||"-"}`,`Staff Name: ${a||"-"}`,`Class Name: ${i||"-"}`]}function LY(e,t){const r=u8(e),s=["S.No","Reg No","Name","Total"],a=t.map(i=>[i.sno,i.regNo,i.name,i.total]);return[...r.map(i=>[i,"","",""]),[""],[s[0],s[1],s[2],s[3]],...a]}function FY(e,t,r){const a=gi.book_new(),i=[];for(let l=0;l<r.length;l+=45)i.push(r.slice(l,l+45));i.length===0&&i.push([]),i.forEach((l,c)=>{const d=gi.aoa_to_sheet(LY(t,l));d["!freeze"]={xSplit:0,ySplit:7},d["!cols"]=[{wch:6},{wch:16},{wch:34},{wch:12}],gi.book_append_sheet(a,d,i.length>1?`Page_${c+1}`:"Sheet1")});const o=`${d8(e)||"marks"}_totals.xlsx`;vg(a,o)}function MY(e,t){if(e.availableH=Math.max(60,e.bottomY-e.tableTopY),t.length<=1){e.colsNeeded=1,e.rowsPerCol=Math.max(1,t.length),e.colW=e.availableW;return}e.colsNeeded=2,e.colW=(e.availableW-e.colGap)/2;const r=Math.max(1,Math.ceil(t.length/2)),s=()=>e.headerRowH+r*e.rowH<=e.availableH;let a=0;for(;a++<30&&!s()&&e.rowH>6;)e.tableFont=Math.max(5,e.tableFont-.25),e.rowH=Math.max(6,e.rowH-1),e.headerRowH=Math.max(9,e.headerRowH-1);e.rowsPerCol=r}function Vj(e,t,r){const s=new un({orientation:e,unit:"pt",format:"a4"}),a=s.internal.pageSize.getWidth(),i=s.internal.pageSize.getHeight(),o=32,l=34,c=i-28,d=a-o*2,u=12,h=l,p=Math.max(60,c-h);let f=8,x=12,g=14;const y=10,m=()=>{const C=Math.max(1,Math.floor((p-g)/x)),O=Math.max(1,Math.ceil(r.length/C)),T=(d-y*(O-1))/O;return{rowsPerCol:C,colsNeeded:O,colW:T}};let{rowsPerCol:w,colsNeeded:S,colW:k}=m();const F=150;let L=0;for(;L++<12&&k<F&&S>1;)f=Math.max(6,f-.5),x=Math.max(9,x-1),g=Math.max(11,g-1),{rowsPerCol:w,colsNeeded:S,colW:k}=m();return{doc:s,marginX:o,topY:l,bottomY:c,tableTopY:h,availableW:d,availableH:p,tableFont:f,headerFont:u,rowH:x,headerRowH:g,colGap:y,colsNeeded:S,rowsPerCol:w,colW:k}}function RY(e,t,r,s){const a=t.tableTopY,i={sno:.12,reg:.3,name:.43,total:.15},o=t.colW*i.sno,l=t.colW*i.reg,c=t.colW*i.name,d=t.colW*i.total,u=3;e.setFontSize(t.tableFont);const h=[17,24,39],p=[255,255,255],f=[180,180,180];for(let x=0;x<t.colsNeeded;x++){const g=t.marginX+x*(t.colW+t.colGap);let y=a;e.setFillColor(h[0],h[1],h[2]),e.rect(g,y,t.colW,t.headerRowH,"F"),e.setTextColor(p[0],p[1],p[2]);const m=y+t.headerRowH-4;e.text("S.No",g+u,m),e.text("Reg No",g+o+u,m),e.text("Name",g+o+l+u,m),e.text("Total",g+o+l+c+u,m),e.setDrawColor(f[0],f[1],f[2]),e.rect(g,y,t.colW,t.headerRowH),e.line(g+o,y,g+o,y+t.headerRowH),e.line(g+o+l,y,g+o+l,y+t.headerRowH),e.line(g+o+l+c,y,g+o+l+c,y+t.headerRowH),y+=t.headerRowH,e.setTextColor(0,0,0);const w=x*t.rowsPerCol,S=Math.min(s.length,w+t.rowsPerCol);for(let k=w;k<S;k++){const F=s[k],L=y+(k-w)*t.rowH;e.rect(g,L,t.colW,t.rowH),e.line(g+o,L,g+o,L+t.rowH),e.line(g+o+l,L,g+o+l,L+t.rowH),e.line(g+o+l+c,L,g+o+l+c,L+t.rowH);const C=L+t.rowH-3,O=Km(e,String((F==null?void 0:F.sno)??""),Math.max(0,o-u*2)),T=Km(e,String((F==null?void 0:F.regNo)??""),Math.max(0,l-u*2)),W=Km(e,String((F==null?void 0:F.name)??""),Math.max(0,c-u*2)),A=Km(e,String((F==null?void 0:F.total)??""),Math.max(0,d-u*2));e.text(O,g+u,C),e.text(T,g+o+u,C),e.text(W,g+o+l+u,C),e.text(A,g+o+l+c+u,C)}}}async function BY(e){try{const t=await fetch(e,{cache:"no-cache"});if(!t.ok)return null;const r=await t.blob();return await new Promise(s=>{const a=new FileReader;a.onload=()=>s(String(a.result||"")),a.onerror=()=>s(null),a.readAsDataURL(r)})}catch{return null}}async function PY(e,t,r,s){const a=String((r==null?void 0:r.bannerUrl)||CY),i=(r==null?void 0:r.bannerUrl)||a,o=await BY(i),l=s.length>=55;let c=0;if(o)try{const p=new Image;p.src=o,await new Promise(C=>{p.onload=()=>C(!0),p.onerror=()=>C(!0)});const f=p.naturalWidth||p.width||1,x=p.naturalHeight||p.height||1,g=t.doc.internal.pageSize.getWidth(),y=l?135:170,m=g-2*t.marginX,w=f/x;let S=m,k=S/w;k>y&&(k=y,S=k*w);const F=(g-S)/2,L=12;t.doc.addImage(o,"PNG",F,L,S,k),c=k,t.tableTopY=L+k+(l?10:14)}catch{}else t.tableTopY=t.topY;const d=t.tableTopY;e.setFontSize(l?8:9),e.setTextColor(0,0,0);const u=[];r.courseName&&u.push(`Course Name: ${r.courseName}`),r.courseCode&&u.push(`Course Code: ${r.courseCode}`),r.staffName&&u.push(`Staff Name: ${r.staffName}`),r.className&&u.push(`Class Name: ${r.className}`);const h=l?10:11;for(let p=0;p<u.length;p++)e.text(u[p],t.marginX,d+p*h);return t.tableTopY=d+u.length*h+(l?6:10),MY(t,s),RY(e,t,r,s)}async function tb(e,t,r){const s=Vj("portrait",t,r),i=s.colsNeeded>=4?Vj("landscape",t,r):s;await PY(i.doc,i,t,r);const o=i.doc.output("blob"),l=`${d8(e)||"marks"}_totals.pdf`;return{blob:o,filename:l}}function OY(e,t,r){e.innerHTML="";const s=u8(t),a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.gap="2px",a.style.marginBottom="10px",s.forEach(u=>{const h=document.createElement("div");h.textContent=u,h.style.fontWeight=u===s[0]?"900":"700",h.style.fontSize=u===s[0]?"14px":"12px",a.appendChild(h)}),e.appendChild(a);const i=document.createElement("div");i.className="obe-table-wrapper",i.style.maxHeight="420px",i.style.overflow="auto";const o=document.createElement("table");o.className="obe-table",o.style.minWidth="unset";const l=document.createElement("thead"),c=document.createElement("tr");["S.No","Reg No","Name","Total"].forEach(u=>{const h=document.createElement("th");h.textContent=u,c.appendChild(h)}),l.appendChild(c),o.appendChild(l);const d=document.createElement("tbody");r.forEach(u=>{const h=document.createElement("tr");[u.sno,u.regNo,u.name,u.total].forEach(p=>{const f=document.createElement("td");f.textContent=String(p??""),h.appendChild(f)}),d.appendChild(h)}),o.appendChild(d),i.appendChild(o),e.appendChild(i)}function IY(e,t){e.innerHTML="";const r=URL.createObjectURL(t),s=document.createElement("iframe");return s.src=r,s.style.width="100%",s.style.height="520px",s.style.border="1px solid rgba(226,232,240,0.9)",s.style.borderRadius="10px",e.appendChild(s),()=>URL.revokeObjectURL(r)}async function DY(e){if(typeof document>"u"||typeof window>"u"){const{blob:k,filename:F}=await tb(e.filenameBase,e.meta,e.rows);Hj(F,k);return}const t=document.createElement("div");t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.style.position="fixed",t.style.inset="0",t.style.background="rgba(0,0,0,0.35)",t.style.display="grid",t.style.placeItems="center",t.style.padding="16px",t.style.zIndex="9999";const r=document.createElement("div");r.className="obe-card",r.style.width="min(980px, 100%)",r.style.maxHeight="min(92vh, 900px)",r.style.overflow="auto";const s=document.createElement("div");s.textContent="Preview totals before download",s.style.fontWeight="950",s.style.fontSize="14px",s.style.marginBottom="10px";const a=document.createElement("div");a.style.display="flex",a.style.gap="8px",a.style.flexWrap="wrap",a.style.alignItems="center",a.style.justifyContent="space-between",a.style.marginBottom="10px";const i=document.createElement("div");i.style.display="flex",i.style.gap="8px",i.style.flexWrap="wrap";const o=document.createElement("button");o.className="obe-btn obe-btn-secondary",o.textContent="Excel preview";const l=document.createElement("button");l.className="obe-btn obe-btn-primary",l.textContent="PDF preview",i.appendChild(o),i.appendChild(l);const c=document.createElement("div");c.style.display="flex",c.style.gap="8px",c.style.flexWrap="wrap";const d=document.createElement("button");d.className="obe-btn",d.textContent="Close";const u=document.createElement("button");u.className="obe-btn obe-btn-success",u.textContent="Download",c.appendChild(d),c.appendChild(u),a.appendChild(i),a.appendChild(c);const h=document.createElement("div");r.appendChild(s),r.appendChild(a),r.appendChild(h),t.appendChild(r);let p="pdf",f=null,x=null;const g=()=>{o.className=p==="excel"?"obe-btn obe-btn-primary":"obe-btn obe-btn-secondary",l.className=p==="pdf"?"obe-btn obe-btn-primary":"obe-btn obe-btn-secondary"},y=async()=>{if(f&&(f(),f=null),h.innerHTML="",g(),p==="excel"){x=null,OY(h,e.meta,e.rows);return}x=await tb(e.filenameBase,e.meta,e.rows),f=IY(h,x.blob)};let m=!1;const w=()=>{if(!m){m=!0,f&&f();try{window.removeEventListener("keydown",S),t.remove()}catch{}}},S=k=>{k.key==="Escape"&&w()};t.addEventListener("click",k=>{k.target===t&&w()}),d.addEventListener("click",w),o.addEventListener("click",()=>{p="excel",y()}),l.addEventListener("click",()=>{p="pdf",y()}),u.addEventListener("click",async()=>{if(p==="excel"){FY(e.filenameBase,e.meta,e.rows);return}const k=x||await tb(e.filenameBase,e.meta,e.rows);Hj(k.filename,k.blob)}),window.addEventListener("keydown",S),document.body.appendChild(t),y()}async function Qp(e){const t={...e.meta};t.staffName||(t.staffName=await TY());const r=(e.rows||[]).filter(s=>s&&s.regNo);await DY({filenameBase:e.filenameBase,meta:t,rows:r})}const rb={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Gj=[{key:"q1",label:"Q1",max:2,co:1,btl:1},{key:"q2",label:"Q2",max:2,co:1,btl:3},{key:"q3",label:"Q3",max:2,co:1,btl:4},{key:"q4",label:"Q4",max:2,co:2,btl:1},{key:"q5",label:"Q5",max:2,co:2,btl:1},{key:"q6",label:"Q6",max:2,co:2,btl:2},{key:"q7",label:"Q7",max:16,co:1,btl:2},{key:"q8",label:"Q8",max:16,co:2,btl:3},{key:"q9",label:"Q9",max:16,co:"1&2",btl:5}];function Qj(e){if(e==="both")return"both";if(e==="1&2"||e==="3&4")return e;if(typeof e=="string"){const r=e.trim();if(r==="1&2"||r==="1,2"||r==="1/2"||r==="2/1")return"1&2";if(r==="3&4"||r==="3,4"||r==="3/4"||r==="4/3")return"3&4";if(r==="5")return 5;if(r==="4")return 4;if(r==="3")return 3;if(r==="2")return 2;if(r==="1")return 1}if(Array.isArray(e)){const r=e.map(s=>Number(s)).filter(s=>Number.isFinite(s));if(r.includes(3)&&r.includes(4))return"3&4";if(r.includes(1)&&r.includes(2))return"1&2";if(r.includes(4))return 4;if(r.includes(3))return 3;if(r.includes(2))return 2;if(r.includes(1))return 1}const t=Number(e);return t===5?5:t===4?4:t===3?3:t===2?2:t===34?"3&4":t===12?"1&2":1}function UY(e){return e==="cia2"?{a:3,b:4}:{a:1,b:2}}function q2(e){return e==="both"||e==="1&2"||e==="3&4"}function $Y(e,t){if(q2(e))return{a:.5,b:.5};const r=t.a===3,s=e===t.a||r&&e===1,a=e===t.b||r&&e===2;return s?{a:1,b:0}:a?{a:0,b:1}:{a:0,b:0}}function Jm(e,t,r){const s=e[t];if(!s)return{a:0,b:0};if(q2(s.co))return{a:.5,b:.5};const a=e.some(l=>q2(l.co)),i=t===e.length-1,o=String(s.key||"").toLowerCase()==="q9"||String(s.label||"").toLowerCase().includes("q9");return!a&&i&&o?{a:.5,b:.5}:$Y(s.co,r)}function qd(e){return Object.fromEntries((e||[]).map(t=>[t.key,t.btl]))}function ic(e,t,r){return Math.max(t,Math.min(r,e))}function oc(e,t){if(!t)return"-";const r=e/t*100;if(!Number.isFinite(r))return"-";const s=r.toFixed(1);return s.endsWith(".0")?s.slice(0,-2):s}function Zm(e,t){return`${e}_sheet_${t}`}function WY(e,t){if(!t.length)return;const r=Object.keys(t[0]),s=[r.join(",")].concat(t.map(l=>r.map(c=>{const d=l[c],u=String(d??"").replace(/\n/g," ");return u.includes(",")||u.includes('"')?`"${u.replace(/"/g,'""')}"`:u}).join(","))).join(`
`),a=new Blob([s],{type:"text/csv"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function f8({subjectId:e,teachingAssignmentId:t,assessmentKey:r,classType:s,questionPaperType:a}){const i=r||"cia1",o=i==="cia2"?"CIA 2":"CIA 1",l=v.useMemo(()=>UY(i),[i]),[c,d]=v.useState(null),[u,h]=v.useState(null),[p,f]=v.useState(null),[x,g]=v.useState(null),y=v.useMemo(()=>{const V=String(On(s)||"").trim().toUpperCase();return V?V==="THEORY"?"THEORY":V:""},[s]),m=v.useMemo(()=>{const V=String(a??"").trim().toUpperCase();return V==="QP2"?"QP2":V==="QP1"?"QP1":""},[a]);v.useEffect(()=>{let V=!0;return(async()=>{var jt,cr;if(!y){f(null);return}const _e=y==="THEORY"&&m||null,Je=i==="cia2"?"CIA2":"CIA1";let Nt=null,Bt=[];try{Nt=await op({class_type:y,question_paper_type:_e,exam:Je}),Bt=Array.isArray((jt=Nt==null?void 0:Nt.pattern)==null?void 0:jt.marks)?Nt.pattern.marks:[]}catch{}if(!Bt.length)try{Nt=await op({class_type:y,question_paper_type:_e,exam:"CIA"}),Bt=Array.isArray((cr=Nt==null?void 0:Nt.pattern)==null?void 0:cr.marks)?Nt.pattern.marks:[]}catch{}V&&f(Bt.length?Nt.pattern:null)})(),()=>{V=!1}},[y,m,i]);const w=v.useMemo(()=>{var Nt,Bt,jt,cr;const V=((Bt=(Nt=c==null?void 0:c.assessments)==null?void 0:Nt[i])==null?void 0:Bt.questions)??((cr=(jt=c==null?void 0:c.assessments)==null?void 0:jt.cia1)==null?void 0:cr.questions),ie=Array.isArray(V)&&V.length?V.map(sr=>({key:String((sr==null?void 0:sr.key)||""),label:String((sr==null?void 0:sr.label)||(sr==null?void 0:sr.key)||""),max:Number((sr==null?void 0:sr.max)||0),co:Qj(sr==null?void 0:sr.co),btl:Math.min(6,Math.max(1,Number((sr==null?void 0:sr.btl)||1)))})).filter(sr=>sr.key):Gj,_e=Array.isArray(p==null?void 0:p.marks)?p.marks:null,Je=Array.isArray(p==null?void 0:p.cos)?p.cos:null;return Array.isArray(_e)&&_e.length?_e.map((sr,Fr)=>{const Nr=ie[Fr],Pt=Je?Je[Fr]:void 0;return{key:`q${Fr+1}`,label:`Q${Fr+1}`,max:Number(sr)||0,co:Pt!=null?Qj(Pt):(Nr==null?void 0:Nr.co)??l.a,btl:(Nr==null?void 0:Nr.btl)??1}}).filter(sr=>!!sr.key):ie},[c,i,p,l.a]),[S,k]=v.useState(!1),[F,L]=v.useState(!1),[C,O]=v.useState(!1),[T,W]=v.useState(null),[A,N]=v.useState([]),[P,K]=v.useState({}),[re,ge]=v.useState(null),[Fe,R]=v.useState(null),[q,me]=v.useState(!1),[fe,E]=v.useState(!1),[U,I]=v.useState(null),[M,te]=v.useState(null),Q=v.useRef(null),[G,ne]=v.useState(!1),[z,he]=v.useState(""),[X,H]=v.useState(!1),[oe,D]=v.useState(null),[Y,le]=v.useState(!1),[$e,je]=v.useState(null),[We,Ee]=v.useState(null),{data:Re,loading:Ve,error:St,remainingSeconds:rt,publishAllowed:ze,refresh:Ie}=Ru({assessment:i,subjectCode:e,teachingAssignmentId:t}),ot=!!(Re!=null&&Re.global_override_active&&(Re==null?void 0:Re.global_is_open)===!1),{data:be,refresh:we}=Bu({assessment:i,subjectCode:String(e||""),teachingAssignmentId:t,options:{poll:!1}}),{data:Me}=Xo({assessment:i,subjectCode:String(e||""),scope:"MARK_MANAGER",teachingAssignmentId:t,options:{poll:!1}}),{data:Wt}=Xo({assessment:i,subjectCode:String(e||""),scope:"MARK_ENTRY",teachingAssignmentId:t,options:{poll:!1}}),[Ct,pr]=v.useState(""),[fr,Be]=v.useState(!1),[mt,It]=v.useState(null),[ft,gr]=v.useState({termLabel:"KRCT AY25-26",batchLabel:e,questionBtl:qd(Gj),rowsByStudentId:{},markManagerLocked:!1,markManagerSnapshot:null,markManagerApprovalUntil:null}),Mr=v.useRef(null),[$r,_r]=v.useState(!1),[Vr,en]=v.useState(null),[Xr,gn]=v.useState(!1),[Oe,qe]=v.useState(null),[Lt,dt]=v.useState([]),[He,$t]=v.useState([]),[Ue,er]=v.useState([]),[Z,pe]=v.useState(null);v.useEffect(()=>{pe(null),D(null)},[e]);const ee=!!Fe||!!(be!=null&&be.exists&&(be!=null&&be.is_published)),ue=!!ft.markManagerLocked;ft.markManagerSnapshot!=null;const Ae=Wt!=null&&Wt.approval_until?String(Wt.approval_until):null,Le=Me!=null&&Me.approval_until?String(Me.approval_until):null,ct=!!(Wt!=null&&Wt.allowed_by_approval)&&!!Ae&&Ae!==((Z==null?void 0:Z.markEntryApprovalUntil)??null),ce=!!(Me!=null&&Me.allowed_by_approval)&&!!Le&&Le!==((Z==null?void 0:Z.markManagerApprovalUntil)??null),xe=ee?!!(be!=null&&be.entry_open)||ct||ce:!0,se=!!(ee&&!xe),Se=!!(ot||(ee?!xe:!ue));function Ze(V,ie){return JSON.stringify({assessmentKey:i,totalsMax:Dt,questions:(w||[]).map(_e=>({key:_e.key,label:_e.label,max:_e.max})),questionBtl:V,mark_manager:{questions:(ie==null?void 0:ie.questions)??[],marks:(ie==null?void 0:ie.marks)??[],btls:(ie==null?void 0:ie.btls)??[]}})}async function et(){if(e){gn(!0),qe(null);try{await Yi({assessment:i,subject_code:String(e),scope:"MARK_MANAGER",reason:`Edit request: Mark Manager changes for ${o} ${e}`,teaching_assignment_id:t}),alert("Edit request sent to IQAC.")}catch(V){qe((V==null?void 0:V.message)||"Request failed"),alert((V==null?void 0:V.message)||"Request failed")}finally{gn(!1)}}}async function Et(){if(e){H(!0);try{await Yi({assessment:i,subject_code:String(e),scope:"MARK_ENTRY",reason:z||`Edit request: ${o} marks entry for ${e}`,teaching_assignment_id:t}),D("Request sent to IQAC for edit approval."),ne(!1),we({silent:!0})}catch(V){alert((V==null?void 0:V.message)||"Request failed")}finally{H(!1)}}}v.useEffect(()=>{if(!e||!ee||xe)return;const V=window.setInterval(()=>{we({silent:!0})},3e4);return()=>window.clearInterval(V)},[xe,ee,e,we]);const wt=v.useRef(!!xe);v.useEffect(()=>{if(!e||!ee)return;if(wt.current||!xe){wt.current=!!xe;return}let ie=!0;return(async()=>{try{const _e=await En(i,e);if(!ie)return;const Je=_e==null?void 0:_e.draft;Je&&typeof Je=="object"?gr(Nt=>({...Nt,termLabel:String(Je.termLabel||Nt.termLabel),batchLabel:e,questionBtl:Je.questionBtl&&typeof Je.questionBtl=="object"?Je.questionBtl:Nt.questionBtl,rowsByStudentId:Je.rowsByStudentId&&typeof Je.rowsByStudentId=="object"?Je.rowsByStudentId:Nt.rowsByStudentId,markManagerLocked:Je.markManagerLocked??Nt.markManagerLocked,markManagerSnapshot:Je.markManagerSnapshot??Nt.markManagerSnapshot,markManagerApprovalUntil:Je.markManagerApprovalUntil??Nt.markManagerApprovalUntil})):gt(!0)}catch{try{gt(!0)}catch{}}})(),wt.current=!!xe,()=>{ie=!1}},[xe,ee,e,i]);const gt=async V=>{if(e){V||(I(null),E(!0));try{const ie=await vu(i,e,t),_e=ie&&ie.data!=null?ie.data:null;te(_e)}catch(ie){V||I((ie==null?void 0:ie.message)||"Failed to load published sheet")}finally{V||E(!1)}}};v.useEffect(()=>{q&&(te(null),gt(!1))},[q,e,i]);async function zt(){if(e){gn(!0),qe(null);try{const V=Ze(ft.questionBtl,{questions:Lt,marks:He,btls:Ue}),ie=Me!=null&&Me.approval_until?String(Me.approval_until):ft.markManagerApprovalUntil||null,_e={...ft,markManagerLocked:!0,markManagerSnapshot:V,markManagerApprovalUntil:ie},Je={termLabel:_e.termLabel,batchLabel:e,questionBtl:_e.questionBtl,rowsByStudentId:_e.rowsByStudentId,markManagerLocked:_e.markManagerLocked,markManagerSnapshot:_e.markManagerSnapshot,markManagerApprovalUntil:_e.markManagerApprovalUntil};gr(_e),en(null),await Fs(i,e,Je),ge(new Date().toLocaleString());try{await kd(i,String(e),t),we({silent:!0})}catch(Nt){console.warn("confirmMarkManagerLock failed",Nt)}}catch(V){qe((V==null?void 0:V.message)||"Save failed")}finally{gn(!1)}}}v.useEffect(()=>{if(!(!Vr||Vr.mode!=="confirm"))try{if(ft.markManagerSnapshot){const V=JSON.parse(String(ft.markManagerSnapshot)),ie=V&&V.mark_manager||{};dt(Array.isArray(ie.questions)?ie.questions.map(_e=>Number(_e)).filter(_e=>Number.isFinite(_e)):[]),$t(Array.isArray(ie.marks)?ie.marks.map(_e=>Number(_e)).filter(_e=>Number.isFinite(_e)):[]),er(Array.isArray(ie.btls)?ie.btls.map(_e=>Number(_e)).filter(_e=>Number.isFinite(_e)):[])}else dt([]),$t([]),er([])}catch{dt([]),$t([]),er([])}},[Vr]),v.useEffect(()=>{let V=!0;return(async()=>{try{const ie=await Sl();if(!V)return;d(ie||null),h(null),gr(_e=>({..._e,termLabel:String((ie==null?void 0:ie.termLabel)||_e.termLabel||"KRCT AY25-26"),batchLabel:e}))}catch(ie){if(!V)return;d(null),h((ie==null?void 0:ie.message)||"Failed to load OBE Master config; using derived maxima from questions.")}})(),()=>{V=!1}},[e]),v.useEffect(()=>{let V=!0;return(async()=>{if(e){k(!0),W(null);try{let _e=null,Je=null;try{Je=(await wl()||[]).find(Ot=>{const Tr=String(Ot.subject_code||"").trim().toUpperCase()===String(e||"").trim().toUpperCase();return(t?Ot.id===t:!1)||Tr})}catch{}if(Je&&Je.elective_subject_id&&!Je.section_id)try{const Pt=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(Je.elective_subject_id))}`);if(Pt.ok){const Ot=await Pt.json();_e={students:((Array.isArray(Ot.results)?Ot.results:Array.isArray(Ot)?Ot:Ot.items||[])||[]).map(vr=>({id:Number(vr.student_id??vr.id),reg_no:String(vr.reg_no??vr.regno??""),name:String(vr.name??vr.full_name??vr.username??""),section:vr.section_name??vr.section??null})),marks:{}}}}catch(Pt){console.warn("Elective-choices fetch failed, falling back:",Pt)}if(!_e)try{_e=await sA(i,e,t)}catch(Pt){if(console.warn("CIA marks fetch failed:",Pt),Je&&Je.id)try{_e={students:(await Jo(Je.id)).students||[],marks:{}}}catch{console.warn("TA roster fallback failed")}if(!_e)throw Pt}if(!V)return;let Nt=(_e.students||[]).slice().sort((Pt,Ot)=>{const Tr=String((Pt==null?void 0:Pt.name)||"").trim().toLowerCase(),vr=String((Ot==null?void 0:Ot.name)||"").trim().toLowerCase();if(Tr&&vr){const ye=Tr.localeCompare(vr);if(ye)return ye}else if(Tr||vr)return Tr?-1:1;return String((Pt==null?void 0:Pt.reg_no)||"").localeCompare(String((Ot==null?void 0:Ot.reg_no)||""),void 0,{numeric:!0,sensitivity:"base"})});N(Nt),g((_e==null?void 0:_e.subject)||null);const Bt=_e.marks||{},jt={};for(const[Pt,Ot]of Object.entries(Bt)){const Tr=Number(Pt);if(!Number.isFinite(Tr))continue;if(Ot==null||Ot===""){jt[Tr]=null;continue}const vr=Number(Ot);jt[Tr]=Number.isFinite(vr)?vr:null}K(jt);try{let Pt=null;if(i==="cia1"?Pt=await Ip(e):Pt=await vu("cia2",e),Pt&&Pt.data&&typeof Pt.data=="object"){const Ot=Pt.data,Tr=Ot.rowsByStudentId||Ot.rows||Ot.sheet&&Ot.sheet.rowsByStudentId||{},vr={};for(const[ht,Vt]of Object.entries(Tr||{})){const Wr=String(ht),Yr=Vt,fn={},In=Yr.q||Yr.answers||Yr.questions||Yr;if(In&&typeof In=="object")for(const[Ye,st]of Object.entries(In)){const at=Number(st);fn[Ye]=Number.isFinite(at)?at:""}vr[Wr]={studentId:Number(Wr)||0,absent:!!Yr.absent,absentKind:Yr.absentKind||void 0,reg_no:String(Yr.reg_no||Yr.reg_no_text||""),q:fn}}const ye=Array.isArray(Ot.questions)?Object.fromEntries(Ot.questions.map(ht=>[String(ht.key||ht.label||""),Number(ht.btl||ht.btl_level||1)])):qd(w),lt=Object.fromEntries(Object.entries(ye).map(([ht,Vt])=>{const Wr=Number(Vt);return Number.isFinite(Wr)&&Wr>=1&&Wr<=6?[ht,Wr]:[ht,""]}));gr({termLabel:String(Ot.termLabel||(c==null?void 0:c.termLabel)||"KRCT AY25-26"),batchLabel:e,questionBtl:lt,rowsByStudentId:vr}),R(new Date().toLocaleString());try{yn(Zm(i,e),{termLabel:String(Ot.termLabel||(c==null?void 0:c.termLabel)||"KRCT AY25-26"),batchLabel:e,questionBtl:lt,rowsByStudentId:vr})}catch{}}}catch{}const cr=Bn(Zm(i,e)),sr=cr&&typeof cr=="object"?{termLabel:c!=null&&c.termLabel?String(c.termLabel):String(cr.termLabel||"KRCT AY25-26"),batchLabel:e,questionBtl:cr.questionBtl&&typeof cr.questionBtl=="object"?cr.questionBtl:qd(w),rowsByStudentId:cr.rowsByStudentId&&typeof cr.rowsByStudentId=="object"?cr.rowsByStudentId:{}}:{termLabel:String((c==null?void 0:c.termLabel)||"KRCT AY25-26"),batchLabel:e,questionBtl:qd(w),rowsByStudentId:{}},Fr={...qd(w),...sr.questionBtl||{}};for(const Pt of w){const Ot=Fr[Pt.key];Ot===""||Ot===1||Ot===2||Ot===3||Ot===4||Ot===5||Ot===6||(Fr[Pt.key]="")}const Nr={...sr.rowsByStudentId};for(const Pt of _e.students||[]){const Ot=String(Pt.id);if(Nr[Ot]){const Tr=!!Nr[Ot].absent,vr=String(Nr[Ot].absentKind||"").toUpperCase(),ye=Tr?vr==="ML"||vr==="SKL"||vr==="AL"?vr:"AL":void 0;Nr[Ot]={studentId:Pt.id,absent:Tr,absentKind:ye,reg_no:Pt.reg_no||"",q:{...Nr[Ot].q}}}else Nr[Ot]={studentId:Pt.id,absent:!1,absentKind:void 0,reg_no:Pt.reg_no||"",q:Object.fromEntries(w.map(Tr=>[Tr.key,""]))};for(const Tr of w)Tr.key in(Nr[Ot].q||{})||(Nr[Ot].q[Tr.key]="")}gr({...sr,questionBtl:Fr,termLabel:sr.termLabel||String((c==null?void 0:c.termLabel)||"KRCT AY25-26"),batchLabel:e,rowsByStudentId:Nr})}catch(_e){if(!V)return;W((_e==null?void 0:_e.message)||`Failed to load ${o} roster`)}finally{V&&k(!1)}}})(),()=>{V=!1}},[e,t,c,w,i,o]),v.useEffect(()=>{let V=!0;return(async()=>{if(e)try{const ie=await En(i,e);if(!V)return;const _e=ie==null?void 0:ie.draft;if(_e&&typeof _e=="object"){gr(Je=>({...Je,termLabel:String(_e.termLabel||Je.termLabel),batchLabel:e,questionBtl:_e.questionBtl&&typeof _e.questionBtl=="object"?_e.questionBtl:Je.questionBtl,rowsByStudentId:_e.rowsByStudentId&&typeof _e.rowsByStudentId=="object"?_e.rowsByStudentId:Je.rowsByStudentId}));try{const Je=Zm(i,e);yn(Je,{termLabel:String(_e.termLabel||"KRCT AY25-26"),batchLabel:String(e),questionBtl:_e.questionBtl&&typeof _e.questionBtl=="object"?_e.questionBtl:qd(w),rowsByStudentId:_e.rowsByStudentId&&typeof _e.rowsByStudentId=="object"?_e.rowsByStudentId:{}})}catch{}}}catch{if(!V)return}})(),()=>{V=!1}},[e,i,w]);const Dt=v.useMemo(()=>w.reduce((V,ie)=>V+ie.max,0),[w]),mr=v.useMemo(()=>{let V=0,ie=0;for(let _e=0;_e<w.length;_e++){const Je=w[_e],Nt=Jm(w,_e,l);V+=Je.max*Nt.a,ie+=Je.max*Nt.b}return{a:V,b:ie}},[w,l]),pt=v.useMemo(()=>{var Je,Nt,Bt,jt;const V=((Nt=(Je=c==null?void 0:c.assessments)==null?void 0:Je[i])==null?void 0:Nt.coMax)??((jt=(Bt=c==null?void 0:c.assessments)==null?void 0:Bt.cia1)==null?void 0:jt.coMax),ie=Number((V==null?void 0:V[`co${l.a}`])??(V==null?void 0:V.co1)),_e=Number((V==null?void 0:V[`co${l.b}`])??(V==null?void 0:V.co2));return{a:Number.isFinite(ie)?Math.max(0,ie):mr.a,b:Number.isFinite(_e)?Math.max(0,_e):mr.b}},[c,mr,i,l]),Xt=v.useMemo(()=>{const V=new Set;for(const ie of w){const _e=(ft.questionBtl||{})[ie.key];(_e===1||_e===2||_e===3||_e===4||_e===5||_e===6)&&V.add(_e)}return[1,2,3,4,5,6].filter(ie=>V.has(ie))},[ft.questionBtl,w]),Rt=v.useMemo(()=>{const V={1:0,2:0,3:0,4:0,5:0,6:0};for(const ie of w){const _e=(ft.questionBtl||{})[ie.key];(_e===1||_e===2||_e===3||_e===4||_e===5||_e===6)&&(V[_e]+=ie.max)}return V},[ft.questionBtl,w]),_t=v.useMemo(()=>{var _e,Je,Nt,Bt;const V=((Je=(_e=c==null?void 0:c.assessments)==null?void 0:_e[i])==null?void 0:Je.btlMax)??((Bt=(Nt=c==null?void 0:c.assessments)==null?void 0:Nt.cia1)==null?void 0:Bt.btlMax),ie=(jt,cr)=>{const sr=Number(V==null?void 0:V[jt]);return Number.isFinite(sr)?Math.max(0,sr):cr};return{1:ie("1",Rt[1]),2:ie("2",Rt[2]),3:ie("3",Rt[3]),4:ie("4",Rt[4]),5:ie("5",Rt[5]),6:ie("6",Rt[6])}},[c,Rt,i]),jr=(V,ie)=>{C||Se||gr(_e=>{const Je=String(V),Nt=_e.rowsByStudentId[Je]||{studentId:V,absent:!1,absentKind:void 0,reg_no:"",q:Object.fromEntries(w.map(jt=>[jt.key,""]))},Bt=ie?{...Nt,absent:!0,absentKind:Nt.absentKind||"AL",q:Object.fromEntries(w.map(jt=>[jt.key,""]))}:{...Nt,absent:!1,absentKind:void 0};return{..._e,rowsByStudentId:{..._e.rowsByStudentId,[Je]:Bt}}})},Gr=(V,ie)=>{C||Se||gr(_e=>{const Je=String(V),Nt=_e.rowsByStudentId[Je]||{studentId:V,absent:!0,absentKind:"AL",reg_no:"",q:Object.fromEntries(w.map(Bt=>[Bt.key,""]))};return{..._e,rowsByStudentId:{..._e.rowsByStudentId,[Je]:{...Nt,absent:!0,absentKind:ie}}}})},Cr=(V,ie)=>{if(C||ot)return;const _e=ft.markManagerSnapshot!=null;ue&&_e||se||gr(Je=>({...Je,questionBtl:{...Je.questionBtl||qd(w),[V]:ie}}))};v.useEffect(()=>{if(!e)return;let V=!1;const ie=setTimeout(async()=>{try{const _e={termLabel:ft.termLabel,batchLabel:e,questionBtl:ft.questionBtl,rowsByStudentId:ft.rowsByStudentId};await Fs(i,e,_e);try{const Je=Zm(i,e);yn(Je,{termLabel:ft.termLabel,batchLabel:e,questionBtl:ft.questionBtl,rowsByStudentId:ft.rowsByStudentId})}catch{}V||ge(new Date().toLocaleString())}catch{}},700);return()=>{V=!0,clearTimeout(ie)}},[ft.questionBtl,e,ft.rowsByStudentId,i]);const Rr=(V,ie,_e)=>{C||Se||gr(Je=>{const Nt=String(V),Bt=Je.rowsByStudentId[Nt]||{studentId:V,absent:!1,absentKind:void 0,reg_no:"",q:Object.fromEntries(w.map(vr=>[vr.key,""]))},jt=!!Bt.absent,cr=jt?String(Bt.absentKind||"AL").toUpperCase():"";if(jt&&!!!(Y&&jt))return Je;const Fr=w.find(vr=>vr.key===ie),Nr=(Fr==null?void 0:Fr.max)??Dt,Pt=_e===""?"":ic(Number(_e||0),0,Nr),Ot=Bt.absent?Bt.absentKind||"AL":null,Tr=Ot==="ML"?60:Ot==="SKL"?75:null;return Tr!=null&&w.reduce((ye,lt)=>{const ht=lt.key===ie?Pt:(Bt.q||{})[lt.key];return ye+ic(Number(ht||0),0,lt.max)},0)>Tr?(Ee({title:"Mark limit exceeded",message:cr==="ML"?"For malpractice the total mark assigned is 60":"For Sick leave the Total mark assigned is 75"}),Je):{...Je,rowsByStudentId:{...Je.rowsByStudentId,[Nt]:{...Bt,q:{...Bt.q||{},[ie]:Pt}}}}})},De=V=>!V||!V.q?!1:w.some(ie=>{const _e=V.q[ie.key];return _e!==""&&_e!==null&&_e!==void 0});v.useMemo(()=>{const V={};for(const ie of A){const _e=ft.rowsByStudentId[String(ie.id)];if(!_e){V[ie.id]=null;continue}if(_e.absent&&String(_e.absentKind||"AL").toUpperCase()==="AL"){V[ie.id]=0;continue}const Je=w.reduce((Nt,Bt)=>{var jt;return Nt+ic(Number(((jt=_e.q)==null?void 0:jt[Bt.key])||0),0,Bt.max)},0);V[ie.id]=Je}return V},[A,ft.rowsByStudentId,w]);const Ke=async()=>{L(!0),W(null);try{const V={termLabel:ft.termLabel,batchLabel:e,questionBtl:ft.questionBtl,rowsByStudentId:ft.rowsByStudentId};await Fs(i,e,V),ge(new Date().toLocaleString())}catch(V){W((V==null?void 0:V.message)||`Failed to save ${o} draft`)}finally{L(!1)}},Ce=async()=>{var V;if(e){if(ot){W("Publishing is locked by IQAC.");return}if(!ze){W("Publish window is closed. Please request IQAC approval.");return}if(ee&&se){ne(!0);return}O(!0),W(null),D(null);try{const ie={};for(const[Je,Nt]of Object.entries(ft.rowsByStudentId||{})){const Bt=Nt||{},jt=De(Bt);Bt.absent&&jt?ie[Je]={...Bt,absent:!1,absentKind:void 0}:ie[Je]=Bt}const _e={...ft,batchLabel:e,questions:w,rowsByStudentId:ie};await nA(i,e,_e,t),R(new Date().toLocaleString()),pe({markEntryApprovalUntil:Ae,markManagerApprovalUntil:Le}),gr(Je=>({...Je,markManagerLocked:!0})),Ie(),we({silent:!0}),gt(!0);try{console.debug("obe:published dispatch",{assessment:i,subjectId:e}),window.dispatchEvent(new CustomEvent("obe:published",{detail:{subjectId:e,assessment:i}}))}catch{}setTimeout(()=>{try{if(q&&Q.current){const Je=Q.current;Je.scrollTop=Je.scrollHeight}}catch{}},50)}catch(ie){const _e=ie==null?void 0:ie.status;if(String(((V=ie==null?void 0:ie.body)==null?void 0:V.detail)||(ie==null?void 0:ie.message)||""),_e===423){R(Je=>Je||new Date().toLocaleString()),Ie(),we({silent:!0}),W(null),ne(!0);return}W((ie==null?void 0:ie.message)||`Failed to publish ${o}`)}finally{O(!1)}}},it=async()=>{Be(!0),It(null),W(null);try{await w0({assessment:i,subject_code:e,reason:Ct,teaching_assignment_id:t}),It("Request sent to IQAC for approval.")}catch(V){W((V==null?void 0:V.message)||"Failed to request approval")}finally{Be(!1),Ie()}},tr=()=>{const V=A.map((ie,_e)=>{const Je=ft.rowsByStudentId[String(ie.id)]||{studentId:ie.id,absent:!1,absentKind:void 0,q:Object.fromEntries(w.map(vr=>[vr.key,""]))},Nt=De(Je),Bt=!!(Je.absent&&!Nt),jt=Bt?String(Je.absentKind||"AL"):"";if(Bt){const vr=Object.fromEntries(w.map(ye=>[ye.key,""]));return{sno:_e+1,registerNo:ie.reg_no,name:ie.name,absent:1,absentKind:jt,...vr,total:"ABSENT",[`co${l.a}_mark`]:"",[`co${l.a}_pct`]:"",[`co${l.b}_mark`]:"",[`co${l.b}_pct`]:"",...Object.fromEntries(Xt.flatMap(ye=>[[`btl${ye}_mark`,""],[`btl${ye}_pct`,""]]))}}const cr=0,sr="",Fr=Object.fromEntries(w.map(vr=>{var ye;return[vr.key,ic(Number(((ye=Je.q)==null?void 0:ye[vr.key])||0),0,vr.max)]})),Nr=w.reduce((vr,ye)=>vr+Number(Fr[ye.key]||0),0);let Pt=0,Ot=0;for(let vr=0;vr<w.length;vr++){const ye=w[vr],lt=Jm(w,vr,l),ht=Number(Fr[ye.key]||0);Pt+=ht*lt.a,Ot+=ht*lt.b}const Tr={1:0,2:0,3:0,4:0,5:0,6:0};for(const vr of w){const ye=(ft.questionBtl||{})[vr.key];(ye===1||ye===2||ye===3||ye===4||ye===5||ye===6)&&(Tr[ye]+=Number(Fr[vr.key]||0))}return{sno:_e+1,registerNo:ie.reg_no,name:ie.name,absent:cr,absentKind:sr,...Fr,total:Nr,[`co${l.a}_mark`]:Pt,[`co${l.a}_pct`]:oc(Pt,pt.a),[`co${l.b}_mark`]:Ot,[`co${l.b}_pct`]:oc(Ot,pt.b),...Object.fromEntries(Xt.flatMap(vr=>[[`btl${vr}_mark`,Tr[vr]],[`btl${vr}_pct`,oc(Tr[vr],_t[vr])]]))}});WY(`${e}_${i.toUpperCase()}_sheet.csv`,V)},Kt=async()=>{try{const V=new URLSearchParams;t&&V.set("teaching_assignment_id",String(t)),m&&V.set("question_paper_type",String(m));const Je=`${(rb==null?void 0:rb.VITE_API_BASE)||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:8000":"https://db.zynix.us")}/api/obe/cia-export-template/${encodeURIComponent(i)}/${encodeURIComponent(e)}${V.toString()?`?${V.toString()}`:""}`,Nt=await hr(Je,{method:"GET"});if(!Nt.ok){const sr=await Nt.text();throw new Error(sr||`Export failed (${Nt.status})`)}const Bt=await Nt.blob(),jt=window.URL.createObjectURL(Bt),cr=document.createElement("a");cr.href=jt,cr.download=`${e}_${i.toUpperCase()}_template.xlsx`,document.body.appendChild(cr),cr.click(),window.URL.revokeObjectURL(jt),document.body.removeChild(cr)}catch(V){alert((V==null?void 0:V.message)||"Failed to export Excel")}},yt=async()=>{const V=A.map((Je,Nt)=>{const Bt=ft.rowsByStudentId[String(Je.id)]||{studentId:Je.id,absent:!1,q:Object.fromEntries(w.map(Nr=>[Nr.key,""]))},jt=De(Bt);if(!!(Bt.absent&&!jt))return{sno:Nt+1,regNo:String(Je.reg_no||""),name:String(Je.name||""),total:"ABSENT"};const sr=Object.fromEntries(w.map(Nr=>{var Pt;return[Nr.key,ic(Number(((Pt=Bt.q)==null?void 0:Pt[Nr.key])||0),0,Nr.max)]})),Fr=w.reduce((Nr,Pt)=>Nr+Number(sr[Pt.key]||0),0);return{sno:Nt+1,regNo:String(Je.reg_no||""),name:String(Je.name||""),total:Fr}}),ie=String((x==null?void 0:x.name)||"").trim(),_e=String((x==null?void 0:x.code)||e||"").trim();await Qp({filenameBase:`${e}_${o}`,meta:{courseName:ie,courseCode:_e,className:String((x==null?void 0:x.className)||"")},rows:V})},Ht=async V=>{if(!(C||Se||$r)){_r(!0);try{const ie=await V.arrayBuffer(),_e=u0(ie,{type:"array"}),Je=_e.Sheets[_e.SheetNames[0]],Nt=gi.sheet_to_json(Je,{header:1});if(Nt.length<2)throw new Error("Excel file is empty or has no data rows");const Bt=Nt[0],jt=Bt.findIndex(ye=>String(ye||"").toLowerCase().includes("register")),cr=Bt.findIndex(ye=>String(ye||"").toLowerCase().includes("status"));if(jt===-1)throw new Error('Could not find "Register No" column in Excel file');const sr=2,Fr=cr!==-1?cr:Bt.length,Nr=[];for(let ye=sr;ye<Fr;ye++){const lt=String(Bt[ye]||"").trim();if(!lt)continue;const ht=lt.match(/^([QqOo]\d+|[A-Za-z]\d*)/);if(!ht)continue;const Vt=ht[1].toUpperCase();if(m==="QP2"&&Vt==="Q10"){Nr.push({colIdx:ye,qKey:"q9",mode:"sum"});continue}if(m==="QP2"&&Vt==="Q9"){Nr.push({colIdx:ye,qKey:"q9",mode:"set"});continue}const Wr=w.find(Yr=>Yr.label.toUpperCase()===Vt||Yr.key.toUpperCase()===Vt.toUpperCase());Wr&&Nr.push({colIdx:ye,qKey:Wr.key,mode:"set"})}if(Nr.length===0)throw new Error("No matching question columns found in Excel file");const Pt=new Map;A.forEach(ye=>{const lt=String(ye.reg_no||"").trim().toUpperCase();lt&&Pt.set(lt,ye)});let Ot=0,Tr=0;const vr={...ft.rowsByStudentId};for(let ye=1;ye<Nt.length;ye++){const lt=Nt[ye];if(!lt||lt.length===0)continue;const ht=String(lt[jt]||"").trim().toUpperCase();if(!ht)continue;const Vt=Pt.get(ht);if(!Vt){Tr++;continue}const Wr=String(Vt.id),Yr=vr[Wr]||{studentId:Vt.id,absent:!1,absentKind:void 0,reg_no:Vt.reg_no,q:Object.fromEntries(w.map(at=>[at.key,""]))},fn={...Yr.q};let In=!1;const Ye={};for(const{colIdx:at,qKey:nt,mode:xt}of Nr){const rr=lt[at];if(rr==null||rr===""){xt==="set"&&(fn[nt]="");continue}const vt=Number(rr);if(!Number.isFinite(vt)){xt==="set"&&(fn[nt]="");continue}if(xt==="sum"){Ye[nt]=(Ye[nt]??0)+vt;continue}const dr=w.find(Br=>Br.key===nt),ir=(dr==null?void 0:dr.max)??Dt;fn[nt]=ic(vt,0,ir),In=!0}for(const[at,nt]of Object.entries(Ye)){const xt=Number(fn[at]===""?0:fn[at]||0),rr=w.find(ir=>ir.key===at),vt=(rr==null?void 0:rr.max)??Dt,dr=ic(xt+nt,0,vt);fn[at]=dr,In=!0}let st=Yr.absent;cr!==-1&&(st=String(lt[cr]||"").trim().toLowerCase()==="absent"),vr[Wr]={...Yr,q:fn,absent:st},(In||st!==Yr.absent)&&Ot++}gr(ye=>({...ye,rowsByStudentId:vr})),alert(`Import successful!
Imported: ${Ot} students
Skipped: ${Tr} rows (no matching register number)`)}catch(ie){alert(`Failed to import Excel: ${(ie==null?void 0:ie.message)||"Unknown error"}`),console.error("Import error:",ie)}finally{_r(!1),Mr.current&&(Mr.current.value="")}}},qt=V=>{var _e;const ie=(_e=V.target.files)==null?void 0:_e[0];ie&&Ht(ie)},lr=()=>{Mr.current&&Mr.current.click()};if(S)return n.jsxs("div",{style:{color:"#6b7280"},children:["Loading ",o," roster"]});const Mt=A.some(V=>{var ie;return!!((ie=ft.rowsByStudentId[String(V.id)])!=null&&ie.absent)}),tt=Y?A.filter(V=>{var ie;return $e&&$e.length?$e.includes(V.id):!!((ie=ft.rowsByStudentId[String(V.id)])!=null&&ie.absent)}):A,Ft={border:"1px solid #111",padding:"4px 4px",background:"#ecfdf5",color:"#065f46",textAlign:"center",fontWeight:700,fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},Qt={border:"1px solid #111",padding:"4px 4px",fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},At={width:"100%",border:"none",outline:"none",background:"transparent",fontSize:11},bt=32;return n.jsxs("div",{children:[We?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(15,23,42,0.45)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:50},onClick:()=>Ee(null),children:n.jsxs("div",{style:{width:"min(520px, 100%)",background:"#fff",borderRadius:14,border:"1px solid rgba(15,23,42,0.10)",boxShadow:"0 20px 60px rgba(2,6,23,0.25)",padding:14},onClick:V=>V.stopPropagation(),children:[n.jsx("div",{style:{fontWeight:900,marginBottom:6},children:We.title}),n.jsx("div",{style:{fontSize:13,color:"#334155",marginBottom:12},children:We.message}),n.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:n.jsx("button",{className:"obe-btn",onClick:()=>Ee(null),children:"Close"})})]})}):null,T&&n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10,maxWidth:"100%",whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:T}),u&&n.jsx("div",{style:{background:"#fffbeb",border:"1px solid #f59e0b55",color:"#92400e",padding:10,borderRadius:10,marginBottom:10},children:u}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap",marginBottom:10},children:[n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsxs("button",{className:"obe-btn obe-btn-secondary",disabled:!Mt,onClick:()=>{if(Y)return;const V=A.filter(ie=>{var _e;return!!((_e=ft.rowsByStudentId[String(ie.id)])!=null&&_e.absent)}).map(ie=>ie.id);je(V),le(!0)},title:Mt?"Filter the table to show only absentees":"No absentees marked yet",style:Y?{background:"linear-gradient(180deg, #111827, #334155)",color:"#fff",borderColor:"rgba(2,6,23,0.12)"}:void 0,children:["Show absentees list",Y?n.jsx("span",{onClick:V=>{V.stopPropagation(),le(!1),je(null)},role:"button","aria-label":"Close absentees list",title:"Close absentees list",style:{marginLeft:10,display:"inline-flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:999,background:"rgba(255,255,255,0.18)",border:"1px solid rgba(255,255,255,0.25)",fontWeight:900,lineHeight:1,cursor:"pointer",userSelect:"none"},children:""}):null]}),n.jsx("button",{onClick:tr,className:"obe-btn obe-btn-secondary",disabled:A.length===0,children:"Export CSV"}),n.jsx("button",{onClick:Kt,className:"obe-btn obe-btn-secondary",disabled:A.length===0,children:"Export Excel"}),n.jsx("button",{onClick:lr,className:"obe-btn obe-btn-secondary",disabled:$r||A.length===0||Se||ot,children:$r?"Importing":"Import Excel"}),n.jsx("input",{ref:Mr,type:"file",accept:".xlsx,.xls",onChange:qt,style:{display:"none"}})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[n.jsx("button",{onClick:yt,className:"obe-btn obe-btn-secondary",disabled:A.length===0,children:"Download"}),n.jsx("button",{onClick:Ke,className:"obe-btn obe-btn-success",disabled:F||A.length===0||Se||ot,children:F?"Saving":"Save Draft"}),n.jsx("button",{onClick:Ce,disabled:C||A.length===0||!ze||Se||ot,className:"obe-btn obe-btn-primary",children:C?"Publishing":"Publish"}),re&&n.jsxs("div",{style:{fontSize:12,color:"#6b7280",alignSelf:"center"},children:["Saved: ",re]}),Fe&&n.jsxs("div",{style:{fontSize:12,color:"#16a34a",alignSelf:"center"},children:["Published: ",Fe]})]})]}),n.jsx("div",{style:{marginBottom:10,fontSize:12,color:ze?"#065f46":"#b91c1c"},children:Ve?"Checking publish due time":St||(Re!=null&&Re.due_at?n.jsxs(n.Fragment,{children:["Due: ",new Date(Re.due_at).toLocaleString(),"  Remaining: ",_0(rt),Re.allowed_by_approval&&Re.approval_until?n.jsxs(n.Fragment,{children:["  Approved until ",new Date(Re.approval_until).toLocaleString()]}):null]}):"Due time not set by IQAC.")}),ot?n.jsxs("div",{style:{marginBottom:10,border:"1px solid #fde68a",background:"#fffbeb",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publishing disabled by IQAC"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Global publishing is turned OFF for this assessment. You can view the sheet, but editing and publishing are locked."}),n.jsx("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:10},children:n.jsx("button",{className:"obe-btn",onClick:()=>Ie(),disabled:Ve,children:"Refresh"})})]}):ze?null:n.jsxs("div",{style:{marginBottom:10,border:"1px solid #fecaca",background:"#fff7ed",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publish time is over"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:8},children:"Send a request to IQAC to approve publishing."}),n.jsx("textarea",{value:Ct,onChange:V=>pr(V.target.value),placeholder:"Reason (optional)",rows:3,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical"}}),n.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:10},children:[n.jsx("button",{className:"obe-btn",onClick:()=>Ie(),disabled:fr||Ve,children:"Refresh"}),n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:it,disabled:fr,children:fr?"Requesting":"Request Approval"})]}),mt?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#065f46"},children:mt}):null]}),n.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff",marginBottom:10},children:n.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[n.jsxs("label",{style:{fontSize:12,color:"#374151"},children:["Term",n.jsx("div",{style:{marginLeft:8,padding:6,border:"1px solid #d1d5db",borderRadius:8,minWidth:160},children:ft.termLabel})]}),n.jsxs("label",{style:{fontSize:12,color:"#374151"},children:["Sheet Label",n.jsx("div",{style:{marginLeft:8,padding:6,border:"1px solid #d1d5db",borderRadius:8,minWidth:160},children:ft.batchLabel})]}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280",alignSelf:"center"},children:["Total max: ",Dt," | Questions: ",w.length," | COs: ",l.a,"",l.b," | BTLs: 16"]})]})}),A.length===0?n.jsx("div",{style:{color:"#6b7280",fontSize:14,padding:"12px 0"},children:"No students found for this subject."}):n.jsxs("div",{style:{position:"relative"},children:[n.jsxs(k0,{locked:ot,children:[n.jsxs("div",{style:{marginBottom:10},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:6},children:"Mark Manager"}),n.jsxs("div",{style:{border:"1px solid #fcd34d",background:ue?"#f3f4f6":"#fff7ed",padding:12,borderRadius:12,display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("div",{style:{fontWeight:950,color:"#111827"},children:"BTL configuration"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Set BTL per question in the BTL row, then confirm."}),n.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:n.jsx("button",{className:"obe-btn obe-btn-success",disabled:!e||Xr,onClick:()=>en({mode:ue?"request":"confirm"}),children:ue?"Edit":"Save"})})]}),Oe?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#991b1b"},children:Oe}):null]}),n.jsx("div",{className:"obe-table-wrapper",style:{overflowX:"auto"},children:n.jsxs("table",{className:"obe-table",style:{width:"max-content",minWidth:"100%",tableLayout:"auto"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Ft,colSpan:4+w.length+1+4+Xt.length*2,children:[ft.termLabel," | ",ft.batchLabel," | ",o]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...Ft,width:bt,minWidth:bt},rowSpan:3,children:"S.No"}),n.jsx("th",{style:{...Ft,minWidth:70,overflow:"visible",textOverflow:"clip"},rowSpan:3,children:"R.No"}),n.jsx("th",{style:{...Ft,minWidth:240,overflow:"visible",textOverflow:"clip"},rowSpan:3,children:"Name of the Students"}),n.jsx("th",{style:{...Ft,minWidth:88},rowSpan:3,children:"AB"}),n.jsx("th",{style:Ft,colSpan:w.length,children:"QUESTIONS"}),n.jsx("th",{style:Ft,rowSpan:3,children:"Total"}),n.jsx("th",{style:Ft,colSpan:4,children:"CO ATTAINMENT"}),Xt.length?n.jsx("th",{style:Ft,colSpan:Xt.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[w.map(V=>n.jsx("th",{style:{...Ft,width:46,minWidth:46},children:V.label},V.key)),n.jsxs("th",{style:Ft,colSpan:2,children:["CO-",l.a]}),n.jsxs("th",{style:Ft,colSpan:2,children:["CO-",l.b]}),Xt.map(V=>n.jsxs("th",{style:Ft,colSpan:2,children:["BTL-",V]},`btl-head-${V}`))]}),n.jsxs("tr",{children:[w.map(V=>n.jsx("th",{style:{...Ft,width:46,minWidth:46},children:V.max},V.key)),Array.from({length:2+Xt.length}).flatMap((V,ie)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Ft,children:n.jsx("div",{style:{whiteSpace:"pre-line",lineHeight:"0.9",fontSize:"0.7em"},children:`M
A
R
K`})}),n.jsx("th",{style:Ft,children:"%"})]},ie))]})]}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},colSpan:3}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:"BTL"}),w.map(V=>n.jsx("td",{style:{...Qt,textAlign:"center"},children:(()=>{const ie=(ft.questionBtl||{})[V.key]??"",_e=ie===""?"-":String(ie);return n.jsxs("div",{style:{position:"relative",minWidth:44},children:[n.jsx("div",{style:{width:"100%",fontSize:12,padding:"2px 4px",border:"1px solid #d1d5db",borderRadius:8,background:"#fff",textAlign:"center",userSelect:"none"},title:`BTL: ${_e}`,children:_e}),n.jsxs("select",{"aria-label":`BTL for ${V.label}`,value:ie,onChange:Je=>Cr(V.key,Je.target.value===""?"":Number(Je.target.value)),style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none"},children:[n.jsx("option",{value:"",children:"-"}),[1,2,3,4,5,6].map(Je=>n.jsx("option",{value:Je,children:Je},Je))]})]})})()},`btl-select-${V.key}`)),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"}}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},colSpan:4}),Xt.map(V=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"}}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"}})]},`btl-pad-${V}`))]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},colSpan:3,children:"Name / Max Marks"}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:"-"}),w.map(V=>n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:V.max},V.key)),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:Dt}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:pt.a}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:"%"}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:pt.b}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:"%"}),Xt.map(V=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:_t[V]}),n.jsx("td",{style:{...Qt,fontWeight:700,textAlign:"center"},children:"%"})]},`btl-max-${V}`))]}),tt.map((V,ie)=>{const _e=ft.rowsByStudentId[String(V.id)]||{studentId:V.id,reg_no:V.reg_no??"",absent:!1,absentKind:void 0,q:Object.fromEntries(w.map(Ot=>[Ot.key,""]))},Je=Object.fromEntries(w.map(Ot=>{var Tr;return[Ot.key,ic(Number(((Tr=_e.q)==null?void 0:Tr[Ot.key])||0),0,Ot.max)]})),Nt=w.reduce((Ot,Tr)=>Ot+Number(Je[Tr.key]||0),0);let Bt=0,jt=0;for(let Ot=0;Ot<w.length;Ot++){const Tr=w[Ot],vr=Jm(w,Ot,l),ye=Number(Je[Tr.key]||0);Bt+=ye*vr.a,jt+=ye*vr.b}const cr={1:0,2:0,3:0,4:0,5:0,6:0};for(const Ot of w){const Tr=(ft.questionBtl||{})[Ot.key];(Tr===1||Tr===2||Tr===3||Tr===4||Tr===5||Tr===6)&&(cr[Tr]+=Number(Je[Ot.key]||0))}const sr=_e.absent?{background:"#f1f5f9"}:void 0;_e.absent&&String(_e.absentKind||"AL").toUpperCase();const Fr=!!(Y&&_e.absent),Nr=!!(C||Se||ot||se),Pt=P[V.id];return n.jsxs("tr",{style:sr,children:[n.jsx("td",{style:{...Qt,textAlign:"center",width:bt,minWidth:bt,paddingLeft:2,paddingRight:2},children:ie+1}),n.jsx("td",{style:{...Qt,minWidth:70,overflow:"visible",textOverflow:"clip"},children:Xj(_e.reg_no)}),n.jsx("td",{style:{...Qt,minWidth:240,overflow:"visible",textOverflow:"clip"},children:V.name}),n.jsx("td",{style:{...Qt,textAlign:"center",minWidth:88},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[n.jsx("input",{type:"checkbox",checked:_e.absent,disabled:Nr,onChange:Ot=>jr(V.id,Ot.target.checked)}),_e.absent?n.jsxs("div",{className:"obe-ios-select",title:"Absent type",children:[n.jsx("span",{className:"obe-ios-select-value",children:String(_e.absentKind||"AL")}),n.jsxs("select",{"aria-label":"Absent type",value:_e.absentKind||"AL",disabled:Nr,onChange:Ot=>Gr(V.id,Ot.target.value),children:[n.jsx("option",{value:"AL",children:"AL"}),n.jsx("option",{value:"ML",children:"ML"}),n.jsx("option",{value:"SKL",children:"SKL"})]})]}):null]})}),w.map(Ot=>{var Tr,vr,ye;return n.jsx("td",{style:{...Qt,textAlign:"center",width:46,minWidth:46},children:n.jsx("input",{style:{...At,textAlign:"center"},type:"number",min:0,max:Ot.max,disabled:Nr||_e.absent&&!Fr,value:((Tr=_e.q)==null?void 0:Tr[Ot.key])===""||((vr=_e.q)==null?void 0:vr[Ot.key])==null?"":Number(((ye=_e.q)==null?void 0:ye[Ot.key])||0),onChange:lt=>{const ht=lt.target.value;if(ht==="")return lt.currentTarget.setCustomValidity(""),Rr(V.id,Ot.key,"");const Vt=Number(ht);if(Number.isFinite(Vt)){if(Vt>Ot.max){lt.currentTarget.setCustomValidity(`Max mark is ${Ot.max}`),lt.currentTarget.reportValidity(),window.setTimeout(()=>lt.currentTarget.setCustomValidity(""),0);return}lt.currentTarget.setCustomValidity(""),Rr(V.id,Ot.key,Vt)}}})},Ot.key)}),n.jsx("td",{style:{...Qt,textAlign:"center",fontWeight:700},title:Pt!=null?`Server total: ${Pt}`:void 0,children:Nt}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:Bt}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:n.jsx("span",{className:"obe-pct-badge",children:oc(Bt,pt.a)})}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:jt}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:n.jsx("span",{className:"obe-pct-badge",children:oc(jt,pt.b)})}),Xt.map(Ot=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...Qt,textAlign:"center"},children:cr[Ot]}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:n.jsx("span",{className:"obe-pct-badge",children:oc(cr[Ot],_t[Ot])})})]},`btl-row-${V.id}-${Ot}`))]},V.id)})]})]})})]}),Se&&!ot?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"absolute",inset:0,background:ee?"rgba(240,253,244,0.55)":"rgba(239,246,255,0.65)",border:`1px solid ${ee?"rgba(22,163,74,0.25)":"rgba(59,130,246,0.25)"}`,borderRadius:12,pointerEvents:"none"}}),n.jsxs("div",{style:{position:"absolute",left:"50%",top:16,transform:"translateX(-50%)",zIndex:40,width:320,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:12,borderRadius:12,boxShadow:"0 6px 18px rgba(17,24,39,0.06)",display:"flex",flexDirection:"column",gap:10,alignItems:"stretch"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:950,color:"#111827"},children:ee?"Published  Locked":"Table Locked"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginTop:4},children:ee?"Marks are published. Use View to inspect or Request Edit to ask IQAC for access.":"Confirm the Mark Manager to unlock student entry."}),ee&&oe?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#065f46"},children:oe}):null]}),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:ee?n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn",onClick:()=>me(!0),children:"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>{D(null),ne(!0)},disabled:X,children:"Request Edit"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>en({mode:"confirm"}),disabled:!e||Xr,children:"Save Mark Manager"}),n.jsx("button",{className:"obe-btn",onClick:()=>et(),disabled:Xr,children:"Request Access"})]})})]})]}):null]}),Vr?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:9999},onClick:()=>{Xr||en(null)},children:n.jsxs("div",{style:{width:"min(760px,96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:V=>V.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:Vr.mode==="confirm"?`Confirmation - ${o}`:`Request Edit - ${o}`}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:String(e||"")})]}),Vr.mode==="confirm"?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"Confirm the selected BTL settings. After confirming, Mark Manager will be locked and the table will be editable."}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f9fafb"},children:[n.jsx("th",{style:{textAlign:"left",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Question"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Max"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"BTL"})]})}),n.jsx("tbody",{children:w.map(V=>n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:V.label}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:V.max}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:n.jsxs("select",{value:(ft.questionBtl||{})[V.key]===""?"":String((ft.questionBtl||{})[V.key]),onChange:ie=>{const _e=ie.target.value===""?"":Number(ie.target.value);Cr(V.key,_e)},style:{padding:"6px 8px",borderRadius:6,border:"1px solid #e5e7eb",background:"#fff"},disabled:Xr||ot,children:[n.jsx("option",{value:"",children:"-"}),[1,2,3,4,5,6].map(ie=>n.jsx("option",{value:String(ie),children:ie},ie))]})})]},`mm_${V.key}`))})]})})]}):n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"This will send an edit request to IQAC. Mark Manager will remain locked until IQAC approves."}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[n.jsx("button",{className:"obe-btn",disabled:Xr,onClick:()=>en(null),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:Xr||!e,onClick:async()=>{if(e){if(Vr.mode==="request"){en(null),await et();return}await zt()}},children:Vr.mode==="confirm"?"Confirm":"Send Request"})]})]})}):null,q?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>me(!1),children:n.jsxs("div",{style:{width:"min(1100px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:0,display:"flex",flexDirection:"column"},onClick:V=>V.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderBottom:"1px solid #eef2f7"},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"View Only"}),n.jsx("button",{onClick:V=>{V.stopPropagation(),me(!1)},"aria-label":"Close",style:{marginLeft:"auto",border:"none",background:"transparent",fontSize:20,lineHeight:1,cursor:"pointer"},children:""})]}),n.jsxs("div",{style:{padding:14},children:[fe?n.jsx("div",{style:{color:"#6b7280"},children:"Loading published sheet"}):null,U?n.jsx("div",{style:{color:"#991b1b",fontSize:12,marginBottom:8},children:U}):null]}),M&&(M.rowsByStudentId||M.rows_by_student_id)?n.jsx("div",{ref:Q,style:{overflow:"auto",border:"1px solid #e5e7eb",borderRadius:12,maxHeight:"60vh"},children:n.jsxs("table",{className:"obe-table",style:{width:"max-content",minWidth:"100%",borderCollapse:"collapse"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Ft,colSpan:6+Xt.length*2,children:[ft.termLabel," | ",ft.batchLabel," | ",o," (PUBLISHED)"]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...Ft,width:bt,minWidth:bt},children:"S.No"}),n.jsx("th",{style:{...Ft,minWidth:70,overflow:"visible",textOverflow:"clip"},children:"R.No"}),n.jsx("th",{style:{...Ft,minWidth:240,overflow:"visible",textOverflow:"clip"},children:"Name of the Students"}),n.jsx("th",{style:Ft,children:"Total"}),n.jsxs("th",{style:Ft,colSpan:2,children:["CO-",l.a]}),n.jsxs("th",{style:Ft,colSpan:2,children:["CO-",l.b]}),Xt.map(V=>n.jsxs("th",{style:Ft,colSpan:2,children:["BTL-",V]},`pv_btl_${V}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:Ft}),n.jsx("th",{style:Ft}),n.jsx("th",{style:Ft}),n.jsx("th",{style:Ft}),Array.from({length:2+Xt.length}).flatMap((V,ie)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Ft,children:"Mark"}),n.jsx("th",{style:Ft,children:"%"})]},`pv_hdr_${ie}`))]})]}),n.jsx("tbody",{children:A.map((V,ie)=>{var Nr;const _e=M.rowsByStudentId||M.rows_by_student_id||{},Je=_e[String(V.id)]||_e[V.id]||{},Nt=Je.q||{},Bt=Object.fromEntries(w.map(Pt=>[Pt.key,ic(Number((Nt==null?void 0:Nt[Pt.key])||0),0,Pt.max)])),jt=w.reduce((Pt,Ot)=>Pt+Number(Bt[Ot.key]||0),0);let cr=0,sr=0;for(let Pt=0;Pt<w.length;Pt++){const Ot=w[Pt],Tr=Jm(w,Pt,l),vr=Number(Bt[Ot.key]||0);cr+=vr*Tr.a,sr+=vr*Tr.b}const Fr={1:0,2:0,3:0,4:0,5:0,6:0};for(const Pt of w){const Ot=(M.questionBtl||M.question_btl||ft.questionBtl||{})[Pt.key];if(Ot===1||Ot===2||Ot===3||Ot===4||Ot===5||Ot===6){const Tr=Ot;Fr[Tr]+=Number(Bt[Pt.key]||0)}}return n.jsxs("tr",{children:[n.jsx("td",{style:{...Qt,textAlign:"center",width:bt,minWidth:bt,paddingLeft:2,paddingRight:2},children:ie+1}),n.jsx("td",{style:{...Qt,minWidth:70,overflow:"visible",textOverflow:"clip"},children:Xj(Je.reg_no||((Nr=ft.rowsByStudentId[String(V.id)])==null?void 0:Nr.reg_no)||"")}),n.jsx("td",{style:{...Qt,minWidth:240,overflow:"visible",textOverflow:"clip"},children:V.name}),n.jsx("td",{style:{...Qt,textAlign:"center",fontWeight:900},children:jt}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:Math.round(cr)}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:n.jsx("span",{className:"obe-pct-badge",children:oc(cr,pt.a)})}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:Math.round(sr)}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:n.jsx("span",{className:"obe-pct-badge",children:oc(sr,pt.b)})}),Xt.map(Pt=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...Qt,textAlign:"center"},children:Math.round(Fr[Pt])}),n.jsx("td",{style:{...Qt,textAlign:"center"},children:n.jsx("span",{className:"obe-pct-badge",children:oc(Fr[Pt],_t[Pt])})})]},`pv_btl_${V.id}_${Pt}`))]},`pv_${V.id}`)})})]})}):fe?null:n.jsx("div",{style:{color:"#6b7280"},children:"No published sheet found."}),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:n.jsx("button",{className:"obe-btn",onClick:()=>me(!1),children:"Close"})})]})}):null,G?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>{X||ne(!1)},children:n.jsxs("div",{style:{width:"min(560px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:V=>V.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"Edit Request"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:[o,"  ",String(e||"")]})]}),n.jsx("div",{style:{fontSize:13,color:"#374151",marginBottom:10,lineHeight:1.35},children:"This will send an edit request to IQAC for published marks. Once approved, the entry will open for editing until the approval expires."}),n.jsx("textarea",{value:z,onChange:V=>he(V.target.value),placeholder:"Reason (optional)",rows:4,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical"}}),n.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:12},children:[n.jsx("button",{className:"obe-btn",disabled:X,onClick:()=>ne(!1),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:X||!e,onClick:Et,children:X?"Requesting":"Send Request"})]})]})}):null]})}function Xj(e){return e.slice(-8)}function zY(e){return n.jsx(f8,{...e,assessmentKey:"cia2"})}const qY=5,HY=20,VY=10;function ln(e,t,r){return Math.max(t,Math.min(r,e))}function Mo(e){return Math.round(e*10)/10}function ma(e){if(e===""||e==null)return"";const t=Number(e);return Number.isFinite(t)?t:""}function ex(e){if(e===""||e==null||typeof e=="string"&&e.trim()==="")return null;const t=Number(e);return Number.isFinite(t)?t:null}function Ms(e,t){if(!t)return"-";const r=e/t*100;return`${Number.isFinite(r)?r.toFixed(0):0}`}function GY(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const l=r.localeCompare(s);if(l)return l}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim(),o=a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"});return o||0}function QY(e,t){return`${e}_sheet_${t}`}function XY(e,t){if(!t.length)return;const r=Object.keys(t[0]),s=[r.join(",")].concat(t.map(l=>r.map(c=>{const d=l[c],u=String(d??"").replace(/\n/g," ");return u.includes(",")||u.includes('"')?`"${u.replace(/"/g,'""')}"`:u}).join(","))).join(`
`),a=new Blob([s],{type:"text/csv"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function rf(e){return e.slice(-8)}function h8({subjectId:e,teachingAssignmentId:t,assessmentKey:r,skipMarkManager:s=!1}){var Gr,Cr,Rr;const a=r||"formative1",i=a==="formative2"?"Formative 2":"Formative 1",o=a==="formative2"?3:1,l=a==="formative2"?4:2,[c,d]=v.useState(!1),[u,h]=v.useState(null),[p,f]=v.useState([]),[x,g]=v.useState(null),[y,m]=v.useState({skill1:3,skill2:4,att1:3,att2:4}),[w,S]=v.useState(!1),[k,F]=v.useState(!1),[L,C]=v.useState(null),[O,T]=v.useState(null),[W,A]=v.useState(!1),N=v.useRef(null),[P,K]=v.useState(!1),{data:re,loading:ge,error:Fe,remainingSeconds:R,publishAllowed:q,refresh:me}=Ru({assessment:a,subjectCode:String(e||""),teachingAssignmentId:t}),fe=!!(re!=null&&re.global_override_active&&(re==null?void 0:re.global_is_open)===!1),[E,U]=v.useState(""),[I,M]=v.useState(!1),[te,Q]=v.useState(null),[G,ne]=v.useState(null),[z,he]=v.useState({termLabel:"KRCT AY25-26",batchLabel:e||"",rowsByStudentId:{},markManagerLocked:!1,markManagerSnapshot:null,markManagerApprovalUntil:null}),{data:X,refresh:H}=Bu({assessment:a,subjectCode:String(e||""),teachingAssignmentId:t,options:{poll:!1}}),{data:oe,refresh:D}=Xo({assessment:a,subjectCode:String(e||""),scope:"MARK_MANAGER",teachingAssignmentId:t,options:{poll:!0}}),{data:Y,refresh:le}=Xo({assessment:a,subjectCode:String(e||""),scope:"MARK_ENTRY",teachingAssignmentId:t,options:{poll:!0}}),[$e,je]=v.useState(null),We=!!O||!!(X!=null&&X.exists&&(X!=null&&X.is_published)),Ee=s?!0:!!z.markManagerLocked,Re=Y!=null&&Y.approval_until?String(Y.approval_until):null,Ve=oe!=null&&oe.approval_until?String(oe.approval_until):null,St=!!(Y!=null&&Y.allowed_by_approval)&&!!Re&&Re!==(($e==null?void 0:$e.markEntryApprovalUntil)??null),rt=!!(oe!=null&&oe.allowed_by_approval)&&!!Ve&&Ve!==(($e==null?void 0:$e.markManagerApprovalUntil)??null),ze=We?!!(X!=null&&X.entry_open)||St||rt:!0,Ie=!!(We&&!ze),ot=!!(We&&Ie),be=s?!!(fe||We&&!ze):!!(fe||(We?!ze:!Ee)),we=s?!0:z.markManagerSnapshot!=null||!!We,[Me,Wt]=v.useState(null),[Ct,pr]=v.useState(!1),fr=We,[Be,mt]=v.useState(!1),[It,ft]=v.useState(null),[gr,Mr]=v.useState(!1),[$r,_r]=v.useState(null),[Vr,en]=v.useState(!1),[Xr,gn]=v.useState(""),[Oe,qe]=v.useState(!1),Lt=String((G==null?void 0:G.termLabel)||"KRCT AY25-26"),dt=((Gr=G==null?void 0:G.assessments)==null?void 0:Gr[a])??((Cr=G==null?void 0:G.assessments)==null?void 0:Cr.formative1)??{},He=Number.isFinite(Number(dt==null?void 0:dt.maxPart))?Number(dt.maxPart):qY,$t=Number.isFinite(Number(dt==null?void 0:dt.maxTotal))?Number(dt.maxTotal):HY,Ue=Number.isFinite(Number(dt==null?void 0:dt.maxCo))?Number(dt.maxCo):VY,er=v.useMemo(()=>{const De=z.markManagerSnapshot;if(!De)return null;try{const Ke=JSON.parse(String(De)),Ce=Ke==null?void 0:Ke.partBtl;if(!Ce||typeof Ce!="object")return null;const it={};for(const tr of["skill1","skill2","att1","att2"]){const Kt=Ce[tr];it[tr]=Kt===""||Kt==null?"":Number(Kt),it[tr]===""||Number.isFinite(it[tr])&&it[tr]>=1&&it[tr]<=6||(it[tr]="")}return it}catch{return null}},[z.markManagerSnapshot]);v.useEffect(()=>{je(null)},[e]);const Z=er||y,pe=async De=>{if(e){De||(_r(null),Mr(!0));try{const Ke=await bu(a,e),Ce=Ke&&Ke.marks&&typeof Ke.marks=="object"?Ke.marks:null;Ce&&Object.keys(Ce).length?ft(Ce):ft(null)}catch(Ke){De||_r((Ke==null?void 0:Ke.message)||"Failed to load published marks")}finally{De||Mr(!1)}}};v.useEffect(()=>{Be&&(ft(null),pe(!1))},[Be,e,a]);const ee=v.useRef(!!ze);v.useEffect(()=>{if(!e||!We)return;if(ee.current||!ze){ee.current=!!ze;return}let Ke=!0;return(async()=>{try{const Ce=await En(a,String(e));if(!Ke)return;const it=Ce==null?void 0:Ce.draft,tr=it==null?void 0:it.sheet,Kt=it==null?void 0:it.partBtl;if(tr&&typeof tr=="object"&&typeof tr.rowsByStudentId=="object"&&he(yt=>({...yt,termLabel:String(tr.termLabel||Lt||"KRCT AY25-26"),batchLabel:String(e),rowsByStudentId:tr.rowsByStudentId||{},markManagerLocked:typeof tr.markManagerLocked=="boolean"?tr.markManagerLocked:!!(tr.markManagerSnapshot??yt.markManagerSnapshot),markManagerSnapshot:tr.markManagerSnapshot??yt.markManagerSnapshot??null,markManagerApprovalUntil:tr.markManagerApprovalUntil??yt.markManagerApprovalUntil??null})),Kt&&typeof Kt=="object"){const yt={};for(const Ht of["skill1","skill2","att1","att2"]){const qt=Kt[Ht];yt[Ht]=qt===""||qt==null?"":Number(qt),yt[Ht]===""||Number.isFinite(yt[Ht])&&yt[Ht]>=1&&yt[Ht]<=6||(yt[Ht]="")}m(yt)}}catch{}})(),ee.current=!!ze,()=>{Ke=!1}},[ze,We,e,a,Lt]),v.useEffect(()=>{if(!e||!We||ze)return;const De=window.setInterval(()=>{H({silent:!0});try{le==null||le({silent:!0}),D==null||D({silent:!0})}catch{}},3e4);return()=>window.clearInterval(De)},[ze,We,e,H,le,D]);async function ue(){if(!e)return;qe(!0);const De=new Date,Ke=Y!=null&&Y.approval_until?String(Y.approval_until):null;try{const Ce=await Yi({assessment:a,subject_code:String(e),scope:"MARK_ENTRY",reason:Xr||`Edit request: ${i} marks for ${e}`,teaching_assignment_id:t});alert("Edit request sent to IQAC. Waiting for approval..."),en(!1);const it=Number(Ce==null?void 0:Ce.id),Kt=De.getTime()-2e3;(async()=>{if(!e)return;const yt=36,Ht=5e3;for(let qt=0;qt<yt;qt++){try{const lr=await lp({assessment:a,subject_code:String(e),scope:"MARK_ENTRY",teaching_assignment_id:t}),Mt=lr==null?void 0:lr.result;if(!(Mt&&Number.isFinite(it)&&Mt.id!==it)){if((Mt==null?void 0:Mt.status)==="APPROVED"&&(Mt!=null&&Mt.is_active)){const tt=Mt.reviewed_at?new Date(Mt.reviewed_at).getTime():NaN;if(!(!Number.isFinite(tt)||tt<Kt)){try{le==null||le({silent:!0}),H({silent:!0})}catch{}alert("IQAC approved the edit request. You can now edit marks.");return}}else if((Mt==null?void 0:Mt.status)==="REJECTED"){const tt=Mt.reviewed_at?new Date(Mt.reviewed_at).getTime():NaN;if(!(!Number.isFinite(tt)||tt<Kt)){alert("IQAC rejected the edit request.");return}}}}catch{try{const Mt=await ip(a,String(e),"MARK_ENTRY",t),tt=Mt!=null&&Mt.approval_until?String(Mt.approval_until):null;if(Mt!=null&&Mt.allowed_by_approval&&tt&&tt!==Ke){try{le==null||le({silent:!0}),H({silent:!0})}catch{}alert("IQAC approved the edit request. You can now edit marks.");return}}catch{}}await new Promise(lr=>setTimeout(lr,Ht))}alert("Edit request still pending. Please try again later.")})()}catch(Ce){alert((Ce==null?void 0:Ce.message)||"Request failed")}finally{qe(!1)}}v.useEffect(()=>{let De=!0;return(async()=>{try{const Ke=await Sl();if(!De)return;ne(Ke||null),he(Ce=>({...Ce,termLabel:String((Ke==null?void 0:Ke.termLabel)||Ce.termLabel||"KRCT AY25-26"),batchLabel:e||Ce.batchLabel}))}catch{}})(),()=>{De=!1}},[e]);const Ae=v.useMemo(()=>e?QY(a,e):"",[a,e]),Le=v.useMemo(()=>[{key:"skill1",label:"Skill 1",max:He},{key:"skill2",label:"Skill 2",max:He},{key:"att1",label:"Attitude 1",max:He},{key:"att2",label:"Attitude 2",max:He}],[He]);(Rr=Le[Le.length-1])==null||Rr.key;const ct=v.useMemo(()=>{const De=new Set;for(const Ke of Object.keys(y)){const Ce=y[Ke];(Ce===1||Ce===2||Ce===3||Ce===4||Ce===5||Ce===6)&&De.add(Ce)}return[1,2,3,4,5,6].filter(Ke=>De.has(Ke))},[y]),ce=v.useMemo(()=>12+ct.length*2,[ct.length]);v.useEffect(()=>{if(e){const De=`${a}_part_btl_${e}`,Ke=Bn(De);if(Ke&&typeof Ke=="object")try{const Ce={};for(const it of Object.keys(y)){const tr=Ke[it];Ce[it]=tr===""||tr==null?"":Number(tr),Ce[it]===""||Number.isFinite(Ce[it])&&Ce[it]>=1&&Ce[it]<=6||(Ce[it]="")}m(Ce)}catch{}}},[e,a]),v.useEffect(()=>{if(!e)return;const De=`${a}_part_btl_${e}`;try{yn(De,y)}catch{}},[y,e,a]);const xe=De=>JSON.stringify({assessmentKey:a,partBtl:De,maxPart:He,maxTotal:$t});async function se(){if(e){pr(!0);try{const De=xe(y),Ke=oe!=null&&oe.approval_until?String(oe.approval_until):z.markManagerApprovalUntil||null,Ce={...z,markManagerLocked:!0,markManagerSnapshot:De,markManagerApprovalUntil:Ke},it={sheet:Ce,partBtl:y,markManagerLocked:Ce.markManagerLocked,markManagerSnapshot:Ce.markManagerSnapshot,markManagerApprovalUntil:Ce.markManagerApprovalUntil};he(Ce),Wt(null),await Fs(a,String(e),it),C(new Date().toLocaleString());try{await kd(a,String(e),t),H({silent:!0})}catch{}}catch{}finally{pr(!1)}}}async function Se(){if(!e)return;pr(!0);const De=new Date,Ke=oe!=null&&oe.approval_until?String(oe.approval_until):null;try{const Ce=await Yi({assessment:a,subject_code:String(e),scope:"MARK_MANAGER",reason:`Request mark-manager edit for ${e}`,teaching_assignment_id:t});alert("Edit request sent to IQAC. Waiting for approval...");const it=Number(Ce==null?void 0:Ce.id),Kt=De.getTime()-2e3;(async()=>{if(!e)return;const yt=36,Ht=5e3;for(let qt=0;qt<yt;qt++){try{const lr=await lp({assessment:a,subject_code:String(e),scope:"MARK_MANAGER",teaching_assignment_id:t}),Mt=lr==null?void 0:lr.result;if(!(Mt&&Number.isFinite(it)&&Mt.id!==it)){if((Mt==null?void 0:Mt.status)==="APPROVED"&&(Mt!=null&&Mt.is_active)){const tt=Mt.reviewed_at?new Date(Mt.reviewed_at).getTime():NaN;if(!(!Number.isFinite(tt)||tt<Kt)){try{D==null||D({silent:!0}),H({silent:!0})}catch{}alert("IQAC approved the mark-manager edit request. You can now edit mark-manager settings.");return}}else if((Mt==null?void 0:Mt.status)==="REJECTED"){const tt=Mt.reviewed_at?new Date(Mt.reviewed_at).getTime():NaN;if(!(!Number.isFinite(tt)||tt<Kt)){alert("IQAC rejected the mark-manager edit request.");return}}}}catch{try{const Mt=await ip(a,String(e),"MARK_MANAGER",t),tt=Mt!=null&&Mt.approval_until?String(Mt.approval_until):null;if(Mt!=null&&Mt.allowed_by_approval&&tt&&tt!==Ke){try{D==null||D({silent:!0}),H({silent:!0})}catch{}alert("IQAC approved the mark-manager edit request. You can now edit mark-manager settings.");return}}catch{}}await new Promise(lr=>setTimeout(lr,Ht))}alert("Edit request still pending. Please try again later.")})()}catch(Ce){alert((Ce==null?void 0:Ce.message)||"Request failed")}finally{pr(!1)}}v.useEffect(()=>{if(!e)return;let De=!1;const Ke=setTimeout(async()=>{try{await Fs(a,e,{sheet:z,partBtl:y});try{Ae&&yn(Ae,{termLabel:z.termLabel,batchLabel:z.batchLabel,rowsByStudentId:z.rowsByStudentId})}catch{}De||C(new Date().toLocaleString())}catch{}},700);return()=>{De=!0,clearTimeout(Ke)}},[y,e,a,z,Ae]),v.useEffect(()=>{let De=!0;return(async()=>{if(e)try{const Ke=await En(a,e);if(!De)return;const Ce=Ke==null?void 0:Ke.draft,it=Ce==null?void 0:Ce.sheet,tr=Ce==null?void 0:Ce.partBtl,Kt=Ce==null?void 0:Ce.selectedBtls;if(it&&typeof it=="object"&&typeof it.rowsByStudentId=="object"){he({termLabel:String(it.termLabel||Lt||"KRCT AY25-26"),batchLabel:String(e),rowsByStudentId:it.rowsByStudentId||{},markManagerLocked:typeof it.markManagerLocked=="boolean"?it.markManagerLocked:!!it.markManagerSnapshot,markManagerSnapshot:it.markManagerSnapshot??null,markManagerApprovalUntil:it.markManagerApprovalUntil??null});try{Ae&&yn(Ae,{termLabel:String(it.termLabel||Lt||"KRCT AY25-26"),batchLabel:String(e),rowsByStudentId:it.rowsByStudentId||{}})}catch{}}if(tr&&typeof tr=="object"){const yt={};for(const Ht of Object.keys(y)){const qt=tr[Ht];yt[Ht]=qt===""||qt==null?"":Number(qt),yt[Ht]===""||Number.isFinite(yt[Ht])&&yt[Ht]>=1&&yt[Ht]<=6||(yt[Ht]="")}m(yt);try{const Ht=`${a}_part_btl_${e}`;yn(Ht,yt)}catch{}}else if(Array.isArray(Kt)){const yt=qt=>Number.isFinite(qt)&&qt>=1&&qt<=6,Ht=Kt.map(qt=>Number(qt)).filter(yt);if(Ht.length===1){const qt={skill1:Ht[0],skill2:Ht[0],att1:Ht[0],att2:Ht[0]};m(qt);try{const lr=`${a}_part_btl_${e}`;yn(lr,qt)}catch{}}else if(Ht.length>=2){const qt={skill1:Ht[0],skill2:Ht[1],att1:Ht[0],att2:Ht[1]};m(qt);try{const lr=`${a}_part_btl_${e}`;yn(lr,qt)}catch{}}}}catch{}})(),()=>{De=!1}},[e,Lt,a,Ae]),v.useEffect(()=>{let De=!0;return(async()=>{if(e){d(!0),h(null);try{let Ce=[],it=null;try{const qt=await wl();console.log("[Formative] My TAs:",qt==null?void 0:qt.length,"for subject:",e,"teachingAssignmentId:",t),it=(qt||[]).find(lr=>{const Mt=String(lr.subject_code||"").trim().toUpperCase()===String(e||"").trim().toUpperCase();return(t?lr.id===t:!1)||Mt}),it?console.log("[Formative] Found TA match:",it.id,"elective_subject_id:",it.elective_subject_id,"section_id:",it.section_id):console.log("[Formative] No TA match found in user TAs")}catch(qt){console.warn("[Formative] My TAs fetch failed:",qt)}if(it&&it.elective_subject_id&&!it.section_id){console.log("[Formative] Detected elective, fetching elective-choices for elective_subject_id:",it.elective_subject_id);try{const qt=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(it.elective_subject_id))}`);if(qt.ok){const lr=await qt.json(),Mt=Array.isArray(lr.results)?lr.results:Array.isArray(lr)?lr:lr.items||[];console.log("[Formative] Elective choices returned:",Mt==null?void 0:Mt.length,"students"),Ce=(Mt||[]).map(tt=>({id:Number(tt.student_id??tt.id),reg_no:String(tt.reg_no??tt.regno??""),name:String(tt.name??tt.full_name??tt.username??""),section:tt.section_name??tt.section??null})).filter(tt=>Number.isFinite(tt.id)),De&&g({subject_name:it.subject_name,section:it.section_name||"Elective"})}else console.warn("[Formative] Elective-choices API returned error:",qt.status)}catch(qt){console.warn("[Formative] Elective-choices fetch failed:",qt)}}if(!Ce.length&&it&&it.id){console.log("[Formative] Fetching regular TA roster for TA ID:",it.id);try{Ce=((await Jo(it.id)).students||[]).map(lr=>({id:Number(lr.id),reg_no:String(lr.reg_no??""),name:String(lr.name??""),section:lr.section??null})).filter(lr=>Number.isFinite(lr.id)),console.log("[Formative] Regular roster returned:",Ce.length,"students"),De&&g({subject_name:it.subject_name,section:it.section_name})}catch(qt){console.warn("[Formative] TA roster fetch failed:",qt)}}console.log("[Formative] Final roster count:",Ce.length),Ce.sort(GY),De&&f(Ce);let tr=null;try{const qt=await bu(a,e);qt&&qt.marks&&typeof qt.marks=="object"&&Object.keys(qt.marks||{}).length&&(tr=qt.marks,T(new Date().toLocaleString()))}catch{}const Kt=Ae?Bn(Ae):null,yt=tr?{termLabel:G!=null&&G.termLabel?String(G.termLabel):Lt||"KRCT AY25-26",batchLabel:String(e||""),rowsByStudentId:Object.fromEntries(Object.entries(tr).map(([qt,lr])=>[qt,{studentId:Number(qt),skill1:ma(lr==null?void 0:lr.skill1),skill2:ma(lr==null?void 0:lr.skill2),att1:ma(lr==null?void 0:lr.att1),att2:ma(lr==null?void 0:lr.att2)}]))}:Kt&&typeof Kt=="object"?{termLabel:G!=null&&G.termLabel?String(G.termLabel):String(Kt.termLabel||"KRCT AY25-26"),batchLabel:String(e||Kt.batchLabel||""),rowsByStudentId:Kt.rowsByStudentId&&typeof Kt.rowsByStudentId=="object"?Kt.rowsByStudentId:{}}:{termLabel:Lt||"KRCT AY25-26",batchLabel:String(e||""),rowsByStudentId:{}},Ht={...yt.rowsByStudentId};for(const qt of Ce){const lr=String(qt.id),Mt=Ht[lr];Ht[lr]={studentId:qt.id,skill1:typeof(Mt==null?void 0:Mt.skill1)=="number"?ln(Number(Mt==null?void 0:Mt.skill1),0,He):"",skill2:typeof(Mt==null?void 0:Mt.skill2)=="number"?ln(Number(Mt==null?void 0:Mt.skill2),0,He):"",att1:typeof(Mt==null?void 0:Mt.att1)=="number"?ln(Number(Mt==null?void 0:Mt.att1),0,He):"",att2:typeof(Mt==null?void 0:Mt.att2)=="number"?ln(Number(Mt==null?void 0:Mt.att2),0,He):""}}he({...yt,termLabel:yt.termLabel||Lt,batchLabel:String(e||yt.batchLabel||""),rowsByStudentId:Ht})}catch(Ce){if(!De)return;h((Ce==null?void 0:Ce.message)||`Failed to load ${i} roster`),f([])}finally{De&&d(!1)}}})(),()=>{De=!1}},[e,Ae,G,Lt,He,i]);const Ze=(De,Ke)=>{be||Ie||he(Ce=>{const it=String(De),Kt={...Ce.rowsByStudentId[it]||{studentId:De,skill1:"",skill2:"",att1:"",att2:""},...Ke,studentId:De},yt=Ht=>{if(Ht===""||Ht==null)return"";const qt=Number(Ht),lr=Number.isFinite(qt)?Math.round(qt):NaN,Mt=ln(lr,0,He);return Number.isFinite(Mt)?Mt:""};return{...Ce,rowsByStudentId:{...Ce.rowsByStudentId,[it]:{...Kt,skill1:yt(Kt.skill1),skill2:yt(Kt.skill2),att1:yt(Kt.att1),att2:yt(Kt.att2)}}}})},et=async()=>{if(e){S(!0),h(null);try{await Fs(a,e,{sheet:z,partBtl:y}),C(new Date().toLocaleString())}catch(De){h((De==null?void 0:De.message)||`Failed to save ${i} draft`)}finally{S(!1)}}},Et=async()=>{if(!e)return;if(fe){h("Publishing is locked by IQAC.");return}if(!q){h("Publish window is closed. Please request IQAC approval.");return}if(We&&Ie){en(!0);return}F(!0),h(null);const De=O,Ke=z.markManagerLocked,Ce=$e,it={markEntryApprovalUntil:Re,markManagerApprovalUntil:Ve};try{T(new Date().toLocaleString()),je(it),he(tr=>({...tr,markManagerLocked:!0})),await rA(a,e,z,t),me(),H({silent:!0}),pe(!0);try{window.dispatchEvent(new CustomEvent("obe:published",{detail:{subjectId:e,assessment:a}}))}catch{}}catch(tr){const Kt=String((tr==null?void 0:tr.message)||"");Kt.includes("locked after publish")||Kt.includes("Marks entry is locked")?(T(new Date().toLocaleString()),je(it),he(yt=>({...yt,markManagerLocked:!0})),h(null)):(T(De??null),he(yt=>({...yt,markManagerLocked:Ke})),je(Ce??null),h(Kt||`Failed to publish ${i}`))}finally{try{if(e){const tr=await sg(a,String(e),t);tr!=null&&tr.exists&&(tr!=null&&tr.is_published)&&(T(new Date().toLocaleString()),he(Kt=>({...Kt,markManagerLocked:!0})),je(Kt=>Kt??it),pe(!0),H({silent:!0}),me(),h(null))}}catch{}F(!1)}},wt=()=>{if(!e)return;const De=p.map((Ke,Ce)=>{const it=z.rowsByStudentId[String(Ke.id)]||{studentId:Ke.id,skill1:"",skill2:"",att1:"",att2:""},tr=typeof it.skill1=="number"?ln(Number(it.skill1),0,He):null,Kt=typeof it.skill2=="number"?ln(Number(it.skill2),0,He):null,yt=typeof it.att1=="number"?ln(Number(it.att1),0,He):null,Ht=typeof it.att2=="number"?ln(Number(it.att2),0,He):null,qt=tr!=null&&Kt!=null&&yt!=null&&Ht!=null?ln(tr+Kt+yt+Ht,0,$t):"",lr=tr!=null&&yt!=null?ln(tr+yt,0,Ue):"",Mt=Kt!=null&&Ht!=null?ln(Kt+Ht,0,Ue):"",tt=[0,0,0,0,0,0];for(const bt of Le){const V=y[bt.key];(V===1||V===2||V===3||V===4||V===5||V===6)&&(tt[V-1]+=bt.max)}const Ft=ct.map(bt=>bt-1),Qt=typeof qt=="number"&&Ft.length?Mo(qt/Ft.length):"",At=tt.map((bt,V)=>Qt===""||!Ft.includes(V)?"":bt>0?ln(Qt,0,bt):Mo(Qt));return{sno:Ce+1,registerNo:Ke.reg_no,name:Ke.name,skill1:tr??"",skill2:Kt??"",att1:yt??"",att2:Ht??"",total:qt===""?"":qt,[`co${o}_mark`]:lr===""?"":lr,[`co${o}_pct`]:lr===""?"":Ms(lr,Ue),[`co${l}_mark`]:Mt===""?"":Mt,[`co${l}_pct`]:Mt===""?"":Ms(Mt,Ue),btl1_mark:At[0]??"",btl1_pct:At[0]===""?"":Ms(Number(At[0]),tt[0]),btl2_mark:At[1]??"",btl2_pct:At[1]===""?"":Ms(Number(At[1]),tt[1]),btl3_mark:At[2]??"",btl3_pct:At[2]===""?"":Ms(Number(At[2]),tt[2]),btl4_mark:At[3]??"",btl4_pct:At[3]===""?"":Ms(Number(At[3]),tt[3]),btl5_mark:At[4]??"",btl5_pct:At[4]===""?"":Ms(Number(At[4]),tt[4]),btl6_mark:At[5]??"",btl6_pct:At[5]===""?"":Ms(Number(At[5]),tt[5])}});XY(`${e}_${a.toUpperCase()}_sheet.csv`,De)},gt=async()=>{if(!e)return;const De=p.map((Ke,Ce)=>{const it=z.rowsByStudentId[String(Ke.id)]||{studentId:Ke.id,skill1:"",skill2:"",att1:"",att2:""},tr=typeof it.skill1=="number"?ln(Number(it.skill1),0,He):null,Kt=typeof it.skill2=="number"?ln(Number(it.skill2),0,He):null,yt=typeof it.att1=="number"?ln(Number(it.att1),0,He):null,Ht=typeof it.att2=="number"?ln(Number(it.att2),0,He):null,qt=tr!=null&&Kt!=null&&yt!=null&&Ht!=null?ln(tr+Kt+yt+Ht,0,$t):"";return{sno:Ce+1,regNo:String(Ke.reg_no||""),name:String(Ke.name||""),total:qt===""?"":qt}});await Qp({filenameBase:`${e}_${i}`,meta:{courseName:String((x==null?void 0:x.subject_name)||""),courseCode:String(e||""),className:String((x==null?void 0:x.section)||"")},rows:De})};function zt(De){return String(De??"").trim().toLowerCase().replace(/\s+/g," ")}const Dt=()=>{if(!e||!p.length)return;const De=Kt=>`${Kt} (${Number(He).toFixed(2)})`,Ke=["Register No","Student Name",De("Skill 1"),De("Skill 2"),De("Attitude 1"),De("Attitude 2"),"Status"],Ce=p.map(Kt=>{const yt=z.rowsByStudentId[String(Kt.id)];return[Kt.reg_no,Kt.name,(yt==null?void 0:yt.skill1)??"",(yt==null?void 0:yt.skill2)??"",(yt==null?void 0:yt.att1)??"",(yt==null?void 0:yt.att2)??"","present"]}),it=gi.aoa_to_sheet([Ke,...Ce]);it["!freeze"]={xSplit:0,ySplit:1};const tr=gi.book_new();gi.book_append_sheet(tr,it,i),vg(tr,`${e}_${a.toUpperCase()}_template.xlsx`)},mr=()=>{var De;be||Ie||(De=N.current)==null||De.click()},pt=async De=>{var Ke;if(e&&!(be||Ie)){K(!0);try{const Ce=await De.arrayBuffer(),it=u0(Ce,{type:"array"}),tr=(Ke=it.SheetNames)==null?void 0:Ke[0];if(!tr)throw new Error("No sheet found in the Excel file.");const Kt=it.Sheets[tr],yt=gi.sheet_to_json(Kt,{header:1});if(!yt.length)throw new Error("Excel sheet is empty.");const Ht=(yt[0]||[]).map(zt),qt=ie=>Ht.findIndex(_e=>ie(_e)),lr=qt(ie=>ie==="register no"||ie==="reg no"||ie.includes("register")),Mt=qt(ie=>ie.startsWith("skill 1")||ie.startsWith("skill1")),tt=qt(ie=>ie.startsWith("skill 2")||ie.startsWith("skill2")),Ft=qt(ie=>ie.startsWith("attitude 1")||ie.startsWith("att1")||ie.startsWith("attitude1")),Qt=qt(ie=>ie.startsWith("attitude 2")||ie.startsWith("att2")||ie.startsWith("attitude2")),At=qt(ie=>ie==="status"||ie.includes("status"));if(lr<0)throw new Error("Could not find Register No column.");const bt=new Map;for(const ie of p){const _e=String(ie.reg_no||"").trim();_e&&bt.set(_e,ie.id);const Je=rf(_e);Je&&bt.set(Je,ie.id)}const V=ie=>ie==null||!Number.isFinite(ie)||ie<=0?"":ln(Number(ie),1,He);he(ie=>{const _e={...ie.rowsByStudentId};for(let Je=1;Je<yt.length;Je++){const Nt=yt[Je]||[],Bt=String(Nt[lr]??"").trim();if(!Bt)continue;const jt=bt.get(Bt);if(!jt)continue;const sr=(At>=0?String(Nt[At]??""):"").trim().toLowerCase(),Fr=sr==="absent"||sr==="ab"||sr==="a",Nr=_e[String(jt)]||{studentId:jt,skill1:"",skill2:"",att1:"",att2:""};if(Fr){_e[String(jt)]={...Nr,skill1:"",skill2:"",att1:"",att2:""};continue}const Pt=Mt>=0?V(ex(Nt[Mt])):Nr.skill1,Ot=tt>=0?V(ex(Nt[tt])):Nr.skill2,Tr=Ft>=0?V(ex(Nt[Ft])):Nr.att1,vr=Qt>=0?V(ex(Nt[Qt])):Nr.att2;_e[String(jt)]={...Nr,studentId:jt,skill1:Pt,skill2:Ot,att1:Tr,att2:vr}}return{...ie,rowsByStudentId:_e}})}finally{K(!1)}}},Xt=async De=>{var Ce;const Ke=(Ce=De.target.files)==null?void 0:Ce[0];if(De.target.value="",!!Ke)try{await pt(Ke)}catch(it){h((it==null?void 0:it.message)||"Failed to import Excel")}};if(!e)return n.jsxs("div",{style:{color:"#6b7280"},children:["Select a course to start ",i," entry."]});if(c)return n.jsxs("div",{style:{color:"#6b7280"},children:["Loading ",i," roster"]});const Rt={border:"1px solid #111",padding:"6px 6px",background:"#ecfdf5",color:"#065f46",textAlign:"center",fontWeight:700,fontSize:12,whiteSpace:"nowrap"},_t={border:"1px solid #111",padding:"6px 6px",fontSize:12,whiteSpace:"nowrap"},jr={width:"100%",border:"none",outline:"none",background:"transparent",fontSize:12,textAlign:"center"};return n.jsxs("div",{children:[u&&n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10},children:u}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap",marginBottom:10},children:[n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{onClick:wt,className:"obe-btn obe-btn-secondary",disabled:p.length===0,children:"Export CSV"}),n.jsx("button",{onClick:Dt,className:"obe-btn obe-btn-secondary",disabled:p.length===0,children:"Export Excel"}),n.jsx("button",{onClick:mr,className:"obe-btn obe-btn-secondary",disabled:p.length===0||be||Ie||P,children:P?"Importing":"Import Excel"}),n.jsx("input",{ref:N,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:Xt})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[n.jsx("button",{onClick:gt,className:"obe-btn obe-btn-secondary",disabled:p.length===0,children:"Download"}),n.jsx("button",{onClick:et,className:"obe-btn obe-btn-success",disabled:w||p.length===0,children:w?"Saving":"Save Draft"}),n.jsx("button",{onClick:Et,disabled:k||p.length===0||!q,className:"obe-btn obe-btn-primary",children:k?"Publishing":"Publish"}),L&&n.jsxs("div",{style:{fontSize:12,color:"#6b7280",alignSelf:"center"},children:["Draft: ",L]}),O&&n.jsxs("div",{style:{fontSize:12,color:"#16a34a",alignSelf:"center"},children:["Published: ",O]})]})]}),n.jsx("div",{style:{marginBottom:10,fontSize:12,color:q?"#065f46":"#b91c1c"},children:ge?"Checking publish due time":Fe||(re!=null&&re.due_at?n.jsxs(n.Fragment,{children:["Due: ",new Date(re.due_at).toLocaleString(),"  Remaining: ",_0(R),re.allowed_by_approval&&re.approval_until?n.jsxs(n.Fragment,{children:["  Approved until ",new Date(re.approval_until).toLocaleString()]}):null]}):"Due time not set by IQAC.")}),fe?n.jsxs("div",{style:{marginBottom:10,border:"1px solid #fde68a",background:"#fffbeb",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publishing disabled by IQAC"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Global publishing is turned OFF for this assessment. You can view the sheet, but editing and publishing are locked."}),n.jsx("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:10},children:n.jsx("button",{className:"obe-btn",onClick:()=>me(),disabled:ge,children:"Refresh"})})]}):null,n.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff",marginBottom:10},children:n.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[n.jsxs("label",{style:{fontSize:12,color:"#374151",display:"flex",alignItems:"center"},children:["Term",n.jsx("div",{style:{marginLeft:8,padding:6,border:"1px solid #d1d5db",borderRadius:8,minWidth:160},children:z.termLabel})]}),n.jsxs("label",{style:{fontSize:12,color:"#374151",display:"flex",alignItems:"center"},children:["Sheet Label",n.jsx("div",{style:{marginLeft:8,padding:6,border:"1px solid #d1d5db",borderRadius:8,minWidth:160},children:z.batchLabel})]}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280",alignSelf:"center"},children:["Skill/Attitude max: ",He," each | Total: ",$t," | CO-",o,": ",Ue," | CO-",l,": ",Ue]})]})}),p.length===0?n.jsx("div",{style:{color:"#6b7280",fontSize:14,padding:"12px 0"},children:"No students found for this subject."}):n.jsx(k0,{locked:fe,children:we?W&&We?n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10,position:"relative"},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"View Only"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280",marginRight:36},children:[i,"  ",String(e||"")]}),n.jsx("button",{className:"obe-btn",onClick:()=>A(!1),style:{position:"absolute",right:0,top:0},children:"Close"})]}),gr?n.jsx("div",{style:{color:"#6b7280"},children:"Loading published marks"}):null,$r?n.jsx("div",{style:{color:"#991b1b",fontSize:12,marginBottom:8},children:$r}):null,It&&Object.keys(It).length||p.length?n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{className:"obe-table",style:{width:"max-content",minWidth:"100%",borderCollapse:"collapse"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Rt,colSpan:ce,children:[z.termLabel," | ",z.batchLabel," | ",i.toUpperCase()," (PUBLISHED)"]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...Rt,width:42,minWidth:42},children:"S.No"}),n.jsx("th",{style:Rt,children:"Register No."}),n.jsx("th",{style:Rt,children:"Name of the Students"}),n.jsx("th",{style:Rt,children:"Skill 1"}),n.jsx("th",{style:Rt,children:"Skill 2"}),n.jsx("th",{style:Rt,children:"Att 1"}),n.jsx("th",{style:Rt,children:"Att 2"}),n.jsx("th",{style:Rt,children:"Total"}),n.jsxs("th",{style:Rt,colSpan:2,children:["CO-",o]}),n.jsxs("th",{style:Rt,colSpan:2,children:["CO-",l]}),ct.map(De=>n.jsxs("th",{style:Rt,colSpan:2,children:["BTL-",De]},`pv_btl_${De}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"}),n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"}),ct.map(De=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"})]},`pv_btl_sub_${De}`))]})]}),n.jsx("tbody",{children:p.length?p.map((De,Ke)=>{const Ce=It&&It[String(De.id)]||{},it=typeof Ce.skill1=="number"?ln(Number(Ce.skill1),1,He):ma(Ce.skill1),tr=typeof Ce.skill2=="number"?ln(Number(Ce.skill2),1,He):ma(Ce.skill2),Kt=typeof Ce.att1=="number"?ln(Number(Ce.att1),1,He):ma(Ce.att1),yt=typeof Ce.att2=="number"?ln(Number(Ce.att2),1,He):ma(Ce.att2),Ht=it!==""&&tr!==""&&Kt!==""&&yt!==""?ln(it+tr+Kt+yt,0,$t):"",qt=it!==""&&Kt!==""?ln(it+Kt,0,Ue):"",lr=tr!==""&&yt!==""?ln(tr+yt,0,Ue):"",Mt=[0,0,0,0,0,0];for(const At of Le){const bt=Z[At.key];(bt===1||bt===2||bt===3||bt===4||bt===5||bt===6)&&(Mt[bt-1]+=At.max)}const tt=ct.map(At=>At-1),Ft=typeof Ht=="number"&&tt.length?Mo(Ht/tt.length):"",Qt=Mt.map((At,bt)=>Ft===""||!tt.includes(bt)?"":At>0?ln(Ft,0,At):Mo(Ft));return n.jsxs("tr",{children:[n.jsx("td",{style:{..._t,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:Ke+1}),n.jsx("td",{style:_t,children:rf(De.reg_no)}),n.jsx("td",{style:_t,children:De.name||""}),n.jsx("td",{style:{..._t,textAlign:"center"},children:it}),n.jsx("td",{style:{..._t,textAlign:"center"},children:tr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:Kt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:yt}),n.jsx("td",{style:{..._t,textAlign:"center",fontWeight:700},children:Ht}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(qt,Ue)})}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(lr,Ue)})}),ct.map(At=>{const bt=At-1,V=Qt[bt],ie=Mt[bt]??0;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._t,textAlign:"center"},children:V}),n.jsx("td",{style:{..._t,textAlign:"center"},children:V===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(Number(V),ie)})})]},`pv_btl_cells_${De.id}_${At}`)})]},`pv_${De.id}`)}):Object.keys(It||{}).map((De,Ke)=>{const Ce=It[De]||{},it=typeof Ce.skill1=="number"?ln(Number(Ce.skill1),1,He):ma(Ce.skill1),tr=typeof Ce.skill2=="number"?ln(Number(Ce.skill2),1,He):ma(Ce.skill2),Kt=typeof Ce.att1=="number"?ln(Number(Ce.att1),1,He):ma(Ce.att1),yt=typeof Ce.att2=="number"?ln(Number(Ce.att2),1,He):ma(Ce.att2),Ht=it!==""&&tr!==""&&Kt!==""&&yt!==""?ln(it+tr+Kt+yt,0,$t):"",qt=it!==""&&Kt!==""?ln(it+Kt,0,Ue):"",lr=tr!==""&&yt!==""?ln(tr+yt,0,Ue):"",Mt=[0,0,0,0,0,0];for(const At of Le){const bt=Z[At.key];(bt===1||bt===2||bt===3||bt===4||bt===5||bt===6)&&(Mt[bt-1]+=At.max)}const tt=ct.map(At=>At-1),Ft=typeof Ht=="number"&&tt.length?Mo(Ht/tt.length):"",Qt=Mt.map((At,bt)=>Ft===""||!tt.includes(bt)?"":At>0?ln(Ft,0,At):Mo(Ft));return n.jsxs("tr",{children:[n.jsx("td",{style:{..._t,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:Ke+1}),n.jsx("td",{style:_t,children:rf(String(Ce.reg_no??De))}),n.jsx("td",{style:_t,children:Ce.name||""}),n.jsx("td",{style:{..._t,textAlign:"center"},children:it}),n.jsx("td",{style:{..._t,textAlign:"center"},children:tr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:Kt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:yt}),n.jsx("td",{style:{..._t,textAlign:"center",fontWeight:700},children:Ht}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(qt,Ue)})}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(lr,Ue)})}),ct.map(At=>{const bt=At-1,V=Qt[bt],ie=Mt[bt]??0;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._t,textAlign:"center"},children:V}),n.jsx("td",{style:{..._t,textAlign:"center"},children:V===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(Number(V),ie)})})]},`pv_btl_cells_${De}_${At}`)})]},`pv_${De}`)})})]})}):gr?null:n.jsx("div",{style:{color:"#6b7280"},children:"No published marks found."}),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:n.jsx("button",{className:"obe-btn",onClick:()=>A(!1),children:"Close"})})]}):n.jsxs("div",{className:"obe-table-wrapper",style:{position:"relative"},children:[n.jsxs("table",{className:"obe-table",style:{minWidth:1200,pointerEvents:ot?"none":"auto"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Rt,colSpan:ce,children:[z.termLabel," | ",z.batchLabel," | ",i.toUpperCase()]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...Rt,width:42,minWidth:42},rowSpan:3,children:"S.No"}),n.jsx("th",{style:Rt,rowSpan:3,children:"Register No."}),n.jsx("th",{style:Rt,rowSpan:3,children:"Name of the Students"}),n.jsx("th",{style:Rt,colSpan:2,children:"Skill"}),n.jsx("th",{style:Rt,colSpan:2,children:"Attitude"}),n.jsx("th",{style:Rt,rowSpan:3,children:"Total"}),n.jsx("th",{style:Rt,colSpan:4,children:"CIA 1"}),ct.length?n.jsx("th",{style:Rt,colSpan:ct.length*2,children:"BTL"}):null]}),n.jsxs("tr",{children:[n.jsx("th",{style:Rt,children:"1"}),n.jsx("th",{style:Rt,children:"2"}),n.jsx("th",{style:Rt,children:"1"}),n.jsx("th",{style:Rt,children:"2"}),n.jsxs("th",{style:Rt,colSpan:2,children:["CO-",o]}),n.jsxs("th",{style:Rt,colSpan:2,children:["CO-",l]}),ct.map(De=>n.jsxs("th",{style:Rt,colSpan:2,children:["BTL-",De]},`btlhead-${De}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"}),n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"}),ct.map(De=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"})]},`btl-sub-${De}`))]})]}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"}}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"}}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:"BTL"}),Le.map(De=>n.jsx("td",{style:{..._t,textAlign:"center"},children:(()=>{const Ke=y[De.key]??"",Ce=Ke===""?"-":String(Ke);return n.jsxs("div",{style:{position:"relative",minWidth:44},children:[n.jsx("div",{style:{width:"100%",fontSize:12,padding:"2px 4px",border:"1px solid #d1d5db",borderRadius:8,background:"#fff",textAlign:"center",userSelect:"none"},title:`BTL: ${Ce}`,children:Ce}),n.jsxs("select",{"aria-label":`BTL for ${De.label}`,value:Ke,onChange:it=>{if(fe)return;const tr=z.markManagerSnapshot!=null;Ee&&tr||Ie||m(Kt=>({...Kt||{},[De.key]:it.target.value===""?"":Number(it.target.value)}))},style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none"},children:[n.jsx("option",{value:"",children:"-"}),[1,2,3,4,5,6].map(it=>n.jsx("option",{value:it,children:it},it))]})]})})()},`btl-select-${De.key}`)),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"}}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},colSpan:4}),ct.map(De=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"}}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"}})]},`btl-pad-${De}`))]}),n.jsxs("tr",{children:[n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},colSpan:3,children:"Name / Max Marks"}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:He}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:He}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:He}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:He}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:$t}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:Ue}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:"%"}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:Ue}),n.jsx("td",{style:{..._t,fontWeight:700,textAlign:"center"},children:"%"})]}),p.map((De,Ke)=>{const Ce=z.rowsByStudentId[String(De.id)]||{studentId:De.id,skill1:"",skill2:"",att1:"",att2:""},it=typeof Ce.skill1=="number"?ln(Number(Ce.skill1),0,He):"",tr=typeof Ce.skill2=="number"?ln(Number(Ce.skill2),0,He):"",Kt=typeof Ce.att1=="number"?ln(Number(Ce.att1),0,He):"",yt=typeof Ce.att2=="number"?ln(Number(Ce.att2),0,He):"",Ht=it!==""&&tr!==""&&Kt!==""&&yt!==""?ln(it+tr+Kt+yt,0,$t):"",qt=it!==""&&Kt!==""?ln(it+Kt,0,Ue):"",lr=tr!==""&&yt!==""?ln(tr+yt,0,Ue):"",Mt=[0,0,0,0,0,0];for(const V of Le){const ie=y[V.key];(ie===1||ie===2||ie===3||ie===4||ie===5||ie===6)&&(Mt[ie-1]+=V.max)}const tt=ct.map(V=>V-1),Ft=typeof Ht=="number"&&tt.length?Mo(Ht/tt.length):"",Qt=Mt.map((V,ie)=>Ft===""||!tt.includes(ie)?"":V>0?ln(Ft,0,V):Mo(Ft)),bt=ct.length===0||be||Ie||fe;return n.jsxs("tr",{children:[n.jsx("td",{style:{..._t,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:Ke+1}),n.jsx("td",{style:_t,children:rf(De.reg_no)}),n.jsx("td",{style:_t,children:De.name||""}),n.jsx("td",{style:_t,children:n.jsx("input",{style:jr,type:"number",min:0,max:He,value:Ce.skill1===""?"":Ce.skill1,disabled:bt,onChange:V=>{const ie=V.target.value;if(ie==="")return V.currentTarget.setCustomValidity(""),Ze(De.id,{skill1:""});const _e=Number(ie);if(Number.isFinite(_e)){if(_e>He){V.currentTarget.setCustomValidity(`Max mark is ${He}`),V.currentTarget.reportValidity(),window.setTimeout(()=>V.currentTarget.setCustomValidity(""),0);return}V.currentTarget.setCustomValidity(""),Ze(De.id,{skill1:_e})}}})}),n.jsx("td",{style:_t,children:n.jsx("input",{style:jr,type:"number",min:0,max:He,value:Ce.skill2===""?"":Ce.skill2,disabled:bt,onChange:V=>{const ie=V.target.value;if(ie==="")return V.currentTarget.setCustomValidity(""),Ze(De.id,{skill2:""});const _e=Number(ie);if(Number.isFinite(_e)){if(_e>He){V.currentTarget.setCustomValidity(`Max mark is ${He}`),V.currentTarget.reportValidity(),window.setTimeout(()=>V.currentTarget.setCustomValidity(""),0);return}V.currentTarget.setCustomValidity(""),Ze(De.id,{skill2:_e})}}})}),n.jsx("td",{style:_t,children:n.jsx("input",{style:jr,type:"number",min:0,max:He,value:Ce.att1===""?"":Ce.att1,disabled:bt,onChange:V=>{const ie=V.target.value;if(ie==="")return V.currentTarget.setCustomValidity(""),Ze(De.id,{att1:""});const _e=Number(ie);if(Number.isFinite(_e)){if(_e>He){V.currentTarget.setCustomValidity(`Max mark is ${He}`),V.currentTarget.reportValidity(),window.setTimeout(()=>V.currentTarget.setCustomValidity(""),0);return}V.currentTarget.setCustomValidity(""),Ze(De.id,{att1:_e})}}})}),n.jsx("td",{style:_t,children:n.jsx("input",{style:jr,type:"number",min:0,max:He,value:Ce.att2===""?"":Ce.att2,disabled:bt,onChange:V=>{const ie=V.target.value;if(ie==="")return V.currentTarget.setCustomValidity(""),Ze(De.id,{att2:""});const _e=Number(ie);if(Number.isFinite(_e)){if(_e>He){V.currentTarget.setCustomValidity(`Max mark is ${He}`),V.currentTarget.reportValidity(),window.setTimeout(()=>V.currentTarget.setCustomValidity(""),0);return}V.currentTarget.setCustomValidity(""),Ze(De.id,{att2:_e})}}})}),n.jsx("td",{style:{..._t,textAlign:"center",fontWeight:700},children:Ht}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(qt,Ue)})}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(lr,Ue)})}),ct.map(V=>{const ie=V-1,_e=Qt[ie],Je=Mt[ie]??0;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._t,textAlign:"center"},children:_e}),n.jsx("td",{style:{..._t,textAlign:"center"},children:_e===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(Number(_e),Je)})})]},`btl-cells-${V}`)})]},De.id)})]})]}),ct.length===0&&n.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(255,255,255,0.85)",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:10,padding:20,borderRadius:6},children:[n.jsx("div",{style:{fontSize:16,fontWeight:700},children:"BTL values not selected"}),n.jsx("div",{style:{color:"#6b7280"},children:"Assign BTL values in the BTL row below Skill/Attitude to enable entry."}),n.jsx("div",{style:{display:"flex",gap:8},children:n.jsx("button",{onClick:()=>{if(fe)return;const De=z.markManagerSnapshot!=null;Ee&&De||Ie||m({skill1:3,skill2:4,att1:3,att2:4})},style:{padding:"6px 10px"},children:"Quick: BTL-3/4"})})]}),be&&!fe&&!ot?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(239,246,255,0.65)",border:"1px solid rgba(59,130,246,0.25)",borderRadius:6,pointerEvents:"none"}}),n.jsxs("div",{style:{position:"absolute",left:"50%",top:16,transform:"translateX(-50%)",zIndex:40,width:280,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:12,borderRadius:12,boxShadow:"0 6px 18px rgba(17,24,39,0.06)",display:"flex",flexDirection:"column",gap:10,alignItems:"stretch"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:950,color:"#111827"},children:"Table Locked"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginTop:4},children:"Confirm the Mark Manager to unlock the student list."})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>Wt({mode:"confirm"}),disabled:!e||Ct,children:"Save Mark Manager"}),n.jsx("button",{className:"obe-btn",onClick:()=>Se(),disabled:Ct,children:"Request Access"})]})]})]}):null,ot&&!fe?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(180deg, rgba(34,197,94,0.18) 0%, rgba(16,185,129,0.26) 100%)",border:"1px solid rgba(22,163,74,0.25)",borderRadius:6,pointerEvents:"none"}}),n.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:40,width:320,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:12,borderRadius:12,boxShadow:"0 6px 18px rgba(17,24,39,0.06)",display:"flex",flexDirection:"column",gap:10,alignItems:"stretch"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:950,color:"#065f46"},children:"Published  Locked"}),n.jsx("div",{style:{fontSize:12,color:"#065f46",marginTop:4},children:"Marks are published. Use View or Request Edit to ask IQAC for access."})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[n.jsx("button",{className:"obe-btn",onClick:()=>{A(!0),ft(null);try{pe(!1)}catch{}},children:"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>ue(),children:"Request Edit"})]})]})]}):null]}):n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:20,background:"#fff"},children:[n.jsx("div",{style:{fontWeight:900,fontSize:16},children:fr?"Published  Locked":"Table Locked"}),n.jsx("div",{style:{color:"#6b7280",marginTop:8},children:fr?"Marks published. Use View or Request Edit to ask IQAC for access.":"Confirm the Mark Manager to unlock the student list."}),n.jsx("div",{style:{display:"flex",gap:8,marginTop:12,justifyContent:"flex-end"},children:fr?n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn",onClick:()=>{A(!0),ft(null);try{pe(!1)}catch{}},children:"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>ue(),children:"Request Edit"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>Wt({mode:"confirm"}),disabled:!e||Ct,children:"Save Mark Manager"}),n.jsx("button",{className:"obe-btn",onClick:()=>Se(),disabled:Ct,children:"Request Access"})]})})]})}),Me&&!s?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:9999},onClick:()=>{Ct||Wt(null)},children:n.jsxs("div",{style:{width:"min(640px,96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:De=>De.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:Me.mode==="confirm"?`Confirmation - ${i}`:`Request Edit - ${i}`}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:String(e||"")})]}),Me.mode==="confirm"?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"Confirm the selected BTL settings. After confirming, Mark Manager will be locked and the table will be editable."}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f9fafb"},children:[n.jsx("th",{style:{textAlign:"left",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Item"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Value"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"Skill/Attitude max"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:He})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"Total max"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:$t})]}),n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:["CO-",o," max"]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:Ue})]}),n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:["CO-",l," max"]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:Ue})]}),Le.map(De=>n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:[De.label," BTL"]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:n.jsxs("select",{className:"obe-input","aria-label":`BTL for ${De.label}`,value:y[De.key]??"",disabled:Ct||fe||Ie,onChange:Ke=>{if(fe||Ie)return;const Ce=Ke.target.value;m(it=>({...it||{},[De.key]:Ce===""?"":Number(Ce)}))},style:{minWidth:110},children:[n.jsx("option",{value:"",children:"-"}),[1,2,3,4,5,6].map(Ke=>n.jsx("option",{value:Ke,children:Ke},Ke))]})})]},`mm_${De.key}`))]})]})})]}):n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"This will send an edit request to IQAC. Mark Manager will remain locked until IQAC approves."}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[n.jsx("button",{className:"obe-btn",disabled:Ct,onClick:()=>Wt(null),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:Ct||!e,onClick:async()=>{if(e){if(Me.mode==="request"){Wt(null),await Se();return}await se()}},children:Me.mode==="confirm"?"Confirm":"Send Request"})]})]})}):null,Be?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:60,overflowY:"auto"},onClick:()=>mt(!1),children:n.jsxs("div",{style:{width:"min(1100px, 96vw)",maxHeight:"90vh",overflowY:"auto",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:De=>De.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10,position:"relative"},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"View Only"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280",marginRight:36},children:[i,"  ",String(e||"")]}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>mt(!1),style:{position:"absolute",right:0,top:0},children:"Close"})]}),gr?n.jsx("div",{style:{color:"#6b7280"},children:"Loading published marks"}):null,$r?n.jsx("div",{style:{color:"#991b1b",fontSize:12,marginBottom:8},children:$r}):null,It&&Object.keys(It).length||p.length?n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{className:"obe-table",style:{width:"max-content",minWidth:"100%",borderCollapse:"collapse"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Rt,colSpan:ce,children:[z.termLabel," | ",z.batchLabel," | ",i.toUpperCase()," (PUBLISHED)"]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...Rt,width:42,minWidth:42},children:"S.No"}),n.jsx("th",{style:Rt,children:"Register No."}),n.jsx("th",{style:Rt,children:"Name of the Students"}),n.jsx("th",{style:Rt,children:"Skill 1"}),n.jsx("th",{style:Rt,children:"Skill 2"}),n.jsx("th",{style:Rt,children:"Att 1"}),n.jsx("th",{style:Rt,children:"Att 2"}),n.jsx("th",{style:Rt,children:"Total"}),n.jsxs("th",{style:Rt,colSpan:2,children:["CO-",o]}),n.jsxs("th",{style:Rt,colSpan:2,children:["CO-",l]}),ct.map(De=>n.jsxs("th",{style:Rt,colSpan:2,children:["BTL-",De]},`pv_btl_${De}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt}),n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"}),n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"}),ct.map(De=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Rt,children:"Mark"}),n.jsx("th",{style:Rt,children:"%"})]},`pv_btl_sub_${De}`))]})]}),n.jsx("tbody",{children:p.length?p.map((De,Ke)=>{const Ce=It&&It[String(De.id)]||{},it=typeof Ce.skill1=="number"?ln(Number(Ce.skill1),1,He):ma(Ce.skill1),tr=typeof Ce.skill2=="number"?ln(Number(Ce.skill2),1,He):ma(Ce.skill2),Kt=typeof Ce.att1=="number"?ln(Number(Ce.att1),1,He):ma(Ce.att1),yt=typeof Ce.att2=="number"?ln(Number(Ce.att2),1,He):ma(Ce.att2),Ht=it!==""&&tr!==""&&Kt!==""&&yt!==""?ln(it+tr+Kt+yt,0,$t):"",qt=it!==""&&Kt!==""?ln(it+Kt,0,Ue):"",lr=tr!==""&&yt!==""?ln(tr+yt,0,Ue):"",Mt=[0,0,0,0,0,0];for(const At of Le){const bt=Z[At.key];(bt===1||bt===2||bt===3||bt===4||bt===5||bt===6)&&(Mt[bt-1]+=At.max)}const tt=ct.map(At=>At-1),Ft=typeof Ht=="number"&&tt.length?Mo(Ht/tt.length):"",Qt=Mt.map((At,bt)=>Ft===""||!tt.includes(bt)?"":At>0?ln(Ft,0,At):Mo(Ft));return n.jsxs("tr",{children:[n.jsx("td",{style:{..._t,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:Ke+1}),n.jsx("td",{style:_t,children:rf(De.reg_no)}),n.jsx("td",{style:_t,children:De.name||""}),n.jsx("td",{style:{..._t,textAlign:"center"},children:it}),n.jsx("td",{style:{..._t,textAlign:"center"},children:tr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:Kt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:yt}),n.jsx("td",{style:{..._t,textAlign:"center",fontWeight:700},children:Ht}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(qt,Ue)})}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(lr,Ue)})}),ct.map(At=>{const bt=At-1,V=Qt[bt],ie=Mt[bt]??0;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._t,textAlign:"center"},children:V}),n.jsx("td",{style:{..._t,textAlign:"center"},children:V===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(Number(V),ie)})})]},`pv_btl_cells_${De.id}_${At}`)})]},`pv_${De.id}`)}):Object.keys(It||{}).map((De,Ke)=>{const Ce=It[De]||{},it=typeof Ce.skill1=="number"?ln(Number(Ce.skill1),1,He):ma(Ce.skill1),tr=typeof Ce.skill2=="number"?ln(Number(Ce.skill2),1,He):ma(Ce.skill2),Kt=typeof Ce.att1=="number"?ln(Number(Ce.att1),1,He):ma(Ce.att1),yt=typeof Ce.att2=="number"?ln(Number(Ce.att2),1,He):ma(Ce.att2),Ht=it!==""&&tr!==""&&Kt!==""&&yt!==""?ln(it+tr+Kt+yt,0,$t):"",qt=it!==""&&Kt!==""?ln(it+Kt,0,Ue):"",lr=tr!==""&&yt!==""?ln(tr+yt,0,Ue):"",Mt=[0,0,0,0,0,0];for(const At of Le){const bt=Z[At.key];(bt===1||bt===2||bt===3||bt===4||bt===5||bt===6)&&(Mt[bt-1]+=At.max)}const tt=ct.map(At=>At-1),Ft=typeof Ht=="number"&&tt.length?Mo(Ht/tt.length):"",Qt=Mt.map((At,bt)=>Ft===""||!tt.includes(bt)?"":At>0?ln(Ft,0,At):Mo(Ft));return n.jsxs("tr",{children:[n.jsx("td",{style:{..._t,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:Ke+1}),n.jsx("td",{style:_t,children:rf(String(Ce.reg_no??De))}),n.jsx("td",{style:_t,children:Ce.name||""}),n.jsx("td",{style:{..._t,textAlign:"center"},children:it}),n.jsx("td",{style:{..._t,textAlign:"center"},children:tr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:Kt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:yt}),n.jsx("td",{style:{..._t,textAlign:"center",fontWeight:700},children:Ht}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt}),n.jsx("td",{style:{..._t,textAlign:"center"},children:qt===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(qt,Ue)})}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr}),n.jsx("td",{style:{..._t,textAlign:"center"},children:lr===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(lr,Ue)})}),ct.map(At=>{const bt=At-1,V=Qt[bt],ie=Mt[bt]??0;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._t,textAlign:"center"},children:V}),n.jsx("td",{style:{..._t,textAlign:"center"},children:V===""?"":n.jsx("span",{className:"obe-pct-badge",children:Ms(Number(V),ie)})})]},`pv_btl_cells_${De}_${At}`)})]},`pv_${De}`)})})]})}):gr?null:n.jsx("div",{style:{color:"#6b7280"},children:"No published marks found."}),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>mt(!1),children:"Close"})})]})}):null,Vr?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>{Oe||en(!1)},children:n.jsxs("div",{style:{width:"min(560px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:De=>De.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"Edit Request"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:[i,"  ",String(e||"")]})]}),n.jsx("div",{style:{fontSize:13,color:"#374151",marginBottom:10,lineHeight:1.35},children:"This will send an edit request to IQAC for published marks. Once approved, the entry will open for editing until the approval expires."}),n.jsx("textarea",{value:Xr,onChange:De=>gn(De.target.value),placeholder:"Reason (optional)",rows:4,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical"}}),n.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:12},children:[n.jsx("button",{className:"obe-btn",disabled:Oe,onClick:()=>en(!1),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:Oe||!e,onClick:ue,children:Oe?"Requesting":"Send Request"})]})]})}):null,Ae&&n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:["Saved key: ",n.jsx("span",{style:{fontFamily:"monospace"},children:Ae})]})]})}function YY(e){return n.jsx(h8,{...e,assessmentKey:"formative2"})}const KY=new URL("https://static.vecteezy.com/system/resources/thumbnails/014/585/778/small/gold-locked-padlock-png.png",import.meta.url).href,Ts=5,Ha=25,Hd=30;function JY(e,t){const r=String(e??"").trim(),s=String(t??"").trim(),a=r.replace(/[^0-9]/g,""),i=s.replace(/[^0-9]/g,"");if(a&&i)try{const o=BigInt(a),l=BigInt(i);if(o<l)return-1;if(o>l)return 1}catch{if(a.length!==i.length)return a.length-i.length;if(a<i)return-1;if(a>i)return 1}else{if(a&&!i)return-1;if(!a&&i)return 1}return r<s?-1:r>s?1:0}function ZY(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const a=r.localeCompare(s);if(a)return a}else if(r||s)return r?-1:1;return JY(e==null?void 0:e.reg_no,t==null?void 0:t.reg_no)}function Zn(e,t,r){return Number.isFinite(e)?Math.max(t,Math.min(r,Math.trunc(e))):t}function eK(e,t){return`${e}_sheet_${t}`}function Ro(e,t){const r=Array.isArray(e)?e:[],s=[];for(let a=0;a<t;a++){const i=r[a];if(i===""||i==null){s.push("");continue}const o=typeof i=="number"?i:Number(i);s.push(Number.isFinite(o)?o:"")}return s}function Ma(e,t){const r=Array.isArray(e)?e:[],s=[];for(let a=0;a<t;a++){const i=r[a],o=typeof i=="number"?i:Number(i);o===1||o===2||o===3||o===4||o===5||o===6?s.push(o):s.push(1)}return s}function nf(e){const t=e.filter(r=>typeof r=="number"&&Number.isFinite(r));return t.length?t.reduce((r,s)=>r+s,0)/t.length:null}function sf(e,t){if(e==null)return"";if(!Number.isFinite(t)||t<=0)return"0";const r=e/t*100;return`${Number.isFinite(r)?r.toFixed(0):0}`}function Yj({subjectId:e,teachingAssignmentId:t,assessmentKey:r,label:s,coA:a,coB:i,showCia1Embed:o,cia1Embed:l}){const[c,d]=v.useState(!1),[u,h]=v.useState(null),[p,f]=v.useState([]),[x,g]=v.useState(null),[y,m]=v.useState(!1),[w,S]=v.useState(null),[k,F]=v.useState(null),[L,C]=v.useState(!1),[O,T]=v.useState(null),[W,A]=v.useState(!1),[N,P]=v.useState(!1),[K,re]=v.useState(null),[ge,Fe]=v.useState(!1),[R,q]=v.useState(null),[me,fe]=v.useState(null),[E,U]=v.useState(!1),[I,M]=v.useState(null),[te,Q]=v.useState(!1),[G,ne]=v.useState({sheet:{termLabel:"KRCT AY25-26",batchLabel:e||"",coAEnabled:!0,coBEnabled:!0,ciaExamEnabled:!0,expCountA:Ts,expCountB:Ts,btlsA:Array.from({length:Ts},()=>1),btlsB:Array.from({length:Ts},()=>1),rowsByStudentId:{},expMaxA:Ha,expMaxB:Ha,markManagerLocked:!1,markManagerSnapshot:null,markManagerApprovalUntil:null}}),z=v.useMemo(()=>e?eK(r,e):"",[r,e]),{data:he,publishAllowed:X,remainingSeconds:H,refresh:oe}=Ru({assessment:r,subjectCode:String(e||""),teachingAssignmentId:t}),{data:D,refresh:Y}=Bu({assessment:r,subjectCode:String(e||""),teachingAssignmentId:t,options:{poll:!1}}),{data:le}=Xo({assessment:r,subjectCode:String(e||""),scope:"MARK_MANAGER",teachingAssignmentId:t,options:{poll:!1}}),$e=!!O||!!(D!=null&&D.exists&&(D!=null&&D.is_published)),je=D!=null&&D.exists?!!(D!=null&&D.entry_open):!0,We=!!($e&&!je),Ee=!!(he!=null&&he.global_override_active&&(he==null?void 0:he.global_is_open)===!1);v.useEffect(()=>{let ce=!0;return(async()=>{try{const xe=await Sl();if(!ce)return;g(xe||null),ne(se=>({...se,sheet:{...se.sheet,termLabel:String((xe==null?void 0:xe.termLabel)||se.sheet.termLabel||"KRCT AY25-26"),batchLabel:e||se.sheet.batchLabel}}))}catch{}})(),()=>{ce=!1}},[e]),v.useEffect(()=>{let ce=!0;return(async()=>{if(e)try{const xe=await En(r,e);if(!ce)return;const se=xe==null?void 0:xe.draft;if(se&&typeof se=="object"&&se.sheet&&typeof se.sheet=="object"){const Se=!!(se.sheet.coAEnabled??!0),Ze=!!(se.sheet.coBEnabled??!0),et=!!(se.sheet.ciaExamEnabled??!0),Et=Zn(Number(se.sheet.expCountA??Ts),0,12),wt=Zn(Number(se.sheet.expCountB??Ts),0,12),gt=Ma(se.sheet.btlsA,Et),zt=Ma(se.sheet.btlsB,wt),Dt=se.sheet.markManagerSnapshot??null,mr=se.sheet.markManagerApprovalUntil??null,pt=se.sheet.markManagerLocked,Xt=typeof pt=="boolean"?pt:!!Dt;ne({sheet:{termLabel:String(se.sheet.termLabel||(x==null?void 0:x.termLabel)||"KRCT AY25-26"),batchLabel:String(e),coAEnabled:Se,coBEnabled:Ze,ciaExamEnabled:et,expCountA:Et,expCountB:wt,btlsA:gt,btlsB:zt,rowsByStudentId:se.sheet.rowsByStudentId&&typeof se.sheet.rowsByStudentId=="object"?se.sheet.rowsByStudentId:{},markManagerLocked:Xt,markManagerSnapshot:Dt,markManagerApprovalUntil:mr}});try{z&&yn(z,{rowsByStudentId:se.sheet.rowsByStudentId||{}})}catch{}const Rt=(xe==null?void 0:xe.updated_at)??null,_t=(xe==null?void 0:xe.updated_by)??null;if(Rt)try{S(new Date(String(Rt)).toLocaleString())}catch{S(String(Rt))}_t&&F(String(_t.name||_t.username||_t.id||""))}else{const Se=z?Bn(z):null,Ze=Se!=null&&Se.rowsByStudentId&&typeof Se.rowsByStudentId=="object"?Se.rowsByStudentId:{};ne(et=>({...et,sheet:{...et.sheet,batchLabel:String(e),rowsByStudentId:Ze}}))}}catch{}})(),()=>{ce=!1}},[r,e,z,x]),v.useEffect(()=>{let ce=!0;return(async()=>{if(!t){f([]);return}d(!0),h(null);try{const xe=await Jo(t);if(!ce)return;const Se=[...(xe==null?void 0:xe.students)||[]].sort((Ze,et)=>ZY(Ze,et));f(Se)}catch(xe){if(!ce)return;f([]),h((xe==null?void 0:xe.message)||"Failed to load roster")}finally{ce&&d(!1)}})(),()=>{ce=!1}},[t]),v.useEffect(()=>{e&&p.length!==0&&ne(ce=>{const xe=Zn(Number(ce.sheet.expCountA??Ts),0,12),se=Zn(Number(ce.sheet.expCountB??Ts),0,12),Se=Ma(ce.sheet.btlsA,xe),Ze=Ma(ce.sheet.btlsB,se),et={...ce.sheet.rowsByStudentId||{}};for(const Et of p){const wt=String(Et.id),gt=et[wt];if(!gt)et[wt]={studentId:Et.id,marksA:Array.from({length:xe},()=>""),marksB:Array.from({length:se},()=>""),ciaExam:""};else{const zt=Ro(gt.marksA,xe),Dt=Ro(gt.marksB,se),mr=gt.ciaExam,pt=mr===""||mr==null?"":Number(mr),Xt=pt===""?"":Number.isFinite(pt)?pt:"";et[wt]={...gt,marksA:zt,marksB:Dt,ciaExam:Xt}}}return{...ce,sheet:{...ce.sheet,batchLabel:String(e),expCountA:xe,expCountB:se,btlsA:Se,btlsB:Ze,rowsByStudentId:et}}})},[p,e]),v.useEffect(()=>{if(z)try{yn(z,{rowsByStudentId:G.sheet.rowsByStudentId})}catch{}},[G.sheet.rowsByStudentId,z]),v.useEffect(()=>{if(!e)return;if(D!=null&&D.exists){const se=!!(D!=null&&D.mark_manager_locked);!!G.sheet.markManagerLocked!==se&&ne(Se=>({...Se,sheet:{...Se.sheet,markManagerLocked:se}}));return}const ce=!!(le!=null&&le.allowed_by_approval),xe=le!=null&&le.approval_until?String(le.approval_until):null;if(ce&&xe){(G.sheet.markManagerApprovalUntil?String(G.sheet.markManagerApprovalUntil):null)!==xe&&ne(Se=>({...Se,sheet:{...Se.sheet,markManagerLocked:!1,markManagerApprovalUntil:xe}}));return}},[e,D==null?void 0:D.exists,D==null?void 0:D.mark_manager_locked,le==null?void 0:le.allowed_by_approval,le==null?void 0:le.approval_until,G.sheet.markManagerLocked,G.sheet.markManagerApprovalUntil]),v.useEffect(()=>{if(!e)return;let ce=!1;const xe=setTimeout(async()=>{try{await Fs(r,e,G),ce||S(new Date().toLocaleString())}catch{}},900);return()=>{ce=!0,clearTimeout(xe)}},[r,e,G]);const Re=Zn(Number(G.sheet.expCountA??Ts),0,12),Ve=Zn(Number(G.sheet.expCountB??Ts),0,12),St=!!G.sheet.coAEnabled,rt=!!G.sheet.coBEnabled,ze=St?Re:0,Ie=rt?Ve:0,ot=ze+Ie,be=v.useMemo(()=>{if(ot===0)return[];const ce=Ma(G.sheet.btlsA,Re).slice(0,ze),xe=Ma(G.sheet.btlsB,Ve).slice(0,Ie),se=new Set;for(const Se of ce)se.add(Se);for(const Se of xe)se.add(Se);return[1,2,3,4,5,6].filter(Se=>se.has(Se))},[G.sheet,Re,Ve,ot,ze,Ie]),we=!!G.sheet.markManagerLocked,Me=G.sheet.ciaExamEnabled!==!1,Wt=we,Ct=!!(Ee||D!=null&&D.exists&&!(D!=null&&D.entry_open));function pr(ce,xe){ne(se=>se.sheet.markManagerLocked?se:{...se,sheet:{...se.sheet,coAEnabled:ce==="A"?xe:se.sheet.coAEnabled,coBEnabled:ce==="B"?xe:se.sheet.coBEnabled}})}function fr(ce,xe){const se=Zn(Number(xe),0,100);ne(Se=>Se.sheet.markManagerLocked?Se:{...Se,sheet:{...Se.sheet,expMaxA:ce==="A"?se:Se.sheet.expMaxA,expMaxB:ce==="B"?se:Se.sheet.expMaxB}})}function Be(ce,xe){const se=Zn(xe,0,12);ne(Se=>{if(Se.sheet.markManagerLocked)return Se;const Ze={...Se.sheet.rowsByStudentId||{}};for(const zt of Object.keys(Ze)){const Dt=Ze[zt];if(ce==="A"){const mr=Ro(Dt==null?void 0:Dt.marksA,se);Ze[zt]={...Dt,marksA:mr}}else{const mr=Ro(Dt==null?void 0:Dt.marksB,se);Ze[zt]={...Dt,marksB:mr}}}const et=ce==="A"?se:Zn(Number(Se.sheet.expCountA??Ts),0,12),Et=ce==="B"?se:Zn(Number(Se.sheet.expCountB??Ts),0,12),wt=Ma(Se.sheet.btlsA,et),gt=Ma(Se.sheet.btlsB,Et);return{...Se,sheet:{...Se.sheet,expCountA:ce==="A"?se:Se.sheet.expCountA,expCountB:ce==="B"?se:Se.sheet.expCountB,btlsA:wt,btlsB:gt,rowsByStudentId:Ze}}})}function mt(ce,xe,se){ne(Se=>{if(We||Ee)return Se;const Ze=Zn(Number(Se.sheet.expCountA??Ts),0,12),et=Zn(Number(Se.sheet.expCountB??Ts),0,12),Et=Ma(Se.sheet.btlsA,Ze),wt=Ma(Se.sheet.btlsB,et);return ce==="A"?Et[xe]=se:wt[xe]=se,{...Se,sheet:{...Se.sheet,btlsA:Et,btlsB:wt}}})}function It(ce){ne(xe=>xe.sheet.markManagerLocked?xe:{...xe,sheet:{...xe.sheet,ciaExamEnabled:!!ce}})}function ft(ce){const xe=Zn(Number(ce.expCountA??Ts),0,12),se=Zn(Number(ce.expCountB??Ts),0,12),Se=Ma(ce.btlsA,xe).slice(0,xe),Ze=Ma(ce.btlsB,se).slice(0,se);return JSON.stringify({coAEnabled:!!ce.coAEnabled,coBEnabled:!!ce.coBEnabled,ciaExamEnabled:!!(ce.ciaExamEnabled??!0),expCountA:xe,expMaxA:Zn(Number(ce.expMaxA??Ha),0,100),expCountB:se,expMaxB:Zn(Number(ce.expMaxB??Ha),0,100),btlsA:Se,btlsB:Ze})}async function gr(){if(e){U(!0),M(null);try{await Yi({assessment:r,subject_code:String(e),scope:"MARK_MANAGER",reason:`Edit request: Mark Manager changes for ${s}`,teaching_assignment_id:t}),alert("Edit request sent to IQAC.")}catch(ce){M((ce==null?void 0:ce.message)||"Request failed"),alert((ce==null?void 0:ce.message)||"Request failed")}finally{U(!1)}}}function Mr(ce,xe,se,Se){ne(Ze=>{var _t;const et=String(ce),Et=Zn(Number(Ze.sheet.expCountA??Ts),0,12),wt=Zn(Number(Ze.sheet.expCountB??Ts),0,12),gt=Zn(Number(Ze.sheet.expMaxA??Ha),0,100),zt=Zn(Number(Ze.sheet.expMaxB??Ha),0,100),Dt=(_t=Ze.sheet.rowsByStudentId)==null?void 0:_t[et],mr=Dt?Ro(Dt.marksA,Et):Array.from({length:Et},()=>""),pt=Dt?Ro(Dt.marksB,wt):Array.from({length:wt},()=>""),Xt=[...mr],Rt=[...pt];if(xe==="A")if(Se===""||Se==null)Xt[se]="";else{const jr=Number(Se);Xt[se]=Number.isFinite(jr)?Math.max(0,Math.min(gt,Math.trunc(jr))):""}else if(Se===""||Se==null)Rt[se]="";else{const jr=Number(Se);Rt[se]=Number.isFinite(jr)?Math.max(0,Math.min(zt,Math.trunc(jr))):""}return{...Ze,sheet:{...Ze.sheet,rowsByStudentId:{...Ze.sheet.rowsByStudentId,[et]:{...Dt||{studentId:ce},marksA:Xt,marksB:Rt,ciaExam:Dt&&(typeof Dt.ciaExam=="number"||Dt.ciaExam==="")?Dt.ciaExam:""}}}}})}function $r(ce,xe){ne(se=>{var pt;const Se=String(ce),Ze=Zn(Number(se.sheet.expCountA??Ts),0,12),et=Zn(Number(se.sheet.expCountB??Ts),0,12),Et=Zn(Number(se.sheet.expMaxA??Ha),0,100),wt=Zn(Number(se.sheet.expMaxB??Ha),0,100),gt=(pt=se.sheet.rowsByStudentId)==null?void 0:pt[Se],zt=gt?Ro(gt.marksA,Ze):Array.from({length:Ze},()=>""),Dt=gt?Ro(gt.marksB,et):Array.from({length:et},()=>"");let mr="";if(xe===""||xe==null)mr="";else{const Xt=Number(xe),Rt=Math.max(Et,wt,Hd);mr=Number.isFinite(Xt)?Math.max(0,Math.min(Rt,Math.trunc(Xt))):""}return{...se,sheet:{...se.sheet,rowsByStudentId:{...se.sheet.rowsByStudentId,[Se]:{...gt||{studentId:ce},marksA:zt,marksB:Dt,ciaExam:mr}}}}})}async function _r(){if(e){m(!0);try{await Fs(r,e,G),S(new Date().toLocaleString()),alert("Draft saved.")}catch(ce){alert((ce==null?void 0:ce.message)||"Draft save failed")}finally{m(!1)}}}async function Vr(){if(!e||!window.confirm("Reset all lab marks for this sheet? This clears the draft (students + experiments + CIA Exam)."))return;const xe=Zn(Number(G.sheet.expCountA??Ts),0,12),se=Zn(Number(G.sheet.expCountB??Ts),0,12),Se={};for(const et of p)Se[String(et.id)]={studentId:et.id,marksA:Array.from({length:xe},()=>""),marksB:Array.from({length:se},()=>""),ciaExam:""};const Ze={sheet:{...G.sheet,rowsByStudentId:Se}};ne(Ze);try{z&&yn(z,{rowsByStudentId:{}})}catch{}try{await Fs(r,e,Ze),S(new Date().toLocaleString())}catch{}}async function en(){if(e){if(Ee){alert("Publishing is locked by IQAC.");return}if(!X){alert("Publish window is closed. Please request IQAC approval.");return}if(!O){C(!0);try{await dg(r,e,G,t),T(new Date().toLocaleString()),await Xr(!1),oe(),Y({silent:!0});try{console.debug("obe:published dispatch",{assessment:r,subjectId:e}),window.dispatchEvent(new CustomEvent("obe:published",{detail:{subjectId:e,assessment:r}}))}catch{}}catch(ce){alert((ce==null?void 0:ce.message)||"Publish failed")}finally{C(!1)}}}}async function Xr(ce){if(e){ce&&Fe(!0),q(null);try{const xe=await wa(r,String(e),t),se=(xe==null?void 0:xe.data)??null;se&&typeof se=="object"&&re(se)}catch(xe){ce&&q((xe==null?void 0:xe.message)||"Failed to load published marks")}finally{ce&&Fe(!1)}}}v.useEffect(()=>{e&&Xr(!1)},[e,r]);const gn=Jr.useRef(!!je);v.useEffect(()=>{if(!e||!$e)return;if(gn.current||!je){gn.current=!!je;return}let xe=!0;return(async()=>{try{const se=await En(r,String(e),t),Se=(se==null?void 0:se.data)??null;if(!xe)return;if(Se&&typeof Se=="object"&&Se.sheet){ne(Se);return}}catch{}xe&&K&&K.sheet&&ne(K)})(),gn.current=!!je,()=>{xe=!1}},[je,$e,e,r,K]),v.useEffect(()=>{if(!e||!$e||je)return;const ce=window.setInterval(()=>{Y({silent:!0})},3e4);return()=>window.clearInterval(ce)},[je,$e,e,Y]),v.useEffect(()=>{N&&e&&(re(null),Xr(!0))},[N,e,r]);const Oe=3+ot+1+(Me?1:0)+4+be.length*2,qe=Zn(Number(G.sheet.expMaxA??Ha),0,100),Lt=Zn(Number(G.sheet.expMaxB??Ha),0,100),dt=qe+(Me?Hd/2:0),He=Lt+(Me?Hd/2:0),$t=Math.max(qe,Lt,Ha),Ue={border:"1px solid #dee2e6",padding:"10px 4px",textAlign:"center",fontWeight:700,fontSize:"clamp(10px, 0.9vw, 12px)",whiteSpace:"nowrap",letterSpacing:"0.8px",textTransform:"uppercase",background:"linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)",color:"#0d47a1",overflow:"hidden"},er={border:"1px solid #dee2e6",padding:"4px",fontSize:"clamp(9px, 0.85vw, 11px)",whiteSpace:"nowrap",background:"#ffffff",textAlign:"center",color:"#212529",fontWeight:500},Z={width:"100%",border:"1px solid #90caf9",outline:"none",background:"#ffffff",fontSize:"clamp(9px, 0.85vw, 10px)",textAlign:"center",padding:"4px",borderRadius:"4px",fontWeight:600,color:"#212529",boxShadow:"inset 0 1px 2px rgba(0, 0, 0, 0.05)",transition:"all 0.2s ease"},pe={border:"1px solid #dee2e6",borderRadius:8,background:"#f8f9fa",padding:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",maxWidth:"100%",overflowX:"auto",position:"relative"},ee="100%",ue={display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:8},Ae={width:20,height:20,transform:"scale(1.5)",accentColor:"#9a3412"},Le=te?"markManagerGlitch 2s ease-in-out":void 0,ct={position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:40,width:360,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:10,borderRadius:12,display:"flex",flexDirection:"column",gap:8,alignItems:"center",boxShadow:"0 6px 18px rgba(17,24,39,0.06)",filter:"none"};return n.jsxs("div",{children:[n.jsx("style",{children:`
        @keyframes markManagerGlitch {
          0%, 100% { transform: translate(0,0); filter: none; }
          10% { transform: translate(-2px, 1px); }
          20% { transform: translate(2px, -1px); }
          30% { transform: translate(-1px, -2px); }
          40% { transform: translate(1px, 2px); }
          50% { transform: translate(-2px, -1px); }
          60% { transform: translate(2px, 1px); }
          70% { transform: translate(-1px, 1px); }
          80% { transform: translate(1px, -1px); }
          90% { transform: translate(-1px, 0); }
        }
        @keyframes markManagerDust {
          0% { opacity: 0.9; transform: translate(0,0) scale(1); }
          100% { opacity: 0; transform: translate(80px, -40px) scale(0.6); }
        }
        .markManagerDustParticle {
          position: absolute;
          width: 4px;
          height: 4px;
          background: #d1d5db;
          border-radius: 50%;
          animation: markManagerDust 2s ease-out forwards;
        }
        
        /* Premium Table Styles */
        .premium-table {
          border-collapse: separate;
          border-spacing: 0;
          width: 100%;
          background: #ffffff;
          table-layout: auto;
          border: 1px solid #dee2e6;
          border-radius: 8px;
          overflow: hidden;
        }
        
        .premium-table tbody tr {
          background: #ffffff;
        }
        
        .premium-table tbody tr:hover {
          background: #f8f9fa;
        }
        
        .premium-table tbody tr:nth-child(even) {
          background: #fafbfc;
        }
        
        .premium-table input:focus {
          border-color: #1976d2;
          box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1), inset 0 1px 2px rgba(0, 0, 0, 0.05);
          background: #ffffff;
        }
        
        .premium-table input:hover:not(:disabled) {
          border-color: #42a5f5;
          box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .premium-table input:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          background: #e0e0e0;
        }
        
        .premium-table thead tr:first-child th {
          background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
          color: #0d47a1;
          font-size: clamp(11px, 1vw, 13px);
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 1px;
          padding: 12px 4px;
          border-bottom: 2px solid #90caf9;
        }
        
        .premium-table thead tr:not(:first-child) th {
          background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
          color: #0d47a1;
        }
        
        .premium-btl-select {
          background: #e3f2fd;
          border-radius: 4px;
          font-weight: 600;
          border: 1px solid #90caf9;
          color: #0d47a1;
          padding: 4px 8px;
          font-size: clamp(9px, 0.85vw, 10px);
          transition: all 0.2s ease;
        }
        
        .premium-btl-select:hover {
          background: #bbdefb;
          border-color: #1976d2;
        }
        
        /* Maintain sticky column backgrounds on hover */
        .premium-table tbody tr:hover td:nth-child(1),
        .premium-table tbody tr:hover td:nth-child(2),
        .premium-table tbody tr:hover td:nth-child(3) {
          background: #e8eaed !important;
        }
        
        /* Sticky S.No column */
        .premium-table tbody td:nth-child(1),
        .premium-table thead th:nth-child(1) {
          position: sticky;
          left: 0;
          z-index: 10;
          background: #f1f3f4;
          border-right: 2px solid #dee2e6;
        }
        
        /* Sticky Register column */
        .premium-table tbody td:nth-child(2),
        .premium-table thead th:nth-child(2) {
          position: sticky;
          left: 30px;
          z-index: 10;
          background: #f1f3f4;
          white-space: nowrap;
          padding: 4px 6px;
          border-right: 2px solid #dee2e6;
        }
        
        /* Sticky Name column - full width, one line */
        .premium-table tbody td:nth-child(3),
        .premium-table thead th:nth-child(3) {
          position: sticky;
          left: 100px;
          z-index: 10;
          background: #f1f3f4;
          text-align: left;
          padding: 4px 8px;
          white-space: nowrap;
          border-right: 2px solid #dee2e6;
          width: auto;
          min-width: max-content; /* Let the column expand to fit the longest name */
          overflow: visible; /* Allow content to be visible */
        }
        
        /* Header sticky columns use gradient */
        .premium-table thead th:nth-child(1),
        .premium-table thead th:nth-child(2),
        .premium-table thead th:nth-child(3) {
          background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%) !important;
        }
        
        /* Enhanced number inputs */
        .premium-table input[type="number"] {
          font-variant-numeric: tabular-nums;
          letter-spacing: 0.5px;
          -moz-appearance: textfield;
        }
        
        /* Remove increment/decrement spinners */
        .premium-table input[type="number"]::-webkit-outer-spin-button,
        .premium-table input[type="number"]::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        
        /* Percentage cells */
        .premium-table td[style*="font-variant"] {
          font-variant-numeric: tabular-nums;
        }

        @media (max-width: 1400px) {
          .premium-table {
            font-size: 11px;
          }
        }
      `}),n.jsxs("div",{style:{margin:"0 0 10px 0",maxWidth:"100%",width:"100%",boxSizing:"border-box",overflow:"hidden"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:6},children:"COs enabled"}),n.jsxs("div",{style:{...ue,border:"1px solid #fcd34d",background:we?"#f3f4f6":"#fff7ed",padding:12,borderRadius:12,alignItems:"stretch",animation:Le,position:"relative",overflow:"hidden"},children:[te?n.jsx(n.Fragment,{children:Array.from({length:20},(ce,xe)=>n.jsx("div",{className:"markManagerDustParticle",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDelay:`${Math.random()*1}s`}},xe))}):null,n.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,flexWrap:"wrap"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx(f1,{size:20,color:we?"#6b7280":"#9a3412"}),n.jsx("div",{style:{fontWeight:950,color:"#111827",fontSize:14},children:"Mark Manager"}),we&&n.jsx("span",{style:{fontSize:11,color:"#fff",background:"#dc2626",padding:"2px 8px",borderRadius:6,fontWeight:700},children:"LOCKED"}),!we&&n.jsx("span",{style:{fontSize:11,color:"#fff",background:"#16a34a",padding:"2px 8px",borderRadius:6,fontWeight:700},children:"EDITABLE"})]}),n.jsx("button",{onClick:()=>fe({mode:we?"request":"confirm"}),className:"obe-btn obe-btn-success",disabled:!e||E,style:{minWidth:100},children:E?"Saving...":we?"Request Edit":"Save & Lock"})]}),n.jsxs("div",{style:{width:"100%",display:"flex",gap:10,flexWrap:"wrap",marginTop:8},children:[n.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontWeight:800,fontSize:12,color:"#111827"},children:[n.jsx("input",{type:"checkbox",checked:St,disabled:we,onChange:ce=>pr("A",ce.target.checked),style:Ae}),"CO-",a]}),n.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontWeight:800,fontSize:12,color:"#111827"},children:[n.jsx("input",{type:"checkbox",checked:rt,disabled:we,onChange:ce=>pr("B",ce.target.checked),style:Ae}),"CO-",i]}),n.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontWeight:800,fontSize:12,color:"#111827"},children:[n.jsx("input",{type:"checkbox",checked:Me,disabled:we,onChange:ce=>It(ce.target.checked),style:Ae}),"CIA Exam"]})]}),n.jsxs("div",{style:{width:"100%",display:"flex",gap:10,flexWrap:"wrap",marginTop:8},children:[St?n.jsxs("div",{style:{width:200},children:[n.jsxs("div",{style:{fontSize:11,color:"#6b7280"},children:["No. of experiments (CO-",a,")"]}),n.jsx("input",{type:"number",className:"obe-input",value:Re,onChange:ce=>Be("A",Number(ce.target.value)),min:0,max:12,disabled:we}),n.jsx("div",{style:{fontSize:11,color:"#6b7280",marginTop:6},children:"Max marks (per experiment)"}),n.jsx("input",{type:"number",className:"obe-input",value:G.sheet.expMaxA??Ha,onChange:ce=>fr("A",Number(ce.target.value)),min:0,max:100,disabled:we})]}):null,rt?n.jsxs("div",{style:{width:200},children:[n.jsxs("div",{style:{fontSize:11,color:"#6b7280"},children:["No. of experiments (CO-",i,")"]}),n.jsx("input",{type:"number",className:"obe-input",value:Ve,onChange:ce=>Be("B",Number(ce.target.value)),min:0,max:12,disabled:we}),n.jsx("div",{style:{fontSize:11,color:"#6b7280",marginTop:6},children:"Max marks (per experiment)"}),n.jsx("input",{type:"number",className:"obe-input",value:G.sheet.expMaxB??Ha,onChange:ce=>fr("B",Number(ce.target.value)),min:0,max:100,disabled:we})]}):null]})]}),I?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#991b1b"},children:I}):null]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center",marginBottom:12,padding:12,background:"#f9fafb",borderRadius:10,border:"1px solid #e5e7eb"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("button",{onClick:_r,className:"obe-btn obe-btn-success",disabled:y||!e||!Wt||Ct,style:!Wt||Ct?{opacity:.6,cursor:"not-allowed"}:void 0,title:Wt?Ct?"Table locked after publish":"Save current draft":"Save & Lock Mark Manager first to enable table",children:y?"Saving":"Save Draft"}),n.jsx("button",{onClick:Vr,className:"obe-btn obe-btn-danger",disabled:!e||!Wt||Ct,style:!Wt||Ct?{opacity:.6,cursor:"not-allowed"}:void 0,title:Wt?Ct?"Table locked after publish":"Clear all marks":"Save & Lock Mark Manager first to enable table",children:"Reset All"}),n.jsx("button",{onClick:en,className:"obe-btn obe-btn-primary",disabled:!e||L||!Wt||Ct||Ee||!X,style:!Wt||Ct?{opacity:.6,cursor:"not-allowed"}:void 0,title:Wt?Ct?"Table locked after publish":X?Ee?"Publishing locked by IQAC":"Publish marks":"Publish window closed":"Save & Lock Mark Manager first",children:L?"Publishing":"Publish"})]}),n.jsx("div",{style:{flex:1}}),n.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",fontSize:12,color:"#6b7280",alignItems:"center"},children:[w?n.jsxs("div",{title:"Last saved",children:[" ",w]}):null,O?n.jsxs("div",{title:"Published",children:[" ",O]}):null,H!=null&&!X?n.jsxs("div",{title:"Publish window opens in",children:[" ",_0(H)]}):null]})]}),u&&n.jsx("div",{style:{marginBottom:10,color:"#b91c1c"},children:u}),c?n.jsx("div",{style:{color:"#6b7280"},children:"Loading roster"}):p.length===0?n.jsx("div",{style:{color:"#6b7280"},children:"Select a Teaching Assignment to load students."}):Wt?n.jsx("div",{style:pe,children:n.jsxs(k0,{locked:Ee,children:[n.jsx("div",{style:{overflowX:"auto",borderRadius:12,maxWidth:"100%"},children:n.jsxs("table",{className:"premium-table",style:{minWidth:ee,width:"100%",tableLayout:"auto"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Ue,colSpan:Oe,children:[G.sheet.termLabel," | ",G.sheet.batchLabel," | ",s]})}),n.jsxs("tr",{children:[n.jsx("th",{style:Ue,rowSpan:5,children:"S.No"}),n.jsx("th",{style:Ue,rowSpan:5,children:"Register No."}),n.jsx("th",{style:Ue,rowSpan:5,children:"Name of the Students"}),n.jsx("th",{style:Ue,colSpan:Math.max(1,ot),children:"Experiments"}),n.jsx("th",{style:Ue,rowSpan:5,children:"Total (Avg)"}),Me?n.jsx("th",{style:Ue,rowSpan:5,children:"CIA Exam"}):null,n.jsx("th",{style:Ue,colSpan:4,children:"CO ATTAINMENT"}),be.length?n.jsx("th",{style:Ue,colSpan:be.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[ot===0?n.jsx("th",{style:Ue,children:""}):n.jsxs(n.Fragment,{children:[Array.from({length:ze},(ce,xe)=>n.jsx("th",{style:Ue,children:a},`coa_${xe}`)),Array.from({length:Ie},(ce,xe)=>n.jsx("th",{style:Ue,children:i},`cob_${xe}`))]}),n.jsxs("th",{style:Ue,colSpan:2,children:["CO-",a]}),n.jsxs("th",{style:Ue,colSpan:2,children:["CO-",i]}),be.map(ce=>n.jsxs("th",{style:Ue,colSpan:2,children:["BTL-",ce]},`btl_${ce}`))]}),n.jsxs("tr",{children:[ot===0?n.jsx("th",{style:Ue,children:""}):n.jsxs(n.Fragment,{children:[Array.from({length:ze},(ce,xe)=>n.jsx("th",{style:Ue,children:qe},`max_a_${xe}`)),Array.from({length:Ie},(ce,xe)=>n.jsx("th",{style:Ue,children:Lt},`max_b_${xe}`))]}),n.jsx("th",{style:Ue,children:dt}),n.jsx("th",{style:Ue,children:"%"}),n.jsx("th",{style:Ue,children:He}),n.jsx("th",{style:Ue,children:"%"}),be.map(ce=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Ue,children:$t}),n.jsx("th",{style:Ue,children:"%"})]},`btlmax_${ce}`))]}),n.jsxs("tr",{children:[ot===0?n.jsx("th",{style:Ue,children:"No experiments"}):n.jsxs(n.Fragment,{children:[Array.from({length:ze},(ce,xe)=>n.jsxs("th",{style:Ue,children:["E",xe+1]},`ea_${xe}`)),Array.from({length:Ie},(ce,xe)=>n.jsxs("th",{style:Ue,children:["E",xe+1]},`eb_${xe}`))]}),n.jsx("th",{style:Ue,colSpan:4+be.length*2})]}),n.jsxs("tr",{children:[ot===0?n.jsx("th",{style:Ue,children:""}):n.jsxs(n.Fragment,{children:[Array.from({length:ze},(ce,xe)=>{const se=Ma(G.sheet.btlsA,Re)[xe]??1;return n.jsx("th",{style:Ue,children:n.jsxs("div",{style:{position:"relative",display:"grid",placeItems:"center"},title:`BTL: ${se}`,children:[n.jsx("div",{className:"premium-btl-select",style:{width:"100%",padding:"6px 8px",textAlign:"center",userSelect:"none",fontWeight:800,color:"#0f172a"},children:se}),n.jsx("select",{"aria-label":`BTL for CO${a} E${xe+1}`,value:se,onChange:Se=>mt("A",xe,Number(Se.target.value)),disabled:We||Ee,style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:we?"not-allowed":"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none"},children:[1,2,3,4,5,6].map(Se=>n.jsx("option",{value:Se,children:Se},Se))})]})},`btla_${xe}`)}),Array.from({length:Ie},(ce,xe)=>{const se=Ma(G.sheet.btlsB,Ve)[xe]??1;return n.jsx("th",{style:Ue,children:n.jsxs("div",{style:{position:"relative",display:"grid",placeItems:"center"},title:`BTL: ${se}`,children:[n.jsx("div",{className:"premium-btl-select",style:{width:"100%",padding:"6px 8px",textAlign:"center",userSelect:"none",fontWeight:800,color:"#0f172a"},children:se}),n.jsx("select",{"aria-label":`BTL for CO${i} E${xe+1}`,value:se,onChange:Se=>mt("B",xe,Number(Se.target.value)),disabled:We||Ee,style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:we?"not-allowed":"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none"},children:[1,2,3,4,5,6].map(Se=>n.jsx("option",{value:Se,children:Se},Se))})]})},`btlb_${xe}`)})]}),n.jsx("th",{style:Ue,colSpan:4+be.length*2})]})]}),n.jsx("tbody",{children:We?n.jsx("tr",{children:n.jsx("td",{colSpan:Oe,style:{padding:14,textAlign:"center",color:"#065f46",fontWeight:900},children:"Published  students hidden"})}):n.jsxs(n.Fragment,{children:[p.map((ce,xe)=>{var Cr;const se=(Cr=G.sheet.rowsByStudentId)==null?void 0:Cr[String(ce.id)],Se=Ro(se==null?void 0:se.marksA,Re),Ze=Ro(se==null?void 0:se.marksB,Ve),et=se==null?void 0:se.ciaExam,Et=Me&&typeof et=="number"&&Number.isFinite(et)?et:null,wt=Se.slice(0,ze),gt=Ze.slice(0,Ie),zt=wt.concat(gt),Dt=Ma(G.sheet.btlsA,Re).slice(0,ze),mr=Ma(G.sheet.btlsB,Ve).slice(0,Ie),pt=nf(zt),Xt=nf(wt),Rt=nf(gt),_t=Xt==null&&pt==null&&(!Me||Et==null)?null:(Xt??0)+(Me?(Et??0)/2:0),jr=Rt==null&&pt==null&&(!Me||Et==null)?null:(Rt??0)+(Me?(Et??0)/2:0),Gr={};for(const Rr of be){const De=[];for(let Ke=0;Ke<wt.length;Ke++)if(Dt[Ke]===Rr){const Ce=wt[Ke];typeof Ce=="number"&&Number.isFinite(Ce)&&De.push(Ce)}for(let Ke=0;Ke<gt.length;Ke++)if(mr[Ke]===Rr){const Ce=gt[Ke];typeof Ce=="number"&&Number.isFinite(Ce)&&De.push(Ce)}Gr[Rr]=De.length?De.reduce((Ke,Ce)=>Ke+Ce,0)/De.length:null}return n.jsxs("tr",{children:[n.jsx("td",{style:{...er,width:"30px",minWidth:"30px",fontWeight:700},children:xe+1}),n.jsx("td",{style:{...er,width:"70px",minWidth:"70px",fontWeight:600},children:ce.reg_no.slice(-8)}),n.jsx("td",{style:{...er,fontWeight:600,whiteSpace:"nowrap"},children:ce.name}),Array.from({length:ze},(Rr,De)=>n.jsx("td",{style:{...er,padding:"2px"},children:n.jsx("input",{type:"number",value:Se[De],onChange:Ke=>{const Ce=Ke.target.value;if(Ce==="")return Ke.currentTarget.setCustomValidity(""),Mr(ce.id,"A",De,"");const it=Number(Ce);if(Number.isFinite(it)){if(it>qe){Ke.currentTarget.setCustomValidity(`Max mark is ${qe}`),Ke.currentTarget.reportValidity(),window.setTimeout(()=>Ke.currentTarget.setCustomValidity(""),0);return}Ke.currentTarget.setCustomValidity(""),Mr(ce.id,"A",De,it)}},style:Z,min:0,max:qe,disabled:!Wt||Ct})},`ma${ce.id}_${De}`)),Array.from({length:Ie},(Rr,De)=>n.jsx("td",{style:{...er,padding:"2px"},children:n.jsx("input",{type:"number",value:Ze[De],onChange:Ke=>{const Ce=Ke.target.value;if(Ce==="")return Ke.currentTarget.setCustomValidity(""),Mr(ce.id,"B",De,"");const it=Number(Ce);if(Number.isFinite(it)){if(it>Lt){Ke.currentTarget.setCustomValidity(`Max mark is ${Lt}`),Ke.currentTarget.reportValidity(),window.setTimeout(()=>Ke.currentTarget.setCustomValidity(""),0);return}Ke.currentTarget.setCustomValidity(""),Mr(ce.id,"B",De,it)}},style:Z,min:0,max:Lt,disabled:!Wt||Ct})},`mb${ce.id}_${De}`)),n.jsx("td",{style:{...er,fontWeight:700,fontSize:"clamp(10px, 0.9vw, 11px)"},children:pt==null?"":pt.toFixed(1)}),Me?n.jsx("td",{style:{...er,padding:"2px"},children:n.jsx("input",{type:"number",value:(se==null?void 0:se.ciaExam)??"",onChange:Rr=>{const De=Rr.target.value,Ke=Math.max(qe,Lt,Hd);if(De==="")return Rr.currentTarget.setCustomValidity(""),$r(ce.id,"");const Ce=Number(De);if(Number.isFinite(Ce)){if(Ce>Ke){Rr.currentTarget.setCustomValidity(`Max mark is ${Ke}`),Rr.currentTarget.reportValidity(),window.setTimeout(()=>Rr.currentTarget.setCustomValidity(""),0);return}Rr.currentTarget.setCustomValidity(""),$r(ce.id,Ce)}},style:Z,min:0,max:Math.max(qe,Lt,Hd),disabled:!Wt||Ct})}):null,n.jsx("td",{style:{...er,width:"28px",fontSize:"10px",padding:"2px",fontWeight:600,color:"#5f6368"},children:_t==null?"":_t.toFixed(1)}),n.jsx("td",{style:{...er,width:"25px",fontSize:"10px",padding:"2px",fontWeight:600,color:"#5f6368"},children:sf(_t,dt)}),n.jsx("td",{style:{...er,width:"28px",fontSize:"10px",padding:"2px",fontWeight:600,color:"#5f6368"},children:jr==null?"":jr.toFixed(1)}),n.jsx("td",{style:{...er,width:"25px",fontSize:"10px",padding:"2px",fontWeight:600,color:"#5f6368"},children:sf(jr,He)}),be.map(Rr=>{const De=Gr[Rr]??null,Ke=Math.max(qe,Lt,Ha);return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...er,width:"28px",fontSize:"10px",padding:"2px",fontWeight:600,color:"#5f6368"},children:De==null?"":De.toFixed(1)}),n.jsx("td",{style:{...er,width:"25px",fontSize:"10px",padding:"2px",fontWeight:600,color:"#5f6368"},children:sf(De,Ke)})]},`btlcell_${ce.id}_${Rr}`)})]},ce.id)}),p.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:Oe,style:{padding:10,color:"#6b7280"},children:"No students."})}):null]})})]})}),We?n.jsx("div",{style:{position:"absolute",inset:0,zIndex:30,pointerEvents:"auto",background:"linear-gradient(180deg, rgba(34,197,94,0.28) 0%, rgba(16,185,129,0.36) 100%)"}}):null,we?null:n.jsxs("div",{style:ct,children:[n.jsx("div",{style:{width:100,height:72,display:"grid",placeItems:"center",background:"#fff",borderRadius:8},children:n.jsx("img",{src:"https://media.lordicon.com/icons/wired/flat/94-lock-unlock.gif",alt:"locked",style:{maxWidth:72,maxHeight:72,display:"block"}})}),n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontWeight:800,color:"#111827"},children:"Table Locked"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Confirm the Mark Manager"})]})]}),We?n.jsxs("div",{style:ct,children:[n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontWeight:900,color:"#065f46"},children:"Published"}),n.jsx("div",{style:{fontSize:13,color:"#065f46"},children:"Marks are locked. Request IQAC approval to edit."})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[n.jsx("button",{type:"button",className:"obe-btn",onClick:()=>P(!0),children:"View Marks"}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-success",onClick:()=>{A(!0)},children:"Edit"})]}),n.jsx("div",{style:{width:170,height:92,display:"grid",placeItems:"center",background:"#fff",borderRadius:10,border:"1px solid rgba(2,6,23,0.08)"},children:n.jsx("img",{src:new URL("/assets/lockong-CpAqbAhU.png",import.meta.url).toString(),alt:"locked",style:{maxWidth:150,maxHeight:80,display:"block"},onError:ce=>{ce.currentTarget.onerror=null,ce.currentTarget.src=KY}})})]}):null]})}):n.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",borderRadius:16,border:"2px dashed #f59e0b"},children:[n.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#92400e",marginBottom:8},children:" Mark Manager Configuration Required"}),n.jsx("div",{style:{fontSize:14,color:"#78350f"},children:"Please configure and lock the Mark Manager above to enable the table."})]}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280",display:"flex",gap:18,flexWrap:"wrap"},children:[w?n.jsxs("div",{children:["Draft saved: ",w,k?n.jsxs("span",{style:{marginLeft:8,color:"#374151"},children:["by ",n.jsx("strong",{children:k})]}):null]}):null,O?n.jsxs("div",{children:["Last published: ",O]}):null]}),W?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>A(!1),children:n.jsxs("div",{style:{width:"min(560px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:ce=>ce.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"Edit Request"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:[String(r).toUpperCase()," LAB"]})]}),n.jsxs("div",{style:{fontSize:13,color:"#374151",marginBottom:10,lineHeight:1.35},children:[n.jsxs("div",{children:[n.jsx("strong",{children:"Subject:"})," ",s]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Code:"})," ",String(e||"")]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Published:"})," ",O||""]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Saved:"})," ",w||""]})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[n.jsx("button",{type:"button",className:"obe-btn",onClick:()=>A(!1),children:"Close"}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-primary",onClick:async()=>{if(e)try{await Yi({assessment:r,subject_code:String(e),scope:"MARK_ENTRY",reason:`Edit request: Marks entry for ${s}`,teaching_assignment_id:t}),alert("Edit request sent to IQAC."),A(!1),Y({silent:!0})}catch(ce){alert((ce==null?void 0:ce.message)||"Request failed")}},children:"Request Edit"})]})]})}):null,me?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:9999},onClick:()=>{E||fe(null)},children:n.jsxs("div",{style:{width:"min(760px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:ce=>ce.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:me.mode==="confirm"?`Confirmation - ${s}`:`Request Edit - ${s}`}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:String(r).toUpperCase()})]}),me.mode==="confirm"?n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{background:"#fffbeb",border:"1px solid #fbbf24",borderRadius:8,padding:12,marginBottom:12},children:[n.jsx("div",{style:{fontWeight:700,color:"#92400e",marginBottom:4},children:" Important"}),n.jsxs("div",{style:{fontSize:12,color:"#78350f",lineHeight:1.5},children:["After confirming, Mark Manager will be ",n.jsx("strong",{children:"locked"}),". You'll need IQAC approval to change CO selection, experiment count, or max marks."]})]}),n.jsx("div",{style:{fontSize:13,color:"#374151",marginBottom:8,fontWeight:600},children:"Review your settings:"}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f9fafb"},children:[n.jsx("th",{style:{textAlign:"left",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb",fontWeight:700},children:"Item"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb",fontWeight:700},children:"Experiments"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb",fontWeight:700},children:"Max marks"})]})}),n.jsxs("tbody",{children:[St?n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:800},children:["CO-",a]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right",fontWeight:600},children:ze}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right",fontWeight:600},children:qe})]}):null,rt?n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:800},children:["CO-",i]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right",fontWeight:600},children:Ie}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right",fontWeight:600},children:Lt})]}):null,!St&&!rt?n.jsx("tr",{children:n.jsx("td",{colSpan:3,style:{padding:10,color:"#dc2626",fontWeight:600},children:" No COs selected"})}):null,n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:800},children:"CIA Exam"}),n.jsx("td",{colSpan:2,style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right",fontWeight:600},children:Me?" Enabled":" Disabled"})]})]})]})})]}):n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"This will send an edit request to IQAC. Mark Manager will remain locked until IQAC approves."}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[n.jsx("button",{className:"obe-btn",disabled:E,onClick:()=>fe(null),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:E||!e,onClick:async()=>{if(e){if(me.mode==="request"){fe(null),await gr();return}U(!0),M(null),Q(!0);try{const ce=ft(G.sheet),xe=le!=null&&le.approval_until?String(le.approval_until):G.sheet.markManagerApprovalUntil||null,se={...G,sheet:{...G.sheet,markManagerLocked:!0,markManagerSnapshot:ce,markManagerApprovalUntil:xe}};await Fs(r,String(e),se),S(new Date().toLocaleString()),await kd(r,String(e),t),await Y({silent:!1}),ne(se),fe(null),alert(" Mark Manager saved and locked successfully! You can now proceed with mark entry."),setTimeout(()=>Q(!1),1500)}catch(ce){M((ce==null?void 0:ce.message)||"Save failed"),Q(!1),ne(xe=>({...xe,sheet:{...xe.sheet,markManagerLocked:!1}}))}finally{U(!1)}}},children:E?"Saving...":me.mode==="confirm"?" Confirm & Lock":" Send Request"})]})]})}):null,N?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:70},onClick:()=>P(!1),children:n.jsxs("div",{style:{width:"min(1100px, 96vw)",maxHeight:"min(80vh, 900px)",overflow:"auto",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:ce=>ce.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"View Marks"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:[String(r).toUpperCase()," LAB"]})]}),ge?n.jsx("div",{style:{color:"#6b7280",marginBottom:8},children:"Loading published marks"}):null,R?n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10,maxWidth:"100%",whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:R}):null,(()=>{const ce=K&&K.sheet?K.sheet:G.sheet,xe=ce.ciaExamEnabled!==!1,se=Zn(Number(ce.expCountA??Ts),0,12),Se=Zn(Number(ce.expCountB??Ts),0,12),Ze=!!ce.coAEnabled,et=!!ce.coBEnabled,Et=Ze?se:0,wt=et?Se:0,gt=Et+wt,zt=Ma(ce.btlsA,se).slice(0,Et),Dt=Ma(ce.btlsB,Se).slice(0,wt),mr=new Set;for(const De of zt)mr.add(De);for(const De of Dt)mr.add(De);const pt=[1,2,3,4,5,6].filter(De=>mr.has(De)),Xt=Zn(Number(ce.expMaxA??Ha),0,100),Rt=Zn(Number(ce.expMaxB??Ha),0,100),_t=Xt+(xe?Hd/2:0),jr=Rt+(xe?Hd/2:0),Gr=Math.max(Xt,Rt,Ha),Cr=3+gt+1+(xe?1:0)+4+pt.length*2,Rr=Math.max(920,360+(gt+pt.length*2+(xe?1:0))*80);return n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{className:"obe-table",style:{width:"max-content",minWidth:Rr,tableLayout:"auto",borderCollapse:"collapse"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsx("th",{style:Ue,colSpan:Cr,children:s})}),n.jsxs("tr",{children:[n.jsx("th",{style:Ue,rowSpan:5,children:"S.No"}),n.jsx("th",{style:Ue,rowSpan:5,children:"Register No."}),n.jsx("th",{style:Ue,rowSpan:5,children:"Name of the Students"}),n.jsx("th",{style:Ue,colSpan:Math.max(1,gt),children:"Experiments"}),n.jsx("th",{style:Ue,rowSpan:5,children:"Total (Avg)"}),xe?n.jsx("th",{style:Ue,rowSpan:5,children:"CIA Exam"}):null,n.jsx("th",{style:Ue,colSpan:4,children:"CO ATTAINMENT"}),pt.length?n.jsx("th",{style:Ue,colSpan:pt.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[gt===0?n.jsx("th",{style:Ue,children:""}):n.jsxs(n.Fragment,{children:[Array.from({length:Et},(De,Ke)=>n.jsx("th",{style:Ue,children:a},`v_coa_${Ke}`)),Array.from({length:wt},(De,Ke)=>n.jsx("th",{style:Ue,children:i},`v_cob_${Ke}`))]}),n.jsxs("th",{style:Ue,colSpan:2,children:["CO-",a]}),n.jsxs("th",{style:Ue,colSpan:2,children:["CO-",i]}),pt.map(De=>n.jsxs("th",{style:Ue,colSpan:2,children:["BTL-",De]},`v_btl_${De}`))]}),n.jsxs("tr",{children:[gt===0?n.jsx("th",{style:Ue,children:""}):n.jsx(n.Fragment,{children:Array.from({length:gt},(De,Ke)=>n.jsx("th",{style:Ue,children:Gr},`v_max_${Ke}`))}),n.jsx("th",{style:Ue,children:_t}),n.jsx("th",{style:Ue,children:"%"}),n.jsx("th",{style:Ue,children:jr}),n.jsx("th",{style:Ue,children:"%"}),pt.map(De=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Ue,children:Gr}),n.jsx("th",{style:Ue,children:"%"})]},`v_btlmax_${De}`))]}),n.jsxs("tr",{children:[gt===0?n.jsx("th",{style:Ue,children:"No experiments"}):n.jsxs(n.Fragment,{children:[Array.from({length:Et},(De,Ke)=>n.jsxs("th",{style:Ue,children:["E",Ke+1]},`v_ea_${Ke}`)),Array.from({length:wt},(De,Ke)=>n.jsxs("th",{style:Ue,children:["E",Ke+1]},`v_eb_${Ke}`))]}),n.jsx("th",{style:Ue,colSpan:4+pt.length*2})]}),n.jsxs("tr",{children:[gt===0?n.jsx("th",{style:Ue,children:"BTL"}):n.jsxs(n.Fragment,{children:[Array.from({length:Et},(De,Ke)=>n.jsx("th",{style:Ue,children:zt[Ke]??1},`v_btla_${Ke}`)),Array.from({length:wt},(De,Ke)=>n.jsx("th",{style:Ue,children:Dt[Ke]??1},`v_btlb_${Ke}`))]}),n.jsx("th",{style:Ue,colSpan:4+pt.length*2})]})]}),n.jsxs("tbody",{children:[p.map((De,Ke)=>{var At;const Ce=(At=ce==null?void 0:ce.rowsByStudentId)==null?void 0:At[String(De.id)],it=Ro(Ce==null?void 0:Ce.marksA,se).slice(0,Et),tr=Ro(Ce==null?void 0:Ce.marksB,Se).slice(0,wt),Kt=it.concat(tr),yt=nf(Kt),Ht=nf(it),qt=nf(tr),lr=Ce==null?void 0:Ce.ciaExam,Mt=xe&&typeof lr=="number"&&Number.isFinite(lr)?lr:null,tt=Ht==null&&yt==null&&(!xe||Mt==null)?null:(Ht??0)+(xe?(Mt??0)/2:0),Ft=qt==null&&yt==null&&(!xe||Mt==null)?null:(qt??0)+(xe?(Mt??0)/2:0),Qt={};for(const bt of pt){const V=[];for(let ie=0;ie<it.length;ie++)if(zt[ie]===bt){const _e=it[ie];typeof _e=="number"&&Number.isFinite(_e)&&V.push(_e)}for(let ie=0;ie<tr.length;ie++)if(Dt[ie]===bt){const _e=tr[ie];typeof _e=="number"&&Number.isFinite(_e)&&V.push(_e)}Qt[bt]=V.length?V.reduce((ie,_e)=>ie+_e,0)/V.length:null}return n.jsxs("tr",{children:[n.jsx("td",{style:{...er,textAlign:"center",width:42,minWidth:42},children:Ke+1}),n.jsx("td",{style:er,children:De.reg_no}),n.jsx("td",{style:er,children:De.name}),gt===0?n.jsx("td",{style:{...er,textAlign:"center",color:"#6b7280"},children:""}):n.jsxs(n.Fragment,{children:[Array.from({length:Et},(bt,V)=>n.jsx("td",{style:{...er,width:78,minWidth:78,background:"#fff7ed",textAlign:"center",fontWeight:800},children:it[V]??""},`v_ma_${De.id}_${V}`)),Array.from({length:wt},(bt,V)=>n.jsx("td",{style:{...er,width:78,minWidth:78,background:"#fff7ed",textAlign:"center",fontWeight:800},children:tr[V]??""},`v_mb_${De.id}_${V}`))]}),n.jsx("td",{style:{...er,textAlign:"right",fontWeight:800},children:yt==null?"":yt.toFixed(1)}),xe?n.jsx("td",{style:{...er,width:90,minWidth:90,background:"#fff7ed",textAlign:"center",fontWeight:800},children:(Ce==null?void 0:Ce.ciaExam)??""}):null,n.jsx("td",{style:{...er,textAlign:"right"},children:tt==null?"":tt.toFixed(1)}),n.jsx("td",{style:{...er,textAlign:"right"},children:sf(tt,_t)}),n.jsx("td",{style:{...er,textAlign:"right"},children:Ft==null?"":Ft.toFixed(1)}),n.jsx("td",{style:{...er,textAlign:"right"},children:sf(Ft,jr)}),pt.map(bt=>{const V=Qt[bt]??null;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...er,textAlign:"right"},children:V==null?"":V.toFixed(1)}),n.jsx("td",{style:{...er,textAlign:"right"},children:sf(V,Gr)})]},`v_btl_${De.id}_${bt}`)})]},`v_${De.id}`)}),p.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:Cr,style:{padding:10,color:"#6b7280"},children:"No students."})}):null]})]})})})(),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:n.jsx("button",{type:"button",className:"obe-btn",onClick:()=>P(!1),children:"Close"})})]})}):null]})}new URL("https://static.vecteezy.com/system/resources/thumbnails/014/585/778/small/gold-locked-padlock-png.png",import.meta.url).href;const nb={co1:42,co2:42,co3:58,co4:42,co5:42},ts=5,gs=25,Yc=30;function Ir(e,t,r){return Number.isFinite(e)?Math.max(t,Math.min(r,Math.trunc(e))):t}function tK(e){return Math.round(e*10)/10}function rK(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const o=r.localeCompare(s);if(o)return o}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim();return a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})}function ra(e,t){const r=Array.isArray(e)?e:[],s=[];for(let a=0;a<t;a++){const i=r[a];if(i===""||i==null){s.push("");continue}const o=typeof i=="number"?i:Number(i);s.push(Number.isFinite(o)?o:"")}return s}function Rl(e,t,r=1){const s=Array.isArray(e)?e:[],a=[];for(let i=0;i<t;i++){const o=s[i];if(o===""||o==null){a.push(r);continue}const l=typeof o=="number"?o:Number(o);a.push(Number.isFinite(l)&&l>=1&&l<=6?Math.trunc(l):r)}return a}function lh(e){const t=e.filter(r=>typeof r=="number"&&Number.isFinite(r));return t.length?t.reduce((r,s)=>r+s,0)/t.length:null}function tx(e,t){if(e==null)return"";if(!Number.isFinite(t)||t<=0)return"0";const r=e/t*100;return`${Number.isFinite(r)?r.toFixed(0):0}`}function Kj(e,t=7){const r=String(e??"").trim();return r?r.length<=t?r:r.slice(-t):""}function nK(e,t){return`${e}_sheet_${t}`}function Bx({subjectId:e,teachingAssignmentId:t,assessmentKey:r,label:s,coA:a,coB:i,skipMarkManager:o=!1,itemLabel:l,itemLabelPlural:c,itemAbbrev:d,ciaExamAvailable:u,absentEnabled:h,autoSaveDraft:p,autoSaveDelayMs:f,viewerMode:x,floatPanelOnTable:g}){const[y,m]=v.useState([]),[w,S]=v.useState(!1),[k,F]=v.useState(null),[L,C]=v.useState(null),[O,T]=v.useState(!1),[W,A]=v.useState(null),[N,P]=v.useState(null),[K,re]=v.useState(!1),[ge,Fe]=v.useState(null),[R,q]=v.useState(!1),[me,fe]=v.useState(!1),[E,U]=v.useState(""),[I,M]=v.useState(!1),[te,Q]=v.useState(null),[G,ne]=v.useState(!1),[z,he]=v.useState(null),[X,H]=v.useState(!1),[oe,D]=v.useState(null),[Y,le]=v.useState(!1),[$e,je]=v.useState(null),[We,Ee]=v.useState(!1),[Re,Ve]=v.useState(null),[St,rt]=v.useState(null),ze=String(l||"Experiment"),Ie=String(c||"Experiments"),ot=String(d||"E"),be=u!==!1,we=!!(h??r==="model"),Me=!!p,Wt=Ir(Number(f??900),250,5e3),Ct=v.useRef(null),pr=v.useRef(null),fr=v.useMemo(()=>e?nK(r,String(e)):"",[r,e]),{data:Be,publishAllowed:mt,refresh:It}=Ru({assessment:r,subjectCode:String(e||""),teachingAssignmentId:t,options:{poll:!1}}),{data:ft,refresh:gr}=Bu({assessment:r,subjectCode:String(e||""),teachingAssignmentId:t,options:{poll:!1}}),{data:Mr}=Xo({assessment:r,subjectCode:String(e||""),scope:"MARK_MANAGER",teachingAssignmentId:t,options:{poll:!0}}),{data:$r,refresh:_r}=Xo({assessment:r,subjectCode:String(e||""),scope:"MARK_ENTRY",teachingAssignmentId:t,options:{poll:!0}}),[Vr,en]=v.useState(null),Xr=!!ge||!!(ft!=null&&ft.exists&&(ft!=null&&ft.is_published)),gn=ft!=null&&ft.mark_entry_unblocked_until?String(ft.mark_entry_unblocked_until):null,Oe=ft!=null&&ft.mark_manager_unlocked_until?String(ft.mark_manager_unlocked_until):null,qe=!!gn&&!!(ft!=null&&ft.entry_open)&&(Vr==null||gn!==(Vr.markEntryUnblockedUntil??null)),Lt=!!Oe&&(Vr==null||Oe!==(Vr.markManagerUnlockedUntil??null)),dt=Xr?!!(ft!=null&&ft.entry_open)&&(Vr==null||qe||Lt):!0,He=!!(Xr&&!dt),$t=!!(Be!=null&&Be.global_override_active&&(Be==null?void 0:Be.global_is_open)===!1),[Ue,er]=v.useState(()=>({sheet:{termLabel:"KRCT AY25-26",batchLabel:String(e||""),coANum:Ir(Number(a??1),1,5),coBNum:i==null?null:Ir(Number(i),1,5),coAEnabled:!0,coBEnabled:!!i,ciaExamEnabled:!!be,expCountA:ts,expCountB:i?ts:0,expMaxA:gs,expMaxB:i?gs:0,btlA:Array.from({length:ts},()=>1),btlB:i?Array.from({length:ts},()=>1):[],coConfigs:{[String(Ir(Number(a??1),1,5))]:{enabled:!0,expCount:ts,expMax:gs,btl:Array.from({length:ts},()=>1)},...i==null?{}:{[String(Ir(Number(i),1,5))]:{enabled:!0,expCount:ts,expMax:gs,btl:Array.from({length:ts},()=>1)}}},rowsByStudentId:{},markManagerLocked:!1,markManagerSnapshot:null}})),[Z,pe]=v.useState(null);v.useMemo(()=>On(Z),[Z]);const ee=v.useMemo(()=>nw(Z),[Z]);v.useEffect(()=>{let Ye=!0;return(async()=>{try{const st=await Sl();if(!Ye)return;er(at=>({...at,sheet:{...at.sheet,termLabel:String((st==null?void 0:st.termLabel)||at.sheet.termLabel||"KRCT AY25-26"),batchLabel:String(e||at.sheet.batchLabel||"")}}))}catch{}})(),()=>{Ye=!1}},[e]),v.useEffect(()=>{let Ye=!0;return(async()=>{if(e)try{const st=String(e).trim().toUpperCase(),at=await vo();if(!Ye)return;const nt=(at||[]).find(vt=>String(vt.course_code||"").trim().toUpperCase()===st);if(nt&&(nt!=null&&nt.class_type)){pe((nt==null?void 0:nt.class_type)??null);return}const xt=await jc();if(!Ye)return;const rr=(xt||[]).find(vt=>String(vt.course_code||"").trim().toUpperCase()===st);pe((rr==null?void 0:rr.class_type)??null)}catch{Ye&&pe(null)}})(),()=>{Ye=!1}},[e]),v.useEffect(()=>{let Ye=!0;return(async()=>{var st,at;if(e)try{const nt=await En(r,String(e));if(!Ye)return;const xt=nt==null?void 0:nt.draft;if(xt&&typeof xt=="object"&&xt.sheet&&typeof xt.sheet=="object"){const rr=Ir(Number(a??1),1,5),vt=i==null?null:Ir(Number(i),1,5),dr=rr,ir=vt,Br=!!(xt.sheet.coAEnabled??!0),kr=!!(xt.sheet.coBEnabled??!!ir),Ur=be?!!(xt.sheet.ciaExamEnabled??!0):!1,zr=Ir(Number(xt.sheet.expCountA??ts),0,12),Or=Ir(Number(xt.sheet.expCountB??(kr?ts:0)),0,12),Lr=Number.isFinite(Number(xt.sheet.expMaxA))?Number(xt.sheet.expMaxA):gs,cn=Number.isFinite(Number(xt.sheet.expMaxB))?Number(xt.sheet.expMaxB):kr?gs:0,nr=Rl(xt.sheet.btlA,zr,1),ar=Rl(xt.sheet.btlB,Or,1),j=xt.sheet.coConfigs,ae={};if(j&&typeof j=="object")for(const xn of Object.keys(j)){const An=j[xn]||{},Dn=Ir(Number(An.expCount??ts),0,12);ae[xn]={enabled:!!An.enabled,expCount:Dn,expMax:Number.isFinite(Number(An.expMax))?Number(An.expMax):gs,btl:Rl(An.btl,Dn,1)}}const Ne=String(dr);if(ae[Ne]||(ae[Ne]={enabled:Br,expCount:zr,expMax:Lr,btl:nr}),ir!=null){const xn=String(ir);ae[xn]||(ae[xn]={enabled:kr,expCount:Or,expMax:cn,btl:ar})}const Xe=!!(((st=ae[String(dr)])==null?void 0:st.enabled)??Br),ut=!!(ir!=null&&(((at=ae[String(ir)])==null?void 0:at.enabled)??kr)),Jt=xn=>{const An=xn&&typeof xn=="object"?xn:{},Dn={};for(const[ws,ps]of Object.entries(An)){const $n=ps&&typeof ps=="object"?ps:{},Sa=$n!=null&&$n.marksByCo&&typeof $n.marksByCo=="object"?{...$n.marksByCo}:{},Fa=ra($n==null?void 0:$n.marksA,zr),$a=ra($n==null?void 0:$n.marksB,Or),Ao=ra(Sa[Ne],zr),jl=ir!=null?ra(Sa[String(ir)],Or):[],eo=Nl=>Nl.some(ha=>ha!==""&&ha!=null),Yl=eo(Fa)?Fa:eo(Ao)?Ao:Fa,Kl=Or?eo($a)?$a:eo(jl)?jl:$a:$a;Sa[Ne]=Ao,ir!=null&&(Sa[String(ir)]=jl),Dn[String(ws)]={...$n,studentId:Number.isFinite(Number($n==null?void 0:$n.studentId))?Number($n.studentId):Number(ws),marksA:Yl,marksB:Kl,marksByCo:Sa}}return Dn},ur=xt.sheet.markManagerSnapshot??null,Kr=xt.sheet.markManagerApprovalUntil??null,Zr=xt.sheet.markManagerLocked,pn=typeof Zr=="boolean"?Zr:!!ur;er({sheet:{termLabel:String(xt.sheet.termLabel||"KRCT AY25-26"),batchLabel:String(e),coANum:dr,coBNum:ir,coAEnabled:Xe,coBEnabled:ut,ciaExamEnabled:Ur,expCountA:zr,expCountB:Or,expMaxA:Lr,expMaxB:cn,btlA:nr,btlB:ar,coConfigs:ae,rowsByStudentId:Jt(xt.sheet.rowsByStudentId),markManagerLocked:pn,markManagerSnapshot:ur,markManagerApprovalUntil:Kr}});const wn=(nt==null?void 0:nt.updated_at)??null,_n=(nt==null?void 0:nt.updated_by)??null;if(wn)try{A(new Date(String(wn)).toLocaleString())}catch{A(String(wn))}_n&&P(String(_n.name||_n.username||_n.id||""));try{fr&&yn(fr,{rowsByStudentId:xt.sheet.rowsByStudentId||{}})}catch{}}else{const rr=fr?Bn(fr):null,vt=rr!=null&&rr.rowsByStudentId&&typeof rr.rowsByStudentId=="object"?rr.rowsByStudentId:{},dr=Ir(Number(a??1),1,5),ir=i==null?null:Ir(Number(i),1,5),Br=ts,kr=ir!=null?ts:0,Ur=gs,zr=ir!=null?gs:0,Or=Array.from({length:Br},()=>1),Lr=ir!=null?Array.from({length:kr},()=>1):[],cn={[String(dr)]:{enabled:!0,expCount:Br,expMax:Ur,btl:Or},...ir==null?{}:{[String(ir)]:{enabled:!0,expCount:kr,expMax:zr,btl:Lr}}};er({sheet:{termLabel:"KRCT AY25-26",batchLabel:String(e||""),coANum:dr,coBNum:ir,coAEnabled:!0,coBEnabled:!!ir,ciaExamEnabled:!!be,expCountA:Br,expCountB:kr,expMaxA:Ur,expMaxB:zr,btlA:Or,btlB:Lr,coConfigs:cn,rowsByStudentId:vt,markManagerLocked:!1,markManagerSnapshot:null}})}}catch{}})(),()=>{Ye=!1}},[r,e,fr,a,i]),v.useEffect(()=>{let Ye=!0;return(async()=>{var st,at,nt;if(!t){m([]);return}S(!0),F(null);try{let xt=null;try{const vt=await hr(`/api/academics/teaching-assignments/${t}/`);if(vt.ok){const dr=await vt.json();if(dr&&dr.elective_subject_id&&!dr.section_id){const ir=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(dr.elective_subject_id))}`);if(ir.ok){const Br=await ir.json();xt=(Array.isArray(Br.results)?Br.results:Array.isArray(Br)?Br:Br.items||[]).map(Ur=>({id:Number(Ur.student_id??Ur.id),reg_no:String(Ur.reg_no??Ur.regno??""),name:String(Ur.name??Ur.full_name??Ur.username??""),section:Ur.section_name??Ur.section??null}))}}}}catch{}if(!xt){const vt=await Jo(t);C({courseName:String(((st=vt==null?void 0:vt.teaching_assignment)==null?void 0:st.subject_name)||""),courseCode:String(((at=vt==null?void 0:vt.teaching_assignment)==null?void 0:at.subject_code)||e||""),className:String(((nt=vt==null?void 0:vt.teaching_assignment)==null?void 0:nt.section_name)||"")}),xt=((vt==null?void 0:vt.students)||[]).map(ir=>({id:Number(ir.id),reg_no:String(ir.reg_no??""),name:String(ir.name??""),section:ir.section??null}))}if(!Ye)return;const rr=(xt||[]).filter(vt=>Number.isFinite(vt.id)).sort(rK);m(rr),er(vt=>{const dr=Ir(Number(vt.sheet.expCountA??ts),0,12),ir=Ir(Number(vt.sheet.expCountB??0),0,12),Br={...vt.sheet.rowsByStudentId||{}};for(const kr of rr){const Ur=String(kr.id);Br[Ur]||(Br[Ur]={studentId:kr.id,absent:!1,absentKind:void 0,marksA:Array.from({length:dr},()=>""),marksB:Array.from({length:ir},()=>""),marksByCo:{},ciaExam:""})}return{...vt,sheet:{...vt.sheet,rowsByStudentId:Br}}})}catch(xt){if(!Ye)return;m([]),F((xt==null?void 0:xt.message)||"Failed to load roster")}finally{Ye&&S(!1)}})(),()=>{Ye=!1}},[t]),v.useEffect(()=>{if(fr)try{yn(fr,{rowsByStudentId:Ue.sheet.rowsByStudentId})}catch{}},[Ue.sheet.rowsByStudentId,fr]),v.useEffect(()=>{if(!e||!!!Ue.sheet.markManagerSnapshot)return;if(Xr&&(ft!=null&&ft.exists)){const nt=!!(ft!=null&&ft.mark_manager_locked);!!Ue.sheet.markManagerLocked!==nt&&er(xt=>({...xt,sheet:{...xt.sheet,markManagerLocked:nt}}));return}const st=!!(Mr!=null&&Mr.allowed_by_approval),at=Mr!=null&&Mr.approval_until?String(Mr.approval_until):null;if(st&&at){const nt=Ue.sheet.markManagerApprovalUntil?String(Ue.sheet.markManagerApprovalUntil):null;Ue.sheet.markManagerLocked&&nt!==at&&er(xt=>({...xt,sheet:{...xt.sheet,markManagerLocked:!1,markManagerApprovalUntil:at}}));return}Ue.sheet.markManagerLocked||er(nt=>({...nt,sheet:{...nt.sheet,markManagerLocked:!0}}))},[e,Xr,ft==null?void 0:ft.exists,ft==null?void 0:ft.mark_manager_locked,Mr==null?void 0:Mr.allowed_by_approval,Mr==null?void 0:Mr.approval_until,Ue.sheet.markManagerLocked,Ue.sheet.markManagerSnapshot,Ue.sheet.markManagerApprovalUntil]);const ue=Ir(Number(Ue.sheet.coANum??a??1),1,5),Ae=Ue.sheet.coBNum??i??null,Le=Ae==null?null:Ir(Number(Ae),1,5),ct=v.useMemo(()=>[1,2,3,4,5],[]),ce=v.useMemo(()=>new Set(ct.map(Ye=>String(Ye))),[ct]);Ir(Number(Ue.sheet.expCountA??ts),0,12),Ir(Number(Ue.sheet.expCountB??0),0,12),Ue.sheet.coAEnabled,Ue.sheet.coBEnabled&&Le!=null;const xe=v.useMemo(()=>mr(Ue.sheet),[Ue.sheet]),se=!!Ue.sheet.markManagerLocked,Se=be?Ue.sheet.ciaExamEnabled!==!1:!1;v.useMemo(()=>pt(xe,Se),[xe,Se]);const Ze=!dt,et=v.useMemo(()=>Object.entries(xe||{}).filter(([Ye,st])=>ce.has(String(Ye))&&!!(st&&st.enabled)).map(([Ye,st])=>({coNumber:Number(Ye),expCount:Ir(Number(st.expCount??0),0,12),expMax:Ir(Number(st.expMax??0),0,100),btl:st.btl??[]})),[xe,ce]),Et=v.useMemo(()=>et.reduce((Ye,st)=>Ye+st.expCount,0),[et]),wt=Math.max(Et,1),gt=et.length>0,zt=gt?et.length*2:2,Dt=v.useMemo(()=>et.reduce((Ye,st)=>Math.max(Ye,st.expMax),0),[et]);v.useMemo(()=>{if(!we)return!1;const Ye=Ue.sheet.rowsByStudentId||{};return Object.values(Ye).some(st=>!!(st!=null&&st.absent))},[we,Ue.sheet.rowsByStudentId]),v.useMemo(()=>!x&&Xr&&!dt?[]:!we||!X?y:y.filter(Ye=>{var st,at;return!!((at=(st=Ue.sheet.rowsByStudentId)==null?void 0:st[String(Ye.id)])!=null&&at.absent)}),[x,Xr,dt,we,y,X,Ue.sheet.rowsByStudentId]),v.useEffect(()=>{if(!Me||!e||Ze||He)return;pr.current!=null&&(window.clearTimeout(pr.current),pr.current=null);const Ye=JSON.stringify(Ue);if(Ye!==Ct.current)return pr.current=window.setTimeout(async()=>{if(e)try{T(!0),await Fs(r,String(e),Ue),Ct.current=Ye,A(new Date().toLocaleString())}catch{}finally{T(!1)}},Wt),()=>{pr.current!=null&&(window.clearTimeout(pr.current),pr.current=null)}},[Me,Wt,r,Ue,He,e,Ze]);function mr(Ye){const at={...Ye.coConfigs&&typeof Ye.coConfigs=="object"?Ye.coConfigs:{}};for(const nt of[1,2,3,4,5]){const xt=String(nt),rr=at[xt];if(!rr)at[xt]={enabled:!1,expCount:ts,expMax:gs,btl:Array.from({length:ts},()=>1)};else{const vt=Ir(Number(rr.expCount??ts),0,12);at[xt]={enabled:!!rr.enabled,expCount:vt,expMax:Ir(Number(rr.expMax??gs),0,100),btl:Rl(rr.btl,vt,1)}}}return at}function pt(Ye,st){const at=Object.entries(Ye).filter(([nt,xt])=>ce.has(String(nt))&&!!(xt!=null&&xt.enabled)).map(([nt,xt])=>({co:Ir(Number(nt),1,5),expCount:Ir(Number((xt==null?void 0:xt.expCount)??0),0,12),expMax:Ir(Number((xt==null?void 0:xt.expMax)??0),0,100)})).sort((nt,xt)=>nt.co-xt.co);return JSON.stringify({enabled:at,ciaExamEnabled:!!st})}function Xt(Ye){if(!Ye)return null;try{const st=JSON.parse(String(Ye)),at=Array.isArray(st==null?void 0:st.enabled)?st.enabled:[],nt={};for(const xt of[1,2,3,4,5])nt[String(xt)]={enabled:!1,expCount:ts,expMax:gs,btl:Array.from({length:ts},()=>1)};for(const xt of at){const rr=Ir(Number(xt==null?void 0:xt.co),1,5);nt[String(rr)]={...nt[String(rr)],enabled:!0,expCount:Ir(Number((xt==null?void 0:xt.expCount)??ts),0,12),expMax:Ir(Number((xt==null?void 0:xt.expMax)??gs),0,100)}}return nt}catch{return null}}function Rt(Ye,st,at,nt){if(!Ye)return 0;const xt=new Set(st.map(vt=>String(vt)));let rr=0;for(const vt of Object.values(Ye)){if(!vt||typeof vt!="object")continue;const dr=vt.marksByCo&&typeof vt.marksByCo=="object"?vt.marksByCo:{};let ir=!1;for(const Br of st){const kr=String(Br);if(!xt.has(kr))continue;const Ur=dr[kr];if(Array.isArray(Ur)&&Ur.some(zr=>zr!==""&&zr!=null)){ir=!0;break}if(!ir&&Br===at&&Array.isArray(vt.marksA)&&vt.marksA.some(zr=>zr!==""&&zr!=null)&&(ir=!0),!ir&&nt!=null&&Br===nt&&Array.isArray(vt.marksB)&&vt.marksB.some(zr=>zr!==""&&zr!=null)&&(ir=!0),ir)break}ir&&rr++}return rr}function _t(Ye){return Object.entries(Ye).filter(([st,at])=>ce.has(String(st))&&!!(at!=null&&at.enabled)).map(([st])=>Ir(Number(st),1,5)).sort((st,at)=>st-at)}function jr(Ye,st){const at=[],nt=[],xt=[];for(const rr of[1,2,3,4,5]){const vt=String(rr),dr=Ye[vt],ir=st[vt],Br=!!(dr!=null&&dr.enabled),kr=!!(ir!=null&&ir.enabled);if(!dr&&ir){kr&&at.push(rr);continue}if(dr&&!ir){Br&&nt.push(rr);continue}if(dr&&ir){const Ur=Ir(Number(dr.expCount??0),0,12),zr=Ir(Number(ir.expCount??0),0,12),Or=Ir(Number(dr.expMax??0),0,100),Lr=Ir(Number(ir.expMax??0),0,100);(Br!==kr||Ur!==zr||Or!==Lr)&&xt.push(rr)}}return{added:at,removed:nt,changed:xt}}function Gr(Ye,st){if(!Ye)return 0;let at=0;for(const nt of Object.values(Ye)){if(!nt||typeof nt!="object")continue;if(Array.isArray(nt.marksA)&&nt.marksA.some(dr=>dr!==""&&dr!=null)||Array.isArray(nt.marksB)&&nt.marksB.some(dr=>dr!==""&&dr!=null)||nt.ciaExam!==""&&nt.ciaExam!=null){at++;continue}const rr=nt.marksByCo&&typeof nt.marksByCo=="object"?nt.marksByCo:{};let vt=!1;for(const dr of st){const ir=rr[String(dr)];if(Array.isArray(ir)&&ir.some(Br=>Br!==""&&Br!=null)){vt=!0;break}}vt&&at++}return at}function Cr(Ye){er(st=>!be||st.sheet.markManagerLocked?st:{...st,sheet:{...st.sheet,ciaExamEnabled:!!Ye}})}function Rr(Ye,st){er(at=>{var dr;const nt=String(Ye),xt=(dr=at.sheet.rowsByStudentId)==null?void 0:dr[nt];if(!xt)return at;const rr=Ir(Number(at.sheet.expCountA??ts),0,12),vt=Ir(Number(at.sheet.expCountB??0),0,12);return st?{...at,sheet:{...at.sheet,rowsByStudentId:{...at.sheet.rowsByStudentId,[nt]:{...xt,absent:!0,absentKind:xt.absentKind||"AL",marksA:Array.from({length:rr},()=>""),marksB:Array.from({length:vt},()=>""),ciaExam:""}}}}:{...at,sheet:{...at.sheet,rowsByStudentId:{...at.sheet.rowsByStudentId,[nt]:{...xt,absent:!1,absentKind:void 0}}}}})}function De(Ye,st){er(at=>{var rr;const nt=String(Ye),xt=(rr=at.sheet.rowsByStudentId)==null?void 0:rr[nt];return xt?{...at,sheet:{...at.sheet,rowsByStudentId:{...at.sheet.rowsByStudentId,[nt]:{...xt,absent:!0,absentKind:st}}}}:at})}function Ke(Ye,st){const at=Ir(Number(Ye),1,5);er(nt=>{if(nt.sheet.markManagerLocked)return nt;const xt=mr(nt.sheet),rr=String(at),vt=xt[rr],dr=Ir(Number((vt==null?void 0:vt.expCount)??ts),0,12),ir=Ir(Number((vt==null?void 0:vt.expMax)??gs),0,100),Br=Rl((vt==null?void 0:vt.btl)??[],dr,1);xt[rr]={enabled:!!st,expCount:dr,expMax:ir,btl:Br};const kr=Ir(Number(nt.sheet.coANum??a??1),1,5),Ur=nt.sheet.coBNum??i??null,zr=Ur==null?null:Ir(Number(Ur),1,5),Or={...nt.sheet,coConfigs:xt};return at===kr&&(Or.coAEnabled=!!st),zr!=null&&at===zr&&(Or.coBEnabled=!!st),{...nt,sheet:Or}})}async function Ce(){if(!e)return;le(!0),je(null);const Ye=new Date,st=ft!=null&&ft.mark_manager_unlocked_until?String(ft.mark_manager_unlocked_until):null;try{const at=await Yi({assessment:r,subject_code:String(e),scope:"MARK_MANAGER",reason:`Edit request: Mark Manager changes for ${s}`,teaching_assignment_id:t});alert("Edit request sent to IQAC. Waiting for approval...");const nt=Number(at==null?void 0:at.id),xt=Ye.getTime()-2e3;(async()=>{for(let dr=0;dr<36;dr++){try{const ir=await lp({assessment:r,subject_code:String(e),scope:"MARK_MANAGER",teaching_assignment_id:t}),Br=ir==null?void 0:ir.result;if(!Br)throw new Error("No status");if(Number.isFinite(nt)&&nt>0&&Number(Br.id)!==nt)throw new Error("Different request");const kr=Br.reviewed_at?new Date(String(Br.reviewed_at)).getTime():0,Ur=String(Br.status||"").toUpperCase();if(Ur==="APPROVED"&&kr>=xt){try{gr({silent:!0})}catch{}alert("IQAC approved the mark-manager edit request. You can now edit mark-manager settings.");return}if(Ur==="REJECTED"&&kr>=xt){alert("IQAC rejected the mark-manager edit request.");return}}catch{try{const ir=ft!=null&&ft.mark_manager_unlocked_until?String(ft.mark_manager_unlocked_until):null;if(ir&&st&&ir!==st){try{gr({silent:!0})}catch{}alert("IQAC approved the mark-manager edit request. You can now edit mark-manager settings.");return}}catch{}}await new Promise(ir=>setTimeout(ir,5e3))}alert("Edit request still pending. Please try again later.")})()}catch(at){je((at==null?void 0:at.message)||"Request failed"),alert((at==null?void 0:at.message)||"Request failed")}finally{le(!1)}}async function it(Ye,st=[]){if(e){le(!0),je(null);try{const at=Ir(Number(a??1),1,5),nt=i==null?null:Ir(Number(i),1,5),xt=pt(xe,Se),rr=Mr!=null&&Mr.approval_until?String(Mr.approval_until):Ue.sheet.markManagerApprovalUntil||null,vt=xe[String(at)],dr=nt==null?null:xe[String(nt)],ir=!!(vt!=null&&vt.enabled),Br=!!(nt!=null&&(dr!=null&&dr.enabled)),kr=Ir(Number((vt==null?void 0:vt.expCount)??Ue.sheet.expCountA??ts),0,12),Ur=Ir(Number((vt==null?void 0:vt.expMax)??Ue.sheet.expMaxA??gs),0,100),zr=Rl((vt==null?void 0:vt.btl)??Ue.sheet.btlA,kr,1),Or=nt==null?0:Ir(Number((dr==null?void 0:dr.expCount)??Ue.sheet.expCountB??ts),0,12),Lr=nt==null?0:Ir(Number((dr==null?void 0:dr.expMax)??Ue.sheet.expMaxB??gs),0,100),cn=nt==null?[]:Rl((dr==null?void 0:dr.btl)??Ue.sheet.btlB,Or,1),nr=new Set(Ye==="full"?[1,2,3,4,5].map(String):Ye==="partial"?st.map(Ne=>String(Ir(Number(Ne),1,5))):[]),ar=(Ne,Xe,ut)=>{const Jt=Ne!=null&&Ne.marksByCo&&typeof Ne.marksByCo=="object"?Ne.marksByCo:{};return ra(Jt[Xe],ut)},j=Ne=>Ne.some(Xe=>Xe!==""&&Xe!=null),ae={...Ue,sheet:{...Ue.sheet,coANum:at,coBNum:nt,coAEnabled:ir,coBEnabled:Br,expCountA:kr,expCountB:Or,expMaxA:Ur,expMaxB:Lr,btlA:zr,btlB:cn,coConfigs:xe,markManagerLocked:!0,markManagerSnapshot:xt,markManagerApprovalUntil:rr,rowsByStudentId:Object.fromEntries(Object.entries(Ue.sheet.rowsByStudentId||{}).map(([Ne,Xe])=>{const ut=Xe&&typeof Xe=="object"?Xe:{};let Jt=ut!=null&&ut.marksByCo&&typeof ut.marksByCo=="object"?{...ut.marksByCo}:{};if(Ye==="full")Jt={},ut.marksA=Array.from({length:kr},()=>""),ut.marksB=Array.from({length:Or},()=>""),ut.ciaExam="";else if(Ye==="partial"&&nr.size)for(const xn of Array.from(nr)){const An=xe[String(xn)],Dn=Ir(Number((An==null?void 0:An.expCount)??0),0,12);Dn>0?Jt[String(xn)]=Array.from({length:Dn},()=>""):delete Jt[String(xn)],Number(xn)===at&&(ut.marksA=Array.from({length:kr},()=>"")),nt!=null&&Number(xn)===nt&&(ut.marksB=Array.from({length:Or},()=>""))}const ur=ra(ut==null?void 0:ut.marksA,kr),Kr=ra(ut==null?void 0:ut.marksB,Or),Zr=ra(Jt[String(at)]??ar(ut,String(at),kr),kr),pn=nt==null?[]:ra(Jt[String(nt)]??ar(ut,String(nt),Or),Or),wn=j(ur)?ur:j(Zr)?Zr:ur,_n=Or?j(Kr)?Kr:j(pn)?pn:Kr:Kr;return Jt[String(at)]=Zr,nt!=null&&(Jt[String(nt)]=pn),[Ne,{...ut,marksA:wn,marksB:_n,marksByCo:Jt}]}))}};er(ae),D(null),rt(null),Ee(!0),await Fs(r,String(e),ae),A(new Date().toLocaleString());try{await kd(r,String(e),t),gr({silent:!0})}catch(Ne){console.warn("confirmMarkManagerLock failed",Ne)}}catch(at){je((at==null?void 0:at.message)||"Save failed")}finally{le(!1),setTimeout(()=>Ee(!1),2e3)}}}function tr(Ye,st){const at=Ir(Number(st),0,12);er(nt=>{if(nt.sheet.markManagerLocked)return nt;const xt=mr(nt.sheet),rr=String(Ye),vt=xt[rr],dr=Ir(Number((vt==null?void 0:vt.expMax)??gs),0,100);xt[rr]={enabled:!!((vt==null?void 0:vt.enabled)??!0),expCount:at,expMax:dr,btl:Rl((vt==null?void 0:vt.btl)??[],at,1)};const ir=Ir(Number(nt.sheet.coANum??a??1),1,5),Br=nt.sheet.coBNum??i??null,kr=Br==null?null:Ir(Number(Br),1,5),Ur={...nt.sheet.rowsByStudentId||{}};for(const zr of Object.keys(Ur)){const Or=Ur[zr],Lr=Or!=null&&Or.marksByCo&&typeof Or.marksByCo=="object"?{...Or.marksByCo}:{};Lr[rr]=ra(Lr[rr],at);const cn={...Or,marksByCo:Lr};Ye===ir&&(cn.marksA=ra(Or.marksA,at)),kr!=null&&Ye===kr&&(cn.marksB=ra(Or.marksB,at)),Ur[zr]=cn}return{...nt,sheet:{...nt.sheet,coConfigs:xt,expCountA:Ye===ir?at:nt.sheet.expCountA,expCountB:Ye===kr?at:nt.sheet.expCountB,btlA:Ye===ir?xt[rr].btl:nt.sheet.btlA,btlB:Ye===kr?xt[rr].btl:nt.sheet.btlB,rowsByStudentId:Ur}}})}function Kt(Ye,st){const at=Ir(Number(st),0,100);er(nt=>{if(nt.sheet.markManagerLocked)return nt;const xt=mr(nt.sheet),rr=String(Ye),vt=xt[rr],dr=Ir(Number((vt==null?void 0:vt.expCount)??ts),0,12);xt[rr]={enabled:!!((vt==null?void 0:vt.enabled)??!0),expCount:dr,expMax:at,btl:Rl((vt==null?void 0:vt.btl)??[],dr,1)};const ir=Ir(Number(nt.sheet.coANum??a??1),1,5),Br=nt.sheet.coBNum??i??null,kr=Br==null?null:Ir(Number(Br),1,5),Ur=Ye===ir?at:Ir(Number(nt.sheet.expMaxA??gs),0,100),zr=Ye===kr?at:Ir(Number(nt.sheet.expMaxB??0),0,100),Or=Ir(Number(nt.sheet.expCountA??ts),0,12),Lr=Ir(Number(nt.sheet.expCountB??0),0,12),cn={};for(const[nr,ar]of Object.entries(nt.sheet.rowsByStudentId||{})){const j=ra(ar.marksA,Or).map(Xe=>typeof Xe=="number"?Ir(Xe,0,Ur):""),ae=ra(ar.marksB,Lr).map(Xe=>typeof Xe=="number"?Ir(Xe,0,zr):""),Ne=ar!=null&&ar.marksByCo&&typeof ar.marksByCo=="object"?{...ar.marksByCo}:{};Ne[rr]=ra(Ne[rr],dr).map(Xe=>typeof Xe=="number"?Ir(Xe,0,at):""),cn[nr]={...ar,marksA:j,marksB:ae,marksByCo:Ne}}return{...nt,sheet:{...nt.sheet,coConfigs:xt,expMaxA:Ur,expMaxB:zr,rowsByStudentId:cn}}})}function yt(Ye,st,at){er(nt=>{if(nt.sheet.markManagerLocked)return nt;const xt=mr(nt.sheet),rr=String(Ir(Number(Ye),1,5)),vt=xt[rr],dr=Ir(Number((vt==null?void 0:vt.expCount)??ts),0,12),ir=Rl((vt==null?void 0:vt.btl)??[],dr,1);st>=0&&st<ir.length&&(ir[st]=at),xt[rr]={enabled:!!((vt==null?void 0:vt.enabled)??!1),expCount:dr,expMax:Ir(Number((vt==null?void 0:vt.expMax)??gs),0,100),btl:ir};const Br=Ir(Number(nt.sheet.coANum??a??1),1,5),kr=nt.sheet.coBNum??i??null,Ur=kr==null?null:Ir(Number(kr),1,5);return{...nt,sheet:{...nt.sheet,coConfigs:xt,btlA:Ye===Br?ir:nt.sheet.btlA,btlB:Ye===Ur?ir:nt.sheet.btlB}}})}function Ht(Ye,st,at,nt){er(xt=>{var ae;const rr=String(Ye),vt=(ae=xt.sheet.rowsByStudentId)==null?void 0:ae[rr];if(!vt||we&&r!=="model"&&vt.absent)return xt;if(r==="model"){const Ne=!!vt.absent,Xe=Ne?String(vt.absentKind||"AL").toUpperCase():"";if(Ne&&!!!(X&&Ne&&(Xe==="ML"||Xe==="SKL")))return xt}const dr=mr(xt.sheet),ir=String(Ir(Number(st),1,5)),Br=dr[ir],kr=Ir(Number((Br==null?void 0:Br.expCount)??0),0,12),Ur=Ir(Number((Br==null?void 0:Br.expMax)??gs),0,100),zr=vt!=null&&vt.marksByCo&&typeof vt.marksByCo=="object"?{...vt.marksByCo}:{},Or=ra(zr[ir],kr),Lr=nt===""?"":Ir(Number(nt),0,Ur);at>=0&&at<Or.length&&(Or[at]=Lr),zr[ir]=Or;const cn=Ir(Number(xt.sheet.coANum??a??1),1,5),nr=xt.sheet.coBNum??i??null,ar=nr==null?null:Ir(Number(nr),1,5),j={...vt,marksByCo:zr};return st===cn&&(j.marksA=ra(vt.marksA,kr).map((Ne,Xe)=>Xe===at?Lr:Ne)),ar!=null&&st===ar&&(j.marksB=ra(vt.marksB,kr).map((Ne,Xe)=>Xe===at?Lr:Ne)),{...xt,sheet:{...xt.sheet,rowsByStudentId:{...xt.sheet.rowsByStudentId,[rr]:j}}}})}function qt(Ye,st){er(at=>{var vt;const nt=String(Ye),xt=(vt=at.sheet.rowsByStudentId)==null?void 0:vt[nt];if(!xt||!be||we&&r!=="model"&&xt.absent)return at;if(r==="model"){const dr=!!xt.absent,ir=dr?String(xt.absentKind||"AL").toUpperCase():"";if(dr&&!!!(X&&dr&&(ir==="ML"||ir==="SKL")))return at}const rr=st===""?"":Ir(Number(st),0,Yc);return{...at,sheet:{...at.sheet,rowsByStudentId:{...at.sheet.rowsByStudentId,[nt]:{...xt,ciaExam:rr}}}}})}async function lr(){if(e){T(!0);try{await Fs(r,String(e),Ue),A(new Date().toLocaleString()),alert("Draft saved.")}catch(Ye){alert((Ye==null?void 0:Ye.message)||"Draft save failed")}finally{T(!1)}}}async function Mt(){if(!e||!window.confirm(`Reset all marks for ${s}? This clears the draft for all students.`))return;const st=Ir(Number(Ue.sheet.expCountA??ts),0,12),at=Ir(Number(Ue.sheet.expCountB??0),0,12),nt={};for(const rr of y)nt[String(rr.id)]={studentId:rr.id,absent:!1,absentKind:void 0,marksA:Array.from({length:st},()=>""),marksB:Array.from({length:at},()=>""),marksByCo:{},ciaExam:""};const xt={sheet:{...Ue.sheet,btlA:Array.from({length:st},()=>1),btlB:Array.from({length:at},()=>1),rowsByStudentId:nt}};er(xt);try{fr&&yn(fr,{rowsByStudentId:{}})}catch{}try{await Fs(r,String(e),xt),A(new Date().toLocaleString())}catch{}}async function tt(){if(!e)return;if($t){alert("Publishing is locked by IQAC.");return}if(!mt){alert("Publish window is closed. Please request IQAC approval.");return}if(Xr&&He&&!x){q(!0);return}re(!0);const Ye=ge,st=Vr,at={markEntryUnblockedUntil:gn,markManagerUnlockedUntil:Oe};try{console.debug("publish called",{assessment:r,subjectId:e,entryOpen:dt,publishAllowed:mt,globalLocked:$t}),Fe(new Date().toLocaleString()),en(at),await dg(r,String(e),Ue,t),console.debug("publish succeeded",{assessment:r,subjectId:e}),await Ft(!1),It(),gr({silent:!0});try{console.debug("obe:published dispatch",{assessment:r,subjectId:e}),window.dispatchEvent(new CustomEvent("obe:published",{detail:{subjectId:e,assessment:r}}))}catch{}}catch(nt){Fe(Ye),en(st),alert((nt==null?void 0:nt.message)||"Publish failed")}finally{re(!1)}}async function Ft(Ye){if(e){Ye&&ne(!0),he(null);try{const st=await wa(r,String(e),t),at=(st==null?void 0:st.data)??null;at&&typeof at=="object"&&Q(at)}catch(st){Ye&&he((st==null?void 0:st.message)||"Failed to load published marks")}finally{Ye&&ne(!1)}}}v.useEffect(()=>{if(e){if(!(ft!=null&&ft.exists)||!(ft!=null&&ft.is_published)){Q(null);return}Ft(!1)}},[e,r,ft==null?void 0:ft.exists,ft==null?void 0:ft.is_published]);const Qt=Jr.useRef(!!dt);v.useEffect(()=>{if(!e||!Xr)return;if(Qt.current||!dt){Qt.current=!!dt;return}let st=!0;return(async()=>{try{const at=await En(r,String(e),t),nt=(at==null?void 0:at.data)??null;if(!st)return;if(nt&&typeof nt=="object"&&nt.sheet){er(nt);return}}catch{}st&&te&&te.sheet&&er(te)})(),Qt.current=!!dt,()=>{st=!1}},[dt,Xr,e,r,te]),v.useEffect(()=>{if(!e||!Xr||dt)return;const Ye=window.setInterval(()=>{gr({silent:!0});try{_r==null||_r({silent:!0})}catch{}},3e4);return()=>window.clearInterval(Ye)},[dt,Xr,e,gr,_r]),v.useEffect(()=>{en(null)},[e]);async function At(){if(!e)return;M(!0);const Ye=new Date,st=$r!=null&&$r.approval_until?String($r.approval_until):null;try{const at=await Yi({assessment:r,subject_code:String(e),scope:"MARK_ENTRY",reason:E||`Edit request: ${s} marks for ${String(e)}`,teaching_assignment_id:t});alert("Edit request sent to IQAC. Waiting for approval..."),q(!1);const nt=Number(at==null?void 0:at.id),xt=Ye.getTime()-2e3;(async()=>{for(let dr=0;dr<36;dr++){try{const ir=await lp({assessment:r,subject_code:String(e),scope:"MARK_ENTRY",teaching_assignment_id:t}),Br=ir==null?void 0:ir.result;if(!Br)throw new Error("No status");if(Number.isFinite(nt)&&nt>0&&Number(Br.id)!==nt)throw new Error("Different request");const kr=Br.reviewed_at?new Date(String(Br.reviewed_at)).getTime():0,Ur=String(Br.status||"").toUpperCase();if(Ur==="APPROVED"&&kr>=xt){try{gr({silent:!0}),_r==null||_r({silent:!0})}catch{}alert("IQAC approved the edit request. You can now edit marks.");return}if(Ur==="REJECTED"&&kr>=xt){alert("IQAC rejected the edit request.");return}}catch{try{const ir=await ip(r,String(e),"MARK_ENTRY",t),Br=ir!=null&&ir.approval_until?String(ir.approval_until):null;if(ir!=null&&ir.allowed_by_approval&&Br&&Br!==st){try{gr({silent:!0}),_r==null||_r({silent:!0})}catch{}alert("IQAC approved the edit request. You can now edit marks.");return}}catch{}}await new Promise(ir=>setTimeout(ir,5e3))}alert("Edit request still pending. Please try again later.")})()}catch(at){alert((at==null?void 0:at.message)||"Request failed")}finally{M(!1)}}v.useEffect(()=>{me&&e&&(Q(null),Ft(!0))},[me,e,r]);const bt=v.useMemo(()=>{if(Et===0)return[];const Ye=new Set;for(const st of et)for(let at=0;at<st.expCount;at++){const nt=st.btl[at];(nt===1||nt===2||nt===3||nt===4||nt===5||nt===6)&&Ye.add(nt)}return[1,2,3,4,5,6].filter(st=>Ye.has(st))},[et,Et]),V=3+(we?1:0)+wt+1+(Se?1:0)+zt+bt.length*2,ie={border:"1px solid #111",padding:"4px 4px",background:"#ecfdf5",color:"#065f46",textAlign:"center",fontWeight:700,fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},_e={border:"1px solid #111",padding:"4px 4px",fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},Je={width:"100%",border:"none",outline:"none",background:"transparent",fontSize:11,textAlign:"center"},Nt={border:"1px solid #e5e7eb",borderRadius:12,background:"#fff",padding:12},Bt=40,jt=90,cr=180,sr=56,Fr=52,Nr=72,Pt=80,Ot=v.useMemo(()=>[...Array.from({length:wt},()=>Pt),Fr,...Se?[Nr]:[],...Array.from({length:zt+bt.length*2},()=>Pt)],[wt,Se,zt,bt.length]),Tr=v.useMemo(()=>{const Ye=Bt+jt+cr+(we?sr:0),st=Ot.reduce((at,nt)=>at+nt,0);return Math.max(900,Ye+st)},[we,Ot]),vr=v.useMemo(()=>{const Ye=Bt+jt+cr,st=Ot.reduce((at,nt)=>at+nt,0);return Math.max(900,Ye+st)},[Ot]),ye=(Ye,st)=>({position:"sticky",left:Ye,zIndex:40,...st!=null?{width:st,minWidth:st,maxWidth:st}:null,background:ie.background}),lt=(Ye,st)=>({position:"sticky",left:Ye,zIndex:25,...st!=null?{width:st,minWidth:st,maxWidth:st}:null,background:"#fff"});function ht(Ye,st,at){const nt=3+(st?1:0),xt=Math.max(0,Ye-nt);return n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:Bt}}),n.jsx("col",{style:{width:jt}}),n.jsx("col",{style:{width:cr}}),st?n.jsx("col",{style:{width:sr}}):null,Array.from({length:xt}).map((rr,vt)=>{const dr=(at==null?void 0:at[vt])??Pt;return n.jsx("col",{style:{width:dr,minWidth:dr,maxWidth:dr}},`rest_${vt}`)})]})}const Vt={display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:8},Wr={width:20,height:20,transform:"scale(1.5)",accentColor:"#9a3412"},Yr=We?"markManagerGlitch 2s ease-in-out":void 0,fn={position:"absolute",left:"50%",top:6,transform:"translateX(-50%)",zIndex:40,width:160,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:10,borderRadius:12,display:"flex",flexDirection:"column",gap:8,alignItems:"center",boxShadow:"0 6px 18px rgba(17,24,39,0.06)",filter:"none"},In=async()=>{var at;if(!e)return;const Ye=Object.entries(((at=Ue.sheet)==null?void 0:at.coConfigs)||{}).filter(([,nt])=>!!(nt!=null&&nt.enabled)).map(([nt])=>String(nt)),st=y.map((nt,xt)=>{var Or,Lr,cn;const rr=(Or=Ue.sheet.rowsByStudentId)==null?void 0:Or[String(nt.id)],vt=rr==null?void 0:rr.marksByCo,dr=[];for(const nr of Ye){const ar=(cn=(Lr=Ue.sheet)==null?void 0:Lr.coConfigs)==null?void 0:cn[nr],j=Ir(Number((ar==null?void 0:ar.expCount)??0),0,12),ae=vt&&typeof vt=="object"?vt[String(nr)]:void 0,Ne=Number(nr)===ue?rr==null?void 0:rr.marksA:Number(nr)===Number(Ae)?rr==null?void 0:rr.marksB:void 0,Xe=ra(ae??Ne,j);for(const ut of Xe)typeof ut=="number"&&Number.isFinite(ut)&&dr.push(ut)}const ir=lh(dr),Br=Se&&typeof(rr==null?void 0:rr.ciaExam)=="number"&&Number.isFinite(rr.ciaExam)?Number(rr.ciaExam):null,kr=ir!=null||Se&&Br!=null,zr=!!(we&&(rr!=null&&rr.absent)&&!kr)?"ABSENT":ir==null&&Br==null?"":tK((ir??0)+(Br??0));return{sno:xt+1,regNo:String(nt.reg_no||""),name:String(nt.name||""),total:zr}});await Qp({filenameBase:`${String(e)}_${s}`,meta:{courseName:(L==null?void 0:L.courseName)||"",courseCode:(L==null?void 0:L.courseCode)||String(e),className:(L==null?void 0:L.className)||""},rows:st})};return n.jsxs("div",{children:[n.jsx("style",{children:`
        @keyframes markManagerGlitch {
          0% { background: #fff7ed; transform: translateX(0); }
          10% { background: #f3f4f6; transform: translateX(-2px); }
          20% { background: #fff7ed; transform: translateX(2px); }
          30% { background: #f3f4f6; transform: translateX(-1px); }
          40% { background: #fff7ed; transform: translateX(1px); }
          50% { background: #f3f4f6; transform: translateX(0); }
          60% { background: #fff7ed; transform: translateX(-1px); }
          70% { background: #f3f4f6; transform: translateX(1px); }
          80% { background: #fff7ed; transform: translateX(0); }
          90% { background: #f3f4f6; transform: translateX(-1px); }
          100% { background: #f3f4f6; transform: translateX(0); }
        }
        @keyframes markManagerDust {
          0% { opacity: 1; transform: scale(1) rotate(0deg); }
          50% { opacity: 0.8; transform: scale(1.1) rotate(180deg); }
          100% { opacity: 0; transform: scale(0.5) rotate(360deg); }
        }
        .markManagerDustParticle {
          position: absolute;
          width: 4px;
          height: 4px;
          background: #d1d5db;
          border-radius: 50%;
          animation: markManagerDust 2s ease-out forwards;
        }
      `}),n.jsxs("div",{style:{marginBottom:10},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:6},children:"COs enabled"}),n.jsxs("div",{style:{...Vt,border:"1px solid #fcd34d",background:se?"#f3f4f6":"#fff7ed",padding:12,borderRadius:12,alignItems:"stretch",animation:Yr,position:"relative",overflow:"hidden"},children:[We&&n.jsx(n.Fragment,{children:Array.from({length:20},(Ye,st)=>n.jsx("div",{className:"markManagerDustParticle",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDelay:`${Math.random()*1}s`}},st))}),n.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx(f1,{size:18,color:se?"#6b7280":"#9a3412"}),n.jsx("div",{style:{fontWeight:950,color:"#111827"},children:"Mark Manager"})]}),n.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:n.jsx("button",{onClick:()=>{if(se){D({mode:"request"});return}const Ye=Xt(Ue.sheet.markManagerSnapshot??null);if(Ye){const st=_t(Ye),at=_t(xe),nt=st.filter(xt=>!at.includes(xt));if(nt.length){const xt=Ir(Number(a??1),1,5),rr=i==null?null:Ir(Number(i),1,5),vt=Rt(Ue.sheet.rowsByStudentId,nt,xt,rr);rt({visible:!0,removed:nt,affected:vt});return}}D({mode:"confirm"})},className:"obe-btn obe-btn-success",disabled:!e||Y,style:Y?{opacity:.6,cursor:"not-allowed"}:void 0,children:se?"Edit":"Save"})})]}),n.jsxs("div",{style:{width:"100%",display:"flex",gap:10,flexWrap:"wrap",marginTop:8},children:[ct.map(Ye=>{const st=xe[String(Ye)],at=!!(st!=null&&st.enabled);return n.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontWeight:800,fontSize:12,color:"#111827"},children:[n.jsx("input",{type:"checkbox",checked:at,disabled:se,onChange:nt=>Ke(Ye,nt.target.checked),style:Wr}),"CO-",Ye]},Ye)}),n.jsx("label",{style:{display:"flex",gap:6,alignItems:"center",fontWeight:800,fontSize:12,color:"#111827"},children:be?n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"checkbox",checked:Se,disabled:se,onChange:Ye=>Cr(Ye.target.checked),style:Wr}),"CIA Exam"]}):null})]}),n.jsx("div",{style:{width:"100%",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:10,marginTop:8},children:ct.map(Ye=>{const st=xe[String(Ye)];if(!!!(st!=null&&st.enabled))return null;const nt=Ir(Number((st==null?void 0:st.expCount)??ts),0,12),xt=Ir(Number((st==null?void 0:st.expMax)??gs),0,100);return n.jsxs("div",{style:{width:"100%",minWidth:0,display:"flex",flexDirection:"column",gap:6,padding:"10px 10px",border:"1px solid #e5e7eb",borderRadius:12,background:"#fff"},children:[n.jsxs("div",{style:{fontSize:12,fontWeight:950},children:["CO-",Ye]}),n.jsxs("div",{style:{fontSize:11,color:"#6b7280"},children:["No. of ",Ie.toLowerCase()]}),n.jsx("input",{type:"number",className:"obe-input",value:nt,onChange:rr=>tr(Ye,Number(rr.target.value)),min:0,max:12,disabled:se}),n.jsx("div",{style:{fontSize:11,color:"#6b7280"},children:"Max marks"}),n.jsx("input",{type:"number",className:"obe-input",value:xt,onChange:rr=>Kt(Ye,Number(rr.target.value)),min:0,max:100,disabled:se})]},`cfg_${Ye}`)})})]}),$e?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#991b1b"},children:$e}):null]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center",marginBottom:12},children:[n.jsx("button",{onClick:lr,className:"obe-btn obe-btn-success",disabled:O||!e||Ze,style:Ze?{opacity:.6,cursor:"not-allowed"}:void 0,title:Ze?"Table locked  confirm Mark Manager to enable actions":void 0,children:O?"Saving":"Save Draft"}),n.jsx("button",{onClick:In,className:"obe-btn obe-btn-secondary",disabled:!e||y.length===0,children:"Download"}),n.jsx("button",{onClick:Mt,className:"obe-btn obe-btn-danger",disabled:!e||Ze,style:Ze?{opacity:.6,cursor:"not-allowed"}:void 0,title:Ze?"Table locked  confirm Mark Manager to enable actions":void 0,children:"Reset"}),n.jsx("button",{onClick:tt,className:"obe-btn obe-btn-primary",disabled:!e||K||Ze||$t,style:Ze?{opacity:.6,cursor:"not-allowed"}:void 0,title:Ze?"Table locked  confirm Mark Manager to enable actions":mt?$t?"Publishing locked":"Publish":"Publish window closed",children:K?"Publishing":"Publish"})]}),w?n.jsx("div",{style:{color:"#6b7280",marginBottom:8},children:"Loading roster"}):null,k?n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10,maxWidth:"100%",whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:k}):null,n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",marginBottom:12},children:[n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"8px 12px",background:"#fff"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Term"}),n.jsx("div",{style:{fontWeight:700},children:Ue.sheet.termLabel||""})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"8px 12px",background:"#fff"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Batch"}),n.jsx("div",{style:{fontWeight:700},children:Ue.sheet.batchLabel||""})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"8px 12px",background:"#fff"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Saved"}),n.jsx("div",{style:{fontWeight:700},children:W||""}),N?n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["by ",n.jsx("span",{style:{color:"#0369a1",fontWeight:700},children:N})]}):null]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"8px 12px",background:"#fff"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Published"}),n.jsx("div",{style:{fontWeight:700},children:ge||""})]})]}),n.jsx("div",{style:Nt,children:n.jsx(k0,{locked:$t,children:n.jsxs("div",{className:"obe-table-wrapper",style:{overflowX:"auto",position:"relative",filter:Ze?"grayscale(5%)":void 0,opacity:Ze?.78:1},children:[n.jsxs("table",{className:"obe-table",style:{width:"100%",minWidth:Tr,tableLayout:"fixed",borderCollapse:"collapse"},children:[ht(V,we,Ot),n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsx("th",{style:ie,colSpan:V,children:s})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...ie,...ye(0,Bt)},rowSpan:5,children:"S.No"}),n.jsx("th",{style:{...ie,...ye(Bt,jt)},rowSpan:5,children:"R.No"}),n.jsx("th",{style:{...ie,...ye(Bt+jt,cr),textAlign:"left"},rowSpan:5,children:"Name of the Students"}),we?n.jsx("th",{style:{...ie,...ye(Bt+jt+cr,sr)},rowSpan:5,children:"AB"}):null,n.jsx("th",{style:ie,colSpan:wt,children:Ie}),n.jsx("th",{style:{...ie,width:Fr,minWidth:Fr,maxWidth:Fr},rowSpan:5,children:"AVG"}),Se?n.jsx("th",{style:{...ie,width:Nr,minWidth:Nr,maxWidth:Nr,whiteSpace:"pre-line",overflow:"visible",textOverflow:"clip",lineHeight:1.05},rowSpan:5,title:"CIA Exam",children:`CIA
EXAM`}):null,n.jsx("th",{style:ie,colSpan:zt,children:"CO ATTAINMENT"}),bt.length?n.jsx("th",{style:ie,colSpan:bt.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[Et===0?n.jsx("th",{style:ie,children:""}):n.jsx(n.Fragment,{children:et.map(Ye=>Array.from({length:Ye.expCount},(st,at)=>n.jsx("th",{style:ie,children:Ye.coNumber},`co_${Ye.coNumber}_${at}`)))}),gt?et.map(Ye=>n.jsxs("th",{style:ie,colSpan:2,children:["CO-",Ye.coNumber]},`coatt_${Ye.coNumber}`)):n.jsx("th",{style:ie,colSpan:2,children:""}),bt.map(Ye=>n.jsxs("th",{style:ie,colSpan:2,children:["BTL-",Ye]},`btl_${Ye}`))]}),n.jsxs("tr",{children:[Et===0?n.jsx("th",{style:ie,children:""}):n.jsx(n.Fragment,{children:et.map(Ye=>Array.from({length:Ye.expCount},(st,at)=>n.jsx("th",{style:ie,children:Ye.expMax},`max_${Ye.coNumber}_${at}`)))}),gt?et.map(Ye=>{const st=nb[`co${Ye.coNumber}`],at=Array.from({length:Ir(Number(Ye.expCount??0),0,12)}).map(()=>Ir(Number(Ye.expMax??gs),0,100)),nt=at.length?at.reduce((vt,dr)=>vt+dr,0)/at.length:0,xt=ee&&Number.isFinite(Number(st))?Number(st):nt,rr=Math.round(xt+(Se?Yc/2:0)||0);return n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:ie,children:rr}),n.jsx("th",{style:ie,children:"%"})]},`comax_${Ye.coNumber}`)}):n.jsxs(n.Fragment,{children:[n.jsx("th",{style:ie,children:""}),n.jsx("th",{style:ie,children:"%"})]}),bt.map(Ye=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:ie,children:Dt||gs}),n.jsx("th",{style:ie,children:"%"})]},`btlmax_${Ye}`))]}),n.jsxs("tr",{children:[Et===0?n.jsxs("th",{style:ie,children:["No ",Ie.toLowerCase()]}):n.jsx(n.Fragment,{children:et.map(Ye=>Array.from({length:Ye.expCount},(st,at)=>n.jsxs("th",{style:ie,children:[ot,at+1]},`e_${Ye.coNumber}_${at}`)))}),n.jsx("th",{style:ie,colSpan:zt+bt.length*2})]}),n.jsxs("tr",{children:[Et===0?n.jsx("th",{style:ie,children:"BTL"}):n.jsx(n.Fragment,{children:et.map(Ye=>Array.from({length:Ye.expCount},(st,at)=>n.jsx("th",{style:ie,children:(()=>{var vt;const nt=((vt=Ye.btl)==null?void 0:vt[at])??1,xt=nt===""?"-":String(nt),rr=!x&&!Ze&&!He&&!$t;return n.jsxs("div",{style:{position:"relative",display:"grid",placeItems:"center",minWidth:44},title:`BTL: ${xt}`,children:[n.jsx("div",{style:{width:"100%",padding:"4px 6px",background:"#fff",textAlign:"center",userSelect:"none",fontWeight:800,cursor:rr?"pointer":"default"},children:xt}),rr?n.jsxs("select",{"aria-label":`BTL for ${ze} ${at+1} (CO-${Ye.coNumber})`,value:nt,onChange:dr=>{const ir=dr.target.value,Br=ir===""?"":Number(ir);yt(Ye.coNumber,at,Br)},style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none"},children:[n.jsx("option",{value:"",children:"-"}),[1,2,3,4,5,6].map(dr=>n.jsx("option",{value:dr,children:dr},dr))]}):null]})})()},`btl_${Ye.coNumber}_${at}`)))}),n.jsx("th",{style:ie,colSpan:zt+bt.length*2})]})]}),n.jsxs("tbody",{children:[(!Ze&&!He?y:[]).map((Ye,st)=>{var zr,Or;const at=(zr=Ue.sheet.rowsByStudentId)==null?void 0:zr[String(Ye.id)],nt=at==null?void 0:at.ciaExam,xt=Se&&typeof nt=="number"&&Number.isFinite(nt)?nt:null,rr=at==null?void 0:at.marksByCo,vt=et.map(Lr=>{const cn=rr&&typeof rr=="object"?rr[String(Lr.coNumber)]:void 0,nr=Lr.coNumber===ue?at==null?void 0:at.marksA:Lr.coNumber===Le?at==null?void 0:at.marksB:void 0,ar=ra(cn??nr,Lr.expCount);return{coNumber:Lr.coNumber,marks:ar}}),dr=vt.flatMap(Lr=>Lr.marks),ir=lh(dr),Br=ir!=null||Se&&xt!=null,kr=gt?et.map(Lr=>{var Jt;const cn=((Jt=vt.find(ur=>ur.coNumber===Lr.coNumber))==null?void 0:Jt.marks)??[],nr=lh(cn),ar=Br?(nr??0)+(Se?(xt??0)/2:0):null,j=nb[`co${Lr.coNumber}`],ae=Array.from({length:Ir(Number(Lr.expCount??0),0,12)}).map(()=>Ir(Number(Lr.expMax??gs),0,100)),Ne=ae.length?ae.reduce((ur,Kr)=>ur+Kr,0)/ae.length:0,Xe=ee&&Number.isFinite(Number(j))?Number(j):Ne,ut=Math.round(Xe+(Se?Yc/2:0)||0);return{coNumber:Lr.coNumber,mark:ar,coMax:ut}}):[],Ur={};for(const Lr of bt){const cn=[];for(const nr of et){const ar=((Or=vt.find(j=>j.coNumber===nr.coNumber))==null?void 0:Or.marks)??[];for(let j=0;j<Math.min(nr.expCount,ar.length);j++)if(nr.btl[j]===Lr){const ae=ar[j];typeof ae=="number"&&Number.isFinite(ae)&&cn.push(ae)}}Ur[Lr]=cn.length?cn.reduce((nr,ar)=>nr+ar,0)/cn.length:null}return n.jsxs("tr",{style:Ze&&st<3?{position:"relative",zIndex:35,background:"#fff"}:void 0,children:[n.jsx("td",{style:{..._e,...lt(0,Bt),textAlign:"center"},children:st+1}),n.jsx("td",{style:{..._e,...lt(Bt,jt),textAlign:"center"},title:String(Ye.reg_no||""),children:Kj(Ye.reg_no,7)}),n.jsx("td",{style:{..._e,...lt(Bt+jt,cr)},title:String(Ye.name||""),children:n.jsx("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:String(Ye.name||"")})}),we?n.jsx("td",{style:{..._e,...lt(Bt+jt+cr,sr),textAlign:"center"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[n.jsx("input",{type:"checkbox",checked:!!(at!=null&&at.absent),onChange:Lr=>Rr(Ye.id,Lr.target.checked),disabled:Ze}),at!=null&&at.absent?n.jsxs("div",{className:"obe-ios-select",title:"Absent type",children:[n.jsx("span",{className:"obe-ios-select-value",children:String(at.absentKind||"AL")}),n.jsxs("select",{"aria-label":"Absent type",value:at.absentKind||"AL",onChange:Lr=>De(Ye.id,Lr.target.value),disabled:Ze,children:[n.jsx("option",{value:"AL",children:"AL"}),n.jsx("option",{value:"ML",children:"ML"}),n.jsx("option",{value:"SKL",children:"SKL"})]})]}):null]})}):null,Et===0?n.jsx("td",{style:{..._e,textAlign:"center",color:"#6b7280"},children:""}):et.map(Lr=>{var nr;const cn=((nr=vt.find(ar=>ar.coNumber===Lr.coNumber))==null?void 0:nr.marks)??[];return Array.from({length:Lr.expCount},(ar,j)=>n.jsx("td",{style:{..._e,width:38,minWidth:0,padding:"2px 2px",background:"#fff7ed"},children:n.jsx("input",{type:"number",value:cn[j]??"",onChange:ae=>{const Ne=ae.target.value;if(Ne==="")return ae.currentTarget.setCustomValidity(""),Ht(Ye.id,Lr.coNumber,j,"");const Xe=Number(Ne);if(Number.isFinite(Xe)){if(Xe>Lr.expMax){ae.currentTarget.setCustomValidity(`Max mark is ${Lr.expMax}`),ae.currentTarget.reportValidity(),window.setTimeout(()=>ae.currentTarget.setCustomValidity(""),0);return}ae.currentTarget.setCustomValidity(""),Ht(Ye.id,Lr.coNumber,j,Xe)}},style:Je,min:0,max:Lr.expMax,disabled:Ze})},`m_${Ye.id}_${Lr.coNumber}_${j}`))}),n.jsx("td",{style:{..._e,width:Fr,minWidth:0,textAlign:"right",fontWeight:800},children:ir==null?"":ir.toFixed(1)}),Se?n.jsx("td",{style:{..._e,width:Nr,minWidth:0,padding:"2px 2px",background:"#fff7ed"},children:n.jsx("input",{type:"number",value:(at==null?void 0:at.ciaExam)??"",onChange:Lr=>{const cn=Lr.target.value;if(cn==="")return Lr.currentTarget.setCustomValidity(""),qt(Ye.id,"");const nr=Number(cn);if(Number.isFinite(nr)){if(nr>Yc){Lr.currentTarget.setCustomValidity(`Max mark is ${Yc}`),Lr.currentTarget.reportValidity(),window.setTimeout(()=>Lr.currentTarget.setCustomValidity(""),0);return}Lr.currentTarget.setCustomValidity(""),qt(Ye.id,nr)}},style:Je,min:0,max:Yc,disabled:Ze})}):null,gt?kr.map(Lr=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._e,textAlign:"right"},children:Lr.mark==null?"":Lr.mark.toFixed(1)}),n.jsx("td",{style:{..._e,textAlign:"right"},children:tx(Lr.mark,Lr.coMax)})]},`coattrow_${Ye.id}_${Lr.coNumber}`)):n.jsxs(n.Fragment,{children:[n.jsx("td",{style:{..._e,textAlign:"right"}}),n.jsx("td",{style:{..._e,textAlign:"right"}})]}),bt.map(Lr=>{const cn=Ur[Lr]??null;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._e,textAlign:"right"},children:cn==null?"":cn.toFixed(1)}),n.jsx("td",{style:{..._e,textAlign:"right"},children:tx(cn,Dt||gs)})]},`btlcell_${Ye.id}_${Lr}`)})]},Ye.id)}),y.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:V,style:{padding:10,color:"#6b7280"},children:"No students."})})]})]}),Ze&&!He&&!x?n.jsx("div",{style:{position:"absolute",inset:0,zIndex:30,pointerEvents:"auto",background:"linear-gradient(180deg, rgba(72, 113, 195, 0.92) 0%, rgba(51, 55, 64, 0.96) 100%)"}}):null,He&&!x?n.jsx("div",{style:{position:"absolute",inset:0,zIndex:30,pointerEvents:"auto",background:"linear-gradient(180deg, rgba(34,197,94,0.28) 0%, rgba(16,185,129,0.36) 100%)"}}):null,Ze&&!He&&!x&&!g?n.jsxs("div",{style:fn,children:[n.jsx("div",{style:{width:100,height:72,display:"grid",placeItems:"center",background:"#fff",borderRadius:8},children:n.jsx("img",{id:"mark-manager-float-gif",src:"https://media.lordicon.com/icons/wired/flat/94-lock-unlock.gif",alt:"gif",style:{maxWidth:72,maxHeight:72,display:"block"},onError:Ye=>{console.warn("Failed to load lock GIF:",Ye.currentTarget.src),Ye.currentTarget.onerror=null,Ye.currentTarget.src="data:image/svg+xml;utf8,"+encodeURIComponent('<svg xmlns="https://media.lordicon.com/icons/wired/flat/94-lock-unlock.gif" width="72" height="72" viewBox="0 0 24 24" fill="none" stroke="#0f172a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>')}})}),n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontWeight:800,color:"#111827"},children:"Table Locked"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Confirm the Mark Manager"})]}),n.jsx("div",{style:{display:"flex",gap:8,marginTop:4}})]}):null,He&&!x&&!g?n.jsxs("div",{style:fn,children:[n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontWeight:950,color:"#065f46"},children:"Published  Locked"}),n.jsx("div",{style:{fontSize:13,color:"#065f46"},children:"Table is locked. Request IQAC approval to edit."})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[n.jsx("button",{type:"button",className:"obe-btn",onClick:()=>fe(!0),children:"View"}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-success",onClick:()=>{q(!0)},children:"Request Edit"})]}),n.jsx("div",{style:{width:170,height:92,display:"grid",placeItems:"center",background:"#fff",borderRadius:10,border:"1px solid rgba(2,6,23,0.08)"},children:n.jsx("img",{id:"published-lock-image",src:new URL("/assets/lockong-CpAqbAhU.png",import.meta.url).toString(),alt:"locked",style:{maxWidth:150,maxHeight:80,display:"block"},onError:Ye=>{Ye.currentTarget.onerror=null,Ye.currentTarget.src="https://media.lordicon.com/icons/wired/flat/1103-check-mark.gif"}})})]}):null]})})}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280",display:"flex",gap:18,flexWrap:"wrap"},children:[W?n.jsxs("div",{children:["Draft saved: ",W,N?n.jsxs("span",{style:{marginLeft:8,color:"#374151"},children:["by ",n.jsx("strong",{children:N})]}):null]}):null,ge?n.jsxs("div",{children:["Last published: ",ge]}):null]}),oe?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:50},onClick:()=>{Y||D(null)},children:n.jsxs("div",{style:{width:"min(760px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:Ye=>Ye.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:oe.mode==="confirm"?`Confirmation - ${s}`:`Request Edit - ${s}`}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:r.toUpperCase()})]}),oe.mode==="confirm"?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"Confirm the selected COs and their settings. After confirming, the Mark Manager box will be locked."}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f9fafb"},children:[n.jsx("th",{style:{textAlign:"left",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"CO"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:Ie}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Max marks"})]})}),n.jsxs("tbody",{children:[Object.entries(xe).filter(([Ye,st])=>ce.has(String(Ye))&&!!(st!=null&&st.enabled)).map(([Ye,st])=>({co:Ir(Number(Ye),1,5),expCount:Ir(Number((st==null?void 0:st.expCount)??0),0,12),expMax:Ir(Number((st==null?void 0:st.expMax)??0),0,100)})).sort((Ye,st)=>Ye.co-st.co).map(Ye=>n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:["CO-",Ye.co]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:Ye.expCount}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:Ye.expMax})]},Ye.co)),Object.entries(xe).filter(([Ye,st])=>ce.has(String(Ye))&&!!(st!=null&&st.enabled)).length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:3,style:{padding:10,color:"#6b7280"},children:"No COs selected."})}):null,be?n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"CIA Exam"}),n.jsx("td",{colSpan:2,style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:Se?"Enabled":"Disabled"})]}):null]})]})})]}):n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"This will send an edit request to IQAC. The Mark Manager will remain locked until IQAC approves."}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[n.jsx("button",{className:"obe-btn",disabled:Y,onClick:()=>D(null),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:Y||!e,onClick:async()=>{if(!e)return;if(oe.mode==="request"){le(!0),je(null);try{const st=te,at=xe;if(st&&st.sheet&&st.sheet.coConfigs){const nt=jr(mr(st.sheet),at),xt=Gr(st.sheet.rowsByStudentId,[...nt.removed,...nt.changed]);if((nt.removed.length||nt.changed.length||nt.added.length)&&xt>0){Ve({visible:!0,diff:nt,affected:xt,mode:"request"}),le(!1);return}}D(null),await Ce()}finally{le(!1)}return}const Ye=Xt(Ue.sheet.markManagerSnapshot??null);if(Ye){const st=_t(Ye),at=_t(xe),nt=st.filter(xt=>!at.includes(xt));if(nt.length){const xt=Ir(Number(a??1),1,5),rr=i==null?null:Ir(Number(i),1,5),vt=Rt(Ue.sheet.rowsByStudentId,nt,xt,rr);rt({visible:!0,removed:nt,affected:vt});return}}await it("none")},children:oe.mode==="confirm"?"Confirm":"Send Request"})]})]})}):null,Re&&Re.visible?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:90},onClick:()=>{Y||Ve(null)},children:n.jsxs("div",{style:{width:"min(640px, 96vw)",background:"#fff",borderRadius:12,padding:14,border:"1px solid #e5e7eb"},onClick:Ye=>Ye.stopPropagation(),children:[n.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Mark Manager conflict with published marks"}),n.jsxs("div",{style:{color:"#374151",marginBottom:12},children:["The selected CO settings differ from the published mark sheet. ",Re.affected," student rows contain marks that may be lost."]}),n.jsxs("div",{style:{fontSize:13,color:"#374151",marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("strong",{children:"Added COs:"})," ",Re.diff.added.join(", ")||""]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Removed COs:"})," ",Re.diff.removed.join(", ")||""]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Changed COs:"})," ",Re.diff.changed.join(", ")||""]})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[n.jsx("button",{className:"obe-btn",onClick:()=>Ve(null),disabled:Y,children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-danger",disabled:Y,onClick:async()=>{if(e){le(!0);try{const Ye=Ue,st=Object.fromEntries(Object.entries(Ye.sheet.rowsByStudentId||{}).map(([nt,xt])=>{var kr;const rr=xt&&typeof xt=="object"?xt:{},vt=Ir(Number(Ye.sheet.expCountA??ts),0,12),dr=Ir(Number(Ye.sheet.expCountB??0),0,12),ir={...rr};ir.marksA=Array.from({length:vt},()=>""),ir.marksB=Array.from({length:dr},()=>""),ir.ciaExam="";const Br=ir.marksByCo&&typeof ir.marksByCo=="object"?{...ir.marksByCo}:{};for(const Ur of[...Re.diff.removed.map(String),...Re.diff.changed.map(String)])Br[Ur]&&(Br[Ur]=Array.from({length:((kr=xe[Ur])==null?void 0:kr.expCount)??0},()=>""));return ir.marksByCo=Br,[nt,ir]})),at={sheet:{...Ye.sheet,rowsByStudentId:st}};if(er(at),await Fs(r,String(e),at),A(new Date().toLocaleString()),Re.mode==="request")Ve(null),D(null),await Ce();else{try{await kd(r,String(e),t),gr({silent:!0})}catch(nt){console.warn("confirmMarkManagerLock failed after reset",nt)}Ve(null)}}catch(Ye){alert((Ye==null?void 0:Ye.message)||"Failed to reset marks")}finally{le(!1)}}},children:"Reset & Continue"})]})]})}):null,St&&St.visible?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:95},onClick:()=>{Y||rt(null)},children:n.jsxs("div",{style:{width:"min(660px, 96vw)",background:"#fff",borderRadius:12,padding:14,border:"1px solid #e5e7eb"},onClick:Ye=>Ye.stopPropagation(),children:[n.jsx("div",{style:{fontWeight:900,marginBottom:8},children:St.removed.length===1?`Shall I reset the CO${St.removed[0]} column?`:"Shall I reset the removed CO columns?"}),n.jsxs("div",{style:{color:"#374151",marginBottom:10},children:["The new Mark Manager selection removed old COs.",St.affected>0?` ${St.affected} student rows contain marks in these columns.`:" No marks were found in these columns."]}),n.jsx("div",{style:{fontSize:13,color:"#374151",marginBottom:12},children:n.jsxs("div",{children:[n.jsx("strong",{children:"Removed COs:"})," ",St.removed.join(", ")||""]})}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[n.jsx("button",{className:"obe-btn",onClick:()=>rt(null),disabled:Y,children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-primary",disabled:Y,onClick:async()=>{const Ye=St.removed;rt(null),await it("partial",Ye)},children:St.removed.length===1?`Reset CO${St.removed[0]} column`:"Reset removed CO columns"}),n.jsx("button",{className:"obe-btn obe-btn-danger",disabled:Y,onClick:async()=>{rt(null),await it("full")},children:"Reset full data"})]})]})}):null,R?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>{I||q(!1)},children:n.jsxs("div",{style:{width:"min(560px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:Ye=>Ye.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"Edit Request"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:[String(r).toUpperCase()," LAB"]})]}),n.jsxs("div",{style:{fontSize:13,color:"#374151",marginBottom:10,lineHeight:1.35},children:[n.jsxs("div",{children:[n.jsx("strong",{children:"Subject:"})," ",s]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Code:"})," ",String(e||"")]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Published:"})," ",ge||""]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Saved:"})," ",W||""]})]}),n.jsx("textarea",{value:E,onChange:Ye=>U(Ye.target.value),placeholder:"Reason (optional)",rows:4,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical"}}),n.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:12},children:[n.jsx("button",{type:"button",className:"obe-btn",disabled:I,onClick:()=>q(!1),children:"Cancel"}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-success",disabled:I||!e,onClick:At,children:I?"Requesting":"Send Request"})]})]})}):null,me?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:70},onClick:()=>fe(!1),children:n.jsxs("div",{style:{width:"min(1100px, 96vw)",maxHeight:"min(80vh, 900px)",overflow:"auto",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:Ye=>Ye.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10,position:"relative"},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"View Only"}),n.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280",marginRight:36},children:[s,"  ",String(e||"")]}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-success",onClick:()=>fe(!1),style:{position:"absolute",right:0,top:0},children:"Close"})]}),G?n.jsx("div",{style:{color:"#6b7280",marginBottom:8},children:"Loading published marks"}):null,z?n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10,maxWidth:"100%",whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:z}):null,n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12,position:"relative"},children:(()=>{const Ye=3+wt+1+(Se?1:0)+zt+bt.length*2;return n.jsxs("table",{className:"obe-table",style:{width:"100%",minWidth:vr,tableLayout:"fixed",borderCollapse:"collapse"},children:[ht(Ye,!1,Ot),n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsx("th",{style:ie,colSpan:Ye,children:s})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...ie,...ye(0,Bt)},rowSpan:5,children:"S.No"}),n.jsx("th",{style:{...ie,...ye(Bt,jt)},rowSpan:5,children:"R.No"}),n.jsx("th",{style:{...ie,...ye(Bt+jt,cr),textAlign:"left"},rowSpan:5,children:"Name of the Students"}),n.jsx("th",{style:ie,colSpan:wt,children:"Experiments"}),n.jsx("th",{style:{...ie,width:Fr,minWidth:Fr,maxWidth:Fr},rowSpan:5,children:"AVG"}),Se?n.jsx("th",{style:{...ie,width:Nr,minWidth:Nr,maxWidth:Nr,whiteSpace:"pre-line",overflow:"visible",textOverflow:"clip",lineHeight:1.05},rowSpan:5,title:"CIA Exam",children:`CIA
EXAM`}):null,n.jsx("th",{style:ie,colSpan:zt,children:"CO ATTAINMENT"}),bt.length?n.jsx("th",{style:ie,colSpan:bt.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[Et===0?n.jsx("th",{style:ie,children:""}):n.jsx(n.Fragment,{children:et.map(st=>Array.from({length:st.expCount},(at,nt)=>n.jsx("th",{style:ie,children:st.coNumber},`co_view_${st.coNumber}_${nt}`)))}),gt?et.map(st=>n.jsxs("th",{style:ie,colSpan:2,children:["CO-",st.coNumber]},`coatt_view_${st.coNumber}`)):n.jsx("th",{style:ie,colSpan:2,children:""}),bt.map(st=>n.jsxs("th",{style:ie,colSpan:2,children:["BTL-",st]},`btl_view_${st}`))]}),n.jsxs("tr",{children:[Et===0?n.jsx("th",{style:ie,children:""}):n.jsx(n.Fragment,{children:et.map(st=>Array.from({length:st.expCount},(at,nt)=>n.jsx("th",{style:ie,children:st.expMax},`max_view_${st.coNumber}_${nt}`)))}),gt?et.map(st=>{const at=st.expMax+(Se?Yc/2:0);return n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:ie,children:at}),n.jsx("th",{style:ie,children:"%"})]},`comax_view_${st.coNumber}`)}):n.jsxs(n.Fragment,{children:[n.jsx("th",{style:ie,children:""}),n.jsx("th",{style:ie,children:"%"})]}),bt.map(st=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:ie,children:Dt||gs}),n.jsx("th",{style:ie,children:"%"})]},`btlmax_view_${st}`))]}),n.jsxs("tr",{children:[Et===0?n.jsx("th",{style:ie,children:"No experiments"}):n.jsx(n.Fragment,{children:et.map(st=>Array.from({length:st.expCount},(at,nt)=>n.jsxs("th",{style:ie,children:["E",nt+1]},`e_view_${st.coNumber}_${nt}`)))}),n.jsx("th",{style:ie,colSpan:zt+bt.length*2})]}),n.jsxs("tr",{children:[Et===0?n.jsx("th",{style:ie,children:"BTL"}):n.jsx(n.Fragment,{children:et.map(st=>Array.from({length:st.expCount},(at,nt)=>n.jsx("th",{style:ie,children:st.btl[nt]||1},`btlhdr_view_${st.coNumber}_${nt}`)))}),n.jsx("th",{style:ie,colSpan:zt+bt.length*2})]})]}),n.jsxs("tbody",{children:[y.map((st,at)=>{var Lr,cn;const nt=te&&te.sheet?te.sheet:Ue.sheet,xt=(Lr=nt==null?void 0:nt.rowsByStudentId)==null?void 0:Lr[String(st.id)],rr=xt==null?void 0:xt.ciaExam,vt=Se&&typeof rr=="number"&&Number.isFinite(rr)?rr:null,dr=xt==null?void 0:xt.marksByCo,ir=et.map(nr=>{const ar=dr&&typeof dr=="object"?dr[String(nr.coNumber)]:void 0,j=nr.coNumber===ue?xt==null?void 0:xt.marksA:nr.coNumber===Le?xt==null?void 0:xt.marksB:void 0,ae=ra(ar??j,nr.expCount);return{coNumber:nr.coNumber,marks:ae}}),Br=ir.flatMap(nr=>nr.marks),kr=lh(Br),Ur=kr!=null||Se&&vt!=null,zr=gt?et.map(nr=>{var Jt;const ar=((Jt=ir.find(ur=>ur.coNumber===nr.coNumber))==null?void 0:Jt.marks)??[],j=lh(ar),ae=Ur?(j??0)+(Se?(vt??0)/2:0):null,Ne=nb[`co${nr.coNumber}`],ut=(ee&&Number.isFinite(Number(Ne))?Number(Ne):nr.expMax)+(Se?Yc/2:0);return{coNumber:nr.coNumber,mark:ae,coMax:ut}}):[],Or={};for(const nr of bt){const ar=[];for(const j of et){const ae=((cn=ir.find(Ne=>Ne.coNumber===j.coNumber))==null?void 0:cn.marks)??[];for(let Ne=0;Ne<Math.min(j.expCount,ae.length);Ne++)if(j.btl[Ne]===nr){const Xe=ae[Ne];typeof Xe=="number"&&Number.isFinite(Xe)&&ar.push(Xe)}}Or[nr]=ar.length?ar.reduce((j,ae)=>j+ae,0)/ar.length:null}return n.jsxs("tr",{children:[n.jsx("td",{style:{..._e,...lt(0,Bt),textAlign:"center"},children:at+1}),n.jsx("td",{style:{..._e,...lt(Bt,jt)},title:String(st.reg_no||""),children:Kj(st.reg_no,7)}),n.jsx("td",{style:{..._e,...lt(Bt+jt,cr)},title:String(st.name||""),children:n.jsx("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:String(st.name||"")})}),Et===0?n.jsx("td",{style:{..._e,textAlign:"center",color:"#6b7280"},children:""}):et.map(nr=>{var j;const ar=((j=ir.find(ae=>ae.coNumber===nr.coNumber))==null?void 0:j.marks)??[];return Array.from({length:nr.expCount},(ae,Ne)=>n.jsx("td",{style:{..._e,width:38,minWidth:0,padding:"2px 2px",background:"#fff7ed",textAlign:"center",fontWeight:800},children:ar[Ne]??""},`view_m_${st.id}_${nr.coNumber}_${Ne}`))}),n.jsx("td",{style:{..._e,width:Fr,minWidth:0,textAlign:"right",fontWeight:800},children:kr==null?"":kr.toFixed(1)}),Se?n.jsx("td",{style:{..._e,width:Nr,minWidth:0,padding:"2px 2px",background:"#fff7ed",textAlign:"center",fontWeight:800},children:(xt==null?void 0:xt.ciaExam)??""}):null,gt?zr.map(nr=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._e,textAlign:"right"},children:nr.mark==null?"":nr.mark.toFixed(1)}),n.jsx("td",{style:{..._e,textAlign:"right"},children:tx(nr.mark,nr.coMax)})]},`view_coatt_${st.id}_${nr.coNumber}`)):n.jsxs(n.Fragment,{children:[n.jsx("td",{style:{..._e,textAlign:"right"}}),n.jsx("td",{style:{..._e,textAlign:"right"}})]}),bt.map(nr=>{const ar=Or[nr]??null;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{..._e,textAlign:"right"},children:ar==null?"":ar.toFixed(1)}),n.jsx("td",{style:{..._e,textAlign:"right"},children:tx(ar,Dt||gs)})]},`view_btl_${st.id}_${nr}`)})]},`view_${st.id}`)}),y.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:V,style:{padding:10,color:"#6b7280"},children:"No students."})}):null]})]})})()}),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:n.jsx("button",{type:"button",className:"obe-btn",onClick:()=>fe(!1),children:"Close"})})]})}):null]})}const sK=[{key:"q1",label:"Q1",max:2},{key:"q2",label:"Q2",max:2},{key:"q3",label:"Q3",max:2},{key:"q4",label:"Q4",max:2},{key:"q5",label:"Q5",max:2},{key:"q6",label:"Q6",max:2},{key:"q7",label:"Q7",max:16},{key:"q8",label:"Q8",max:16},{key:"q9",label:"Q9",max:16}];function aK({subjectId:e,classType:t,teachingAssignmentId:r,questionPaperType:s}){const a=v.useMemo(()=>[1,2,3,4,5,6],[]),i=ye=>{const lt=String(ye??"AL").trim().toUpperCase();return lt==="ML"||lt==="MALPRACTICE"?"ML":lt==="SKL"||lt==="SICK"||lt==="SICKLEAVE"||lt==="SL"?"SKL":"AL"},o={border:"1px solid #111",padding:"4px 4px",background:"#ecfdf5",color:"#065f46",textAlign:"center",fontWeight:700,fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},l={border:"1px solid #111",padding:"4px 4px",fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},c=32,[d,u]=v.useState([]),[h,p]=v.useState(!1),[f,x]=v.useState(null),[g,y]=v.useState(null),[m,w]=v.useState(!1),[S,k]=v.useState(!1),[F,L]=v.useState(!1),[C,O]=v.useState(null),[T,W]=v.useState(null),[A,N]=v.useState(null),[P,K]=v.useState(null),[re,ge]=v.useState(!1),[Fe,R]=v.useState(null),q=v.useRef(!1),[me,fe]=v.useState(!1),E=v.useRef(!1),[U,I]=v.useState(!1),[M,te]=v.useState(null),[Q,G]=v.useState(null),[ne,z]=v.useState({}),[he,X]=v.useState({}),[H,oe]=v.useState(null),[D,Y]=v.useState(""),[le,$e]=v.useState(!1),[je,We]=v.useState(null),[Ee,Re]=v.useState(!1),[Ve,St]=v.useState(""),[rt,ze]=v.useState(!1),[Ie,ot]=v.useState(!1),be=v.useMemo(()=>On(t),[t]),we=be==="THEORY",Me=be==="TCPL"||be==="TCPR",Wt=be==="TCPR"?"TCPR":"TCPL",{data:Ct,loading:pr,error:fr,remainingSeconds:Be,publishAllowed:mt,refresh:It}=Ru({assessment:"model",subjectCode:e,teachingAssignmentId:r}),{data:ft,refresh:gr}=Bu({assessment:"model",subjectCode:String(e||""),teachingAssignmentId:r,options:{poll:!1}}),{data:Mr,refresh:$r}=Xo({assessment:"model",subjectCode:String(e||""),scope:"MARK_ENTRY",teachingAssignmentId:r,options:{poll:!1}}),_r=!!A||!!(ft!=null&&ft.exists&&(ft!=null&&ft.is_published))||!!P,Vr=_r?!!(ft!=null&&ft.entry_open)||!!(Mr!=null&&Mr.allowed_by_approval):!0,en=!!(_r&&!Vr),Xr=!!(Ct!=null&&Ct.global_override_active&&(Ct==null?void 0:Ct.global_is_open)===!1);v.useEffect(()=>{ot(!1)},[e,r,en]);const gn=v.useMemo(()=>`model_qp_type_${e}_${String(r??"none")}`,[e,r]),[Oe,qe]=v.useState("");v.useEffect(()=>{const ye=Wr=>{const Yr=String(Wr??"").trim().toUpperCase();return Yr==="QP2"?"QP2":Yr==="QP1"?"QP1":""},lt=ye(s);if(lt){qe(lt);try{yn(gn,lt)}catch{}return}const ht=Bn(gn),Vt=ye(ht);qe(Vt||"QP1")},[gn,s]);const Lt=String(Oe??"").trim().toUpperCase();v.useEffect(()=>{let ye=!0;return(async()=>{var Yr;let ht=String(be||"").trim().toUpperCase();if(ht.startsWith("THEORY")&&(ht="THEORY"),!ht){oe(null);return}const Vt=Lt==="QP2"?"QP2":Lt==="QP1"?"QP1":"",Wr=ht==="THEORY"&&Vt||null;try{const fn=await op({class_type:ht,question_paper_type:Wr,exam:"MODEL"}),In=Array.isArray((Yr=fn==null?void 0:fn.pattern)==null?void 0:Yr.marks)?fn.pattern.marks:[];if(!ye)return;oe(In.length?fn.pattern:null)}catch{if(!ye)return;oe(null)}})(),()=>{ye=!1}},[be,Lt]);const dt=v.useMemo(()=>{const ye=Array.isArray(H==null?void 0:H.marks)?H.marks:null;return Array.isArray(ye)&&ye.length?ye.map((lt,ht)=>({key:`q${ht+1}`,label:`Q${ht+1}`,max:Number(lt)||0})):sK},[H]),He=4+dt.length+1+4+a.length*2,$t=Me?ne||{}:he||{},Ue={width:"100%",border:"none",outline:"none",background:"transparent",padding:0,margin:0,fontSize:11,textAlign:"center"},er=async ye=>{const lt=!!(ye!=null&&ye.silent);if(!r){u([]),lt||x(null);return}lt||p(!0),lt||x(null);try{try{const Yr=await hr(`/api/academics/teaching-assignments/${r}/`);if(Yr.ok){const fn=await Yr.json();if(fn&&fn.elective_subject_id&&!fn.section_id){const In=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(fn.elective_subject_id))}`);if(!In.ok)throw new Error(`Elective-choices fetch failed: ${In.status}`);const Ye=await In.json(),nt=((Array.isArray(Ye.results)?Ye.results:Array.isArray(Ye)?Ye:Ye.items||[])||[]).map(xt=>({id:Number(xt.student_id??xt.id),reg_no:String(xt.reg_no??xt.registration_no??xt.regno??""),name:String(xt.name??xt.full_name??xt.username??""),section:xt.section_name??xt.section??null})).filter(xt=>Number.isFinite(xt.id)).sort((xt,rr)=>String(xt.name||"").localeCompare(String(rr.name||"")));u(nt);return}}}catch{}const ht=await Jo(r),Wr=[...(ht==null?void 0:ht.students)||[]].sort((Yr,fn)=>String(Yr.name||"").localeCompare(String(fn.name||"")));u(Wr)}catch(ht){u([]),lt||x((ht==null?void 0:ht.message)||"Failed to load roster")}finally{lt||p(!1)}};v.useEffect(()=>{er()},[r]);const Z=()=>({version:1,qpType:String(Oe??""),classType:String(be??""),tcplLikeKind:Wt,theoryQuestionBtl:Ke||{},tcplQuestionBtl:Mt||{},theorySheet:he||{},tcplSheet:ne||{}}),pe=ye=>{if(!ye||typeof ye!="object")return;E.current=!0;const lt=typeof ye.qpType=="string"?ye.qpType:null;if(lt!=null){const Vt=String(lt||"").trim().toUpperCase()==="QP2"?"QP2":"QP1";qe(Vt);try{yn(gn,Vt)}catch{}}if(ye.theoryQuestionBtl&&typeof ye.theoryQuestionBtl=="object"){Ce({...De,...ye.theoryQuestionBtl});try{yn(Rr,{...De,...ye.theoryQuestionBtl})}catch{}}if(ye.tcplQuestionBtl&&typeof ye.tcplQuestionBtl=="object"){tt({...lr,...ye.tcplQuestionBtl});try{yn(qt,{...lr,...ye.tcplQuestionBtl})}catch{}}if(ye.tcplSheet&&typeof ye.tcplSheet=="object"){z(ye.tcplSheet);try{yn(Qt,ye.tcplSheet)}catch{}}if(ye.theorySheet&&typeof ye.theorySheet=="object"){X(ye.theorySheet);try{yn(At,ye.theorySheet)}catch{}}window.setTimeout(()=>{E.current=!1},0)},ee=async ye=>{if(!e)return;const lt=!!(ye!=null&&ye.silent);lt||L(!0),lt||y(null);try{const ht=await En("model",e,r);ht!=null&&ht.draft&&pe(ht.draft),O(ht!=null&&ht.updated_at?new Date(ht.updated_at).toLocaleString():null);const Vt=ht==null?void 0:ht.updated_by;W(typeof(Vt==null?void 0:Vt.name)=="string"?Vt.name:typeof(Vt==null?void 0:Vt.username)=="string"?Vt.username:null)}catch(ht){lt||y((ht==null?void 0:ht.message)||"Failed to refresh draft")}finally{lt||L(!1)}};v.useEffect(()=>{fe(!1);let ye=!0;return(async()=>{try{await ee({silent:!0})}finally{ye&&fe(!0)}})(),()=>{ye=!1}},[e,r]);const ue=async()=>{L(!0),y(null);try{await Promise.all([er({silent:!0}),ee({silent:!0}),It({silent:!0}),gr({silent:!0})]);try{await se(!1)}catch{}}catch(ye){y((ye==null?void 0:ye.message)||"Refresh failed")}finally{L(!1)}},Ae=()=>{try{yn(gn,String(Oe??"")),yn(Rr,Ke),yn(qt,Mt),yn(Qt,ne),yn(At,he),alert("Saved locally.")}catch(ye){alert((ye==null?void 0:ye.message)||"Local save failed")}},Le=async()=>{if(e){w(!0),y(null);try{await Fs("model",e,Z()),O(new Date().toLocaleString())}catch(ye){y((ye==null?void 0:ye.message)||"Draft save failed")}finally{w(!1)}}},ct=async()=>{if(e){if(Xr){y("Publishing is locked by IQAC.");return}if(!mt){y("Publish window is closed. Please request IQAC approval.");return}if(_r&&en){Re(!0);return}k(!0),y(null);try{await dg("model",e,Z(),r),N(new Date().toLocaleString()),await se(!1),It({silent:!0}),gr({silent:!0});try{window.dispatchEvent(new CustomEvent("obe:published",{detail:{subjectId:e,assessment:"model"}}))}catch{}}catch(ye){y((ye==null?void 0:ye.message)||"Publish failed")}finally{k(!1)}}},ce=async()=>{if(e){$e(!0),We(null),y(null);try{await w0({assessment:"model",subject_code:e,reason:D,teaching_assignment_id:r}),We("Request sent to IQAC for approval.")}catch(ye){y((ye==null?void 0:ye.message)||"Failed to request approval")}finally{$e(!1),It({silent:!0})}}},xe=async()=>{if(e){ze(!0),y(null);try{await Yi({assessment:"model",subject_code:String(e),scope:"MARK_ENTRY",reason:Ve||`Edit request: MODEL marks entry for ${e}`,teaching_assignment_id:r}),alert("Edit request sent to IQAC. Waiting for approval..."),Re(!1),St(""),gr({silent:!0}),$r({silent:!0})}catch(ye){y((ye==null?void 0:ye.message)||"Failed to request edit")}finally{ze(!1)}}};async function se(ye,lt){if(e){ye&&ge(!0),R(null);try{const ht=await wa("model",String(e),r),Vt=(ht==null?void 0:ht.data)??null;!!(Vt&&typeof Vt=="object"&&Number(Vt.version)===1&&(typeof Vt.classType=="string"||typeof Vt.qpType=="string")&&("theorySheet"in Vt||"tcplSheet"in Vt))?(K(Vt),(lt!=null&&lt.applyToMain||en)&&pe(Vt)):(K(null),(ye||lt!=null&&lt.applyToMain)&&R("No published snapshot found."))}catch(ht){(ye||lt!=null&&lt.applyToMain)&&R((ht==null?void 0:ht.message)||"Failed to load published sheet")}finally{ye&&ge(!1)}}}v.useEffect(()=>{e&&se(!1)},[e,r]),v.useEffect(()=>{if(e){if(!en){q.current=!1;return}if(!q.current){if(q.current=!0,P&&typeof P=="object"){pe(P);return}se(!0,{applyToMain:!0})}}},[en,e,r]),v.useEffect(()=>{if(!e||!_r||Vr)return;const ye=window.setInterval(()=>{gr({silent:!0})},3e4);return()=>window.clearInterval(ye)},[Vr,_r,e,gr]);const Se=v.useMemo(()=>d.length?d:Array.from({length:5},(ye,lt)=>({id:-(lt+1),reg_no:"",name:"",section:null})),[d]),Ze=v.useMemo(()=>Object.values($t||{}).some(lt=>!!(lt!=null&&lt.absent)),[$t]),et=v.useMemo(()=>{const ye=Array.isArray(H==null?void 0:H.marks)?H.marks:null;if(Array.isArray(ye)&&ye.length&&Me)return ye.map((Vt,Wr)=>({key:`q${Wr+1}`,label:`Q${Wr+1}`,max:Number(Vt)||0}));const lt=Wt==="TCPR"?12:15,ht=Wt==="TCPR"?8:10;return Array.from({length:lt},(Vt,Wr)=>{const Yr=Wr+1;return{key:`q${Yr}`,label:`Q${Yr}`,max:Yr<=ht?2:16}})},[Wt,H,Me]),Et=v.useMemo(()=>et.reduce((ye,lt)=>ye+lt.max,0),[et]),wt=30,gt=Wt==="TCPR",zt=5,Dt=gt?0:wt/zt,mr=Wt==="TCPR"?"REVIEW":"LAB",pt=v.useMemo(()=>{const ye=Array.isArray(H==null?void 0:H.marks)?H.marks:null;return Array.isArray(ye)&&ye.length&&we?ye.map((lt,ht)=>({key:`q${ht+1}`,label:`Q${ht+1}`,max:Number(lt)||0})):[{key:"q1",label:"Q1",max:2},{key:"q2",label:"Q2",max:2},{key:"q3",label:"Q3",max:2},{key:"q4",label:"Q4",max:2},{key:"q5",label:"Q5",max:2},{key:"q6",label:"Q6",max:2},{key:"q7",label:"Q7",max:2},{key:"q8",label:"Q8",max:2},{key:"q9",label:"Q9",max:2},{key:"q10",label:"Q10",max:2},{key:"q11",label:"Q11",max:14},{key:"q12",label:"Q12",max:14},{key:"q13",label:"Q13",max:14},{key:"q14",label:"Q14",max:14},{key:"q15",label:"Q15",max:14},{key:"q16",label:"Q16",max:10}]},[H,we]),Xt=5,Rt=v.useMemo(()=>pt.reduce((ye,lt)=>ye+lt.max,0),[pt]),_t=v.useMemo(()=>{const ye=[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5,5],lt=Array.isArray(H==null?void 0:H.cos)?H.cos:null;return we&&Array.isArray(lt)&&lt.length===pt.length?lt.map(ht=>{const Vt=Number(ht);return Number.isFinite(Vt)?Math.max(1,Math.min(5,Math.trunc(Vt))):1}):pt.length===ye.length?ye:Array.from({length:pt.length},(ht,Vt)=>ye[Vt%ye.length])},[H,we,pt.length]),jr=v.useMemo(()=>{const ye=[2,2,3,3,3,2,2,3,3,3,4,4,3,3,3,5];return pt.length===ye.length?ye:Array.from({length:pt.length},(lt,ht)=>ye[ht%ye.length])},[pt.length]),Gr=v.useMemo(()=>{const ye=Array.from({length:Xt},()=>0);return pt.forEach((lt,ht)=>{const Vt=_t[ht]??1;Vt>=1&&Vt<=Xt&&(ye[Vt-1]+=lt.max)}),ye},[pt,_t]),Cr=v.useMemo(()=>Gr,[Gr]),Rr=v.useMemo(()=>`model_theory_questionBtl_${e}`,[e]),De=v.useMemo(()=>Object.fromEntries(pt.map((ye,lt)=>{const ht=jr[lt];return[ye.key,typeof ht=="number"?ht:""]})),[pt,jr]),[Ke,Ce]=v.useState(De);v.useEffect(()=>{if(!we)return;const ye=Bn(Rr);Ce(ye&&typeof ye=="object"?{...De,...ye}:De)},[we,Rr,De]);const it=(ye,lt)=>{Ce(ht=>{const Vt={...ht||{},[ye]:lt};return yn(Rr,Vt),Vt})},tr=v.useMemo(()=>pt.map((ye,lt)=>{const ht=(Ke||{})[ye.key];if(ht===""||ht===1||ht===2||ht===3||ht===4||ht===5||ht===6)return ht;const Vt=jr[lt];return typeof Vt=="number"?Vt:""}),[pt,Ke,jr]),Kt=v.useMemo(()=>{const ye=[0,0,0,0,0,0];return pt.forEach((lt,ht)=>{const Vt=tr[ht];typeof Vt=="number"&&Vt>=1&&Vt<=6&&(ye[Vt-1]+=lt.max)}),ye},[pt,tr]),yt=v.useMemo(()=>{const ye=Wt==="TCPR"?[1,1,2,2,3,3,4,4,1,2,3,4]:[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5],lt=Array.isArray(H==null?void 0:H.cos)?H.cos:null;return Me&&Array.isArray(lt)&&lt.length===et.length?lt.map(ht=>{const Vt=Number(ht);return Number.isFinite(Vt)?Math.max(1,Math.min(5,Math.trunc(Vt))):1}):et.length===ye.length?ye:Array.from({length:et.length},(ht,Vt)=>ye[Vt%ye.length])},[H,Me,Wt,et.length]),Ht=Wt==="TCPR"?"tcpr":"tcpl",qt=v.useMemo(()=>`model_${Ht}_questionBtl_${e}`,[e,Ht]),lr=v.useMemo(()=>Object.fromEntries(et.map(ye=>[ye.key,""])),[et]),[Mt,tt]=v.useState(lr);v.useEffect(()=>{if(!Me)return;const ye=Bn(qt);tt(ye&&typeof ye=="object"?{...lr,...ye}:lr)},[Me,qt,lr]);const Ft=(ye,lt)=>{tt(ht=>{const Vt={...ht||{},[ye]:lt};return yn(qt,Vt),Vt})},Qt=v.useMemo(()=>`model_${Ht}_sheet_${e}_${String(r??"none")}`,[e,r,Ht]);v.useEffect(()=>{if(!Me)return;const ye=Bn(Qt);z(ye&&typeof ye=="object"?ye:{})},[Me,Qt]);const At=v.useMemo(()=>`model_theory_sheet_${e}_${String(r??"none")}`,[e,r]);v.useEffect(()=>{if(Me)return;const ye=Bn(At);X(ye&&typeof ye=="object"?ye:{})},[Me,At]);const bt=(ye,lt)=>{z(ht=>{const Vt={...ht||{},[ye]:lt};return yn(Qt,Vt),Vt})},V=(ye,lt)=>{X(ht=>{const Vt={...ht||{},[ye]:lt};return yn(At,Vt),Vt})};v.useEffect(()=>{if(!me||!e||en||E.current)return;let ye=!1;const lt=window.setTimeout(async()=>{try{await Fs("model",e,Z()),ye||O(new Date().toLocaleString())}catch{}},700);return()=>{ye=!0,window.clearTimeout(lt)}},[me,e,r,en,Oe,be,Ke,Mt,he,ne]);const ie=(ye,lt)=>{const ht=String(ye??"");if(ht.trim()==="")return"";const Vt=Number(ht);return Number.isFinite(Vt)?Math.max(0,Math.min(lt,Vt)):""},_e=ye=>{const ht=(Math.round((ye+Number.EPSILON)*10)/10).toFixed(1);return ht.endsWith(".0")?ht.slice(0,-2):ht},Je=v.useMemo(()=>{const ye=Array.from({length:zt},()=>0);return et.forEach((lt,ht)=>{const Vt=yt[ht]??1;Vt>=1&&Vt<=zt&&(ye[Vt-1]+=lt.max)}),ye},[et,yt,zt]),Nt=v.useMemo(()=>gt?Je.map((ye,lt)=>lt===4?wt:ye):Je.map(ye=>ye+Dt),[Je,Dt,gt,wt]),Bt=v.useMemo(()=>{const ye=[0,0,0,0,0,0];return et.forEach(lt=>{const ht=(Mt||{})[lt.key]??"";typeof ht=="number"&&ht>=1&&ht<=6&&(ye[ht-1]+=lt.max)}),ye},[et,Mt]),jt=v.useMemo(()=>{const ye=new Set;return et.forEach(lt=>{const ht=(Mt||{})[lt.key]??"";(ht===1||ht===2||ht===3||ht===4||ht===5||ht===6)&&ye.add(ht)}),ye.size===0?[1,2,3,4,5,6]:[1,2,3,4,5,6].filter(lt=>ye.has(lt))},[et,Mt]),cr=(ye,lt)=>{const ht=ye==null?void 0:ye.id;if(typeof ht=="number"&&ht>0)return`id:${ht}`;const Vt=String((ye==null?void 0:ye.reg_no)||"").trim();return Vt?`reg:${Vt}`:`idx:${lt}`},sr=v.useRef({}),Fr=ye=>lt=>{sr.current[ye]=lt},Nr=ye=>{const lt=sr.current[ye];if(lt){lt.focus();try{lt.select()}catch{}}},Pt=4+et.length+1+1+zt*2+jt.length*2,Ot=v.useMemo(()=>{const ye=new Set;return pt.forEach(lt=>{const ht=(Ke||{})[lt.key]??"";(ht===1||ht===2||ht===3||ht===4||ht===5||ht===6)&&ye.add(ht)}),ye.size===0?[1,2,3,4,5,6]:[1,2,3,4,5,6].filter(lt=>ye.has(lt))},[pt,Ke]),Tr=4+pt.length+1+Xt*2+Ot.length*2,vr=v.useMemo(()=>U?Se.filter((ye,lt)=>{var Vt;const ht=cr(ye,lt);return M&&M.length?M.includes(ht):!!((Vt=($t||{})[ht])!=null&&Vt.absent)}):Se,[Se,U,$t,M]);return n.jsxs("div",{children:[Q?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(15,23,42,0.45)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:50},onClick:()=>G(null),children:n.jsxs("div",{style:{width:"min(520px, 100%)",background:"#fff",borderRadius:14,border:"1px solid rgba(15,23,42,0.10)",boxShadow:"0 20px 60px rgba(2,6,23,0.25)",padding:14},onClick:ye=>ye.stopPropagation(),children:[n.jsx("div",{style:{fontWeight:900,marginBottom:6},children:Q.title}),n.jsx("div",{style:{fontSize:13,color:"#334155",marginBottom:12},children:Q.message}),n.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:n.jsx("button",{className:"obe-btn",onClick:()=>G(null),children:"Close"})})]})}):null,n.jsxs("div",{style:{marginBottom:10,color:"#6b7280",fontSize:12},children:["Subject: ",n.jsx("b",{children:e})," | Assessment: ",n.jsx("b",{children:"MODEL"}),be?n.jsxs(n.Fragment,{children:[" ","| Class: ",n.jsx("b",{children:be})]}):null," ","| QP: ",n.jsx("b",{children:Lt||"QP1"})]}),h?n.jsx("div",{style:{color:"#6b7280",marginBottom:8},children:"Loading roster"}):null,f?n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10,marginBottom:10,maxWidth:"100%",whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:f}):null,g?n.jsx("div",{style:{background:"#fff7ed",border:"1px solid #fed7aa",color:"#9a3412",padding:10,borderRadius:10,marginBottom:10,maxWidth:"100%",whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:g}):null,n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:10},children:[n.jsx("button",{onClick:Le,className:"obe-btn obe-btn-success",disabled:m||!e||en,title:en?"Published sheets are locked (IQAC must open editing).":void 0,children:m?"Saving":"Save Draft"}),n.jsx("button",{onClick:Ae,className:"obe-btn",disabled:!e||en,children:"Save"}),n.jsx("button",{onClick:ue,className:"obe-btn",disabled:F||!e,children:F?"Refreshing":"Refresh"}),n.jsx("button",{onClick:ct,className:"obe-btn obe-btn-primary",disabled:S||!mt||!e||_r&&en,title:_r&&en?"Published and locked (use View/Edit on the lock panel).":mt?void 0:"Publish window is closed.",children:S?"Publishing":"Publish"})]}),n.jsx("div",{style:{marginBottom:10,fontSize:12,color:mt?"#065f46":"#b91c1c"},children:pr?"Checking publish due time":fr||(Ct!=null&&Ct.due_at?n.jsxs(n.Fragment,{children:["Due: ",new Date(Ct.due_at).toLocaleString(),"  Remaining: ",_0(Be)]}):"Due time not set by IQAC.")}),Xr?n.jsxs("div",{style:{marginBottom:10,border:"1px solid #fde68a",background:"#fffbeb",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Locked by IQAC"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Publishing is currently locked globally by IQAC."})]}):mt?null:n.jsxs("div",{style:{marginBottom:10,border:"1px solid #fecaca",background:"#fff7ed",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publish window closed"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"Request IQAC approval to open the publish window."}),n.jsx("textarea",{value:D,onChange:ye=>Y(ye.target.value),placeholder:"Reason (optional)",rows:3,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical"}}),n.jsx("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:n.jsx("button",{className:"obe-btn obe-btn-success",onClick:ce,disabled:le||!e,children:le?"Requesting":"Request Approval"})}),je?n.jsx("div",{style:{marginTop:10,fontSize:12,color:"#065f46"},children:je}):null]}),n.jsxs("div",{style:{marginBottom:10,display:"flex",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Saved"}),n.jsx("div",{style:{fontWeight:700},children:C||""}),T?n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["by ",n.jsx("span",{style:{color:"#0369a1",fontWeight:700},children:T})]}):null]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Published"}),n.jsx("div",{style:{fontWeight:700},children:A||""}),n.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"obe-btn",disabled:!_r||!e,onClick:()=>se(!0,{applyToMain:!0}),title:_r?void 0:"Publish first to view the published snapshot.",children:re?"Loading":"View Published"}),n.jsx("button",{className:"obe-btn",onClick:()=>gr(),disabled:!e,children:"Refresh Lock"})]}),Fe?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#b91c1c"},children:Fe}):null]})]}),en?n.jsxs("div",{style:{marginBottom:10,border:"1px solid #fde68a",background:"#fffbeb",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Published & locked"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Editing and auto-save are disabled until IQAC opens the edit window."})]}):null,Ee?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:80},onClick:()=>Re(!1),children:n.jsxs("div",{style:{width:"min(520px, 96vw)",background:"#fff",borderRadius:16,border:"1px solid #e5e7eb",padding:14,boxShadow:"0 12px 30px rgba(0,0,0,0.18)"},onClick:ye=>ye.stopPropagation(),children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"Edit Request"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginTop:6},children:"This will send an edit request to IQAC for published MODEL marks. Once approved, the entry will open for editing until the approval expires."}),n.jsx("textarea",{value:Ve,onChange:ye=>St(ye.target.value),placeholder:"Reason (optional)",rows:3,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical",marginTop:10}}),n.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,justifyContent:"flex-end"},children:[n.jsx("button",{className:"obe-btn",disabled:rt,onClick:()=>Re(!1),children:"Close"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:rt||!e,onClick:xe,children:rt?"Sending":"Send Request"})]})]})}):null,n.jsx(n.Fragment,{children:n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:10},children:n.jsxs("button",{className:"obe-btn",disabled:!Ze,onClick:()=>{if(U)return;const ye=(Se||[]).map((lt,ht)=>{var Vt;return{key:cr(lt,ht),isAbsent:!!((Vt=($t||{})[cr(lt,ht)])!=null&&Vt.absent)}}).filter(lt=>lt.isAbsent).map(lt=>lt.key);te(ye),I(!0)},title:Ze?"Filter the table to show only absentees":"No absentees marked yet",style:U?{background:"linear-gradient(180deg, #111827, #334155)",color:"#fff",borderColor:"rgba(2,6,23,0.12)"}:void 0,children:["Show absentees list",U?n.jsx("span",{onClick:ye=>{ye.stopPropagation(),I(!1),te(null)},role:"button","aria-label":"Close absentees list",title:"Close absentees list",style:{marginLeft:10,display:"inline-flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:999,background:"rgba(255,255,255,0.18)",border:"1px solid rgba(255,255,255,0.25)",fontWeight:900,lineHeight:1,cursor:"pointer",userSelect:"none"},children:""}):null]})})}),n.jsxs("div",{style:{position:"relative",minHeight:en&&!Ie?220:void 0},children:[_r&&en?n.jsx("div",{style:{position:"absolute",inset:0,zIndex:30,pointerEvents:"none",background:"linear-gradient(180deg, rgba(34,197,94,0.18) 0%, rgba(16,185,129,0.24) 100%)"}}):null,_r&&en?n.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:40,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:"10px 14px",borderRadius:999,display:"flex",alignItems:"center",gap:12,boxShadow:"0 6px 18px rgba(17,24,39,0.06)",pointerEvents:"auto",maxWidth:"min(720px, 96vw)"},children:[n.jsx("div",{style:{width:34,height:34,borderRadius:999,display:"grid",placeItems:"center",background:"#fef3c7",border:"1px solid #f59e0b33",color:"#92400e"},"aria-hidden":"true",children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("path",{d:"M7 11V8a5 5 0 0 1 10 0v3",stroke:"#92400e",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.jsx("path",{d:"M6 11h12a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z",stroke:"#92400e",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),n.jsxs("div",{style:{minWidth:0},children:[n.jsx("div",{style:{fontWeight:900,fontSize:18,color:"#111827",lineHeight:1.1},children:"Published  Locked"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280",marginTop:2},children:re?"Loading published marks":Fe||"Marks are published. IQAC approval is required to edit."})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"obe-btn",disabled:!_r||!e,onClick:async()=>{ot(ye=>!ye);try{await se(!0,{applyToMain:!0})}catch{}},title:_r?void 0:"Publish first to view the published snapshot.",children:re?"Loading":"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:!e,onClick:()=>Re(!0),title:"Ask IQAC to open editing for published marks",children:"Edit"})]})]}):null,n.jsx("div",{className:"obe-table-wrapper",style:{overflowX:"auto"},children:n.jsx("table",{className:"obe-table",style:{width:"max-content",minWidth:"100%",tableLayout:"auto",pointerEvents:en?"none":void 0,opacity:en?.78:1,display:en&&!Ie?"none":void 0},children:Me?n.jsxs(n.Fragment,{children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:o,colSpan:Pt,children:["MODEL (",be||"TCPL"," Header Template)"]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...o,width:c,minWidth:c},rowSpan:5,children:"S.No"}),n.jsx("th",{style:{...o,minWidth:110,overflow:"visible",textOverflow:"clip"},rowSpan:5,children:"Register No."}),n.jsx("th",{style:{...o,minWidth:240,overflow:"visible",textOverflow:"clip"},rowSpan:5,children:"Name of the Students"}),n.jsx("th",{style:{...o,minWidth:92},rowSpan:5,children:"AB"}),et.map(ye=>n.jsx("th",{style:{...o,width:40,minWidth:40},children:ye.label},ye.key)),n.jsx("th",{style:{...o,minWidth:56},rowSpan:3,children:"Total"}),n.jsx("th",{style:{...o,minWidth:56},rowSpan:3,children:mr}),n.jsx("th",{style:o,colSpan:zt*2,children:"CO ATTAINMENT"}),n.jsx("th",{style:o,colSpan:jt.length*2,children:"BTL ATTAINMENT"})]}),n.jsxs("tr",{children:[n.jsx("th",{style:{...o,fontWeight:800},colSpan:et.length,children:"COS"}),n.jsx("th",{style:o,colSpan:zt*2,children:""}),n.jsx("th",{style:o,colSpan:jt.length*2,children:""})]}),n.jsxs("tr",{children:[yt.map((ye,lt)=>n.jsx("th",{style:{...o,width:40,minWidth:40},children:ye},`co-map-${lt}`)),Array.from({length:zt}).map((ye,lt)=>n.jsxs("th",{style:o,colSpan:2,children:["CO-",lt+1]},`co-head-${lt}`)),jt.map(ye=>n.jsxs("th",{style:o,colSpan:2,children:["BTL-",ye]},`btl-head-${ye}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:{...o,fontWeight:800},colSpan:et.length,children:"BTL"}),n.jsx("th",{style:o,children:""}),n.jsx("th",{style:o,children:""}),Array.from({length:zt+jt.length}).flatMap((ye,lt)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:{...o,minWidth:52},children:n.jsx("div",{style:{whiteSpace:"pre-line",lineHeight:"0.9",fontSize:"0.7em"},children:`M
A
R
K`})}),n.jsx("th",{style:{...o,minWidth:34},children:"%"})]},`mkpct-${lt}`))]}),n.jsxs("tr",{children:[et.map(ye=>{const lt=(Mt||{})[ye.key]??"",ht=lt===""?"-":String(lt);return n.jsx("th",{style:{...o,width:40,minWidth:40,padding:0},children:n.jsxs("div",{style:{position:"relative",minWidth:40},children:[n.jsx("div",{style:{width:"100%",fontSize:11,padding:"4px 4px",border:"1px solid #d1d5db",borderRadius:8,background:"#fff",textAlign:"center",userSelect:"none",margin:2},title:`BTL: ${ht}`,children:ht}),n.jsxs("select",{"aria-label":`BTL for ${ye.label}`,value:lt,onChange:Vt=>Ft(ye.key,Vt.target.value===""?"":Number(Vt.target.value)),style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:"pointer",appearance:"none"},children:[n.jsx("option",{value:"",children:"-"}),n.jsx("option",{value:"1",children:"1"}),n.jsx("option",{value:"2",children:"2"}),n.jsx("option",{value:"3",children:"3"}),n.jsx("option",{value:"4",children:"4"}),n.jsx("option",{value:"5",children:"5"}),n.jsx("option",{value:"6",children:"6"})]})]})},`btl-map-${ye.key}`)}),n.jsx("th",{style:o,children:""}),n.jsx("th",{style:o,children:""}),Array.from({length:zt*2+jt.length*2}).map((ye,lt)=>n.jsx("th",{style:o,children:""},`tailblank-${lt}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:o,children:"S.No"}),n.jsx("th",{style:o,children:"Register No."}),n.jsx("th",{style:o,children:"Name / Max Marks"}),n.jsx("th",{style:o,children:""}),et.map(ye=>n.jsx("th",{style:{...o,width:40,minWidth:40},children:ye.max},`qmax-${ye.key}`)),n.jsx("th",{style:o,children:Et}),n.jsx("th",{style:o,children:"30"}),Nt.flatMap((ye,lt)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:o,children:_e(ye)}),n.jsx("th",{style:o,children:"%"})]},`co-max-mm-${lt}`)),jt.flatMap(ye=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:o,children:_e(Bt[ye-1]||0)}),n.jsx("th",{style:o,children:"%"})]},`btl-max-mm-${ye}`))]})]}),n.jsx("tbody",{children:vr.map((ye,lt)=>n.jsx("tr",{children:(()=>{const ht=cr(ye,lt),Vt=(ne||{})[ht]||{},Wr=!!Vt.absent,Yr=Vt.lab??"",fn=Wr?i(Vt.absentKind):null,In=!!(U&&Wr&&(fn==="ML"||fn==="SKL")),Ye=Wr&&fn==="AL"?0:null,st=Wr&&fn==="ML"?60:Wr&&fn==="SKL"?75:null,at={};et.forEach(nr=>{const ar=(Vt.q||{})[nr.key]??"",j=typeof ar=="number"&&Number.isFinite(ar)?ar:0;at[nr.key]=Math.max(0,Math.min(nr.max,j))});const nt=typeof Yr=="number"&&Number.isFinite(Yr)?Math.max(0,Math.min(wt,Yr)):0,xt=Object.values(at).reduce((nr,ar)=>nr+ar,0),rr=Array.from({length:zt},()=>0);if(et.forEach((nr,ar)=>{const j=yt[ar]??1;j>=1&&j<=zt&&(rr[j-1]+=at[nr.key]||0)}),gt)rr[4]+=nt;else for(let nr=0;nr<zt;nr++)rr[nr]+=nt/zt;const vt=rr.map((nr,ar)=>{const j=Nt[ar]||0;return j?nr/j*100:0}),dr=[0,0,0,0,0,0];et.forEach(nr=>{const ar=(Mt||{})[nr.key]??"";typeof ar=="number"&&ar>=1&&ar<=6&&(dr[ar-1]+=at[nr.key]||0)});const ir=dr.map((nr,ar)=>{const j=Bt[ar]||0;return j?nr/j*100:0}),Br=nr=>{if(nr){bt(ht,{...Vt,absent:!0,absentKind:i(Vt.absentKind),q:Object.fromEntries(et.map(ar=>[ar.key,""])),lab:""});return}bt(ht,{...Vt,absent:!1,absentKind:void 0})},kr=nr=>{bt(ht,{...Vt,absent:!0,absentKind:i(nr)})},Ur=nr=>{Wr&&!In||bt(ht,{...Vt,lab:ie(nr,wt)})},zr=(nr,ar,j)=>{if(Wr&&!In)return;const ae=ie(ar,j),Ne={...Vt.q||{},[nr]:ae};if(st!=null&&et.reduce((ut,Jt)=>{const ur=Ne[Jt.key]??"",Kr=typeof ur=="number"&&Number.isFinite(ur)?ur:0;return ut+Math.max(0,Math.min(Jt.max,Kr))},0)>st){G({title:"Mark limit exceeded",message:fn==="ML"?"For malpractice the total mark assigned is 60":"For Sick leave the Total mark assigned is 75"});return}bt(ht,{...Vt,q:Ne})},Or=[...et.map(nr=>nr.key),"lab"],Lr=(nr,ar)=>{const j=Or.indexOf(nr),ae=ar==="left"?Math.max(0,j-1):ar==="right"?Math.min(Or.length-1,j+1):j,Ne=ar==="up"?Math.max(0,lt-1):ar==="down"?Math.min(vr.length-1,lt+1):lt,ut=`${cr(vr[Ne],Ne)}|${Or[ae]}`;Nr(ut)},cn=nr=>ar=>{ar.key==="Tab"?(ar.preventDefault(),Lr(nr,ar.shiftKey?"left":"right")):ar.key==="ArrowLeft"?(ar.preventDefault(),Lr(nr,"left")):ar.key==="ArrowRight"?(ar.preventDefault(),Lr(nr,"right")):ar.key==="ArrowUp"||ar.key==="Enter"&&ar.shiftKey?(ar.preventDefault(),Lr(nr,"up")):(ar.key==="ArrowDown"||ar.key==="Enter")&&(ar.preventDefault(),Lr(nr,"down"))};return n.jsxs(n.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:lt+1}),n.jsx("td",{style:l,children:ye.reg_no||""}),n.jsx("td",{style:l,children:ye.name||""}),n.jsx("td",{style:{...l,textAlign:"center"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[n.jsx("input",{type:"checkbox",checked:Wr,onChange:nr=>Br(nr.target.checked)}),Wr?n.jsxs("div",{className:"obe-ios-select",title:"Absent type",children:[n.jsx("span",{className:"obe-ios-select-value",children:fn||"AL"}),n.jsxs("select",{"aria-label":"Absent type",value:fn||"AL",onChange:nr=>kr(i(nr.target.value)),children:[n.jsx("option",{value:"AL",children:"AL"}),n.jsx("option",{value:"ML",children:"ML"}),n.jsx("option",{value:"SKL",children:"SKL"})]})]}):null]})}),et.map(nr=>{const ar=(Vt.q||{})[nr.key]??"",j=`${ht}|${nr.key}`;return n.jsx("td",{style:{...l,textAlign:"center"},children:n.jsx("input",{ref:Fr(j),type:"text",inputMode:"decimal",disabled:Wr&&!In,value:ar===""?"":String(ar),onChange:ae=>zr(nr.key,ae.target.value,nr.max),onFocus:ae=>ae.currentTarget.select(),onKeyDown:cn(nr.key),style:Ue})},`${lt}-${nr.key}`)}),n.jsx("td",{style:{...l,textAlign:"center",fontWeight:700},children:_e(Ye??xt)}),n.jsx("td",{style:{...l,textAlign:"center"},children:n.jsx("input",{ref:Fr(`${ht}|lab`),type:"text",inputMode:"decimal",disabled:Wr&&!In,value:Yr===""?"":String(Yr),onChange:nr=>Ur(nr.target.value),onFocus:nr=>nr.currentTarget.select(),onKeyDown:cn("lab"),style:Ue})}),rr.flatMap((nr,ar)=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:_e(nr)}),n.jsx("td",{style:{...l,textAlign:"center"},children:_e(vt[ar])})]},`co-${lt}-${ar}`)),jt.flatMap(nr=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:_e(dr[nr-1]||0)}),n.jsx("td",{style:{...l,textAlign:"center"},children:_e(ir[nr-1]||0)})]},`btl-${lt}-${nr}`))]})})()},String(ye.id??lt)))})]}):n.jsx(n.Fragment,{children:we?n.jsxs(n.Fragment,{children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsx("th",{style:o,colSpan:Tr,children:"MODEL (THEORY Header Template)"})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...o,width:c,minWidth:c},rowSpan:5,children:"S.No"}),n.jsx("th",{style:{...o,minWidth:110,overflow:"visible",textOverflow:"clip"},rowSpan:5,children:"Register No."}),n.jsx("th",{style:{...o,minWidth:240,overflow:"visible",textOverflow:"clip"},rowSpan:5,children:"Name of the Students"}),n.jsx("th",{style:{...o,minWidth:92},rowSpan:5,children:"ABSENT"}),pt.map(ye=>n.jsx("th",{style:{...o,width:40,minWidth:40},children:ye.label},ye.key)),n.jsx("th",{style:{...o,minWidth:56},rowSpan:3,children:"Total"}),n.jsx("th",{style:o,colSpan:Xt*2,children:"CO ATTAINMENT"}),n.jsx("th",{style:o,colSpan:Ot.length*2,children:"BTL ATTAINMENT"})]}),n.jsxs("tr",{children:[n.jsx("th",{style:{...o,fontWeight:800},colSpan:pt.length,children:"COs"}),n.jsx("th",{style:o,colSpan:Xt*2,children:""}),n.jsx("th",{style:o,colSpan:Ot.length*2,children:""})]}),n.jsxs("tr",{children:[_t.map((ye,lt)=>n.jsx("th",{style:{...o,width:40,minWidth:40},children:ye},`theory-co-map-${lt}`)),Array.from({length:Xt}).map((ye,lt)=>n.jsxs("th",{style:o,colSpan:2,children:["CO-",lt+1]},`theory-co-head-${lt}`)),Ot.map(ye=>n.jsxs("th",{style:o,colSpan:2,children:["BTL-",ye]},`theory-btl-head-${ye}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:{...o,fontWeight:800},colSpan:pt.length,children:"BTL"}),n.jsx("th",{style:o,children:""}),Array.from({length:Xt+Ot.length}).flatMap((ye,lt)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:{...o,minWidth:52},children:n.jsx("div",{style:{whiteSpace:"pre-line",lineHeight:"0.9",fontSize:"0.7em"},children:`M
A
R
K`})}),n.jsx("th",{style:{...o,minWidth:34},children:"%"})]},`theory-mkpct-${lt}`))]}),n.jsxs("tr",{children:[pt.map((ye,lt)=>{const ht=(Ke||{})[ye.key]??"",Vt=ht===""?"-":String(ht);return n.jsx("th",{style:{...o,width:40,minWidth:40,padding:0},children:n.jsxs("div",{style:{position:"relative",minWidth:40},children:[n.jsx("div",{style:{width:"100%",fontSize:11,padding:"4px 4px",border:"1px solid #d1d5db",borderRadius:8,background:"#fff",textAlign:"center",userSelect:"none",margin:2},title:`BTL: ${Vt}`,children:Vt}),n.jsxs("select",{"aria-label":`BTL for ${ye.label}`,value:ht,onChange:Wr=>it(ye.key,Wr.target.value===""?"":Number(Wr.target.value)),style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:"pointer",appearance:"none"},children:[n.jsx("option",{value:"",children:"-"}),n.jsx("option",{value:"1",children:"1"}),n.jsx("option",{value:"2",children:"2"}),n.jsx("option",{value:"3",children:"3"}),n.jsx("option",{value:"4",children:"4"}),n.jsx("option",{value:"5",children:"5"}),n.jsx("option",{value:"6",children:"6"})]})]})},`theory-btl-map-${ye.key}`)}),n.jsx("th",{style:o,children:""}),Array.from({length:Xt*2+Ot.length*2}).map((ye,lt)=>n.jsx("th",{style:o,children:""},`theory-tailblank-${lt}`))]}),n.jsxs("tr",{children:[n.jsx("th",{style:o,children:"S.No"}),n.jsx("th",{style:o,children:"Register No."}),n.jsx("th",{style:o,children:"Name / Max Marks"}),n.jsx("th",{style:o,children:""}),pt.map(ye=>n.jsx("th",{style:{...o,width:40,minWidth:40},children:ye.max},`theory-qmax-${ye.key}`)),n.jsx("th",{style:o,children:Rt}),Cr.flatMap((ye,lt)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:o,children:_e(ye)}),n.jsx("th",{style:o,children:"%"})]},`theory-co-max-mm-${lt}`)),Ot.flatMap(ye=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:o,children:_e(Kt[ye-1]||0)}),n.jsx("th",{style:o,children:"%"})]},`theory-btl-max-mm-${ye}`))]})]}),n.jsx("tbody",{children:vr.map((ye,lt)=>n.jsx("tr",{children:(()=>{const ht=cr(ye,lt),Vt=($t||{})[ht]||{},Wr=!!Vt.absent,Yr=Wr?i(Vt.absentKind):null,fn=!!(U&&Wr&&(Yr==="ML"||Yr==="SKL")),In=Wr&&Yr==="AL"?0:null,Ye=Wr&&Yr==="ML"?60:Wr&&Yr==="SKL"?75:null,st={};pt.forEach(kr=>{const Ur=(Vt.q||{})[kr.key]??"",zr=typeof Ur=="number"&&Number.isFinite(Ur)?Ur:0;st[kr.key]=Math.max(0,Math.min(kr.max,zr))});const at=Object.values(st).reduce((kr,Ur)=>kr+Ur,0),nt=Array.from({length:Xt},()=>0);pt.forEach((kr,Ur)=>{const zr=_t[Ur]??1;zr>=1&&zr<=Xt&&(nt[zr-1]+=st[kr.key]||0)});const xt=nt.map((kr,Ur)=>{const zr=Cr[Ur]||0;return zr?kr/zr*100:0}),rr=[0,0,0,0,0,0];pt.forEach((kr,Ur)=>{const zr=tr[Ur];typeof zr=="number"&&zr>=1&&zr<=6&&(rr[zr-1]+=st[kr.key]||0)});const vt=rr.map((kr,Ur)=>{const zr=Kt[Ur]||0;return zr?kr/zr*100:0}),dr=kr=>{if(kr){V(ht,{...Vt,absent:!0,absentKind:i(Vt.absentKind),q:Object.fromEntries(pt.map(Ur=>[Ur.key,""]))});return}V(ht,{...Vt,absent:!1,absentKind:void 0})},ir=kr=>{V(ht,{...Vt,absent:!0,absentKind:i(kr)})},Br=(kr,Ur,zr)=>{if(Wr&&!fn)return;const Or=ie(Ur,zr),Lr={...Vt.q||{},[kr]:Or};if(Ye!=null&&pt.reduce((nr,ar)=>{const j=Lr[ar.key]??"",ae=typeof j=="number"&&Number.isFinite(j)?j:0;return nr+Math.max(0,Math.min(ar.max,ae))},0)>Ye){G({title:"Mark limit exceeded",message:Yr==="ML"?"For malpractice the total mark assigned is 60":"For Sick leave the Total mark assigned is 75"});return}V(ht,{...Vt,q:Lr})};return n.jsxs(n.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:lt+1}),n.jsx("td",{style:l,children:ye.reg_no||""}),n.jsx("td",{style:l,children:ye.name||""}),n.jsx("td",{style:{...l,textAlign:"center"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[n.jsx("input",{type:"checkbox",checked:Wr,onChange:kr=>dr(kr.target.checked)}),Wr?n.jsxs("div",{className:"obe-ios-select",title:"Absent type",children:[n.jsx("span",{className:"obe-ios-select-value",children:Yr||"AL"}),n.jsxs("select",{"aria-label":"Absent type",value:Yr||"AL",onChange:kr=>ir(i(kr.target.value)),children:[n.jsx("option",{value:"AL",children:"AL"}),n.jsx("option",{value:"ML",children:"ML"}),n.jsx("option",{value:"SKL",children:"SKL"})]})]}):null]})}),pt.map(kr=>{const Ur=(Vt.q||{})[kr.key]??"",zr=`${ht}|${kr.key}`,Or=pt.map(nr=>nr.key),Lr=(nr,ar)=>{const j=Math.max(0,Or.indexOf(nr)),ae=ar==="left"?Math.max(0,j-1):ar==="right"?Math.min(Or.length-1,j+1):j,Ne=ar==="up"?Math.max(0,lt-1):ar==="down"?Math.min(vr.length-1,lt+1):lt,Xe=cr(vr[Ne],Ne);Nr(`${Xe}|${Or[ae]}`)},cn=nr=>ar=>{ar.key==="Tab"?(ar.preventDefault(),Lr(nr,ar.shiftKey?"left":"right")):ar.key==="ArrowLeft"?(ar.preventDefault(),Lr(nr,"left")):ar.key==="ArrowRight"?(ar.preventDefault(),Lr(nr,"right")):ar.key==="ArrowUp"||ar.key==="Enter"&&ar.shiftKey?(ar.preventDefault(),Lr(nr,"up")):(ar.key==="ArrowDown"||ar.key==="Enter")&&(ar.preventDefault(),Lr(nr,"down"))};return n.jsx("td",{style:{...l,textAlign:"center"},children:n.jsx("input",{ref:Fr(zr),type:"text",inputMode:"decimal",disabled:Wr&&!fn,value:Ur===""?"":String(Ur),onChange:nr=>Br(kr.key,nr.target.value,kr.max),onFocus:nr=>nr.currentTarget.select(),onKeyDown:cn(kr.key),style:Ue})},`${lt}-${kr.key}`)}),n.jsx("td",{style:{...l,textAlign:"center",fontWeight:700},children:_e(In??at)}),nt.flatMap((kr,Ur)=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:_e(kr)}),n.jsx("td",{style:{...l,textAlign:"center"},children:_e(xt[Ur])})]},`theory-co-${lt}-${Ur}`)),Ot.flatMap(kr=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:_e(rr[kr-1]||0)}),n.jsx("td",{style:{...l,textAlign:"center"},children:_e(vt[kr-1]||0)})]},`theory-btl-${lt}-${kr}`))]})})()},String(ye.id??lt)))})]}):n.jsxs(n.Fragment,{children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsx("th",{style:o,colSpan:He,children:"MODEL (Blank Template)"})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...o,width:c,minWidth:c},rowSpan:3,children:"S.No"}),n.jsx("th",{style:{...o,minWidth:70,overflow:"visible",textOverflow:"clip"},rowSpan:3,children:"R.No"}),n.jsx("th",{style:{...o,minWidth:240,overflow:"visible",textOverflow:"clip"},rowSpan:3,children:"Name of the Students"}),n.jsx("th",{style:{...o,minWidth:32},rowSpan:3,children:"AB"}),n.jsx("th",{style:o,colSpan:dt.length,children:"QUESTIONS"}),n.jsx("th",{style:o,rowSpan:3,children:"Total"}),n.jsx("th",{style:o,colSpan:4,children:"CO ATTAINMENT"}),n.jsx("th",{style:o,colSpan:a.length*2,children:"BTL ATTAINMENT"})]}),n.jsxs("tr",{children:[dt.map(ye=>n.jsx("th",{style:{...o,width:46,minWidth:46},children:ye.label},ye.key)),n.jsx("th",{style:o,colSpan:2,children:"CO-1"}),n.jsx("th",{style:o,colSpan:2,children:"CO-2"}),a.map(ye=>n.jsxs("th",{style:o,colSpan:2,children:["BTL-",ye]},`btl-head-${ye}`))]}),n.jsxs("tr",{children:[dt.map(ye=>n.jsx("th",{style:{...o,width:46,minWidth:46},children:ye.max},ye.key)),Array.from({length:2+a.length}).flatMap((ye,lt)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:{...o,minWidth:52},children:n.jsx("div",{style:{whiteSpace:"pre-line",lineHeight:"0.9",fontSize:"0.7em"},children:`M
A
R
K`})}),n.jsx("th",{style:{...o,minWidth:34},children:"%"})]},lt))]})]}),n.jsx("tbody",{children:vr.map((ye,lt)=>n.jsxs("tr",{children:[(()=>{const ht=cr(ye,lt),Vt=($t||{})[ht]||{},Wr=!!Vt.absent,Yr=Wr?i(Vt.absentKind):null,fn=!!(U&&Wr&&(Yr==="ML"||Yr==="SKL")),In=Wr&&Yr==="AL"?0:null,Ye=Wr&&Yr==="ML"?60:Wr&&Yr==="SKL"?75:null,st={};dt.forEach(vt=>{const dr=(Vt.q||{})[vt.key]??"",ir=typeof dr=="number"&&Number.isFinite(dr)?dr:0;st[vt.key]=Math.max(0,Math.min(vt.max,ir))});const at=Object.values(st).reduce((vt,dr)=>vt+dr,0),nt=vt=>{if(vt){V(ht,{...Vt,absent:!0,absentKind:i(Vt.absentKind),q:Object.fromEntries(dt.map(dr=>[dr.key,""]))});return}V(ht,{...Vt,absent:!1,absentKind:void 0})},xt=vt=>{V(ht,{...Vt,absent:!0,absentKind:i(vt)})},rr=(vt,dr,ir)=>{if(Wr&&!fn)return;const Br=ie(dr,ir),kr={...Vt.q||{},[vt]:Br};if(Ye!=null&&dt.reduce((zr,Or)=>{const Lr=kr[Or.key]??"",cn=typeof Lr=="number"&&Number.isFinite(Lr)?Lr:0;return zr+Math.max(0,Math.min(Or.max,cn))},0)>Ye){G({title:"Mark limit exceeded",message:Yr==="ML"?"For malpractice the total mark assigned is 60":"For Sick leave the Total mark assigned is 75"});return}V(ht,{...Vt,q:kr})};return n.jsxs(n.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:lt+1}),n.jsx("td",{style:l,children:ye.reg_no||""}),n.jsx("td",{style:l,children:ye.name||""}),n.jsx("td",{style:{...l,textAlign:"center"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[n.jsx("input",{type:"checkbox",checked:Wr,onChange:vt=>nt(vt.target.checked)}),Wr?n.jsxs("div",{className:"obe-ios-select",title:"Absent type",children:[n.jsx("span",{className:"obe-ios-select-value",children:Yr||"AL"}),n.jsxs("select",{"aria-label":"Absent type",value:Yr||"AL",onChange:vt=>xt(i(vt.target.value)),children:[n.jsx("option",{value:"AL",children:"AL"}),n.jsx("option",{value:"ML",children:"ML"}),n.jsx("option",{value:"SKL",children:"SKL"})]})]}):null]})}),dt.map(vt=>{const dr=(Vt.q||{})[vt.key]??"",ir=`${ht}|${vt.key}`,Br=dt.map(zr=>zr.key),kr=(zr,Or)=>{const Lr=Math.max(0,Br.indexOf(zr)),cn=Or==="left"?Math.max(0,Lr-1):Or==="right"?Math.min(Br.length-1,Lr+1):Lr,nr=Or==="up"?Math.max(0,lt-1):Or==="down"?Math.min(vr.length-1,lt+1):lt,ar=cr(vr[nr],nr);Nr(`${ar}|${Br[cn]}`)},Ur=zr=>Or=>{Or.key==="Tab"?(Or.preventDefault(),kr(zr,Or.shiftKey?"left":"right")):Or.key==="ArrowLeft"?(Or.preventDefault(),kr(zr,"left")):Or.key==="ArrowRight"?(Or.preventDefault(),kr(zr,"right")):Or.key==="ArrowUp"||Or.key==="Enter"&&Or.shiftKey?(Or.preventDefault(),kr(zr,"up")):(Or.key==="ArrowDown"||Or.key==="Enter")&&(Or.preventDefault(),kr(zr,"down"))};return n.jsx("td",{style:{...l,textAlign:"center"},children:n.jsx("input",{ref:Fr(ir),type:"text",inputMode:"decimal",disabled:Wr&&!fn,value:dr===""?"":String(dr),onChange:zr=>rr(vt.key,zr.target.value,vt.max),onFocus:zr=>zr.currentTarget.select(),onKeyDown:Ur(vt.key),style:Ue})},`${lt}-${vt.key}`)}),n.jsx("td",{style:{...l,textAlign:"center",fontWeight:700},children:_e(In??at)})]})})(),n.jsx("td",{style:{...l,textAlign:"center"},children:""}),n.jsx("td",{style:{...l,textAlign:"center"},children:""}),n.jsx("td",{style:{...l,textAlign:"center"},children:""}),n.jsx("td",{style:{...l,textAlign:"center"},children:""}),a.flatMap(ht=>n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...l,textAlign:"center"},children:""}),n.jsx("td",{style:{...l,textAlign:"center"},children:""})]},`${lt}-btl-${ht}`))]},String(ye.id??lt)))})]})})})})]})]})}function sb({subjectId:e,teachingAssignmentId:t,assessmentKey:r,viewerMode:s}){const a=r==="cia1"?{label:"CIA 1 Review",coA:1,coB:2}:r==="cia2"?{label:"CIA 2 Review",coA:3,coB:4}:{label:"MODEL Review",coA:5,coB:null};return n.jsx(Bx,{subjectId:e,teachingAssignmentId:t,assessmentKey:r,skipMarkManager:!0,floatPanelOnTable:!0,label:a.label,coA:a.coA,coB:a.coB,viewerMode:!!s,itemLabel:"Content",itemLabelPlural:"Content",itemAbbrev:"C",ciaExamAvailable:!1,absentEnabled:!0,autoSaveDraft:!0})}const iK=20,Jj={co1:10,co2:10},af={btl1:0,btl2:0,btl3:10,btl4:10,btl5:0,btl6:0},gf=10;function Va(e,t,r){return Math.max(t,Math.min(r,e))}function uo(e){return Math.round(e*10)/10}function Oi(e,t){if(e==null)return"";if(!Number.isFinite(t)||t<=0)return"0";const r=e/t*100;return`${Number.isFinite(r)?r.toFixed(0):0}`}function Px(e){if(e===""||e==null||typeof e=="string"&&e.trim()==="")return null;const t=Number(e);return Number.isFinite(t)?t:null}function of(e,t,r){const s=e==null?void 0:e.btlMax,a=(s==null?void 0:s[String(t)])??(s==null?void 0:s[`btl${t}`])??(s==null?void 0:s[t]),i=Px(a);return i??r}function oK(e){const t=Number(e);return Number.isFinite(t)&&t>0?t:gf}function lK(e,t){return`${t}_sheet_${e}`}function Zj(e){return String(e||"").trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_-]/g,"").slice(0,48)}function cK(e,t){if(!t.length)return;const r=Object.keys(t[0]),s=[r.join(",")].concat(t.map(l=>r.map(c=>{const d=l[c],u=String(d??"").replace(/\n/g," ");return u.includes(",")||u.includes('"')?`"${u.replace(/"/g,'""')}"`:u}).join(","))).join(`
`),a=new Blob([s],{type:"text/csv"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function dK(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const l=r.localeCompare(s);if(l)return l}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim(),o=a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"});return o||0}function ab(e){return e.slice(-8)}function p8({subjectId:e,teachingAssignmentId:t,label:r,assessmentKey:s="ssa1"}){var qt,lr,Mt;const a=String(r||"SSA1"),i=s==="review1",o=!1,l=v.useMemo(()=>lK(e,s),[e,s]),c=s==="review1"?og:S0,d=s==="review1"?Z6:J6,[u,h]=v.useState(null),[p,f]=v.useState(null),[x,g]=v.useState({termLabel:"KRCT AY25-26",batchLabel:e,rows:[],markManagerLocked:!1,markManagerSnapshot:null,markManagerApprovalUntil:null}),y=String((u==null?void 0:u.termLabel)||"KRCT AY25-26"),m=((qt=u==null?void 0:u.assessments)==null?void 0:qt.ssa1)||{},w=Number.isFinite(Number(m==null?void 0:m.maxTotal))?Number(m.maxTotal):iK,S=i?30:w,k={co1:Number.isFinite(Number((lr=m==null?void 0:m.coMax)==null?void 0:lr.co1))?Number(m.coMax.co1):Jj.co1,co2:Number.isFinite(Number((Mt=m==null?void 0:m.coMax)==null?void 0:Mt.co2))?Number(m.coMax.co2):Jj.co2},F=i?{co1:15,co2:15}:k,L={btl1:of(m,1,af.btl1),btl2:of(m,2,af.btl2),btl3:of(m,3,af.btl3),btl4:of(m,4,af.btl4),btl5:of(m,5,af.btl5),btl6:of(m,6,af.btl6)},C=i?30:gf,O=v.useRef(null),[T,W]=v.useState(!1);v.useEffect(()=>{let tt=!0;return(async()=>{try{const Ft=await Sl();if(!tt)return;h(Ft||null),g(Qt=>({...Qt,termLabel:String((Ft==null?void 0:Ft.termLabel)||Qt.termLabel||"KRCT AY25-26"),batchLabel:e}))}catch{}})(),()=>{tt=!1}},[e]);const[A,N]=v.useState(!1),[P,K]=v.useState(null),[re,ge]=v.useState(()=>i?[3,4]:[]),[Fe,R]=v.useState(!1),[q,me]=v.useState(!1),[fe,E]=v.useState(null),[U,I]=v.useState(null),[M,te]=v.useState(null),[Q,G]=v.useState(null),[ne,z]=v.useState(!1),[he,X]=v.useState(!1),[H,oe]=v.useState(null),[D,Y]=v.useState(!1),[le,$e]=v.useState(null),{data:je,loading:We,error:Ee,remainingSeconds:Re,publishAllowed:Ve,refresh:St}=Ru({assessment:s,subjectCode:e,teachingAssignmentId:t}),{data:rt,loading:ze,error:Ie,refresh:ot}=Bu({assessment:s,subjectCode:String(e||""),teachingAssignmentId:t,options:{poll:!1}}),{data:be}=Xo({assessment:s,subjectCode:String(e||""),scope:"MARK_MANAGER",teachingAssignmentId:t,options:{poll:!1}}),{data:we}=Xo({assessment:s,subjectCode:String(e||""),scope:"MARK_ENTRY",teachingAssignmentId:t,options:{poll:!1}}),Me=!!(je!=null&&je.global_override_active&&(je==null?void 0:je.global_is_open)===!1),[Wt,Ct]=v.useState(""),[pr,fr]=v.useState(!1),[Be,mt]=v.useState(null),[It,ft]=v.useState(null),[gr,Mr]=v.useState(!1),[$r,_r]=v.useState(null),[Vr,en]=v.useState(!1),Xr=!!Q||!!(rt!=null&&rt.exists&&(rt!=null&&rt.is_published))||!!H,Oe=!!!(e&&!gr)&&Xr,[qe,Lt]=v.useState(null);v.useEffect(()=>{Lt(null),G(null),oe(null),$e(null)},[e,s,t]);const dt=!!x.markManagerLocked,He=we!=null&&we.approval_until?String(we.approval_until):null,$t=be!=null&&be.approval_until?String(be.approval_until):null,Ue=!!(we!=null&&we.allowed_by_approval)&&!!He&&He!==((qe==null?void 0:qe.markEntryApprovalUntil)??null),er=!!(be!=null&&be.allowed_by_approval)&&!!$t&&$t!==((qe==null?void 0:qe.markManagerApprovalUntil)??null),Z=Xr?!!(rt!=null&&rt.entry_open)||Ue||er:!0,pe=!!(Xr&&!Z),ee=!!e&&(ze||!!Ie||rt==null),ue=!!(Me||ee||(rt?!rt.entry_open:Xr?!Z:!dt)),Ae=!!(Me||pe||ue),Le=x.markManagerSnapshot!=null,ct=!!(Xr&&pe&&dt),ce=v.useMemo(()=>{const tt=new Set(re);return[1,2,3,4,5,6].filter(Ft=>tt.has(Ft))},[re]),xe=v.useMemo(()=>8+ce.length*2,[ce.length,o]);v.useEffect(()=>{if(!e)return;try{const Qt=`${s}_selected_btls_${e}`;yn(Qt,re)}catch{}let tt=!1;const Ft=setTimeout(async()=>{try{await Fs(s,e,{sheet:x,selectedBtls:re});try{l&&yn(l,{termLabel:x.termLabel,batchLabel:x.batchLabel,rows:x.rows})}catch{}tt||I(new Date().toLocaleString())}catch{}},700);return()=>{tt=!0,clearTimeout(Ft)}},[re,e,x,s,l]),v.useEffect(()=>{if(!e)return;const tt=Bn(l);tt&&typeof tt=="object"&&Array.isArray(tt.rows)?g({termLabel:u!=null&&u.termLabel?String(u.termLabel):String(tt.termLabel||"KRCT AY25-26"),batchLabel:e,rows:tt.rows}):g({termLabel:y||"KRCT AY25-26",batchLabel:e,rows:[]})},[l,e,u,y]),v.useEffect(()=>{let tt=!0;return(async()=>{if(e)try{const Ft=await En(s,e);if(!tt)return;const Qt=Ft==null?void 0:Ft.draft,At=Qt==null?void 0:Qt.sheet,bt=Qt==null?void 0:Qt.selectedBtls;if(At&&typeof At=="object"&&Array.isArray(At.rows)){g(_e=>({..._e,termLabel:String(At.termLabel||y||"KRCT AY25-26"),batchLabel:e,rows:At.rows,markManagerSnapshot:(At==null?void 0:At.markManagerSnapshot)??_e.markManagerSnapshot??null,markManagerApprovalUntil:(At==null?void 0:At.markManagerApprovalUntil)??_e.markManagerApprovalUntil??null,markManagerLocked:typeof(At==null?void 0:At.markManagerLocked)=="boolean"?At.markManagerLocked:!!((At==null?void 0:At.markManagerSnapshot)??_e.markManagerSnapshot)}));const V=(Ft==null?void 0:Ft.updated_at)??null,ie=(Ft==null?void 0:Ft.updated_by)??null;if(V)try{I(new Date(String(V)).toLocaleString())}catch{I(String(V))}ie&&te(String(ie.name||ie.username||ie.id||""));try{l&&yn(l,{termLabel:String(At.termLabel||y||"KRCT AY25-26"),batchLabel:e,rows:At.rows})}catch{}}if(Array.isArray(bt)){ge(bt.map(V=>Number(V)).filter(V=>Number.isFinite(V)));try{const V=`${s}_selected_btls_${e}`;yn(V,bt.map(ie=>Number(ie)).filter(ie=>Number.isFinite(ie)))}catch{}}}catch{}})(),()=>{tt=!1}},[e,y,s,l]),v.useEffect(()=>{if(!e)return;if((!!(rt!=null&&rt.exists&&(rt!=null&&rt.is_published))||!!Q)&&(rt!=null&&rt.exists)){const At=!!(rt!=null&&rt.mark_manager_locked);!!x.markManagerLocked!==At&&g(bt=>({...bt,markManagerLocked:At}));return}const Ft=!!(be!=null&&be.allowed_by_approval),Qt=be!=null&&be.approval_until?String(be.approval_until):null;if(Ft&&Qt){if(Qt===((qe==null?void 0:qe.markManagerApprovalUntil)??null))return;const At=x.markManagerApprovalUntil?String(x.markManagerApprovalUntil):null;x.markManagerLocked&&At!==Qt&&g(bt=>({...bt,markManagerLocked:!1,markManagerApprovalUntil:Qt}));return}},[e,rt==null?void 0:rt.exists,rt==null?void 0:rt.mark_manager_locked,be==null?void 0:be.allowed_by_approval,be==null?void 0:be.approval_until,x.markManagerLocked,Q,qe==null?void 0:qe.markManagerApprovalUntil,x.markManagerApprovalUntil]);const se=tt=>{g(Ft=>{const Qt=new Map,At=new Map;for(const V of Ft.rows||[])typeof V.studentId=="number"&&Qt.set(V.studentId,V),V.registerNo&&At.set(String(V.registerNo),V);const bt=(tt||[]).slice().sort(dK).map(V=>{const ie=Qt.get(V.id)||At.get(String(V.reg_no||""));return{studentId:V.id,section:String(V.section||""),registerNo:String(V.reg_no||""),name:String(V.name||""),total:typeof(ie==null?void 0:ie.total)=="number"?Va(Number(ie.total),0,S):((ie==null?void 0:ie.total)==="","")}});return{...Ft,rows:bt}})},Se=async()=>{var tt,Ft,Qt;if(!e){K("Subject ID is required.");return}N(!0),K(null);try{let At=[],bt=null;try{const V=await wl();console.log("[SSA1] My TAs:",V==null?void 0:V.length,"for subject:",e,"teachingAssignmentId:",t),bt=(V||[]).find(ie=>{const _e=String(ie.subject_code||"").trim().toUpperCase()===String(e||"").trim().toUpperCase();return(t?ie.id===t:!1)||_e}),bt?console.log("[SSA1] Found TA match:",bt.id,"elective_subject_id:",bt.elective_subject_id,"section_id:",bt.section_id):console.log("[SSA1] No TA match found in user TAs")}catch(V){console.warn("[SSA1] My TAs fetch failed:",V)}if(bt&&bt.elective_subject_id&&!bt.section_id){console.log("[SSA1] Detected elective, fetching elective-choices for elective_subject_id:",bt.elective_subject_id);try{const V=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(bt.elective_subject_id))}`);if(V.ok){const ie=await V.json(),_e=Array.isArray(ie.results)?ie.results:Array.isArray(ie)?ie:ie.items||[];console.log("[SSA1] Elective choices returned:",_e==null?void 0:_e.length,"students"),At=(_e||[]).map(Je=>({id:Number(Je.student_id??Je.id),reg_no:String(Je.reg_no??Je.regno??""),name:String(Je.name??Je.full_name??Je.username??""),section:Je.section_name??Je.section??null}))}else console.warn("[SSA1] Elective-choices API returned error:",V.status)}catch(V){console.warn("[SSA1] Elective-choices fetch failed:",V)}}if(!At.length&&bt&&bt.id){console.log("[SSA1] Fetching regular TA roster for TA ID:",bt.id);try{const V=await Jo(bt.id);At=V.students||[],f({courseName:String(((tt=V==null?void 0:V.teaching_assignment)==null?void 0:tt.subject_name)||(bt==null?void 0:bt.subject_name)||""),courseCode:String(((Ft=V==null?void 0:V.teaching_assignment)==null?void 0:Ft.subject_code)||(bt==null?void 0:bt.subject_code)||e||""),className:String(((Qt=V==null?void 0:V.teaching_assignment)==null?void 0:Qt.section_name)||(bt==null?void 0:bt.section_name)||"")}),console.log("[SSA1] Regular roster returned:",At.length,"students")}catch(V){console.warn("[SSA1] TA roster fetch failed:",V)}}console.log("[SSA1] Final roster count:",At.length),se(At)}catch(At){K((At==null?void 0:At.message)||"Failed to load roster")}finally{N(!1)}};v.useEffect(()=>{e&&Se()},[t,e]);async function Ze(tt){if(e){tt&&Y(!0),$e(null);try{const Ft=await c(String(e));oe(Ft||null)}catch(Ft){tt&&$e((Ft==null?void 0:Ft.message)||`Failed to load published ${a} marks`)}finally{tt&&Y(!1)}}}v.useEffect(()=>{e&&Ze(!1)},[e,s,t]);const et=v.useRef(!!Z);v.useEffect(()=>{et.current=!!Z},[e,s,t,Z]),v.useEffect(()=>{if(!e||!Xr)return;if(et.current||!Z){et.current=!!Z;return}let Ft=!0;return(async()=>{try{const Qt=await En(s,String(e));if(!Ft)return;const At=Qt==null?void 0:Qt.draft,bt=At==null?void 0:At.sheet,V=At==null?void 0:At.selectedBtls;bt&&typeof bt=="object"&&Array.isArray(bt.rows)&&g(ie=>({...ie,termLabel:String(bt.termLabel||y||"KRCT AY25-26"),batchLabel:e,rows:bt.rows,markManagerSnapshot:(bt==null?void 0:bt.markManagerSnapshot)??ie.markManagerSnapshot??null,markManagerApprovalUntil:(bt==null?void 0:bt.markManagerApprovalUntil)??ie.markManagerApprovalUntil??null,markManagerLocked:typeof(bt==null?void 0:bt.markManagerLocked)=="boolean"?bt.markManagerLocked:!!((bt==null?void 0:bt.markManagerSnapshot)??ie.markManagerSnapshot)})),Array.isArray(V)&&ge(V.map(ie=>Number(ie)).filter(ie=>Number.isFinite(ie)));return}catch{}Ft&&Ze(!1)})(),et.current=!!Z,()=>{Ft=!1}},[Z,Xr,e,s,y]),v.useEffect(()=>{if(!e||!Xr||Z)return;const tt=window.setInterval(()=>{ot({silent:!0})},3e4);return()=>window.clearInterval(tt)},[Z,Xr,e,ot]),v.useEffect(()=>{he&&e&&(oe(null),Ze(!0))},[he,e]);const Et=async()=>{R(!0),E(null);try{await Fs(s,e,{sheet:x,selectedBtls:re}),I(new Date().toLocaleString())}catch(tt){E((tt==null?void 0:tt.message)||`Failed to save ${a} draft`)}finally{R(!1)}},wt=async()=>{if(e){if(Me){E("Publishing is locked by IQAC.");return}if(!Ve){E("Publish window is closed. Please request IQAC approval.");return}if(Xr&&pe){z(!0);return}me(!0),E(null);try{await d(e,x,t),G(new Date().toLocaleString()),Lt({markEntryApprovalUntil:He,markManagerApprovalUntil:$t}),g(tt=>({...tt,markManagerLocked:!0})),St(),ot({silent:!0}),Ze(!1);try{console.debug("obe:published dispatch",{assessment:s,subjectId:e}),window.dispatchEvent(new CustomEvent("obe:published",{detail:{subjectId:e,assessment:s}}))}catch{}}catch(tt){E((tt==null?void 0:tt.message)||`Failed to publish ${a}`)}finally{me(!1)}}},gt=async()=>{fr(!0),mt(null),E(null);try{await w0({assessment:s,subject_code:e,reason:Wt,teaching_assignment_id:t}),mt("Request sent to IQAC for approval.")}catch(tt){E((tt==null?void 0:tt.message)||"Failed to request approval")}finally{fr(!1),St()}};function zt(tt){return JSON.stringify({maxTotal:S,coMax:F,selectedBtls:re.slice(),btlMax:L})}async function Dt(){if(e){Mr(!0),_r(null);try{await Yi({assessment:s,subject_code:String(e),scope:"MARK_MANAGER",reason:`Edit request: Mark Manager changes for ${a} ${e}`,teaching_assignment_id:t}),alert("Edit request sent to IQAC.")}catch(tt){_r((tt==null?void 0:tt.message)||"Request failed"),alert((tt==null?void 0:tt.message)||"Request failed")}finally{Mr(!1)}}}async function mr(){if(e)try{await Yi({assessment:s,subject_code:String(e),scope:"MARK_ENTRY",reason:`Edit request: ${a} marks entry for ${e}`,teaching_assignment_id:t}),alert("Edit request sent to IQAC."),ot({silent:!0})}catch(tt){alert((tt==null?void 0:tt.message)||"Request failed")}}async function pt(){if(e){Mr(!0),_r(null);try{const tt=zt(x),Ft=be!=null&&be.approval_until?String(be.approval_until):x.markManagerApprovalUntil||null,Qt={...x,markManagerLocked:!0,markManagerSnapshot:tt,markManagerApprovalUntil:Ft},At={sheet:Qt,selectedBtls:re};g(Qt),ft(null),en(!0),await Fs(s,String(e),At),I(new Date().toLocaleString());try{await kd(s,String(e),t),ot({silent:!0})}catch(bt){console.warn("confirmMarkManagerLock failed",bt)}}catch(tt){_r((tt==null?void 0:tt.message)||"Save failed")}finally{Mr(!1),setTimeout(()=>en(!1),2e3)}}}const Xt=()=>{confirm(`Reset ${a} marks for all students in this section?`)&&(ue||g(tt=>({...tt,rows:(tt.rows||[]).map(Ft=>({...Ft,total:""}))})))},Rt=(tt,Ft)=>{g(Qt=>{const At=Qt.rows.slice(),bt=At[tt]||{studentId:0,section:"",registerNo:"",name:"",total:""};return At[tt]={...bt,...Ft},{...Qt,rows:At}})},_t=()=>{const tt=x.rows.map((Ft,Qt)=>{const At=typeof Ft.total=="number"?Va(Number(Ft.total),0,S):null,bt=At==null?"":uo(At),ie=At==null?null:uo(At/2),_e=ie==null?null:Va(ie,0,F.co1),Je=ie==null?null:Va(ie,0,F.co2),Nt=ce.map(Nr=>Nr-1),jt=[L.btl1,L.btl2,L.btl3,L.btl4,L.btl5,L.btl6].map((Nr,Pt)=>Nt.includes(Pt)?i?C:Nr>0?Nr:gf:Nr),cr=At==null?null:Nt.length?uo(At/Nt.length):0,sr=jt.map((Nr,Pt)=>At==null||!Nt.includes(Pt)?null:Nr>0?Va(cr,0,Nr):uo(cr)),Fr={sno:Qt+1,registerNo:Ft.registerNo,name:Ft.name,co1_mark:_e??"",co1_pct:Oi(_e,F.co1),co2_mark:Je??"",co2_pct:Oi(Je,F.co2),btl1_mark:sr[0]??"",btl1_pct:Oi(sr[0],jt[0]),btl2_mark:sr[1]??"",btl2_pct:Oi(sr[1],jt[1]),btl3_mark:sr[2]??"",btl3_pct:Oi(sr[2],jt[2]),btl4_mark:sr[3]??"",btl4_pct:Oi(sr[3],jt[3]),btl5_mark:sr[4]??"",btl5_pct:Oi(sr[4],jt[4]),btl6_mark:sr[5]??"",btl6_pct:Oi(sr[5],jt[5])};return Fr[a]=bt,Fr});cK(`${e}_${Zj(a)||"SSA1"}_sheet.csv`,tt)},jr=()=>{if(!x.rows.length)return;const tt=Number.isFinite(Number(F.co1))?Number(F.co1):0,Ft=Number.isFinite(Number(F.co2))?Number(F.co2):0,Qt=["Register No","Student Name",`Q1 (${tt.toFixed(2)})`,`Q2 (${Ft.toFixed(2)})`,"Status"],At=x.rows.map(_e=>[_e.registerNo,_e.name,"","","present"]),bt=gi.aoa_to_sheet([Qt,...At]);bt["!freeze"]={xSplit:0,ySplit:1};const V=gi.book_new();gi.book_append_sheet(V,bt,a||"SSA1");const ie=`${e}_${Zj(a)||"SSA1"}_template.xlsx`;vg(V,ie)},Gr=async()=>{const tt=x.rows.map((Ft,Qt)=>({sno:Qt+1,regNo:String(Ft.registerNo||""),name:String(Ft.name||""),total:Ft.total===""?"":Number(Ft.total)}));await Qp({filenameBase:`${e}_${a}`,meta:{courseName:(p==null?void 0:p.courseName)||"",courseCode:(p==null?void 0:p.courseCode)||e,className:(p==null?void 0:p.className)||""},rows:tt})};function Cr(tt){return String(tt??"").trim().toLowerCase().replace(/\s+/g," ")}const Rr=()=>{var tt;ue||(tt=O.current)==null||tt.click()},De=async tt=>{var Ft;if(tt){W(!0);try{const Qt=await tt.arrayBuffer(),At=u0(Qt,{type:"array"}),bt=(Ft=At.SheetNames)==null?void 0:Ft[0];if(!bt)throw new Error("No sheet found in the Excel file.");const V=At.Sheets[bt],ie=gi.sheet_to_json(V,{header:1});if(!ie.length)throw new Error("Excel sheet is empty.");const _e=(ie[0]||[]).map(Cr),Je=Ot=>_e.findIndex(Tr=>Ot(Tr)),Nt=Je(Ot=>Ot==="register no"||Ot==="reg no"||Ot.includes("register")),Bt=Je(Ot=>Ot.startsWith("q1")),jt=Je(Ot=>Ot.startsWith("q2")),cr=Je(Ot=>Ot==="total"||Ot.includes("total")),sr=Je(Ot=>Ot==="status"||Ot.includes("status"));if(Nt<0)throw new Error("Could not find Register No column.");const Fr=Number.isFinite(Number(F.co1))?Number(F.co1):0,Nr=Number.isFinite(Number(F.co2))?Number(F.co2):0,Pt=new Map;x.rows.forEach((Ot,Tr)=>{const vr=String(Ot.registerNo||"").trim();vr&&Pt.set(vr,Tr);const ye=ab(vr);ye&&Pt.set(ye,Tr)}),g(Ot=>{const Tr=Ot.rows.slice();for(let vr=1;vr<ie.length;vr++){const ye=ie[vr]||[],lt=String(ye[Nt]??"").trim();if(!lt)continue;const ht=Pt.get(lt);if(ht==null)continue;const Wr=(sr>=0?String(ye[sr]??""):"").trim().toLowerCase(),Yr=Wr==="absent"||Wr==="ab"||Wr==="a",fn=Bt>=0?Px(ye[Bt]):null,In=jt>=0?Px(ye[jt]):null,Ye=cr>=0?Px(ye[cr]):null,st=fn==null?0:Va(fn,0,Fr),at=In==null?0:Va(In,0,Nr),nt=Ye??st+at,xt=Yr?0:Va(nt,0,S);Tr[ht]={...Tr[ht],total:uo(xt)}}return{...Ot,rows:Tr}})}finally{W(!1)}}},Ke=async tt=>{var Qt;const Ft=(Qt=tt.target.files)==null?void 0:Qt[0];if(tt.target.value="",!!Ft)try{await De(Ft)}catch(At){alert((At==null?void 0:At.message)||"Failed to import Excel")}},Ce={border:"1px solid #e5e7eb",padding:"6px 6px",background:"#f8fafc",color:"#334155",textAlign:"center",fontWeight:700,fontSize:12,whiteSpace:"nowrap"},it={border:"1px solid #eef2f7",padding:"6px 6px",fontSize:12,color:"#0f172a",whiteSpace:"nowrap",transition:"background-color 120ms ease"},tr={width:"100%",border:"1px solid #cbd5e1",outline:"none",background:"transparent",borderRadius:10,padding:"6px 8px",fontSize:12},Kt={display:"inline-flex",alignItems:"center",gap:6,padding:"6px 10px",border:"1px solid #cbd5e1",borderRadius:999,background:"#fff",cursor:"pointer",userSelect:"none",fontSize:12},yt={border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},Ht=tt=>{if(Me||gr)return;const Ft=x.markManagerSnapshot!=null;dt&&Ft||ge(Qt=>Qt.includes(tt)?Qt.filter(At=>At!==tt):Qt.concat(tt).sort((At,bt)=>At-bt))};return n.jsxs("div",{children:[n.jsxs("div",{style:{background:"linear-gradient(90deg, rgba(224,242,254,0.65) 0%, rgba(240,249,255,0.9) 100%)",border:"1px solid #bae6fd",borderRadius:16,padding:16,marginBottom:14},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{onClick:Se,className:"obe-btn obe-btn-secondary",disabled:A,children:A?"Loading roster":"Load/Refresh Roster"}),n.jsx("button",{onClick:Xt,className:"obe-btn obe-btn-danger",disabled:!x.rows.length,children:"Reset Marks"}),n.jsx("button",{onClick:_t,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length,children:"Export CSV"}),n.jsx("button",{onClick:jr,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length,children:"Export Excel"}),n.jsx("button",{onClick:Rr,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length||ue||T,children:T?"Importing":"Import Excel"}),n.jsx("input",{ref:O,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:Ke})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[n.jsx("button",{onClick:Gr,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length,children:"Download"}),n.jsx("button",{onClick:Et,className:"obe-btn obe-btn-success",disabled:Fe||ue,title:ue?"Table locked  confirm Mark Manager to enable actions":void 0,children:Fe?"Saving":"Save Draft"}),n.jsx("button",{onClick:wt,className:"obe-btn obe-btn-primary",disabled:q||!Ve||ue,title:ue?"Table locked  confirm Mark Manager to enable actions":void 0,children:q?"Publishing":"Publish"})]})]}),n.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{style:yt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Term"}),n.jsx("div",{style:{fontWeight:700},children:x.termLabel||""})]}),n.jsxs("div",{style:yt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Batch"}),n.jsx("div",{style:{fontWeight:700},children:x.batchLabel||""})]}),n.jsxs("div",{style:yt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Saved"}),n.jsx("div",{style:{fontWeight:700},children:U||""}),M?n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["by ",n.jsx("span",{style:{color:"#0369a1",fontWeight:700},children:M})]}):null]}),n.jsxs("div",{style:yt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Published"}),n.jsx("div",{style:{fontWeight:700},children:Q||""})]})]}),n.jsx("div",{style:{marginTop:10,fontSize:12,color:Ve?"#065f46":"#b91c1c"},children:We?"Checking publish due time":Ee||(je!=null&&je.due_at?n.jsxs(n.Fragment,{children:["Due: ",new Date(je.due_at).toLocaleString(),"  Remaining: ",_0(Re),je.allowed_by_approval&&je.approval_until?n.jsxs(n.Fragment,{children:["  Approved until ",new Date(je.approval_until).toLocaleString()]}):null]}):"Due time not set by IQAC.")}),Me?n.jsxs("div",{style:{marginTop:10,border:"1px solid #fde68a",background:"#fffbeb",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publishing disabled by IQAC"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Global publishing is turned OFF for this assessment. You can view the sheet, but editing and publishing are locked."}),n.jsx("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:10},children:n.jsx("button",{className:"obe-btn",onClick:()=>St(),disabled:We,children:"Refresh"})})]}):Ve?null:n.jsxs("div",{style:{marginTop:10,border:"1px solid #fecaca",background:"#fff7ed",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publish time is over"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:8},children:"Send a request to IQAC to approve publishing."}),n.jsx("textarea",{value:Wt,onChange:tt=>Ct(tt.target.value),placeholder:"Reason (optional)",rows:3,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical"}}),n.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:10},children:[n.jsx("button",{className:"obe-btn",onClick:()=>St(),disabled:pr||We,children:"Refresh"}),n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:gt,disabled:pr,children:pr?"Requesting":"Request Approval"})]}),Be?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#065f46"},children:Be}):null]}),he?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:70},onClick:()=>X(!1),children:n.jsxs("div",{style:{width:"min(1100px, 96vw)",maxHeight:"min(80vh, 900px)",overflow:"auto",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:tt=>tt.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsxs("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:["View Published ",a]}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:a}),n.jsx("button",{onClick:tt=>{tt.stopPropagation(),X(!1)},"aria-label":"Close",style:{marginLeft:8,border:"none",background:"transparent",fontSize:20,lineHeight:1,cursor:"pointer"},children:""})]}),D?n.jsx("div",{style:{color:"#6b7280",marginBottom:8},children:"Loading published marks"}):null,le?n.jsx("div",{style:{color:"#b91c1c",marginBottom:8},children:le}):null,n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12,background:"#fff"},children:n.jsxs("table",{style:{borderCollapse:"collapse",minWidth:920},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Ce,colSpan:xe,children:[x.termLabel," | ",x.batchLabel," | ",a]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...Ce,width:42,minWidth:42},rowSpan:4,children:"S.No"}),n.jsx("th",{style:Ce,rowSpan:4,children:"Register No."}),n.jsx("th",{style:Ce,rowSpan:3,children:"Name of the Students"}),n.jsx("th",{style:Ce,children:a}),null,n.jsx("th",{style:Ce,colSpan:4,children:"CO ATTAINMENT"}),ce.length?n.jsx("th",{style:Ce,colSpan:ce.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[n.jsxs("th",{style:Ce,children:[n.jsx("div",{style:{fontWeight:800},children:"COs"}),n.jsx("div",{style:{fontSize:12},children:"1,2"})]}),null,n.jsx("th",{style:Ce,colSpan:2,children:"CO-1"}),n.jsx("th",{style:Ce,colSpan:2,children:"CO-2"}),ce.map(tt=>n.jsxs("th",{style:Ce,colSpan:2,children:["BTL-",tt]},`btl-head-${tt}`))]}),n.jsxs("tr",{children:[n.jsxs("th",{style:Ce,children:[n.jsx("div",{style:{fontWeight:800},children:"BTL"}),n.jsx("div",{style:{fontSize:12},children:ce.length?ce.join(","):"-"})]}),null,Array.from({length:2+ce.length}).flatMap((tt,Ft)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Ce,children:"Mark"}),n.jsx("th",{style:Ce,children:"%"})]},Ft))]}),n.jsxs("tr",{children:[n.jsx("th",{style:Ce,children:"Name / Max Marks"}),n.jsx("th",{style:Ce,children:S}),null,n.jsx("th",{style:Ce,children:F.co1}),n.jsx("th",{style:Ce,children:"%"}),n.jsx("th",{style:Ce,children:F.co2}),n.jsx("th",{style:Ce,children:"%"}),ce.flatMap(tt=>[n.jsx("th",{style:Ce,children:String(i?C:Math.max(Number(L[`btl${tt}`]??0)||0,gf))},`btl-max-${tt}`),n.jsx("th",{style:Ce,children:"%"},`btl-pct-${tt}`)])]})]}),n.jsx("tbody",{children:x.rows.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:xe,style:{padding:14,color:"#6b7280",fontSize:13},children:"No students loaded yet. Choose a Teaching Assignment above, then click Load/Refresh Roster."})}):x.rows.map((tt,Ft)=>{var sr;const Qt=((sr=H==null?void 0:H.marks)==null?void 0:sr[String(tt.studentId)])??null,At=Qt==null||Qt===""?null:Va(Number(Qt),0,S),V=At==null?null:uo(At/2),ie=V==null?null:Va(V,0,F.co1),_e=V==null?null:Va(V,0,F.co2),Je=ce.map(Fr=>Fr-1),Bt=[L.btl1,L.btl2,L.btl3,L.btl4,L.btl5,L.btl6].map((Fr,Nr)=>Je.includes(Nr)?i?C:Fr>0?Fr:gf:Fr),jt=At==null?null:Je.length?uo(At/Je.length):0,cr=Bt.map((Fr,Nr)=>At==null||!Je.includes(Nr)?null:Fr>0?Va(jt,0,Fr):uo(jt));return n.jsxs("tr",{style:{background:Ft%2===1?"#f8fafc":"#fff"},children:[n.jsx("td",{style:{...it,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:Ft+1}),n.jsx("td",{style:it,children:ab(tt.registerNo)}),n.jsx("td",{style:it,children:tt.name}),n.jsx("td",{style:{...it,width:90,background:"#fff7ed",textAlign:"right"},children:At==null?"":uo(At)}),null,n.jsx("td",{style:{...it,textAlign:"right"},children:ie??""}),n.jsx("td",{style:{...it,textAlign:"right"},children:Oi(ie,F.co1)}),n.jsx("td",{style:{...it,textAlign:"right"},children:_e??""}),n.jsx("td",{style:{...it,textAlign:"right"},children:Oi(_e,F.co2)}),ce.map(Fr=>{const Nr=Fr-1,Pt=cr[Nr],Ot=Bt[Nr];return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...it,textAlign:"right"},children:Pt??""}),n.jsx("td",{style:{...it,textAlign:"right"},children:Oi(Pt,Ot)})]},Fr)})]},String(tt.studentId||Ft))})})]})}),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:n.jsx("button",{className:"obe-btn",onClick:()=>X(!1),children:"Close"})})]})}):null,(P||fe)&&n.jsx("div",{style:{marginTop:10,color:"#b91c1c",fontSize:13},children:P||fe})]}),n.jsxs("div",{style:{marginTop:12,...yt},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("div",{style:{fontWeight:800},children:"Mark Manager"}),n.jsx("div",{children:n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>{const tt=x.markManagerSnapshot!=null;ft({mode:tt?"request":"confirm"})},disabled:!e||gr,children:x.markManagerSnapshot?"Edit":"Save"})})]}),n.jsxs("div",{style:{marginTop:8,fontSize:13,color:"#6b7280"},children:[n.jsxs("div",{children:["Max ",a,": ",n.jsx("strong",{style:{color:"#111"},children:S})]}),n.jsxs("div",{children:["CO-1 max: ",n.jsx("strong",{style:{color:"#111"},children:F.co1}),"  CO-2 max: ",n.jsx("strong",{style:{color:"#111"},children:F.co2})]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Selected BTLs:"}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[1,2,3,4,5,6].map(tt=>{const Ft=re.includes(tt),Qt=!!(dt&&x.markManagerSnapshot!=null);return n.jsxs("div",{onClick:()=>Ht(tt),style:{...Kt,borderColor:Ft?"#16a34a":"#cbd5e1",background:Ft?"#ecfdf5":"#fff",cursor:Qt||gr?"not-allowed":"pointer",opacity:Qt?.6:1,padding:"6px 8px"},"aria-disabled":Qt||gr,children:[n.jsx("input",{type:"checkbox",checked:Ft,readOnly:!0,style:{marginRight:6}}),n.jsxs("span",{style:{fontWeight:800},children:["BTL",tt]})]},`card_btl_${tt}`)})})]})]}),$r?n.jsx("div",{style:{marginTop:8,color:"#991b1b"},children:$r}):null]}),n.jsx("div",{style:{marginTop:14},children:Le?n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12,background:"linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9))",backdropFilter:"blur(10px)",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"},children:n.jsx(k0,{locked:!!(Me||pe||Xr&&ee),title:Me?"Locked by IQAC":Oe?"Published  Locked":"Table Locked",subtitle:Me?"Publishing is turned OFF globally for this assessment.":Oe?"Marks are published. Request IQAC approval to edit.":"Confirm the Mark Manager",children:n.jsxs("table",{style:{borderCollapse:"collapse",minWidth:920},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:Ce,colSpan:xe,children:[x.termLabel," | ",x.batchLabel," | ",a]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...Ce,width:42,minWidth:42},rowSpan:4,children:"S.No"}),n.jsx("th",{style:Ce,rowSpan:4,children:"Register No."}),n.jsx("th",{style:Ce,rowSpan:3,children:"Name of the Students"}),n.jsx("th",{style:Ce,children:a}),null,n.jsx("th",{style:Ce,colSpan:4,children:"CO ATTAINMENT"}),ce.length?n.jsx("th",{style:Ce,colSpan:ce.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[n.jsxs("th",{style:Ce,children:[n.jsx("div",{style:{fontWeight:800},children:"COs"}),n.jsx("div",{style:{fontSize:12},children:"1,2"})]}),null,n.jsx("th",{style:Ce,colSpan:2,children:"CO-1"}),n.jsx("th",{style:Ce,colSpan:2,children:"CO-2"}),ce.map(tt=>n.jsxs("th",{style:Ce,colSpan:2,children:["BTL-",tt]},`btl-head-${tt}`))]}),n.jsxs("tr",{children:[n.jsxs("th",{style:Ce,children:[n.jsx("div",{style:{fontWeight:800},children:"BTL"}),n.jsx("div",{style:{fontSize:12},children:ce.length?ce.join(","):"-"})]}),null,Array.from({length:2+ce.length}).flatMap((tt,Ft)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:Ce,children:"Mark"}),n.jsx("th",{style:Ce,children:"%"})]},Ft))]}),n.jsxs("tr",{children:[n.jsx("th",{style:Ce,children:"Name / Max Marks"}),n.jsx("th",{style:Ce,children:S}),null,n.jsx("th",{style:Ce,children:F.co1}),n.jsx("th",{style:Ce,children:"%"}),n.jsx("th",{style:Ce,children:F.co2}),n.jsx("th",{style:Ce,children:"%"}),ce.flatMap(tt=>[n.jsx("th",{style:Ce,children:String(i?C:oK(L[`btl${tt}`]))},`btl-max-${tt}`),n.jsx("th",{style:Ce,children:"%"},`btl-pct-${tt}`)])]})]}),n.jsx("tbody",{children:x.rows.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:xe,style:{padding:14,color:"#6b7280",fontSize:13},children:"No students loaded yet. Choose a Teaching Assignment above, then click Load/Refresh Roster."})}):ue&&!pe?n.jsx("tr",{children:n.jsx("td",{colSpan:xe,style:{padding:20,textAlign:"center",color:"#065f46",fontWeight:900},children:"Table locked  confirm the Mark Manager to enable student marks"})}):x.rows.map((tt,Ft)=>{const Qt=typeof tt.total=="number"?Va(Number(tt.total),0,S):null,At=Qt==null?null:uo(Qt/2),bt=At==null?null:Va(At,0,F.co1),V=At==null?null:Va(At,0,F.co2),ie=ce.map(jt=>jt-1),Je=[L.btl1,L.btl2,L.btl3,L.btl4,L.btl5,L.btl6].map((jt,cr)=>ie.includes(cr)?i?C:jt>0?jt:gf:jt),Nt=Qt==null?null:ie.length?uo(Qt/ie.length):0,Bt=Je.map((jt,cr)=>Qt==null||!ie.includes(cr)?null:jt>0?Va(Nt,0,jt):uo(Nt));return n.jsxs("tr",{style:{background:Ft%2===1?"#f8fafc":"#fff"},children:[n.jsx("td",{style:{...it,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:Ft+1}),n.jsx("td",{style:it,children:ab(tt.registerNo)}),n.jsx("td",{style:it,children:tt.name}),n.jsx("td",{style:{...it,width:90,background:"#fff7ed"},children:Ae?n.jsx("div",{style:{...tr,textAlign:"right",paddingRight:4},children:typeof tt.total=="number"?uo(tt.total):""}):n.jsx("input",{style:tr,type:"number",value:tt.total,min:0,max:S,onChange:jt=>{if(Ae)return;const cr=jt.target.value;if(cr==="")return Rt(Ft,{total:""});const sr=Number(cr);if(!Number.isFinite(sr))return Rt(Ft,{total:""});if(sr>S){jt.currentTarget.setCustomValidity(`Max mark is ${S}`),jt.currentTarget.reportValidity(),window.setTimeout(()=>jt.currentTarget.setCustomValidity(""),0);return}jt.currentTarget.setCustomValidity("");const Fr=Va(sr,0,S);Rt(Ft,{total:Fr})}})}),null,n.jsx("td",{style:{...it,textAlign:"right"},children:bt??""}),n.jsx("td",{style:{...it,textAlign:"right"},children:Oi(bt,F.co1)}),n.jsx("td",{style:{...it,textAlign:"right"},children:V??""}),n.jsx("td",{style:{...it,textAlign:"right"},children:Oi(V,F.co2)}),ce.map(jt=>{const cr=jt-1,sr=Bt[cr],Fr=Je[cr];return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...it,textAlign:"right"},children:sr??""}),n.jsx("td",{style:{...it,textAlign:"right"},children:Oi(sr,Fr)})]},jt)})]},String(tt.studentId||Ft))})})]})})}):n.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:20,background:"linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9))",backdropFilter:"blur(10px)",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"},children:n.jsxs("div",{style:{display:"grid",placeItems:"center",padding:40},children:[n.jsx("div",{style:{fontSize:40},children:""}),n.jsx("div",{style:{fontWeight:800,fontSize:16,marginTop:8},children:Oe?"Published  Locked":"Table Locked"}),n.jsx("div",{style:{color:"#6b7280",marginTop:6},children:Oe?"Marks published. Use View to inspect or Request Edit to ask IQAC for edit access.":"Confirm the Mark Manager to unlock the student list."}),n.jsx("div",{style:{display:"flex",gap:8,marginTop:12},children:Oe?n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn",onClick:()=>X(!0),children:"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>z(!0),children:"Request Edit"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>ft({mode:"confirm"}),disabled:!e||gr,children:"Save Mark Manager"}),n.jsx("button",{className:"obe-btn",onClick:()=>Dt(),disabled:gr,children:"Request Access"})]})})]})})}),n.jsx("style",{children:`
        @keyframes markManagerGlitch {
          0%, 100% { transform: translate(0,0); filter: none; }
          10% { transform: translate(-2px, 1px); }
          20% { transform: translate(2px, -1px); }
          30% { transform: translate(-1px, -2px); }
          40% { transform: translate(1px, 2px); }
          50% { transform: translate(-2px, -1px); }
          60% { transform: translate(2px, 1px); }
          70% { transform: translate(-1px, 1px); }
          80% { transform: translate(1px, -1px); }
          90% { transform: translate(-1px, 0); }
        }
        @keyframes markManagerDust {
          0% { opacity: 0.9; transform: translate(0,0) scale(1); }
          100% { opacity: 0; transform: translate(80px, -40px) scale(0.6); }
        }
        .markManagerDustParticle {
          position: absolute;
          width: 4px;
          height: 4px;
          background: #d1d5db;
          border-radius: 50%;
          animation: markManagerDust 2s ease-out forwards;
        }

        /* SSA table modern look (UI-only) */
        table tbody tr:hover td {
          background: rgba(15, 23, 42, 0.03);
        }
      `}),n.jsxs("div",{style:{position:"relative"},children:[dt?null:n.jsx("div",{style:{position:"absolute",inset:0,zIndex:30,pointerEvents:"none",background:"linear-gradient(180deg, rgba(72, 113, 195, 0.18) 0%, rgba(51, 55, 64, 0.22) 100%)"}}),ct&&Le?n.jsx("div",{style:{position:"absolute",inset:0,zIndex:30,pointerEvents:"auto",background:"linear-gradient(180deg, rgba(34,197,94,0.28) 0%, rgba(16,185,129,0.36) 100%)"}}):null,dt?null:n.jsxs("div",{style:{position:"absolute",left:"50%",top:6,transform:"translateX(-50%)",zIndex:40,width:160,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:10,borderRadius:12,display:"flex",flexDirection:"column",gap:8,alignItems:"center",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"},children:[n.jsx("div",{style:{width:100,height:72,display:"grid",placeItems:"center",background:"#fff",borderRadius:8},children:n.jsx("img",{src:"https://media.lordicon.com/icons/wired/flat/94-lock-unlock.gif",alt:"locked",style:{maxWidth:72,maxHeight:72,display:"block"}})}),n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontWeight:800,color:"#111827"},children:"Table Locked"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Confirm the Mark Manager"})]})]}),ct&&Le?n.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:40,width:360,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:10,borderRadius:12,display:"flex",flexDirection:"column",gap:8,alignItems:"center",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"},children:[n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontWeight:900,color:"#065f46"},children:"Published"}),n.jsx("div",{style:{fontSize:13,color:"#065f46"},children:"Marks are locked. Request IQAC approval to edit."})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[n.jsx("button",{className:"obe-btn",onClick:()=>X(!0),children:"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>z(!0),children:"Request Edit"})]})]}):null]}),It?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:9999},onClick:()=>{gr||ft(null)},children:n.jsxs("div",{style:{width:"min(640px,96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:tt=>tt.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:It.mode==="confirm"?`Confirmation - ${a}`:`Request Edit - ${a}`}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:a})]}),It.mode==="confirm"?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"Confirm the selected settings. After confirming, Mark Manager will be applied and table will be editable."}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f9fafb"},children:[n.jsx("th",{style:{textAlign:"left",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Item"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Value"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:["Max ",a]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:S})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"CO-1 max"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:F.co1})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"CO-2 max"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:F.co2})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"Selected BTLs"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[1,2,3,4,5,6].map(tt=>{const Ft=re.includes(tt);return n.jsxs("div",{onClick:()=>ge(Qt=>Qt.includes(tt)?Qt.filter(At=>At!==tt):[...Qt,tt].sort((At,bt)=>At-bt)),style:{...Kt,borderColor:Ft?"#16a34a":"#cbd5e1",background:Ft?"#ecfdf5":"#fff",cursor:gr?"not-allowed":"pointer",padding:"6px 8px"},children:[n.jsx("input",{type:"checkbox",checked:Ft,readOnly:!0,style:{marginRight:6}}),n.jsxs("span",{style:{fontWeight:800},children:["BTL",tt]})]},`modal_btl_${tt}`)})})})]})]})]})})]}):n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"This will send an edit request to IQAC. Mark Manager will remain locked until IQAC approves."}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[n.jsx("button",{className:"obe-btn",disabled:gr,onClick:()=>ft(null),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:gr||!e,onClick:async()=>{if(e){if(It.mode==="request"){ft(null),await Dt();return}await pt()}},children:It.mode==="confirm"?"Confirm":"Send Request"})]})]})}):null,ne?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>z(!1),children:n.jsxs("div",{style:{width:"min(560px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:tt=>tt.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"Edit Request"}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:a})]}),n.jsxs("div",{style:{fontSize:13,color:"#374151",marginBottom:10,lineHeight:1.35},children:[n.jsxs("div",{children:[n.jsx("strong",{children:"Subject:"})," ",String(e||"")]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Published:"})," ",Q||""]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Saved:"})," ",U||""]})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[n.jsx("button",{type:"button",className:"obe-btn",onClick:()=>z(!1),children:"Close"}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-primary",onClick:async()=>{await mr(),z(!1)},children:"Request Edit"})]})]})}):null]})}function uK({subjectId:e,teachingAssignmentId:t,label:r}){return n.jsx(p8,{subjectId:e,teachingAssignmentId:t,assessmentKey:"review1",label:r||"Review 1"})}const fK=20,e4={co3:10,co4:10},lf={btl1:0,btl2:0,btl3:10,btl4:10,btl5:0,btl6:0},cf=10;function Ga(e,t,r){return Math.max(t,Math.min(r,e))}function fo(e){return Math.round(e*10)/10}function Ii(e,t){if(e==null)return"";if(!Number.isFinite(t)||t<=0)return"0";const r=e/t*100;return`${Number.isFinite(r)?r.toFixed(0):0}`}function Ox(e){if(e===""||e==null||typeof e=="string"&&e.trim()==="")return null;const t=Number(e);return Number.isFinite(t)?t:null}function df(e,t,r){const s=e==null?void 0:e.btlMax,a=(s==null?void 0:s[String(t)])??(s==null?void 0:s[`btl${t}`])??(s==null?void 0:s[t]),i=Ox(a);return i??r}function hK(e,t){return`${t}_sheet_${e}`}function t4(e){return String(e||"").trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_-]/g,"").slice(0,48)}function pK(e,t){if(!t.length)return;const r=Object.keys(t[0]),s=[r.join(",")].concat(t.map(l=>r.map(c=>{const d=l[c],u=String(d??"").replace(/\n/g," ");return u.includes(",")||u.includes('"')?`"${u.replace(/"/g,'""')}"`:u}).join(","))).join(`
`),a=new Blob([s],{type:"text/csv"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function mK(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const l=r.localeCompare(s);if(l)return l}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim(),o=a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"});return o||0}function rx(e){return e.slice(-8)}function m8({subjectId:e,teachingAssignmentId:t,label:r,assessmentKey:s="ssa2"}){var tt,Ft,Qt,At,bt;const a=String(r||"SSA2"),i=s==="review2",o=!1,l=v.useMemo(()=>hK(e,s),[e,s]),c=s==="review2"?lg:Op,d=s==="review2"?tA:eA,[u,h]=v.useState(null),[p,f]=v.useState(null),[x,g]=v.useState({termLabel:"KRCT AY25-26",batchLabel:e,rows:[],markManagerLocked:!1,markManagerSnapshot:null,markManagerApprovalUntil:null}),y=String((u==null?void 0:u.termLabel)||"KRCT AY25-26"),m=((tt=u==null?void 0:u.assessments)==null?void 0:tt.ssa2)||{},w=Number.isFinite(Number(m==null?void 0:m.maxTotal))?Number(m.maxTotal):fK,S=i?30:w,k={co3:Number.isFinite(Number((Ft=m==null?void 0:m.coMax)==null?void 0:Ft.co3))?Number(m.coMax.co3):Number.isFinite(Number((Qt=m==null?void 0:m.coMax)==null?void 0:Qt.co1))?Number(m.coMax.co1):e4.co3,co4:Number.isFinite(Number((At=m==null?void 0:m.coMax)==null?void 0:At.co4))?Number(m.coMax.co4):Number.isFinite(Number((bt=m==null?void 0:m.coMax)==null?void 0:bt.co2))?Number(m.coMax.co2):e4.co4},F=i?{co3:15,co4:15}:k,L={btl1:df(m,1,lf.btl1),btl2:df(m,2,lf.btl2),btl3:df(m,3,lf.btl3),btl4:df(m,4,lf.btl4),btl5:df(m,5,lf.btl5),btl6:df(m,6,lf.btl6)},C=i?30:cf,O=v.useRef(null),[T,W]=v.useState(!1);v.useEffect(()=>{let V=!0;return(async()=>{try{const ie=await Sl();if(!V)return;h(ie||null),g(_e=>({..._e,termLabel:String((ie==null?void 0:ie.termLabel)||_e.termLabel||"KRCT AY25-26"),batchLabel:e}))}catch{}})(),()=>{V=!1}},[e]);const[A,N]=v.useState(!1),[P,K]=v.useState(null),[re,ge]=v.useState(()=>i?[3,4]:[]),[Fe,R]=v.useState(!1),[q,me]=v.useState(!1),[fe,E]=v.useState(null),[U,I]=v.useState(null),[M,te]=v.useState(null),[Q,G]=v.useState(null),[ne,z]=v.useState(!1),[he,X]=v.useState(!1),[H,oe]=v.useState(null),[D,Y]=v.useState(!1),[le,$e]=v.useState(null),[je,We]=v.useState(!1),{data:Ee,loading:Re,error:Ve,remainingSeconds:St,publishAllowed:rt,refresh:ze}=Ru({assessment:s,subjectCode:e,teachingAssignmentId:t}),{data:Ie,loading:ot,error:be,refresh:we}=Bu({assessment:s,subjectCode:String(e||""),teachingAssignmentId:t,options:{poll:!1}}),{data:Me,refresh:Wt}=Xo({assessment:s,subjectCode:String(e||""),scope:"MARK_MANAGER",teachingAssignmentId:t,options:{poll:!0}}),{data:Ct,refresh:pr}=Xo({assessment:s,subjectCode:String(e||""),scope:"MARK_ENTRY",teachingAssignmentId:t,options:{poll:!0}}),fr=!!(Ee!=null&&Ee.global_override_active&&(Ee==null?void 0:Ee.global_is_open)===!1),[Be,mt]=v.useState(""),[It,ft]=v.useState(!1),[gr,Mr]=v.useState(null),[$r,_r]=v.useState(null),[Vr,en]=v.useState(!1),[Xr,gn]=v.useState(null),Oe=!!(e&&!Vr),[qe,Lt]=v.useState(null);v.useEffect(()=>{Lt(null),G(null),oe(null),$e(null)},[e,s,t]);const dt=!!Q||!!(Ie!=null&&Ie.exists&&(Ie!=null&&Ie.is_published))||!!H,He=!Oe&&dt,$t=!!x.markManagerLocked,Ue=Ct!=null&&Ct.approval_until?String(Ct.approval_until):null,er=Me!=null&&Me.approval_until?String(Me.approval_until):null,Z=!!(Ct!=null&&Ct.allowed_by_approval)&&!!Ue&&Ue!==((qe==null?void 0:qe.markEntryApprovalUntil)??null),pe=!!(Me!=null&&Me.allowed_by_approval)&&!!er&&er!==((qe==null?void 0:qe.markManagerApprovalUntil)??null),ee=dt?!!(Ie!=null&&Ie.entry_open)||Z||pe:!0,ue=!!(dt&&!ee),Ae=!!e&&(ot||!!be||Ie==null),Le=!!(fr||Ae||(Ie?!Ie.entry_open:dt?!ee:!$t)),ct=x.markManagerSnapshot!=null,ce=!!(fr||ue||Le),xe=!!(dt&&ue&&$t),se=v.useMemo(()=>{const V=new Set(re);return[1,2,3,4,5,6].filter(ie=>V.has(ie))},[re]),Se=v.useMemo(()=>8+se.length*2,[o,se.length]);v.useEffect(()=>{if(!e)return;try{const _e=`${s}_selected_btls_${e}`;yn(_e,re)}catch{}let V=!1;const ie=setTimeout(async()=>{try{await Fs(s,e,{sheet:x,selectedBtls:re});try{l&&yn(l,{termLabel:x.termLabel,batchLabel:x.batchLabel,rows:x.rows})}catch{}V||I(new Date().toLocaleString())}catch{}},700);return()=>{V=!0,clearTimeout(ie)}},[re,e,x,l,s]),v.useEffect(()=>{if(!e)return;const V=Bn(l);V&&typeof V=="object"&&Array.isArray(V.rows)?g({termLabel:u!=null&&u.termLabel?String(u.termLabel):String(V.termLabel||"KRCT AY25-26"),batchLabel:e,rows:V.rows,markManagerSnapshot:(V==null?void 0:V.markManagerSnapshot)??null,markManagerApprovalUntil:(V==null?void 0:V.markManagerApprovalUntil)??null,markManagerLocked:typeof(V==null?void 0:V.markManagerLocked)=="boolean"?V.markManagerLocked:!!(V!=null&&V.markManagerSnapshot)}):g({termLabel:y||"KRCT AY25-26",batchLabel:e,rows:[],markManagerLocked:!1,markManagerSnapshot:null,markManagerApprovalUntil:null})},[l,e,u,y]),v.useEffect(()=>{let V=!0;return(async()=>{if(e)try{const ie=await En(s,e);if(!V)return;const _e=ie==null?void 0:ie.draft,Je=_e==null?void 0:_e.sheet,Nt=_e==null?void 0:_e.selectedBtls;if(Je&&typeof Je=="object"&&Array.isArray(Je.rows)){g(cr=>({...cr,termLabel:String(Je.termLabel||y||"KRCT AY25-26"),batchLabel:e,rows:Je.rows,markManagerSnapshot:(Je==null?void 0:Je.markManagerSnapshot)??cr.markManagerSnapshot??null,markManagerApprovalUntil:(Je==null?void 0:Je.markManagerApprovalUntil)??cr.markManagerApprovalUntil??null,markManagerLocked:typeof(Je==null?void 0:Je.markManagerLocked)=="boolean"?Je.markManagerLocked:!!((Je==null?void 0:Je.markManagerSnapshot)??cr.markManagerSnapshot)}));const Bt=(ie==null?void 0:ie.updated_at)??null,jt=(ie==null?void 0:ie.updated_by)??null;if(Bt)try{I(new Date(String(Bt)).toLocaleString())}catch{I(String(Bt))}jt&&te(String(jt.name||jt.username||jt.id||""));try{l&&yn(l,{termLabel:String(Je.termLabel||y||"KRCT AY25-26"),batchLabel:e,rows:Je.rows})}catch{}}if(Array.isArray(Nt)){const Bt=Nt.map(jt=>Number(jt)).filter(jt=>Number.isFinite(jt));ge(Bt);try{const jt=`${s}_selected_btls_${e}`;yn(jt,Bt)}catch{}}}catch{}})(),()=>{V=!1}},[e,y,l,s]),v.useEffect(()=>{if(!e)return;if((!!(Ie!=null&&Ie.exists&&(Ie!=null&&Ie.is_published))||!!Q)&&(Ie!=null&&Ie.exists)){const Je=!!(Ie!=null&&Ie.mark_manager_locked);!!x.markManagerLocked!==Je&&g(Nt=>({...Nt,markManagerLocked:Je}));return}const ie=!!(Me!=null&&Me.allowed_by_approval),_e=Me!=null&&Me.approval_until?String(Me.approval_until):null;if(ie&&_e){if(_e===((qe==null?void 0:qe.markManagerApprovalUntil)??null))return;const Je=x.markManagerApprovalUntil?String(x.markManagerApprovalUntil):null;x.markManagerLocked&&Je!==_e&&g(Nt=>({...Nt,markManagerLocked:!1,markManagerApprovalUntil:_e}));return}},[e,Ie==null?void 0:Ie.exists,Ie==null?void 0:Ie.is_published,Ie==null?void 0:Ie.mark_manager_locked,Me==null?void 0:Me.allowed_by_approval,Me==null?void 0:Me.approval_until,x.markManagerLocked,x.markManagerApprovalUntil,Q,qe==null?void 0:qe.markManagerApprovalUntil]);const Ze=V=>{g(ie=>{const _e=new Map,Je=new Map;for(const Bt of ie.rows||[])typeof Bt.studentId=="number"&&_e.set(Bt.studentId,Bt),Bt.registerNo&&Je.set(String(Bt.registerNo),Bt);const Nt=(V||[]).slice().sort(mK).map(Bt=>{const jt=_e.get(Bt.id)||Je.get(String(Bt.reg_no||""));return{studentId:Bt.id,section:String(Bt.section||""),registerNo:String(Bt.reg_no||""),name:String(Bt.name||""),total:typeof(jt==null?void 0:jt.total)=="number"?Ga(Number(jt.total),0,S):((jt==null?void 0:jt.total)==="","")}});return{...ie,rows:Nt}})},et=async()=>{var V,ie,_e;if(!e){K("Subject ID is required.");return}N(!0),K(null);try{let Je=[],Nt=null;try{const Bt=await wl();console.log("[SSA2] My TAs:",Bt==null?void 0:Bt.length,"for subject:",e,"teachingAssignmentId:",t),Nt=(Bt||[]).find(jt=>{const cr=String(jt.subject_code||"").trim().toUpperCase()===String(e||"").trim().toUpperCase();return(t?jt.id===t:!1)||cr}),Nt?console.log("[SSA2] Found TA match:",Nt.id,"elective_subject_id:",Nt.elective_subject_id,"section_id:",Nt.section_id):console.log("[SSA2] No TA match found in user TAs")}catch(Bt){console.warn("[SSA2] My TAs fetch failed:",Bt)}if(Nt&&Nt.elective_subject_id&&!Nt.section_id){console.log("[SSA2] Detected elective, fetching elective-choices for elective_subject_id:",Nt.elective_subject_id);try{const Bt=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(Nt.elective_subject_id))}`);if(Bt.ok){const jt=await Bt.json(),cr=Array.isArray(jt.results)?jt.results:Array.isArray(jt)?jt:jt.items||[];console.log("[SSA2] Elective choices returned:",cr==null?void 0:cr.length,"students"),Je=(cr||[]).map(sr=>({id:Number(sr.student_id??sr.id),reg_no:String(sr.reg_no??sr.regno??""),name:String(sr.name??sr.full_name??sr.username??""),section:sr.section_name??sr.section??null}))}else console.warn("[SSA2] Elective-choices API returned error:",Bt.status)}catch(Bt){console.warn("[SSA2] Elective-choices fetch failed:",Bt)}}if(!Je.length&&Nt&&Nt.id){console.log("[SSA2] Fetching regular TA roster for TA ID:",Nt.id);try{const Bt=await Jo(Nt.id);Je=Bt.students||[],f({courseName:String(((V=Bt==null?void 0:Bt.teaching_assignment)==null?void 0:V.subject_name)||(Nt==null?void 0:Nt.subject_name)||""),courseCode:String(((ie=Bt==null?void 0:Bt.teaching_assignment)==null?void 0:ie.subject_code)||(Nt==null?void 0:Nt.subject_code)||e||""),className:String(((_e=Bt==null?void 0:Bt.teaching_assignment)==null?void 0:_e.section_name)||(Nt==null?void 0:Nt.section_name)||"")}),console.log("[SSA2] Regular roster returned:",Je.length,"students")}catch(Bt){console.warn("[SSA2] TA roster fetch failed:",Bt)}}console.log("[SSA2] Final roster count:",Je.length),Ze(Je)}catch(Je){K((Je==null?void 0:Je.message)||"Failed to load roster")}finally{N(!1)}};v.useEffect(()=>{e&&et()},[t,e]);async function Et(V){if(e){V&&Y(!0),$e(null);try{const ie=await c(String(e));oe(ie||null)}catch(ie){V&&$e((ie==null?void 0:ie.message)||`Failed to load published ${a} marks`)}finally{V&&Y(!1)}}}v.useEffect(()=>{e&&Et(!1)},[e,s,t]);const wt=v.useRef(!!ee);v.useEffect(()=>{wt.current=!!ee},[e,s,t,ee]);const gt=v.useRef(null);async function zt(V=!0){try{if(ze(),we({silent:!1}),await Et(V),t)try{await et()}catch{}}catch{}}v.useEffect(()=>{if(!e||!dt)return;if(wt.current||!ee){wt.current=!!ee;return}let ie=!0;return(async()=>{try{const _e=await En(s,String(e));if(!ie)return;const Je=_e==null?void 0:_e.draft,Nt=Je==null?void 0:Je.sheet,Bt=Je==null?void 0:Je.selectedBtls;Nt&&typeof Nt=="object"&&Array.isArray(Nt.rows)&&g(jt=>({...jt,termLabel:String(Nt.termLabel||y||"KRCT AY25-26"),batchLabel:e,rows:Nt.rows,markManagerSnapshot:(Nt==null?void 0:Nt.markManagerSnapshot)??jt.markManagerSnapshot??null,markManagerApprovalUntil:(Nt==null?void 0:Nt.markManagerApprovalUntil)??jt.markManagerApprovalUntil??null,markManagerLocked:typeof(Nt==null?void 0:Nt.markManagerLocked)=="boolean"?Nt.markManagerLocked:!!((Nt==null?void 0:Nt.markManagerSnapshot)??jt.markManagerSnapshot)})),Array.isArray(Bt)&&ge(Bt.map(jt=>Number(jt)).filter(jt=>Number.isFinite(jt)));return}catch{}ie&&Et(!1)})(),wt.current=!!ee,()=>{ie=!1}},[ee,dt,e,s,y]),v.useEffect(()=>{if(!e||!dt||ee)return;const V=window.setInterval(()=>{we({silent:!0})},3e4);return()=>window.clearInterval(V)},[ee,dt,e,we]),v.useEffect(()=>{he&&e&&(oe(null),Et(!0))},[he,e]);const Dt=async()=>{R(!0),E(null);try{await Fs(s,e,{sheet:x,selectedBtls:re}),I(new Date().toLocaleString())}catch(V){E((V==null?void 0:V.message)||`Failed to save ${a} draft`)}finally{R(!1)}},mr=async()=>{if(e){if(fr){E("Publishing is locked by IQAC.");return}if(!rt){E("Publish window is closed. Please request IQAC approval.");return}if(dt&&ue){z(!0);return}me(!0),E(null);try{await d(e,x,t),G(new Date().toLocaleString()),Lt({markEntryApprovalUntil:Ue,markManagerApprovalUntil:er}),g(V=>({...V,markManagerLocked:!0})),ze(),we({silent:!0}),Et(!1),setTimeout(()=>{try{if(he&&gt.current){const V=gt.current;V.scrollTop=V.scrollHeight}}catch{}},50);try{console.debug("obe:published dispatch",{assessment:s,subjectId:e}),window.dispatchEvent(new CustomEvent("obe:published",{detail:{subjectId:e,assessment:s}}))}catch{}setTimeout(()=>{zt(!0),We(!0),setTimeout(()=>We(!1),5e3)},2e3)}catch(V){E((V==null?void 0:V.message)||`Failed to publish ${a}`)}finally{me(!1)}}},pt=async()=>{ft(!0),Mr(null),E(null);try{await w0({assessment:s,subject_code:e,reason:Be,teaching_assignment_id:t}),Mr("Request sent to IQAC for approval.")}catch(V){E((V==null?void 0:V.message)||"Failed to request approval")}finally{ft(!1),ze()}},Xt=()=>{confirm(`Reset ${a} marks for all students in this section?`)&&(Le||g(V=>({...V,rows:(V.rows||[]).map(ie=>({...ie,total:""}))})))};function Rt(V){return JSON.stringify({maxTotal:S,coMax:F,selectedBtls:re.slice(),btlMax:L})}async function _t(){if(e){en(!0),gn(null);try{await Yi({assessment:s,subject_code:String(e),scope:"MARK_MANAGER",reason:`Edit request: Mark Manager changes for ${a} ${e}`,teaching_assignment_id:t}),alert("Edit request sent to IQAC.");try{await(Wt?Wt({silent:!0}):Promise.resolve())}catch{}}catch(V){gn((V==null?void 0:V.message)||"Request failed"),alert((V==null?void 0:V.message)||"Request failed")}finally{en(!1)}}}async function jr(){if(e)try{await Yi({assessment:s,subject_code:String(e),scope:"MARK_ENTRY",reason:`Edit request: ${a} marks entry for ${e}`,teaching_assignment_id:t}),alert("Edit request sent to IQAC."),we({silent:!0});try{await(pr?pr({silent:!0}):Promise.resolve())}catch{}}catch(V){alert((V==null?void 0:V.message)||"Request failed")}}async function Gr(){if(e){en(!0),gn(null);try{const V=Rt(x),ie=Me!=null&&Me.approval_until?String(Me.approval_until):x.markManagerApprovalUntil||null,_e={...x,markManagerLocked:!0,markManagerSnapshot:V,markManagerApprovalUntil:ie},Je={sheet:_e,selectedBtls:re};g(_e),_r(null),await Fs(s,String(e),Je),I(new Date().toLocaleString());try{await kd(s,String(e),t),we({silent:!0})}catch(Nt){console.warn("confirmMarkManagerLock failed",Nt)}}catch(V){gn((V==null?void 0:V.message)||"Save failed")}finally{en(!1)}}}const Cr=(V,ie)=>{g(_e=>{const Je=_e.rows.slice(),Nt=Je[V]||{studentId:0,section:"",registerNo:"",name:"",total:""};return Je[V]={...Nt,...ie},{..._e,rows:Je}})},Rr=()=>{const V=x.rows.map((ie,_e)=>{const Je=typeof ie.total=="number"?Ga(Number(ie.total),0,S):null,Nt=Je==null?"":fo(Je),jt=Je==null?null:fo(Je/2),cr=jt==null?null:Ga(jt,0,F.co3),sr=jt==null?null:Ga(jt,0,F.co4),Fr=se.map(ye=>ye-1),Pt=[L.btl1,L.btl2,L.btl3,L.btl4,L.btl5,L.btl6].map((ye,lt)=>Fr.includes(lt)?i?C:ye>0?ye:cf:ye),Ot=Je==null?null:Fr.length?fo(Je/Fr.length):0,Tr=Pt.map((ye,lt)=>Je==null||!Fr.includes(lt)?null:ye>0?Ga(Ot,0,ye):fo(Ot)),vr={sno:_e+1,registerNo:rx(ie.registerNo),name:ie.name,co3_mark:cr??"",co3_pct:Ii(cr,F.co3),co4_mark:sr??"",co4_pct:Ii(sr,F.co4),btl1_mark:Tr[0]??"",btl1_pct:Ii(Tr[0],Pt[0]),btl2_mark:Tr[1]??"",btl2_pct:Ii(Tr[1],Pt[1]),btl3_mark:Tr[2]??"",btl3_pct:Ii(Tr[2],Pt[2]),btl4_mark:Tr[3]??"",btl4_pct:Ii(Tr[3],Pt[3]),btl5_mark:Tr[4]??"",btl5_pct:Ii(Tr[4],Pt[4]),btl6_mark:Tr[5]??"",btl6_pct:Ii(Tr[5],Pt[5])};return vr[a]=Nt,vr});pK(`${e}_${t4(a)||"SSA2"}_sheet.csv`,V)},De=()=>{if(!x.rows.length)return;const V=Number.isFinite(Number(F.co3))?Number(F.co3):0,ie=Number.isFinite(Number(F.co4))?Number(F.co4):0,_e=["Register No","Student Name",`Q1 (${V.toFixed(2)})`,`Q2 (${ie.toFixed(2)})`,"Status"],Je=x.rows.map(cr=>[cr.registerNo,cr.name,"","","present"]),Nt=gi.aoa_to_sheet([_e,...Je]);Nt["!freeze"]={xSplit:0,ySplit:1};const Bt=gi.book_new();gi.book_append_sheet(Bt,Nt,a||"SSA2");const jt=`${e}_${t4(a)||"SSA2"}_template.xlsx`;vg(Bt,jt)},Ke=async()=>{const V=x.rows.map((ie,_e)=>({sno:_e+1,regNo:String(ie.registerNo||""),name:String(ie.name||""),total:ie.total===""?"":Number(ie.total)}));await Qp({filenameBase:`${e}_${a}`,meta:{courseName:(p==null?void 0:p.courseName)||"",courseCode:(p==null?void 0:p.courseCode)||e,className:(p==null?void 0:p.className)||""},rows:V})};function Ce(V){return String(V??"").trim().toLowerCase().replace(/\s+/g," ")}const it=()=>{var V;Le||(V=O.current)==null||V.click()},tr=async V=>{var ie;if(V){W(!0);try{const _e=await V.arrayBuffer(),Je=u0(_e,{type:"array"}),Nt=(ie=Je.SheetNames)==null?void 0:ie[0];if(!Nt)throw new Error("No sheet found in the Excel file.");const Bt=Je.Sheets[Nt],jt=gi.sheet_to_json(Bt,{header:1});if(!jt.length)throw new Error("Excel sheet is empty.");const cr=(jt[0]||[]).map(Ce),sr=ht=>cr.findIndex(Vt=>ht(Vt)),Fr=sr(ht=>ht==="register no"||ht==="reg no"||ht.includes("register")),Nr=sr(ht=>ht.startsWith("q1")),Pt=sr(ht=>ht.startsWith("q2")),Ot=sr(ht=>ht==="total"||ht.includes("total")),Tr=sr(ht=>ht==="status"||ht.includes("status"));if(Fr<0)throw new Error("Could not find Register No column.");const vr=Number.isFinite(Number(F.co3))?Number(F.co3):0,ye=Number.isFinite(Number(F.co4))?Number(F.co4):0,lt=new Map;x.rows.forEach((ht,Vt)=>{const Wr=String(ht.registerNo||"").trim();Wr&&lt.set(Wr,Vt);const Yr=rx(Wr);Yr&&lt.set(Yr,Vt)}),g(ht=>{const Vt=ht.rows.slice();for(let Wr=1;Wr<jt.length;Wr++){const Yr=jt[Wr]||[],fn=String(Yr[Fr]??"").trim();if(!fn)continue;const In=lt.get(fn);if(In==null)continue;const st=(Tr>=0?String(Yr[Tr]??""):"").trim().toLowerCase(),at=st==="absent"||st==="ab"||st==="a",nt=Nr>=0?Ox(Yr[Nr]):null,xt=Pt>=0?Ox(Yr[Pt]):null,rr=Ot>=0?Ox(Yr[Ot]):null,vt=nt==null?0:Ga(nt,0,vr),dr=xt==null?0:Ga(xt,0,ye),ir=rr??vt+dr,Br=at?0:Ga(ir,0,S);Vt[In]={...Vt[In],total:fo(Br)}}return{...ht,rows:Vt}})}finally{W(!1)}}},Kt=async V=>{var _e;const ie=(_e=V.target.files)==null?void 0:_e[0];if(V.target.value="",!!ie)try{await tr(ie)}catch(Je){alert((Je==null?void 0:Je.message)||"Failed to import Excel")}},yt={border:"1px solid #e5e7eb",padding:"6px 6px",background:"#f8fafc",color:"#334155",textAlign:"center",fontWeight:700,fontSize:12,whiteSpace:"nowrap"},Ht={border:"1px solid #eef2f7",padding:"6px 6px",fontSize:12,color:"#0f172a",whiteSpace:"nowrap",transition:"background-color 120ms ease"},qt={width:"100%",border:"1px solid #cbd5e1",outline:"none",background:"transparent",borderRadius:10,padding:"6px 8px",fontSize:12},lr={display:"inline-flex",alignItems:"center",gap:6,padding:"6px 10px",border:"1px solid #cbd5e1",borderRadius:999,background:"#fff",cursor:"pointer",userSelect:"none",fontSize:12},Mt={border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"};return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{onClick:et,className:"obe-btn obe-btn-secondary",disabled:A,children:A?"Loading roster":"Load/Refresh Roster"}),n.jsx("button",{onClick:Xt,className:"obe-btn obe-btn-danger",disabled:!x.rows.length,children:"Reset Marks"}),n.jsx("button",{onClick:Rr,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length,children:"Export CSV"}),n.jsx("button",{onClick:De,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length,children:"Export Excel"}),n.jsx("button",{onClick:it,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length||Le||T,children:T?"Importing":"Import Excel"}),n.jsx("input",{ref:O,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:Kt})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[n.jsx("button",{onClick:Dt,className:"obe-btn obe-btn-success",disabled:Fe,children:Fe?"Saving":"Save Draft"}),n.jsx("button",{onClick:Ke,className:"obe-btn obe-btn-secondary",disabled:!x.rows.length,children:"Download"}),n.jsx("button",{onClick:()=>zt(!0),className:"obe-btn",disabled:!e,children:"Refresh"}),n.jsx("button",{onClick:mr,className:"obe-btn obe-btn-primary",disabled:q||!rt,children:q?"Publishing":"Publish"})]})]}),je?n.jsx("div",{style:{marginTop:8,padding:8,background:"#ecfdf5",border:"1px solid #bbf7d0",borderRadius:8,color:"#065f46",fontWeight:700},children:"Name list locked"}):null,n.jsx("div",{style:{marginTop:10,fontSize:12,color:rt?"#065f46":"#b91c1c"},children:Re?"Checking publish due time":Ve||(Ee!=null&&Ee.due_at?n.jsxs(n.Fragment,{children:["Due: ",new Date(Ee.due_at).toLocaleString(),"  Remaining: ",_0(St),Ee.allowed_by_approval&&Ee.approval_until?n.jsxs(n.Fragment,{children:["  Approved until ",new Date(Ee.approval_until).toLocaleString()]}):null]}):"Due time not set by IQAC.")}),fr?n.jsxs("div",{style:{marginTop:10,border:"1px solid #fde68a",background:"#fffbeb",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publishing disabled by IQAC"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Global publishing is turned OFF for this assessment. You can view the sheet, but editing and publishing are locked."}),n.jsx("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:10},children:n.jsx("button",{className:"obe-btn",onClick:()=>ze(),disabled:Re,children:"Refresh"})})]}):rt?null:n.jsxs("div",{style:{marginTop:10,border:"1px solid #fecaca",background:"#fff7ed",borderRadius:12,padding:12},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Publish time is over"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:8},children:"Send a request to IQAC to approve publishing."}),n.jsx("textarea",{value:Be,onChange:V=>mt(V.target.value),placeholder:"Reason (optional)",rows:3,style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb",resize:"vertical"}}),n.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:10},children:[n.jsx("button",{className:"obe-btn",onClick:()=>ze(),disabled:It||Re,children:"Refresh"}),n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:pt,disabled:It,children:It?"Requesting":"Request Approval"})]}),gr?n.jsx("div",{style:{marginTop:8,fontSize:12,color:"#065f46"},children:gr}):null]}),(P||fe)&&n.jsx("div",{style:{marginTop:10,color:"#b91c1c",fontSize:13},children:P||fe}),n.jsxs("div",{style:{marginTop:10,display:"flex",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{style:Mt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Term"}),n.jsx("div",{style:{fontWeight:700},children:x.termLabel||""})]}),n.jsxs("div",{style:Mt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Batch"}),n.jsx("div",{style:{fontWeight:700},children:x.batchLabel||""})]}),n.jsxs("div",{style:Mt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Saved"}),n.jsx("div",{style:{fontWeight:700},children:U||""}),M?n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["by ",n.jsx("span",{style:{color:"#0369a1",fontWeight:700},children:M})]}):null]}),n.jsxs("div",{style:Mt,children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Published"}),n.jsx("div",{style:{fontWeight:700},children:Q||""})]})]}),n.jsxs("div",{style:{marginTop:12,...Mt},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("div",{style:{fontWeight:800},children:"Mark Manager"}),n.jsx("div",{children:n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>{const V=x.markManagerSnapshot!=null;_r({mode:V?"request":"confirm"})},disabled:!e||Vr,children:x.markManagerSnapshot?"Edit":"Save"})})]}),n.jsxs("div",{style:{marginTop:8,fontSize:13,color:"#6b7280"},children:[n.jsxs("div",{children:["Max ",a,": ",n.jsx("strong",{style:{color:"#111"},children:S})]}),n.jsxs("div",{children:["CO-3 max: ",n.jsx("strong",{style:{color:"#111"},children:F.co3}),"  CO-4 max: ",n.jsx("strong",{style:{color:"#111"},children:F.co4})]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Selected BTLs:"}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[1,2,3,4,5,6].map(V=>{const ie=re.includes(V),_e=!!($t&&x.markManagerSnapshot!=null);return n.jsxs("div",{onClick:()=>{if(fr||Vr)return;const Je=x.markManagerSnapshot!=null;$t&&Je||ge(Nt=>Nt.includes(V)?Nt.filter(Bt=>Bt!==V):Nt.concat(V).sort((Bt,jt)=>Bt-jt))},style:{...lr,borderColor:ie?"#16a34a":"#cbd5e1",background:ie?"#ecfdf5":"#fff",cursor:_e||Vr?"not-allowed":"pointer",opacity:_e?.6:1,padding:"6px 8px"},"aria-disabled":_e||Vr,children:[n.jsx("input",{type:"checkbox",checked:ie,readOnly:!0,style:{marginRight:6}}),n.jsxs("span",{style:{fontWeight:800},children:["BTL",V]})]},`card_btl_${V}`)})})]})]}),Xr?n.jsx("div",{style:{marginTop:8,color:"#991b1b"},children:Xr}):null]}),n.jsx("div",{style:{marginTop:14},children:ct?n.jsxs("div",{style:{position:"relative"},children:[n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12,background:"linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9))",backdropFilter:"blur(10px)",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"},children:n.jsx(k0,{locked:!!(fr||ue||dt&&Ae),title:fr?"Locked by IQAC":He?"Published  Locked":"Table Locked",subtitle:fr?"Publishing is turned OFF globally for this assessment.":He?"Marks are published. Request IQAC approval to edit.":"Confirm the Mark Manager",children:n.jsxs("table",{style:{borderCollapse:"collapse",minWidth:920},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:yt,colSpan:Se,children:[x.termLabel," | ",x.batchLabel," | ",a]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...yt,width:42,minWidth:42},rowSpan:4,children:"S.No"}),n.jsx("th",{style:yt,rowSpan:4,children:"Register No."}),n.jsx("th",{style:yt,rowSpan:3,children:"Name of the Students"}),n.jsx("th",{style:yt,children:a}),null,n.jsx("th",{style:yt,colSpan:4,children:"CO ATTAINMENT"}),se.length?n.jsx("th",{style:yt,colSpan:se.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[n.jsxs("th",{style:yt,children:[n.jsx("div",{style:{fontWeight:800},children:"COs"}),n.jsx("div",{style:{fontSize:12},children:"3,4"})]}),null,n.jsx("th",{style:yt,colSpan:2,children:"CO-3"}),n.jsx("th",{style:yt,colSpan:2,children:"CO-4"}),se.map(V=>n.jsxs("th",{style:yt,colSpan:2,children:["BTL-",V]},`btl-head-${V}`))]}),n.jsxs("tr",{children:[n.jsxs("th",{style:yt,children:[n.jsx("div",{style:{fontWeight:800},children:"BTL"}),n.jsx("div",{style:{fontSize:12},children:se.length?se.join(","):"-"})]}),null,Array.from({length:2+se.length}).flatMap((V,ie)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:yt,children:"Mark"}),n.jsx("th",{style:yt,children:"%"})]},ie))]}),n.jsxs("tr",{children:[n.jsx("th",{style:yt,children:"Name / Max Marks"}),n.jsx("th",{style:yt,children:S}),null,n.jsx("th",{style:yt,children:F.co3}),n.jsx("th",{style:yt,children:"%"}),n.jsx("th",{style:yt,children:F.co4}),n.jsx("th",{style:yt,children:"%"}),se.flatMap(V=>[n.jsx("th",{style:yt,children:String(i?C:Math.max(Number(L[`btl${V}`]??0)||0,cf))},`btl-max-${V}`),n.jsx("th",{style:yt,children:"%"},`btl-pct-${V}`)])]})]}),n.jsx("tbody",{children:x.rows.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:Se,style:{padding:14,color:"#6b7280",fontSize:13},children:"No students loaded yet. Choose a Teaching Assignment above, then click Load/Refresh Roster."})}):Le&&!ue?n.jsx("tr",{children:n.jsx("td",{colSpan:Se,style:{padding:20,textAlign:"center",color:"#065f46",fontWeight:900},children:"Table locked  confirm the Mark Manager to enable student marks"})}):x.rows.map((V,ie)=>{const _e=typeof V.total=="number"?Ga(Number(V.total),0,S):null,Je=_e==null?null:fo(_e/2),Nt=Je==null?null:Ga(Je,0,F.co3),Bt=Je==null?null:Ga(Je,0,F.co4),jt=se.map(Pt=>Pt-1),sr=[L.btl1,L.btl2,L.btl3,L.btl4,L.btl5,L.btl6].map((Pt,Ot)=>jt.includes(Ot)?i?C:Pt>0?Pt:cf:Pt),Fr=_e==null?null:jt.length?fo(_e/jt.length):0,Nr=sr.map((Pt,Ot)=>_e==null||!jt.includes(Ot)?null:Pt>0?Ga(Fr,0,Pt):fo(Fr));return n.jsxs("tr",{style:{background:ie%2===1?"#f8fafc":"#fff"},children:[n.jsx("td",{style:{...Ht,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:ie+1}),n.jsx("td",{style:Ht,children:rx(V.registerNo)}),n.jsx("td",{style:Ht,children:V.name}),n.jsx("td",{style:{...Ht,width:90,background:"#fff7ed"},children:ce?n.jsx("div",{style:{...qt,textAlign:"right",paddingRight:4},children:typeof V.total=="number"?fo(V.total):""}):n.jsx("input",{style:qt,type:"number",value:V.total,min:0,max:S,onChange:Pt=>{if(ce)return;const Ot=Pt.target.value;if(Ot==="")return Cr(ie,{total:""});const Tr=Number(Ot);if(!Number.isFinite(Tr))return Cr(ie,{total:""});if(Tr>S){Pt.currentTarget.setCustomValidity(`Max mark is ${S}`),Pt.currentTarget.reportValidity(),window.setTimeout(()=>Pt.currentTarget.setCustomValidity(""),0);return}Pt.currentTarget.setCustomValidity("");const vr=Ga(Tr,0,S);Cr(ie,{total:vr})}})}),null,n.jsx("td",{style:{...Ht,textAlign:"right"},children:Nt??""}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:Ii(Nt,F.co3)}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:Bt??""}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:Ii(Bt,F.co4)}),se.map(Pt=>{const Ot=Pt-1,Tr=Nr[Ot],vr=sr[Ot];return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...Ht,textAlign:"right"},children:Tr??""}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:Ii(Tr,vr)})]},Pt)})]},String(V.studentId||ie))})})]})})}),xe&&ct?n.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:40,width:360,background:"rgba(255,255,255,0.98)",border:"1px solid #e5e7eb",padding:10,borderRadius:12,display:"flex",flexDirection:"column",gap:8,alignItems:"center",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"},children:[n.jsx("div",{style:{textAlign:"center"},children:He?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontWeight:900,color:"#065f46"},children:"Published"}),n.jsx("div",{style:{fontSize:13,color:"#065f46"},children:"Marks are locked. Request IQAC approval to edit."})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontWeight:900,color:"#065f46"},children:"Table Locked"}),n.jsx("div",{style:{fontSize:13,color:"#065f46"},children:"Confirm the Mark Manager"})]})}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[n.jsx("button",{className:"obe-btn",onClick:()=>X(!0),children:"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>z(!0),children:"Request Edit"})]})]}):null]}):n.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:20,background:"linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9))",backdropFilter:"blur(10px)",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"},children:n.jsxs("div",{style:{display:"grid",placeItems:"center",padding:40},children:[n.jsx("div",{style:{fontWeight:800,fontSize:16,marginTop:8},children:He&&ct?"Published  Locked":"Table Locked"}),n.jsx("div",{style:{color:"#6b7280",marginTop:6},children:He&&ct?"Marks published. Use View to inspect or Request Edit to ask IQAC for edit access.":"Confirm the Mark Manager to unlock the student list."}),n.jsx("div",{style:{display:"flex",gap:8,marginTop:12},children:He&&ct?n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn",onClick:()=>X(!0),children:"View"}),n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>z(!0),children:"Request Edit"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn obe-btn-success",onClick:()=>_r({mode:"confirm"}),disabled:!e||Vr,children:"Save Mark Manager"}),n.jsx("button",{className:"obe-btn",onClick:()=>_t(),disabled:Vr,children:"Request Access"})]})})]})})}),he?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:70},onClick:()=>X(!1),children:n.jsxs("div",{style:{width:"min(1100px, 96vw)",maxHeight:"min(80vh, 900px)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:0,display:"flex",flexDirection:"column"},onClick:V=>V.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderBottom:"1px solid #eef2f7"},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"View Only"}),n.jsx("button",{onClick:V=>{V.stopPropagation(),X(!1)},"aria-label":"Close",style:{marginLeft:"auto",border:"none",background:"transparent",fontSize:20,lineHeight:1,cursor:"pointer"},children:""})]}),n.jsxs("div",{style:{padding:14},children:[D?n.jsx("div",{style:{color:"#6b7280",marginBottom:8},children:"Loading published marks"}):null,le?n.jsx("div",{style:{color:"#b91c1c",marginBottom:8},children:le}):null]}),n.jsx("div",{ref:gt,style:{overflow:"auto",borderTop:"1px solid #e5e7eb",borderBottom:"1px solid #e5e7eb",borderLeft:"1px solid #e5e7eb",borderRight:"1px solid #e5e7eb",borderRadius:0,maxHeight:"60vh",background:"#fff"},children:n.jsxs("table",{style:{borderCollapse:"collapse",minWidth:920},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:n.jsxs("th",{style:yt,colSpan:Se,children:[x.termLabel," | ",x.batchLabel," | ",a]})}),n.jsxs("tr",{children:[n.jsx("th",{style:{...yt,width:42,minWidth:42},rowSpan:4,children:"S.No"}),n.jsx("th",{style:yt,rowSpan:4,children:"Register No."}),n.jsx("th",{style:yt,rowSpan:3,children:"Name of the Students"}),n.jsx("th",{style:yt,children:a}),null,n.jsx("th",{style:yt,colSpan:4,children:"CO ATTAINMENT"}),se.length?n.jsx("th",{style:yt,colSpan:se.length*2,children:"BTL ATTAINMENT"}):null]}),n.jsxs("tr",{children:[n.jsxs("th",{style:yt,children:[n.jsx("div",{style:{fontWeight:800},children:"COs"}),n.jsx("div",{style:{fontSize:12},children:"3,4"})]}),null,n.jsx("th",{style:yt,colSpan:2,children:"CO-3"}),n.jsx("th",{style:yt,colSpan:2,children:"CO-4"}),se.map(V=>n.jsxs("th",{style:yt,colSpan:2,children:["BTL-",V]},`btl-head-${V}`))]}),n.jsxs("tr",{children:[n.jsxs("th",{style:yt,children:[n.jsx("div",{style:{fontWeight:800},children:"BTL"}),n.jsx("div",{style:{fontSize:12},children:se.length?se.join(","):"-"})]}),null,Array.from({length:2+se.length}).flatMap((V,ie)=>n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:yt,children:"Mark"}),n.jsx("th",{style:yt,children:"%"})]},ie))]}),n.jsxs("tr",{children:[n.jsx("th",{style:yt,children:"Name / Max Marks"}),n.jsx("th",{style:yt,children:S}),null,n.jsx("th",{style:yt,children:F.co3}),n.jsx("th",{style:yt,children:"%"}),n.jsx("th",{style:yt,children:F.co4}),n.jsx("th",{style:yt,children:"%"}),se.flatMap(V=>[n.jsx("th",{style:yt,children:String(i?C:Math.max(Number(L[`btl${V}`]??0)||0,cf))},`btl-max-${V}`),n.jsx("th",{style:yt,children:"%"},`btl-pct-${V}`)])]})]}),n.jsx("tbody",{children:x.rows.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:Se,style:{padding:14,color:"#6b7280",fontSize:13},children:"No students loaded yet. Choose a Teaching Assignment above, then click Load/Refresh Roster."})}):x.rows.map((V,ie)=>{var Tr;const _e=((Tr=H==null?void 0:H.marks)==null?void 0:Tr[String(V.studentId)])??null,Je=_e==null||_e===""?null:Ga(Number(_e),0,S),Bt=Je==null?null:fo(Je/2),jt=Bt==null?null:Ga(Bt,0,F.co3),cr=Bt==null?null:Ga(Bt,0,F.co4),sr=se.map(vr=>vr-1),Nr=[L.btl1,L.btl2,L.btl3,L.btl4,L.btl5,L.btl6].map((vr,ye)=>sr.includes(ye)?i?C:vr>0?vr:cf:vr),Pt=Je==null?null:sr.length?fo(Je/sr.length):0,Ot=Nr.map((vr,ye)=>Je==null||!sr.includes(ye)?null:vr>0?Ga(Pt,0,vr):fo(Pt));return n.jsxs("tr",{style:{background:ie%2===1?"#f8fafc":"#fff"},children:[n.jsx("td",{style:{...Ht,textAlign:"center",width:42,minWidth:42,paddingLeft:2,paddingRight:2},children:ie+1}),n.jsx("td",{style:Ht,children:rx(V.registerNo)}),n.jsx("td",{style:Ht,children:V.name}),n.jsx("td",{style:{...Ht,width:90,background:"#fff7ed",textAlign:"right"},children:Je==null?"":fo(Je)}),null,n.jsx("td",{style:{...Ht,textAlign:"right"},children:jt??""}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:Ii(jt,F.co3)}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:cr??""}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:Ii(cr,F.co4)}),se.map(vr=>{const ye=vr-1,lt=Ot[ye],ht=Nr[ye];return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...Ht,textAlign:"right"},children:lt??""}),n.jsx("td",{style:{...Ht,textAlign:"right"},children:Ii(lt,ht)})]},vr)})]},String(V.studentId||ie))})})]})}),n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:n.jsx("button",{className:"obe-btn",onClick:()=>X(!1),children:"Close"})})]})}):null,$r?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:9999},onClick:()=>{Vr||_r(null)},children:n.jsxs("div",{style:{width:"min(640px,96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:V=>V.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:$r.mode==="confirm"?`Confirmation - ${a}`:`Request Edit - ${a}`}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:a})]}),$r.mode==="confirm"?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"Confirm the selected settings. After confirming, Mark Manager will be applied and table will be editable."}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f9fafb"},children:[n.jsx("th",{style:{textAlign:"left",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Item"}),n.jsx("th",{style:{textAlign:"right",padding:10,fontSize:12,borderBottom:"1px solid #e5e7eb"},children:"Value"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsxs("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:["Max ",a]}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:S})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"CO-3 max"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:F.co3})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"CO-4 max"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:F.co4})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",fontWeight:900},children:"Selected BTLs"}),n.jsx("td",{style:{padding:10,borderBottom:"1px solid #f3f4f6",textAlign:"right"},children:n.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[1,2,3,4,5,6].map(V=>{const ie=re.includes(V);return n.jsxs("div",{onClick:()=>{Vr||ge(_e=>_e.includes(V)?_e.filter(Je=>Je!==V):[..._e,V].sort((Je,Nt)=>Je-Nt))},style:{...lr,borderColor:ie?"#16a34a":"#cbd5e1",background:ie?"#ecfdf5":"#fff",cursor:Vr?"not-allowed":"pointer",padding:"6px 8px"},children:[n.jsx("input",{type:"checkbox",checked:ie,readOnly:!0,style:{marginRight:6}}),n.jsxs("span",{style:{fontWeight:800},children:["BTL",V]})]},`modal_btl_${V}`)})})})]})]})]})})]}):n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:10},children:"This will send an edit request to IQAC. Mark Manager will remain locked until IQAC approves."}),n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[n.jsx("button",{className:"obe-btn",disabled:Vr,onClick:()=>_r(null),children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-success",disabled:Vr||!e,onClick:async()=>{if(e){if($r.mode==="request"){_r(null),await _t();return}await Gr()}},children:$r.mode==="confirm"?"Confirm":"Send Request"})]})]})}):null,ne?n.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>z(!1),children:n.jsxs("div",{style:{width:"min(560px, 96vw)",background:"#fff",borderRadius:14,border:"1px solid #e5e7eb",padding:14},onClick:V=>V.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[n.jsx("div",{style:{fontWeight:950,fontSize:14,color:"#111827"},children:"Edit Request"}),n.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:a})]}),n.jsxs("div",{style:{fontSize:13,color:"#374151",marginBottom:10,lineHeight:1.35},children:[n.jsxs("div",{children:[n.jsx("strong",{children:"Subject:"})," ",String(e||"")]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Published:"})," ",Q||""]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Saved:"})," ",U||""]})]}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[n.jsx("button",{type:"button",className:"obe-btn",onClick:()=>z(!1),children:"Close"}),n.jsx("button",{type:"button",className:"obe-btn obe-btn-primary",onClick:async()=>{await jr(),z(!1)},children:"Request Edit"})]})]})}):null,n.jsx("style",{children:`
        /* SSA table modern look (UI-only) */
        table tbody tr:hover td {
          background: rgba(15, 23, 42, 0.03);
        }
      `}),n.jsxs("div",{style:{marginTop:14,position:"relative"},children:[n.jsx("div",{style:{position:"absolute",inset:0,zIndex:0,pointerEvents:"none",background:"linear-gradient(120deg, #e0f2fe 0%, #f0f9ff 100%)"}}),ct?n.jsx("div",{style:{position:"relative",zIndex:1,overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12,background:"linear-gradient(135deg, rgba(255,255,255,0.92), rgba(248,250,252,0.92))",backdropFilter:"blur(10px)",boxShadow:"0 6px 18px rgba(17,24,39,0.06)"}}):null]})]})}function xK({subjectId:e,teachingAssignmentId:t,label:r}){return n.jsx(m8,{subjectId:e,teachingAssignmentId:t,assessmentKey:"review2",label:r||"Review 2"})}function gK({subjectId:e,teachingAssignmentId:t,label:r}){return n.jsx(p8,{subjectId:e,teachingAssignmentId:t,assessmentKey:"ssa1",label:r||"SSA1"})}function yK({subjectId:e,teachingAssignmentId:t,label:r}){return n.jsx(m8,{subjectId:e,teachingAssignmentId:t,assessmentKey:"ssa2",label:r||"SSA2"})}const bK=["ssa1","formative1","ssa2","formative2","cia1","cia2"];function vK({teachingAssignmentId:e,onSaved:t,onClose:r}){var A;const[s,a]=v.useState(!1),[i,o]=v.useState(!1),[l,c]=v.useState(new Set),[d,u]=v.useState(null),[h,p]=v.useState(!1),[f,x]=v.useState(null),g=v.useRef(null);v.useEffect(()=>{let N=!0;if(e)return(async()=>{a(!0);try{const P=await zf(Number(e));if(!N)return;c(new Set((P==null?void 0:P.enabled_assessments)||[])),u((P==null?void 0:P.meta)||null),x(null)}catch(P){x((P==null?void 0:P.message)||"Failed to load")}finally{N&&a(!1)}})(),()=>{N=!1}},[e]),v.useEffect(()=>{var K;if(!e||(d==null?void 0:d.mode)!=="SPECIAL_GLOBAL"||((K=d==null?void 0:d.edit_request)==null?void 0:K.status)!=="PENDING")return;let N=!1;const P=window.setInterval(async()=>{try{const re=await zf(Number(e));if(N)return;c(new Set((re==null?void 0:re.enabled_assessments)||[])),u((re==null?void 0:re.meta)||null)}catch{}},4e3);return()=>{N=!0,window.clearInterval(P)}},[e,d==null?void 0:d.mode,(A=d==null?void 0:d.edit_request)==null?void 0:A.status]);const y=!!(d!=null&&d.locked),m=(d==null?void 0:d.can_edit)!==!1,w=y&&!m,S=(d==null?void 0:d.edit_request)||null,F=String((S==null?void 0:S.status)||"").toUpperCase()==="PENDING";v.useEffect(()=>{if((d==null?void 0:d.mode)!=="SPECIAL_GLOBAL")return;const N=g.current;g.current=m,N===!1&&m===!0&&alert("IQAC approval granted. You can now edit and re-save the enabled exams.")},[m,d==null?void 0:d.mode]);const L=N=>{w||c(P=>{const K=new Set(P);return K.has(N)?K.delete(N):K.add(N),K})},C=async()=>{if(e){o(!0);try{const N=Array.from(l.values()),P=await O6(Number(e),N),K=(P==null?void 0:P.enabled_assessments)||[];c(new Set(K)),u((P==null?void 0:P.meta)||d),x(null),t&&t(K),alert("Saved enabled assessments.")}catch(N){x((N==null?void 0:N.message)||"Save failed"),alert("Save failed: "+((N==null?void 0:N.message)||""))}finally{o(!1)}}},O=async N=>{if(e){p(!0);try{const P=await I6(Number(e));u(K=>({...K||{},locked:!0,can_edit:!1,edit_request:P||{status:"PENDING"}})),alert(N?"Request is already pending. Synced status with server.":"Edit request sent to IQAC for approval.")}catch(P){x((P==null?void 0:P.message)||"Failed to request edit"),alert("Edit request failed: "+((P==null?void 0:P.message)||""))}finally{p(!1)}}},T=async()=>{await O(F),await W()},W=async()=>{if(e)try{a(!0);const N=await zf(Number(e));c(new Set((N==null?void 0:N.enabled_assessments)||[])),u((N==null?void 0:N.meta)||null),x(null)}catch(N){x((N==null?void 0:N.message)||"Failed to refresh")}finally{a(!1)}};return n.jsxs("div",{style:{border:"1px solid #e5e7eb",padding:12,borderRadius:8,background:"#ffffff",maxWidth:520},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[n.jsx("div",{style:{fontWeight:700},children:"Select Exams for this Assignment"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:(d==null?void 0:d.mode)==="SPECIAL_GLOBAL"?"Special course (global lock)":"Faculty override"})]}),(d==null?void 0:d.mode)==="SPECIAL_GLOBAL"&&y&&n.jsxs("div",{style:{fontSize:12,color:w?"#92400e":"#065f46",marginBottom:8},children:[w?"Locked after first save. Edit requires IQAC approval.":"Editing permitted (approved by IQAC/admin).",S!=null&&S.status?n.jsxs("span",{style:{marginLeft:8,color:"#6b7280"},children:["Request: ",String(S.status)]}):null]}),s?n.jsx("div",{style:{color:"#6b7280"},children:"Loading"}):n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:8},children:bK.map(N=>n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("input",{type:"checkbox",checked:l.has(N),onChange:()=>L(N),disabled:w||i}),n.jsx("span",{style:{textTransform:"uppercase",fontSize:13},children:N.toUpperCase()})]},N))}),f&&n.jsx("div",{style:{color:"#b91c1c",marginTop:8},children:f}),n.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[!w&&n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:C,disabled:i||s||!e,children:i?"Saving":"Save"}),w&&(d==null?void 0:d.mode)==="SPECIAL_GLOBAL"&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"obe-btn",onClick:T,disabled:h||i||s||!e,title:F?"Request already pending. Wait for IQAC approval.":void 0,children:h?"Requesting":F?"Edit Request Pending":"Edit (Request IQAC Approval)"}),n.jsx("button",{className:"obe-btn",onClick:W,disabled:i||s||!e,children:"Refresh"})]}),n.jsx("button",{className:"obe-btn",onClick:()=>r&&r(),disabled:i,children:"Close"})]})]})}function wK({teachingAssignmentId:e}){var d,u,h;const[t,r]=v.useState([]),[s,a]=v.useState(!1);v.useEffect(()=>{let p=!0;return(async()=>{try{const f=await B6(e);if(!p)return;const x=f.filter(g=>g.teaching_assignment_id===e);r(x),x.length===0&&a(!0)}catch(f){console.error("Failed to fetch reset notifications:",f),p&&a(!0)}})(),()=>{p=!1}},[e]);const i=async()=>{if(t.length!==0)try{const p=t.map(f=>f.id);await P6(p),a(!0)}catch(p){console.error("Failed to dismiss notifications:",p),a(!0)}};if(s||t.length===0)return null;const o={ssa1:"SSA1",review1:"Review 1",ssa2:"SSA2",review2:"Review 2",cia1:"CIA1",cia2:"CIA2",formative1:"Formative 1",formative2:"Formative 2",model:"Model Exam"},c=[...new Set(t.map(p=>p.assessment))].map(p=>o[p]||p).join(", ");return n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},onClick:i,children:n.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:24,maxWidth:500,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onClick:p=>p.stopPropagation(),children:[n.jsx("h3",{style:{margin:0,marginBottom:12,color:"#dc2626",fontSize:18,fontWeight:800},children:" Course Reset by IQAC"}),n.jsx("p",{style:{margin:0,marginBottom:16,color:"#374151",lineHeight:1.6},children:"The following assessment(s) have been reset by the IQAC administrator:"}),n.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:8,padding:12,marginBottom:16},children:[n.jsxs("div",{style:{fontWeight:700,color:"#991b1b",marginBottom:6},children:[(d=t[0])==null?void 0:d.subject_code,"  ",(u=t[0])==null?void 0:u.subject_name]}),n.jsxs("div",{style:{fontSize:14,color:"#7f1d1d"},children:["Section: ",((h=t[0])==null?void 0:h.section_name)||""]}),n.jsxs("div",{style:{fontSize:14,color:"#7f1d1d",marginTop:4},children:["Assessments: ",c]})]}),n.jsx("p",{style:{margin:0,marginBottom:16,color:"#6b7280",fontSize:14},children:"All previously entered data for these assessment(s) has been cleared. You will need to re-enter the marks."}),n.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:i,style:{minWidth:80},children:"OK"})})]})})}const ib=[{id:"cia1_co1_co2",label:"CIA 1",cos:["CO1","CO2"],assessment:"cia1"},{id:"cia2_co3_co4",label:"CIA 2",cos:["CO3","CO4"],assessment:"cia2"},{id:"model_co1_co2_co3_co4_co5",label:"MODEL",cos:["CO1","CO2","CO3","CO4","CO5"],assessment:"model"},{id:"model_co3_co4_co5",label:"MODEL",cos:["CO3","CO4","CO5"],assessment:"model"},{id:"model_co5",label:"MODEL",cos:["CO5"],assessment:"model"}];function SK({isOpen:e,onClose:t,onSave:r,currentSelection:s}){const[a,i]=v.useState(new Set(s.options)),[o,l]=v.useState(Number(s.divider)||2),[c,d]=v.useState(Number(s.multiplier)||.15),[u,h]=v.useState("");v.useEffect(()=>{i(new Set(s.options)),l(Number(s.divider)||2),d(Number(s.multiplier)||.15),h("")},[s,e]);const p=g=>{const y=new Set(a);if(y.has(g))y.delete(g),i(y),h("");else{const m=ib.find(w=>w.id===g);if(m){const w=new Set;y.forEach(F=>{const L=ib.find(C=>C.id===F);L&&L.cos.forEach(C=>w.add(C))});const k=m.cos.filter(F=>w.has(F));if(k.length>0){h(`Cannot select this option: ${k.join(", ")} already selected in another option. Only one option per CO is allowed.`);return}y.add(g),i(y),h("")}}},f=()=>{const g=Number(o),y=Number(c);if(!Number.isFinite(g)||g<=0){h("Divider must be a number greater than 0.");return}if(!Number.isFinite(y)||y<0){h("Multiplier must be a number greater than or equal to 0.");return}h(""),r({options:Array.from(a),divider:g,multiplier:y}),t()},x=()=>{h(""),i(new Set(s.options)),l(Number(s.divider)||2),d(Number(s.multiplier)||.15),t()};return e?n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:x,children:n.jsxs("div",{style:{backgroundColor:"white",borderRadius:12,padding:24,maxWidth:500,width:"90%",maxHeight:"80vh",overflow:"auto",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},onClick:g=>g.stopPropagation(),children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[n.jsx("h2",{style:{margin:0,fontSize:20,fontWeight:700,color:"#0f172a"},children:"CQI Editor"}),n.jsx("button",{onClick:x,style:{background:"transparent",border:"none",fontSize:24,cursor:"pointer",color:"#64748b",padding:0,width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center"},title:"Close",children:""})]}),n.jsx("div",{style:{fontSize:14,color:"#64748b",marginBottom:20},children:"Select when to show the CQI buttons. Multiple options can be selected as long as COs don't overlap."}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:6,fontWeight:700},children:"TOTAL<58 Divider"}),n.jsx("input",{type:"number",value:String(o),onChange:g=>l(Number(g.target.value)),className:"obe-input",min:.1,step:.1})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:6,fontWeight:700},children:"TOTAL58 Multiplier"}),n.jsx("input",{type:"number",value:String(c),onChange:g=>d(Number(g.target.value)),className:"obe-input",min:0,step:.01})]})]}),u&&n.jsx("div",{style:{padding:12,marginBottom:16,backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:8,color:"#b91c1c",fontSize:13},children:u}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12,marginBottom:24},children:ib.map(g=>n.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:12,padding:16,border:"2px solid",borderColor:a.has(g.id)?"#3b82f6":"#e2e8f0",borderRadius:8,cursor:"pointer",backgroundColor:a.has(g.id)?"#eff6ff":"white",transition:"all 0.2s"},children:[n.jsx("input",{type:"checkbox",checked:a.has(g.id),onChange:()=>p(g.id),style:{marginTop:3,width:18,height:18,cursor:"pointer"}}),n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{style:{fontWeight:600,color:"#0f172a",marginBottom:4},children:[g.label," - ",g.cos.join(" and ")]}),n.jsxs("div",{style:{fontSize:13,color:"#64748b"},children:["Show CQI button after ",g.label," exam"]})]})]},g.id))}),n.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"flex-end"},children:[n.jsx("button",{onClick:x,className:"obe-btn",style:{minWidth:80},children:"Cancel"}),n.jsx("button",{onClick:f,className:"obe-btn obe-btn-primary",style:{minWidth:80},children:"Save"})]})]})}):null}const nx=[{key:"q1",max:2},{key:"q2",max:2},{key:"q3",max:2},{key:"q4",max:2},{key:"q5",max:2},{key:"q6",max:2},{key:"q7",max:2},{key:"q8",max:2},{key:"q9",max:2},{key:"q10",max:2},{key:"q11",max:14},{key:"q12",max:14},{key:"q13",max:14},{key:"q14",max:14},{key:"q15",max:14},{key:"q16",max:10}],r4=[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5,5];function lc(e,t,r){return Math.max(t,Math.min(r,e))}function _K(e){const t=Array.isArray(e)?e:[];return new Set(t.map(r=>String(r||"").trim().toLowerCase()).filter(Boolean))}function n4(e,t){if(Array.isArray(e)){const r=e.slice(0,t).map(s=>typeof s=="number"&&Number.isFinite(s)?s:"");for(;r.length<t;)r.push("");return r}return new Array(t).fill("")}function s4(e){const t=(e||[]).filter(r=>typeof r=="number"&&Number.isFinite(r));return t.length?t.reduce((r,s)=>r+s,0)/t.length:null}function Aa(e){return Math.round(e*100)/100}function kK(e,t){const r=String(t||"").toLowerCase();return r==="ssa"?"SSA":r==="cia"?"CIA":r==="fa"?"FA":r==="review"?"REVIEW":r==="me"?"ME":r==="lab1"?"LAB1":r==="lab2"?"LAB2":String(t||"").toUpperCase()}function il(e){if(e===""||e==null)return null;const t=Number(e);return Number.isFinite(t)?t:null}function jK(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const o=r.localeCompare(s);if(o)return o}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim();return a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})}function a4(e){if(e==="1&2"||e==="both")return"1&2";if(typeof e=="string"){const s=e.trim().toUpperCase().replace(/\s+/g,""),a=s.includes("1"),i=s.includes("2");if(a&&i||s==="1&2"||s==="1,2"||s==="1/2"||s==="2/1"||s==="CO1&CO2"||s==="CO1,CO2"||s==="CO1/CO2"||s==="CO2/CO1")return"1&2";if(s==="CO2"||s==="2")return 2;if(s==="CO1"||s==="1")return 1}if(Array.isArray(e)){const r=e.map(s=>{if(typeof s=="string"){const a=s.match(/\d+/);return Number(a?a[0]:s)}return Number(s)}).filter(s=>Number.isFinite(s));if(r.includes(1)&&r.includes(2))return"1&2";if(r.includes(2))return 2;if(r.includes(1))return 1}const t=Number(typeof e=="string"?(e.match(/\d+/)||[])[0]:e);return t===2?2:t===12?"1&2":1}function i4(e){if(e==="3&4"||e==="both")return"3&4";if(typeof e=="string"){const s=e.trim().toUpperCase().replace(/\s+/g,""),a=s.includes("3"),i=s.includes("4");if(a&&i)return"3&4";if(i)return 4;if(a)return 3;if(s==="3&4"||s==="3,4"||s==="3/4"||s==="4/3"||s==="CO3&CO4"||s==="CO3,CO4"||s==="CO3/CO4"||s==="CO4/CO3")return"3&4";if(s==="CO4"||s==="4")return 4;if(s==="CO3"||s==="3")return 3}if(Array.isArray(e)){const r=e.map(s=>{if(typeof s=="string"){const a=s.match(/\d+/);return Number(a?a[0]:s)}return Number(s)}).filter(s=>Number.isFinite(s));if(r.includes(3)&&r.includes(4))return"3&4";if(r.includes(4))return 4;if(r.includes(3))return 3}const t=Number(typeof e=="string"?(e.match(/\d+/)||[])[0]:e);return t===4?4:t===3?3:t===34?"3&4":3}function NK(e,t){const r=e[t];if(!r)return{co1:0,co2:0};const s=a4(r.co);if(s==="1&2")return{co1:.5,co2:.5};const a=e.some(d=>a4(d==null?void 0:d.co)==="1&2"),i=t===e.length-1,o=String((r==null?void 0:r.key)||"").toLowerCase(),l=String((r==null?void 0:r.label)||"").toLowerCase(),c=o==="q9"||l.includes("q9");return!a&&i&&c?{co1:.5,co2:.5}:s===2?{co1:0,co2:1}:{co1:1,co2:0}}function AK(e,t){const r=e[t];if(!r)return{co3:0,co4:0};const s=i4(r.co);if(s==="3&4")return{co3:.5,co4:.5};const a=e.some(d=>i4(d==null?void 0:d.co)==="3&4"),i=t===e.length-1,o=String((r==null?void 0:r.key)||"").toLowerCase(),l=String((r==null?void 0:r.label)||"").toLowerCase(),c=o==="q9"||l.includes("q9");return!a&&i&&c?{co3:.5,co4:.5}:s===4?{co3:0,co4:1}:{co3:1,co4:0}}function CK({subjectId:e,teachingAssignmentId:t,classType:r,enabledAssessments:s,assessmentType:a,cos:i,cqiDivider:o,cqiMultiplier:l}){const[c,d]=v.useState([]),[u,h]=v.useState(!1),[p,f]=v.useState(null),[x,g]=v.useState({}),[y,m]=v.useState({}),[w,S]=v.useState({}),[k,F]=v.useState(null),L=58,C=v.useMemo(()=>{const N=Number(o);return Number.isFinite(N)&&N>0?N:2},[o]),O=v.useMemo(()=>{const N=Number(l);return Number.isFinite(N)&&N>=0?N:.15},[l]),T=v.useMemo(()=>!i||!Array.isArray(i)?[]:i.map(N=>{const P=N.match(/\d+/);return P?parseInt(P[0]):null}).filter(N=>N!==null).sort((N,P)=>N-P),[i]);v.useEffect(()=>{let N=!0;return(async()=>{try{const P=await Sl();if(!N)return;F(P||null)}catch{}})(),()=>{N=!1}},[e]),v.useEffect(()=>{if(!t)return;let N=!0;return h(!0),f(null),(async()=>{try{const P=await Jo(t);if(!N)return;const K=(P.students||[]).map(re=>({id:Number(re.id),reg_no:String(re.reg_no??""),name:String(re.name??""),section:re.section??null})).filter(re=>Number.isFinite(re.id)).sort(jK);d(K)}catch(P){if(!N)return;f((P==null?void 0:P.message)||"Failed to load roster")}finally{N&&h(!1)}})(),()=>{N=!1}},[t]),v.useEffect(()=>{if(!e||!t)return;const N=`cqi_entries_${e}_${t}`,P=Bn(N);P&&typeof P=="object"&&m(P)},[e,t]),v.useEffect(()=>{if(!e||!t||c.length===0||T.length===0)return;let N=!0;return(async()=>{var P,K,re,ge,Fe,R,q,me,fe,E,U,I,M,te,Q,G,ne,z,he,X,H,oe,D,Y,le,$e;try{h(!0);const je=On(r),We=_K(s),Ee=je==="SPECIAL"&&We.size,Re=se=>Ee?We.has(String(se).toLowerCase()):!0,Ve=je==="TCPR",St=je==="TCPL",rt=je==="LAB"||je==="PRACTICAL",Ie=!rt&&je!=="SPECIAL"&&T.some(se=>se>=1&&se<=5),ot=(()=>{if(!Ie)return null;const se=String(t??"none"),Se=[];je==="THEORY"?(Se.push(`model_theory_sheet_${e}_${se}`),Se.push(`model_theory_sheet_${e}_none`)):je==="TCPL"?(Se.push(`model_tcpl_sheet_${e}_${se}`),Se.push(`model_tcpl_sheet_${e}_none`)):je==="TCPR"&&(Se.push(`model_tcpr_sheet_${e}_${se}`),Se.push(`model_tcpr_sheet_${e}_none`)),Se.push(`model_sheet_${e}`);for(const Ze of Se){const et=Bn(Ze);if(et&&typeof et=="object")return et}return null})(),be=(()=>{const se={co1:0,co2:0,co3:0,co4:0,co5:0};for(let Se=0;Se<nx.length;Se++){const Ze=nx[Se],et=r4[Se];et===1?se.co1+=Ze.max:et===2?se.co2+=Ze.max:et===3?se.co3+=Ze.max:et===4?se.co4+=Ze.max:et===5&&(se.co5+=Ze.max)}return se})(),we=se=>{if(!ot)return null;const Se=`id:${String(se.id)}`,Ze=se.reg_no?`reg:${String(se.reg_no).trim()}`:"",et=ot[Se]||(Ze?ot[Ze]:null)||null;if(!et||typeof et!="object")return null;const Et=!!et.absent,wt=String(et.absentKind||"AL").toUpperCase();if(Et&&wt==="AL")return null;const gt=et.q&&typeof et.q=="object"?et.q:et;let zt=!1;const Dt={co1:0,co2:0,co3:0,co4:0,co5:0};for(let pt=0;pt<nx.length;pt++){const Xt=nx[pt],Rt=il(gt[Xt.key]);if(Rt==null)continue;zt=!0;const _t=r4[pt];_t===1?Dt.co1+=Rt:_t===2?Dt.co2+=Rt:_t===3?Dt.co3+=Rt:_t===4?Dt.co4+=Rt:_t===5&&(Dt.co5+=Rt)}if(!zt)return null;const mr=(pt,Xt,Rt)=>!Xt||!Number.isFinite(Xt)||Xt<=0?0:lc(lc(pt,0,Xt)/Xt*Rt,0,Rt);return{co1:mr(Dt.co1,be.co1,2),co2:mr(Dt.co2,be.co2,2),co3:mr(Dt.co3,be.co3,2),co4:mr(Dt.co4,be.co4,2),co5:mr(Dt.co5,be.co5,4)}},Me=T.some(se=>se===1||se===2),Wt=T.some(se=>se===3||se===4),Ct=T.some(se=>se===5),[pr,fr,Be,mt,It,ft,gr,Mr,$r,_r,Vr,en,Xr]=await Promise.all([Me&&Re("ssa1")&&!rt?S0(e,t).catch(()=>({marks:{}})):{marks:{}},Wt&&Re("ssa2")&&!rt?Op(e,t).catch(()=>({marks:{}})):{marks:{}},Me&&Re("formative1")&&!rt&&!Ve&&!St?cg(e,t).catch(()=>({marks:{}})):{marks:{}},Wt&&Re("formative2")&&!rt&&!Ve&&!St?bu("formative2",e,t).catch(()=>({marks:{}})):{marks:{}},Me&&Re("cia1")&&!rt?Ip(e,t).catch(()=>({data:null})):{data:null},Wt&&Re("cia2")&&!rt?vu("cia2",e,t).catch(()=>({data:null})):{data:null},Me&&Re("review1")&&Ve?og(e).catch(()=>({marks:{}})):{marks:{}},Wt&&Re("review2")&&Ve?lg(e).catch(()=>({marks:{}})):{marks:{}},Me&&Re("formative1")&&St?(async()=>{try{const se=await En("formative1",e,t);if(se!=null&&se.draft)return{data:se.draft.data??se.draft}}catch{}return wa("formative1",e,t).catch(()=>({data:null}))})():{data:null},Wt&&Re("formative2")&&St?(async()=>{try{const se=await En("formative2",e,t);if(se!=null&&se.draft)return{data:se.draft.data??se.draft}}catch{}return wa("formative2",e,t).catch(()=>({data:null}))})():{data:null},Me&&Re("cia1")&&rt?(async()=>{try{const se=await En("cia1",e,t);if(se!=null&&se.draft)return{data:se.draft.data??se.draft}}catch{}return wa("cia1",e,t).catch(()=>({data:null}))})():{data:null},Wt&&Re("cia2")&&rt?(async()=>{try{const se=await En("cia2",e,t);if(se!=null&&se.draft)return{data:se.draft.data??se.draft}}catch{}return wa("cia2",e,t).catch(()=>({data:null}))})():{data:null},Ct&&Re("model")&&rt?(async()=>{try{const se=await En("model",e,t);if(se!=null&&se.draft)return{data:se.draft.data??se.draft}}catch{}return wa("model",e,t).catch(()=>({data:null}))})():{data:null}]);if(!N)return;const gn={ssa:1.5,cia:3,fa:2.5},Oe={ssa:gn.ssa,cia:gn.cia,fa:gn.fa},qe=((P=k==null?void 0:k.assessments)==null?void 0:P.ssa1)||{},Lt=((K=k==null?void 0:k.assessments)==null?void 0:K.ssa2)||{},dt=((re=k==null?void 0:k.assessments)==null?void 0:re.formative1)||{},He=((ge=k==null?void 0:k.assessments)==null?void 0:ge.formative2)||{},$t=((Fe=k==null?void 0:k.assessments)==null?void 0:Fe.cia1)||{},Ue=((R=k==null?void 0:k.assessments)==null?void 0:R.cia2)||{},er=((q=k==null?void 0:k.assessments)==null?void 0:q.review1)||{},Z=((me=k==null?void 0:k.assessments)==null?void 0:me.review2)||{},pe={ssa1:{co1:Number((fe=qe==null?void 0:qe.coMax)==null?void 0:fe.co1)||10,co2:Number((E=qe==null?void 0:qe.coMax)==null?void 0:E.co2)||10},ssa2:{co3:Number(((U=Lt==null?void 0:Lt.coMax)==null?void 0:U.co3)??((I=Lt==null?void 0:Lt.coMax)==null?void 0:I.co1))||10,co4:Number(((M=Lt==null?void 0:Lt.coMax)==null?void 0:M.co4)??((te=Lt==null?void 0:Lt.coMax)==null?void 0:te.co2))||10},cia1:{co1:Number((Q=$t==null?void 0:$t.coMax)==null?void 0:Q.co1)||30,co2:Number((G=$t==null?void 0:$t.coMax)==null?void 0:G.co2)||30},cia2:{co3:Number(((ne=Ue==null?void 0:Ue.coMax)==null?void 0:ne.co3)??((z=Ue==null?void 0:Ue.coMax)==null?void 0:z.co1))||30,co4:Number(((he=Ue==null?void 0:Ue.coMax)==null?void 0:he.co4)??((X=Ue==null?void 0:Ue.coMax)==null?void 0:X.co2))||30},f1:{co1:Number(dt==null?void 0:dt.maxCo)||10,co2:Number(dt==null?void 0:dt.maxCo)||10},f2:{co3:Number(He==null?void 0:He.maxCo)||10,co4:Number(He==null?void 0:He.maxCo)||10},review1:{co1:Number((H=er==null?void 0:er.coMax)==null?void 0:H.co1)||15,co2:Number((oe=er==null?void 0:er.coMax)==null?void 0:oe.co2)||15},review2:{co3:Number(((D=Z==null?void 0:Z.coMax)==null?void 0:D.co3)??((Y=Z==null?void 0:Z.coMax)==null?void 0:Y.co1))||15,co4:Number(((le=Z==null?void 0:Z.coMax)==null?void 0:le.co4)??(($e=Z==null?void 0:Z.coMax)==null?void 0:$e.co2))||15}},ee=se=>{const Se=se!=null&&se.sheet&&typeof se.sheet=="object"?se.sheet:{},Ze=Se!=null&&Se.rowsByStudentId&&typeof Se.rowsByStudentId=="object"?Se.rowsByStudentId:{},et=lc(Number((Se==null?void 0:Se.expCountA)??0),0,12),Et=lc(Number((Se==null?void 0:Se.expCountB)??0),0,12),wt=Number.isFinite(Number(Se==null?void 0:Se.expMaxA))?Number(Se.expMaxA):25,gt=Number.isFinite(Number(Se==null?void 0:Se.expMaxB))?Number(Se.expMaxB):25,zt=(Se==null?void 0:Se.ciaExamEnabled)!==!1,Dt=30/2,mr=wt+(zt?Dt:0),pt=gt+(zt?Dt:0);return{get:Rt=>{const _t=Ze[String(Rt)]||{},jr=n4(_t==null?void 0:_t.marksA,et),Gr=n4(_t==null?void 0:_t.marksB,Et),Cr=s4(jr),Rr=s4(Gr),De=_t==null?void 0:_t.ciaExam,Ke=typeof De=="number"&&Number.isFinite(De)?De:null,Ce=Cr!=null||Rr!=null||Ke!=null,it=Ce?(Cr??0)+(zt?(Ke??0)/2:0):null,tr=Ce?(Rr??0)+(zt?(Ke??0)/2:0):null;return{a:it==null?null:lc(it,0,mr),b:tr==null?null:lc(tr,0,pt)}},CO_MAX_A:mr,CO_MAX_B:pt}},ue=St?ee(($r==null?void 0:$r.data)??null):null,Ae=St?ee((_r==null?void 0:_r.data)??null):null,Le=rt?ee((Vr==null?void 0:Vr.data)??null):null,ct=rt?ee((en==null?void 0:en.data)??null):null,ce=rt?ee((Xr==null?void 0:Xr.data)??null):null,xe={};c.forEach(se=>{xe[se.id]={};const Se=Ie?we(se):null;T.forEach(Ze=>{let et=null,Et=0,wt=null,gt=0,zt=null,Dt=0,mr=null,pt=0,Xt=null,Rt=0;if(Se){const jr=`co${Ze}`;jr in Se&&(Xt=Number(Se[jr]),Rt=Ze===5?4:2)}if(Ze===1||Ze===2)if(rt){if(Le){const jr=Le.get(se.id),Gr=Ze===1?jr.a:jr.b;Gr!=null&&(wt=Gr,gt=Ze===1?Le.CO_MAX_A:Le.CO_MAX_B)}}else{const jr=il(pr.marks[String(se.id)]);et=jr==null?null:Number(jr)/2,Et=Ze===1?pe.ssa1.co1:pe.ssa1.co2;const Cr=It.data;if(Cr){const De=(Cr.rowsByStudentId||{})[String(se.id)]||{},Ke=Cr.questions||[],Ce=De!=null&&De.q&&typeof De.q=="object"?De.q:De;let it=!1,tr=0,Kt=0;Ke.forEach((yt,Ht)=>{const qt=Number((yt==null?void 0:yt.max)||0),lr=NK(Ke,Ht),Mt=Ze===2?lr.co2:lr.co1;Mt>0&&qt>0&&(Kt+=qt*Mt);const tt=il(Ce==null?void 0:Ce[yt.key]);if(tt==null||Mt<=0)return;it=!0;const Ft=qt>0?lc(tt,0,qt):tt;tr+=Ft*Mt}),it&&(wt=tr,gt=Kt>0?Kt:Ze===1?pe.cia1.co1:pe.cia1.co2)}if(Ve){const Rr=il(gr.marks[String(se.id)]),De=Rr==null?null:Number(Rr)/2;De!=null&&(zt=De,Dt=Ze===1?pe.review1.co1:pe.review1.co2)}if(St&&ue){const Rr=ue.get(se.id),De=Ze===1?Rr.a:Rr.b;De!=null&&(mr=De,pt=Ze===1?ue.CO_MAX_A:ue.CO_MAX_B)}if(!Ve&&!St){const Rr=(Be.marks||{})[String(se.id)]||{},De=Ze===1?"skill1":"skill2",Ke=Ze===1?"att1":"att2",Ce=il(Rr[De]),it=il(Rr[Ke]);Ce!==null&&it!==null&&(mr=Ce+it,pt=Ze===1?pe.f1.co1:pe.f1.co2)}}else if(Ze===3||Ze===4)if(rt){if(ct){const jr=ct.get(se.id),Gr=Ze===3?jr.a:jr.b;Gr!=null&&(wt=Gr,gt=Ze===3?ct.CO_MAX_A:ct.CO_MAX_B)}}else{const jr=il(fr.marks[String(se.id)]);et=jr==null?null:Number(jr)/2,Et=Ze===3?pe.ssa2.co3:pe.ssa2.co4;const Cr=ft.data;if(Cr){const De=(Cr.rowsByStudentId||{})[String(se.id)]||{},Ke=Cr.questions||[],Ce=De!=null&&De.q&&typeof De.q=="object"?De.q:De;let it=!1,tr=0,Kt=0;Ke.forEach((yt,Ht)=>{const qt=Number((yt==null?void 0:yt.max)||0),lr=AK(Ke,Ht),Mt=Ze===4?lr.co4:lr.co3;Mt>0&&qt>0&&(Kt+=qt*Mt);const tt=il(Ce==null?void 0:Ce[yt.key]);if(tt==null||Mt<=0)return;it=!0;const Ft=qt>0?lc(tt,0,qt):tt;tr+=Ft*Mt}),it&&(wt=tr,gt=Kt>0?Kt:Ze===3?pe.cia2.co3:pe.cia2.co4)}if(Ve){const Rr=il(Mr.marks[String(se.id)]),De=Rr==null?null:Number(Rr)/2;De!=null&&(zt=De,Dt=Ze===3?pe.review2.co3:pe.review2.co4)}if(St&&Ae){const Rr=Ae.get(se.id),De=Ze===3?Rr.a:Rr.b;De!=null&&(mr=De,pt=Ze===3?Ae.CO_MAX_A:Ae.CO_MAX_B)}if(!Ve&&!St){const Rr=(mt.marks||{})[String(se.id)]||{},De=Ze===3?"skill1":"skill2",Ke=Ze===3?"att1":"att2",Ce=il(Rr[De]),it=il(Rr[Ke]);Ce!==null&&it!==null&&(mr=Ce+it,pt=Ze===3?pe.f2.co3:pe.f2.co4)}}if(rt&&Ze===5&&ce){const jr=ce.get(se.id);jr.a!=null&&(Xt=jr.a,Rt=ce.CO_MAX_A)}const _t=[];if(et!==null&&Et>0&&_t.push({key:"ssa",mark:et,max:Et,w:Oe.ssa}),wt!==null&&gt>0&&_t.push({key:"cia",mark:wt,max:gt,w:Oe.cia}),zt!==null&&Dt>0&&_t.push({key:"review",mark:zt,max:Dt,w:Oe.fa}),mr!==null&&pt>0){const jr=St?Ze===1||Ze===2?"lab1":Ze===3||Ze===4?"lab2":"fa":"fa";_t.push({key:jr,mark:mr,max:pt,w:Oe.fa})}if(Xt!==null&&Rt>0&&_t.push({key:"me",mark:Xt,max:Rt,w:Rt}),_t.length>0){const Gr=_t.reduce((De,Ke)=>De+Ke.w,0),Cr=_t.reduce((De,Ke)=>{const Ce=Ke.mark/Ke.max;return De+Ce*Ke.w},0),Rr=_t.map(De=>({...De,contrib:Aa(De.mark/De.max*De.w)}));xe[se.id][`co${Ze}`]={value:Aa(Cr),max:Aa(Gr),breakdown:Rr}}else xe[se.id][`co${Ze}`]=null})}),g(xe)}catch(je){if(!N)return;f((je==null?void 0:je.message)||"Failed to calculate CO totals")}finally{N&&h(!1)}})(),()=>{N=!1}},[e,t,r,s,c,T,k]);const W=(N,P,K)=>{if(K===""){S(R=>{const q={...R};return delete q[`${N}_${P}`],q}),m(R=>({...R,[N]:{...R[N],[P]:null}}));return}const re=Number(K);if(!(Number.isFinite(re)&&Math.floor(re)===re)){S(R=>({...R,[`${N}_${P}`]:"Enter an integer between 0 and 10"})),m(R=>({...R,[N]:{...R[N],[P]:null}}));return}const Fe=re;if(Fe<0||Fe>10){S(R=>({...R,[`${N}_${P}`]:"Value must be between 0 and 10"})),m(R=>({...R,[N]:{...R[N],[P]:Fe}}));return}S(R=>{const q={...R};return delete q[`${N}_${P}`],q}),m(R=>{const q={...R,[N]:{...R[N],[P]:Fe}};if(e&&t){const me=`cqi_entries_${e}_${t}`;try{yn(me,q)}catch{}}return q})},A=()=>{if(!e||!t)return;if(Object.keys(w).length){alert("Fix CQI input errors before saving");return}const N=`cqi_entries_${e}_${t}`;try{yn(N,y),alert("CQI entries saved successfully!")}catch(P){alert("Failed to save CQI entries: "+String((P==null?void 0:P.message)||P))}};return!e||!t?n.jsx("div",{style:{padding:24,color:"#b91c1c"},children:"Missing subject ID or teaching assignment ID"}):u?n.jsx("div",{style:{padding:24,textAlign:"center",color:"#6b7280"},children:"Loading CQI data..."}):p?n.jsxs("div",{style:{padding:24,color:"#b91c1c"},children:["Error: ",p]}):T.length===0?n.jsx("div",{style:{padding:24,color:"#b91c1c"},children:"No course outcomes selected for CQI entry"}):n.jsxs("div",{style:{padding:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,padding:16,background:"linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)",borderRadius:12,border:"1px solid #bae6fd"},children:[n.jsxs("div",{children:[n.jsxs("h2",{style:{margin:0,fontSize:20,fontWeight:700,color:"#0f172a"},children:["CQI Entry - ",i==null?void 0:i.join(", ")]}),n.jsxs("div",{style:{marginTop:4,fontSize:14,color:"#64748b"},children:["Students below ",L,"% threshold require CQI intervention"]})]}),n.jsx("button",{onClick:A,className:"obe-btn obe-btn-primary",style:{minWidth:100},children:"Save CQI"})]}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:10},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"2px solid #e2e8f0"},children:[n.jsx("th",{style:{padding:"12px 8px",textAlign:"left",fontWeight:700,color:"#475569",minWidth:60},children:"S.No"}),n.jsx("th",{style:{padding:"12px 8px",textAlign:"left",fontWeight:700,color:"#475569",minWidth:120},children:"Reg No"}),n.jsx("th",{style:{padding:"12px 8px",textAlign:"left",fontWeight:700,color:"#475569",minWidth:200},children:"Name"}),n.jsxs("th",{style:{padding:"12px 8px",textAlign:"center",fontWeight:700,color:"#475569",minWidth:100},children:["BEFORE CQI",n.jsx("div",{style:{fontSize:11,fontWeight:400,color:"#94a3b8",marginTop:2},children:"Total / Max"})]}),n.jsxs("th",{style:{padding:"12px 8px",textAlign:"center",fontWeight:700,color:"#475569",minWidth:100},children:["AFTER CQI",n.jsx("div",{style:{fontSize:11,fontWeight:400,color:"#94a3b8",marginTop:2},children:"Total / Max"})]}),n.jsxs("th",{style:{padding:"12px 8px",textAlign:"center",fontWeight:700,color:"#475569",minWidth:120},children:["TOTAL",n.jsx("div",{style:{fontSize:11,fontWeight:400,color:"#94a3b8",marginTop:2},children:"Sum of selected COs"})]}),T.map(N=>n.jsxs("th",{style:{padding:"12px 8px",textAlign:"center",fontWeight:700,color:"#475569",minWidth:150},children:["CO",N,n.jsx("div",{style:{fontSize:11,fontWeight:400,color:"#94a3b8",marginTop:2},children:"Current / Max"})]},N))]})}),n.jsx("tbody",{children:c.map((N,P)=>{const K=x[N.id]||{};let re=0,ge=0;T.forEach(te=>{const Q=K[`co${te}`];Q&&(re+=Q.value,ge+=Q.max)});const Fe=re,R=ge,q=R?Fe/R*100:0,me=ge?re/ge*100:0,fe=R?q:me,E=ge;let U=re,I=0;T.forEach(te=>{var oe;const Q=`co${te}`,G=K[Q],ne=(oe=y[N.id])==null?void 0:oe[Q];if(!G||ne==null||!((G.max?Number(G.value)/Number(G.max)*100:0)<L))return;const X=Number(ne)/10*Number(G.max),H=fe<L?X/C:X*O;Number.isFinite(H)&&H>0&&(I+=H,U+=H)}),U=Number.isFinite(U)?lc(U,0,E||U):re;const M=E?U/E*100:0;return n.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb",backgroundColor:P%2===0?"white":"#f9fafb"},children:[n.jsx("td",{style:{padding:"10px 8px",color:"#64748b"},children:P+1}),n.jsx("td",{style:{padding:"10px 8px",fontFamily:"monospace",color:"#0f172a"},children:N.reg_no}),n.jsx("td",{style:{padding:"10px 8px",color:"#0f172a"},children:N.name}),n.jsx("td",{style:{padding:"10px 8px",textAlign:"center",fontWeight:600},children:ge>0?n.jsxs("div",{children:[n.jsxs("div",{style:{color:"#0f172a",fontSize:14},children:[Aa(re)," / ",Aa(ge)]}),n.jsxs("div",{style:{fontSize:12,color:"#64748b",marginTop:2},children:["(",Aa(me),"%)"]})]}):n.jsx("span",{style:{color:"#94a3b8"},children:""})}),n.jsx("td",{style:{padding:"10px 8px",textAlign:"center",fontWeight:600,backgroundColor:U>re?"#f0fdf4":"transparent"},children:E>0?n.jsxs("div",{children:[n.jsxs("div",{style:{color:"#0f172a",fontSize:14},children:[Aa(U)," / ",Aa(E)]}),n.jsxs("div",{style:{fontSize:12,color:"#64748b",marginTop:2},children:["(",Aa(M),"%)"]}),I>0&&n.jsxs("div",{style:{fontSize:11,color:"#16a34a",marginTop:2},children:["+",Aa(I)]})]}):n.jsx("span",{style:{color:"#94a3b8"},children:""})}),n.jsx("td",{style:{padding:"10px 8px",textAlign:"center",fontWeight:700},children:R>0?n.jsxs("div",{children:[n.jsxs("div",{style:{color:"#0f172a",fontSize:14},children:[Aa(q),"%"]}),n.jsxs("div",{style:{fontSize:12,color:"#64748b",marginTop:6},children:[Aa(Fe)," / ",Aa(R)]})]}):n.jsx("span",{style:{color:"#94a3b8"},children:""})}),T.map(te=>{var X;const Q=`co${te}`,G=K[Q];if(!G)return n.jsx("td",{style:{padding:"10px 8px",textAlign:"center",color:"#94a3b8"},children:""},te);const ne=G.max?G.value/G.max*100:0,z=ne<L,he=(X=y[N.id])==null?void 0:X[Q];return n.jsxs("td",{style:{padding:"10px 8px",textAlign:"center",backgroundColor:z?"#fef2f2":"#f0fdf4"},children:[n.jsxs("div",{style:{fontSize:13,color:"#64748b",marginBottom:6},children:[n.jsxs("div",{children:[Aa(G.value)," / ",Aa(G.max)," (",Aa(ne),"%)"]}),Array.isArray(G.breakdown)&&n.jsx("div",{style:{marginTop:6,fontSize:11,color:"#94a3b8"},children:G.breakdown.map(H=>n.jsxs("div",{style:{display:"inline-block",marginRight:8},children:[kK(On(r),String(H.key||"")),": ",Aa(H.mark)," / ",Aa(H.max)," =",Aa(H.contrib)]},H.key))})]}),z?n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:11,color:"#dc2626",fontWeight:600,marginBottom:4},children:"CQI ATTAINED"}),n.jsx("input",{type:"number",value:he??"",onChange:H=>W(N.id,Q,H.target.value),placeholder:"Enter CQI",className:"obe-input",style:{width:90,padding:"4px 8px",fontSize:13,textAlign:"center"}}),w[`${N.id}_${Q}`]&&n.jsx("div",{style:{color:"#dc2626",fontSize:11,marginTop:6},children:w[`${N.id}_${Q}`]})]}):n.jsx("div",{style:{fontSize:12,color:"#16a34a",fontWeight:600},children:" NO CQI"})]},te)})]},N.id)})})]})}),c.length===0&&n.jsx("div",{style:{textAlign:"center",padding:32,color:"#94a3b8"},children:"No students found in this section"})]})}const ch=[{key:"dashboard",label:"Dashboard"},{key:"ssa1",label:"SSA1"},{key:"formative1",label:"Formative 1"},{key:"cia1",label:"CIA 1"},{key:"ssa2",label:"SSA2"},{key:"formative2",label:"Formative 2"},{key:"cia2",label:"CIA 2"},{key:"model",label:"MODEL"}];function EK(e){const t=Array.isArray(e)?e:[];return new Set(t.map(r=>String(r||"").trim().toLowerCase()).filter(Boolean))}function TK(e,t){const r=On(e),s=EK(t);if(r==="SPECIAL"){const a=new Set(["dashboard"]);return["ssa1","ssa2","formative1","formative2","cia1","cia2"].forEach(i=>{s.has(i)&&a.add(i)}),ch.filter(i=>a.has(i.key))}return r==="PRACTICAL"?ch.filter(a=>["dashboard","cia1","cia2","model"].includes(a.key)).map(a=>a.key==="cia1"?{...a,label:"CIA 1 Review"}:a.key==="cia2"?{...a,label:"CIA 2 Review"}:a.key==="model"?{...a,label:"MODEL Review"}:a):r==="PROJECT"?[{key:"dashboard",label:"Dashboard"},{key:"review1",label:"Review 1"},{key:"review2",label:"Review 2"},{key:"model",label:"MODEL Review"}]:r==="TCPR"?[{key:"dashboard",label:"Dashboard"},{key:"ssa1",label:"SSA1"},{key:"review1",label:"Review 1"},{key:"cia1",label:"CIA 1"},{key:"ssa2",label:"SSA2"},{key:"review2",label:"Review 2"},{key:"cia2",label:"CIA 2"},{key:"model",label:"MODEL"}]:r==="TCPL"?ch.map(a=>a.key==="formative1"?{...a,label:"LAB 1"}:a.key==="formative2"?{...a,label:"LAB 2"}:a):r==="LAB"?ch.filter(a=>["dashboard","cia1","cia2","model"].includes(a.key)).map(a=>a.key==="cia1"?{...a,label:"CIA 1 LAB"}:a.key==="cia2"?{...a,label:"CIA 2 LAB"}:a.key==="model"?{...a,label:"MODEL LAB"}:a):ch}function x8(e,t){return`marks_${e}_${t}`}function LK(e,t){const r=String(t||"").trim().toLowerCase();ol(`marks_${e}_${r}`),r==="ssa1"&&ol(`ssa1_sheet_${e}`),r==="review1"&&ol(`review1_sheet_${e}`),r==="ssa2"&&ol(`ssa2_sheet_${e}`),r==="review2"&&ol(`review2_sheet_${e}`),r==="formative1"&&ol(`formative1_sheet_${e}`),r==="formative2"&&ol(`formative2_sheet_${e}`),r==="cia1"&&ol(`cia1_sheet_${e}`),r==="cia2"&&ol(`cia2_sheet_${e}`),r==="model"&&ol(`model_sheet_${e}`)}function FK(e,t){const r=`studentId,mark
`,s=t.map(l=>`${String(l.studentId||"").replace(/\n/g," ")},${Number(l.mark||0)}`).join(`
`),a=new Blob([r+s],{type:"text/csv"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function MK({active:e,label:t,onClick:r}){return n.jsx("button",{onClick:r,className:`obe-sidebar-btn ${e?"active":""}`,children:t})}function RK({subjectId:e,tab:t}){const r=v.useMemo(()=>x8(e,t),[e,t]),[s,a]=v.useState([]);v.useEffect(()=>{const u=Bn(r)||[];a(Array.isArray(u)?u:[])},[r]);const i=()=>a(u=>[...u,{studentId:"",mark:0}]),o=(u,h,p)=>{a(f=>{const x=[...f],g=x[u]||{studentId:"",mark:0};return x[u]={...g,[h]:p},x})},l=u=>{a(h=>h.filter((p,f)=>f!==u))},c=()=>{yn(r,s),alert("Marks saved locally.")},d=()=>{FK(`${e}_${t}_marks.csv`,s)};return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",gap:8,marginBottom:10,flexWrap:"wrap"},children:[n.jsx("button",{onClick:i,className:"obe-btn obe-btn-primary",children:"Add Row"}),n.jsx("button",{onClick:c,className:"obe-btn obe-btn-success",children:"Save Local"}),n.jsx("button",{onClick:d,className:"obe-btn obe-btn-secondary",disabled:!s.length,title:s.length?"Export as CSV":"Add at least one row to export",children:"Export CSV"})]}),s.length===0?n.jsx("div",{style:{color:"#6b7280",fontSize:14,padding:"12px 0"},children:"No rows yet. Click Add Row to start."}):n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:s.map((u,h)=>n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 120px 90px",gap:8,alignItems:"center"},children:[n.jsx("input",{value:u.studentId,onChange:p=>o(h,"studentId",p.target.value),placeholder:"Student ID",className:"obe-input"}),n.jsx("input",{type:"number",value:u.mark,onChange:p=>o(h,"mark",Number(p.target.value)),className:"obe-input"}),n.jsx("button",{onClick:()=>l(h),className:"obe-btn obe-btn-danger",children:"Remove"})]},h))}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:["Saved key: ",n.jsx("span",{style:{fontFamily:"monospace"},children:r})]})]})}function Yw({subjectId:e,classType:t,questionPaperType:r,enabledAssessments:s,teachingAssignmentsOverride:a,fixedTeachingAssignmentId:i,iqacResetEnabled:o,viewerMode:l}){var he,X;const[c,d]=v.useState("dashboard"),[u,h]=v.useState([]),[p,f]=v.useState(null),[x,g]=v.useState(null),[y,m]=v.useState(void 0),[w,S]=v.useState(!1),[k,F]=v.useState(!1),[L,C]=v.useState(0),[O,T]=v.useState(!1),[W,A]=v.useState([]),[N,P]=v.useState(2),[K,re]=v.useState(.15),[ge,Fe]=v.useState(null),R=v.useMemo(()=>x==null?null:(u||[]).find(H=>H.id===x)||null,[u,x]),[q,me]=v.useState(null),[fe,E]=v.useState(null);v.useEffect(()=>{let H=!0;return(async()=>{if(me(null),E(null),x==null)return;const oe=R||null,D=String((oe==null?void 0:oe.class_type)||"").trim(),Y=!!String((oe==null?void 0:oe.academic_year)||"").trim(),le=typeof(oe==null?void 0:oe.semester)<"u"&&(oe==null?void 0:oe.semester)!=null,$e=!!(oe!=null&&oe.department||oe!=null&&oe.department_name),je=!!String((oe==null?void 0:oe.section_name)||"").trim();if(D&&Y&&le&&$e&&je){me(D);return}const We=String(t||"").trim();try{const Ee=await Jo(Number(x));if(!H)return;const Re=(Ee==null?void 0:Ee.teaching_assignment)||{},Ve=String((Re==null?void 0:Re.class_type)||"").trim();me(Ve||D||We||null),E({academic_year:(Re==null?void 0:Re.academic_year)||(Re==null?void 0:Re.academic_year_name)||(Re==null?void 0:Re.year)||null,semester:typeof(Re==null?void 0:Re.semester)<"u"?Re==null?void 0:Re.semester:null,department:(Re==null?void 0:Re.department)||(Re==null?void 0:Re.department_name)||null,section_name:(Re==null?void 0:Re.section_name)||(Re==null?void 0:Re.section)||null})}catch{if(!H)return;me(D||We||null),E(null)}})(),()=>{H=!1}},[x,R,t]);const U=v.useMemo(()=>{const H=String((R==null?void 0:R.class_type)||"").trim();if(H)return H;const oe=String(q||"").trim();return oe||String(t||"").trim()||null},[R,q,t]),I=v.useMemo(()=>On(U),[U]),M=v.useMemo(()=>I==="SPECIAL",[I]),te=y===void 0?s:y,Q=v.useMemo(()=>TK(U,te),[U,s,y]);v.useEffect(()=>{if(!e)return;const H=Bn(`markEntry_activeTab_${e}`);H&&Q.some(oe=>oe.key===H)&&d(H)},[e]),v.useEffect(()=>{c!=="cqi"&&(Q.some(H=>H.key===c)||d("dashboard"))},[Q,c]),v.useEffect(()=>{var D;if(!e||!a)return;const H=(a||[]).filter(Y=>String(Y.subject_code)===String(e));h(H),f(null);const oe=typeof i=="number"&&H.some(Y=>Y.id===i)&&i||(((D=H[0])==null?void 0:D.id)??null);g(oe)},[e,a,i]),v.useEffect(()=>{let H=!0;if(!(a&&Array.isArray(a)))return(async()=>{var oe;try{const D=await wl();if(!H)return;let Y=(D||[]).filter(je=>je.subject_code===e);if(Y.length===0)try{const je=await hr(`/api/academics/teaching-assignments/?subject_code=${encodeURIComponent(String(e||""))}`);if(je.ok){const We=await je.json();Y=(Array.isArray(We.results)?We.results:Array.isArray(We)?We:We.items||[])||[]}}catch(je){console.warn("Server TA list fetch failed:",je)}h(Y),f(null);const le=Bn(`markEntry_selectedTa_${e}`),$e=typeof i=="number"&&Y.some(je=>je.id===i)&&i||typeof le=="number"&&Y.some(je=>je.id===le)&&le||(((oe=Y[0])==null?void 0:oe.id)??null);g($e)}catch(D){if(!H)return;h([]),g(null),f((D==null?void 0:D.message)||"Failed to load teaching assignments")}})(),()=>{H=!1}},[e,a,i]),v.useEffect(()=>{e&&x!=null&&typeof i!="number"&&yn(`markEntry_selectedTa_${e}`,x)},[e,x,i]),v.useEffect(()=>{let H=!0;if(e){if(x==null){m(void 0);return}if(!M){m(void 0);return}return(async()=>{try{const oe=await zf(Number(x)),D=oe==null?void 0:oe.enabled_assessments;if(!H)return;m(Array.isArray(D)&&D.length?D:null)}catch(oe){if(!H)return;m(void 0),f((oe==null?void 0:oe.message)||"Failed to load faculty enabled assessments")}})(),()=>{H=!1}}},[e,x,M]),v.useEffect(()=>{e&&yn(`markEntry_activeTab_${e}`,c)},[e,c]),v.useEffect(()=>{if(!e)return;const H=Bn(`cqi_config_${e}`);if(Array.isArray(H)){A(H),P(2),re(.15);return}if(H&&typeof H=="object"){const oe=Array.isArray(H.options)?H.options:[],D=Number(H.divider),Y=Number(H.multiplier);A(oe),P(Number.isFinite(D)&&D>0?D:2),re(Number.isFinite(Y)&&Y>=0?Y:.15)}},[e]);const G=H=>{const oe=Array.isArray(H==null?void 0:H.options)?H.options:[],D=Number(H==null?void 0:H.divider),Y=Number(H==null?void 0:H.multiplier);A(oe),P(Number.isFinite(D)&&D>0?D:2),re(Number.isFinite(Y)&&Y>=0?Y:.15),e&&(oe.length>0?yn(`cqi_config_${e}`,{options:oe,divider:Number.isFinite(D)&&D>0?D:2,multiplier:Number.isFinite(Y)&&Y>=0?Y:.15}):ol(`cqi_config_${e}`))},ne=v.useMemo(()=>{if(!W||W.length===0)return[];const H={cia1_co1_co2:{assessment:"cia1",cos:["CO1","CO2"],label:"CIA 1"},cia2_co3_co4:{assessment:"cia2",cos:["CO3","CO4"],label:"CIA 2"},model_co1_co2_co3_co4_co5:{assessment:"model",cos:["CO1","CO2","CO3","CO4","CO5"],label:"MODEL"},model_co3_co4_co5:{assessment:"model",cos:["CO3","CO4","CO5"],label:"MODEL"},model_co5:{assessment:"model",cos:["CO5"],label:"MODEL"}};return W.map(oe=>H[oe]).filter(Boolean)},[W]);v.useEffect(()=>{ne.length>0&&!ge?Fe(ne[0]):ne.length===0&&ge&&(Fe(null),c==="cqi"&&d("dashboard"))},[ne,ge,c]);const z=v.useMemo(()=>{if(!e)return{};const H={};for(const oe of Q){if(oe.key==="dashboard")continue;if(oe.key==="ssa1"){const Y=Bn(`ssa1_sheet_${e}`),le=Y==null?void 0:Y.rows;H[oe.key]=Array.isArray(le)?le.length:0;continue}if(oe.key==="review1"){const Y=Bn(`review1_sheet_${e}`),le=Y==null?void 0:Y.rows;H[oe.key]=Array.isArray(le)?le.length:0;continue}if(oe.key==="ssa2"){const Y=Bn(`ssa2_sheet_${e}`),le=Y==null?void 0:Y.rows;H[oe.key]=Array.isArray(le)?le.length:0;continue}if(oe.key==="review2"){const Y=Bn(`review2_sheet_${e}`),le=Y==null?void 0:Y.rows;H[oe.key]=Array.isArray(le)?le.length:0;continue}if(oe.key==="formative1"){const Y=Bn(`formative1_sheet_${e}`),le=Y==null?void 0:Y.rowsByStudentId;H[oe.key]=le&&typeof le=="object"?Object.keys(le).length:0;continue}if(oe.key==="formative2"){const Y=Bn(`formative2_sheet_${e}`),le=Y==null?void 0:Y.rowsByStudentId;H[oe.key]=le&&typeof le=="object"?Object.keys(le).length:0;continue}if(oe.key==="cia1"){const Y=Bn(`cia1_sheet_${e}`),le=Y==null?void 0:Y.rowsByStudentId;H[oe.key]=le&&typeof le=="object"?Object.keys(le).length:0;continue}if(oe.key==="cia2"){const Y=Bn(`cia2_sheet_${e}`),le=Y==null?void 0:Y.rowsByStudentId;H[oe.key]=le&&typeof le=="object"?Object.keys(le).length:0;continue}if(oe.key==="model"){const Y=Bn(`model_sheet_${e}`),le=Y==null?void 0:Y.rowsByStudentId;H[oe.key]=le&&typeof le=="object"?Object.keys(le).length:0;continue}const D=Bn(x8(e,oe.key))||[];H[oe.key]=Array.isArray(D)?D.length:0}return H},[e,c,Q,L]);return n.jsxs("div",{children:[x!=null&&n.jsx(wK,{teachingAssignmentId:x}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-end",flexWrap:"wrap",marginBottom:12},children:[n.jsxs("div",{style:{minWidth:260},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Teaching Assignment (Section)"}),u.length===0?n.jsx("div",{className:"obe-input",children:"No teaching assignments"}):n.jsxs("div",{style:{padding:"8px 10px",borderRadius:6,background:"#fff",border:"1px solid #e5e7eb"},children:[n.jsx("div",{style:{fontSize:14,fontWeight:600},children:((he=R||u[0])==null?void 0:he.section_name)||(fe==null?void 0:fe.section_name)||""}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:(()=>{var je,We,Ee,Re,Ve,St,rt,ze;const H=R||u[0]||{},oe=H.academic_year||(fe==null?void 0:fe.academic_year)||H.academic_year_name||H.year||"",D=typeof H.semester<"u"&&H.semester!=null?H.semester:typeof(fe==null?void 0:fe.semester)<"u"?fe==null?void 0:fe.semester:(je=u[0])==null?void 0:je.semester,Y=H.department||((We=H.section_details)==null?void 0:We.department)||((Ve=(Re=(Ee=H.section_details)==null?void 0:Ee.batch)==null?void 0:Re.course)==null?void 0:Ve.department)||(fe==null?void 0:fe.department)||(H.department_name?{name:H.department_name}:null)||((St=u[0])==null?void 0:St.department)||((ze=(rt=u[0])==null?void 0:rt.section_details)==null?void 0:ze.department),le=(Y==null?void 0:Y.short_name)||(Y==null?void 0:Y.code)||(Y==null?void 0:Y.name)||H.department_name||"",$e=[];return $e.push(oe||""),typeof D<"u"&&D!=null&&$e.push(`Sem ${D}`),le&&$e.push(le),$e.filter(Boolean).join("  ")})()})]}),p&&n.jsx("div",{style:{marginTop:6,fontSize:12,color:"#b91c1c"},children:p})]}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",alignSelf:"center"},children:"Student rows load from the selected section roster."}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:[M&&x?n.jsx("button",{className:"obe-btn",onClick:()=>S(H=>!H),children:"Show exams"}):null,n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:()=>T(!0),title:"Configure when to show CQI button",children:"CQI Editor"})]})]}),M&&w&&x?n.jsx("div",{style:{marginBottom:12},children:n.jsx(vK,{teachingAssignmentId:x??void 0,onSaved:H=>{m(Array.isArray(H)&&H.length?H:null),S(!1)},onClose:()=>S(!1)})}):null,o&&c!=="dashboard"&&x!=null?n.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10},children:n.jsx("button",{className:"obe-btn obe-btn-danger",disabled:k,onClick:async()=>{const H=c;if(window.confirm(`Reset ${H.toUpperCase()} for this section? This clears draft + published data for that exam.`))try{F(!0),await ew(H,String(e),Number(x)),LK(String(e),String(H)),C(D=>D+1),alert("Reset completed.")}catch(D){alert((D==null?void 0:D.message)||"Reset failed")}finally{F(!1)}},children:k?"Resetting":"Reset This Exam"})}):null,n.jsxs("div",{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%)",borderRadius:12,padding:"16px",marginBottom:20,border:"1px solid #cbd5e1",boxShadow:"0 2px 8px rgba(2,6,23,0.04), inset 0 1px 0 rgba(255,255,255,0.5)"},children:[n.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#64748b",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:12},children:"Assessment Exams"}),n.jsx("div",{className:"obe-sidebar-nav","aria-label":"Mark Entry sub-tabs",style:{display:"flex",flexWrap:"wrap",gap:8},children:Q.map(H=>n.jsxs(Jr.Fragment,{children:[n.jsx(MK,{active:c===H.key,label:H.label,onClick:()=>d(H.key)}),ne.filter(oe=>oe&&oe.assessment===H.key).map((oe,D)=>{const Y=c==="cqi"&&(ge==null?void 0:ge.assessment)===oe.assessment&&JSON.stringify(ge==null?void 0:ge.cos)===JSON.stringify(oe.cos);return n.jsxs("button",{onClick:()=>{Fe(oe),d("cqi")},className:`obe-sidebar-btn ${Y?"active":""}`,style:{backgroundColor:Y?"#10b981":"#d1fae5",color:Y?"white":"#065f46",borderColor:"#10b981"},title:`CQI for ${oe.cos.join(", ")}`,children:["CQI ",oe.cos.length>1?`(${oe.cos.join(", ")})`:`(${oe.cos[0]})`]},`cqi-${H.key}-${D}`)})]},H.key))})]}),c==="dashboard"&&n.jsxs("div",{children:[n.jsx("h3",{style:{margin:"0 0 6px 0"},children:"Dashboard"}),n.jsxs("div",{style:{color:"#6b7280",marginBottom:12,fontSize:14},children:["Quick overview for ",n.jsx("b",{children:e}),". Use the tabs to enter marks."]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:12},children:Q.filter(H=>H.key!=="dashboard").map(H=>n.jsxs("div",{className:"obe-card",children:[n.jsx("div",{style:{fontWeight:700,color:"#0f172a"},children:H.label}),n.jsxs("div",{style:{marginTop:6,fontSize:13,color:"#6b7280"},children:["Rows saved: ",z[H.key]??0]}),n.jsx("button",{onClick:()=>d(H.key),className:"obe-btn obe-btn-primary",style:{marginTop:10},children:"Open"})]},H.key))})]}),c!=="dashboard"&&n.jsxs("div",{children:[n.jsx("h3",{style:{margin:"0 0 6px 0"},children:(X=Q.find(H=>H.key===c))==null?void 0:X.label}),n.jsx("div",{style:{color:"#6b7280",marginBottom:12,fontSize:14},children:c==="formative1"?I==="TCPL"?"Enter and manage LAB-1 marks (experiments + totals).":"Enter and manage Formative-1 assessment marks with BTL mapping.":c==="formative2"?I==="TCPL"?"Enter and manage LAB-2 marks (experiments + totals).":"Enter and manage Formative-2 assessment marks with BTL mapping.":c==="ssa1"?"SSA1 sheet-style entry (CO + BTL attainment) matching the Excel layout.":c==="review1"?"Review 1 sheet-style entry (CO + BTL attainment) matching the Excel layout.":c==="ssa2"?"SSA2 sheet-style entry (CO + BTL attainment) matching the Excel layout.":c==="review2"?"Review 2 sheet-style entry (CO + BTL attainment) matching the Excel layout.":c==="cia1"?I==="LAB"?"CIA 1 LAB entry (CO-1/CO-2 experiments + CIA exam)":I==="PRACTICAL"?"CIA 1 Review (Practical) - enter review marks for practical content.":"CIA 1 sheet-style entry (Q-wise + CO + BTL) matching the Excel layout.":c==="cia2"?I==="LAB"?"CIA 2 LAB entry (CO-3/CO-4 experiments + CIA exam).":"CIA 2 sheet-style entry (Q-wise + CO + BTL) matching the Excel layout.":c==="model"?I==="LAB"?"MODEL LAB entry (CO-5 experiments + CIA exam).":"MODEL blank table template (same layout style as CIA sheets).":"Enter and save marks locally for this assessment."}),n.jsx("fieldset",{disabled:!!l,style:{border:0,padding:0,margin:0},children:c==="formative1"?I==="TCPL"?n.jsx(Yj,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"formative1",label:"LAB 1",coA:1,coB:2}):n.jsx(h8,{subjectId:e,teachingAssignmentId:x??void 0}):c==="formative2"?I==="TCPL"?n.jsx(Yj,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"formative2",label:"LAB 2",coA:3,coB:4}):n.jsx(YY,{subjectId:e,teachingAssignmentId:x??void 0}):c==="ssa1"?n.jsx(gK,{subjectId:e,teachingAssignmentId:x??void 0}):c==="review1"?n.jsx(uK,{subjectId:e,teachingAssignmentId:x??void 0}):c==="ssa2"?n.jsx(yK,{subjectId:e,teachingAssignmentId:x??void 0}):c==="review2"?n.jsx(xK,{subjectId:e,teachingAssignmentId:x??void 0}):c==="cia1"?I==="LAB"?n.jsx(Bx,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"cia1",label:"CIA 1 LAB",coA:1,coB:2,viewerMode:!!l}):I==="PRACTICAL"||I==="PROJECT"?n.jsx(sb,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"cia1",viewerMode:!!l}):n.jsx(f8,{subjectId:e,teachingAssignmentId:x??void 0,classType:U??null,questionPaperType:r??null}):c==="cia2"?I==="LAB"?n.jsx(Bx,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"cia2",label:"CIA 2 LAB",coA:3,coB:4,viewerMode:!!l}):I==="PRACTICAL"||I==="PROJECT"?n.jsx(sb,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"cia2",viewerMode:!!l}):n.jsx(zY,{subjectId:e,teachingAssignmentId:x??void 0,classType:U??null,questionPaperType:r??null}):c==="model"?I==="LAB"?n.jsx(Bx,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"model",label:"MODEL LAB",coA:5,coB:null,viewerMode:!!l}):I==="PRACTICAL"||I==="PROJECT"?n.jsx(sb,{subjectId:e,teachingAssignmentId:x??void 0,assessmentKey:"model",viewerMode:!!l}):n.jsx(aK,{subjectId:e,teachingAssignmentId:x??void 0,classType:U??null,questionPaperType:r??null}):c==="cqi"?n.jsx(CK,{subjectId:e,teachingAssignmentId:x??void 0,classType:U??null,enabledAssessments:te,assessmentType:ge==null?void 0:ge.assessment,cos:ge==null?void 0:ge.cos,cqiDivider:N,cqiMultiplier:K}):n.jsx(RK,{subjectId:e,tab:c})})]},`${c}_${L}`),n.jsx(SK,{isOpen:O,onClose:()=>T(!1),onSave:G,currentSelection:{options:W,divider:N,multiplier:K}})]})}function BK(){var x,g,y,m;const{courseCode:e,taId:t}=g0(),r=v.useMemo(()=>decodeURIComponent(String(e||"")).trim(),[e]),s=v.useMemo(()=>t?Number(t):NaN,[t]),[a,i]=v.useState(null),[o,l]=v.useState(null),[c,d]=v.useState(null),[u,h]=v.useState(null);v.useEffect(()=>{let w=!0;return(async()=>{if(r)try{const[S,k]=await Promise.all([vo(),jc()]);if(!w)return;const L=(S||[]).filter(C=>String((C==null?void 0:C.course_code)||"").trim().toUpperCase()===r.toUpperCase())[0];if(L)if(l(L!=null&&L.class_type?String(L.class_type):null),d(L!=null&&L.question_paper_type?String(L.question_paper_type):null),String((L==null?void 0:L.class_type)||"").trim().toUpperCase()==="SPECIAL"){h([]);try{const O=await ag(r);h(Array.isArray(O)?O:[])}catch{const O=L==null?void 0:L.enabled_assessments;h(Array.isArray(O)?O.map(T=>String(T).trim().toLowerCase()).filter(Boolean):[])}}else h(null);else{const C=(k||[]).find(O=>String((O==null?void 0:O.course_code)||"").trim().toUpperCase()===r.toUpperCase());l(C!=null&&C.class_type?String(C.class_type):null),d(null),h(null)}}catch{}})(),()=>{w=!1}},[r]),v.useEffect(()=>{let w=!0;return(async()=>{if(!(!r||!Number.isFinite(s)))try{const S=await x1(r);if(!w)return;const k=(S||[]).find(F=>Number(F.teaching_assignment_id)===Number(s))||null;i(k)}catch{if(!w)return;i(null)}})(),()=>{w=!1}},[r,s]);const p=v.useMemo(()=>Number.isFinite(s)?[{id:s,subject_id:0,subject_code:r,subject_name:(a==null?void 0:a.course_name)||r,section_id:(a==null?void 0:a.section_id)||0,section_name:(a==null?void 0:a.section_name)||"Section",academic_year:(a==null?void 0:a.academic_year)||""}]:[],[s,r,a]),f=On(o);return!r||!Number.isFinite(s)?n.jsxs("main",{style:{padding:18,minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n.jsx("div",{style:{color:"#b91c1c"},children:"Invalid teaching assignment."}),n.jsx("div",{style:{marginTop:10},children:n.jsx(sa,{className:"obe-btn obe-btn-secondary",to:"/iqac/academic-controller?tab=courses",children:"Back"})})]}):n.jsxs("main",{style:{padding:18,minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:12,flexWrap:"wrap",marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{margin:0,fontSize:20},children:"Mark Entry Viewer"}),n.jsx("div",{style:{color:"#374151",marginTop:6,fontWeight:800},children:r}),n.jsxs("div",{style:{color:"#6b7280",marginTop:4},children:[a?`${a.section_name}  ${a.academic_year}`:"",(x=a==null?void 0:a.staff)!=null&&x.name||(g=a==null?void 0:a.staff)!=null&&g.username?`    ${((y=a.staff)==null?void 0:y.name)||((m=a.staff)==null?void 0:m.username)}`:"",f?`    ${f}`:""]})]}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:n.jsx(sa,{className:"obe-btn obe-btn-secondary",to:`/iqac/academic-controller/course/${encodeURIComponent(r)}`,children:"Back"})})]}),n.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:n.jsx(Yw,{subjectId:r,classType:o,questionPaperType:c,enabledAssessments:u,teachingAssignmentsOverride:p,fixedTeachingAssignmentId:s,iqacResetEnabled:!0,viewerMode:!1})})]})}function PK(e){return e==="-"||e===null||e===void 0||e===""?" - ":String(e)}function uf(e,t){const r=Math.pow(10,t);return Math.round((e+Number.EPSILON)*r)/r}function H2({headers:e,rows:t}){return n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:10},children:n.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:900},children:[n.jsx("thead",{children:n.jsx("tr",{children:e.map(r=>n.jsx("th",{style:{textAlign:"left",fontSize:12,color:"#111827",background:"#f9fafb",padding:"10px 10px",borderBottom:"1px solid #e5e7eb",whiteSpace:"nowrap"},children:r},r))})}),n.jsx("tbody",{children:t.map((r,s)=>n.jsx("tr",{children:r.map((a,i)=>n.jsx("td",{style:{padding:"8px 10px",borderBottom:"1px solid #f3f4f6",fontSize:12,color:"#111827",whiteSpace:i===3?"normal":"nowrap",maxWidth:i===3?360:void 0},children:PK(a)},i))},s))})]})})}function o4({title:e,headers:t,rows:r,collapsedByDefault:s=!1,showToggle:a=!0}){const[i,o]=v.useState(!s);return n.jsxs("section",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("h3",{style:{margin:"6px 0 10px 0",flex:1},children:e}),a?n.jsx("button",{"aria-label":i?"Collapse table":"Expand table",onClick:()=>o(l=>!l),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:18,padding:6,color:"#374151"},children:i?"":""}):null]}),i&&n.jsx(H2,{headers:t,rows:r})]})}function OK({subjectId:e,matrix:t}){var i,o,l;if(!e)return n.jsx("div",{style:{color:"#6b7280",fontSize:13},children:"Select a course to view the Articulation Matrix."});if(!t)return n.jsxs("div",{style:{border:"1px dashed #bbb",padding:16,borderRadius:8,color:"#666"},children:["No articulation matrix loaded yet for ",n.jsx("b",{children:e}),". Upload the Excel to parse page-2."]});const r=Array.isArray(t.units)?t.units:[],s=(i=t.summaries)==null?void 0:i.co_po_summary,a=["S. No","CO Mapped","Topic No.","Topic Name",...Array.from({length:11},(c,d)=>`PO${d+1}`),...Array.from({length:3},(c,d)=>`PSO${d+1}`),"Hours"];return Array.from({length:a.length},()=>""),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[((o=t.meta)==null?void 0:o.sheet_used)&&n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["Sheet: ",n.jsx("b",{children:t.meta.sheet_used})]}),r.map(c=>{const d=(c.rows||[]).map(u=>[u.s_no,u.co_mapped,u.topic_no,u.topic_name,...u.po||[],...u.pso||[],u.hours]);return n.jsxs("section",{children:[n.jsx("h3",{style:{margin:"6px 0 10px 0"},children:c.unit}),n.jsx(H2,{headers:a,rows:d})]},c.unit)}),(()=>{const c=[],d=(h,p)=>{const f=r[h];if(!f||!Array.isArray(f.rows)||f.rows.length===0)return[p,...Array.from({length:11},()=>""),...Array.from({length:3},()=>""),""];const x=f.rows,g=x.reduce((w,S)=>{const k=Number(S.hours);return w+(Number.isFinite(k)?k:0)},0),y=[];for(let w=0;w<11;w++){const S=x.reduce((k,F)=>{const L=Number((F.po&&F.po[w])??0);return k+(Number.isFinite(L)?L:0)},0);if(g>0){const k=S/g,F=uf(k,2);y.push(F.toFixed(2))}else y.push("")}const m=[];for(let w=0;w<3;w++){const S=x.reduce((k,F)=>{const L=Number((F.pso&&F.pso[w])??0);return k+(Number.isFinite(L)?L:0)},0);if(g>0){const k=S/g,F=uf(k,2);m.push(F.toFixed(2))}else m.push("")}return[p,...y,...m,g||""]};for(let h=0;h<5;h++)c.push(d(h,`CO${h+1}`));const u=(()=>{const h=[];c.forEach(y=>{const m=y[0],S=y.slice(1,15).map(L=>{if(L===""||L===null||L===void 0)return"";const C=Number(String(L));if(!Number.isFinite(C))return"";const O=C*3,T=uf(O,2);return T===0?"":T.toFixed(2)}),k=S.map(L=>L===""?null:Number(L)).filter(L=>L!==null),F=k.length?uf(k.reduce((L,C)=>L+C,0)/k.length,2).toFixed(2):"";h.push([m,...S,F])});const f=[];for(let y=0;y<14;y++){const m=[];for(let w=0;w<h.length;w++){const S=h[w][1+y];if(S===""||S===null||S===void 0)continue;const k=Number(S);Number.isFinite(k)&&m.push(k)}m.length?f.push(uf(m.reduce((w,S)=>w+S,0)/m.length,2).toFixed(2)):f.push("")}const x=h.map(y=>y[y.length-1]).filter(y=>y!=="").map(Number),g=x.length?uf(x.reduce((y,m)=>y+m,0)/x.length,2).toFixed(2):"";return h.push(["Average",...f,g]),h})();return n.jsxs(n.Fragment,{children:[n.jsx(o4,{title:"CO  PO/PSO (Course Delivery)",headers:["COs",...Array.from({length:11},(h,p)=>`PO${p+1}`),...Array.from({length:3},(h,p)=>`PSO${p+1}`),"Course delivery"],rows:c,collapsedByDefault:!0}),n.jsx(o4,{title:"CO  PO/PSO Summary",headers:["COs",...Array.from({length:11},(h,p)=>`PO${p+1}`),...Array.from({length:3},(h,p)=>`PSO${p+1}`),"Average"],rows:u,collapsedByDefault:!1,showToggle:!1})]})})(),(l=s==null?void 0:s.rows)!=null&&l.length?n.jsxs("section",{children:[n.jsx("h3",{style:{margin:"6px 0 10px 0"},children:"CO  PO/PSO Summary"}),n.jsx(H2,{headers:["CO",...Array.from({length:11},(c,d)=>`PO${d+1}`),...Array.from({length:3},(c,d)=>`PSO${d+1}`),"Average"],rows:[...s.rows.map(c=>[c.label,...c.po,...c.pso,c.average]),...s.average?[[s.average.label,...s.average.po,...s.average.pso,s.average.average]]:[]]})]}):null]})}const qs={container:{minHeight:"100vh",background:"linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%)",padding:"2rem"},card:{maxWidth:"1400px",margin:"0 auto",background:"#ffffff",borderRadius:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.07), 0 1px 3px rgba(0, 0, 0, 0.06)",overflow:"hidden"},header:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"2rem 2.5rem",borderBottom:"1px solid #e5e7eb"},title:{fontSize:"1.875rem",fontWeight:"700",color:"#ffffff",margin:"0",letterSpacing:"-0.025em"},subtitle:{fontSize:"0.95rem",color:"rgba(255, 255, 255, 0.9)",marginTop:"0.5rem",fontWeight:"400"},content:{padding:"2rem 2.5rem"},inputSection:{marginBottom:"1.5rem",padding:"1.25rem",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},label:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem",textTransform:"uppercase",letterSpacing:"0.025em"},input:{width:"100%",padding:"0.75rem 1rem",fontSize:"1rem",border:"2px solid #e5e7eb",borderRadius:"6px",outline:"none",transition:"all 0.2s ease",fontFamily:"inherit"},inputFocus:{borderColor:"#667eea",boxShadow:"0 0 0 3px rgba(102, 126, 234, 0.1)"},actionBar:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap",marginBottom:"1.5rem",padding:"1.25rem",background:"#f9fafb",borderRadius:"8px"},button:{padding:"0.75rem 1.5rem",fontSize:"0.95rem",fontWeight:"600",color:"#ffffff",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(102, 126, 234, 0.3)",outline:"none"},buttonHover:{transform:"translateY(-1px)",boxShadow:"0 4px 8px rgba(102, 126, 234, 0.4)"},buttonDisabled:{background:"#9ca3af",cursor:"not-allowed",boxShadow:"none",opacity:.6},infoText:{fontSize:"0.875rem",color:"#6b7280",display:"flex",alignItems:"center",gap:"0.5rem"},infoIcon:{width:"16px",height:"16px",borderRadius:"50%",background:"#667eea",color:"#ffffff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"700"},alert:{padding:"1rem 1.25rem",borderRadius:"8px",fontSize:"0.925rem",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.75rem",fontWeight:"500"},alertSuccess:{background:"#d1fae5",color:"#065f46",border:"1px solid #6ee7b7"},alertError:{background:"#fee2e2",color:"#991b1b",border:"1px solid #fca5a5"},matrixContainer:{background:"#ffffff",borderRadius:"8px",border:"1px solid #e5e7eb",padding:"1.5rem",minHeight:"200px"},loadingSpinner:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 0.6s linear infinite",marginRight:"0.5rem"}};function IK({courseId:e,embedded:t=!1}){const[r,s]=v.useState(e||""),[a,i]=v.useState(null),[o,l]=v.useState("idle"),[c,d]=v.useState(null),[u,h]=v.useState(!1),[p,f]=v.useState(!1);v.useEffect(()=>{r&&(async()=>{l("loading"),d(null);try{const m=await __(r);i(m),l("success")}catch(m){i(null),l("error"),d((m==null?void 0:m.message)||"Articulation Matrix fetch failed.")}})()},[r]);async function x(){if(r){l("loading"),d(null);try{const m=await __(r);i(m),l("success");const w=Array.isArray(m==null?void 0:m.units)?m.units.length:0;d(`Loaded articulation matrix from saved CDAP. Units: ${w}.`)}catch(m){l("error"),d((m==null?void 0:m.message)||"Articulation Matrix fetch failed.")}}}const g=t?{padding:0}:qs.container,y=t?{...qs.card,maxWidth:"100%",margin:0,borderRadius:12,boxShadow:"none"}:qs.card;return n.jsxs("div",{style:g,children:[n.jsx("style",{children:`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `}),n.jsxs("div",{style:y,children:[!t&&n.jsxs("div",{style:qs.header,children:[n.jsx("h1",{style:qs.title,children:"Articulation Matrix"}),n.jsx("p",{style:qs.subtitle,children:r?`Course: ${r}`:"Select a course to view the articulation matrix"})]}),n.jsxs("div",{style:t?{padding:0}:qs.content,children:[!e&&n.jsxs("div",{style:qs.inputSection,children:[n.jsx("label",{style:qs.label,children:"Course ID"}),n.jsx("input",{value:r,onChange:m=>s(m.target.value),placeholder:"Enter course identifier (e.g., CS101)",style:{...qs.input,...u?qs.inputFocus:{}},onFocus:()=>h(!0),onBlur:()=>h(!1)})]}),n.jsxs("div",{style:qs.actionBar,children:[n.jsxs("button",{onClick:x,disabled:o==="loading"||!r,style:{...qs.button,...o==="loading"||!r?qs.buttonDisabled:{},...p&&o!=="loading"&&r?qs.buttonHover:{}},onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[o==="loading"&&n.jsx("span",{style:qs.loadingSpinner}),o==="loading"?"Loading...":"Refresh Matrix"]}),n.jsxs("span",{style:qs.infoText,children:[n.jsx("span",{style:qs.infoIcon,children:"i"}),"Uses saved CDAP ticks + hours (no upload required)"]})]}),c&&n.jsxs("div",{style:{...qs.alert,...o==="error"?qs.alertError:qs.alertSuccess},children:[n.jsx("span",{style:{fontSize:"1.25rem"},children:o==="error"?"":""}),c]}),n.jsx("div",{style:qs.matrixContainer,children:n.jsx(OK,{subjectId:r,matrix:a})})]})]})]})}const DK="https://db.zynix.us",UK=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:8000":DK;function $K(){const e=window.localStorage.getItem("access");return e?{Authorization:`Bearer ${e}`}:{}}function WK(e,t){if(e===401)return"Authentication required. Please login and try again.";if(e===403)return"Permission required to upload CDAP Excel files.";if(e===400)return"Invalid file. Please upload a valid CDAP Excel template.";if(e===404)return"Upload endpoint not found. Please contact admin.";const r=(t||"").trim();return r&&!r.startsWith("<")?r:`Upload failed with status ${e}. Please try again.`}function zK({subjectId:e,onUpload:t}){const[r,s]=v.useState(null),[a,i]=v.useState("idle"),[o,l]=v.useState(null),[c,d]=v.useState(null);async function u(){var p,f,x;if(!r){i("error"),l("Please choose an Excel file first.");return}i("uploading"),l(null);const h=new FormData;h.append("file",r),e&&h.append("subject_id",e);try{const g={...$K()},y=await fetch(`${UK}/api/obe/upload-cdap`,{method:"POST",headers:g,body:h});if(!y.ok){const k=await y.text();i("error"),l(WK(y.status,k));return}const m=await y.json(),w={rows:Array.isArray(m==null?void 0:m.rows)?m.rows:[],textbook:((p=m==null?void 0:m.books)==null?void 0:p.textbook)??(m==null?void 0:m.textbook)??"",reference:((f=m==null?void 0:m.books)==null?void 0:f.reference)??(m==null?void 0:m.reference)??"",activeLearningOptionsByRow:((x=m==null?void 0:m.active_learning)==null?void 0:x.optionsByRow)??(m==null?void 0:m.activeLearningOptions)??[],articulationExtras:(m==null?void 0:m.articulation_extras)??{}};d(w);const S=Array.isArray(m==null?void 0:m.rows)?m.rows.length:0;S?(i("success"),l(`Upload complete. Parsed ${S} rows from the Excel file.`)):(i("success"),l("Upload completed, but no rows were parsed. Please check the Excel template format.")),t&&t({revision:w,uploadedAt:new Date().toISOString()})}catch(g){i("error"),l((g==null?void 0:g.message)||"Upload failed. Please try again.")}}return n.jsxs("div",{children:[n.jsx("div",{style:{marginBottom:8},children:n.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:h=>{var p;return s(((p=h.target.files)==null?void 0:p[0])||null)}})}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("button",{id:"cdap-upload-button",onClick:u,disabled:a==="uploading","aria-label":"Upload CDAP Excel file",title:"Upload parsed CDAP Excel",style:{background:"#1d4ed8",color:"#fff",padding:"8px 14px",borderRadius:8,border:"none",boxShadow:"0 8px 20px rgba(29,78,216,0.24)",fontWeight:600,cursor:a==="uploading"?"default":"pointer",transition:"transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease",opacity:a==="uploading"?.65:1},onMouseDown:h=>{h.currentTarget.style.transform="translateY(1px)"},onMouseUp:h=>{h.currentTarget.style.transform="translateY(0)"},children:a==="uploading"?"Uploading...":"Upload Excel"}),r&&n.jsx("span",{style:{fontSize:12,color:"#555"},children:r.name})]}),a==="success"&&c&&Array.isArray(c.rows)&&c.rows.length>0&&n.jsx("div",{style:{marginTop:10},children:n.jsx("button",{onClick:()=>exportPdfRevision(c),style:{background:"#047857",color:"#fff",padding:"8px 14px",borderRadius:8,border:"none",fontWeight:600,cursor:"pointer"},"aria-label":"Export PDF",title:"Export CDAP to PDF (will open print dialog)",children:"Export PDF"})}),o&&n.jsx("div",{style:{marginTop:8,fontSize:12,color:a==="error"?"#b91c1c":"#166534"},children:o})]})}function sd(e){return String(e??"").toLowerCase().replace(/[^a-z0-9]+/g,"").trim()}function qK(){return{}}const V2=["Technical magazine","Journal paper reading","Real time problems","Case study","Dipstick (Writing explanation content of CO)","Dipstick (Sketch Representation)","Real time Photography or Video Explanation","Course competition","Active Learing Exercies (Group Discussion)","Active Learing Exercies (Technical Question and answering Session)","Technical Role play","Interview Assessment","Active Projects","Journal Preparation"],l4=[{key:"unit",label:"UNIT",type:"text"},{key:"unit_name",label:"SYLLABUS (UNIT NAME)",type:"text"},{key:"co",label:"OUTCOME (WRITE THE CO)",type:"text"},{key:"content_type",label:"Content type",type:"text"},{key:"part_no",label:"PART NO.",type:"text"},{key:"topics",label:"TOPICS TO BE COVERED (SYLLBUS TOPICS)",type:"text"},{key:"sub_topics",label:"SUB TOPICS (WHAT TO BE TAUGHT)",type:"text"},{key:"bt_level",label:"BT LEVEL",type:"text"}],c4=Array.from({length:11},(e,t)=>({key:`po${t+1}`,label:`PO${t+1}`,type:"checkbox",group:"po_pso"})),d4=Array.from({length:3},(e,t)=>({key:`pso${t+1}`,label:`PSO${t+1}`,type:"checkbox",group:"po_pso"})),Qa=["SSA1","SSA2","ACTIVE LEARNING 1 (SKILL)","ACTIVE LEARNING 2 (SKILL)","ACTIVE LEARNING 1 (ATTITUDE)","ACTIVE LEARNING 2 (ATTITUDE)","SPECIAL ACTIVITY"],Kc=Array.from({length:11},(e,t)=>`PO${t+1}`),sx={SSA1:["Technical magazine","Journal paper reading","Real time problems","Case study"],SSA2:["Technical magazine","Journal paper reading","Real time problems","Case study"],"ACTIVE LEARNING 1 (SKILL)":["Dipstick (Writing explanation content of CO)","Dipstick (Sketch Representation)","Real time Photography or Video Explanation","Course competition"],"ACTIVE LEARNING 2 (SKILL)":["Dipstick (Writing explanation content of CO)","Dipstick (Sketch Representation)","Real time Photography or Video Explanation","Course competition"],"ACTIVE LEARNING 1 (ATTITUDE)":["Active Learing Exercies (Group Discussion)","Active Learing Exercies (Technical Question and answering Session)","Technical Role play","Interview Assessment"],"ACTIVE LEARNING 2 (ATTITUDE)":["Active Learing Exercies (Group Discussion)","Active Learing Exercies (Technical Question and answering Session)","Technical Role play","Interview Assessment"],"SPECIAL ACTIVITY":["Active Projects","Journal Preparation"]};function HK({subjectId:e,imported:t}){const r=(z,he)=>{const X=[...he];for(let H=0;H<z.length;H++){const oe=z[H]??[];(!X[H]||String(X[H]).trim()==="")&&Array.isArray(oe)&&oe.length===1&&(X[H]=String(oe[0]??"").trim())}return X},s=v.useRef(null),[a,i]=v.useState(!0),[o,l]=v.useState(1),[c,d]=v.useState(()=>{if(!e)return 100;try{const z=localStorage.getItem(`cdap_zoom_${e}`);return z?parseInt(z,10):100}catch{return 100}}),[u,h]=v.useState(""),[p,f]=v.useState(""),[x,g]=v.useState(()=>Qa.map(()=>Kc.map(()=>!1))),[y,m]=v.useState(()=>Qa.map(()=>"")),[w,S]=v.useState(()=>qK()),[k,F]=v.useState(()=>Qa.map(z=>sx[z]??[])),[L,C]=v.useState({}),[O,T]=v.useState(!1),[W,A]=v.useState(null),[N,P]=v.useState(!1);v.useEffect(()=>{if(e)try{localStorage.setItem(`cdap_active_learning_draft_${e}`,JSON.stringify({dropdowns:y,grid:x,ts:Date.now()})),window.dispatchEvent(new CustomEvent("cdap-active-learning-changed",{detail:{subjectId:e}}))}catch{}},[e,y,x]),v.useEffect(()=>{if(e)try{localStorage.setItem(`cdap_zoom_${e}`,c.toString())}catch{}},[e,c]);const K=z=>String(z??"").replace(/\s+/g," ").trim().toUpperCase().includes("#N/A"),re=z=>z.filter(he=>!K(he==null?void 0:he.content_type)),ge=v.useMemo(()=>[...l4,...c4,...d4],[]),Fe=v.useMemo(()=>{const z={};for(const he of ge)z[he.key]=he.type==="checkbox"?!1:"";return z},[ge]),[R,q]=v.useState(()=>[structuredClone(Fe)]),me=z=>{const he=sd(z);if(he===sd("SPECIAL ACTIVITY")){const X=sd("Active Projects");if(Array.isArray(w==null?void 0:w[X])&&w[X].length===11)return w[X]}if(Array.isArray(w==null?void 0:w[he])&&w[he].length===11)return w[he];for(const X of V2){const H=sd(X);if(H===he&&Array.isArray(w==null?void 0:w[H])&&w[H].length===11)return w[H]}for(const X of V2){const H=sd(X);if((H.includes(he)||he.includes(H))&&Array.isArray(w==null?void 0:w[H])&&w[H].length===11)return w[H]}return null},fe=(z,he)=>{const X=z.map(H=>[...H]);for(let H=0;H<Qa.length;H++){const oe=(he==null?void 0:he[H])??"";if(!oe)continue;const D=me(oe);if(!(!Array.isArray(D)||D.length!==11))for(let Y=0;Y<Kc.length;Y++)X[H][Y]=!!D[Y]}return X};v.useEffect(()=>{if(!e)return;let z=!0;return(async()=>{try{A(null),T(!0);const X=await FP(e);if(!z)return;if(!X){q([structuredClone(Fe)]),h(""),f(""),g(Qa.map(()=>Kc.map(()=>!1))),m(Qa.map(()=>"")),F(Qa.map(Ve=>sx[Ve]??[]));return}const H=Array.isArray(X.rows)?X.rows:[];q(H.length?re(H):[structuredClone(Fe)]);const oe=X.books&&typeof X.books=="object"?X.books:{};h(typeof oe.textbook=="string"?oe.textbook:""),f(typeof oe.reference=="string"?oe.reference:"");const D=X.active_learning&&typeof X.active_learning=="object"?X.active_learning:{},Y=Array.isArray(D.dropdowns)?D.dropdowns.map(Ve=>Ve==null?"":String(Ve)):[],le=Array.isArray(D.grid)?D.grid:[],$e=Array.isArray(D.optionsByRow)?D.optionsByRow:null,je=D.articulation_extras&&typeof D.articulation_extras=="object"?D.articulation_extras:{};C(je);const We=Qa.map((Ve,St)=>Kc.map((rt,ze)=>{var ot;const Ie=(ot=le==null?void 0:le[St])==null?void 0:ot[ze];return Ie===!0||Ie==="true"||Ie===1||Ie==="1"||String(Ie).trim().toLowerCase()==="x"?!0:!!Ie})),Ee=Y.length===Qa.length?Y.slice(0,Qa.length):Qa.map(()=>""),Re=$e&&Array.isArray($e)?r($e,Ee):Ee;if(m(Re),g(fe(We,Re)),$e&&Array.isArray($e)){const Ve=Qa.map((St,rt)=>{const ze=$e==null?void 0:$e[rt];return Array.isArray(ze)?ze.map(Ie=>String(Ie??"")).map(Ie=>Ie.trim()).filter(Boolean):[]});F(Ve)}else F(Qa.map(Ve=>sx[Ve]??[]))}catch(X){if(!z)return;A((X==null?void 0:X.message)||"Failed to load CDAP from cloud"),q([structuredClone(Fe)])}finally{z&&T(!1)}})(),()=>{z=!1}},[e,Fe]),v.useEffect(()=>{let z=!0;const he=async()=>{try{const H=await cA();z&&S(H)}catch{}};he();const X=BP(()=>he());return()=>{z=!1,X()}},[]),v.useEffect(()=>{if(t){if(Array.isArray(t.rows)&&t.rows.length&&q(re(t.rows)),typeof t.textbook=="string"&&h(t.textbook),typeof t.reference=="string"&&f(t.reference),Array.isArray(t.activeLearningOptionsByRow)&&t.activeLearningOptionsByRow.length){const z=Qa.map((H,oe)=>{var Y;const D=(Y=t.activeLearningOptionsByRow)==null?void 0:Y[oe];return Array.isArray(D)?D.map(le=>String(le??"")).map(le=>le.trim()).filter(Boolean):[]}),X=r(z,y);F(z),m(X),g(H=>fe(H,X))}t.articulationExtras&&typeof t.articulationExtras=="object"&&C(t.articulationExtras)}},[t]),v.useEffect(()=>{g(z=>fe(z,y))},[w]);const E=v.useMemo(()=>{const z=new Map;let he=null;return R.forEach((X,H)=>{const oe=X.unit??"",D=oe!==""?String(oe):"";D&&(he=D);const Y=D||he||String(Math.floor(H/9)+1),le=z.get(Y)??{key:Y,items:[]};le.items.push({row:X,index:H}),z.set(Y,le)}),Array.from(z.values()).sort((X,H)=>{const oe=Number(X.key),D=Number(H.key);return!Number.isNaN(oe)&&!Number.isNaN(D)?oe-D:X.key.localeCompare(H.key)})},[R]),U=(z,he,X)=>{if(he==="content_type"&&K(X)){q(H=>H.filter((oe,D)=>D!==z));return}q(H=>{const oe=[...H];return oe[z]={...oe[z],[he]:X},oe})},I=()=>q(z=>[...z,structuredClone(Fe)]),M=z=>q(he=>he.filter((X,H)=>H!==z)),te=z=>{q(he=>{const X=structuredClone(Fe);X.unit=z;let H=null,oe=-1,D=-1;for(let le=0;le<he.length;le++){const $e=he[le].unit??"",je=$e!==""?String($e):"";je&&(H=je),(je||H||String(Math.floor(le/9)+1))===String(z)&&(D===-1&&(D=le),oe=le)}return D!==-1&&(X.unit_name=he[D].unit_name??"",X.co=he[D].co??""),oe===-1?[...he,X]:[...he.slice(0,oe+1),X,...he.slice(oe+1)]})},Q=async()=>{if(!e){alert("No subject selected.");return}try{A(null),T(!0),await lA({subjectId:e,status:"published",rows:R,books:{textbook:u,reference:p},active_learning:{grid:x,dropdowns:y,optionsByRow:k,articulation_extras:L}}),P(!0),alert("Saved to cloud.")}catch(z){alert((z==null?void 0:z.message)||"Failed to save to cloud")}finally{T(!1)}};v.useEffect(()=>{if(!a){l(1);return}const z=()=>{const H=s.current;if(!H)return;const oe=H.querySelector('table[data-cdap-table="1"]');if(!oe)return;const D=H.clientWidth,Y=oe.scrollWidth;if(!D||!Y)return;const $e=(D-24)/Y,je=Math.min(1,Math.max(.35,$e));l(je)};z();const he=s.current;if(!he)return;const X=new ResizeObserver(()=>z());return X.observe(he),()=>X.disconnect()},[a,R]);const G=l4.slice(3,8),ne=[...c4,...d4];return n.jsxs("div",{style:{border:"1px solid #dbe4f0",borderRadius:14,padding:18,background:"#fff",boxShadow:"0 2px 8px rgba(15, 23, 42, 0.06)",width:"100%"},children:[n.jsx("style",{children:`
        .cdap-slider::-webkit-slider-thumb {
          appearance: none;
          height: 14px;
          width: 14px;
          border-radius: 50%;
          background: #2563eb;
          cursor: pointer;
          box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .cdap-slider::-moz-range-thumb {
          height: 14px;
          width: 14px;
          border-radius: 50%;
          background: #2563eb;
          cursor: pointer;
          border: none;
        }
        .cdap-slider::-webkit-slider-track {
          background: #e5e7eb;
          height: 6px;
          border-radius: 999px;
        }
        .cdap-slider::-moz-range-track {
          background: #e5e7eb;
          height: 6px;
          border-radius: 999px;
          border: none;
        }
      `}),O?n.jsx("div",{style:{marginBottom:8,fontSize:12,color:"#64748b"},children:"Loading from cloud"}):W?n.jsx("div",{style:{marginBottom:8,fontSize:12,color:"#b91c1c"},children:W}):null,N&&n.jsxs("div",{style:{marginBottom:12,padding:"12px 16px",background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",border:"1px solid #fbbf24",borderRadius:10,color:"#92400e",fontSize:14,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[n.jsx("span",{children:' Document is locked after save. Click "Unlock to Edit" to make changes.'}),n.jsx("button",{onClick:()=>P(!1),style:{padding:"6px 14px",borderRadius:8,border:"1px solid #92400e",background:"#fff",color:"#92400e",cursor:"pointer",fontWeight:600,fontSize:13,whiteSpace:"nowrap"},children:" Unlock to Edit"})]}),n.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",gap:12,padding:12,background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:700,color:"#0f172a"},children:"Revised CDP Editor"}),n.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Interactive spreadsheet interface"})]}),n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#fff",border:"1px solid #e2e8f0",borderRadius:10,padding:"6px 10px"},children:[n.jsx(DB,{size:16,color:"#64748b"}),n.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:c,onChange:z=>d(parseInt(z.target.value,10)),className:"cdap-slider",style:{width:110}}),n.jsx(OB,{size:16,color:"#64748b"}),n.jsxs("span",{style:{fontSize:12,color:"#334155",minWidth:36},children:[c,"%"]})]}),n.jsxs("button",{onClick:()=>i(z=>!z),style:{padding:"8px 12px",borderRadius:8,border:"1px solid #cbd5f5",background:a?"#111827":"#fff",color:a?"#fff":"#111827",cursor:"pointer",fontWeight:600,fontSize:12},children:["Fit Screen: ",a?"ON":"OFF"]}),n.jsx("button",{onClick:I,disabled:N,style:{padding:"8px 12px",borderRadius:8,border:"1px solid #059669",background:N?"#d1d5db":"#10b981",color:"#fff",cursor:N?"not-allowed":"pointer",fontWeight:600,fontSize:12,opacity:N?.5:1},children:"Add Row"}),n.jsx("button",{onClick:Q,disabled:N,style:{padding:"8px 12px",borderRadius:8,border:"1px solid #2563eb",background:N?"#d1d5db":"#2563eb",color:"#fff",cursor:N?"not-allowed":"pointer",fontWeight:600,fontSize:12,opacity:N?.5:1},children:"Save All"})]})]}),n.jsx("div",{ref:s,children:E.map(z=>{var X;const he=(X=z.items[0])==null?void 0:X.row;return he?n.jsxs("div",{style:{border:"1px solid #dbe4f0",borderRadius:14,padding:16,background:"#fff",marginBottom:16},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:16,marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:12,color:"#1f2937",fontWeight:600},children:"UNIT NUMBER"}),n.jsx("textarea",{value:he.unit??"",onChange:H=>z.items.forEach(oe=>U(oe.index,"unit",H.target.value)),disabled:N,style:{width:"100%",padding:8,border:"1px solid #cbd5e1",borderRadius:8,marginTop:6,fontSize:12,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"text"},rows:2})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:12,color:"#1f2937",fontWeight:600},children:"SYLLABUS (UNIT NAME)"}),n.jsx("textarea",{value:he.unit_name??"",onChange:H=>z.items.forEach(oe=>U(oe.index,"unit_name",H.target.value)),disabled:N,style:{width:"100%",padding:8,border:"1px solid #cbd5e1",borderRadius:8,marginTop:6,fontSize:12,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"text"},rows:2})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:12,color:"#1f2937",fontWeight:600},children:"COURSE OUTCOME (CO)"}),n.jsx("textarea",{value:he.co??"",onChange:H=>z.items.forEach(oe=>U(oe.index,"co",H.target.value)),disabled:N,style:{width:"100%",padding:8,border:"1px solid #cbd5e1",borderRadius:8,marginTop:6,fontSize:12,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"text"},rows:2})]})]}),n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e2e8f0",borderRadius:10},children:n.jsx("div",{style:a?{transform:`scale(${o*(c/100)})`,transformOrigin:"left top",width:`${Math.max(1,100/(o*(c/100)))}%`}:{transform:`scale(${c/100})`,transformOrigin:"left top",width:`${Math.max(1,100/(c/100))}%`},children:n.jsxs("table",{"data-cdap-table":"1",style:{borderCollapse:"collapse",minWidth:1e3,width:"100%",fontSize:11},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:6,background:"#f8fafc"},children:"#"}),G.map(H=>n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:6,background:"#f8fafc"},children:H.label},H.key)),ne.map(H=>n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:6,background:"#fff7ed",textAlign:"center"},children:H.label},H.key)),n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:6,background:"#f8fafc"},children:"TOTAL HOURS REQUIRED"}),n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:6,background:"#f8fafc"},children:"Actions"})]})}),n.jsx("tbody",{children:z.items.map((H,oe)=>n.jsx(v.Fragment,{children:n.jsxs("tr",{style:{background:oe%2===0?"#fff":"#f9fafb"},children:[n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:6},children:oe+1}),G.map(D=>n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:4},children:n.jsx("textarea",{value:H.row[D.key]??"",onChange:Y=>U(H.index,D.key,Y.target.value),disabled:N,style:{width:"100%",border:"1px solid #cbd5e1",borderRadius:4,padding:4,fontSize:11,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"text"},rows:2})},D.key)),ne.map(D=>n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:4,textAlign:"center"},children:n.jsx("input",{type:"checkbox",checked:!!H.row[D.key],onChange:Y=>U(H.index,D.key,Y.target.checked),disabled:N,style:{cursor:N?"not-allowed":"pointer"}})},D.key)),n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:4},children:n.jsx("input",{type:"text",value:H.row.total_hours_required??"",onChange:D=>U(H.index,"total_hours_required",D.target.value),disabled:N,style:{width:70,border:"1px solid #cbd5e1",borderRadius:4,padding:4,fontSize:11,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"text"}})}),n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:4,textAlign:"center"},children:n.jsx("button",{type:"button",onClick:()=>M(H.index),disabled:N,style:{padding:"4px 8px",background:N?"#d1d5db":"#ef4444",color:"#fff",border:"none",borderRadius:6,cursor:N?"not-allowed":"pointer",fontSize:11,opacity:N?.5:1},children:"Delete"})})]})},H.index))})]})})}),n.jsx("div",{style:{marginTop:12},children:n.jsxs("button",{type:"button",onClick:()=>te(z.key),disabled:N,style:{padding:"8px 12px",background:N?"#d1d5db":"#059669",color:"#fff",border:"none",borderRadius:8,cursor:N?"not-allowed":"pointer",fontWeight:600,opacity:N?.5:1},children:["Add Row to Unit ",z.key]})})]},z.key):null})}),n.jsxs("section",{style:{marginTop:16,padding:16,border:"1px solid #e2e8f0",borderRadius:12,background:"#f8fafc"},children:[n.jsx("h4",{style:{marginBottom:10},children:"Reference Materials"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:16},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:12,fontWeight:600},children:"Textbook Details"}),n.jsx("textarea",{value:u,onChange:z=>h(z.target.value),disabled:N,rows:4,style:{width:"100%",padding:8,border:"1px solid #cbd5e1",borderRadius:8,marginTop:6,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"text"},placeholder:"Textbook details (Excel: Column B, Row 64)"})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:12,fontWeight:600},children:"Reference Book Details"}),n.jsx("textarea",{value:p,onChange:z=>f(z.target.value),disabled:N,rows:4,style:{width:"100%",padding:8,border:"1px solid #cbd5e1",borderRadius:8,marginTop:6,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"text"},placeholder:"Reference book details (Excel: Column B, Row 68)"})]})]})]}),n.jsxs("section",{style:{marginTop:16,padding:16,border:"1px solid #e2e8f0",borderRadius:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[n.jsxs("div",{children:[n.jsx("h4",{style:{margin:0},children:"Active Learning Mapping"}),n.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"7  11 PO mapping matrix"})]}),n.jsx("button",{type:"button",onClick:()=>{g(Qa.map(()=>Kc.map(()=>!1))),m(Qa.map(()=>""))},disabled:N,style:{padding:"6px 10px",borderRadius:8,border:"1px solid #e2e8f0",background:N?"#e5e7eb":"#f8fafc",cursor:N?"not-allowed":"pointer",opacity:N?.5:1},children:"Clear All"})]}),n.jsx("div",{style:{overflowX:"auto"},children:n.jsxs("table",{style:{borderCollapse:"collapse",minWidth:900,width:"100%"},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:8,background:"#f8fafc",textAlign:"left"},children:"Activity Type"}),n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:8,background:"#f8fafc",textAlign:"left"},children:"Specific Activity"}),Kc.map(z=>n.jsx("th",{style:{border:"1px solid #e2e8f0",padding:8,background:"#fff7ed",textAlign:"center"},children:z},z))]})}),n.jsx("tbody",{children:Qa.map((z,he)=>n.jsxs("tr",{style:{background:he%2===0?"#fff":"#f9fafb"},children:[n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:8,fontWeight:600},children:z}),n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:8},children:n.jsxs("select",{value:y[he]??"",onChange:X=>{const H=X.target.value;m(oe=>{const D=[...oe];return D[he]=H,D}),g(oe=>{const D=oe.map(le=>[...le]),Y=me(H);if(Array.isArray(Y)&&Y.length===11)for(let le=0;le<Kc.length;le++)D[he][le]=!!Y[le];return D})},disabled:N,style:{width:"100%",padding:6,border:"1px solid #cbd5e1",borderRadius:6,background:N?"#f3f4f6":"#fff",cursor:N?"not-allowed":"pointer"},children:[n.jsx("option",{value:"",children:"-- Select Activity --"}),(Array.isArray(k==null?void 0:k[he])&&(k!=null&&k[he].length)?k==null?void 0:k[he]:sx[z]??[]).map(oe=>String(oe??"").trim()).filter(Boolean).filter((oe,D,Y)=>Y.indexOf(oe)===D).map(oe=>n.jsx("option",{value:oe,children:oe},oe))]})}),Kc.map((X,H)=>n.jsx("td",{style:{border:"1px solid #e2e8f0",padding:8,textAlign:"center"},children:n.jsx("input",{type:"checkbox",checked:!!x[he][H],disabled:N||(()=>{const oe=(y==null?void 0:y[he])??"";if(!oe)return!1;const D=me(oe);return Array.isArray(D)&&D.length===11})(),onChange:oe=>{const D=oe.target.checked;g(Y=>{const le=Y.map($e=>[...$e]);return le[he][H]=D,le})},style:{cursor:N?"not-allowed":"pointer"}})},X))]},z))})]})})]})]})}function VK({courseId:e,showHeader:t=!0,showCourseInput:r=!0}){const[s,a]=v.useState(e||""),[i,o]=v.useState(null),[l,c]=v.useState("idle"),[d,u]=v.useState(null);return v.useEffect(()=>{e&&a(e)},[e]),n.jsxs("div",{children:[t&&n.jsxs("h2",{children:["CDAP - ",s||"No course selected"]}),r&&!e&&n.jsxs("div",{style:{marginBottom:12},children:[n.jsx("label",{style:{marginRight:8},children:"Course ID:"}),n.jsx("input",{value:s,onChange:h=>a(h.target.value),placeholder:"Enter course id",style:{padding:6,border:"1px solid #ccc",borderRadius:4}})]}),n.jsx("div",{style:{marginBottom:12},children:n.jsx(zK,{subjectId:s,onUpload:async h=>{o(h);const p=(h==null?void 0:h.revision)||h;if(!(!s||!p)&&!(!Array.isArray(p==null?void 0:p.rows)||p.rows.length===0))try{c("saving"),u(null),await lA({subjectId:s,status:"draft",rows:p.rows,books:{textbook:p.textbook||"",reference:p.reference||""},active_learning:{grid:[],dropdowns:[],optionsByRow:p.activeLearningOptionsByRow||[],articulation_extras:p.articulationExtras||{}}}),c("saved"),u("Saved parsed CDAP to cloud (draft).")}catch(f){c("error"),u((f==null?void 0:f.message)||"Auto-save failed. You can still click Save in the editor.")}}})}),d&&n.jsx("div",{style:{marginBottom:12,fontSize:12,color:l==="error"?"#b91c1c":"#166534"},children:d}),n.jsx("div",{style:{marginBottom:12},children:n.jsx(HK,{subjectId:s,imported:(i==null?void 0:i.revision)||i})})]})}function ff({value:e,onChange:t,min:r,max:s}){return n.jsx("input",{type:"number",value:e,onChange:a=>{const i=a.target.value;t(i===""?"":Number(i))},min:r,max:s,style:{width:76,padding:"6px 8px",borderRadius:8,border:"1px solid #e6eef8",outline:"none",fontSize:13}})}function u4(e){const t=typeof e.band1=="number"?e.band1:0,r=typeof e.band2=="number"?e.band2:0,s=typeof e.band3=="number"?e.band3:0;if(!(t+r+s))return"-";const i=Math.max(t,r,s);return i===t?1:i===r?2:3}function GK(e){return e===1?{label:"LOW LEVEL",code:"LL"}:e===2?{label:"MEDIUM LEVEL",code:"ML"}:e===3?{label:"HIGH LEVEL",code:"HL"}:{label:"",code:"-"}}const Zt={page:{padding:28,maxWidth:1100,margin:"18px auto",fontFamily:"Inter, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial",color:"#1f3947"},card:{background:"#fff",borderRadius:12,padding:18,border:"1px solid #e6eef8",boxShadow:"0 6px 20px rgba(13,60,100,0.04)"},title:{margin:0,color:"#0b4a6f",fontSize:22,fontWeight:700},subtitle:{marginTop:6,color:"#3d5566",fontSize:13},sectionTitle:{margin:"0 0 10px 0",color:"#0b3b57",fontSize:16},table:{width:"100%",borderCollapse:"collapse",marginTop:8},th:{background:"#f3f8ff",color:"#0b4a6f",fontWeight:700,padding:"8px 10px",border:"1px solid #e6eef8",textAlign:"center",fontSize:13,whiteSpace:"nowrap"},thLeft:{background:"#f3f8ff",color:"#0b4a6f",fontWeight:700,padding:"8px 10px",border:"1px solid #e6eef8",textAlign:"left",fontSize:13,whiteSpace:"nowrap"},td:{padding:"8px 10px",border:"1px solid #eef6fb",color:"#234451",fontSize:13,textAlign:"center"},tdLeft:{padding:"8px 10px",border:"1px solid #eef6fb",color:"#234451",fontSize:13,textAlign:"left"},cellYellow:{background:"#fef9c3"},cellGreen:{background:"#ecfdf3"},link:{color:"#0b4a6f",textDecoration:"underline",fontWeight:700},btn:{border:"1px solid #e6eef8",background:"#fbfdff",padding:"8px 10px",borderRadius:10,cursor:"pointer",fontWeight:700,color:"#0b4a6f"},pill:{display:"inline-flex",alignItems:"center",gap:8,padding:"8px 10px",borderRadius:10,background:"#fbfdff",border:"1px solid #e6eef8",fontSize:13,color:"#234451"}};function ob(e){return String(e||"").trim().toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,"")}function QK(e){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const t=parseFloat(e.replace(/[^0-9.\-]/g,""));return Number.isFinite(t)?t:null}return null}function XK(e){return e<=6?"HC":e<=8?"MC":"EC"}function YK(e){return e==="EC"?"L1":e==="MC"?"L2":e==="HC"?"L3":"-"}async function KK(e){var x;let t;try{t=await import("xlsx")}catch{throw new Error('Missing dependency "xlsx". Install it with: npm install xlsx  (or yarn add xlsx / pnpm add xlsx)')}const r=await e.arrayBuffer(),s=t.read(r,{type:"array"}),a=(x=s.SheetNames)==null?void 0:x[0];if(!a)throw new Error("No sheet found in the Excel file.");const i=s.Sheets[a],o=t.utils.sheet_to_json(i,{defval:""})||[];if(!o.length)throw new Error("Excel sheet is empty.");const l=Object.keys(o[0]||{}),c=new Map;l.forEach(g=>c.set(ob(g),g));const d=c.get("grade")||l.find(g=>ob(g).includes("grade"))||null,u=c.get("gpaconversion")||c.get("gpaconvert")||l.find(g=>{const y=ob(g);return y.includes("gpaconversion")||y.includes("gpaconvert")||y==="gpa"})||null;if(!d||!u)throw new Error('Excel must contain columns for "Grade" and "GPA conversion".');const h=[];for(const g of o){if(!String(g[d]??"").trim())continue;const m=QK(g[u]);m!==null&&h.push(m)}if(!h.length)throw new Error('No numeric "GPA conversion" values found.');const p=h.reduce((g,y)=>g+y,0)/h.length,f=Number(p.toFixed(2));return{fileName:e.name,studentsCount:h.length,meanGpa:f,courseLevel:XK(f)}}function JK({courseId:e,courseCode:t,courseName:r,embedded:s}){const a=Ji(),i=Ri(),o=(a.pathname||"").toLowerCase().includes("/lca/pbr"),[l,c]=v.useState({courseCode:t??e??"",courseName:r??"",credit:"",courseModule:""});v.useEffect(()=>{c(R=>({...R,courseCode:t??e??R.courseCode,courseName:r??R.courseName}))},[e,t,r]);const[d,u]=v.useState({band1:"",band2:"",band3:""}),h=v.useMemo(()=>u4(d),[d]),[p,f]=v.useState([{name:"Prerequisite 1",band1:"",band2:"",band3:""}]),x=v.useMemo(()=>p.map(R=>u4({band1:R.band1,band2:R.band2,band3:R.band3})),[p]),g=v.useMemo(()=>{const R=x.filter(me=>me!=="-");if(!R.length)return"";const q=R.reduce((me,fe)=>me+fe,0);return Number((q/R.length).toFixed(2))},[x]),y=v.useMemo(()=>g===""?"":Math.floor(g),[g]),m=v.useMemo(()=>y===""||y===0?"-":y===1||y===2||y===3?y:"-",[y]),w=v.useMemo(()=>GK(m),[m]),S=v.useMemo(()=>m==="-"?"-":`L${m}`,[m]),[k,F]=v.useState(null),[L,C]=v.useState(null),[O,T]=v.useState(null),[W,A]=v.useState(null),N=v.useMemo(()=>L?L.courseLevel:k?k.courseLevel:"-",[k,L]),P=v.useMemo(()=>YK(N),[N]),K=v.useMemo(()=>P!=="-"?P:S,[S,P]),re=e?`/obe/course/${encodeURIComponent(e)}`:"/obe/course",ge=async(R,q)=>{if(T(null),!q){R==="cay1"?F(null):C(null);return}try{A(R);const me=await KK(q);R==="cay1"?F(me):C(me)}catch(me){T(String((me==null?void 0:me.message)||me||"Failed to parse Excel")),R==="cay1"?F(null):C(null)}finally{A(null)}},Fe=R=>s?n.jsx(n.Fragment,{children:R}):n.jsx("div",{style:Zt.page,children:n.jsx("div",{style:Zt.card,children:R})});return Fe(o?n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[n.jsxs("div",{children:[n.jsx("h2",{style:Zt.title,children:"Previous Batch Result (PBR)"}),n.jsx("div",{style:Zt.subtitle,children:"Upload up to 2 Excel files (max 2)."})]}),n.jsx("button",{type:"button",onClick:()=>i(`${re}/lca`),style:Zt.btn,children:"Back"})]}),n.jsx("div",{style:{height:14}}),n.jsx("table",{style:Zt.table,children:n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:800,width:220},children:"CAY-1 Excel"}),n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen},children:n.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:R=>{var q;return ge("cay1",((q=R.target.files)==null?void 0:q[0])||null)}})})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:800},children:"CAY-2 Excel"}),n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen},children:n.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:R=>{var q;return ge("cay2",((q=R.target.files)==null?void 0:q[0])||null)}})})]})]})}),W&&n.jsxs("div",{style:{marginTop:10,fontSize:13,color:"#3d5566"},children:["Parsing ",W.toUpperCase()," Excel"]}),O&&n.jsx("div",{style:{marginTop:10,fontSize:13,color:"#b42318",fontWeight:700},children:O}),n.jsx("div",{style:{height:14}}),n.jsxs("table",{style:Zt.table,children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:Zt.thLeft,children:"DATASET"}),n.jsx("th",{style:Zt.th,children:"FILE"}),n.jsx("th",{style:Zt.th,children:"STUDENTS"}),n.jsx("th",{style:Zt.th,children:"MEAN GPA"}),n.jsx("th",{style:Zt.th,children:"COURSE LEVEL"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:900},children:"CAY-1"}),n.jsx("td",{style:Zt.tdLeft,children:(k==null?void 0:k.fileName)||""}),n.jsx("td",{style:Zt.td,children:(k==null?void 0:k.studentsCount)??""}),n.jsx("td",{style:Zt.td,children:k?k.meanGpa:""}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:(k==null?void 0:k.courseLevel)||""})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:900},children:"CAY-2"}),n.jsx("td",{style:Zt.tdLeft,children:(L==null?void 0:L.fileName)||""}),n.jsx("td",{style:Zt.td,children:(L==null?void 0:L.studentsCount)??""}),n.jsx("td",{style:Zt.td,children:L?L.meanGpa:""}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:(L==null?void 0:L.courseLevel)||""})]})]})]}),n.jsx("div",{style:{height:14}}),n.jsx("table",{style:Zt.table,children:n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:900,width:220},children:"PREVIOUS BATCH RESULT (PBR)"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:N==="-"?"":N}),n.jsx("td",{style:{...Zt.tdLeft,fontWeight:900},children:"Learner Centric Level"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:P==="-"?"":P})]}),n.jsx("tr",{children:n.jsx("td",{style:{...Zt.tdLeft,color:"#557085"},colSpan:4,children:"Course level rule: mean GPA 06 = HC, 68 = MC, >8 = EC. PBR uses CAY-2 when provided; otherwise CAY-1."})})]})})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12,marginBottom:18},children:[n.jsxs("div",{children:[n.jsx("h2",{style:Zt.title,children:"Learner Centric Approach"}),n.jsx("div",{style:Zt.subtitle,children:"Enter values in the highlighted cells; levels are computed automatically."})]}),n.jsx("div",{style:{...Zt.pill,fontWeight:800},children:"INDEX"})]}),n.jsx("table",{style:Zt.table,children:n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,width:220,fontWeight:700},children:"COURSE CODE"}),n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen},children:n.jsx("input",{value:l.courseCode,readOnly:!0,disabled:!0,"aria-disabled":"true",title:"Course code is locked",style:{width:"100%",border:"none",background:"transparent",fontSize:13,outline:"none",cursor:"not-allowed",color:"#234451"}})})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},children:"COURSE NAME"}),n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen},children:n.jsx("input",{value:l.courseName,readOnly:!0,disabled:!0,"aria-disabled":"true",title:"Course name is locked",style:{width:"100%",border:"none",background:"transparent",fontSize:13,outline:"none",cursor:"not-allowed",color:"#234451"}})})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},children:"CREDIT OF THE COURSE"}),n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen},children:n.jsx("input",{value:l.credit,onChange:R=>c(q=>({...q,credit:R.target.value})),style:{width:"100%",border:"none",background:"transparent",fontSize:13,outline:"none"}})})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},children:"COURSE MODULE"}),n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen},children:n.jsx("input",{value:l.courseModule,onChange:R=>c(q=>({...q,courseModule:R.target.value})),style:{width:"100%",border:"none",background:"transparent",fontSize:13,outline:"none"}})})]})]})}),n.jsx("div",{style:{height:16}}),n.jsx("div",{style:Zt.sectionTitle,children:"STEP 1: Identifying Learner profile"}),n.jsxs("table",{style:Zt.table,children:[n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx("th",{style:Zt.thLeft,colSpan:5,children:"1.1 CURRENT GPA PROFILE (CGP)"}),n.jsx("th",{style:Zt.th,children:"LEVEL"})]}),n.jsxs("tr",{children:[n.jsx("th",{style:Zt.thLeft,children:"Current batch mean GPA"}),n.jsx("th",{style:Zt.th,children:"1"}),n.jsx("th",{style:Zt.th,children:"2"}),n.jsx("th",{style:Zt.th,children:"3"}),n.jsx("th",{style:Zt.th,children:" "}),n.jsx("th",{style:Zt.th,children:" "})]}),n.jsxs("tr",{children:[n.jsx("th",{style:Zt.thLeft,children:"GPA"}),n.jsx("th",{style:Zt.th,children:"0 - 5"}),n.jsx("th",{style:Zt.th,children:"5 - 7.5"}),n.jsx("th",{style:Zt.th,children:"> 7.5"}),n.jsx("th",{style:Zt.th,children:" "}),n.jsx("th",{style:Zt.th,children:" "})]})]}),n.jsx("tbody",{children:n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},children:"NUMBER OF STUDENTS (CAY-1)"}),n.jsx("td",{style:{...Zt.td,...Zt.cellYellow},children:n.jsx(ff,{value:d.band1,onChange:R=>u(q=>({...q,band1:R}))})}),n.jsx("td",{style:{...Zt.td,...Zt.cellYellow},children:n.jsx(ff,{value:d.band2,onChange:R=>u(q=>({...q,band2:R}))})}),n.jsx("td",{style:{...Zt.td,...Zt.cellYellow},children:n.jsx(ff,{value:d.band3,onChange:R=>u(q=>({...q,band3:R}))})}),n.jsx("td",{style:Zt.td,children:" "}),n.jsx("td",{style:{...Zt.td,fontWeight:800,color:"#0b4a6f"},children:h})]})})]}),n.jsx("div",{style:{height:14}}),n.jsxs("table",{style:Zt.table,children:[n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx("th",{style:Zt.thLeft,colSpan:4,children:"1.2 PRE REQUISITE PROFILE (PRP)"}),n.jsx("th",{style:Zt.th,children:"LEVEL"}),n.jsx("th",{style:Zt.th,children:" "})]}),n.jsxs("tr",{children:[n.jsx("th",{style:Zt.thLeft,children:" "}),n.jsx("th",{style:Zt.th,children:"1"}),n.jsx("th",{style:Zt.th,children:"2"}),n.jsx("th",{style:Zt.th,children:"3"}),n.jsx("th",{style:Zt.th,children:" "}),n.jsx("th",{style:Zt.th,children:" "})]}),n.jsxs("tr",{children:[n.jsx("th",{style:Zt.thLeft,children:" "}),n.jsx("th",{style:Zt.th,children:"0 - 5"}),n.jsx("th",{style:Zt.th,children:"5 - 7.5"}),n.jsx("th",{style:Zt.th,children:"> 7.5"}),n.jsx("th",{style:Zt.th,children:" "}),n.jsx("th",{style:Zt.th,children:" "})]})]}),n.jsxs("tbody",{children:[p.map((R,q)=>n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},children:R.name}),n.jsx("td",{style:{...Zt.td,...Zt.cellYellow},children:n.jsx(ff,{value:R.band1,onChange:me=>f(fe=>{const E=[...fe];return E[q]={...E[q],band1:me},E})})}),n.jsx("td",{style:{...Zt.td,...Zt.cellYellow},children:n.jsx(ff,{value:R.band2,onChange:me=>f(fe=>{const E=[...fe];return E[q]={...E[q],band2:me},E})})}),n.jsx("td",{style:{...Zt.td,...Zt.cellYellow},children:n.jsx(ff,{value:R.band3,onChange:me=>f(fe=>{const E=[...fe];return E[q]={...E[q],band3:me},E})})}),n.jsx("td",{style:{...Zt.td,fontWeight:800,color:"#0b4a6f"},children:x[q]}),n.jsx("td",{style:{...Zt.td},children:n.jsx("button",{type:"button",title:"Delete prerequisite","aria-label":`Delete ${R.name}`,onClick:()=>f(me=>me.filter((fe,E)=>E!==q)),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:16},children:""})})]},R.name)),n.jsx("tr",{children:n.jsxs("td",{style:{...Zt.tdLeft},colSpan:6,children:[n.jsx("button",{type:"button",style:{...Zt.btn,padding:"6px 10px"},onClick:()=>f(R=>[...R,{name:`Prerequisite ${R.length+1}`,band1:"",band2:"",band3:""}]),"aria-label":"Add prerequisite",children:"+"}),n.jsx("span",{style:{marginLeft:10,fontSize:13,color:"#557085"},children:"Add next prerequisite (no limit)"})]})}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},colSpan:5,children:"AVERAGE"}),n.jsx("td",{style:{...Zt.td,fontWeight:800},children:g===""?"-":g})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},colSpan:5,children:"Standardized level of Learner profile as per the above norms"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900,color:"#0b4a6f"},children:m==="-"?"-":m})]})]})]}),n.jsx("div",{style:{height:14}}),n.jsx("table",{style:Zt.table,children:n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen,fontWeight:900},children:"LOW LEVEL"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:"LL"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:"1"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen,fontWeight:900},children:"MEDIUM LEVEL"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:"ML"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:"2"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,...Zt.cellGreen,fontWeight:900},children:"HIGH LEVEL"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:"HL"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:"3"})]})]})}),n.jsx("div",{style:{height:14}}),n.jsx("table",{style:Zt.table,children:n.jsx("tbody",{children:n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:800,width:220},children:"The Learners are at"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:w.label}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:w.code})]})})}),n.jsx("div",{style:{height:14}}),n.jsx("table",{style:Zt.table,children:n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:900,width:260},children:n.jsx(sa,{style:Zt.link,to:`${re}/lca/pbr`,children:"PREVIOUS BATCH RESULT (PBR)"})}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:N==="-"?"":N}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:L?"COURSE LEVEL (CAY-2)":"COURSE LEVEL (CAY-1)"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:700},children:" "}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:k?`Mean GPA: ${k.meanGpa}`:""}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:L?`Mean GPA: ${L.meanGpa}`:""})]})]})}),n.jsx("div",{style:{height:12}}),n.jsx("table",{style:Zt.table,children:n.jsx("tbody",{children:n.jsxs("tr",{children:[n.jsx("td",{style:{...Zt.tdLeft,fontWeight:900,width:260},children:"Learner Centric Level"}),n.jsx("td",{style:{...Zt.td,...Zt.cellGreen,fontWeight:900},children:K})]})})})]}))}const Sr={page:{padding:28,maxWidth:1100,margin:"18px auto",fontFamily:"Inter, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial",color:"#1f3947"},card:{background:"#fff",borderRadius:12,padding:18,border:"1px solid #e6eef8",boxShadow:"0 6px 20px rgba(13,60,100,0.04)"},header:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12,marginBottom:18},titleBlock:{display:"flex",flexDirection:"column"},title:{margin:0,color:"#0b4a6f",fontSize:22,fontWeight:700},subtitle:{marginTop:6,color:"#3d5566",fontSize:13},grid:{display:"grid",gap:16},sectionTitle:{margin:"0 0 10px 0",color:"#0b3b57",fontSize:16},paragraph:{color:"#334e68",lineHeight:1.45,margin:0},table:{width:"100%",borderCollapse:"collapse",marginTop:8},th:{background:"#f3f8ff",color:"#0b4a6f",fontWeight:700,padding:"8px 10px",border:"1px solid #e6eef8",textAlign:"center",fontSize:13},td:{padding:"8px 10px",border:"1px solid #eef6fb",color:"#234451",fontSize:13,textAlign:"center"},note:{color:"#6b8190",fontSize:13},kv:{background:"#fbfdff",padding:10,borderRadius:8,border:"1px solid #e9f3fb",minWidth:160},kvLabel:{fontSize:12,color:"#557085",marginBottom:6},kvValue:{fontWeight:700,color:"#0b4a6f"}};function ZK({title:e,columns:t,rows:r}){return n.jsxs("div",{children:[e&&n.jsx("div",{style:Sr.sectionTitle,children:e}),n.jsxs("table",{style:Sr.table,children:[n.jsx("thead",{children:n.jsx("tr",{children:t.map(s=>n.jsx("th",{style:Sr.th,children:s},s))})}),n.jsx("tbody",{children:r.map((s,a)=>n.jsx("tr",{children:s.map((i,o)=>n.jsx("td",{style:Sr.td,children:i},o))},a))})]})]})}function g8({courseCode:e,courseName:t,initialTab:r,viewerMode:s}){const a=v.useMemo(()=>e?String(e):"",[e]),[i,o]=v.useState(r||"instructions");v.useEffect(()=>{r&&o(r)},[r]);const l=[{key:"instructions",label:"LCA Instructions"},{key:"lca",label:"LCA"},{key:"cdap",label:"CDAP"},{key:"articulation",label:"Articulation Matrix"},{key:"cotarget",label:"CO Target"}],c={display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},d=(u,h)=>{const p=i===u;return n.jsx("button",{onClick:()=>o(u),style:{padding:"8px 12px",borderRadius:8,border:p?"2px solid #0b4a6f":"1px solid #e6eef8",background:p?"#0b4a6f":"#fbfdff",color:p?"#fff":"#0b4a6f",fontWeight:700,cursor:"pointer"},children:h},h)};return n.jsx("div",{style:Sr.page,children:n.jsxs("div",{style:{...Sr.card},children:[n.jsx("div",{style:Sr.header,children:n.jsxs("div",{style:Sr.titleBlock,children:[n.jsx("h2",{style:Sr.title,children:"Learner Centric Approach  Instructions"}),n.jsx("div",{style:Sr.subtitle,children:"Default LCA planning matrix and instruction-level guidance for course design and assessment."})]})}),n.jsxs("div",{style:{padding:12},children:[n.jsx("div",{style:c,children:l.map(u=>d(u.key,u.label))}),n.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:12,flexWrap:"wrap",marginBottom:12},children:n.jsxs("div",{style:Sr.kv,children:[n.jsx("div",{style:Sr.kvLabel,children:"Course"}),n.jsx("div",{style:Sr.kvValue,children:(e||"")+(t?`  ${t}`:"")})]})}),i==="instructions"&&n.jsxs("div",{style:Sr.grid,children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:16,alignItems:"start"},children:n.jsxs("div",{style:{...Sr.card,padding:14,gridColumn:"1 / -1"},children:[n.jsx("div",{style:Sr.sectionTitle,children:"Overview"}),n.jsx("p",{style:Sr.paragraph,children:"Use this page to map learner profiles (L1L3) to instruction levels (IL-1..IL-3) and to define assessment distribution. The tables below provide recommended mappings and a sample distribution for course planning."}),n.jsx("div",{style:{marginTop:12},children:n.jsx(ZK,{title:"Learner Profile  Quick Guide",columns:["Profile","Description"],rows:[["L1","Lower CGPA / limited prerequisites"],["L2","Average preparedness"],["L3","High CGPA / strong prerequisites"]]})})]})}),n.jsxs("div",{style:{...Sr.card,padding:14},children:[n.jsx("div",{style:Sr.sectionTitle,children:"Instruction Steps (recommended)"}),n.jsxs("ol",{style:{margin:0,paddingLeft:18,color:"#334e68"},children:[n.jsx("li",{style:{marginBottom:8},children:"Identify learner profile (L1 / L2 / L3) for the target offering."}),n.jsx("li",{style:{marginBottom:8},children:"Use IL mapping to determine instruction emphasis across IL-1..IL-3."}),n.jsx("li",{style:{marginBottom:8},children:"Apply distribution when preparing teaching plan and question banks (map PT / CO / BTL)."})]})]}),n.jsxs("div",{style:{display:"grid",gap:12},children:[n.jsxs("div",{style:{...Sr.card,padding:12},children:[n.jsx("div",{style:Sr.sectionTitle,children:"Sample Assessment Distribution by Learner Profile"}),n.jsxs("table",{style:Sr.table,children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:Sr.th,children:"Learner Profile"}),n.jsx("th",{style:Sr.th,children:"IL-1 %"}),n.jsx("th",{style:Sr.th,children:"IL-2 %"}),n.jsx("th",{style:Sr.th,children:"IL-3 %"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"L1"}),n.jsx("td",{style:Sr.td,children:"60"}),n.jsx("td",{style:Sr.td,children:"30"}),n.jsx("td",{style:Sr.td,children:"10"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"L2"}),n.jsx("td",{style:Sr.td,children:"30"}),n.jsx("td",{style:Sr.td,children:"50"}),n.jsx("td",{style:Sr.td,children:"20"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"L3"}),n.jsx("td",{style:Sr.td,children:"10"}),n.jsx("td",{style:Sr.td,children:"40"}),n.jsx("td",{style:Sr.td,children:"50"})]})]})]})]}),n.jsxs("div",{style:{...Sr.card,padding:12},children:[n.jsx("div",{style:Sr.sectionTitle,children:"Current Course  Example Breakdown"}),n.jsxs("table",{style:Sr.table,children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:Sr.th,children:"Component"}),n.jsx("th",{style:Sr.th,children:"IL-1"}),n.jsx("th",{style:Sr.th,children:"IL-2"}),n.jsx("th",{style:Sr.th,children:"IL-3"}),n.jsx("th",{style:Sr.th,children:"Notes"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"Teaching Hours"}),n.jsx("td",{style:Sr.td,children:"40%"}),n.jsx("td",{style:Sr.td,children:"40%"}),n.jsx("td",{style:Sr.td,children:"20%"}),n.jsx("td",{style:Sr.td,children:"Blend of lectures and labs"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"Question Bank"}),n.jsx("td",{style:Sr.td,children:"50%"}),n.jsx("td",{style:Sr.td,children:"30%"}),n.jsx("td",{style:Sr.td,children:"20%"}),n.jsx("td",{style:Sr.td,children:"Adjust difficulty by profile"})]})]})]}),n.jsx("div",{style:{marginTop:10},children:n.jsx("div",{style:Sr.note,children:"Tip: Use these templates as starting points and adapt percentages to the specific cohort."})})]}),n.jsxs("div",{style:{...Sr.card,padding:12},children:[n.jsx("div",{style:Sr.sectionTitle,children:"IL Mapping"}),n.jsxs("table",{style:Sr.table,children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:Sr.th,children:"IL"}),n.jsx("th",{style:Sr.th,children:"Instruction Focus"}),n.jsx("th",{style:Sr.th,children:"Typical Assessment Emphasis"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"IL-1"}),n.jsx("td",{style:Sr.td,children:"Foundation, concepts, scaffolding"}),n.jsx("td",{style:Sr.td,children:"More formative; MCQ / guided tasks"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"IL-2"}),n.jsx("td",{style:Sr.td,children:"Application and practice"}),n.jsx("td",{style:Sr.td,children:"Mixture of practical and theory"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:Sr.td,children:"IL-3"}),n.jsx("td",{style:Sr.td,children:"Advanced, synthesis, independent work"}),n.jsx("td",{style:Sr.td,children:"Problem-solving, projects, high-level questions"})]})]})]})]})]})]}),i==="lca"&&n.jsx("fieldset",{disabled:!!s,style:{border:0,padding:0,margin:0},children:a?n.jsx(JK,{embedded:!0,courseId:a,courseCode:a,courseName:t??void 0}):n.jsxs("div",{style:{...Sr.card,padding:16},children:[n.jsx("div",{style:Sr.sectionTitle,children:"LCA"}),n.jsx("div",{style:Sr.paragraph,children:"Select a course to view the LCA worksheet."})]})}),i==="cdap"&&n.jsx("fieldset",{disabled:!!s,style:{border:0,padding:0,margin:0},children:a?n.jsx("div",{style:{...Sr.card,padding:12},children:n.jsx(VK,{courseId:a,showHeader:!1,showCourseInput:!1})}):n.jsxs("div",{style:{...Sr.card,padding:16},children:[n.jsx("div",{style:Sr.sectionTitle,children:"CDAP"}),n.jsx("div",{style:Sr.paragraph,children:"Select a course to open CDAP."})]})}),i==="articulation"&&n.jsx("fieldset",{disabled:!!s,style:{border:0,padding:0,margin:0},children:a?n.jsx(IK,{embedded:!0,courseId:a}):n.jsxs("div",{style:{...Sr.card,padding:16},children:[n.jsx("div",{style:Sr.sectionTitle,children:"Articulation Matrix"}),n.jsx("div",{style:Sr.paragraph,children:"Select a course to view the articulation matrix."})]})}),i==="cotarget"&&n.jsxs("div",{children:[n.jsxs("div",{style:{...Sr.card,padding:14,marginBottom:12},children:[n.jsx("div",{style:Sr.sectionTitle,children:"CO Target  Read Only"}),n.jsx("p",{style:Sr.paragraph,children:"This is a read-only view of the Course Outcome Attainment targets. No actions are available on this screen."})]}),n.jsxs("div",{style:{...Sr.card,padding:12},children:[n.jsx("div",{style:{marginBottom:8,fontWeight:700,color:"#0b4a6f"},children:"Course Outcome Attainment Targets"}),n.jsxs("table",{style:{...Sr.table,marginBottom:12},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:Sr.th,children:"COs"}),n.jsx("th",{style:Sr.th,children:"ICO"}),n.jsx("th",{style:Sr.th,children:"BCO"}),n.jsx("th",{style:Sr.th,children:"ACO"}),n.jsx("th",{style:Sr.th,children:"API"}),n.jsx("th",{style:Sr.th,children:"IIC"}),n.jsx("th",{style:Sr.th,children:"COs Targets"}),n.jsx("th",{style:Sr.th,children:"CO TARGET IN 3 POINT SCALE"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{style:Sr.tdLeft,children:"CO1"}),n.jsx("td",{style:Sr.td,children:"0.4"}),n.jsx("td",{style:Sr.td,children:"0.3"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"68"}),n.jsx("td",{style:Sr.td,children:"2.03"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:Sr.tdLeft,children:"CO2"}),n.jsx("td",{style:Sr.td,children:"0.4"}),n.jsx("td",{style:Sr.td,children:"0.3"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"66"}),n.jsx("td",{style:Sr.td,children:"1.99"})]}),n.jsxs("tr",{children:[n.jsx("td",{style:Sr.tdLeft,children:"CO3"}),n.jsx("td",{style:Sr.td,children:"0.4"}),n.jsx("td",{style:Sr.td,children:"0.3"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"0.1"}),n.jsx("td",{style:Sr.td,children:"67"}),n.jsx("td",{style:Sr.td,children:"2.01"})]})]})]}),n.jsx("div",{style:{color:"#557085",fontSize:13},children:"Target table is generated automatically. This view is read-only."})]})]})]})]})})}const eJ=[{key:"q1",label:"Q1",max:2,co:1,btl:1},{key:"q2",label:"Q2",max:2,co:1,btl:3},{key:"q3",label:"Q3",max:2,co:1,btl:4},{key:"q4",label:"Q4",max:2,co:2,btl:1},{key:"q5",label:"Q5",max:2,co:2,btl:1},{key:"q6",label:"Q6",max:2,co:2,btl:2},{key:"q7",label:"Q7",max:16,co:1,btl:2},{key:"q8",label:"Q8",max:16,co:2,btl:3},{key:"q9",label:"Q9",max:16,co:"1&2",btl:5}],tJ=[{key:"q1",label:"Q1",max:2,co:3,btl:1},{key:"q2",label:"Q2",max:2,co:3,btl:3},{key:"q3",label:"Q3",max:2,co:3,btl:4},{key:"q4",label:"Q4",max:2,co:4,btl:1},{key:"q5",label:"Q5",max:2,co:4,btl:1},{key:"q6",label:"Q6",max:2,co:4,btl:2},{key:"q7",label:"Q7",max:16,co:3,btl:2},{key:"q8",label:"Q8",max:16,co:4,btl:3},{key:"q9",label:"Q9",max:16,co:"3&4",btl:5}],lb=30,dh={co1:42,co2:42,co3:58,co4:42,co5:42},G2=[{key:"q1",max:2},{key:"q2",max:2},{key:"q3",max:2},{key:"q4",max:2},{key:"q5",max:2},{key:"q6",max:2},{key:"q7",max:2},{key:"q8",max:2},{key:"q9",max:2},{key:"q10",max:2},{key:"q11",max:14},{key:"q12",max:14},{key:"q13",max:14},{key:"q14",max:14},{key:"q15",max:14},{key:"q16",max:10}],y8=[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5,5],cb=G2.reduce((e,t,r)=>e+(y8[r]===5?t.max:0),0),f4=10;function rJ(e,t,r){if(t)return 5;const s=On(e);return r.includes("model")&&(s==="THEORY"||s==="TCPL"||s==="TCPR")?5:4}function nJ(e){return Array.from({length:e},(t,r)=>r+1)}const Rf={ssa1:1.5,cia1:3,formative1:2.5},sJ={THEORY:{ssa1:1.5,cia1:3,formative1:2.5},TCPR:{ssa1:2,cia1:2.5,formative1:2},TCPL:{ssa1:1,cia1:2,formative1:3},LAB:{ssa1:1,cia1:1,formative1:1},PRACTICAL:{ssa1:1,cia1:1,formative1:1},SPECIAL:{ssa1:1.5,cia1:3,formative1:2.5},AUDIT:{ssa1:1.5,cia1:3,formative1:2.5}};function ax(e){if(!e)return Rf;const t=On(e);return sJ[t]||Rf}function Hn(e,t,r){return Math.max(t,Math.min(r,e))}function xa(e){return Math.round(e*10)/10}function Jc(e){return Math.round(e*100)/100}function ho(e){if(e===""||e==null)return null;const t=Number(e);return Number.isFinite(t)?t:null}function uh(e,t){const r=Array.isArray(e)?e:[],s=[];for(let a=0;a<t;a++){const i=r[a];if(i===""||i==null){s.push("");continue}const o=typeof i=="number"?i:Number(i);s.push(Number.isFinite(o)?o:"")}return s}function ix(e){const t=e.filter(r=>typeof r=="number"&&Number.isFinite(r));return t.length?t.reduce((r,s)=>r+s,0)/t.length:null}function db(e){const t=typeof e=="number"?e:Number(e);if(!Number.isFinite(t))return null;const r=Math.trunc(t);return r>=1&&r<=6?r:null}function h4(e){if(e==="1&2"||e==="both")return"1&2";if(typeof e=="string"){const r=e.trim();if(r==="1&2"||r==="1,2"||r==="1/2"||r==="2/1")return"1&2";if(r==="2")return 2;if(r==="1")return 1}if(Array.isArray(e)){const r=e.map(s=>Number(s)).filter(s=>Number.isFinite(s));if(r.includes(1)&&r.includes(2))return"1&2";if(r.includes(2))return 2;if(r.includes(1))return 1}const t=Number(e);return t===2?2:t===12?"1&2":1}function p4(e){if(e==="3&4"||e==="both")return"3&4";if(typeof e=="string"){const r=e.trim();if(r==="3&4"||r==="3,4"||r==="3/4"||r==="4/3")return"3&4";if(r==="4")return 4;if(r==="3")return 3}if(Array.isArray(e)){const r=e.map(s=>Number(s)).filter(s=>Number.isFinite(s));if(r.includes(3)&&r.includes(4))return"3&4";if(r.includes(4))return 4;if(r.includes(3))return 3}const t=Number(e);return t===4?4:t===3?3:t===34?"3&4":3}function aJ(e){return e==="1&2"?{co1:.5,co2:.5}:e===2?{co1:0,co2:1}:{co1:1,co2:0}}function m4(e,t){const r=e[t];if(!r)return{co1:0,co2:0};if(r.co==="1&2")return{co1:.5,co2:.5};const s=e.some(o=>o.co==="1&2"),a=t===e.length-1,i=String(r.key||"").toLowerCase()==="q9"||String(r.label||"").toLowerCase().includes("q9");return!s&&a&&i?{co1:.5,co2:.5}:aJ(r.co)}function iJ(e){return e==="3&4"?{co3:.5,co4:.5}:e===4?{co3:0,co4:1}:{co3:1,co4:0}}function x4(e,t){const r=e[t];if(!r)return{co3:0,co4:0};if(r.co==="3&4")return{co3:.5,co4:.5};const s=e.some(o=>o.co==="3&4"),a=t===e.length-1,i=String(r.key||"").toLowerCase()==="q9"||String(r.label||"").toLowerCase().includes("q9");return!s&&a&&i?{co3:.5,co4:.5}:iJ(r.co)}function g4(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const o=r.localeCompare(s);if(o)return o}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim();return a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})}function ox(e){const{ssaMark:t,ciaMark:r,f1Mark:s,ssaMax:a,ciaMax:i,f1Max:o,ssaW:l,ciaW:c,f1W:d,outOf:u}=e,h=[{mark:t,max:a,w:l},{mark:r,max:i,w:c},{mark:s,max:o,w:d}].filter(g=>Number(g.w||0)>0);if(!h.length||!u||!Number.isFinite(Number(u))||h.some(g=>g.mark==null)||h.some(g=>!g.max||!Number.isFinite(Number(g.max))))return null;const p=h.reduce((g,y)=>g+y.w,0);if(!p)return null;const x=h.reduce((g,y)=>g+y.mark/y.max*y.w,0)/p*u;return Number.isFinite(x)?Hn(x,0,u):null}function b8({courseId:e,enabledAssessments:t,classType:r}){const[s,a]=v.useState(null),[i,o]=v.useState(r??null),l=v.useMemo(()=>Array.isArray(t),[t]),c=v.useMemo(()=>{const Oe=Array.isArray(t)?t:[];return new Set(Oe.map(qe=>String(qe||"").trim().toLowerCase()).filter(Boolean))},[t]),d=v.useMemo(()=>c.has("model"),[c]),[u,h]=v.useState(null),[p,f]=v.useState(null),x=v.useMemo(()=>l||kP(i),[l,i]),g=v.useMemo(()=>({ssa1:!x||c.has("ssa1"),ssa2:!x||c.has("ssa2"),formative1:!x||c.has("formative1"),formative2:!x||c.has("formative2"),cia1:!x||c.has("cia1"),cia2:!x||c.has("cia2"),model:!x||c.has("model")}),[x,c]),y=v.useMemo(()=>nw(i)&&!l,[i,l]),m=v.useMemo(()=>On(i)==="TCPL",[i]),w=v.useMemo(()=>{const Oe=On(i);return(Oe==="THEORY"||Oe==="TCPL"||Oe==="TCPR")&&!!g.model},[i,g.model]),S=v.useMemo(()=>{const Oe=Object.entries(g).filter(([qe,Lt])=>Lt).map(([qe])=>qe);return rJ(i,y,Oe)},[i,y,g]),k=v.useMemo(()=>nJ(S),[S]),[F,L]=v.useState([]),[C,O]=v.useState(null),[T,W]=v.useState(null);v.useEffect(()=>{if(!e||T==null||!d){h(null),f(null);return}let Oe=!0;return(async()=>{try{const qe=await sg("model",String(e),Number(T));if(!Oe)return;h(qe),f(null)}catch(qe){if(!Oe)return;h(null),f((qe==null?void 0:qe.message)||"Failed to fetch MODEL publish status")}})(),()=>{Oe=!1}},[e,T,d]);const[A,N]=v.useState(!1),[P,K]=v.useState(null),[re,ge]=v.useState([]),[Fe,R]=v.useState(!1),[q,me]=v.useState(null),[fe,E]=v.useState({ssa1:{},ssa2:{},f1:{},f2:{},cia1:null,cia2:null}),[U,I]=v.useState({}),[M,te]=v.useState({cia1:null,cia2:null,model:null}),[Q,G]=v.useState({lab1:null,lab2:null}),ne=v.useMemo(()=>`co_attainment_cfg_${e}`,[e]),[z,he]=v.useState(!1),[X,H]=v.useState(()=>({ssa1:Rf.ssa1,cia1:Rf.cia1,formative1:Rf.formative1})),[oe,D]=v.useState(f4),Y=!!(d&&u&&u.is_published);v.useEffect(()=>{w&&D(Y?30:f4)},[w,Y]);const[le,$e]=v.useState("default"),je=Jr.useRef(null),We=Jr.useRef(null),[Ee,Re]=v.useState(null),[Ve,St]=v.useState(null),[rt,ze]=v.useState(null),[Ie,ot]=v.useState(!1),[be,we]=v.useState(!1),[Me,Wt]=v.useState({});v.useEffect(()=>{try{const Oe=localStorage.getItem("roles"),qe=localStorage.getItem("permissions"),Lt=Oe?JSON.parse(Oe):[],dt=qe?JSON.parse(qe):[],He=Array.isArray(Lt)?Lt.map(Z=>String(Z||"").toUpperCase()):[],$t=Array.isArray(dt)?dt.map(Z=>String(Z||"").toLowerCase()):[],Ue=He.includes("IQAC"),er=$t.includes("obe.master.manage");he(Ue||er)}catch{he(!1)}},[]),v.useEffect(()=>{let Oe=!0;const qe=async Lt=>{Oe&&Re("Loading IQAC weights");try{const He=await ig();if(!Oe)return;if(He&&typeof He=="object"){const $t={...He};try{Object.defineProperty($t,"__source",{value:"server",enumerable:!1})}catch{}je.current=$t,ze(Object.keys($t||{}).length||0),St(null),Re(`Server weights loaded (${Object.keys($t||{}).length} class-types)`);const Ue=Lt??i;if(Ue){const er=On(Ue),Z=$t[er];if(Z&&typeof Z=="object"){const pe=ax(Ue);H({ssa1:Number.isFinite(Number(Z.ssa1))?Number(Z.ssa1):pe.ssa1,cia1:Number.isFinite(Number(Z.cia1))?Number(Z.cia1):pe.cia1,formative1:Number.isFinite(Number(Z.formative1))?Number(Z.formative1):pe.formative1}),$e("server"),Re(`Applied server weights for ${er}`);return}else Re(`Server weights loaded (${Object.keys($t||{}).length} keys) but no entry for ${er}`)}}}catch(He){const $t=String((He==null?void 0:He.message)||He||"Unknown error");St($t),Re(`Server fetch failed: ${$t}`)}try{const He=Bn("iqac_class_type_weights");if(He&&typeof He=="object"){const $t={...He};try{Object.defineProperty($t,"__source",{value:"local",enumerable:!1})}catch{}je.current=$t,ze(Object.keys($t||{}).length||0);const Ue=Lt??i;if(Ue){const er=On(Ue),Z=$t[er];if(Z&&typeof Z=="object"){const pe=ax(Ue);H({ssa1:Number.isFinite(Number(Z.ssa1))?Number(Z.ssa1):pe.ssa1,cia1:Number.isFinite(Number(Z.cia1))?Number(Z.cia1):pe.cia1,formative1:Number.isFinite(Number(Z.formative1))?Number(Z.formative1):pe.formative1}),$e("local"),Re(`Applied local weights for ${er}`);return}else Re(`Local weights loaded (${Object.keys($t||{}).length} keys) but no entry for ${er}`)}}}catch(He){const $t=String((He==null?void 0:He.message)||He||"Unknown error");St($t),Re(`Local weights read failed: ${$t}`)}const dt=Lt??i;if(dt){const He=ax(dt);H(He),$e("default"),Re(`Applied class-type defaults for ${On(dt)}`)}else H(Rf),$e("default"),Re("Applied general defaults (no class type detected)")};return qe(),We.current=qe,()=>{Oe=!1}},[i]),v.useEffect(()=>{try{const Oe=We.current;typeof Oe=="function"&&Oe()}catch{}},[T]),v.useEffect(()=>{try{const Oe=je.current;if(i&&Oe&&typeof Oe=="object"){const qe=On(i),Lt=Oe[qe];if(Lt&&typeof Lt=="object"){const dt=ax(i);H({ssa1:Number.isFinite(Number(Lt.ssa1))?Number(Lt.ssa1):dt.ssa1,cia1:Number.isFinite(Number(Lt.cia1))?Number(Lt.cia1):dt.cia1,formative1:Number.isFinite(Number(Lt.formative1))?Number(Lt.formative1):dt.formative1}),$e(Oe.__source==="server"?"server":"local"),Re(`Applied cached mapping for ${qe}`),St(null)}}}catch{}},[i]),v.useEffect(()=>{let Oe=!0;return(async()=>{try{const qe=await Sl();if(!Oe)return;a(qe||null)}catch{}})(),()=>{Oe=!1}},[e]),v.useEffect(()=>{let Oe=!0;return(async()=>{var qe;try{const Lt=await wl();if(!Oe)return;let dt=(Lt||[]).filter(Ue=>Ue.subject_code===e);if(dt.length===0)try{const Ue=await hr(`/api/academics/teaching-assignments/?subject_code=${encodeURIComponent(String(e||""))}`);if(Ue.ok){const er=await Ue.json();dt=(Array.isArray(er.results)?er.results:Array.isArray(er)?er:er.items||[])||[]}}catch(Ue){console.warn("Server TA list fetch failed:",Ue)}L(dt),O(null);const He=Bn(`coAttainment_selectedTa_${e}`),$t=typeof He=="number"&&dt.some(Ue=>Ue.id===He)&&He||(((qe=dt[0])==null?void 0:qe.id)??null);W($t)}catch(Lt){if(!Oe)return;L([]),W(null),O((Lt==null?void 0:Lt.message)||"Failed to load teaching assignments")}})(),()=>{Oe=!1}},[e]),v.useEffect(()=>{!e||T==null||yn(`coAttainment_selectedTa_${e}`,T)},[e,T]),v.useEffect(()=>{if(r){o(r);return}let Oe=!0;return(async()=>{try{const qe=(F||[]).find(er=>er.id===T)||null,Lt=(qe==null?void 0:qe.class_type)??null;if(Lt){if(!Oe)return;o(Lt);return}const dt=qe==null?void 0:qe.elective_subject_id;if(dt&&!(qe!=null&&qe.section_id)){console.log("[COAttainment] Detected elective TA, fetching elective subject details for:",dt);try{const er=await hr(`/api/curriculum/elective-subjects/${dt}/`);if(er.ok){const Z=await er.json(),pe=Z==null?void 0:Z.class_type;if(console.log("[COAttainment] Elective subject class_type:",pe),pe){if(!Oe)return;o(pe);return}}else console.warn("[COAttainment] Elective subject API returned error:",er.status)}catch(er){console.warn("[COAttainment] Failed to fetch elective subject:",er)}}const He=qe==null?void 0:qe.curriculum_row_id;if(!He)try{const er=String(e).trim().toUpperCase(),Z=await vo();if(!Oe)return;const pe=(Z||[]).find(Le=>String(Le.course_code||"").trim().toUpperCase()===er),ee=(pe==null?void 0:pe.class_type)??null;if(ee){o(ee);return}const ue=await jc();if(!Oe)return;const Ae=(ue||[]).find(Le=>String(Le.course_code||"").trim().toUpperCase()===er);o((Ae==null?void 0:Ae.class_type)??null);return}catch{Oe&&o(null);return}const $t=await rw(Number(He));if(!Oe)return;const Ue=($t==null?void 0:$t.class_type)??null;if(Ue){o(Ue);return}try{const er=String(e).trim().toUpperCase(),Z=await jc();if(!Oe)return;const pe=(Z||[]).find(ee=>String(ee.course_code||"").trim().toUpperCase()===er);o((pe==null?void 0:pe.class_type)??null)}catch{o(null)}}catch{Oe&&o(null)}})(),()=>{Oe=!1}},[F,T,r]),v.useEffect(()=>{yn(ne,{weights:X})},[ne,X]),v.useEffect(()=>{let Oe=!0;return(async()=>{if(T){N(!0),K(null);try{const Lt=(F||[]).find(He=>He.id===T)||null,dt=[];if(Lt&&Lt.elective_subject_id&&!Lt.section_id){const He=Lt.elective_subject_id,$t=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(He))}`);if(!$t.ok)throw new Error(`Elective-choices fetch failed: ${$t.status}`);const Ue=await $t.json();if(!Oe)return;const Z=((Array.isArray(Ue.results)?Ue.results:Array.isArray(Ue)?Ue:Ue.items||[])||[]).map(pe=>({id:Number(pe.student_id??pe.id),reg_no:String(pe.reg_no??pe.registration_no??pe.regno??""),name:String(pe.name??pe.full_name??pe.username??pe.student_name??""),section:pe.section_name??pe.section??null,section_id:pe.section_id??null}));if(!Oe)return;ge(Z.filter(pe=>Number.isFinite(pe.id)).sort(g4))}else{const He=await Jo(T);if(!Oe)return;const $t=(He.students||[]).map(Ue=>({id:Number(Ue.id),reg_no:String(Ue.reg_no??""),name:String(Ue.name??""),section:Ue.section??null})).filter(Ue=>Number.isFinite(Ue.id)).sort(g4);ge($t)}}catch(Lt){if(!Oe)return;ge([]),K((Lt==null?void 0:Lt.message)||"Failed to load roster")}finally{Oe&&N(!1)}}})(),()=>{Oe=!1}},[T,F]);const Ct=v.useMemo(()=>{var qe,Lt;const Oe=(Lt=(qe=s==null?void 0:s.assessments)==null?void 0:qe.cia1)==null?void 0:Lt.questions;return Array.isArray(Oe)&&Oe.length?Oe.map(dt=>({key:String((dt==null?void 0:dt.key)||""),label:String((dt==null?void 0:dt.label)||(dt==null?void 0:dt.key)||""),max:Number((dt==null?void 0:dt.max)||0),co:h4(dt==null?void 0:dt.co),btl:Math.min(6,Math.max(1,Number((dt==null?void 0:dt.btl)||1)))})).filter(dt=>dt.key):eJ},[s]),pr=v.useMemo(()=>{var qe,Lt;const Oe=(Lt=(qe=s==null?void 0:s.assessments)==null?void 0:qe.cia2)==null?void 0:Lt.questions;return Array.isArray(Oe)&&Oe.length?Oe.map(dt=>({key:String((dt==null?void 0:dt.key)||""),label:String((dt==null?void 0:dt.label)||(dt==null?void 0:dt.key)||""),max:Number((dt==null?void 0:dt.max)||0),co:p4(dt==null?void 0:dt.co),btl:Math.min(6,Math.max(1,Number((dt==null?void 0:dt.btl)||1)))})).filter(dt=>dt.key):tJ},[s]),fr=v.useMemo(()=>{let Oe=0,qe=0;const Lt=Ct||[];return Lt.forEach((dt,He)=>{const $t=m4(Lt,He);Oe+=(Number(dt.max)||0)*$t.co1,qe+=(Number(dt.max)||0)*$t.co2}),{co1:Oe,co2:qe}},[Ct]),Be=v.useMemo(()=>{let Oe=0,qe=0;const Lt=pr||[];return Lt.forEach((dt,He)=>{const $t=x4(Lt,He);Oe+=(Number(dt.max)||0)*$t.co3,qe+=(Number(dt.max)||0)*$t.co4}),{co3:Oe,co4:qe}},[pr]),mt=v.useMemo(()=>{var xe,se,Se,Ze,et,Et,wt,gt,zt,Dt,mr,pt,Xt,Rt,_t,jr,Gr,Cr;const Oe=((xe=s==null?void 0:s.assessments)==null?void 0:xe.ssa1)||{},qe=((se=s==null?void 0:s.assessments)==null?void 0:se.ssa2)||{},Lt=((Se=s==null?void 0:s.assessments)==null?void 0:Se.formative1)||{},dt=((Ze=s==null?void 0:s.assessments)==null?void 0:Ze.formative2)||{},He=((et=s==null?void 0:s.assessments)==null?void 0:et.cia1)||{},$t=((Et=s==null?void 0:s.assessments)==null?void 0:Et.cia2)||{},Ue=Number((wt=Oe==null?void 0:Oe.coMax)==null?void 0:wt.co1),er=Number((gt=Oe==null?void 0:Oe.coMax)==null?void 0:gt.co2),Z=Number(((zt=qe==null?void 0:qe.coMax)==null?void 0:zt.co3)??((Dt=qe==null?void 0:qe.coMax)==null?void 0:Dt.co1)),pe=Number(((mr=qe==null?void 0:qe.coMax)==null?void 0:mr.co4)??((pt=qe==null?void 0:qe.coMax)==null?void 0:pt.co2)),ee=Number((Xt=He==null?void 0:He.coMax)==null?void 0:Xt.co1),ue=Number((Rt=He==null?void 0:He.coMax)==null?void 0:Rt.co2),Ae=Number(((_t=$t==null?void 0:$t.coMax)==null?void 0:_t.co3)??((jr=$t==null?void 0:$t.coMax)==null?void 0:jr.co1)),Le=Number(((Gr=$t==null?void 0:$t.coMax)==null?void 0:Gr.co4)??((Cr=$t==null?void 0:$t.coMax)==null?void 0:Cr.co2)),ct=Number(Lt==null?void 0:Lt.maxCo),ce=Number(dt==null?void 0:dt.maxCo);return{ssa1:{co1:Number.isFinite(Ue)?Math.max(0,Ue):10,co2:Number.isFinite(er)?Math.max(0,er):10},ssa2:{co3:Number.isFinite(Z)?Math.max(0,Z):10,co4:Number.isFinite(pe)?Math.max(0,pe):10},cia1:{co1:Number.isFinite(ee)?Math.max(0,ee):fr.co1,co2:Number.isFinite(ue)?Math.max(0,ue):fr.co2},cia2:{co3:Number.isFinite(Ae)?Math.max(0,Ae):Be.co3,co4:Number.isFinite(Le)?Math.max(0,Le):Be.co4},f1:{co1:Number.isFinite(ct)?Math.max(0,ct):10,co2:Number.isFinite(ct)?Math.max(0,ct):10},f2:{co3:Number.isFinite(ce)?Math.max(0,ce):10,co4:Number.isFinite(ce)?Math.max(0,ce):10}}},[s,fr,Be]),It=v.useMemo(()=>{if(!y)return null;const Oe=dh.co1,qe=dh.co2,Lt=dh.co3,dt=dh.co4,He=dh.co5;return{co1:Oe,co2:qe,co3:Lt,co4:dt,co5:He,total:xa(Oe+qe+Lt+dt+He)}},[y]),ft=async()=>{R(!0),me(null);const Oe=typeof T=="number"?T:void 0;try{if(I({}),G({lab1:null,lab2:null}),y){let qe=null,Lt=null,dt=null;try{qe=await wa("cia1",e,Oe)}catch(He){I($t=>({...$t,lab_cia1:String((He==null?void 0:He.message)||He)}))}try{Lt=await wa("cia2",e,Oe)}catch(He){I($t=>({...$t,lab_cia2:String((He==null?void 0:He.message)||He)}))}try{dt=await wa("model",e,Oe)}catch(He){I($t=>({...$t,lab_model:String((He==null?void 0:He.message)||He)}))}te({cia1:(qe==null?void 0:qe.data)??null,cia2:(Lt==null?void 0:Lt.data)??null,model:(dt==null?void 0:dt.data)??null});try{if(!(qe!=null&&qe.data))try{const He=await En("cia1",e,Oe);He&&He.draft&&te($t=>({...$t,cia1:He.draft.data??He.draft}))}catch(He){I($t=>({...$t,lab_cia1_draft:String((He==null?void 0:He.message)||He)}))}if(!(Lt!=null&&Lt.data))try{const He=await En("cia2",e,Oe);He&&He.draft&&te($t=>({...$t,cia2:He.draft.data??He.draft}))}catch(He){I($t=>({...$t,lab_cia2_draft:String((He==null?void 0:He.message)||He)}))}if(!(dt!=null&&dt.data))try{const He=await En("model",e,Oe);He&&He.draft&&te($t=>({...$t,model:He.draft.data??He.draft}))}catch(He){I($t=>({...$t,lab_model_draft:String((He==null?void 0:He.message)||He)}))}}catch{}}if(y)E({ssa1:{},ssa2:{},f1:{},f2:{},cia1:null,cia2:null});else{const qe=On(i)==="TCPL";let Lt=null,dt=null,He=null,$t=null,Ue=null,er=null,Z=null,pe=null;if(g.ssa1)try{Lt=await S0(e,Oe)}catch(ee){I(ue=>({...ue,ssa1:String((ee==null?void 0:ee.message)||ee)}))}if(g.ssa2)try{dt=await Op(e,Oe)}catch(ee){I(ue=>({...ue,ssa2:String((ee==null?void 0:ee.message)||ee)}))}if(g.formative1)if(qe)try{Ue=await wa("formative1",e,Oe)}catch(ee){I(ue=>({...ue,tcpl_lab1:String((ee==null?void 0:ee.message)||ee)}))}else try{He=await cg(e,Oe)}catch(ee){I(ue=>({...ue,formative1:String((ee==null?void 0:ee.message)||ee)}))}if(g.formative2)if(qe)try{er=await wa("formative2",e,Oe)}catch(ee){I(ue=>({...ue,tcpl_lab2:String((ee==null?void 0:ee.message)||ee)}))}else try{$t=await bu("formative2",e,Oe)}catch(ee){I(ue=>({...ue,formative2:String((ee==null?void 0:ee.message)||ee)}))}if(g.cia1)try{Z=await Ip(e,Oe)}catch(ee){I(ue=>({...ue,cia1:String((ee==null?void 0:ee.message)||ee)}))}if(g.cia2)try{pe=await vu("cia2",e,Oe)}catch(ee){I(ue=>({...ue,cia2:String((ee==null?void 0:ee.message)||ee)}))}try{if(g.ssa1&&(!Lt||!(Lt.marks&&Object.keys(Lt.marks||{}).length)))try{const ee=await En("ssa1",e,Oe);ee&&ee.draft&&ee.draft.marks&&(Lt={marks:ee.draft.marks})}catch(ee){I(ue=>({...ue,ssa1_draft:String((ee==null?void 0:ee.message)||ee)}))}if(g.ssa2&&(!dt||!(dt.marks&&Object.keys(dt.marks||{}).length)))try{const ee=await En("ssa2",e,Oe);ee&&ee.draft&&ee.draft.marks&&(dt={marks:ee.draft.marks})}catch(ee){I(ue=>({...ue,ssa2_draft:String((ee==null?void 0:ee.message)||ee)}))}if(g.formative1){if(qe){if(!(Ue!=null&&Ue.data))try{const ee=await En("formative1",e,Oe);ee&&ee.draft&&(Ue={data:ee.draft.data??ee.draft})}catch(ee){I(ue=>({...ue,tcpl_lab1_draft:String((ee==null?void 0:ee.message)||ee)}))}}else if(!He||!(He.marks&&Object.keys(He.marks||{}).length))try{const ee=await En("formative1",e,Oe);ee&&ee.draft&&ee.draft.marks&&(He={marks:ee.draft.marks})}catch(ee){I(ue=>({...ue,formative1_draft:String((ee==null?void 0:ee.message)||ee)}))}}if(g.formative2){if(qe){if(!(er!=null&&er.data))try{const ee=await En("formative2",e,Oe);ee&&ee.draft&&(er={data:ee.draft.data??ee.draft})}catch(ee){I(ue=>({...ue,tcpl_lab2_draft:String((ee==null?void 0:ee.message)||ee)}))}}else if(!$t||!($t.marks&&Object.keys($t.marks||{}).length))try{const ee=await En("formative2",e,Oe);ee&&ee.draft&&ee.draft.marks&&($t={marks:ee.draft.marks})}catch(ee){I(ue=>({...ue,formative2_draft:String((ee==null?void 0:ee.message)||ee)}))}}if(g.cia1&&(!Z||!Z.data))try{const ee=await En("cia1",e,Oe);ee&&ee.draft&&(Z={data:ee.draft.data??ee.draft})}catch(ee){I(ue=>({...ue,cia1_draft:String((ee==null?void 0:ee.message)||ee)}))}if(g.cia2&&(!pe||!pe.data))try{const ee=await En("cia2",e,Oe);ee&&ee.draft&&(pe={data:ee.draft.data??ee.draft})}catch(ee){I(ue=>({...ue,cia2_draft:String((ee==null?void 0:ee.message)||ee)}))}}catch{}qe&&G({lab1:(Ue==null?void 0:Ue.data)??null,lab2:(er==null?void 0:er.data)??null}),E({ssa1:Lt!=null&&Lt.marks&&typeof Lt.marks=="object"?Lt.marks:{},ssa2:dt!=null&&dt.marks&&typeof dt.marks=="object"?dt.marks:{},f1:!qe&&(He!=null&&He.marks)&&typeof He.marks=="object"?He.marks:{},f2:!qe&&($t!=null&&$t.marks)&&typeof $t.marks=="object"?$t.marks:{},cia1:(Z==null?void 0:Z.data)??null,cia2:(pe==null?void 0:pe.data)??null})}}catch(qe){E({ssa1:{},ssa2:{},f1:{},f2:{},cia1:null,cia2:null}),te({cia1:null,cia2:null,model:null}),G({lab1:null,lab2:null}),me((qe==null?void 0:qe.message)||"Failed to load published marks")}finally{R(!1)}};v.useEffect(()=>{e&&ft()},[e,T,y,g,i]),v.useEffect(()=>{const Oe=qe=>{try{const Lt=(qe==null?void 0:qe.detail)||{},dt=Lt.subjectId,He=Lt.assessment;if(!dt||String(dt)!==String(e)||He&&!["ssa1","formative1","cia1"].includes(String(He)))return;ft()}catch{}};return window.addEventListener("obe:published",Oe),()=>window.removeEventListener("obe:published",Oe)},[e]);const gr=v.useMemo(()=>{const Oe=new Map;if(y){const ce=lb/2,xe=(et,Et,wt)=>{const gt=et!=null&&et.sheet&&typeof et.sheet=="object"?et.sheet:{},zt=gt!=null&&gt.rowsByStudentId&&typeof gt.rowsByStudentId=="object"?gt.rowsByStudentId:{},Dt=Hn(Number((gt==null?void 0:gt.expCountA)??0),0,12),mr=Hn(Number((gt==null?void 0:gt.expCountB)??0),0,12),pt=!!(gt!=null&&gt.coAEnabled),Xt=!!(gt!=null&&gt.coBEnabled),Rt=!!(gt!=null&&gt.ciaExamEnabled),_t=gt!=null&&gt.coConfigs&&typeof gt.coConfigs=="object"?gt.coConfigs:null,jr=_t?_t[String(Et)]:null,Gr=wt!=null&&_t?_t[String(wt)]:null,Cr=jr?!!jr.enabled:pt,Rr=wt!=null?Gr?!!Gr.enabled:Xt:!1,De=jr?Hn(Number(jr.expCount??0),0,12):Dt,Ke=wt!=null?Gr?Hn(Number(Gr.expCount??0),0,12):mr:0,Ce=jr&&Number.isFinite(Number(jr.expMax))?Number(jr.expMax):Number.isFinite(Number(gt==null?void 0:gt.expMaxA))?Number(gt.expMaxA):25,it=wt!=null?Gr&&Number.isFinite(Number(Gr.expMax))?Number(Gr.expMax):Number.isFinite(Number(gt==null?void 0:gt.expMaxB))?Number(gt.expMaxB):25:0,tr=Ce+(Rt?ce:0),Kt=wt!=null?it+(Rt?ce:0):0;return{get:Ht=>{const qt=zt[String(Ht)]||{},lr=qt!=null&&qt.marksByCo&&typeof qt.marksByCo=="object"?qt.marksByCo:{},Mt=(lr==null?void 0:lr[String(Et)])??qt.marksA,tt=wt!=null?(lr==null?void 0:lr[String(wt)])??qt.marksB:[],Ft=uh(Mt,De).slice(0,Cr?De:0),Qt=uh(tt,Ke).slice(0,Rr?Ke:0),At=ix(Ft),bt=ix(Qt),V=qt==null?void 0:qt.ciaExam,ie=typeof V=="number"&&Number.isFinite(V)?V:null,_e=At!=null||bt!=null||ie!=null,Je=_e?(At??0)+(Rt?(ie??0)/2:0):null,Nt=_e?(bt??0)+(Rt?(ie??0)/2:0):null;return{a:Je==null?null:Hn(Je,0,tr),b:Nt==null?null:Hn(Nt,0,Kt)}},coA:Et,coB:wt,CO_MAX_A:tr,CO_MAX_B:Kt,expMaxA:Ce,expMaxB:it,expCountA:De,expCountB:Ke}},se=xe(M.cia1,1,2),Se=xe(M.cia2,3,4),Ze=xe(M.model,5,null);for(const et of re){const Et=se.get(et.id),wt=Se.get(et.id),gt=Ze.get(et.id);Oe.set(et.id,{co1:Et.a,co2:Et.b,co3:wt.a,co4:wt.b,co5:gt.a,coMax1:se.CO_MAX_A,coMax2:se.CO_MAX_B,coMax3:Se.CO_MAX_A,coMax4:Se.CO_MAX_B,coMax5:Ze.CO_MAX_A})}return Oe}const qe=On(i)==="TCPL",Lt=ce=>{const xe=ce!=null&&ce.sheet&&typeof ce.sheet=="object"?ce.sheet:{},se=xe!=null&&xe.rowsByStudentId&&typeof xe.rowsByStudentId=="object"?xe.rowsByStudentId:{},Se=Hn(Number((xe==null?void 0:xe.expCountA)??0),0,12),Ze=Hn(Number((xe==null?void 0:xe.expCountB)??0),0,12),et=Number.isFinite(Number(xe==null?void 0:xe.expMaxA))?Number(xe.expMaxA):25,Et=Number.isFinite(Number(xe==null?void 0:xe.expMaxB))?Number(xe.expMaxB):25,wt=(xe==null?void 0:xe.ciaExamEnabled)!==!1,gt=lb/2,zt=et+(wt?gt:0),Dt=Et+(wt?gt:0);return{get:pt=>{const Xt=se[String(pt)]||{},Rt=uh(Xt==null?void 0:Xt.marksA,Se),_t=uh(Xt==null?void 0:Xt.marksB,Ze),jr=ix(Rt),Gr=ix(_t),Cr=Xt==null?void 0:Xt.ciaExam,Rr=typeof Cr=="number"&&Number.isFinite(Cr)?Cr:null,De=jr!=null||Gr!=null||Rr!=null,Ke=De?(jr??0)+(wt?(Rr??0)/2:0):null,Ce=De?(Gr??0)+(wt?(Rr??0)/2:0):null;return{a:Ke==null?null:Hn(Ke,0,zt),b:Ce==null?null:Hn(Ce,0,Dt)}},CO_MAX_A:zt,CO_MAX_B:Dt}},dt=qe?Lt(Q.lab1):null,He=qe?Lt(Q.lab2):null,$t=(()=>{if(!w)return null;const ce=String(T??"none"),xe=On(i),se=[];xe==="THEORY"?(se.push(`model_theory_sheet_${e}_${ce}`),se.push(`model_theory_sheet_${e}_none`)):xe==="TCPL"?(se.push(`model_tcpl_sheet_${e}_${ce}`),se.push(`model_tcpl_sheet_${e}_none`)):xe==="TCPR"&&(se.push(`model_tcpr_sheet_${e}_${ce}`),se.push(`model_tcpr_sheet_${e}_none`)),se.push(`model_sheet_${e}`);for(const Se of se){const Ze=Bn(Se);if(Ze&&typeof Ze=="object")return Ze}return null})(),Ue=ce=>{const xe=On(i),se=$t&&typeof $t=="object"?$t:null,et=xe==="THEORY"?cb:0;if(!w)return{mark:null,max:et};if(!se)return{mark:null,max:et};let Et=et;const wt=`id:${String(ce.id)}`,gt=ce.reg_no?`reg:${String(ce.reg_no).trim()}`:"",zt=se[wt]||(gt?se[gt]:null)||null;if(!zt||typeof zt!="object")return{mark:null,max:Et};const Dt=!!zt.absent,mr=String(zt.absentKind||"AL").toUpperCase(),pt=zt.q&&typeof zt.q=="object"?zt.q:{};let Xt=!1,Rt=0;if(Et=0,xe==="THEORY"){Et=cb;for(let _t=0;_t<G2.length;_t++){const jr=G2[_t],Gr=pt[jr.key],Cr=ho(Gr);if(Cr==null)continue;Xt=!0;const Rr=Hn(Cr,0,jr.max);y8[_t]===5&&(Rt+=Rr)}}else if(xe==="TCPL"||xe==="TCPR"){const _t=xe==="TCPR",jr=_t?12:15,Gr=_t?8:10,Cr=_t?[1,1,2,2,3,3,4,4,1,2,3,4]:[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5];for(let Ke=0;Ke<jr;Ke++){const Ce=Ke+1,it=`q${Ce}`,tr=Ce<=Gr?2:16,Kt=Cr[Ke]??1;Kt===5&&(Et+=tr);const yt=pt[it],Ht=ho(yt);if(Ht==null)continue;Xt=!0;const qt=Hn(Ht,0,tr);Kt===5&&(Rt+=qt)}const Rr=ho(zt.lab);Rr!=null&&(Xt=!0);const De=Rr==null?null:Hn(Rr,0,30);_t?(Et+=30,De!=null&&(Rt+=De)):(Et+=30/5,De!=null&&(Rt+=De/5))}return Xt?Dt&&mr==="AL"?{mark:0,max:Et}:{mark:Hn(Rt,0,Et),max:Et}:Dt&&mr==="AL"?{mark:0,max:Et}:{mark:null,max:Et}},er=fe.f1&&typeof fe.f1=="object"?fe.f1:{},Z=fe.f2&&typeof fe.f2=="object"?fe.f2:{},pe=fe.cia1&&typeof fe.cia1=="object"?fe.cia1:null,ee=Array.isArray(pe==null?void 0:pe.questions)?pe.questions.map(ce=>({key:String((ce==null?void 0:ce.key)||""),label:String((ce==null?void 0:ce.label)||(ce==null?void 0:ce.key)||""),max:Number((ce==null?void 0:ce.max)||0),co:h4(ce==null?void 0:ce.co),btl:Math.min(6,Math.max(1,Number((ce==null?void 0:ce.btl)||1)))})).filter(ce=>ce.key):Ct,ue=pe!=null&&pe.rowsByStudentId&&typeof pe.rowsByStudentId=="object"?pe.rowsByStudentId:{},Ae=fe.cia2&&typeof fe.cia2=="object"?fe.cia2:null,Le=Array.isArray(Ae==null?void 0:Ae.questions)?Ae.questions.map(ce=>({key:String((ce==null?void 0:ce.key)||""),label:String((ce==null?void 0:ce.label)||(ce==null?void 0:ce.key)||""),max:Number((ce==null?void 0:ce.max)||0),co:p4(ce==null?void 0:ce.co),btl:Math.min(6,Math.max(1,Number((ce==null?void 0:ce.btl)||1)))})).filter(ce=>ce.key):pr,ct=Ae!=null&&Ae.rowsByStudentId&&typeof Ae.rowsByStudentId=="object"?Ae.rowsByStudentId:{};for(const ce of re){const xe=(fe.ssa1&&typeof fe.ssa1=="object"?fe.ssa1[String(ce.id)]:null)??null,se=xe==null?null:Number(xe)/2,Se=se==null?null:Hn(se,0,mt.ssa1.co1),Ze=se==null?null:Hn(se,0,mt.ssa1.co2),et=(fe.ssa2&&typeof fe.ssa2=="object"?fe.ssa2[String(ce.id)]:null)??null,Et=et==null?null:Number(et)/2,wt=Et==null?null:Hn(Et,0,mt.ssa2.co3),gt=Et==null?null:Hn(Et,0,mt.ssa2.co4),zt=qe&&dt?dt.get(ce.id):null,Dt=qe&&He?He.get(ce.id):null,mr=er[String(ce.id)]||{},pt=ho(mr==null?void 0:mr.skill1),Xt=ho(mr==null?void 0:mr.skill2),Rt=ho(mr==null?void 0:mr.att1),_t=ho(mr==null?void 0:mr.att2),jr=qe?(zt==null?void 0:zt.a)??null:pt!=null&&Rt!=null?Hn(pt+Rt,0,mt.f1.co1):null,Gr=qe?(zt==null?void 0:zt.b)??null:Xt!=null&&_t!=null?Hn(Xt+_t,0,mt.f1.co2):null,Cr=Z[String(ce.id)]||{},Rr=ho(Cr==null?void 0:Cr.skill1),De=ho(Cr==null?void 0:Cr.skill2),Ke=ho(Cr==null?void 0:Cr.att1),Ce=ho(Cr==null?void 0:Cr.att2),it=qe?(Dt==null?void 0:Dt.a)??null:Rr!=null&&Ke!=null?Hn(Rr+Ke,0,mt.f2.co3):null,tr=qe?(Dt==null?void 0:Dt.b)??null:De!=null&&Ce!=null?Hn(De+Ce,0,mt.f2.co4):null,Kt=ue[String(ce.id)]||{},yt=!!(Kt!=null&&Kt.absent),Ht=Kt!=null&&Kt.q&&typeof Kt.q=="object"?Kt.q:{};let qt=null,lr=null;if(!yt){let V=0,ie=0,_e=!1;ee.forEach((Je,Nt)=>{const Bt=Ht==null?void 0:Ht[Je.key],jt=ho(Bt);if(jt==null)return;_e=!0;const cr=Hn(jt,0,Number(Je.max)||jt),sr=m4(ee,Nt);V+=cr*sr.co1,ie+=cr*sr.co2}),_e&&(qt=Hn(V,0,mt.cia1.co1),lr=Hn(ie,0,mt.cia1.co2))}const Mt=ct[String(ce.id)]||{},tt=!!(Mt!=null&&Mt.absent),Ft=Mt!=null&&Mt.q&&typeof Mt.q=="object"?Mt.q:{};let Qt=null,At=null;if(!tt){let V=0,ie=0,_e=!1;Le.forEach((Je,Nt)=>{const Bt=Ft==null?void 0:Ft[Je.key],jt=ho(Bt);if(jt==null)return;_e=!0;const cr=Hn(jt,0,Number(Je.max)||jt),sr=x4(Le,Nt);V+=cr*sr.co3,ie+=cr*sr.co4}),_e&&(Qt=Hn(V,0,mt.cia2.co3),At=Hn(ie,0,mt.cia2.co4))}const bt=w?Ue(ce):{mark:null,max:0};Oe.set(ce.id,{ssaCo1:Se,ssaCo2:Ze,ssaCo3:wt,ssaCo4:gt,ciaCo1:qt,ciaCo2:lr,ciaCo3:Qt,ciaCo4:At,f1Co1:jr,f1Co2:Gr,f2Co3:it,f2Co4:tr,modelCo5:bt.mark,modelCo5Max:bt.max})}return Oe},[fe,M,Q,re,mt,Ct,y,i,e,T,w]),Mr=v.useMemo(()=>{if(!m)return null;const Oe=qe=>{const Lt=qe!=null&&qe.sheet&&typeof qe.sheet=="object"?qe.sheet:{},dt=Number.isFinite(Number(Lt==null?void 0:Lt.expMaxA))?Number(Lt.expMaxA):25,He=Number.isFinite(Number(Lt==null?void 0:Lt.expMaxB))?Number(Lt.expMaxB):25,$t=(Lt==null?void 0:Lt.ciaExamEnabled)!==!1,Ue=lb/2;return{a:dt+($t?Ue:0),b:He+($t?Ue:0)}};return{lab1:Oe(Q.lab1),lab2:Oe(Q.lab2)}},[m,Q]),$r=v.useMemo(()=>{var ee,ue,Ae,Le;const Oe=m?((ee=Mr==null?void 0:Mr.lab1)==null?void 0:ee.a)??mt.f1.co1:mt.f1.co1,qe=m?((ue=Mr==null?void 0:Mr.lab1)==null?void 0:ue.b)??mt.f1.co2:mt.f1.co2,Lt=m?((Ae=Mr==null?void 0:Mr.lab2)==null?void 0:Ae.a)??mt.f2.co3:mt.f2.co3,dt=m?((Le=Mr==null?void 0:Mr.lab2)==null?void 0:Le.b)??mt.f2.co4:mt.f2.co4,He=(g.ssa1?mt.ssa1.co1:0)+(g.cia1?mt.cia1.co1:0)+(g.formative1?Oe:0),$t=(g.ssa1?mt.ssa1.co2:0)+(g.cia1?mt.cia1.co2:0)+(g.formative1?qe:0),Ue=(g.ssa2?mt.ssa2.co3:0)+(g.cia2?mt.cia2.co3:0)+(g.formative2?Lt:0),er=(g.ssa2?mt.ssa2.co4:0)+(g.cia2?mt.cia2.co4:0)+(g.formative2?dt:0),Z=w?oe:0,pe=He+$t+Ue+er+Z;return{f1MaxCo1:Oe,f1MaxCo2:qe,f2MaxCo3:Lt,f2MaxCo4:dt,co1:He,co2:$t,co3:Ue,co4:er,co5:Z,total:pe}},[m,Mr,mt,g,w,oe]),_r=v.useMemo(()=>{if(y){const ce=It||{co1:55,co2:55,co3:55,co4:55,co5:55},xe=(et,Et)=>et==null||!Et?null:xa(et/Et*100),se=(et,Et)=>et==null||!Et?null:Jc(et/Et*3),Se=[M.cia1,M.cia2,M.model].filter(Boolean),Ze=et=>{const Et=[0,0,0,0,0,0,0],wt=[0,0,0,0,0,0,0];for(const zt of Se){const Dt=zt!=null&&zt.sheet&&typeof zt.sheet=="object"?zt.sheet:{},pt=(Dt!=null&&Dt.rowsByStudentId&&typeof Dt.rowsByStudentId=="object"?Dt.rowsByStudentId:{})[String(et)]||{},Xt=Dt!=null&&Dt.coConfigs&&typeof Dt.coConfigs=="object"?Dt.coConfigs:null,Rt=pt!=null&&pt.marksByCo&&typeof pt.marksByCo=="object"?pt.marksByCo:{},_t=!!(Dt!=null&&Dt.coAEnabled),jr=!!(Dt!=null&&Dt.coBEnabled),Gr=Hn(Number((Dt==null?void 0:Dt.expCountA)??0),0,12),Cr=Hn(Number((Dt==null?void 0:Dt.expCountB)??0),0,12),Rr=Number.isFinite(Number(Dt==null?void 0:Dt.expMaxA))?Number(Dt.expMaxA):25,De=Number.isFinite(Number(Dt==null?void 0:Dt.expMaxB))?Number(Dt.expMaxB):25,Ke=Array.isArray(Dt==null?void 0:Dt.btlA)?Dt.btlA:[],Ce=Array.isArray(Dt==null?void 0:Dt.btlB)?Dt.btlB:[],it=(tr,Kt,yt,Ht,qt,lr)=>{if(!Kt||yt<=0||!Ht)return;const Mt=uh(lr,yt);for(let tt=0;tt<yt;tt++){const Ft=db(qt[tt]),Qt=typeof Mt[tt]=="number"&&Number.isFinite(Mt[tt])?Mt[tt]:null;if(!Ft||Qt==null)continue;const At=Hn(Qt,0,Ht)*(10/Ht);Et[Ft]+=At,wt[Ft]+=1}};if(Xt)for(const[tr,Kt]of Object.entries(Xt)){const yt=Number(tr);if(!Number.isFinite(yt)||!Kt||typeof Kt!="object")continue;const Ht=!!Kt.enabled,qt=Hn(Number(Kt.expCount??0),0,12),lr=Number.isFinite(Number(Kt.expMax))?Number(Kt.expMax):25,Mt=Array.isArray(Kt.btl)?Kt.btl:[],tt=(Rt==null?void 0:Rt[String(yt)])??[];it(yt,Ht,qt,lr,Mt,tt)}else it(0,_t,Gr,Rr,Ke,pt.marksA),it(0,jr,Cr,De,Ce,pt.marksB)}const gt={};for(let zt=1;zt<=6;zt++)gt[`btl${zt}`]=wt[zt]?xa(Et[zt]/wt[zt]):null,gt[`btl${zt}Pct`]=wt[zt]?xa(Et[zt]/wt[zt]/10*100):null;return gt};return re.map((et,Et)=>{const wt=gr.get(et.id)||{},gt=typeof wt.co1=="number"?wt.co1:null,zt=typeof wt.co2=="number"?wt.co2:null,Dt=typeof wt.co3=="number"?wt.co3:null,mr=typeof wt.co4=="number"?wt.co4:null,pt=typeof wt.co5=="number"?wt.co5:null,Xt=Ze(et.id),Rt=[gt,zt,Dt,mr,pt].every(_t=>typeof _t=="number")?xa(gt+zt+Dt+mr+pt):null;return{sno:Et+1,...et,co1:gt,co1Pct:xe(gt,ce.co1),co1_3pt:se(gt,ce.co1),co2:zt,co2Pct:xe(zt,ce.co2),co2_3pt:se(zt,ce.co2),co3:Dt,co3Pct:xe(Dt,ce.co3),co3_3pt:se(Dt,ce.co3),co4:mr,co4Pct:xe(mr,ce.co4),co4_3pt:se(mr,ce.co4),co5:pt,co5Pct:xe(pt,ce.co5),co5_3pt:se(pt,ce.co5),...Xt,total:Rt}})}const Oe=g.ssa1?X.ssa1:0,qe=g.cia1?X.cia1:0,Lt=g.formative1?X.formative1:0,dt=g.ssa2?X.ssa1:0,He=g.cia2?X.cia1:0,$t=g.formative2?X.formative1:0,{f1MaxCo1:Ue,f1MaxCo2:er,f2MaxCo3:Z,f2MaxCo4:pe}=$r,ee=$r.co1,ue=$r.co2,Ae=$r.co3,Le=$r.co4,ct=$r.co5;return re.map((ce,xe)=>{const se=gr.get(ce.id),Se=ox({ssaMark:(se==null?void 0:se.ssaCo1)??null,ciaMark:(se==null?void 0:se.ciaCo1)??null,f1Mark:(se==null?void 0:se.f1Co1)??null,ssaMax:mt.ssa1.co1,ciaMax:mt.cia1.co1,f1Max:Ue,ssaW:Oe,ciaW:qe,f1W:Lt,outOf:ee}),Ze=ox({ssaMark:(se==null?void 0:se.ssaCo2)??null,ciaMark:(se==null?void 0:se.ciaCo2)??null,f1Mark:(se==null?void 0:se.f1Co2)??null,ssaMax:mt.ssa1.co2,ciaMax:mt.cia1.co2,f1Max:er,ssaW:Oe,ciaW:qe,f1W:Lt,outOf:ue}),et=ox({ssaMark:(se==null?void 0:se.ssaCo3)??null,ciaMark:(se==null?void 0:se.ciaCo3)??null,f1Mark:(se==null?void 0:se.f2Co3)??null,ssaMax:mt.ssa2.co3,ciaMax:mt.cia2.co3,f1Max:Z,ssaW:dt,ciaW:He,f1W:$t,outOf:Ae}),Et=ox({ssaMark:(se==null?void 0:se.ssaCo4)??null,ciaMark:(se==null?void 0:se.ciaCo4)??null,f1Mark:(se==null?void 0:se.f2Co4)??null,ssaMax:mt.ssa2.co4,ciaMax:mt.cia2.co4,f1Max:pe,ssaW:dt,ciaW:He,f1W:$t,outOf:Le}),wt=Se==null||!ee?null:xa(Se/ee*100),gt=Ze==null||!ue?null:xa(Ze/ue*100),zt=et==null||!Ae?null:xa(et/Ae*100),Dt=Et==null||!Le?null:xa(Et/Le*100),mr=typeof(se==null?void 0:se.modelCo5)=="number"&&Number.isFinite(se.modelCo5)?se.modelCo5:null,pt=typeof(se==null?void 0:se.modelCo5Max)=="number"&&Number.isFinite(se.modelCo5Max)?Math.max(0,se.modelCo5Max):cb,Xt=!w||mr==null||!pt||!ct?null:Hn(mr/pt*ct,0,ct),Rt=Xt==null||!ct?null:xa(Xt/ct*100),_t=Se==null||!ee?null:Jc(Se/ee*3),jr=Ze==null||!ue?null:Jc(Ze/ue*3),Gr=et==null||!Ae?null:Jc(et/Ae*3),Cr=Et==null||!Le?null:Jc(Et/Le*3),Rr=Xt==null||!ct?null:Jc(Xt/ct*3),De=[{enabled:ee>0,v:Se},{enabled:ue>0,v:Ze},{enabled:Ae>0,v:et},{enabled:Le>0,v:Et},...w?[{enabled:ct>0,v:Xt}]:[]];let Ke=!1,Ce=!1,it=0;for(const Kt of De)if(Kt.enabled){if(Ke=!0,typeof Kt.v!="number"||!Number.isFinite(Kt.v)){Ce=!0;break}it+=Kt.v}const tr=!Ke||Ce?null:xa(it);return{sno:xe+1,...ce,co1:Se,co1Pct:wt,co1_3pt:_t,co2:Ze,co2Pct:gt,co2_3pt:jr,co3:et,co3Pct:zt,co3_3pt:Gr,co4:Et,co4Pct:Dt,co4_3pt:Cr,co5:Xt,co5Pct:Rt,co5_3pt:Rr,total:tr}})},[re,gr,mt,X,g,w,oe,$r,y,It,M]),Vr=v.useMemo(()=>{if(y){const Ue=er=>{const Z=_r.map(pe=>pe==null?void 0:pe[er]).filter(pe=>typeof pe=="number");return Z.length?Jc(Z.reduce((pe,ee)=>pe+ee,0)/Z.length):null};return{strength:re.length,co1Avg3pt:Ue("co1_3pt"),co2Avg3pt:Ue("co2_3pt"),co3Avg3pt:Ue("co3_3pt"),co4Avg3pt:Ue("co4_3pt"),co5Avg3pt:Ue("co5_3pt")}}const Oe=_r.map(Ue=>Ue.co1_3pt).filter(Ue=>typeof Ue=="number"),qe=_r.map(Ue=>Ue.co2_3pt).filter(Ue=>typeof Ue=="number"),Lt=_r.map(Ue=>Ue.co3_3pt).filter(Ue=>typeof Ue=="number"),dt=_r.map(Ue=>Ue.co4_3pt).filter(Ue=>typeof Ue=="number"),He=_r.map(Ue=>Ue.co5_3pt).filter(Ue=>typeof Ue=="number"),$t=Ue=>Ue.length?Jc(Ue.reduce((er,Z)=>er+Z,0)/Ue.length):null;return{strength:re.length,co1Avg3pt:$t(Oe),co2Avg3pt:$t(qe),co3Avg3pt:$t(Lt),co4Avg3pt:$t(dt),...w?{co5Avg3pt:$t(He)}:{}}},[_r,re.length,y,w]),en=v.useMemo(()=>{const Oe=Number(It==null?void 0:It.co1);return Number.isFinite(Oe)&&Oe>0?Oe:55},[It]),Xr=v.useMemo(()=>{if(!y)return{1:0,2:0,3:0,4:0,5:0,6:0};const Oe={1:!1,2:!1,3:!1,4:!1,5:!1,6:!1},qe=[M.cia1,M.cia2,M.model].filter(Boolean);for(const Lt of qe){const dt=Lt!=null&&Lt.sheet&&typeof Lt.sheet=="object"?Lt.sheet:{},He=Hn(Number((dt==null?void 0:dt.expCountA)??0),0,12),$t=Hn(Number((dt==null?void 0:dt.expCountB)??0),0,12),Ue=!!(dt!=null&&dt.coAEnabled),er=!!(dt!=null&&dt.coBEnabled),Z=Array.isArray(dt==null?void 0:dt.btlA)?dt.btlA:[],pe=Array.isArray(dt==null?void 0:dt.btlB)?dt.btlB:[];if(Ue)for(let ee=0;ee<He;ee++){const ue=db(Z[ee]);ue&&(Oe[ue]=!0)}if(er)for(let ee=0;ee<$t;ee++){const ue=db(pe[ee]);ue&&(Oe[ue]=!0)}}return{1:Oe[1]?10:0,2:Oe[2]?10:0,3:Oe[3]?10:0,4:Oe[4]?10:0,5:Oe[5]?10:0,6:Oe[6]?10:0}},[y,M]),gn={padding:"8px 10px",borderRadius:10,border:"1px solid #e5e7eb",width:90};return n.jsxs("div",{style:{display:"grid",gap:14},children:[(Fe||q)&&n.jsx("div",{style:{fontSize:12,color:q?"#b91c1c":"#6b7280"},children:Fe?"Loading published marks":q}),U&&Object.keys(U).length>0&&n.jsx("div",{style:{marginTop:6,fontSize:12},children:Object.entries(U).map(([Oe,qe])=>qe?n.jsxs("div",{style:{color:"#b91c1c"},children:[Oe,": ",String(qe)]},Oe):null)}),n.jsxs("div",{style:{padding:16,borderRadius:12,background:"linear-gradient(180deg,#ffffff, #f6fbff)",border:"1px solid #e6eef8",boxShadow:"0 6px 20px rgba(13, 60, 100, 0.06)"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:18,fontWeight:800,color:"#0b4a6f"},children:y?"CO Attainment (LAB)":"CO Attainment (Summative + Formative)"}),n.jsx("div",{style:{marginTop:6,color:"#264653",fontSize:13},children:y?"Uses published LAB sheets: CIA1 LAB (CO1/CO2) + CIA2 LAB (CO3/CO4) + MODEL LAB (CO5).":"Uses weighted blending per CO: SSA1 + CIA1 + Formative1 (based on your Excel formula)."})]}),n.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"flex-end"},children:n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:6},children:"Teaching Assignment / Section"}),n.jsxs("select",{value:T??"",onChange:Oe=>W(Oe.target.value?Number(Oe.target.value):null),style:{padding:"10px 12px",borderRadius:10,border:"1px solid #e5e7eb",minWidth:320},children:[n.jsx("option",{value:"",children:"Select"}),F.map(Oe=>{const qe=Oe.department,Lt=(qe==null?void 0:qe.short_name)||(qe==null?void 0:qe.code)||(qe==null?void 0:qe.name)||Oe.department_name||"",dt=Oe.semester;return n.jsxs("option",{value:Oe.id,children:[Oe.section_name," ",dt?` Sem ${dt}`:""," ",Oe.academic_year?` ${Oe.academic_year}`:""," ",Lt?` ${Lt}`:""]},Oe.id)})]})]})})]}),C&&n.jsx("div",{style:{marginTop:10,background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10},children:C}),y?n.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12,marginTop:12},children:n.jsxs("div",{style:{background:"#fff",borderRadius:10,border:"1px solid #e9f0f7",padding:12},children:[n.jsx("div",{style:{fontWeight:800,color:"#0b3b57",marginBottom:8},children:"LAB CO max"}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:["CO max values are pulled from published LAB sheets only.",It?n.jsx(n.Fragment,{children:k.map((Oe,qe)=>{const Lt=`co${Oe}`;return n.jsxs(Jr.Fragment,{children:[qe>0&&" | ","CO",Oe,": ",n.jsx("b",{children:It[Lt]})]},Oe)})}):n.jsxs(n.Fragment,{children:[" Each CO max is ",n.jsx("b",{children:en}),"."]})]}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:["Batch strength: ",n.jsx("b",{children:Vr.strength}),k.map(Oe=>{const qe=`co${Oe}Avg3pt`;return n.jsxs(Jr.Fragment,{children:["| CO",Oe," avg (3pt): ",n.jsx("b",{children:Vr[qe]??"-"})]},Oe)})]})]})}):n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 1fr",gap:12,marginTop:12},children:[n.jsxs("div",{style:{background:"#fff",borderRadius:10,border:"1px solid #e9f0f7",padding:12},children:[n.jsx("div",{style:{fontWeight:800,color:"#0b3b57",marginBottom:8},children:"Max marks per CO (P4:P6)"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 120px 120px 120px",gap:8,alignItems:"center"},children:[n.jsx("div",{}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",fontWeight:700},children:"SSA1"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",fontWeight:700},children:"CIA1"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",fontWeight:700},children:"Formative1"}),n.jsx("div",{style:{fontSize:12,fontWeight:700},children:"CO1"}),n.jsx("div",{children:mt.ssa1.co1}),n.jsx("div",{children:mt.cia1.co1}),n.jsx("div",{children:mt.f1.co1}),n.jsx("div",{style:{fontSize:12,fontWeight:700},children:"CO2"}),n.jsx("div",{children:mt.ssa1.co2}),n.jsx("div",{children:mt.cia1.co2}),n.jsx("div",{children:mt.f1.co2})]}),n.jsx("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:k.filter(Oe=>Oe<=4||w).map((Oe,qe)=>{const Lt=`co${Oe}`,dt=Oe===5?oe:$r[Lt];return n.jsxs(Jr.Fragment,{children:[qe>0&&n.jsx(n.Fragment,{children:"|"}),"CO",Oe," total max: ",n.jsx("b",{children:dt})]},Oe)})})]}),n.jsxs("div",{style:{background:"#fff",borderRadius:10,border:"1px solid #e9f0f7",padding:12},children:[n.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[n.jsx("div",{style:{fontWeight:800,color:"#0b3b57",marginBottom:8},children:"Weights (R4:R6)"}),n.jsxs("div",{style:{fontSize:12,color:"#475569"},children:["Source: ",n.jsx("b",{children:le==="server"?"IQAC (server)":le==="local"?"IQAC (local)":"Defaults"})]})]}),Ee&&n.jsx("div",{style:{marginTop:6,fontSize:12,color:"#6b7280"},children:Ee}),Ve&&n.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#b91c1c"},children:["Weights load error: ",Ve]}),rt!=null&&n.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#475569"},children:["Known class-types on server/local: ",rt]}),n.jsx("div",{style:{marginTop:6},children:n.jsxs("button",{onClick:()=>ot(Oe=>!Oe),style:{background:"transparent",border:"none",color:"#0b66a3",cursor:"pointer",padding:0,fontSize:12},children:[Ie?"Hide":"Show"," raw IQAC mapping"]})}),Ie&&n.jsx("pre",{style:{marginTop:8,maxHeight:220,overflow:"auto",background:"#0f1724",color:"#e6eef8",padding:10,borderRadius:8},children:JSON.stringify(je.current||{},null,2).slice(0,3200)}),n.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[n.jsxs("label",{style:{display:"grid",gap:6,fontSize:12},children:["SSA1",n.jsx("input",{type:"number",step:"0.1",value:X.ssa1,onChange:Oe=>H(qe=>({...qe,ssa1:Number(Oe.target.value)})),disabled:!z,style:gn})]}),n.jsxs("label",{style:{display:"grid",gap:6,fontSize:12},children:["CIA1",n.jsx("input",{type:"number",step:"0.1",value:X.cia1,onChange:Oe=>H(qe=>({...qe,cia1:Number(Oe.target.value)})),disabled:!z,style:gn})]}),n.jsxs("label",{style:{display:"grid",gap:6,fontSize:12},children:["Formative1",n.jsx("input",{type:"number",step:"0.1",value:X.formative1,onChange:Oe=>H(qe=>({...qe,formative1:Number(Oe.target.value)})),disabled:!z,style:gn})]})]}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:["Batch strength: ",n.jsx("b",{children:Vr.strength})," | CO1 avg (3pt): ",n.jsx("b",{children:Vr.co1Avg3pt??"-"})," | CO2 avg (3pt): ",n.jsx("b",{children:Vr.co2Avg3pt??"-"})]}),n.jsx("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:"Note: CIA1 CO marks are computed from the locally saved CIA1 question-wise sheet."})]})]}),n.jsx("div",{style:{marginTop:12},children:n.jsxs("div",{style:{background:"#fff",borderRadius:10,border:"1px solid #e9f0f7",padding:12},children:[n.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[n.jsx("div",{style:{fontWeight:800,color:"#0b3b57",marginBottom:8},children:"Assessment Weights"}),n.jsxs("div",{style:{fontSize:12,color:"#475569"},children:["Class Type: ",n.jsx("b",{children:i||"Unknown"})," | Source: ",n.jsx("b",{children:le==="server"?"IQAC (server)":le==="local"?"IQAC (local)":"Defaults"})]})]}),Ee&&n.jsx("div",{style:{marginTop:6,fontSize:12,color:"#6b7280"},children:Ee}),Ve&&n.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#b91c1c"},children:["Weights load error: ",Ve]}),n.jsx("div",{style:{marginTop:6},children:n.jsxs("button",{onClick:()=>ot(Oe=>!Oe),style:{background:"transparent",border:"none",color:"#0b66a3",cursor:"pointer",padding:0,fontSize:12},children:[Ie?"Hide":"Show"," raw IQAC mapping"]})}),Ie&&n.jsx("pre",{style:{marginTop:8,maxHeight:220,overflow:"auto",background:"#0f1724",color:"#e6eef8",padding:10,borderRadius:8},children:JSON.stringify(je.current||{},null,2).slice(0,3200)}),n.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",marginTop:12},children:[n.jsxs("label",{style:{display:"grid",gap:6,fontSize:12},children:["SSA1 Weight",n.jsx("input",{type:"number",step:"0.1",value:X.ssa1,onChange:Oe=>H(qe=>({...qe,ssa1:Number(Oe.target.value)})),disabled:!z,style:gn})]}),n.jsxs("label",{style:{display:"grid",gap:6,fontSize:12},children:["CIA1 Weight",n.jsx("input",{type:"number",step:"0.1",value:X.cia1,onChange:Oe=>H(qe=>({...qe,cia1:Number(Oe.target.value)})),disabled:!z,style:gn})]}),n.jsxs("label",{style:{display:"grid",gap:6,fontSize:12},children:["Formative1 Weight",n.jsx("input",{type:"number",step:"0.1",value:X.formative1,onChange:Oe=>H(qe=>({...qe,formative1:Number(Oe.target.value)})),disabled:!z,style:gn})]}),w&&n.jsxs("label",{style:{display:"grid",gap:6,fontSize:12},children:["CO5 Weightage (MODEL)",n.jsx("input",{type:"number",step:"1",value:oe,onChange:Oe=>D(Number(Oe.target.value)),disabled:!z,style:gn})]})]}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:["These weights determine how SSA1, CIA1, and Formative1 assessments contribute to CO attainment calculations.",!z&&n.jsxs("span",{style:{color:"#059669",fontWeight:600},children:[" Values shown are appropriate defaults for ",i||"this"," class type."]})]})]})})]}),P&&n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #ef444433",color:"#991b1b",padding:10,borderRadius:10},children:P}),n.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10},children:n.jsx("button",{onClick:()=>we(!be),style:{padding:"8px 16px",backgroundColor:be?"#059669":"#0ea5e9",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:13},children:be?"Show CO Columns":"Hide CO Columns"})}),A?n.jsx("div",{style:{color:"#6b7280"},children:"Loading roster"}):n.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,overflow:"auto",background:"#fff"},children:y?n.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:2100},children:[n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx("th",{rowSpan:2,style:rs,children:"S.No"}),n.jsx("th",{rowSpan:2,style:rs,children:"Section"}),n.jsx("th",{rowSpan:2,style:rs,children:"Register No"}),n.jsx("th",{rowSpan:2,style:rs,children:"Name"}),!be&&n.jsx(n.Fragment,{children:k.map(Oe=>n.jsxs("th",{colSpan:3,style:Zc,children:["CO",Oe]},`co${Oe}`))}),n.jsx("th",{rowSpan:2,style:rs,children:"CQI Entry"}),n.jsx("th",{colSpan:2,style:Zc,children:"BTL-1"}),n.jsx("th",{colSpan:2,style:Zc,children:"BTL-2"}),n.jsx("th",{colSpan:2,style:Zc,children:"BTL-3"}),n.jsx("th",{colSpan:2,style:Zc,children:"BTL-4"}),n.jsx("th",{colSpan:2,style:Zc,children:"BTL-5"}),n.jsx("th",{colSpan:2,style:Zc,children:"BTL-6"}),n.jsxs("th",{rowSpan:2,style:rs,children:["Total / ",xa((It==null?void 0:It.total)??en*5)]})]}),n.jsxs("tr",{children:[!be&&n.jsx(n.Fragment,{children:k.map(Oe=>{const qe=`co${Oe}`,Lt=(It==null?void 0:It[qe])??en;return n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:rs,children:Lt}),n.jsx("th",{style:rs,children:"%"}),n.jsx("th",{style:rs,children:"3pt"})]},`co${Oe}-cells`)})}),n.jsx("th",{style:rs,children:Xr[1]}),n.jsx("th",{style:rs,children:"%"}),n.jsx("th",{style:rs,children:Xr[2]}),n.jsx("th",{style:rs,children:"%"}),n.jsx("th",{style:rs,children:Xr[3]}),n.jsx("th",{style:rs,children:"%"}),n.jsx("th",{style:rs,children:Xr[4]}),n.jsx("th",{style:rs,children:"%"}),n.jsx("th",{style:rs,children:Xr[5]}),n.jsx("th",{style:rs,children:"%"}),n.jsx("th",{style:rs,children:Xr[6]}),n.jsx("th",{style:rs,children:"%"})]})]}),n.jsx("tbody",{children:_r.map(Oe=>n.jsxs("tr",{children:[n.jsx("td",{style:ss,children:Oe.sno}),n.jsx("td",{style:ss,children:Oe.section??""}),n.jsx("td",{style:ss,children:Oe.reg_no}),n.jsx("td",{style:ss,children:Oe.name}),!be&&n.jsx(n.Fragment,{children:k.map(qe=>{const Lt=`co${qe}`,dt=`co${qe}Pct`,He=`co${qe}_3pt`;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe[Lt]==null?"":xa(Oe[Lt])}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe[dt]==null?"":Oe[dt]}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe[He]==null?"":Oe[He]})]},`co${qe}-row`)})}),n.jsx("td",{style:{...ss,textAlign:"center"},children:n.jsx("input",{type:"text",value:Me[Oe.id]||"",onChange:qe=>Wt({...Me,[Oe.id]:qe.target.value}),style:{width:"100%",minWidth:100,padding:"4px 6px",border:"1px solid #d1d5db",borderRadius:4,fontSize:12},placeholder:"Enter CQI"})}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl1==null?"":xa(Oe.btl1)}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl1Pct==null?"":Oe.btl1Pct}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl2==null?"":xa(Oe.btl2)}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl2Pct==null?"":Oe.btl2Pct}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl3==null?"":xa(Oe.btl3)}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl3Pct==null?"":Oe.btl3Pct}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl4==null?"":xa(Oe.btl4)}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl4Pct==null?"":Oe.btl4Pct}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl5==null?"":xa(Oe.btl5)}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl5Pct==null?"":Oe.btl5Pct}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl6==null?"":xa(Oe.btl6)}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe.btl6Pct==null?"":Oe.btl6Pct}),n.jsx("td",{style:{...ss,textAlign:"center",fontWeight:700},children:Oe.total==null?"":Oe.total})]},Oe.id))})]}):n.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:980},children:[n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx("th",{rowSpan:2,style:rs,children:"S.No"}),n.jsx("th",{rowSpan:2,style:rs,children:"Section"}),n.jsx("th",{rowSpan:2,style:rs,children:"Register No"}),n.jsx("th",{rowSpan:2,style:rs,children:"Name"}),!be&&n.jsx(n.Fragment,{children:k.map(Oe=>Oe===5&&!w?null:n.jsxs("th",{colSpan:3,style:Zc,children:["CO",Oe]},`co${Oe}`))}),n.jsx("th",{rowSpan:2,style:rs,children:"CQI Entry"}),n.jsxs("th",{rowSpan:2,style:rs,children:["Total / ",$r.total]})]}),n.jsx("tr",{children:!be&&n.jsx(n.Fragment,{children:k.map(Oe=>{if(Oe===5&&!w)return null;const qe=`co${Oe}`,Lt=Oe===5?oe:$r[qe];return n.jsxs(Jr.Fragment,{children:[n.jsx("th",{style:rs,children:Lt}),n.jsx("th",{style:rs,children:"%"}),n.jsx("th",{style:rs,children:"3pt"})]},`co${Oe}-cells`)})})})]}),n.jsx("tbody",{children:_r.map(Oe=>n.jsxs("tr",{children:[n.jsx("td",{style:ss,children:Oe.sno}),n.jsx("td",{style:ss,children:Oe.section??""}),n.jsx("td",{style:ss,children:Oe.reg_no}),n.jsx("td",{style:ss,children:Oe.name}),!be&&n.jsx(n.Fragment,{children:k.map(qe=>{if(qe===5&&!w)return null;const Lt=`co${qe}`,dt=`co${qe}Pct`,He=`co${qe}_3pt`;return n.jsxs(Jr.Fragment,{children:[n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe[Lt]==null?"":xa(Oe[Lt])}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe[dt]==null?"":Oe[dt]}),n.jsx("td",{style:{...ss,textAlign:"center"},children:Oe[He]==null?"":Oe[He]})]},`co${qe}-row`)})}),n.jsx("td",{style:{...ss,textAlign:"center"},children:n.jsx("input",{type:"text",value:Me[Oe.id]||"",onChange:qe=>Wt({...Me,[Oe.id]:qe.target.value}),style:{width:"100%",minWidth:100,padding:"4px 6px",border:"1px solid #d1d5db",borderRadius:4,fontSize:12},placeholder:"Enter CQI"})}),n.jsx("td",{style:{...ss,textAlign:"center",fontWeight:700},children:Oe.total==null?"":Oe.total})]},Oe.id))})]})})]})}const rs={border:"1px solid #111827",padding:"8px 8px",background:"#f3f4f6",textAlign:"center",fontWeight:800,fontSize:12,whiteSpace:"nowrap"},Zc={...rs,background:"#eaf2ff",color:"#0b4a6f"},ss={border:"1px solid #111827",padding:"7px 8px",fontSize:12,whiteSpace:"nowrap"},Bs=[1,2,3,4,5];function Ra(e){return`co${e}`}function Ya(e){return{co1:e,co2:e,co3:e,co4:e,co5:e}}const oJ=[{key:"q1",label:"Q1",max:2,co:1,btl:1},{key:"q2",label:"Q2",max:2,co:1,btl:3},{key:"q3",label:"Q3",max:2,co:1,btl:4},{key:"q4",label:"Q4",max:2,co:2,btl:1},{key:"q5",label:"Q5",max:2,co:2,btl:1},{key:"q6",label:"Q6",max:2,co:2,btl:2},{key:"q7",label:"Q7",max:16,co:1,btl:2},{key:"q8",label:"Q8",max:16,co:2,btl:3},{key:"q9",label:"Q9",max:16,co:"1&2",btl:5}],cc={ssa1:1.5,cia1:3,formative1:2.5},ub=1.74;function Il(e,t,r){return Math.max(t,Math.min(r,e))}function y4(e){return Math.round(e*100)/100}function lx(e){if(e===""||e==null)return null;const t=Number(e);return Number.isFinite(t)?t:null}function b4(e){const t=i=>!Number.isFinite(i)||i<1||i>5?null:i;if(e==null||e==="")return[1];if(Array.isArray(e)){const i=[];for(const o of e){const l=t(Number(o));l&&!i.includes(l)&&i.push(l)}return i.length?i:[1]}if(typeof e=="number")return[t(e)||1];const r=String(e).trim().toLowerCase();if(!r)return[1];if(r==="both")return[1,2];const s=r.replace(/[^0-9,\/\+&]+/g,"").split(/[,\/\+&]+/g).map(i=>i.trim()).filter(Boolean);if(s.length>1){const i=[];for(const o of s){const l=t(Number(o));l&&!i.includes(l)&&i.push(l)}return i.length?i:[1]}return r==="12"?[1,2]:[t(Number(r))||1]}function lJ(e){const t=Ya(0),s=Array.from(new Set((e||[]).filter(Boolean))).filter(i=>Bs.includes(i)),a=s.length||1;for(const i of s.length?s:[1])t[Ra(i)]=1/a;return t}function v4(e,t){const r=e[t];if(!r)return Ya(0);const s=b4(r.co),a=e.some(c=>b4(c.co).length>1),i=t===e.length-1,o=String(r.key||"").toLowerCase()==="q9"||String(r.label||"").toLowerCase().includes("q9");return lJ(!a&&i&&o?[1,2]:s)}function w4(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const o=r.localeCompare(s);if(o)return o}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim();return a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})}function cJ(e){const{ssaMark:t,ciaMark:r,f1Mark:s,ssaMax:a,ciaMax:i,f1Max:o,ssaW:l,ciaW:c,f1W:d}=e;if(t==null||r==null||s==null||!a||!i||!o)return null;const u=l+c+d,h=a+i+o;if(!u||!h)return null;const f=(t/a*l+r/i*c+s/o*d)/u*h;return Number.isFinite(f)?Il(f,0,h):null}function dJ({courseId:e}){const[t,r]=v.useState(null),s=v.useMemo(()=>`cqi_visible_cos_${e}`,[e]),[a,i]=v.useState(()=>{try{const H=Bn(`cqi_visible_cos_${e}`);if(Array.isArray(H)){const oe=H.map(Y=>Number(Y)).filter(Y=>Bs.includes(Y)),D=Array.from(new Set(oe));return D.length?D:[...Bs]}}catch{}return[...Bs]});v.useEffect(()=>{try{yn(s,a)}catch{}},[s,a]);const[o,l]=v.useState(null);v.useMemo(()=>On(o),[o]);const c=v.useMemo(()=>nw(o),[o]),[d,u]=v.useState([]),[h,p]=v.useState(null),[f,x]=v.useState(null),[g,y]=v.useState(!1),[m,w]=v.useState(null),[S,k]=v.useState([]),[F,L]=v.useState(!1),[C,O]=v.useState(null),[T,W]=v.useState({ssa:{},f1:{},cia:null}),[A,N]=v.useState({cia1:null}),[P,K]=v.useState(""),re=v.useMemo(()=>`co_attainment_cfg_${e}`,[e]),[ge,Fe]=v.useState(()=>{const H=Bn(`co_attainment_cfg_${e}`),oe=H==null?void 0:H.weights;return{ssa1:Number.isFinite(Number(oe==null?void 0:oe.ssa1))?Number(oe.ssa1):cc.ssa1,cia1:Number.isFinite(Number(oe==null?void 0:oe.cia1))?Number(oe.cia1):cc.cia1,formative1:Number.isFinite(Number(oe==null?void 0:oe.formative1))?Number(oe.formative1):cc.formative1}}),[R,q]=v.useState("default"),[me,fe]=v.useState(null);v.useEffect(()=>{let H=!0;return(async()=>{try{const oe=await Sl();if(!H)return;r(oe||null)}catch{}})(),()=>{H=!1}},[e]),v.useEffect(()=>{let H=!0;return(async()=>{var oe;try{const D=await wl();if(!H)return;const Y=(D||[]).filter(je=>je.subject_code===e);u(Y),p(null);const le=Bn(`coAttainment_selectedTa_${e}`),$e=typeof le=="number"&&Y.some(je=>je.id===le)&&le||(((oe=Y[0])==null?void 0:oe.id)??null);x($e)}catch(D){if(!H)return;u([]),x(null),p((D==null?void 0:D.message)||"Failed to load teaching assignments")}})(),()=>{H=!1}},[e]),v.useEffect(()=>{!e||f==null||yn(`coAttainment_selectedTa_${e}`,f)},[e,f]),v.useEffect(()=>{let H=!0;return(async()=>{try{const oe=(d||[]).find(je=>je.id===f)||null,D=String((oe==null?void 0:oe.class_type)||"").trim();if(D){H&&l(D);return}const Y=oe==null?void 0:oe.curriculum_row_id;if(!Y){H&&l(null);return}const le=await rw(Number(Y));if(!H)return;const $e=String((le==null?void 0:le.class_type)||"").trim();l($e||null)}catch{H&&l(null)}})(),()=>{H=!1}},[f,d]),v.useEffect(()=>{let H=!0;return(async()=>{if(o){fe("Loading IQAC weights");try{const oe=await ig();if(!H)return;if(oe&&typeof oe=="object"){const D=On(o),Y=oe[D];if(Y&&typeof Y=="object"){const le={ssa1:Number.isFinite(Number(Y.ssa1))?Number(Y.ssa1):cc.ssa1,cia1:Number.isFinite(Number(Y.cia1))?Number(Y.cia1):cc.cia1,formative1:Number.isFinite(Number(Y.formative1))?Number(Y.formative1):cc.formative1};Fe(le),q("server"),fe(`Applied server weights for ${D}`);try{yn(re,{weights:le})}catch{}return}fe(`Server weights loaded but no entry for ${On(o)}`)}}catch(oe){fe(`Server fetch failed: ${String((oe==null?void 0:oe.message)||oe)}`)}try{const oe=Bn("iqac_class_type_weights");if(oe&&typeof oe=="object"){const D=On(o),Y=oe[D];if(Y&&typeof Y=="object"){const le={ssa1:Number.isFinite(Number(Y.ssa1))?Number(Y.ssa1):cc.ssa1,cia1:Number.isFinite(Number(Y.cia1))?Number(Y.cia1):cc.cia1,formative1:Number.isFinite(Number(Y.formative1))?Number(Y.formative1):cc.formative1};Fe(le),q("local"),fe(`Applied local weights for ${D}`);try{yn(re,{weights:le})}catch{}return}}}catch(oe){fe(`Local read failed: ${String((oe==null?void 0:oe.message)||oe)}`)}}})(),()=>{H=!1}},[o,re]);const E=v.useMemo(()=>{var oe,D;const H=(D=(oe=t==null?void 0:t.assessments)==null?void 0:oe.cia1)==null?void 0:D.questions;return Array.isArray(H)&&H.length?H.map(Y=>({key:String((Y==null?void 0:Y.key)||""),label:String((Y==null?void 0:Y.label)||(Y==null?void 0:Y.key)||""),max:Number((Y==null?void 0:Y.max)||0),co:Y==null?void 0:Y.co,btl:Math.min(6,Math.max(1,Number((Y==null?void 0:Y.btl)||1)))})).filter(Y=>Y.key):oJ},[t]),U=v.useMemo(()=>{const H=Ya(0);return E.forEach((oe,D)=>{const Y=v4(E,D);for(const le of Bs)H[Ra(le)]+=(Number(oe.max)||0)*(Y[Ra(le)]||0)}),H},[E]),I=v.useMemo(()=>{var Ee,Re,Ve;const H=((Ee=t==null?void 0:t.assessments)==null?void 0:Ee.ssa1)||{},oe=((Re=t==null?void 0:t.assessments)==null?void 0:Re.formative1)||{},D=((Ve=t==null?void 0:t.assessments)==null?void 0:Ve.cia1)||{},Y=(St,rt)=>{var Ie;const ze=Ya(0);for(const ot of Bs){const be=Ra(ot),we=Number((Ie=St==null?void 0:St.coMax)==null?void 0:Ie[be]);ze[be]=Number.isFinite(we)?Math.max(0,we):rt[be]}return ze},le={...Ya(0),co1:10,co2:10},$e=Number(oe==null?void 0:oe.maxCo),je={...Ya(0),co1:Number.isFinite($e)?Math.max(0,$e):10,co2:Number.isFinite($e)?Math.max(0,$e):10},We=U;return{ssa:Y(H,le),cia:Y(D,We),f1:Y(oe,je)}},[t,U]),M=async()=>{L(!0),O(null);try{if(c){const H=await wa("cia1",e);W({ssa:{},f1:{},cia:null}),N({cia1:(H==null?void 0:H.data)??null})}else{const[H,oe,D]=await Promise.all([S0(e),cg(e),Ip(e)]);W({ssa:H!=null&&H.marks&&typeof H.marks=="object"?H.marks:{},f1:oe!=null&&oe.marks&&typeof oe.marks=="object"?oe.marks:{},cia:(D==null?void 0:D.data)??null}),N({cia1:null})}}catch(H){W({ssa:{},f1:{},cia:null}),N({cia1:null}),O((H==null?void 0:H.message)||"Failed to load published marks")}finally{L(!1)}};v.useEffect(()=>{e&&M()},[e,c]),v.useEffect(()=>{const H=oe=>{try{const D=(oe==null?void 0:oe.detail)||{},Y=D.subjectId,le=D.assessment;if(!Y||String(Y)!==String(e)||le&&!["ssa1","formative1","cia1"].includes(String(le)))return;M()}catch{}};return window.addEventListener("obe:published",H),()=>window.removeEventListener("obe:published",H)},[e]),v.useEffect(()=>{let H=!0;return(async()=>{if(f){y(!0),w(null);try{const D=(d||[]).find(Y=>Y.id===f)||null;if(D&&D.elective_subject_id&&!D.section_id){const Y=D.elective_subject_id,le=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(Y))}`);if(!le.ok)throw new Error(`Elective-choices fetch failed: ${le.status}`);const $e=await le.json();if(!H)return;const We=((Array.isArray($e.results)?$e.results:Array.isArray($e)?$e:$e.items||[])||[]).map(Ee=>({id:Number(Ee.student_id??Ee.id),reg_no:String(Ee.reg_no??Ee.registration_no??Ee.regno??""),name:String(Ee.name??Ee.full_name??Ee.username??""),section:Ee.section_name??Ee.section??null}));if(!H)return;k(We.filter(Ee=>Number.isFinite(Ee.id)).sort(w4))}else{const Y=await Jo(f);if(!H)return;const le=(Y.students||[]).map($e=>({id:Number($e.id),reg_no:String($e.reg_no??""),name:String($e.name??""),section:$e.section??null})).filter($e=>Number.isFinite($e.id)).sort(w4);k(le)}}catch(D){if(!H)return;k([]),w((D==null?void 0:D.message)||"Failed to load roster")}finally{H&&y(!1)}}})(),()=>{H=!1}},[f,d]);const te=v.useMemo(()=>{const H=new Map;if(c){const We=A.cia1,Ee=We!=null&&We.sheet&&typeof We.sheet=="object"?We.sheet:{},Re=Ee!=null&&Ee.rowsByStudentId&&typeof Ee.rowsByStudentId=="object"?Ee.rowsByStudentId:{},Ve=Il(Number((Ee==null?void 0:Ee.expCountA)??0),0,12),St=Il(Number((Ee==null?void 0:Ee.expCountB)??0),0,12),rt=!!(Ee!=null&&Ee.coAEnabled),ze=!!(Ee!=null&&Ee.coBEnabled),Ie=(be,we)=>{const Me=Array.isArray(be)?be:[],Wt=[];for(let Ct=0;Ct<we;Ct++){const pr=Me[Ct];if(pr===""||pr==null){Wt.push("");continue}const fr=typeof pr=="number"?pr:Number(pr);Wt.push(Number.isFinite(fr)?fr:"")}return Wt},ot=be=>{const we=be.filter(Me=>typeof Me=="number"&&Number.isFinite(Me));return we.length?we.reduce((Me,Wt)=>Me+Wt,0)/we.length:null};for(const be of S){const we=Re[String(be.id)]||{},Me=Ie(we.marksA,Ve).slice(0,rt?Ve:0),Wt=Ie(we.marksB,St).slice(0,ze?St:0),Ct=ot(Me),pr=ot(Wt),fr=we==null?void 0:we.ciaExam,Be=typeof fr=="number"&&Number.isFinite(fr)?fr:null,mt=Ct!=null||pr!=null||Be!=null,It=mt?(Ct??0)+(Be??0)/2:null,ft=mt?(pr??0)+(Be??0)/2:null;H.set(be.id,{ssaCo1:null,ssaCo2:null,ciaCo1:It==null?null:Il(It,0,40),ciaCo2:ft==null?null:Il(ft,0,40),f1Co1:null,f1Co2:null,__labCoMax:40})}return H}const oe=new Map;for(const[je,We]of Object.entries(T.ssa||{})){const Ee=Number(je);Number.isFinite(Ee)&&oe.set(Ee,lx(We))}const D=T.f1&&typeof T.f1=="object"?T.f1:{},Y=T.cia&&typeof T.cia=="object"?T.cia:null,le=Array.isArray(Y==null?void 0:Y.questions)?Y.questions.map(je=>({key:String((je==null?void 0:je.key)||""),label:String((je==null?void 0:je.label)||(je==null?void 0:je.key)||""),max:Number((je==null?void 0:je.max)||0),co:je==null?void 0:je.co,btl:Math.min(6,Math.max(1,Number((je==null?void 0:je.btl)||1)))})).filter(je=>je.key):E,$e=Y!=null&&Y.rowsByStudentId&&typeof Y.rowsByStudentId=="object"?Y.rowsByStudentId:{};for(const je of S){const We=oe.get(je.id)??null,Ee=Bs.reduce((we,Me)=>we+(I.ssa[Ra(Me)]||0),0),Re=Ya(null);for(const we of Bs){const Me=Ra(we),Wt=I.ssa[Me]||0;if(We==null||!Ee||!Wt){Re[Me]=null;continue}const Ct=We/Ee*Wt;Re[Me]=Il(Ct,0,Wt)}const Ve=D[String(je.id)]||{},St=Ya(null);for(const we of Bs){const Me=Ra(we),Wt=I.f1[Me]||0,Ct=lx(Ve==null?void 0:Ve[`skill${we}`]),pr=lx(Ve==null?void 0:Ve[`att${we}`]);Wt&&Ct!=null&&pr!=null?St[Me]=Il(Ct+pr,0,Wt):St[Me]=null}const rt=$e[String(je.id)]||{},ze=!!(rt!=null&&rt.absent),Ie=rt!=null&&rt.q&&typeof rt.q=="object"?rt.q:{},ot=Ya(null);if(!ze){const we=Ya(0);let Me=!1;if(le.forEach((Wt,Ct)=>{const pr=Ie==null?void 0:Ie[Wt.key],fr=lx(pr);if(fr==null)return;Me=!0;const Be=Il(fr,0,Number(Wt.max)||fr),mt=v4(le,Ct);for(const It of Bs){const ft=Ra(It);we[ft]+=Be*(mt[ft]||0)}}),Me)for(const Wt of Bs){const Ct=Ra(Wt),pr=I.cia[Ct]||0;ot[Ct]=pr?Il(we[Ct],0,pr):null}}const be={};for(const we of Bs){const Me=Ra(we);be[`ssaCo${we}`]=Re[Me],be[`f1Co${we}`]=St[Me],be[`ciaCo${we}`]=ot[Me]}H.set(je.id,be)}return H},[T,A,S,I,E,c]),Q=v.useMemo(()=>{var le;if(c){const $e=((le=S[0])==null?void 0:le.id)!=null?te.get(S[0].id):null,je=Number($e==null?void 0:$e.__labCoMax),We=Number.isFinite(je)&&je>0?je:40,Ee=Ve=>Ve==null||!We?null:y4(Ve/We*3),Re=(Ve,St)=>{if(Ve==null||St==null||!We)return null;const rt=(Ve+St)/(2*We)*100;return Number.isFinite(rt)?Math.round(Il(rt,0,100)):null};return S.map((Ve,St)=>{const rt=te.get(Ve.id)||{},ze=Ya(null);ze.co1=typeof rt.ciaCo1=="number"?rt.ciaCo1:null,ze.co2=typeof rt.ciaCo2=="number"?rt.ciaCo2:null;const Ie=Ya(null),ot=Ya(!1);for(const Wt of Bs){const Ct=Ra(Wt);Ie[Ct]=Ee(ze[Ct]),ot[Ct]=typeof Ie[Ct]=="number"&&Ie[Ct]<ub}const be=Re(ze.co1,ze.co2),we=Bs.map(Wt=>ot[Ra(Wt)]?`CO${Wt}`:null).filter(Boolean).join("+"),Me={sno:St+1,...Ve,total:be,cos:we};for(const Wt of Bs){const Ct=Ra(Wt);Me[`${Ct}_3pt`]=Ie[Ct],Me[`flagCO${Wt}`]=ot[Ct]}return Me})}const H=ge.ssa1,oe=ge.cia1,D=ge.formative1,Y=Ya(0);for(const $e of Bs){const je=Ra($e);Y[je]=(I.ssa[je]||0)+(I.cia[je]||0)+(I.f1[je]||0)}return S.map(($e,je)=>{const We=te.get($e.id),Ee=Ya(null),Re=Ya(null),Ve=Ya(!1);for(const Ie of Bs){const ot=Ra(Ie),be=cJ({ssaMark:(We==null?void 0:We[`ssaCo${Ie}`])??null,ciaMark:(We==null?void 0:We[`ciaCo${Ie}`])??null,f1Mark:(We==null?void 0:We[`f1Co${Ie}`])??null,ssaMax:I.ssa[ot]||0,ciaMax:I.cia[ot]||0,f1Max:I.f1[ot]||0,ssaW:H,ciaW:oe,f1W:D});Ee[ot]=be;const we=Y[ot]||0;Re[ot]=be==null||!we?null:y4(be/we*3),Ve[ot]=typeof Re[ot]=="number"&&Re[ot]<ub}const St=(()=>{const Ie=Bs.map(ot=>Ee[Ra(ot)]).filter(ot=>typeof ot=="number"&&Number.isFinite(ot));return Ie.length?Math.round(Ie.reduce((ot,be)=>ot+be,0)):null})(),rt=Bs.map(Ie=>Ve[Ra(Ie)]?`CO${Ie}`:null).filter(Boolean).join("+"),ze={sno:je+1,...$e,total:St,cos:rt};for(const Ie of Bs){const ot=Ra(Ie);ze[`${ot}_3pt`]=Re[ot],ze[`flagCO${Ie}`]=Ve[ot]}return ze})},[S,te,I,ge,c]),G=v.useMemo(()=>{const H=P.trim().toLowerCase();return H?Q.filter(oe=>{const D=String(oe.reg_no||"").toLowerCase(),Y=String(oe.name||"").toLowerCase(),le=String(oe.section||"").toLowerCase();return D.includes(H)||Y.includes(H)||le.includes(H)}):Q},[Q,P]),ne=v.useMemo(()=>{const H=Y=>a.some(le=>!!(Y!=null&&Y[`flagCO${le}`])),oe=Q.filter(Y=>H(Y)).length,D={strength:Q.length,flagged:oe};for(const Y of Bs)D[`co${Y}`]=Q.filter(le=>!!le[`flagCO${Y}`]).length;return D},[Q,a]),z={position:"sticky",top:0,zIndex:2,textAlign:"left",padding:"10px 12px",fontSize:12,letterSpacing:.2,textTransform:"uppercase",color:"#0f172a",background:"linear-gradient(180deg,#eaf6ff,#ffffff)",borderBottom:"1px solid rgba(148, 163, 184, 0.5)",whiteSpace:"nowrap"},he={padding:"10px 12px",borderBottom:"1px solid rgba(226, 232, 240, 0.9)",fontSize:13,color:"#0f172a",verticalAlign:"middle",whiteSpace:"nowrap"},X=(H,oe)=>{const D=oe==="danger"?{background:"rgba(239, 68, 68, 0.12)",border:"1px solid rgba(239, 68, 68, 0.35)",color:"#991b1b"}:{background:"rgba(2, 132, 199, 0.08)",border:"1px solid rgba(2, 132, 199, 0.25)",color:"#0b4a6f"};return n.jsx("span",{style:{display:"inline-flex",alignItems:"center",height:24,padding:"0 10px",borderRadius:999,fontSize:12,fontWeight:800,...D},children:H})};return n.jsxs("div",{style:{display:"grid",gap:14},children:[n.jsxs("div",{style:{padding:16,borderRadius:14,background:"linear-gradient(135deg,#ffffff,#f0f9ff)",border:"1px solid rgba(226, 232, 240, 0.9)",boxShadow:"0 10px 28px rgba(2, 6, 23, 0.06)"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"flex-end"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:18,fontWeight:950,color:"#0b4a6f"},children:"C1-CQI"}),n.jsxs("div",{style:{marginTop:6,fontSize:13,color:"#334155"},children:["Flags CO1CO5 when 3pt attainment is below ",n.jsx("b",{children:ub}),"."]})]}),n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"flex-end"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:6,fontWeight:700},children:"Teaching Assignment / Section"}),n.jsxs("select",{value:f??"",onChange:H=>x(H.target.value?Number(H.target.value):null),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",minWidth:320,background:"#fff"},children:[n.jsx("option",{value:"",children:"Select"}),d.map(H=>{const oe=H.department,D=(oe==null?void 0:oe.short_name)||(oe==null?void 0:oe.code)||(oe==null?void 0:oe.name)||H.department_name||"",Y=H.semester;return n.jsxs("option",{value:H.id,children:[H.section_name," ",Y?` Sem ${Y}`:""," ",H.academic_year?` ${H.academic_year}`:""," ",D?` ${D}`:""]},H.id)})]})]}),n.jsxs("div",{style:{minWidth:320},children:[n.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:6,fontWeight:700},children:"Show CO columns"}),n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff"},children:[Bs.map(H=>{const oe=a.includes(H);return n.jsxs("label",{style:{display:"inline-flex",gap:8,alignItems:"center",cursor:"pointer",userSelect:"none"},children:[n.jsx("input",{type:"checkbox",checked:oe,onChange:D=>{const Y=D.target.checked?Array.from(new Set([...a,H])):a.filter(le=>le!==H);i(Y)}}),n.jsx("span",{style:{fontSize:12,fontWeight:800,color:"#0f172a"},children:`CO${H}`})]},H)}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[n.jsx("button",{type:"button",onClick:()=>i([...Bs]),style:{padding:"6px 10px",borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:12,fontWeight:800,color:"#0f172a"},children:"All"}),n.jsx("button",{type:"button",onClick:()=>i([]),style:{padding:"6px 10px",borderRadius:10,border:"1px solid #e2e8f0",background:"#fff",fontSize:12,fontWeight:800,color:"#0f172a"},children:"None"})]})]})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:6,fontWeight:700},children:"Search"}),n.jsx("input",{value:P,onChange:H=>K(H.target.value),placeholder:"Reg no / name / section",style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",width:260}})]})]})]}),(F||C||g||m||h)&&n.jsxs("div",{style:{marginTop:12,display:"grid",gap:8},children:[(F||C)&&n.jsx("div",{style:{fontSize:12,color:C?"#b91c1c":"#64748b"},children:F?"Loading published marks":C}),(g||m)&&n.jsx("div",{style:{fontSize:12,color:m?"#b91c1c":"#64748b"},children:g?"Loading roster":m}),h&&n.jsx("div",{style:{marginTop:4,background:"#fef2f2",border:"1px solid rgba(239, 68, 68, 0.25)",color:"#991b1b",padding:10,borderRadius:12},children:h})]}),n.jsxs("div",{style:{display:"flex",gap:10,marginTop:12,flexWrap:"wrap"},children:[X(`Strength: ${ne.strength}`,"neutral"),X(`Flagged: ${ne.flagged}`,ne.flagged?"danger":"neutral"),a.map(H=>n.jsx(Jr.Fragment,{children:X(`CO${H} below: ${ne[`co${H}`]??0}`,ne[`co${H}`]?"danger":"neutral")},H))]})]}),n.jsx("div",{style:{borderRadius:14,border:"1px solid rgba(226, 232, 240, 0.9)",overflow:"hidden",background:"#fff",boxShadow:"0 10px 28px rgba(2, 6, 23, 0.06)"},children:n.jsx("div",{style:{maxHeight:"70vh",overflow:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{...z,width:70},children:"slno"}),n.jsx("th",{style:{...z,width:70},children:"SEC"}),n.jsx("th",{style:{...z,width:160},children:"Reg number"}),n.jsx("th",{style:{...z,minWidth:260},children:"NAME"}),n.jsx("th",{style:{...z,width:140},children:"CO's"}),n.jsx("th",{style:{...z,width:90,textAlign:"center"},children:"100"}),a.map(H=>n.jsx("th",{style:{...z,width:90,textAlign:"center"},children:`CO${H} (3pt)`},H))]})}),n.jsxs("tbody",{children:[G.map((H,oe)=>{const D=a.some(We=>!!H[`flagCO${We}`]),Y=oe%2===0,le=D?"rgba(239, 68, 68, 0.10)":Y?"#ffffff":"#f8fafc",$e=We=>({...he,textAlign:"center",fontWeight:900,color:We?"#991b1b":"#065f46",background:We?"rgba(239, 68, 68, 0.10)":"rgba(34, 197, 94, 0.10)",borderBottom:"1px solid rgba(226, 232, 240, 0.9)"}),je=H.total!=null&&H.total<=58;return n.jsxs("tr",{style:{background:le},children:[n.jsx("td",{style:{...he,width:70,borderLeft:D?"4px solid rgba(239, 68, 68, 0.55)":"4px solid transparent"},children:H.sno}),n.jsx("td",{style:{...he,width:70},children:H.section??""}),n.jsx("td",{style:{...he,width:160,fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace'},children:H.reg_no}),n.jsx("td",{style:{...he,minWidth:260,fontWeight:800},children:H.name}),n.jsx("td",{style:{...he,width:140},children:a.some(We=>!!H[`flagCO${We}`])?n.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:a.filter(We=>!!H[`flagCO${We}`]).map(We=>n.jsx(Jr.Fragment,{children:X(`CO${We}`,"danger")},We))}):""}),n.jsx("td",{style:{...he,width:90,textAlign:"center",fontWeight:900,color:je?"#991b1b":"#0f172a",background:je?"rgba(239, 68, 68, 0.12)":"transparent"},children:H.total==null?"":Number.isFinite(Number(H.total))?String(Math.round(Number(H.total))):H.total}),a.map(We=>n.jsx("td",{style:$e(!!H[`flagCO${We}`]),children:H[`co${We}_3pt`]==null?"":H[`co${We}_3pt`]},We))]},H.id)}),!G.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:6+a.length,style:{padding:18,textAlign:"center",color:"#64748b"},children:"No rows."})})]})]})})})]})}function v8({courseId:e}){return n.jsx(dJ,{courseId:e})}function Vd(e){return String(e||"").trim()}function uJ(){var F,L;const{courseCode:e,taId:t}=g0(),r=Ri(),s=Ji(),a=v.useMemo(()=>decodeURIComponent(String(e||"")).trim(),[e]),i=v.useMemo(()=>t?Number(t):NaN,[t]),[o,l]=v.useState("marks"),[c,d]=v.useState(null),[u,h]=v.useState(null),[p,f]=v.useState(null),[x,g]=v.useState(null);v.useEffect(()=>{if(!(s!=null&&s.pathname))return;const C=s.pathname.toLowerCase();C.includes("/lca/instructions")||C.includes("/lca_instructions")||C.includes("/lca")||C.includes("/cdap")||C.includes("/articulation")?l("lca_instructions"):C.includes("/marks")?l("marks"):C.includes("/co_attainment")?l("co_attainment"):C.includes("/cqi")?l("cqi"):l("marks")},[s]);const y=v.useMemo(()=>{const C=String((s==null?void 0:s.pathname)||"").toLowerCase();return C.includes("/cdap")?"cdap":C.includes("/articulation")?"articulation":C.includes("/lca")&&!(C.includes("/lca/instructions")||C.includes("/lca_instructions"))?"lca":"instructions"},[s==null?void 0:s.pathname]);v.useEffect(()=>{let C=!0;return(async()=>{if(a)try{const O=await x1(a);if(!C)return;const T=(O||[]).find(W=>Number(W.teaching_assignment_id)===Number(i))||null;d(T)}catch{if(!C)return;d(null)}})(),()=>{C=!1}},[a,i]),v.useEffect(()=>{let C=!0;return(async()=>{if(a)try{const[O,T]=await Promise.all([vo(),jc()]);if(!C)return;const W=a.toUpperCase(),A=(O||[]).filter(re=>Vd(re==null?void 0:re.course_code).toUpperCase()===W),N=re=>Vd(re).toUpperCase(),P=A.find(re=>{const ge=N(re==null?void 0:re.question_paper_type);return ge&&ge!=="QP1"})||A.find(re=>N(re==null?void 0:re.question_paper_type))||A.find(re=>Vd(re==null?void 0:re.class_type))||A[0];if(P){if(h(P!=null&&P.class_type?Vd(P.class_type):null),f(P!=null&&P.question_paper_type?Vd(P.question_paper_type):null),On(P==null?void 0:P.class_type)==="SPECIAL"){g([]);try{const re=await ag(a);g(Array.isArray(re)?re:[])}catch{const re=P==null?void 0:P.enabled_assessments;g(Array.isArray(re)?re.map(ge=>String(ge).trim().toLowerCase()).filter(Boolean):[])}}else g(null);return}const K=(T||[]).find(re=>Vd(re==null?void 0:re.course_code).toUpperCase()===W);h(K!=null&&K.class_type?Vd(K.class_type):null),f(null),g(null)}catch{}})(),()=>{C=!1}},[a]);const m=v.useMemo(()=>Number.isFinite(i)?[{id:i,subject_id:0,subject_code:a,subject_name:(c==null?void 0:c.course_name)||a,section_id:(c==null?void 0:c.section_id)||0,section_name:(c==null?void 0:c.section_name)||"Section",academic_year:(c==null?void 0:c.academic_year)||""}]:[],[i,a,c]);if(!a||!Number.isFinite(i))return n.jsxs("main",{style:{padding:18,minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n.jsx("div",{style:{color:"#b91c1c"},children:"Invalid teaching assignment."}),n.jsx("div",{style:{marginTop:10},children:n.jsx(sa,{className:"obe-btn obe-btn-secondary",to:"/iqac/academic-controller?tab=courses",children:"Back"})})]});const w=(c==null?void 0:c.course_name)||a,S=[c==null?void 0:c.section_name,c==null?void 0:c.academic_year].filter(Boolean).join("  "),k=((F=c==null?void 0:c.staff)==null?void 0:F.name)||((L=c==null?void 0:c.staff)==null?void 0:L.username)||"";return n.jsx("main",{className:"obe-course-page",style:{padding:0,fontFamily:"Arial, sans-serif",minHeight:"100vh",background:"#fff"},children:n.jsxs("div",{style:{padding:"0px",width:"100%",minWidth:0,boxSizing:"border-box"},children:[n.jsx("div",{style:{marginBottom:12,padding:18},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{children:[n.jsxs("h2",{style:{margin:0},children:["OBE Viewer - ",a]}),n.jsx("div",{style:{color:"#666",marginTop:6},children:"View-only (IQAC)"}),n.jsx("div",{style:{color:"#222",marginTop:6,fontWeight:800},children:w}),n.jsxs("div",{style:{color:"#374151",marginTop:4},children:[S||"",k?`    ${k}`:"",u?`    ${String(u).toUpperCase()}`:""]}),p?n.jsxs("div",{style:{color:"#374151",marginTop:2},children:["QP Type: ",n.jsx("strong",{style:{color:"#111827"},children:String(p)})]}):null]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx(sa,{className:"obe-btn obe-btn-secondary",to:`/iqac/academic-controller/course/${encodeURIComponent(a)}`,children:"Back"}),n.jsx("button",{onClick:()=>r(`/iqac/academic-controller/course/${encodeURIComponent(a)}/marks/${encodeURIComponent(String(i))}`),className:"obe-btn",children:"Mark Entry Only"})]})]})}),n.jsx("div",{className:"obe-tab-nav","aria-label":"OBE Tabs",style:{padding:"0 18px"},children:[{key:"lca_instructions",label:"LCA Instructions"},{key:"marks",label:"Mark Entry"},{key:"co_attainment",label:"CO ATTAINMENT"},{key:"cqi",label:"CQI"}].map(C=>{const O=o===C.key;return n.jsx("button",{onClick:()=>{l(C.key);const T=encodeURIComponent(a),W=encodeURIComponent(String(i)),A=C.key==="lca_instructions"?"lca/instructions":String(C.key);r(`/iqac/academic-controller/course/${T}/obe/${W}/${A}`)},className:`obe-tab-btn ${O?"active":""}`,children:C.label},C.key)})}),n.jsxs("div",{style:{border:"1px solid #eee",borderRadius:10,padding:12,margin:18},children:[o==="lca_instructions"&&n.jsx(g8,{courseCode:a,courseName:(c==null?void 0:c.course_name)||null,initialTab:y,viewerMode:!0}),o!=="lca_instructions"?n.jsxs("fieldset",{disabled:!0,style:{border:0,padding:0,margin:0},children:[o==="co_attainment"&&n.jsx(b8,{courseId:a,enabledAssessments:x}),o==="cqi"&&n.jsx(v8,{courseId:a})]}):null,o==="marks"?n.jsx("div",{children:n.jsx(Yw,{subjectId:a,classType:u,questionPaperType:p,enabledAssessments:x,teachingAssignmentsOverride:m,fixedTeachingAssignmentId:i,iqacResetEnabled:!0,viewerMode:!1})}):null]})]})})}function fJ(){const{courseCode:e,taId:t}=g0(),r=String(e||""),s=Ri(),[a,i]=v.useState(!0),[o,l]=v.useState(!1),[c,d]=v.useState(null),[u,h]=v.useState(null),p={header:["CO1","CO1","CO1","CO2","CO2","CO2","CO3","CO3","CO3","CO4","CO4","CO4","CO1","CO2","CO3","CO4","CO5"],weights:[1.5,3,2.5,1.5,3,2.5,1.5,3,2.5,1.5,3,2.5,2,2,2,2,4],cycles:["ssa","cia","fa","ssa","cia","fa","ssa","cia","fa","ssa","cia","fa","ME","ME","ME","ME","ME"]},f=L=>{const C=Number(L);if(!Number.isFinite(C)||C<=0)return[0,0,0];const O=1.5,T=3,W=2.5,A=O+T+W,N=Math.round(C*O/A*100)/100,P=Math.round(C*T/A*100)/100,K=Math.round(C*W/A*100)/100;return[N,P,K]},x=L=>{const C=L&&typeof L=="object"?L:{};let O=Array.isArray(C.weights)?[...C.weights]:[];if(O=O.map(T=>{const W=Number(T);return Number.isFinite(W)?W:0}),O.length===13){const[T,W,A]=f(O[0]??0),[N,P,K]=f(O[1]??0);O=[T,W,A,N,P,K,...O.slice(2)]}for(;O.length<p.weights.length;)O.push(p.weights[O.length]??0);return O=O.slice(0,p.weights.length),{...C,header:p.header,cycles:p.cycles,weights:O}};v.useEffect(()=>{let L=!0;return(async()=>{i(!0);try{const C=await Q6(r);if(!L)return;h(C!=null&&C.mapping?x(C.mapping):null)}catch(C){if(!L)return;d((C==null?void 0:C.message)||String(C))}finally{L&&i(!1)}})(),()=>{L=!1}},[r]);const g=()=>u?x(u):(h(p),p),y=(L,C)=>{const O=C===""?"":Number(C);h(T=>{const W={...T||g()},A=Array.isArray(W.weights)?[...W.weights]:[];return A[L]=O,W.weights=A,W})},m=async()=>{l(!0),d(null);try{const L=x(u??g());await X6(r,L);try{window.dispatchEvent(new CustomEvent("internal-mark:updated",{detail:{subjectId:r}}))}catch{}s(-1)}catch(L){d((L==null?void 0:L.message)||String(L))}finally{l(!1)}};if(a)return n.jsx("div",{style:{padding:18},children:"Loading"});const w=x(u??g()),S=w.header,k=w.weights,F=w.cycles;return n.jsxs("main",{style:{padding:18},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[n.jsxs("h2",{style:{margin:0},children:["Internal Mark Mapping - ",r]}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("button",{className:"obe-btn",onClick:()=>s(-1),children:"Back"}),n.jsx("button",{className:"obe-btn obe-btn-primary",onClick:m,disabled:o,children:o?"Saving...":"Save"})]})]}),n.jsx("div",{style:{overflowX:"auto"},children:n.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[n.jsxs("thead",{children:[n.jsx("tr",{children:S.map((L,C)=>n.jsx("th",{style:{border:"1px solid #d1d5db",padding:8,background:"#f3f4f6"},children:L},C))}),n.jsx("tr",{children:F.map((L,C)=>n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f9fafb",fontWeight:600},children:L},`cy-${C}`))})]}),n.jsx("tbody",{children:n.jsx("tr",{children:k.map((L,C)=>n.jsx("td",{style:{border:"1px solid #e5e7eb",padding:6,background:"#f3f4f6"},children:n.jsx("input",{type:"number",step:"0.1",value:L===""?"":String(L),onChange:O=>y(C,O.target.value),style:{width:70,padding:6}})},C))})})]})}),c?n.jsx("div",{style:{color:"red",marginTop:12},children:c}):null]})}function hJ(){return n.jsx(aA,{})}function Rs({user:e,element:t,requiredRoles:r,requiredPermissions:s,requiredProfile:a}){if(!e)return n.jsx(Tf,{to:"/login",replace:!0});const i=(e.roles||[]).map(d=>(d||"").toString().toUpperCase()),o=(e.permissions||[]).map(d=>(d||"").toString().toLowerCase()),l=(e.profile_type||"").toString().toUpperCase();let c=!1;return a&&(a==="STUDENT"&&l==="STUDENT"&&(c=!0),a==="STAFF"&&l==="STAFF"&&(c=!0)),!c&&r&&r.length&&r.map(u=>u.toString().toUpperCase()).some(u=>i.includes(u))&&(c=!0),!c&&s&&s.length&&s.map(u=>u.toString().toLowerCase()).some(u=>o.includes(u))&&(c=!0),!a&&(!r||r.length===0)&&(!s||s.length===0)&&(c=!0),c?t:n.jsx(Tf,{to:"/dashboard",replace:!0})}function fb({user:e}){return n.jsx("div",{className:"fixed inset-0 overflow-hidden bg-gradient-to-br from-blue-50 to-slate-100",children:n.jsx("section",{className:"relative h-full flex items-center justify-center bg-gradient-to-b from-indigo-50 to-white py-0 px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[n.jsx("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-bold text-gray-900 mb-6",children:"Welcome to IDCS"}),n.jsx("p",{className:"text-lg sm:text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Streamline your academic management with our comprehensive Education Resource Planning system"}),e?n.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-md mx-auto",children:[n.jsxs("p",{className:"text-lg text-gray-700 mb-2",children:["Hello, ",n.jsx("strong",{className:"text-blue-600",children:e.username}),"!"]}),e.roles&&e.roles.length>0&&n.jsxs("p",{className:"text-sm text-gray-500",children:["Role: ",n.jsx("span",{className:"font-semibold text-indigo-600",children:e.roles.join(", ")})]})]}):n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[n.jsx("a",{href:"/login",className:"px-8 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105",children:"Get Started"}),n.jsx("a",{href:"#features",className:"px-8 py-3 bg-white text-blue-600 border-2 border-blue-600 rounded-lg font-semibold hover:bg-blue-50 transition-all duration-200",children:"Learn More"})]})]})})})}function pJ(){return n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 sm:p-8 shadow-md",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:n.jsx(Lu,{className:"w-7 h-7 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Welcome back"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Welcome to the dashboard."})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-shadow",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center",children:n.jsx(va,{className:"w-5 h-5 text-emerald-600"})}),n.jsx("h3",{className:"font-semibold text-gray-900",children:"Courses"})]}),n.jsx("p",{className:"text-sm text-gray-600",children:"View your enrolled courses"})]}),n.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-shadow",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:n.jsx(v0,{className:"w-5 h-5 text-purple-600"})}),n.jsx("h3",{className:"font-semibold text-gray-900",children:"Academics"})]}),n.jsx("p",{className:"text-sm text-gray-600",children:"Access academic resources"})]}),n.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-shadow sm:col-span-2 lg:col-span-1",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:n.jsx(ca,{className:"w-5 h-5 text-blue-600"})}),n.jsx("h3",{className:"font-semibold text-gray-900",children:"Schedule"})]}),n.jsx("p",{className:"text-sm text-gray-600",children:"Check your timetable"})]})]})]})}function Bf({children:e}){return n.jsx(n.Fragment,{children:e})}function mJ(){return n.jsx(Bf,{children:n.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pb-6",children:[n.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-6",children:"Dashboard"}),n.jsx(pJ,{})]})})}function xJ({user:e}){const[t,r]=v.useState(e===void 0?null:e),[s,a]=v.useState(!e),[i,o]=v.useState(null);if(v.useEffect(()=>{if(e)return;let c=!0;return a(!0),Pp().then(d=>{if(!c)return;const u={...d,roles:Array.isArray(d.roles)?d.roles.map(h=>typeof h=="string"?h:h.name):[]};r(u)}).catch(d=>o(String(d))).finally(()=>a(!1)),()=>{c=!1}},[e]),s)return n.jsx(Bf,{children:n.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600",children:"Loading profile"})]})})});if(i)return n.jsx(Bf,{children:n.jsx("div",{className:"px-4 sm:px-6 lg:px-8 pb-6",children:n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800",children:["Error loading profile: ",i]})})});if(!t)return n.jsx(Bf,{children:n.jsx("div",{className:"px-4 sm:px-6 lg:px-8 pb-6",children:n.jsx("div",{className:"text-center text-gray-500",children:"No profile available"})})});const l=(t.username||"U").slice(0,2).toUpperCase();return n.jsx(Bf,{children:n.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pb-6 space-y-6",children:[n.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 sm:p-8 shadow-md",children:n.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:n.jsx("span",{className:"text-2xl sm:text-3xl font-bold text-white",children:l})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:t.username}),n.jsx("p",{className:"text-gray-600 mt-1",children:t.email||"No email provided"})]})]}),n.jsxs("div",{className:"bg-white rounded-lg px-4 py-2 shadow-sm",children:[n.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Profile Type"}),n.jsx("div",{className:"font-bold text-gray-900",children:t.profile_type||""})]})]})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Details"}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsx("div",{className:"bg-white rounded-lg p-5 shadow-md hover:shadow-lg transition-shadow",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:n.jsx(Lu,{className:"w-5 h-5 text-blue-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Account"}),n.jsxs("div",{className:"text-gray-900 font-medium truncate",children:["ID: ",t.id]})]})]})}),n.jsx("div",{className:"bg-white rounded-lg p-5 shadow-md hover:shadow-lg transition-shadow",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0",children:n.jsx(Jv,{className:"w-5 h-5 text-emerald-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Email"}),n.jsx("div",{className:"text-gray-900 font-medium truncate",children:t.email||""})]})]})}),n.jsx("div",{className:"bg-white rounded-lg p-5 shadow-md hover:shadow-lg transition-shadow",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:n.jsx(_B,{className:"w-5 h-5 text-purple-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Roles"}),n.jsx("div",{className:"text-gray-900 font-medium truncate",children:(t.roles||[]).join(", ")||""})]})]})}),n.jsx("div",{className:"bg-white rounded-lg p-5 shadow-md hover:shadow-lg transition-shadow",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0",children:n.jsx(FR,{className:"w-5 h-5 text-orange-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Department"}),n.jsx("div",{className:"text-gray-900 font-medium truncate",children:t.profile&&t.profile.department&&(t.profile.department.short_name||t.profile.department.code)||""})]})]})}),n.jsx("div",{className:"bg-white rounded-lg p-5 shadow-md hover:shadow-lg transition-shadow",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:n.jsx(CR,{className:"w-5 h-5 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Designation"}),n.jsx("div",{className:"text-gray-900 font-medium truncate",children:t.profile&&t.profile.designation||""})]})]})}),n.jsx("div",{className:"bg-white rounded-lg p-5 shadow-md hover:shadow-lg transition-shadow",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center flex-shrink-0",children:n.jsx(wB,{className:"w-5 h-5 text-pink-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-gray-500 mb-1",children:"College"}),n.jsx("div",{className:"text-gray-900 font-medium truncate",children:t.college&&(t.college.short_name||t.college.name)||""})]})]})})]})]})]})})}function jp({children:e}){return n.jsx(Bf,{children:n.jsx("div",{className:"flex flex-col w-full max-w-full overflow-x-hidden",children:e})})}function gJ(){const[e,t]=v.useState([]),[r,s]=v.useState(!0),[a,i]=v.useState(null),o=Ji(),l=Ri(),c=e&&e.length?Array.from(new Set(e.map(m=>m.regulation))):[],d=e&&e.length?Array.from(new Set(e.map(m=>m.semester))).sort((m,w)=>m-w):[],[u,h]=v.useState(c.length===1?c[0]:c[0]??null),[p,f]=v.useState(d.length===1?d[0]:d[0]??null);v.useEffect(()=>{const m=e&&e.length?Array.from(new Set(e.map(S=>S.regulation))):[];m.length===1?h(m[0]):m.includes(u||"")||h(m[0]??null);const w=e&&e.length?Array.from(new Set(e.map(S=>S.semester))).sort((S,k)=>S-k):[];w.length===1?f(w[0]):w.includes(p||-1)||f(w[0]??null)},[e]),v.useEffect(()=>{jc().then(m=>t(m)).catch(m=>console.error(m)).finally(()=>s(!1))},[]);function x(m){if(m==null)return"";const w=String(m);return w.includes(",")||w.includes('"')||w.includes(`
`)?'"'+w.replace(/"/g,'""')+'"':w}function g(){const m=e.filter(C=>(!u||C.regulation===u)&&(!p||C.semester===p)&&C.editable===!0);if(!m.length){alert("No editable subjects in current view");return}const S=[["regulation","semester","course_code","course_name","category","class_type","l","t","p","s","c","internal_mark","external_mark","for_all_departments","editable","departments"].join(",")];for(const C of m){const O=C.for_all_departments?"":(C.departments_display||[]).map(W=>W.short_name||W.shortname||W.code||W.name).join(","),T=[C.regulation,C.semester,C.course_code||"",C.course_name||"",C.category||"",C.class_type||"",C.l??0,C.t??0,C.p??0,C.s??0,C.c??0,C.internal_mark??"",C.external_mark??"",C.for_all_departments?"True":"False",C.editable?"True":"False",O];S.push(T.map(x).join(","))}const k=new Blob([S.join(`
`)],{type:"text/csv"}),F=URL.createObjectURL(k),L=document.createElement("a");L.href=F,L.download=`department_curriculum_editable_${u||"all"}_${p||"all"}.csv`,document.body.appendChild(L),L.click(),L.remove(),URL.revokeObjectURL(F)}async function y(m){const w=m.target.files&&m.target.files[0];if(w){if(!confirm(`Upload ${w.name} to import masters?`)){m.currentTarget.value="";return}try{const S=new FormData;S.append("csv_file",w,w.name);const k=await hr("/api/curriculum/master/import/",{method:"POST",body:S});if(k.status===401){alert("Your session has expired. Please refresh the page and try again.");return}if(k.ok)alert("Import request submitted; refresh to see changes."),s(!0),jc().then(F=>t(F)).catch(()=>{}).finally(()=>s(!1));else{let F="";try{F=await k.text()}catch{F=k.statusText}alert("Import failed: "+(F||k.statusText))}}catch(S){console.error(S),alert("Import failed: "+(S.message||S))}try{const S=document.getElementById("master-import-file");S&&(S.value="")}catch{}}}return v.useEffect(()=>{const m=o.state;m&&m.savedMessage&&(i(m.savedMessage),l(location.pathname,{replace:!0,state:{}}),setTimeout(()=>i(null),2500))},[o,l]),r?n.jsx(jp,{children:n.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600",children:"Loading masters"})]})})}):n.jsx(jp,{children:n.jsxs("div",{className:"px-4 pb-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center flex-shrink-0",children:n.jsx(va,{className:"w-6 h-6 text-indigo-600"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Master Curriculum"}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View and manage all master curriculum entries."})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[(()=>{try{const m=JSON.parse(localStorage.getItem("roles")||"[]");if(Array.isArray(m)&&m.some(S=>String(S).toLowerCase()==="iqac"))return n.jsx(sa,{to:"/curriculum/master/new",className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all duration-200 shadow-sm hover:shadow-md",children:"New Master"})}catch{}return null})(),n.jsxs("button",{onClick:()=>g(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[n.jsx(h1,{className:"w-4 h-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Download"})]}),n.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-all duration-200 shadow-sm hover:shadow-md cursor-pointer",children:[n.jsx(m1,{className:"w-4 h-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Import CSV"}),n.jsx("input",{id:"master-import-file",type:"file",accept:".csv",className:"hidden",onChange:m=>y(m)})]})]})]}),c.length>0&&n.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6 bg-white rounded-lg shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Regulation:"}),n.jsx("select",{value:u??"",onChange:m=>h(m.target.value||null),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",children:c.map(m=>n.jsx("option",{value:m,children:m},m))})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Semester:"}),n.jsx("select",{value:p??"",onChange:m=>f(m.target.value?Number(m.target.value):null),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",children:d.map(m=>n.jsx("option",{value:m,children:m},m))})]})]}),a&&n.jsx("div",{className:"mb-4 inline-block bg-green-100 text-green-800 px-4 py-2 rounded-lg font-semibold",children:a}),n.jsx("div",{className:"w-full overflow-x-auto bg-white rounded-lg shadow-md",children:n.jsxs("table",{className:"w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"Code"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"Course"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"CAT"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"Class"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"Elective"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"L"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"T"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"P"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"S"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"C"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"INT"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"EXT"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"TTL"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"Depts"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"Editable"}),n.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.filter(m=>(!u||m.regulation===u)&&(!p||m.semester===p)).length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:16,className:"px-4 py-8 text-center text-gray-500",children:"No curriculum entries found for the selected filters."})}):e.filter(m=>(!u||m.regulation===u)&&(!p||m.semester===p)).map(m=>n.jsxs("tr",{className:`hover:bg-gray-50 transition-colors ${m.editable?"bg-blue-50/30":""}`,children:[n.jsx("td",{className:"px-3 py-3 text-sm text-gray-900 whitespace-nowrap",children:m.course_code||"-"}),n.jsx("td",{className:"px-3 py-3 text-sm text-gray-900 font-medium min-w-[200px]",children:m.course_name||"-"}),n.jsx("td",{className:"px-3 py-3 text-sm text-gray-700 whitespace-nowrap",children:m.category||"-"}),n.jsx("td",{className:"px-3 py-3 text-sm text-gray-700 whitespace-nowrap",children:m.class_type||"-"}),n.jsx("td",{className:"px-3 py-3 text-sm text-center whitespace-nowrap",children:m.is_elective?n.jsx("span",{className:"text-green-700 font-semibold",children:"Yes"}):n.jsx("span",{className:"text-gray-400",children:"No"})}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 whitespace-nowrap",children:m.l??0}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 whitespace-nowrap",children:m.t??0}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 whitespace-nowrap",children:m.p??0}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 whitespace-nowrap",children:m.s??0}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 whitespace-nowrap",children:m.c??0}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 whitespace-nowrap",children:m.internal_mark??"-"}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 whitespace-nowrap",children:m.external_mark??"-"}),n.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-900 font-semibold whitespace-nowrap",children:m.total_mark??"-"}),n.jsx("td",{className:"px-3 py-3 text-sm text-gray-700 whitespace-nowrap",children:m.for_all_departments?"ALL":m.departments_display&&m.departments_display.length>0?m.departments_display.map(w=>w.short_name||w.shortname||w.code||w.name).join(", "):"No Depts"}),n.jsx("td",{className:"px-3 py-3 text-sm text-center whitespace-nowrap",children:m.editable?n.jsx("span",{className:"text-green-700 font-semibold",children:"Yes"}):n.jsx("span",{className:"text-gray-400",children:"No"})}),n.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx(sa,{to:`/curriculum/master/${m.id}`,className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:n.jsx(_d,{className:"w-4 h-4"})}),m.status==="PENDING"&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 text-green-600 hover:bg-green-50 text-xs font-medium rounded-lg transition-colors",children:"Approve"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-red-600 hover:bg-red-50 text-xs font-medium rounded-lg transition-colors",children:"Reject"})]})]})})]},m.id))})]})})]})})}function S4(){const{id:e}=g0(),t=e??(window.location.pathname.endsWith("/new")?"new":void 0),r=Ri(),[s,a]=v.useState({regulation:"",semester:1,for_all_departments:!0,editable:!1,is_elective:!1}),[i,o]=v.useState(!1),[l,c]=v.useState([]),[d,u]=v.useState(null);v.useEffect(()=>{t&&t!=="new"&&(o(!0),jc().then(p=>{const f=p.find(x=>String(x.id)===String(t));f&&a(f)}).finally(()=>o(!1)))},[t]),v.useEffect(()=>{vo().then(p=>{const f=new Map;p.forEach(x=>f.set(x.department.id,x.department)),c(Array.from(f.values()))}).catch(()=>c([]))},[]);async function h(){o(!0);try{if(!s.regulation)throw new Error("Regulation is required");if(!s.semester||s.semester<=0)throw new Error("Semester must be a positive number");if(!s.course_name)throw new Error("Course Name is required");if(s.internal_mark!==""&&s.internal_mark!=null&&s.internal_mark<0||s.external_mark!==""&&s.external_mark!=null&&s.external_mark<0)throw new Error("Marks cannot be negative");const p={...s};if(s.for_all_departments?p.departments=[]:p.departments=Array.isArray(s.departments)?s.departments:[],p.internal_mark=s.internal_mark===""||s.internal_mark==null?0:Number(s.internal_mark),p.external_mark=s.external_mark===""||s.external_mark==null?0:Number(s.external_mark),p.course_code=s.course_code===""||s.course_code==null?null:s.course_code,t==="new"){const f=await gP(p);r("/curriculum/master",{state:{savedMessage:"Saved",newId:f.id}})}else{const f=Number(t);if(Number.isNaN(f))throw new Error("Invalid master id");const x=await yP(f,p);a(x),u("Saved"),setTimeout(()=>u(null),2500)}}catch(p){alert(`Error: ${p.message}`)}finally{o(!1)}}return n.jsxs(jp,{children:[n.jsxs("div",{className:"px-2 sm:px-4 pb-4",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-indigo-100 rounded-xl flex items-center justify-center flex-shrink-0",children:n.jsx(va,{className:"w-5 h-5 sm:w-6 sm:h-6 text-indigo-600"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:e==="new"?"New Master":"Edit Master"}),n.jsx("p",{className:"text-gray-600 text-xs sm:text-sm mt-1",children:e==="new"?"Create a new master curriculum entry.":"Edit the selected master curriculum entry."})]})]}),n.jsxs("form",{onSubmit:p=>{p.preventDefault(),h()},className:"bg-white rounded-lg shadow-md p-3 sm:p-4 lg:p-6 space-y-4",autoComplete:"off",children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"Regulation"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",value:s.regulation||"",onChange:p=>a({...s,regulation:p.target.value}),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"Semester"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",type:"number",min:1,value:s.semester||1,onChange:p=>a({...s,semester:Number(p.target.value)}),required:!0})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"Course Code"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",value:s.course_code??"",onChange:p=>a({...s,course_code:p.target.value}),placeholder:"Optional"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"Course Name"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",value:s.course_name||"",onChange:p=>a({...s,course_name:p.target.value}),required:!0})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"CAT"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",value:s.category||"",onChange:p=>a({...s,category:p.target.value}),placeholder:"e.g. CORE"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"Class"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",value:s.class_type||"",onChange:p=>a({...s,class_type:p.target.value}),placeholder:"e.g. Theory"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"L"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-sm",type:"number",min:0,value:s.l||0,onChange:p=>a({...s,l:Number(p.target.value)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"T"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-sm",type:"number",min:0,value:s.t||0,onChange:p=>a({...s,t:Number(p.target.value)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"P"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-sm",type:"number",min:0,value:s.p||0,onChange:p=>a({...s,p:Number(p.target.value)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"S"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-sm",type:"number",min:0,value:s.s||0,onChange:p=>a({...s,s:Number(p.target.value)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"C"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-sm",type:"number",min:0,value:s.c||0,onChange:p=>a({...s,c:Number(p.target.value)})})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"Internal Mark"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",type:"number",min:0,value:s.internal_mark??"",onChange:p=>a({...s,internal_mark:p.target.value===""?"":Number(p.target.value)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"External Mark"}),n.jsx("input",{className:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",type:"number",min:0,value:s.external_mark??"",onChange:p=>a({...s,external_mark:p.target.value===""?"":Number(p.target.value)})})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[n.jsx("input",{type:"checkbox",checked:!!s.for_all_departments,onChange:p=>a({...s,for_all_departments:p.target.checked}),id:"forAllDepts",className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"forAllDepts",className:"text-xs sm:text-sm font-semibold text-indigo-900",children:"For All Departments"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-indigo-900 mb-1",children:"Departments"}),s.for_all_departments?n.jsx("div",{className:"text-gray-600 text-xs sm:text-sm p-2 bg-gray-50 rounded-lg",children:"Applies to all departments"}):n.jsxs("div",{className:"max-h-32 overflow-y-auto p-2 border border-gray-300 rounded-lg bg-white",children:[l.length===0&&n.jsx("div",{className:"text-gray-400 text-xs",children:"No departments available"}),l.map(p=>n.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[n.jsx("input",{type:"checkbox",checked:Array.isArray(s.departments)?s.departments.includes(p.id):!1,onChange:f=>{const x=Array.isArray(s.departments)?[...s.departments]:[];if(f.target.checked)x.includes(p.id)||x.push(p.id);else{const g=x.indexOf(p.id);g>=0&&x.splice(g,1)}a({...s,departments:x})},id:`dept-${p.id}`,className:"w-3.5 h-3.5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),n.jsxs("label",{htmlFor:`dept-${p.id}`,className:"text-xs sm:text-sm text-gray-700",children:[p.code,"  ",p.name]})]},p.id))]})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[n.jsx("input",{type:"checkbox",checked:!!s.editable,onChange:p=>a({...s,editable:p.target.checked}),id:"editable",className:"w-3.5 h-3.5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"editable",className:"text-xs sm:text-sm font-semibold text-indigo-900",children:"Editable"})]}),n.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[n.jsx("input",{type:"checkbox",checked:!!s.is_elective,onChange:p=>a({...s,is_elective:p.target.checked}),id:"is_elective",className:"w-3.5 h-3.5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"is_elective",className:"text-xs sm:text-sm font-semibold text-indigo-900",children:"Is Elective"})]})]}),d&&n.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-1.5 rounded-lg font-semibold text-sm inline-block",children:d}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[n.jsxs("button",{type:"submit",className:"flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed text-sm",disabled:i,children:[n.jsx(kc,{className:"w-4 h-4"}),i?"Saving":"Save"]}),n.jsxs("button",{type:"button",className:"flex items-center justify-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors text-sm",onClick:()=>r("/curriculum/master"),children:[n.jsx(Qo,{className:"w-4 h-4"}),"Cancel"]})]})]})]}),n.jsxs("form",{onSubmit:p=>{p.preventDefault(),h()},style:{background:"#fff",borderRadius:10,boxShadow:"0 2px 8px #e5e7eb",padding:32,maxWidth:700,margin:"0 auto",display:"grid",gap:22},autoComplete:"off",children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"Regulation"}),n.jsx("input",{className:"input",value:s.regulation||"",onChange:p=>a({...s,regulation:p.target.value}),required:!0,style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"Semester"}),n.jsx("input",{className:"input",type:"number",min:1,value:s.semester||1,onChange:p=>a({...s,semester:Number(p.target.value)}),required:!0,style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"Course Code"}),n.jsx("input",{className:"input",value:s.course_code??"",onChange:p=>a({...s,course_code:p.target.value}),placeholder:"Optional",style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"Course Name"}),n.jsx("input",{className:"input",value:s.course_name||"",onChange:p=>a({...s,course_name:p.target.value}),required:!0,style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"CAT"}),n.jsx("input",{className:"input",value:s.category||"",onChange:p=>a({...s,category:p.target.value}),placeholder:"e.g. CORE",style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"Class"}),n.jsxs("select",{className:"input",value:s.class_type||"",onChange:p=>a({...s,class_type:p.target.value}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4},children:[n.jsx("option",{value:"",children:"Select class type"}),Lf.map(p=>{const f=On(String(p)),x=String(p).charAt(0).toUpperCase()+String(p).slice(1);return n.jsx("option",{value:f,children:x},f)})]})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:18},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"L"}),n.jsx("input",{className:"input",type:"number",min:0,value:s.l||0,onChange:p=>a({...s,l:Number(p.target.value)}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"T"}),n.jsx("input",{className:"input",type:"number",min:0,value:s.t||0,onChange:p=>a({...s,t:Number(p.target.value)}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"P"}),n.jsx("input",{className:"input",type:"number",min:0,value:s.p||0,onChange:p=>a({...s,p:Number(p.target.value)}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"S"}),n.jsx("input",{className:"input",type:"number",min:0,value:s.s||0,onChange:p=>a({...s,s:Number(p.target.value)}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"C"}),n.jsx("input",{className:"input",type:"number",min:0,value:s.c||0,onChange:p=>a({...s,c:Number(p.target.value)}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"Internal Mark"}),n.jsx("input",{className:"input",type:"number",min:0,value:s.internal_mark??"",onChange:p=>a({...s,internal_mark:p.target.value===""?"":Number(p.target.value)}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"External Mark"}),n.jsx("input",{className:"input",type:"number",min:0,value:s.external_mark??"",onChange:p=>a({...s,external_mark:p.target.value===""?"":Number(p.target.value)}),style:{width:"100%",padding:"8px",borderRadius:6,border:"1px solid #d1d5db",marginTop:4}})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginTop:8},children:[n.jsx("input",{type:"checkbox",checked:!!s.for_all_departments,onChange:p=>a({...s,for_all_departments:p.target.checked}),id:"forAllDepts"}),n.jsx("label",{htmlFor:"forAllDepts",style:{fontWeight:600,color:"#3730a3",marginBottom:0},children:"For All Departments"})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontWeight:600,color:"#3730a3"},children:"Departments"}),s.for_all_departments?n.jsx("div",{style:{marginTop:6,color:"#6b7280"},children:"Applies to all departments"}):n.jsxs("div",{style:{marginTop:6,maxHeight:220,overflowY:"auto",padding:6,border:"1px solid #e5e7eb",borderRadius:6},children:[l.length===0&&n.jsx("div",{style:{color:"#9ca3af"},children:"No departments available"}),l.map(p=>n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[n.jsx("input",{type:"checkbox",checked:Array.isArray(s.departments)?s.departments.includes(p.id):!1,onChange:f=>{const x=Array.isArray(s.departments)?[...s.departments]:[];if(f.target.checked)x.includes(p.id)||x.push(p.id);else{const g=x.indexOf(p.id);g>=0&&x.splice(g,1)}a({...s,departments:x})},id:`dept-${p.id}`}),n.jsxs("label",{htmlFor:`dept-${p.id}`,style:{marginBottom:0},children:[p.code,"  ",p.name]})]},p.id))]})]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginTop:8},children:[n.jsx("input",{type:"checkbox",checked:!!s.editable,onChange:p=>a({...s,editable:p.target.checked}),id:"editable"}),n.jsx("label",{htmlFor:"editable",style:{fontWeight:600,color:"#3730a3",marginBottom:0},children:"Editable"})]}),d&&n.jsx("div",{style:{background:"#ecfccb",color:"#365314",padding:"8px 12px",borderRadius:8,fontWeight:600,display:"inline-block"},children:d}),n.jsxs("div",{style:{display:"flex",gap:10,marginTop:8},children:[n.jsx("button",{type:"submit",className:"btn-primary",style:{padding:"6px 18px",borderRadius:8,fontWeight:600,fontSize:16,minWidth:100},disabled:i,children:i?"Saving":"Save"}),n.jsx("button",{type:"button",className:"btn-secondary",style:{padding:"6px 18px",borderRadius:8,fontWeight:600,fontSize:16,minWidth:100},onClick:()=>r("/curriculum/master"),children:"Cancel"})]})]})]})}function yJ(){const[e,t]=v.useState([]),[r,s]=v.useState(!0),a=e&&e.length?Array.from(new Set(e.map(R=>R.regulation))):[],i=e&&e.length?Array.from(new Set(e.map(R=>R.semester))).sort((R,q)=>R-q):[],[o,l]=v.useState(a.length===1?a[0]:a[0]??null),[c,d]=v.useState(i.length===1?i[0]:i[0]??null),u=e&&e.length?Array.from(new Set(e.map(R=>R.department.id))):[];v.useEffect(()=>{const R=e&&e.length?Array.from(new Set(e.map(me=>me.regulation))):[];R.length===1?l(R[0]):R.includes(o||"")||l(R[0]??null);const q=e&&e.length?Array.from(new Set(e.map(me=>me.semester))).sort((me,fe)=>me-fe):[];q.length===1?d(q[0]):q.includes(c||-1)||d(q[0]??null)},[e]),v.useEffect(()=>{vo().then(R=>t(R)).catch(console.error).finally(()=>s(!1))},[]);async function h(R){try{const q=await vP(R.id,R);t(me=>me.map(fe=>fe.id===q.id?q:fe)),f(null),alert("Row updated successfully")}catch(q){alert(String(q))}}const[p,f]=v.useState(null),x=(()=>{try{return JSON.parse(localStorage.getItem("permissions")||"[]")}catch{return[]}})(),g=Array.isArray(x)&&(x.includes("curriculum.department.approve")||x.includes("CURRICULUM_DEPARTMENT_APPROVE"));async function y(R,q){try{await wP(R,q);const me=await vo();t(me),alert("OK")}catch(me){alert(String(me))}}const[m,w]=v.useState(null);v.useEffect(()=>{u.length===1?w(u[0]):u.includes(m||-1)||w(u[0]??null)},[e]);const S=e.filter(R=>R.is_elective&&(!m||R.department.id===m)&&(!o||R.regulation===o)&&(!c||R.semester===c)),[k,F]=v.useState([]);v.useEffect(()=>{qf({department_id:m??void 0,regulation:o??void 0,semester:c??void 0}).then(F).catch(()=>F([]))},[m,o,c,e]);const[L,C]=v.useState(!1),[O,T]=v.useState({parent:null,department_id:m||null,regulation:o||null,semester_id:c||null,course_code:"",course_name:"",class_type:"THEORY",category:"",is_elective:!0,l:0,t:0,p:0,s:0,c:0,internal_mark:null,external_mark:null,total_mark:null,total_hours:null,question_paper_type:"",editable:!1});function W(R){T(q=>({...q,parent:R.id,department_id:m||q.department_id,regulation:o||q.regulation,semester_id:c||q.semester_id,course_name:"",course_code:""})),C(!0)}async function A(){try{const R={...O};if(!R.parent)throw new Error("Parent curriculum id missing");R.course_code||delete R.course_code,R.course_name||delete R.course_name,await bP(R);const q=await vo();t(q);const me=await qf({department_id:m??void 0,regulation:o??void 0,semester:c??void 0});F(me),C(!1),alert("Elective subject added")}catch(R){alert(String(R))}}const[N,P]=v.useState(!1),[K,re]=v.useState(null);function ge(R){re({...R}),P(!0)}async function Fe(){if(!(!K||!K.id))try{const R=await hr(`/api/curriculum/elective/${K.id}/`,{method:"PATCH",body:JSON.stringify(K)});if(!R.ok)throw new Error(await R.text());const q=await vo();t(q);const me=await qf({department_id:m??void 0,regulation:o??void 0,semester:c??void 0});F(me),P(!1),alert("Elective updated")}catch(R){alert(String(R))}}return r?n.jsx(jp,{children:n.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600",children:"Loading department curriculum"})]})})}):n.jsx(jp,{children:n.jsxs("div",{className:"px-4 pb-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center flex-shrink-0",children:n.jsxs("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 48 48",children:[n.jsx("rect",{width:"48",height:"48",rx:"12",fill:"#e0e7ff"}),n.jsx("path",{d:"M16 32V16h16v16H16zm2-2h12V18H18v12zm2-2v-8h8v8h-8z",fill:"#6366f1"})]})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Department Curriculum"}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View and manage department-specific curriculum entries."})]})]}),a.length>0&&n.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6 bg-white rounded-lg shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Regulation:"}),n.jsx("select",{value:o??"",onChange:R=>l(R.target.value||null),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",children:a.map(R=>n.jsx("option",{value:R,children:R},R))})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Semester:"}),n.jsx("select",{value:c??"",onChange:R=>d(R.target.value?Number(R.target.value):null),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",children:i.map(R=>n.jsx("option",{value:R,children:R},R))})]})]}),n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Filter by Department"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(R=>{var E;const q=m===R,me=(E=e.find(U=>U.department.id===R))==null?void 0:E.department,fe=(me==null?void 0:me.short_name)||(me==null?void 0:me.shortname)||(me==null?void 0:me.code)||(me==null?void 0:me.name)||`Dept ${R}`;return n.jsx("button",{onClick:()=>w(R),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${q?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:fe},R)})})]}),n.jsx("div",{className:"w-full overflow-x-auto bg-white rounded-lg shadow-md",children:n.jsxs("table",{className:"w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-indigo-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"Code"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap min-w-[200px]",children:"Course"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"CAT"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"Class"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"Elective"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"L"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"T"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"P"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"S"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"C"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"INT"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"EXT"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"TTL"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"Hours"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"QP Type"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"Editable"}),n.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-indigo-900 uppercase tracking-wider whitespace-nowrap",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.filter(R=>(!m||R.department.id===m)&&(!o||R.regulation===o)&&(!c||R.semester===c)).map(R=>n.jsx("tr",{className:`hover:bg-gray-50 transition-colors ${R.editable?"bg-slate-50":""}`,children:p===R.id?n.jsxs(n.Fragment,{children:[n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{value:R.course_code||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,course_code:q.target.value}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx("textarea",{value:R.course_name||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,course_name:q.target.value}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",style:{minHeight:"32px"},placeholder:"Course Name",rows:1,onInput:q=>{const me=q.target;me.style.height="32px",me.style.height=me.scrollHeight+"px"}})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{value:R.category||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,category:q.target.value}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 edit-cell-input"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("select",{value:R.class_type||"THEORY",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,class_type:q.target.value}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 edit-cell-input",style:{minWidth:90},children:Lf.map(q=>{const me=On(String(q)),fe=String(q).charAt(0).toUpperCase()+String(q).slice(1).toLowerCase();return n.jsx("option",{value:me,children:fe},me)})})}),n.jsx("td",{className:"px-3 py-2 text-center whitespace-nowrap",children:n.jsx("input",{type:"checkbox",checked:!!R.is_elective,onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,is_elective:q.target.checked}:fe)),className:"w-4 h-4"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.l||0,onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,l:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.t||0,onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,t:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.p||0,onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,p:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.s||0,onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,s:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.c||0,onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,c:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.internal_mark||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,internal_mark:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.external_mark||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,external_mark:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.total_mark||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,total_mark:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{type:"number",value:R.total_hours||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,total_hours:Number(q.target.value)}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsx("input",{value:R.question_paper_type||"",onChange:q=>t(me=>me.map(fe=>fe.id===R.id?{...fe,question_paper_type:q.target.value}:fe)),className:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:R.editable?n.jsx("span",{className:"text-emerald-600 font-semibold",children:"Yes"}):n.jsx("span",{className:"text-gray-400",children:"No"})}),n.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[n.jsx("button",{className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors mr-2",onClick:()=>h(R),title:"Save",children:n.jsx(kc,{className:"w-4 h-4"})}),n.jsx("button",{className:"p-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>f(null),title:"Cancel",children:n.jsx(Qo,{className:"w-4 h-4"})})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.course_code||"-"}),n.jsx("td",{className:"px-3 py-2.5 text-sm text-gray-900 font-medium",children:R.course_name||"-"}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.category||"-"}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.class_type||"-"}),n.jsx("td",{className:"px-3 py-2.5 text-center whitespace-nowrap text-sm",children:R.is_elective?n.jsx("span",{className:"text-emerald-600 font-semibold",children:"Yes"}):n.jsx("span",{className:"text-gray-400",children:"No"})}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.l??0}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.t??0}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.p??0}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.s??0}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.c??0}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.internal_mark??"-"}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.external_mark??"-"}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.total_mark??"-"}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.total_hours??"-"}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.question_paper_type||"-"}),n.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap text-sm",children:R.editable?n.jsx("span",{className:"text-emerald-600 font-semibold",children:"Yes"}):n.jsx("span",{className:"text-gray-400",children:"No"})}),n.jsxs("td",{className:"px-3 py-2.5 whitespace-nowrap",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[R.editable?n.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",onClick:()=>f(R.id),title:"Edit",children:n.jsx(_d,{className:"w-4 h-4"})}):n.jsx("div",{className:"w-8 h-8"}),g&&R.approval_status==="PENDING"?n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>y(R.id,"approve"),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Approve",children:n.jsx(IR,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>y(R.id,"reject"),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Reject",children:n.jsx(Qo,{className:"w-4 h-4"})})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-8 h-8"}),n.jsx("div",{className:"w-8 h-8"})]})]}),n.jsxs("div",{className:"text-xs mt-1 text-gray-600",children:["Status: ",n.jsx("strong",{className:"text-gray-900",children:R.approval_status||"APPROVED"})]})]})]})},R.id))})]})}),n.jsxs("div",{className:"mt-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Elective Options"}),S.length===0?n.jsx("div",{className:"text-gray-400 py-4",children:"No elective options for selected department/semester."}):n.jsx("div",{className:"space-y-6",children:S.map(R=>{const q=k.filter(me=>me.parent===R.id);return n.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("div",{className:"text-lg font-bold text-gray-900",children:R.course_name||R.course_code||"Elective"}),n.jsx("button",{onClick:()=>W(R),className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors",children:"Add Subject"})]}),n.jsx("div",{className:"w-full overflow-x-auto",children:n.jsxs("table",{className:"w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"Code"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"Course"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"CAT"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"Class"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"L"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"T"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"P"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"S"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"C"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"INT"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"EXT"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"TTL"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"Hours"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"QP Type"}),n.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:q.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:15,className:"px-3 py-4 text-gray-400 text-center",children:"No subjects added yet."})}):q.map(me=>n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.course_code||"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.course_name||"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.category||"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.class_type||"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.l??0}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.t??0}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.p??0}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.s??0}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.c??0}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.internal_mark??"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.external_mark??"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.total_mark??"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.total_hours??"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:me.question_paper_type||"-"}),n.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm",children:me.editable?n.jsx("span",{className:"text-emerald-600 font-semibold",children:"Yes"}):n.jsx("span",{className:"text-gray-400",children:"No"})}),n.jsx("button",{onClick:()=>ge(me),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:n.jsx(_d,{className:"w-4 h-4"})})]})})]},me.id))})]})})]},R.id)})})]}),L&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:n.jsxs("div",{className:"w-full max-w-3xl mx-4 bg-white rounded-lg shadow-2xl p-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Add Elective Subject"}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Course Name"}),n.jsx("input",{value:O.course_name||"",onChange:R=>T(q=>({...q,course_name:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Course Code"}),n.jsx("input",{value:O.course_code||"",onChange:R=>T(q=>({...q,course_code:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Class Type"}),n.jsxs("select",{value:O.class_type,onChange:R=>T(q=>({...q,class_type:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"THEORY",children:"THEORY"}),n.jsx("option",{value:"LAB",children:"LAB"}),n.jsx("option",{value:"TCPL",children:"TCPL"}),n.jsx("option",{value:"TCPR",children:"TCPR"}),n.jsx("option",{value:"PRACTICAL",children:"PRACTICAL"}),n.jsx("option",{value:"AUDIT",children:"AUDIT"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Category"}),n.jsx("input",{value:O.category||"",onChange:R=>T(q=>({...q,category:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"L"}),n.jsx("input",{type:"number",value:O.l??0,onChange:R=>T(q=>({...q,l:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"T"}),n.jsx("input",{type:"number",value:O.t??0,onChange:R=>T(q=>({...q,t:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"P"}),n.jsx("input",{type:"number",value:O.p??0,onChange:R=>T(q=>({...q,p:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"S"}),n.jsx("input",{type:"number",value:O.s??0,onChange:R=>T(q=>({...q,s:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"C"}),n.jsx("input",{type:"number",value:O.c??0,onChange:R=>T(q=>({...q,c:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Internal Mark"}),n.jsx("input",{type:"number",value:O.internal_mark??"",onChange:R=>T(q=>({...q,internal_mark:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"External Mark"}),n.jsx("input",{type:"number",value:O.external_mark??"",onChange:R=>T(q=>({...q,external_mark:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Total Mark"}),n.jsx("input",{type:"number",value:O.total_mark??"",onChange:R=>T(q=>({...q,total_mark:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Total Hours"}),n.jsx("input",{type:"number",value:O.total_hours??"",onChange:R=>T(q=>({...q,total_hours:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{className:"col-span-2",children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Question Paper Type"}),n.jsx("input",{value:O.question_paper_type||"",onChange:R=>T(q=>({...q,question_paper_type:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{id:"add-editable",type:"checkbox",checked:!!O.editable,onChange:R=>T(q=>({...q,editable:R.target.checked})),className:"w-4 h-4"}),n.jsx("label",{htmlFor:"add-editable",className:"text-sm font-medium text-gray-700",children:"Editable"})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 hover:bg-gray-50 font-medium transition-colors",children:"Cancel"}),n.jsx("button",{onClick:A,className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors",children:"Save"})]})]})}),N&&K&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:n.jsxs("div",{className:"w-full max-w-3xl mx-4 bg-white rounded-lg shadow-2xl p-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Edit Elective Subject"}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Course Name"}),n.jsx("input",{value:K.course_name||"",onChange:R=>re(q=>({...q,course_name:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Course Code"}),n.jsx("input",{value:K.course_code||"",onChange:R=>re(q=>({...q,course_code:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Class Type"}),n.jsxs("select",{value:K.class_type||"THEORY",onChange:R=>re(q=>({...q,class_type:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"THEORY",children:"THEORY"}),n.jsx("option",{value:"LAB",children:"LAB"}),n.jsx("option",{value:"TCPL",children:"TCPL"}),n.jsx("option",{value:"TCPR",children:"TCPR"}),n.jsx("option",{value:"PRACTICAL",children:"PRACTICAL"}),n.jsx("option",{value:"AUDIT",children:"AUDIT"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Category"}),n.jsx("input",{value:K.category||"",onChange:R=>re(q=>({...q,category:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"L"}),n.jsx("input",{type:"number",value:K.l??0,onChange:R=>re(q=>({...q,l:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"T"}),n.jsx("input",{type:"number",value:K.t??0,onChange:R=>re(q=>({...q,t:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"P"}),n.jsx("input",{type:"number",value:K.p??0,onChange:R=>re(q=>({...q,p:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"S"}),n.jsx("input",{type:"number",value:K.s??0,onChange:R=>re(q=>({...q,s:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"C"}),n.jsx("input",{type:"number",value:K.c??0,onChange:R=>re(q=>({...q,c:Number(R.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Internal Mark"}),n.jsx("input",{type:"number",value:K.internal_mark??"",onChange:R=>re(q=>({...q,internal_mark:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"External Mark"}),n.jsx("input",{type:"number",value:K.external_mark??"",onChange:R=>re(q=>({...q,external_mark:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Total Mark"}),n.jsx("input",{type:"number",value:K.total_mark??"",onChange:R=>re(q=>({...q,total_mark:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Total Hours"}),n.jsx("input",{type:"number",value:K.total_hours??"",onChange:R=>re(q=>({...q,total_hours:R.target.value?Number(R.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{className:"col-span-2",children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Question Paper Type"}),n.jsx("input",{value:K.question_paper_type||"",onChange:R=>re(q=>({...q,question_paper_type:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{id:"edit-editable",type:"checkbox",checked:!!K.editable,onChange:R=>re(q=>({...q,editable:R.target.checked})),className:"w-4 h-4"}),n.jsx("label",{htmlFor:"edit-editable",className:"text-sm font-medium text-gray-700",children:"Editable"})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx("button",{onClick:()=>P(!1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 hover:bg-gray-50 font-medium transition-colors",children:"Cancel"}),n.jsx("button",{onClick:Fe,className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors",children:"Save"})]})]})})]})})}function bJ(){const[e,t]=v.useState(null),[r,s]=v.useState(!1),[a,i]=v.useState(null),[o,l]=v.useState([]),[c,d]=v.useState([]),[u,h]=v.useState([]),[p,f]=v.useState(""),[x,g]=v.useState(""),[y,m]=v.useState(""),[w,S]=v.useState([]),[k,F]=v.useState(!1);v.useEffect(()=>{L()},[p,x,y]),v.useEffect(()=>{C()},[]);const L=async()=>{F(!0);try{const P={};p&&(P.regulation=p),x&&(P.semester=x),y&&(P.department_id=y);const K=await qf(P);S(K||[])}catch(P){console.error("Failed to load electives:",P),S([])}finally{F(!1)}},C=async()=>{try{const P=await qf();if(!P||!Array.isArray(P))return;const K=[...new Set(P.map(Fe=>Fe.regulation))].filter(Boolean).sort(),re=[...new Set(P.map(Fe=>Fe.semester))].filter(Boolean).sort((Fe,R)=>Fe-R),ge=Array.from(new Map(P.map(Fe=>Fe.department).filter(Boolean).map(Fe=>[Fe.id,Fe])).values()).sort((Fe,R)=>(Fe.code||"").localeCompare(R.code||""));l(K),d(re),h(ge)}catch(P){console.error("Failed to load filter options:",P)}},O=async()=>{try{const P=await hr("/api/curriculum/elective-choices/template/");if(!P.ok){alert("Failed to download template");return}const K=await P.blob(),re=window.URL.createObjectURL(K),ge=document.createElement("a");ge.href=re,ge.download="elective_choices_template.csv",document.body.appendChild(ge),ge.click(),window.URL.revokeObjectURL(re),document.body.removeChild(ge)}catch(P){console.error("Download error:",P),alert("Failed to download template")}},T=async()=>{try{const P=await hr("/api/curriculum/elective-choices/template/?format=excel");if(!P.ok){alert("Failed to download Excel template");return}const K=await P.blob(),re=window.URL.createObjectURL(K),ge=document.createElement("a");ge.href=re,ge.download="elective_choices_template.xlsx",document.body.appendChild(ge),ge.click(),window.URL.revokeObjectURL(re),document.body.removeChild(ge)}catch(P){console.error("Download error:",P),alert("Failed to download Excel template")}},W=P=>{var re;const K=(re=P.target.files)==null?void 0:re[0];if(K){if(![".csv",".xlsx",".xls"].some(R=>K.name.toLowerCase().endsWith(R))){alert("Please select a CSV or Excel file (.csv, .xlsx, .xls)");return}t(K),i(null)}},A=async()=>{if(!e){alert("Please select a file first");return}s(!0),i(null);try{const P=new FormData;P.append("csv_file",e);const K=await hr("/api/curriculum/elective-choices/import/",{method:"POST",body:P});if(K.status===401){alert("Your session has expired. Please refresh the page and try again.");return}let re;try{re=await K.json()}catch(ge){console.error("Failed to parse response:",ge),alert("Import failed: Invalid response from server");return}if(K.ok){i(re),t(null);const ge=document.getElementById("file-input");ge&&(ge.value=""),L()}else{const ge=re.error||re.detail||re.message||"Import failed";alert(typeof ge=="string"?ge:"Import failed: "+JSON.stringify(ge).substring(0,200))}}catch(P){console.error("Upload error:",P),alert("Failed to upload file. Please check your connection and try again.")}finally{s(!1)}},N=w.filter(P=>{var K;return!(p&&P.regulation!==p||x&&P.semester!==x||y&&((K=P.department)==null?void 0:K.id)!==y)});return n.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg",children:n.jsx(ZR,{className:"h-6 w-6 text-indigo-600"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Elective Import"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Import student elective choices from CSV or Excel"})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:O,className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors",children:[n.jsx(h1,{className:"h-5 w-5"}),"CSV Template"]}),n.jsxs("button",{onClick:T,className:"inline-flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white font-medium rounded-lg hover:bg-emerald-700 transition-colors",children:[n.jsx(h1,{className:"h-5 w-5"}),"Excel Template"]})]})]}),n.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload File"}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{children:n.jsxs("label",{htmlFor:"file-input",className:"flex flex-col items-center justify-center w-full h-24 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center",children:[n.jsx(m1,{className:"h-8 w-8 text-gray-400 mb-2"}),n.jsx("p",{className:"text-sm text-gray-600",children:e?n.jsx("span",{className:"font-medium text-indigo-600",children:e.name}):n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]})}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CSV or Excel files (.csv, .xlsx, .xls)"})]}),n.jsx("input",{id:"file-input",type:"file",className:"hidden",accept:".csv,.xlsx,.xls",onChange:W})]})}),n.jsxs("button",{onClick:A,disabled:!e||r,className:`w-full inline-flex items-center justify-center gap-2 px-6 py-3 font-medium rounded-lg transition-colors ${!e||r?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:[n.jsx(m1,{className:"h-5 w-5"}),r?"Uploading...":"Upload and Import"]})]})]}),a&&n.jsx("div",{className:`rounded-lg shadow-sm p-6 mb-6 ${a.errors&&a.errors.length>0?"bg-yellow-50 border border-yellow-200":"bg-green-50 border border-green-200"}`,children:n.jsxs("div",{className:"flex items-start gap-3",children:[a.errors&&a.errors.length>0?n.jsx(Wi,{className:"h-6 w-6 text-yellow-600 flex-shrink-0 mt-0.5"}):n.jsx(d1,{className:"h-6 w-6 text-green-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:`text-lg font-semibold mb-2 ${a.errors&&a.errors.length>0?"text-yellow-900":"text-green-900"}`,children:a.message}),n.jsxs("div",{className:`space-y-1 text-sm ${a.errors&&a.errors.length>0?"text-yellow-800":"text-green-800"}`,children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Created:"})," ",a.created," entries"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Updated:"})," ",a.updated," entries"]}),a.errors&&a.errors.length>0&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("p",{className:"font-semibold text-red-700 mb-2",children:["Errors (",a.errors.length,"):"]}),n.jsx("ul",{className:"list-disc list-inside space-y-1 text-red-600 max-h-40 overflow-y-auto",children:a.errors.map((P,K)=>n.jsx("li",{className:"text-xs",children:P},K))})]})]})]})]})}),n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(T6,{className:"h-5 w-5 text-gray-600"}),n.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Elective Subjects"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Regulation"}),n.jsxs("select",{value:p,onChange:P=>f(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[n.jsx("option",{value:"",children:"All Regulations"}),o.map(P=>n.jsx("option",{value:P,children:P},P))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Semester"}),n.jsxs("select",{value:x,onChange:P=>g(P.target.value?Number(P.target.value):""),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[n.jsx("option",{value:"",children:"All Semesters"}),c.map(P=>n.jsxs("option",{value:P,children:["Semester ",P]},P))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),n.jsxs("select",{value:y,onChange:P=>m(P.target.value?Number(P.target.value):""),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[n.jsx("option",{value:"",children:"All Departments"}),u.map(P=>n.jsxs("option",{value:P.id,children:[P.code," - ",P.short_name||P.name]},P.id))]})]})]}),k?n.jsx("div",{className:"text-center py-8 text-gray-600",children:"Loading electives..."}):N.length===0?n.jsx("div",{className:"text-center py-8 text-gray-500",children:"No electives found"}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course Code"}),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course Name"}),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Regulation"}),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Semester"}),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),n.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:n.jsxs("div",{className:"flex items-center justify-center gap-1",children:[n.jsx(Qs,{className:"h-4 w-4"}),"Students"]})})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(P=>{var K;return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:P.course_code||""}),n.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:P.course_name||""}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:P.regulation||""}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:P.semester||""}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:((K=P.department)==null?void 0:K.code)||""}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:n.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${P.student_count>0?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-600"}`,children:P.student_count})})]},P.id)})})]})})]})]})})}const hf="https://db.zynix.us";function fh(){const e=window.localStorage.getItem("access");return e?{Authorization:`Bearer ${e}`}:{}}function w8(){var be;const[e,t]=v.useState([]),[r,s]=v.useState("courses"),[a,i]=v.useState(null),[o,l]=v.useState([]),[c,d]=v.useState(!1),[u,h]=v.useState(!1),[p,f]=v.useState(1),[x,g]=v.useState("idle"),[y,m]=v.useState(null),[w,S]=v.useState([]),[k,F]=v.useState(null),[L,C]=v.useState(""),[O,T]=v.useState(""),[W,A]=v.useState(""),[N,P]=v.useState(""),[K,re]=v.useState(""),[ge,Fe]=v.useState(!1),[R,q]=v.useState(null),[me,fe]=v.useState(null),[E,U]=v.useState([]),[I,M]=v.useState(!1),[te,Q]=v.useState(0),[G,ne]=v.useState([]),[z,he]=v.useState(null),[X,H]=v.useState(null),[oe,D]=v.useState(null);function Y(we){try{if(typeof we=="string"){let Me=we;return!Me.startsWith("data:")&&/^[A-Za-z0-9+/=\n\r]+$/.test(Me)&&Me.length>100&&(Me=`data:image/png;base64,${Me.replace(/\s+/g,"")}`),Me}if(we&&typeof we=="object"){if(typeof we.url=="string"&&we.url)return we.url;if(typeof we.base64=="string"&&we.base64)return we.base64.startsWith("data:")?we.base64:`data:image/png;base64,${we.base64}`;if(we.binary&&we.binary instanceof Uint8Array){const Me=new Blob([we.binary],{type:"image/png"});return URL.createObjectURL(Me)}}if(we instanceof Uint8Array){const Me=new Blob([we],{type:"image/png"});return URL.createObjectURL(Me)}return null}catch{return null}}v.useEffect(()=>{Pp().then(we=>i(we)).catch(()=>i(null)),(async()=>{try{d(!0);const we=await wl();Array.isArray(we)&&l(we)}catch(we){console.warn("Failed to load teaching assignments",we),l([])}finally{d(!1)}})(),(async()=>{try{const we=await fetch(`${hf}/api/obe/list-uploads`,{headers:{...fh()}});if(!we.ok)return;const Me=await we.json();Array.isArray(Me==null?void 0:Me.files)&&ne(Me.files||[])}catch{}})()},[]);const le=v.useMemo(()=>a?a.faculty_id??a.staff_id??a.employee_id??a.id??null:null,[a]),$e=we=>{const Me=parseFloat(we.replace(/[^0-9.\-]/g,""));return Number.isFinite(Me)?Me:0},je=we=>{const Me=`/obe/course/${encodeURIComponent(we)}`;window.location.href=Me},We=v.useMemo(()=>(w||[]).filter(we=>{const Me=String((we==null?void 0:we.marks)??"").trim().toUpperCase(),Wt=String((we==null?void 0:we.btl)??"").trim().toUpperCase(),Ct=String((we==null?void 0:we.course_outcomes)??"").trim().toUpperCase();return!(Me==="(OR)"&&Wt==="(OR)"&&Ct==="(OR)")}),[w]),[Ee,Re]=v.useState("idle"),[Ve,St]=v.useState(null);async function rt(we){Re("uploading"),St(null),g("idle"),m(null),q(null),fe(null);const Me=new FormData;Me.append("file",we);try{const Wt=await fetch(`${hf}/api/obe/upload-docx`,{method:"POST",headers:{...fh()},body:Me});if(!Wt.ok){const gr=await Wt.text();Re("error"),St(gr||`Upload failed (${Wt.status})`);return}const Ct=await Wt.json();Re("success");const pr=(Ct==null?void 0:Ct.file_url)||(Ct==null?void 0:Ct.saved_path)||"";F(pr||null),St(`Uploaded: ${pr}`),h(!0),f(1),S([]),g("scanning"),m("Scanning DOCX");const fr=new FormData;fr.append("file",we);const Be=await fetch(`${hf}/api/template/scan-docx`,{method:"POST",headers:{...fh()},body:fr});if(!Be.ok){const gr=await Be.text();g("error"),m(gr||`Scan failed (${Be.status})`),S([]);return}const mt=await Be.json(),ft=(Array.isArray(mt==null?void 0:mt.questions)?mt.questions:[]).map(gr=>({...gr,source_file_path:pr||gr.source_file_path||null}));if(S(ft),g("success"),m(`Scanned ${ft.length} question(s).`),!L.trim()){const gr=we.name.replace(/\.docx$/i,"");C(gr)}}catch(Wt){Re("error"),St((Wt==null?void 0:Wt.message)||"Upload failed"),g("error"),m((Wt==null?void 0:Wt.message)||"Scan failed")}}function ze(){h(!1),f(1)}async function Ie(){if(!L.trim()){fe("Exam name is required."),f(2);return}if(!W.trim()){fe("Exam type is required."),f(2);return}if(!N.trim()){fe("Exam date is required."),f(2);return}Fe(!0),fe(null),q(null);try{const we=K.split(/\r?\n/).map(fr=>fr.trim()).filter(Boolean),Me=We.map(fr=>({...fr,excel_type:fr.excel_type||W,source_file_path:fr.source_file_path||k||null})),Wt=await fetch(`${hf}/api/import/questions`,{method:"POST",headers:{"Content-Type":"application/json",...fh()},body:JSON.stringify({title:L.trim(),status:"pending",exam_type:W.trim(),exam_date:N.trim(),sections:we,faculty_id:le,questions:Me})});if(!Wt.ok){const fr=await Wt.text();fe(fr||`Import failed (${Wt.status})`);return}const Ct=await Wt.json();q(Ct);const pr={title:L.trim(),inserted:Ct.inserted||0,failed:Array.isArray(Ct.failed)?Ct.failed.length:0,source_file_path:k||null,title_id:Ct.title_id||null,exam_date:N||null,exam_type:W||null,faculty_id:le||null,created_at:new Date().toISOString()};U(fr=>[pr,...fr]),M(!0),setTimeout(()=>M(!1),4e3),setTimeout(()=>ze(),600)}catch(we){fe((we==null?void 0:we.message)||"Import failed")}finally{Fe(!1)}}const ot=e.length;return ot&&(e.reduce((we,Me)=>we+$e(Me.achieved),0)/ot).toFixed(1)+"",n.jsxs("main",{className:"obe-page",style:{padding:"32px 48px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',minHeight:"100vh",background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)"},children:[n.jsx("header",{style:{marginBottom:32,background:"#fff",padding:"28px 32px",borderRadius:16,boxShadow:"0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04)"},children:n.jsx("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end",width:"100%"},children:n.jsxs("div",{style:{textAlign:"left"},children:[n.jsx("h1",{style:{margin:0,fontSize:32,fontWeight:700,color:"#0f172a",letterSpacing:"-0.02em"},children:"Outcome Based Education (OBE)"}),n.jsx("div",{style:{marginTop:8,color:"#64748b",fontSize:16,fontWeight:400},children:"Select a course, then work through CDAP, Articulation Matrix and Mark Entry."})]})})}),n.jsxs("div",{style:{display:"flex",gap:6,marginBottom:24,background:"#fff",padding:"8px",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.06)"},children:[n.jsx("button",{onClick:()=>s("courses"),style:{padding:"10px 24px",borderRadius:8,border:"none",background:r==="courses"?"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)":"transparent",color:r==="courses"?"#fff":"#64748b",cursor:"pointer",fontWeight:r==="courses"?600:500,fontSize:15,transition:"all 0.2s ease",boxShadow:r==="courses"?"0 2px 8px rgba(37,99,235,0.2)":"none"},children:" Courses"}),n.jsx("button",{onClick:()=>s("exam"),style:{padding:"10px 24px",borderRadius:8,border:"none",background:r==="exam"?"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)":"transparent",color:r==="exam"?"#fff":"#64748b",cursor:"pointer",fontWeight:r==="exam"?600:500,fontSize:15,transition:"all 0.2s ease",boxShadow:r==="exam"?"0 2px 8px rgba(37,99,235,0.2)":"none"},children:" Exam Management"})]}),r==="courses"&&n.jsxs("section",{"aria-label":"Course selector",style:{marginBottom:32},children:[n.jsx("div",{style:{fontSize:14,color:"#475569",marginBottom:20,fontWeight:500},children:"Select a course to work on:"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:24,marginBottom:32},children:c?n.jsx("div",{style:{gridColumn:"1/-1",color:"#64748b",fontSize:16,textAlign:"center",padding:60,background:"#fff",borderRadius:12},children:" Loading courses"}):o.length===0?n.jsxs("div",{style:{gridColumn:"1/-1",color:"#94a3b8",fontSize:18,textAlign:"center",padding:60,background:"#fff",borderRadius:12,border:"2px dashed #e2e8f0"},children:[" No courses found. You have no teaching assignments.",n.jsx("br",{}),n.jsx("span",{style:{fontSize:14,marginTop:12,display:"block"},children:"(If you expect to see courses here, please check with your backend/API or contact admin.)"})]}):o.reduce((we,Me)=>(we.some(Wt=>Wt.subject_code===Me.subject_code)||we.push(Me),we),[]).map(we=>n.jsxs("div",{onClick:()=>je(we.subject_code),role:"button",tabIndex:0,onKeyDown:Me=>{Me.key==="Enter"&&je(we.subject_code)},onMouseEnter:Me=>{Me.currentTarget.style.transform="translateY(-4px)",Me.currentTarget.style.boxShadow="0 12px 24px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.06)",Me.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:Me=>{Me.currentTarget.style.transform="translateY(0)",Me.currentTarget.style.boxShadow="0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.05)",Me.currentTarget.style.borderColor="#e2e8f0"},style:{border:"1px solid #e2e8f0",borderRadius:12,padding:24,background:"#fff",boxShadow:"0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.05)",display:"flex",flexDirection:"column",alignItems:"flex-start",minHeight:140,position:"relative",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[n.jsx("div",{style:{fontWeight:700,fontSize:19,marginBottom:6,color:"#0f172a",lineHeight:1.3},children:we.subject_name}),n.jsx("div",{style:{fontSize:14,color:"#3b82f6",marginBottom:16,fontWeight:600,background:"#eff6ff",padding:"4px 10px",borderRadius:6},children:we.subject_code}),n.jsxs("div",{style:{marginTop:"auto",display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("button",{onClick:Me=>{Me.stopPropagation(),je(we.subject_code)},onMouseEnter:Me=>{Me.currentTarget.style.background="linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)",Me.currentTarget.style.transform="scale(1.05)"},onMouseLeave:Me=>{Me.currentTarget.style.background="linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",Me.currentTarget.style.transform="scale(1)"},style:{padding:"8px 18px",borderRadius:8,border:"none",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"#fff",fontWeight:600,fontSize:14,cursor:"pointer",boxShadow:"0 2px 4px rgba(37,99,235,0.2)",transition:"all 0.2s ease"},children:"Open Course"}),n.jsx("button",{onClick:Me=>{Me.stopPropagation(),window.location.href=`/obe/course/${encodeURIComponent(we.subject_code)}/lca`},onMouseEnter:Me=>{Me.currentTarget.style.background="#f8fafc",Me.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:Me=>{Me.currentTarget.style.background="#fff",Me.currentTarget.style.borderColor="#e2e8f0"},style:{padding:"8px 14px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff",color:"#475569",fontWeight:600,fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},children:"LCA"}),n.jsx("button",{onClick:Me=>{Me.stopPropagation(),window.location.href=`/obe/course/${encodeURIComponent(we.subject_code)}/co_attainment`},onMouseEnter:Me=>{Me.currentTarget.style.background="#f8fafc",Me.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:Me=>{Me.currentTarget.style.background="#fff",Me.currentTarget.style.borderColor="#e2e8f0"},style:{padding:"8px 14px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff",color:"#475569",fontWeight:600,fontSize:13,cursor:"pointer",transition:"all 0.2s ease"},children:"CO"})]})]},we.subject_code))})]}),r==="exam"&&n.jsx("section",{"aria-label":"Exam management",style:{background:"#fff",padding:28,borderRadius:16,boxShadow:"0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04)"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[n.jsx("div",{style:{background:"#f8fafc",padding:20,borderRadius:12,border:"2px dashed #cbd5e1"},children:n.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center"},children:[n.jsx("input",{id:"exam-upload-input",type:"file",accept:".docx",style:{display:"none"},onChange:we=>{const Me=we.target.files&&we.target.files[0];Me&&rt(Me),we.currentTarget.value=""}}),n.jsx("label",{htmlFor:"exam-upload-input",style:{display:"inline-flex",alignItems:"center",gap:10,padding:"12px 20px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"#fff",borderRadius:10,cursor:"pointer",fontWeight:600,fontSize:15,boxShadow:"0 2px 8px rgba(37,99,235,0.25)",transition:"all 0.2s ease"},children:Ee==="uploading"?" Uploading...":" Upload .docx"}),n.jsx("div",{style:{color:"#64748b",fontSize:14},children:"Upload exam spreadsheets or related files here."})]})}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("input",{type:"search",placeholder:" Search exams, courses, entries...",style:{flex:1,padding:"12px 16px",borderRadius:10,border:"1px solid #e2e8f0",fontSize:15,background:"#fff",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},onChange:()=>{}}),n.jsx("button",{style:{padding:"12px 20px",borderRadius:10,border:"1px solid #e2e8f0",background:"#fff",cursor:"pointer",fontWeight:600,fontSize:14,color:"#475569",transition:"all 0.2s ease",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:"Search"})]}),n.jsxs("div",{style:{marginTop:8},children:[n.jsx("h3",{style:{margin:"12px 0 16px 0",fontSize:18,fontWeight:700,color:"#0f172a"},children:" Recent"}),E.length===0?n.jsxs("div",{style:{color:"#666"},children:[n.jsx("div",{style:{marginBottom:8,fontSize:13},children:"Uploaded DOCX files"}),G.length===0?n.jsx("div",{style:{color:"#666"},children:"No uploaded DOCX files found."}):n.jsx("div",{style:{display:"grid",gap:8},children:G.map((we,Me)=>n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:8,padding:10,background:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:700},children:we.name}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:we.path})]}),n.jsx("div",{children:n.jsx("button",{onClick:()=>he(we),style:{background:"none",border:"none",color:"#2563eb",cursor:"pointer",padding:6},children:"Open"})})]},Me))})]}):n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"320px 1fr",gap:12},children:[n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:E.slice(0,12).map((we,Me)=>{const Wt=Me===te;return n.jsxs("div",{onClick:()=>Q(Me),role:"button",tabIndex:0,style:{border:Wt?"2px solid #2563eb":"1px solid #e5e7eb",borderRadius:8,padding:10,background:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[n.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[n.jsx("path",{d:"M6 2h7l5 5v13a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z",fill:"#e6f0ff",stroke:"#2563eb",strokeWidth:"0.5"}),n.jsx("path",{d:"M13 2v6h6",fill:"#fff"}),n.jsx("rect",{x:"7",y:"11",width:"10",height:"2.2",rx:"0.6",fill:"#2563eb"}),n.jsx("rect",{x:"7",y:"14",width:"6",height:"2.2",rx:"0.6",fill:"#2563eb"}),n.jsx("text",{x:"7",y:"18.8",fontSize:"2.8",fill:"#2563eb",fontFamily:"Arial, Helvetica, sans-serif",children:"DOCX"})]}),n.jsx("div",{style:{fontWeight:700},children:we.title})]}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[we.exam_type||"","  ",we.exam_date||""]})]}),n.jsxs("div",{style:{textAlign:"right"},children:[n.jsx("div",{style:{fontWeight:800,color:"#16a34a"},children:we.inserted}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"questions"})]})]},Me)})}),n.jsx("div",{children:E[te]&&n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Preview"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:12},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,marginBottom:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("div",{style:{width:64,height:64,borderRadius:8,background:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#6b7280"},children:a!=null&&a.username?String(a.username).slice(0,1).toUpperCase():"U"}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#111827"},children:(a==null?void 0:a.username)||""}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Faculty"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:""})]})]}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:["Faculty ID: ",n.jsx("strong",{style:{color:"#111827"},children:le??""})]})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontSize:13,color:"#6b7280",marginBottom:8},children:"Course details"}),n.jsx("div",{style:{fontWeight:700},children:""}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:""}),n.jsxs("div",{style:{marginTop:8,fontSize:12,color:"#6b7280"},children:["Assignments: ",n.jsx("strong",{style:{color:"#111827"},children:""})]})]})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,marginBottom:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Questions imported"}),n.jsx("div",{style:{fontSize:20,fontWeight:900,color:"#111827"},children:E[te].inserted})]}),n.jsxs("div",{style:{textAlign:"right"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Title"}),n.jsx("div",{style:{fontWeight:700},children:E[te].title||""}),n.jsx("div",{style:{marginTop:6,fontSize:12,color:"#6b7280"},children:"Assessment"}),n.jsx("div",{style:{fontWeight:700},children:E[te].exam_type||""})]})]}),n.jsxs("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[n.jsxs("div",{children:[n.jsx("span",{style:{color:"#6b7280",fontSize:12},children:"Exam Type"}),n.jsx("div",{style:{fontWeight:700},children:E[te].exam_type||""})]}),n.jsxs("div",{children:[n.jsx("span",{style:{color:"#6b7280",fontSize:12},children:"Exam date"}),n.jsx("div",{style:{fontWeight:700},children:E[te].exam_date||""})]}),n.jsxs("div",{style:{gridColumn:"1 / -1"},children:[n.jsx("span",{style:{color:"#6b7280",fontSize:12},children:"Uploaded file"}),n.jsx("div",{style:{fontWeight:700,whiteSpace:"pre-wrap"},children:E[te].source_file_path||""})]})]})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Questions preview"}),n.jsx("div",{children:n.jsx("button",{onClick:async()=>{var we,Me;H(null);try{const Wt=(we=E[te])==null?void 0:we.title_id;let Ct="";Wt?Ct=`${hf}/api/import/questions/list?title_id=${Wt}`:Ct=`${hf}/api/import/questions/list?title=${encodeURIComponent(((Me=E[te])==null?void 0:Me.title)||"")}`;const pr=await fetch(Ct,{headers:{...fh()}});if(!pr.ok){H([]);return}const fr=await pr.json();H(Array.isArray(fr==null?void 0:fr.questions)?fr.questions:[])}catch{H([])}},style:{padding:"6px 10px",borderRadius:8,border:"1px solid #e5e7eb",background:"#fff",cursor:"pointer"},children:"Load questions"})})]}),n.jsx("div",{style:{maxHeight:220,overflow:"auto"},children:X===null?n.jsx("div",{style:{color:"#6b7280"},children:'Click "Load questions" to fetch saved questions for this import.'}):X.length===0?n.jsx("div",{style:{color:"#6b7280"},children:"No saved questions found for this title."}):X.slice(0,20).map((we,Me)=>n.jsxs("div",{style:{padding:"8px 6px",borderBottom:"1px solid #f3f4f6"},children:[n.jsxs("div",{style:{fontWeight:700,color:"#111827"},children:[Me+1,"."]}),n.jsx("div",{style:{color:"#111827"},children:String(we.question_text).slice(0,300)})]},Me))})]})]})]})]})})]})]}),Ve&&n.jsx("div",{style:{marginTop:12,fontSize:14,color:Ee==="error"?"#dc2626":"#16a34a",background:Ee==="error"?"#fef2f2":"#f0fdf4",padding:"12px 16px",borderRadius:10,border:`1px solid ${Ee==="error"?"#fecaca":"#bbf7d0"}`},children:Ve})]})}),u&&n.jsx("div",{role:"dialog","aria-modal":"true",onClick:ze,style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:20},children:n.jsxs("div",{onClick:we=>we.stopPropagation(),style:{width:"min(1000px, 100%)",background:"#fff",borderRadius:16,boxShadow:"0 20px 50px rgba(0,0,0,0.3)",overflow:"hidden",border:"1px solid #e2e8f0"},children:[n.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between",background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:700,fontSize:20,color:"#0f172a"},children:" Question Import"}),n.jsxs("div",{style:{color:"#64748b",fontSize:14,marginTop:4},children:["Step ",p," of 3  ",x==="scanning"?"Scanning":x==="error"?"Scan failed":"Ready"]})]}),n.jsx("button",{onClick:ze,onMouseEnter:we=>{we.currentTarget.style.background="#fee2e2"},onMouseLeave:we=>{we.currentTarget.style.background="#fff"},style:{padding:"8px 14px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff",cursor:"pointer",fontWeight:600,fontSize:14,color:"#64748b",transition:"all 0.2s ease"},children:" Close"})]}),n.jsx("div",{style:{overflow:"hidden",background:"#fafbfc"},children:n.jsxs("div",{style:{display:"flex",width:"300%",transform:`translateX(-${(p-1)*33.3333333}%)`,transition:"transform 360ms cubic-bezier(0.4, 0, 0.2, 1)"},children:[n.jsxs("div",{style:{width:"33.3333333%",padding:24},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:700,fontSize:18,color:"#0f172a"},children:" Preview"}),n.jsx("div",{style:{fontSize:13,color:"#64748b",marginTop:2},children:k?`Source: ${k}`:"Source: (not available)"})]}),n.jsxs("div",{style:{fontSize:14,color:"#0f172a",background:"#eff6ff",padding:"6px 12px",borderRadius:8,fontWeight:600},children:["Questions: ",n.jsx("b",{style:{color:"#3b82f6"},children:We.length})]})]}),y&&n.jsx("div",{style:{marginBottom:12,fontSize:14,color:x==="error"?"#dc2626":"#16a34a",background:x==="error"?"#fef2f2":"#f0fdf4",padding:"12px 16px",borderRadius:10,border:`1px solid ${x==="error"?"#fecaca":"#bbf7d0"}`},children:y}),n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,padding:16,maxHeight:420,overflow:"auto",background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[x==="scanning"&&n.jsx("div",{style:{color:"#64748b",textAlign:"center",padding:40},children:" Scanning your DOCX"}),x!=="scanning"&&We.length===0&&n.jsx("div",{style:{color:"#94a3b8",textAlign:"center",padding:40},children:" No questions to preview yet."}),We.map((we,Me)=>n.jsxs("div",{style:{padding:"14px 12px",borderBottom:Me<We.length-1?"1px solid #f1f5f9":"none"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,marginBottom:8},children:[n.jsxs("div",{style:{fontWeight:700,color:"#3b82f6",fontSize:15,background:"#eff6ff",padding:"4px 10px",borderRadius:6},children:["Q",Me+1]}),n.jsxs("div",{style:{fontSize:12,color:"#64748b",background:"#f8fafc",padding:"4px 10px",borderRadius:6},children:["Marks: ",String((we==null?void 0:we.marks)??"-")," "," BTL: ",String((we==null?void 0:we.btl)??"-")," "," CO: ",String((we==null?void 0:we.course_outcomes)??"-")]})]}),n.jsxs("div",{style:{marginTop:8,color:"#1e293b",whiteSpace:"pre-wrap",fontSize:14,lineHeight:1.6},children:[String((we==null?void 0:we.question_text)??"").slice(0,500),String((we==null?void 0:we.question_text)??"").length>500?"":""]}),Array.isArray(we==null?void 0:we.images)&&we.images.length?n.jsx("div",{style:{marginTop:12,display:"flex",gap:12,flexWrap:"wrap"},children:we.images.slice(0,4).map((Wt,Ct)=>{const pr=Y(Wt);return pr?n.jsx("img",{src:pr,alt:`q${Me+1}-img${Ct+1}`,onClick:()=>D(pr),style:{maxHeight:140,borderRadius:10,border:"2px solid #e2e8f0",cursor:"pointer",objectFit:"contain",background:"#fff",transition:"all 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.08)"}},Ct):null})}):null]},Me))]})]}),n.jsxs("div",{style:{width:"33.3333333%",padding:24},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:16,fontSize:18,color:"#0f172a"},children:" Save details"}),me&&n.jsx("div",{style:{marginBottom:12,fontSize:14,color:"#dc2626",background:"#fef2f2",padding:"12px 16px",borderRadius:10,border:"1px solid #fecaca"},children:me}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:12,color:"#6b7280",marginBottom:6},children:"Exam name"}),n.jsx("input",{value:L,onChange:we=>C(we.target.value),placeholder:"e.g., Unit 1 - Introduction",style:{width:"100%",padding:"12px 14px",borderRadius:10,border:"1px solid #e6eef8",boxShadow:"inset 0 1px 2px #00000008"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:12,color:"#6b7280",marginBottom:6},children:"Exam (CIA / Model / ESE)"}),n.jsxs("select",{value:O,onChange:we=>T(we.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:10,border:"1px solid #e6eef8",background:"#fff"},children:[n.jsx("option",{value:"",children:"Select assessment"}),n.jsx("option",{value:"CIA1",children:"CIA1"}),n.jsx("option",{value:"CIA2",children:"CIA2"}),n.jsx("option",{value:"MODEL",children:"MODEL"}),n.jsx("option",{value:"ESE",children:"ESE"})]})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:12,color:"#6b7280",marginBottom:6},children:"Exam Type"}),n.jsxs("select",{value:W,onChange:we=>A(we.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:10,border:"1px solid #e6eef8",background:"#fff"},children:[n.jsx("option",{value:"",children:"Select paper"}),n.jsx("option",{value:"QP1",children:"QP1"}),n.jsx("option",{value:"QP2",children:"QP2"})]})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:12,color:"#6b7280",marginBottom:6},children:"Exam date"}),n.jsx("input",{type:"date",value:N,onChange:we=>P(we.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:10,border:"1px solid #e6eef8"}})]}),n.jsxs("div",{style:{gridColumn:"1 / -1"},children:[n.jsx("label",{style:{display:"block",fontSize:12,color:"#6b7280",marginBottom:6},children:"Sections"}),n.jsx("textarea",{value:K,onChange:we=>re(we.target.value),placeholder:"e.g., Part A\\nPart B\\nSection 1",rows:3,style:{width:"100%",padding:"12px 14px",borderRadius:10,border:"1px solid #e6eef8",resize:"vertical"}})]})]}),n.jsx("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:"This metadata is shown for confirmation. (Currently, only the exam name is used as the imported title.)"})]}),n.jsxs("div",{style:{width:"33.3333333%",padding:24},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:16,fontSize:18,color:"#0f172a"},children:" Confirmation"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"280px 1fr",gap:16},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,padding:16,marginBottom:16,background:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("div",{style:{width:64,height:64,borderRadius:10,background:"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#3b82f6",fontSize:24},children:a!=null&&a.username?String(a.username).slice(0,1).toUpperCase():""}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#0f172a"},children:(a==null?void 0:a.username)||""}),n.jsx("div",{style:{fontSize:13,color:"#64748b"},children:"Faculty"})]})]}),n.jsxs("div",{style:{marginTop:12,fontSize:13,color:"#475569",background:"#f8fafc",padding:"8px 12px",borderRadius:8},children:["Faculty ID: ",n.jsx("strong",{style:{color:"#0f172a"},children:le??""})]})]}),n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,padding:16,background:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[n.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:10,fontWeight:600},children:" Course details"}),n.jsx("div",{style:{fontWeight:700,color:"#0f172a"},children:""}),n.jsx("div",{style:{fontSize:13,color:"#64748b",marginTop:2},children:""}),n.jsxs("div",{style:{marginTop:12,fontSize:13,color:"#475569"},children:["Assignments: ",n.jsx("strong",{style:{color:"#0f172a"},children:""})]})]})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,padding:16,marginBottom:16,background:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:16,flexWrap:"wrap"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:600},children:"Questions to import"}),n.jsx("div",{style:{fontSize:28,fontWeight:900,color:"#3b82f6",marginTop:4},children:We.length})]}),n.jsxs("div",{style:{textAlign:"right"},children:[n.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:600},children:"Exam name"}),n.jsx("div",{style:{fontWeight:700,color:"#0f172a",fontSize:16,marginTop:2},children:L||""}),n.jsx("div",{style:{marginTop:8,fontSize:13,color:"#64748b",fontWeight:600},children:"Assessment"}),n.jsx("div",{style:{fontWeight:700,color:"#0f172a",marginTop:2},children:O||""})]})]}),n.jsxs("div",{style:{marginTop:16,display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,background:"#f8fafc",padding:12,borderRadius:8},children:[n.jsxs("div",{children:[n.jsx("span",{style:{color:"#64748b",fontSize:13,fontWeight:600},children:"Exam Type"}),n.jsx("div",{style:{fontWeight:700,color:"#0f172a",marginTop:4},children:W||""})]}),n.jsxs("div",{children:[n.jsx("span",{style:{color:"#64748b",fontSize:13,fontWeight:600},children:"Exam date"}),n.jsx("div",{style:{fontWeight:700,color:"#0f172a",marginTop:4},children:N||""})]}),n.jsxs("div",{style:{gridColumn:"1 / -1"},children:[n.jsx("span",{style:{color:"#64748b",fontSize:13,fontWeight:600},children:"Sections"}),n.jsx("div",{style:{fontWeight:700,color:"#0f172a",whiteSpace:"pre-wrap",marginTop:4},children:K||""})]})]})]}),n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,padding:16,background:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[n.jsx("div",{style:{fontSize:14,color:"#64748b",marginBottom:10,fontWeight:600},children:" Questions preview"}),n.jsx("div",{style:{maxHeight:240,overflow:"auto"},children:We.slice(0,10).map((we,Me)=>n.jsxs("div",{style:{padding:"10px 8px",borderBottom:Me<Math.min(We.length,10)-1?"1px solid #f1f5f9":"none",display:"flex",gap:12,alignItems:"flex-start"},children:[n.jsx("div",{style:{fontWeight:700,color:"#3b82f6",minWidth:40,background:"#eff6ff",padding:"4px 8px",borderRadius:6,textAlign:"center"},children:Me+1}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{color:"#1e293b",fontSize:14,lineHeight:1.5},children:String(we.question_text).slice(0,260)}),Array.isArray(we.images)&&we.images.length?n.jsx("div",{style:{display:"flex",gap:10,marginTop:8},children:we.images.slice(0,2).map((Wt,Ct)=>{const pr=Y(Wt);return pr?n.jsx("img",{src:pr,style:{width:90,height:70,objectFit:"cover",borderRadius:8,border:"2px solid #e2e8f0",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>D(pr)},Ct):null})}):null]})]},Me))})]})]})]}),me&&n.jsxs("div",{style:{marginTop:16,fontSize:14,color:"#dc2626",background:"#fef2f2",padding:"12px 16px",borderRadius:10,border:"1px solid #fecaca"},children:[" ",me]}),R&&n.jsxs("div",{style:{marginTop:16,fontSize:14,color:"#16a34a",background:"#f0fdf4",padding:"12px 16px",borderRadius:10,border:"1px solid #bbf7d0"},children:[" Imported ",R.inserted," question(s)",(be=R.failed)!=null&&be.length?`, failed ${R.failed.length}.`:"."]})]})]})}),n.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,background:"#fafbfc"},children:[n.jsx("button",{onClick:()=>f(we=>we===1?1:we-1),disabled:p===1,onMouseEnter:we=>{p!==1&&(we.currentTarget.style.background="#f8fafc")},onMouseLeave:we=>{p!==1&&(we.currentTarget.style.background="#fff")},style:{padding:"10px 18px",borderRadius:10,border:"1px solid #e2e8f0",background:p===1?"#f1f5f9":"#fff",cursor:p===1?"not-allowed":"pointer",fontWeight:600,fontSize:14,color:p===1?"#94a3b8":"#475569",transition:"all 0.2s ease"},children:" Back"}),n.jsx("div",{style:{display:"flex",gap:10,alignItems:"center"},children:p<3?n.jsx("button",{onClick:()=>{if(fe(null),p===2){if(!L.trim()){fe("Exam name is required.");return}if(!W.trim()){fe("Exam type is required.");return}if(!N.trim()){fe("Exam date is required.");return}}f(we=>we+1)},disabled:p===1&&x==="scanning",onMouseEnter:we=>{p===1&&x==="scanning"||(we.currentTarget.style.background="linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)")},onMouseLeave:we=>{p===1&&x==="scanning"||(we.currentTarget.style.background="linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)")},style:{padding:"10px 24px",borderRadius:10,border:"none",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:15,boxShadow:"0 2px 8px rgba(37,99,235,0.25)",transition:"all 0.2s ease"},children:"Next "}):n.jsx("button",{onClick:Ie,disabled:ge||x==="scanning"||We.length===0,onMouseEnter:we=>{!ge&&x!=="scanning"&&We.length>0&&(we.currentTarget.style.background="linear-gradient(135deg, #15803d 0%, #166534 100%)")},onMouseLeave:we=>{!ge&&x!=="scanning"&&We.length>0&&(we.currentTarget.style.background="linear-gradient(135deg, #16a34a 0%, #15803d 100%)")},style:{padding:"10px 24px",borderRadius:10,border:"none",background:ge?"#cbd5e1":"linear-gradient(135deg, #16a34a 0%, #15803d 100%)",color:"#fff",fontWeight:800,fontSize:15,cursor:ge?"not-allowed":"pointer",boxShadow:ge?"none":"0 2px 8px rgba(22,163,74,0.25)",transition:"all 0.2s ease"},children:ge?" Importing":" Confirm & Import"})})]})]})}),oe&&n.jsx("div",{role:"dialog",onClick:()=>{D(null)},style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:80},children:n.jsx("div",{onClick:we=>we.stopPropagation(),style:{maxWidth:"95%",maxHeight:"95%",padding:16,background:"#fff",borderRadius:16,boxShadow:"0 20px 50px rgba(0,0,0,0.5)"},children:n.jsx("img",{src:oe,alt:"preview",style:{maxWidth:"100%",maxHeight:"100%",borderRadius:12}})})}),z&&n.jsx("div",{role:"dialog",onClick:()=>{he(null)},style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:80,padding:16},children:n.jsxs("div",{onClick:we=>we.stopPropagation(),style:{width:"min(900px, 100%)",background:"#fff",borderRadius:12,boxShadow:"0 12px 40px rgba(0,0,0,0.25)",overflow:"hidden",border:"1px solid #e5e7eb"},children:[n.jsxs("div",{style:{padding:"14px 16px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:800,fontSize:16},children:"Uploaded file preview"}),n.jsxs("div",{style:{color:"#6b7280",fontSize:12},children:["Preview of uploaded DOCX  ",z.name]})]}),n.jsx("button",{onClick:()=>he(null),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #e5e7eb",background:"#fff",cursor:"pointer"},children:"Close"})]}),n.jsx("div",{style:{padding:16},children:n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"280px 1fr",gap:12},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,marginBottom:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("div",{style:{width:64,height:64,borderRadius:8,background:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#6b7280"},children:a!=null&&a.username?String(a.username).slice(0,1).toUpperCase():"U"}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#111827"},children:(a==null?void 0:a.username)||""}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Faculty"}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:""})]})]}),n.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#6b7280"},children:["Faculty ID: ",n.jsx("strong",{style:{color:"#111827"},children:le??""})]})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontSize:13,color:"#6b7280",marginBottom:8},children:"File details"}),n.jsx("div",{style:{fontWeight:700},children:z.name}),n.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:z.path}),n.jsx("div",{style:{marginTop:8},children:n.jsx("a",{href:z.url,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:"Download file"})})]})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,marginBottom:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Uploaded file"}),n.jsx("div",{style:{fontSize:20,fontWeight:900,color:"#111827"},children:z.name})]}),n.jsxs("div",{style:{textAlign:"right"},children:[n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Uploaded path"}),n.jsx("div",{style:{fontWeight:700},children:z.path})]})]}),n.jsx("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"1fr",gap:10},children:n.jsxs("div",{children:[n.jsx("span",{style:{color:"#6b7280",fontSize:12},children:"Notes"}),n.jsx("div",{style:{fontWeight:700},children:"This preview shows file metadata. Open the file to view full content or import to parse questions."})]})})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontSize:13,color:"#6b7280",marginBottom:8},children:"Importer preview"}),n.jsx("div",{style:{maxHeight:260,overflow:"auto"},children:n.jsx("div",{style:{color:"#6b7280"},children:"To see a full questions preview, upload and scan this DOCX using the importer  then the Step 3 confirmation contains the parsed question list."})})]})]})]})})]})}),I&&n.jsx("div",{style:{position:"fixed",left:24,bottom:24,zIndex:120,animation:"slideIn 0.3s ease"},children:n.jsxs("div",{style:{background:"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)",color:"#065f46",border:"1px solid #6ee7b7",padding:"16px 20px",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15)"},children:[n.jsx("div",{style:{fontWeight:800,fontSize:16,marginBottom:4},children:" Imported"}),n.jsxs("div",{style:{fontSize:14,color:"#047857"},children:[(R==null?void 0:R.inserted)??0," question(s) imported successfully."]})]})})]})}const $l=[{key:"q1",label:"Q1",max:2,co:1,btl:1},{key:"q2",label:"Q2",max:2,co:1,btl:3},{key:"q3",label:"Q3",max:2,co:1,btl:4},{key:"q4",label:"Q4",max:2,co:2,btl:1},{key:"q5",label:"Q5",max:2,co:2,btl:1},{key:"q6",label:"Q6",max:2,co:2,btl:2},{key:"q7",label:"Q7",max:16,co:1,btl:2},{key:"q8",label:"Q8",max:16,co:2,btl:3},{key:"q9",label:"Q9",max:16,co:"1&2",btl:5}];function Zf(e){let t=0,r=0;for(const s of e||[]){const a=Number(s.max||0);s.co==="1&2"?(t+=a/2,r+=a/2):s.co===2?r+=a:t+=a}return{co1:t,co2:r}}function Np(e){const t={1:0,2:0,3:0,4:0,5:0,6:0};for(const r of e||[]){const s=String(r.btl);s in t&&(t[s]+=Number(r.max||0))}return t}function cx(e){var u,h;const t=Zf(e.prevQuestions),r=Zf(e.nextQuestions),s=Np(e.prevQuestions),a=Np(e.nextQuestions),i=Number((u=e.existingCoMax)==null?void 0:u.co1),o=Number((h=e.existingCoMax)==null?void 0:h.co2),l=!Number.isFinite(i)||i===t.co1?r.co1:Math.max(0,i),c=!Number.isFinite(o)||o===t.co2?r.co2:Math.max(0,o),d={...a};return["1","2","3","4","5","6"].forEach(p=>{var x;const f=Number((x=e.existingBtlMax)==null?void 0:x[p]);Number.isFinite(f)&&f!==s[p]&&(d[p]=Math.max(0,f))}),{coMax:{co1:l,co2:c},btlMax:d}}const hb={termLabel:"KRCT AY25-26",assessments:{ssa1:{maxTotal:20,coMax:{co1:10,co2:10},btlMax:{1:0,2:0,3:10,4:10,5:0,6:0}},formative1:{maxPart:5,maxTotal:20,maxCo:10,btlMax:{1:0,2:0,3:10,4:10,5:0,6:0}},cia1:{questions:$l,coMax:Zf($l),btlMax:Np($l)}}},vJ=Array.from({length:11},(e,t)=>`PO${t+1}`);function wJ(e,t){const r=sd(t),s=e==null?void 0:e[r];return Array.isArray(s)&&s.length===11?s:Array.from({length:11},()=>!1)}function SJ(){var O,T,W,A,N,P,K,re,ge,Fe,R,q,me,fe,E,U,I,M,te,Q;const[e,t]=v.useState({}),[r,s]=v.useState(hb),[a,i]=v.useState(!1),[o,l]=v.useState(null),[c,d]=v.useState("assessments"),[u,h]=v.useState({}),[p,f]=v.useState(""),[x,g]=v.useState(""),[y,m]=v.useState("");v.useEffect(()=>{let G=!0;return(async()=>{try{const ne=await cA();G&&t(ne||{})}catch(ne){G&&l((ne==null?void 0:ne.message)||"Failed to load global mapping")}})(),()=>{G=!1}},[]),v.useEffect(()=>{let G=!0;return(async()=>{var ne,z,he,X,H,oe,D;try{const Y=await Sl();if(!G)return;const le={...hb,...Y||{},assessments:{...hb.assessments||{},...(Y==null?void 0:Y.assessments)||{}}},$e=((z=(ne=le.assessments)==null?void 0:ne.cia1)==null?void 0:z.questions)||[],je=Array.isArray($e)&&$e.length?$e:$l,We=Zf(je),Ee=Np(je),Re=(X=(he=le.assessments)==null?void 0:he.cia1)==null?void 0:X.coMax,Ve=Number(Re==null?void 0:Re.co1),St=Number(Re==null?void 0:Re.co2),rt=(oe=(H=le.assessments)==null?void 0:H.cia1)==null?void 0:oe.btlMax,ze=Ie=>{const ot=Number(rt==null?void 0:rt[Ie]);return Number.isFinite(ot)?Math.max(0,ot):Ee[Ie]};le.assessments={...le.assessments||{},cia1:{...((D=le.assessments)==null?void 0:D.cia1)||{},questions:je,coMax:{co1:Number.isFinite(Ve)?Math.max(0,Ve):We.co1,co2:Number.isFinite(St)?Math.max(0,St):We.co2},btlMax:{1:ze("1"),2:ze("2"),3:ze("3"),4:ze("4"),5:ze("5"),6:ze("6")}}},s(le)}catch(Y){G&&l((Y==null?void 0:Y.message)||"Failed to load assessment master config")}})(),()=>{G=!1}},[]);const w=v.useMemo(()=>V2.map(G=>({label:G,key:sd(G),values:wJ(e,G)})),[e]),S=(G,ne,z)=>{const he=sd(G);t(X=>{const H=Array.isArray(X==null?void 0:X[he])?[...X[he]]:Array.from({length:11},()=>!1);return H[ne]=z,{...X,[he]:H}})},k=async()=>{i(!0),l(null);try{c==="po"?(await MP(e),l("Saved global mapping.")):(await RP(r),l("Saved assessment master config."))}catch(G){l((G==null?void 0:G.message)||"Failed to save global mapping")}finally{i(!1)}},F=v.useMemo(()=>{var ne,z;const G=(z=(ne=r==null?void 0:r.assessments)==null?void 0:ne.cia1)==null?void 0:z.questions;return Array.isArray(G)&&G.length?G:$l},[r]),L=v.useMemo(()=>F.filter(G=>u[G.key]),[F,u]),C=()=>{L.length&&s(G=>{var X,H,oe,D,Y,le,$e;const ne=(((H=(X=G.assessments)==null?void 0:X.cia1)==null?void 0:H.questions)||$l).slice(),z=ne.map(je=>{if(!u[je.key])return je;const We={...je};return p!==""&&Number.isFinite(Number(p))&&(We.max=Math.max(0,Number(p))),(x==="1"||x==="2")&&(We.co=Number(x)),x==="1&2"&&(We.co="1&2"),y&&["1","2","3","4","5","6"].includes(y)&&(We.btl=Number(y)),We}),he=cx({prevQuestions:ne,nextQuestions:z,existingCoMax:(D=(oe=G.assessments)==null?void 0:oe.cia1)==null?void 0:D.coMax,existingBtlMax:(le=(Y=G.assessments)==null?void 0:Y.cia1)==null?void 0:le.btlMax});return{...G,assessments:{...G.assessments||{},cia1:{...(($e=G.assessments)==null?void 0:$e.cia1)||{},questions:z,coMax:he.coMax,btlMax:he.btlMax}}}})};return n.jsx("main",{className:"obe-master-page",style:{padding:0,fontFamily:"Arial, sans-serif",minHeight:"100vh",background:"#fff"},children:n.jsxs("div",{style:{padding:"0px",width:"100%",minWidth:0,boxSizing:"border-box"},children:[n.jsxs("div",{style:{marginBottom:16},children:[n.jsx("h2",{style:{margin:0},children:"OBE Master"}),n.jsx("div",{style:{color:"#666",marginTop:4},children:"Global settings for OBE pages"})]}),n.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:[n.jsx("button",{onClick:()=>d("assessments"),style:{padding:"8px 10px",borderRadius:8,border:"1px solid #e5e7eb",background:c==="assessments"?"#111827":"#fff",color:c==="assessments"?"#fff":"#111827"},children:"Assessment Headers"}),n.jsx("button",{onClick:()=>d("po"),style:{padding:"8px 10px",borderRadius:8,border:"1px solid #e5e7eb",background:c==="po"?"#111827":"#fff",color:c==="po"?"#fff":"#111827"},children:"Active Learning PO Mapping"})]}),o&&n.jsx("div",{style:{marginBottom:12,fontSize:12,color:o.startsWith("Saved")?"#166534":"#b91c1c"},children:o}),c==="po"?n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:12,background:"#fff"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:900},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,textAlign:"left",background:"#f8fafc"},children:"Activity"}),vJ.map(G=>n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,textAlign:"center",background:"#fff7ed"},children:G},G))]})}),n.jsx("tbody",{children:w.map((G,ne)=>n.jsxs("tr",{style:{background:ne%2===0?"#fff":"#f9fafb"},children:[n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10,fontWeight:600},children:G.label}),G.values.map((z,he)=>n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10,textAlign:"center"},children:n.jsx("input",{type:"checkbox",checked:!!z,onChange:X=>S(G.label,he,X.target.checked)})},`${G.key}-${he}`))]},G.key))})]})}):n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Global Term Label"}),n.jsx("input",{value:r.termLabel??"",onChange:G=>s(ne=>({...ne,termLabel:G.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d1d5db",width:260}})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"SSA1 Headers"}),n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[n.jsxs("label",{style:{fontSize:12},children:["Total Max",n.jsx("input",{type:"number",value:String(((T=(O=r.assessments)==null?void 0:O.ssa1)==null?void 0:T.maxTotal)??20),onChange:G=>s(ne=>{var z;return{...ne,assessments:{...ne.assessments||{},ssa1:{...((z=ne.assessments)==null?void 0:z.ssa1)||{},maxTotal:Number(G.target.value||0)}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90}})]}),n.jsxs("label",{style:{fontSize:12},children:["CO1 Max",n.jsx("input",{type:"number",value:String(((N=(A=(W=r.assessments)==null?void 0:W.ssa1)==null?void 0:A.coMax)==null?void 0:N.co1)??10),onChange:G=>s(ne=>{var z,he,X;return{...ne,assessments:{...ne.assessments||{},ssa1:{...((z=ne.assessments)==null?void 0:z.ssa1)||{},coMax:{...((X=(he=ne.assessments)==null?void 0:he.ssa1)==null?void 0:X.coMax)||{},co1:Number(G.target.value||0)}}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90}})]}),n.jsxs("label",{style:{fontSize:12},children:["CO2 Max",n.jsx("input",{type:"number",value:String(((re=(K=(P=r.assessments)==null?void 0:P.ssa1)==null?void 0:K.coMax)==null?void 0:re.co2)??10),onChange:G=>s(ne=>{var z,he,X;return{...ne,assessments:{...ne.assessments||{},ssa1:{...((z=ne.assessments)==null?void 0:z.ssa1)||{},coMax:{...((X=(he=ne.assessments)==null?void 0:he.ssa1)==null?void 0:X.coMax)||{},co2:Number(G.target.value||0)}}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90}})]})]})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Formative 1 Headers"}),n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[n.jsxs("label",{style:{fontSize:12},children:["Part Max",n.jsx("input",{type:"number",value:String(((Fe=(ge=r.assessments)==null?void 0:ge.formative1)==null?void 0:Fe.maxPart)??5),onChange:G=>s(ne=>{var z;return{...ne,assessments:{...ne.assessments||{},formative1:{...((z=ne.assessments)==null?void 0:z.formative1)||{},maxPart:Number(G.target.value||0)}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90}})]}),n.jsxs("label",{style:{fontSize:12},children:["Total Max",n.jsx("input",{type:"number",value:String(((q=(R=r.assessments)==null?void 0:R.formative1)==null?void 0:q.maxTotal)??20),onChange:G=>s(ne=>{var z;return{...ne,assessments:{...ne.assessments||{},formative1:{...((z=ne.assessments)==null?void 0:z.formative1)||{},maxTotal:Number(G.target.value||0)}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90}})]}),n.jsxs("label",{style:{fontSize:12},children:["CO Max",n.jsx("input",{type:"number",value:String(((fe=(me=r.assessments)==null?void 0:me.formative1)==null?void 0:fe.maxCo)??10),onChange:G=>s(ne=>{var z;return{...ne,assessments:{...ne.assessments||{},formative1:{...((z=ne.assessments)==null?void 0:z.formative1)||{},maxCo:Number(G.target.value||0)}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90}})]})]})]}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[n.jsx("div",{style:{fontWeight:800,marginBottom:10},children:"CIA 1"}),n.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"stretch",marginBottom:12},children:[n.jsxs("div",{style:{flex:"1 1 360px",border:"1px solid #eef2f7",borderRadius:12,padding:12,background:"#fbfdff"},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"CIA1 Limits"}),n.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:10},children:[n.jsxs("label",{style:{fontSize:12},children:["CO-1 Max",n.jsx("input",{type:"number",value:String(((I=(U=(E=r.assessments)==null?void 0:E.cia1)==null?void 0:U.coMax)==null?void 0:I.co1)??Zf(F).co1),onChange:G=>s(ne=>{var z,he,X;return{...ne,assessments:{...ne.assessments||{},cia1:{...((z=ne.assessments)==null?void 0:z.cia1)||{},coMax:{...(X=(he=ne.assessments)==null?void 0:he.cia1)==null?void 0:X.coMax,co1:Math.max(0,Number(G.target.value||0))}}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90,textAlign:"center"}})]}),n.jsxs("label",{style:{fontSize:12},children:["CO-2 Max",n.jsx("input",{type:"number",value:String(((Q=(te=(M=r.assessments)==null?void 0:M.cia1)==null?void 0:te.coMax)==null?void 0:Q.co2)??Zf(F).co2),onChange:G=>s(ne=>{var z,he,X;return{...ne,assessments:{...ne.assessments||{},cia1:{...((z=ne.assessments)==null?void 0:z.cia1)||{},coMax:{...(X=(he=ne.assessments)==null?void 0:he.cia1)==null?void 0:X.coMax,co2:Math.max(0,Number(G.target.value||0))}}}}}),style:{marginLeft:8,padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90,textAlign:"center"}})]})]}),n.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:6},children:"BTL Max Marks (1 to 6)"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, minmax(70px, 1fr))",gap:8},children:["1","2","3","4","5","6"].map(G=>{var ne,z,he;return n.jsxs("label",{style:{fontSize:12,display:"flex",flexDirection:"column",gap:4},children:[n.jsxs("span",{style:{color:"#111827"},children:["BTL-",G]}),n.jsx("input",{type:"number",value:String(((he=(z=(ne=r.assessments)==null?void 0:ne.cia1)==null?void 0:z.btlMax)==null?void 0:he[G])??Np(F)[G]),onChange:X=>s(H=>{var oe,D,Y;return{...H,assessments:{...H.assessments||{},cia1:{...((oe=H.assessments)==null?void 0:oe.cia1)||{},btlMax:{...((Y=(D=H.assessments)==null?void 0:D.cia1)==null?void 0:Y.btlMax)||{},[G]:Math.max(0,Number(X.target.value||0))}}}}}),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db",textAlign:"center"}})]},G)})})]}),n.jsxs("div",{style:{flex:"2 1 520px",border:"1px solid #eef2f7",borderRadius:12,padding:12,background:"#fff"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"center"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:700},children:"CIA1 Question Headers"}),n.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Select question rows and apply Max / CO / BTL in bulk."})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[n.jsx("input",{placeholder:"Max",value:p,onChange:G=>f(G.target.value),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90}}),n.jsxs("select",{value:x,onChange:G=>g(G.target.value),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db"},children:[n.jsx("option",{value:"",children:"CO"}),n.jsx("option",{value:"1",children:"CO-1"}),n.jsx("option",{value:"2",children:"CO-2"}),n.jsx("option",{value:"1&2",children:"CO-1&CO-2 (split)"})]}),n.jsxs("select",{value:y,onChange:G=>m(G.target.value),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db"},children:[n.jsx("option",{value:"",children:"BTL"}),[1,2,3,4,5,6].map(G=>n.jsxs("option",{value:String(G),children:["BTL-",G]},G))]}),n.jsxs("button",{onClick:C,disabled:!L.length,style:{padding:"8px 10px"},children:["Apply to Selected (",L.length,")"]})]})]}),n.jsx("div",{style:{overflowX:"auto",marginTop:10,border:"1px solid #e5e7eb",borderRadius:10},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:720},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,background:"#f8fafc",textAlign:"center"},children:"Sel"}),n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,background:"#f8fafc",textAlign:"left"},children:"Key"}),n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,background:"#f8fafc",textAlign:"left"},children:"Label"}),n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,background:"#f8fafc",textAlign:"center"},children:"Max"}),n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,background:"#f8fafc",textAlign:"center"},children:"CO"}),n.jsx("th",{style:{borderBottom:"1px solid #e5e7eb",padding:10,background:"#f8fafc",textAlign:"center"},children:"BTL"})]})}),n.jsx("tbody",{children:F.map((G,ne)=>n.jsxs("tr",{style:{background:ne%2===0?"#fff":"#f9fafb"},children:[n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10,textAlign:"center"},children:n.jsx("input",{type:"checkbox",checked:!!u[G.key],onChange:z=>h(he=>({...he,[G.key]:z.target.checked}))})}),n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10},children:G.key}),n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10},children:n.jsx("input",{value:G.label,onChange:z=>s(he=>{var oe,D,Y;const H=(((D=(oe=he.assessments)==null?void 0:oe.cia1)==null?void 0:D.questions)||$l).slice().map(le=>le.key===G.key?{...le,label:z.target.value}:le);return{...he,assessments:{...he.assessments||{},cia1:{...((Y=he.assessments)==null?void 0:Y.cia1)||{},questions:H}}}}),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db",width:"100%"}})}),n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10,textAlign:"center"},children:n.jsx("input",{type:"number",value:String(G.max),onChange:z=>s(he=>{var Y,le,$e,je,We,Ee,Re;const X=Math.max(0,Number(z.target.value||0)),H=(((le=(Y=he.assessments)==null?void 0:Y.cia1)==null?void 0:le.questions)||$l).slice(),oe=H.map(Ve=>Ve.key===G.key?{...Ve,max:X}:Ve),D=cx({prevQuestions:H,nextQuestions:oe,existingCoMax:(je=($e=he.assessments)==null?void 0:$e.cia1)==null?void 0:je.coMax,existingBtlMax:(Ee=(We=he.assessments)==null?void 0:We.cia1)==null?void 0:Ee.btlMax});return{...he,assessments:{...he.assessments||{},cia1:{...((Re=he.assessments)==null?void 0:Re.cia1)||{},questions:oe,coMax:D.coMax,btlMax:D.btlMax}}}}),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db",width:90,textAlign:"center"}})}),n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10,textAlign:"center"},children:n.jsxs("select",{value:String(G.co),onChange:z=>s(he=>{var le,$e,je,We,Ee,Re,Ve;const X=String(z.target.value),H=X==="1&2"?"1&2":Number(X)===2?2:1,oe=((($e=(le=he.assessments)==null?void 0:le.cia1)==null?void 0:$e.questions)||$l).slice(),D=oe.map(St=>St.key===G.key?{...St,co:H}:St),Y=cx({prevQuestions:oe,nextQuestions:D,existingCoMax:(We=(je=he.assessments)==null?void 0:je.cia1)==null?void 0:We.coMax,existingBtlMax:(Re=(Ee=he.assessments)==null?void 0:Ee.cia1)==null?void 0:Re.btlMax});return{...he,assessments:{...he.assessments||{},cia1:{...((Ve=he.assessments)==null?void 0:Ve.cia1)||{},questions:D,coMax:Y.coMax,btlMax:Y.btlMax}}}}),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db"},children:[n.jsx("option",{value:"1",children:"1"}),n.jsx("option",{value:"2",children:"2"}),n.jsx("option",{value:"1&2",children:"1&2"})]})}),n.jsx("td",{style:{borderTop:"1px solid #f1f5f9",padding:10,textAlign:"center"},children:n.jsx("select",{value:String(G.btl),onChange:z=>s(he=>{var Y,le,$e,je,We,Ee,Re;const X=Math.min(6,Math.max(1,Number(z.target.value||1))),H=(((le=(Y=he.assessments)==null?void 0:Y.cia1)==null?void 0:le.questions)||$l).slice(),oe=H.map(Ve=>Ve.key===G.key?{...Ve,btl:X}:Ve),D=cx({prevQuestions:H,nextQuestions:oe,existingCoMax:(je=($e=he.assessments)==null?void 0:$e.cia1)==null?void 0:je.coMax,existingBtlMax:(Ee=(We=he.assessments)==null?void 0:We.cia1)==null?void 0:Ee.btlMax});return{...he,assessments:{...he.assessments||{},cia1:{...((Re=he.assessments)==null?void 0:Re.cia1)||{},questions:oe,coMax:D.coMax,btlMax:D.btlMax}}}}),style:{padding:6,borderRadius:8,border:"1px solid #d1d5db"},children:[1,2,3,4,5,6].map(z=>n.jsx("option",{value:String(z),children:z},z))})})]},G.key))})]})})]})]})]})]}),n.jsx("div",{style:{marginTop:16,display:"flex",gap:12},children:n.jsx("button",{onClick:k,disabled:a,style:{padding:"10px 14px",borderRadius:8,border:"1px solid #2563eb",background:"#2563eb",color:"#fff",fontWeight:600,cursor:"pointer"},children:a?"Saving...":c==="po"?"Save Global PO Mapping":"Save Assessment Headers"})})]})})}function _J(){var d,u;const e=Ji(),r=v.useMemo(()=>new URLSearchParams(e.search),[e.search]).get("tab")||"obe",[s,a]=v.useState(r),i=((d=window.__APP_ME__)==null?void 0:d.permissions)||((u=window.__ME__)==null?void 0:u.permissions)||[],l=(Array.isArray(i)?i.map(h=>String(h||"").toLowerCase()):[]).includes("obe.master.manage"),c=v.useMemo(()=>{const h=[];return h.push({key:"obe",label:"OBE"}),l&&(h.push({key:"obe_master",label:"OBE Master"}),h.push({key:"due_dates",label:"OBE: Due Dates"})),h},[l]);return Jr.useEffect(()=>{var h;c.some(p=>p.key===s)||a(((h=c[0])==null?void 0:h.key)||"obe")},[c,s]),v.useEffect(()=>{const h=new URLSearchParams(e.search).get("tab");h&&c.some(p=>p.key===h)&&h!==s&&a(h)},[e.search]),n.jsxs("main",{style:{padding:18,minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n.jsxs("div",{style:{marginBottom:12},children:[n.jsx("h2",{style:{margin:0,fontSize:20},children:"Academic"}),n.jsx("div",{style:{color:"#6b7280",marginTop:6},children:"Quick access to OBE tools."})]}),n.jsx("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:18},children:c.map(h=>n.jsx("button",{onClick:()=>a(h.key),style:{padding:"8px 12px",borderRadius:8,border:s===h.key?"1px solid #10b981":"1px solid #e5e7eb",background:s===h.key?"#ecfdf5":"#fff",fontWeight:700,cursor:"pointer"},children:h.label},h.key))}),n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff"},children:[s==="obe"&&n.jsx(w8,{}),s==="obe_master"&&l&&n.jsx(SJ,{}),s==="due_dates"&&l&&n.jsx(tw,{})]})]})}const kJ="https://db.zynix.us",_4=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:8000":kJ;function k4(){const e=window.localStorage.getItem("access");return e?{Authorization:`Bearer ${e}`}:{}}function jJ(){var T,W;const[e,t]=v.useState(null),[r,s]=v.useState(!1),[a,i]=v.useState(null),[o,l]=v.useState([]),[c,d]=v.useState(null),[u,h]=v.useState(""),[p,f]=v.useState("pending"),[x,g]=v.useState(!1),[y,m]=v.useState(null),[w,S]=v.useState(null),[k,F]=v.useState(null),L=v.useMemo(()=>o.filter(A=>{const N=String(A.marks??"").trim().toUpperCase(),P=String(A.btl??"").trim().toUpperCase(),K=String(A.course_outcomes??"").trim().toUpperCase();return!(N==="(OR)"&&P==="(OR)"&&K==="(OR)")}),[o]);async function C(){if(!e){i("Please select a .docx file first.");return}s(!0),i(null),m(null),S(null);const A=new FormData;A.append("file",e);try{const N=await fetch(`${_4}/api/template/scan-docx`,{method:"POST",headers:{...k4()},body:A});if(!N.ok){const re=await N.text();i(re||`Scan failed (${N.status})`),l([]);return}const P=await N.json(),K=Array.isArray(P==null?void 0:P.questions)?P.questions:[];d((P==null?void 0:P.debug)??null);try{console.debug("scan_docx response: questions=",K.length,"sample=",K[0]?{q0:K[0].question_text,imgs:(K[0].images||[]).slice(0,2)}:null),K.length&&K.forEach((re,ge)=>{console.log(`Q#${ge+1} images:`,Array.isArray(re.images)?re.images.map(Fe=>typeof Fe=="string"?Fe.slice(0,80):typeof Fe):re.images)})}catch(re){console.warn("scan_docx debug log failed",re)}l(K)}catch(N){i((N==null?void 0:N.message)||"Scan failed"),l([])}finally{s(!1)}}async function O(){if(!u.trim()){S("Title is required to import.");return}g(!0),S(null),m(null);try{const A={title:u.trim(),status:p,questions:L},N=await fetch(`${_4}/api/import/questions`,{method:"POST",headers:{"Content-Type":"application/json",...k4()},body:JSON.stringify(A)});if(!N.ok){const K=await N.text();S(K||`Import failed (${N.status})`);return}const P=await N.json();m(P)}catch(A){S((A==null?void 0:A.message)||"Import failed")}finally{g(!1)}}return n.jsxs("div",{style:{maxWidth:1100,margin:"0 auto",padding:24},children:[n.jsx("h1",{style:{marginTop:0},children:"Question Import"}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("input",{type:"file",accept:".docx",onChange:A=>{var N;return t(((N=A.target.files)==null?void 0:N[0])||null)}}),n.jsx("button",{onClick:C,disabled:r||!e,children:r?"Scanning":"Scan DOCX"}),n.jsx("div",{style:{color:"#666",fontSize:13},children:o.length?`${o.length} scanned (${L.length} visible)`:""})]}),a&&n.jsx("div",{style:{marginTop:10,color:"#b91c1c"},children:a}),c&&n.jsxs("div",{style:{marginTop:10,padding:10,background:"#f8fafc",border:"1px solid #e6eef8",borderRadius:8},children:[n.jsx("div",{style:{fontSize:13,color:"#0747a6",fontWeight:700},children:"Scan debug"}),n.jsxs("div",{style:{fontSize:13,color:"#333"},children:["Questions parsed: ",c.parsed_questions??"-"]}),n.jsxs("div",{style:{fontSize:13,color:"#333"},children:["Total images: ",c.total_images??0]}),n.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:6},children:["Sample questions: ",Array.isArray(c.sample_questions)?c.sample_questions.join(" | "):"-"]}),n.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:6},children:["Sample image prefix: ",n.jsx("code",{style:{background:"#fff",padding:"2px 6px",borderRadius:4},children:String(c.sample_image_prefix||"").slice(0,200)})]}),n.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:6},children:["First questions' images (raw):",n.jsx("pre",{style:{whiteSpace:"pre-wrap",maxHeight:160,overflow:"auto",background:"#fff",padding:8,borderRadius:6},children:JSON.stringify(o.slice(0,3).map(A=>A.images),null,2)})]})]}),n.jsx("hr",{style:{margin:"20px 0"}}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("input",{value:u,onChange:A=>h(A.target.value),placeholder:"Title (e.g., Midterm 2026)",style:{padding:"8px 10px",border:"1px solid #e5e7eb",borderRadius:6,minWidth:260}}),n.jsxs("select",{value:p,onChange:A=>f(A.target.value),style:{padding:"8px 10px",border:"1px solid #e5e7eb",borderRadius:6},children:[n.jsx("option",{value:"pending",children:"pending"}),n.jsx("option",{value:"approved",children:"approved"})]}),n.jsx("button",{onClick:O,disabled:x||L.length===0,children:x?"Importing":"Import to Bank"})]}),w&&n.jsx("div",{style:{marginTop:10,color:"#b91c1c"},children:w}),y&&n.jsxs("div",{style:{marginTop:10,color:"#166534"},children:["Imported ",y.inserted," question(s)",(T=y.failed)!=null&&T.length?`, ${y.failed.length} failed.`:"."]}),(W=y==null?void 0:y.failed)!=null&&W.length?n.jsxs("div",{style:{marginTop:10},children:[n.jsx("h3",{style:{margin:"10px 0"},children:"Failures"}),n.jsx("ul",{children:y.failed.map(A=>n.jsxs("li",{style:{color:"#b91c1c"},children:["#",A.index+1,": ",A.error]},A.index))})]}):null,n.jsx("hr",{style:{margin:"20px 0"}}),n.jsx("h2",{style:{margin:"10px 0"},children:"Preview"}),L.length===0?n.jsx("div",{style:{color:"#666"},children:"No questions to preview yet."}):n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[L.slice(0,50).map((A,N)=>n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:14},children:[n.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:[N+1,". ",A.question_text]}),n.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",color:"#555",fontSize:13,marginBottom:8},children:[A.marks!=null&&n.jsxs("span",{children:["Marks: ",String(A.marks)]}),A.btl!=null&&n.jsxs("span",{children:["BTL: ",String(A.btl)]}),A.course_outcomes&&n.jsxs("span",{children:["CO: ",A.course_outcomes]}),A.chapter&&n.jsxs("span",{children:["Chapter: ",A.chapter]})]}),Array.isArray(A.options)&&A.options.length?n.jsx("ol",{type:"a",style:{marginTop:0},children:A.options.map((P,K)=>n.jsx("li",{children:String(P)},K))}):null,A.correct_answer?n.jsxs("div",{style:{marginTop:6,color:"#111",fontSize:13},children:[n.jsx("strong",{children:"Answer:"})," ",A.correct_answer]}):null,A.answer_text?n.jsxs("div",{style:{marginTop:4,color:"#444",fontSize:13},children:[n.jsx("strong",{children:"Explanation:"})," ",A.answer_text]}):null,Array.isArray(A.images)&&A.images.length?n.jsx("div",{style:{marginTop:10,display:"flex",gap:10,flexWrap:"wrap"},children:A.images.slice(0,6).map((P,K)=>{let re=null;try{if(typeof P=="string")re=P,!re.startsWith("data:")&&/^[A-Za-z0-9+/=\n\r]+$/.test(re)&&re.length>100&&(re=`data:image/png;base64,${re.replace(/\s+/g,"")}`);else if(P&&typeof P=="object"){if(P.url)re=P.url;else if(P.base64)re=P.base64.startsWith("data:")?P.base64:`data:image/png;base64,${P.base64}`;else if(P.binary&&P.binary instanceof Uint8Array){const ge=new Blob([P.binary],{type:"image/png"});re=URL.createObjectURL(ge)}}else if(P instanceof Uint8Array){const ge=new Blob([P],{type:"image/png"});re=URL.createObjectURL(ge)}}catch{re=null}return re?n.jsx("img",{src:re,alt:`q${N+1}-img${K+1}`,onClick:()=>F(re),style:{maxHeight:140,borderRadius:8,border:"1px solid #eee",cursor:"pointer",objectFit:"contain"}},K):null})}):null]},N)),L.length>50&&n.jsx("div",{style:{color:"#666"},children:"Showing first 50 questions."})]}),k&&n.jsx("div",{role:"dialog",onClick:()=>{F(null)},style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},children:n.jsx("div",{onClick:A=>A.stopPropagation(),style:{maxWidth:"90%",maxHeight:"90%",padding:12},children:n.jsx("img",{src:k,alt:"preview",style:{maxWidth:"100%",maxHeight:"100%",borderRadius:8}})})})]})}function NJ({courseId:e,classType:t,questionPaperType:r,enabledAssessments:s}){const[a,i]=v.useState(e||""),[o,l]=v.useState(!1);return v.useEffect(()=>{e&&e!==a&&i(e),!e&&a&&i("")},[e]),n.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #ecfdf5 0%, #ffffff 60%)",padding:"0"},children:n.jsxs("div",{style:{background:"#ffffff",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[n.jsxs("div",{style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"#ffffff",padding:"20px 24px",flexShrink:0},children:[n.jsx("div",{style:{fontSize:24,fontWeight:800},children:"Mark Entry"}),n.jsxs("div",{style:{fontSize:14,opacity:.9},children:[" ",a?`Course: ${a}`:"No course selected"," "]})]}),n.jsxs("div",{style:{padding:"20px 24px",flex:1},children:[!e&&n.jsxs("div",{className:"obe-card",style:{marginBottom:12},children:[n.jsx("label",{style:{display:"block",fontSize:12,fontWeight:700,color:"#065f46",textTransform:"uppercase",letterSpacing:"0.03em"},children:"Course ID"}),n.jsx("input",{value:a,onChange:c=>i(c.target.value),placeholder:"Enter course id",className:"obe-input",style:{marginTop:6,...o?{boxShadow:"0 0 0 3px rgba(16,185,129,0.2)",borderColor:"#a7f3d0"}:{}},onFocus:()=>l(!0),onBlur:()=>l(!1)})]}),a?n.jsx(Yw,{subjectId:a,classType:t,questionPaperType:r,enabledAssessments:s}):n.jsx("div",{style:{background:"#d1fae5",border:"1px solid #a7f3d0",color:"#065f46",fontSize:14,padding:12,borderRadius:10},children:"Select a course to start mark entry."})]})]})})}const Io={header:["CO1","CO1","CO1","CO2","CO2","CO2","CO3","CO3","CO3","CO4","CO4","CO4","CO1","CO2","CO3","CO4","CO5"],weights:[1.5,3,2.5,1.5,3,2.5,1.5,3,2.5,1.5,3,2.5,2,2,2,2,4],cycles:["ssa","cia","fa","ssa","cia","fa","ssa","cia","fa","ssa","cia","fa","ME","ME","ME","ME","ME"]},AJ=[{key:"q1",max:2,co:1},{key:"q2",max:2,co:1},{key:"q3",max:2,co:1},{key:"q4",max:2,co:2},{key:"q5",max:2,co:2},{key:"q6",max:2,co:2},{key:"q7",max:16,co:1},{key:"q8",max:16,co:2},{key:"q9",max:16,co:"1&2"}],CJ=[{key:"q1",max:2,co:3},{key:"q2",max:2,co:3},{key:"q3",max:2,co:3},{key:"q4",max:2,co:4},{key:"q5",max:2,co:4},{key:"q6",max:2,co:4},{key:"q7",max:16,co:3},{key:"q8",max:16,co:4},{key:"q9",max:16,co:"3&4"}],dx=[{key:"q1",max:2},{key:"q2",max:2},{key:"q3",max:2},{key:"q4",max:2},{key:"q5",max:2},{key:"q6",max:2},{key:"q7",max:2},{key:"q8",max:2},{key:"q9",max:2},{key:"q10",max:2},{key:"q11",max:14},{key:"q12",max:14},{key:"q13",max:14},{key:"q14",max:14},{key:"q15",max:14},{key:"q16",max:10}],j4=[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5,5];function qn(e,t,r){return Math.max(t,Math.min(r,e))}function ad(e){return Math.round(e*100)/100}function Ni(e){if(e===""||e==null)return null;const t=Number(e);return Number.isFinite(t)?t:null}function N4(e,t){const r=String((e==null?void 0:e.name)||"").trim().toLowerCase(),s=String((t==null?void 0:t.name)||"").trim().toLowerCase();if(r&&s){const o=r.localeCompare(s);if(o)return o}else if(r||s)return r?-1:1;const a=String((e==null?void 0:e.reg_no)||"").trim(),i=String((t==null?void 0:t.reg_no)||"").trim();return a.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})}function EJ(e){return e==="1&2"?{co1:.5,co2:.5}:e===2?{co1:0,co2:1}:{co1:1,co2:0}}function TJ(e){return e==="3&4"?{co3:.5,co4:.5}:e===4?{co3:0,co4:1}:{co3:1,co4:0}}function A4(e,t,r,s){const a=Number(e),i=Number(t),o=Number(r),l=Number(s),c=(Number.isFinite(i)?i:0)+(Number.isFinite(o)?o:0)+(Number.isFinite(l)?l:0);if(!Number.isFinite(a)||a<=0||!c)return[0,0,0];const d=ad(a*(i||0)/c),u=ad(a*(o||0)/c),h=ad(a*(l||0)/c);return[d,u,h]}function LJ(e,t){const r=On(e),s=Io.header,a=Io.cycles,i=["CO1-SSA","CO1-CIA","CO1-FA","CO2-SSA","CO2-CIA","CO2-FA","CO3-SSA","CO3-CIA","CO3-FA","CO4-SSA","CO4-CIA","CO4-FA","ME-CO1","ME-CO2","ME-CO3","ME-CO4","ME-CO5"];let o=Array.from({length:17},(p,f)=>f),l=[...a],c=[...i];if(r==="TCPR"&&(l=l.map((p,f)=>f===2||f===5||f===8||f===11?"review":p),c=c.map((p,f)=>f===2||f===5||f===8||f===11?p.replace("-FA","-Review"):p)),r==="TCPL"&&(l=l.map((p,f)=>f===2||f===5||f===8||f===11?"lab":p),c=c.map((p,f)=>f===2||f===5?p.replace("-FA","-LAB1"):f===8||f===11?p.replace("-FA","-LAB2"):p)),r==="LAB"||r==="PRACTICAL")return o=[1,4,7,10,16],{visible:o,header:["CO1","CO2","CO3","CO4","ME"],cycles:["CIA 1","CIA 1","CIA 2","CIA 2","MODEL"],labels:["CO1-CIA1","CO2-CIA1","CO3-CIA2","CO4-CIA2","ME-CO5"]};if(r==="SPECIAL"&&t.size){const p=[],f=(x,g)=>{if(x)for(const y of g)p.push(y)};f(t.has("ssa1"),[0,3]),f(t.has("cia1"),[1,4]),f(t.has("formative1"),[2,5]),f(t.has("ssa2"),[6,9]),f(t.has("cia2"),[7,10]),f(t.has("formative2"),[8,11]),o=p}const d=o.map(p=>s[p]),u=o.map(p=>l[p]),h=o.map(p=>c[p]);return{visible:o,header:d,cycles:u,labels:h}}function FJ({courseId:e,enabledAssessments:t}){const r=v.useMemo(()=>new Set((t||[]).map(Q=>String(Q||"").trim().toLowerCase()).filter(Boolean)),[t]),[s,a]=v.useState([]),[i,o]=v.useState(null),[l,c]=v.useState(null),[d,u]=v.useState(null),[h,p]=v.useState(null),[f,x]=v.useState([]),[g,y]=v.useState(null),[m,w]=v.useState(!1),[S,k]=v.useState({ssa1:1.5,cia1:3,formative1:2.5}),[F,L]=v.useState([...Io.weights]),[C,O]=v.useState({ssa1:{},ssa2:{},f1:{},f2:{},cia1:null,cia2:null}),[T,W]=v.useState({r1:{},r2:{}}),[A,N]=v.useState({cia1:null,cia2:null,model:null}),[P,K]=v.useState({lab1:null,lab2:null}),[re,ge]=v.useState(!1),[Fe,R]=v.useState(null);v.useEffect(()=>{let Q=!0;return(async()=>{try{const G=await Sl();if(!Q)return;p(G||null)}catch{}})(),()=>{Q=!1}},[e]),v.useEffect(()=>{let Q=!0;return(async()=>{var G;try{const ne=await wl();if(!Q)return;let z=(ne||[]).filter(H=>String(H.subject_code)===String(e));if(z.length===0)try{const H=await hr(`/api/academics/teaching-assignments/?subject_code=${encodeURIComponent(String(e||""))}`);if(H.ok){const oe=await H.json();z=(Array.isArray(oe.results)?oe.results:Array.isArray(oe)?oe:oe.items||[])||[]}}catch(H){console.warn("Server TA list fetch failed:",H)}a(z);const he=Bn(`internalMark_selectedTa_${e}`),X=(typeof he=="number"&&z.some(H=>H.id===he)?he:(G=z[0])==null?void 0:G.id)??null;o(X),c(null)}catch(ne){if(!Q)return;a([]),o(null),c((ne==null?void 0:ne.message)||"Failed to load teaching assignments")}})(),()=>{Q=!1}},[e]),v.useEffect(()=>{!e||i==null||yn(`internalMark_selectedTa_${e}`,i)},[e,i]),v.useEffect(()=>{let Q=!0;return(async()=>{try{const G=(s||[]).find(he=>he.id===i)||null,ne=G==null?void 0:G.curriculum_row_id;if(!ne){const he=String(e).trim().toUpperCase(),X=await vo();if(!Q)return;const H=(X||[]).find(le=>String(le.course_code||"").trim().toUpperCase()===he),oe=(H==null?void 0:H.class_type)??null;if(oe){u(oe);return}const D=await jc();if(!Q)return;const Y=(D||[]).find(le=>String(le.course_code||"").trim().toUpperCase()===he);u((Y==null?void 0:Y.class_type)??null);return}const z=await rw(Number(ne));if(!Q)return;u((z==null?void 0:z.class_type)??null)}catch{Q&&u(null)}})(),()=>{Q=!1}},[s,i,e]),v.useEffect(()=>{let Q=!0;return(async()=>{try{const G=On(d),ne=z=>{if(!z||typeof z!="object")return!1;const he=Number.isFinite(Number(z.ssa1))?Number(z.ssa1):1.5,X=Number.isFinite(Number(z.cia1))?Number(z.cia1):3,H=Number.isFinite(Number(z.formative1))?Number(z.formative1):2.5;k({ssa1:he,cia1:X,formative1:H});const oe=z.internal_mark_weights;if(Array.isArray(oe)&&oe.length){let D=oe.map(Y=>{const le=Number(Y);return Number.isFinite(le)?le:0});if(D.length===13&&Io.weights.length===17){const[Y,le,$e]=A4(D[0]||0,he,X,H),[je,We,Ee]=A4(D[1]||0,he,X,H);D=[Y,le,$e,je,We,Ee,...D.slice(2)]}for(;D.length<Io.weights.length;)D.push(Io.weights[D.length]??0);L(D.slice(0,Io.weights.length))}else L([...Io.weights]);return!0};try{const z=await ig();if(!Q)return;const he=z&&z[G]||null;if(ne(he))return}catch{}try{const z=Bn("iqac_class_type_weights"),he=z&&z[G]||null;if(ne(he))return}catch{}}catch{}})(),()=>{Q=!1}},[d]),v.useEffect(()=>{let Q=!0;return(async()=>{if(i){w(!0),y(null);try{const ne=(s||[]).find(z=>z.id===i)||null;if(ne&&ne.elective_subject_id&&!ne.section_id){const z=ne.elective_subject_id,he=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${encodeURIComponent(String(z))}`);if(!he.ok)throw new Error(`Elective-choices fetch failed: ${he.status}`);const X=await he.json();if(!Q)return;const oe=((Array.isArray(X.results)?X.results:Array.isArray(X)?X:X.items||[])||[]).map(D=>({id:Number(D.student_id??D.id),reg_no:String(D.reg_no??D.registration_no??D.regno??""),name:String(D.name??D.full_name??D.username??""),section:D.section_name??D.section??null}));if(!Q)return;x(oe.filter(D=>Number.isFinite(D.id)).sort(N4))}else{const z=await Jo(i);if(!Q)return;const he=(z.students||[]).map(X=>({id:Number(X.id),reg_no:String(X.reg_no??""),name:String(X.name??""),section:X.section??null})).filter(X=>Number.isFinite(X.id)).sort(N4);x(he)}}catch(ne){if(!Q)return;x([]),y((ne==null?void 0:ne.message)||"Failed to load roster")}finally{Q&&w(!1)}}})(),()=>{Q=!1}},[i]),v.useEffect(()=>{let Q=!0;return(async()=>{ge(!0),R(null);try{const ne=On(d),z=i??void 0,he=ne==="TCPL",X=ne==="TCPR",H=ne==="LAB"||ne==="PRACTICAL",oe=ne==="SPECIAL"&&r.size,D=be=>oe?r.has(String(be).toLowerCase()):!0;W({r1:{},r2:{}}),N({cia1:null,cia2:null,model:null}),K({lab1:null,lab2:null});let Y=null,le=null,$e=null,je=null,We=null,Ee=null,Re=null,Ve=null,St=null,rt=null,ze=null,Ie=null,ot=null;if(H){try{const be=await En("cia1",e,z);be!=null&&be.draft&&(St={data:be.draft.data??be.draft})}catch{}try{const be=await En("cia2",e,z);be!=null&&be.draft&&(rt={data:be.draft.data??be.draft})}catch{}try{const be=await En("model",e,z);be!=null&&be.draft&&(ze={data:be.draft.data??be.draft})}catch{}if(!(St!=null&&St.data))try{St=await wa("cia1",e,z)}catch{St=null}if(!(rt!=null&&rt.data))try{rt=await wa("cia2",e,z)}catch{rt=null}if(!(ze!=null&&ze.data))try{ze=await wa("model",e,z)}catch{ze=null}if(!Q)return;N({cia1:(St==null?void 0:St.data)??null,cia2:(rt==null?void 0:rt.data)??null,model:(ze==null?void 0:ze.data)??null}),O({ssa1:{},ssa2:{},f1:{},f2:{},cia1:null,cia2:null});return}if(D("ssa1"))try{const be=await En("ssa1",e,z);be!=null&&be.draft&&be.draft.marks&&(Y={marks:be.draft.marks})}catch{}if(D("ssa2"))try{const be=await En("ssa2",e,z);be!=null&&be.draft&&be.draft.marks&&(le={marks:be.draft.marks})}catch{}if(D("ssa1")&&!(Y!=null&&Y.marks))try{Y=await S0(e,z)}catch{Y=null}if(D("ssa2")&&!(le!=null&&le.marks))try{le=await Op(e,z)}catch{le=null}if(X){try{const be=await En("review1",e,z);be!=null&&be.draft&&be.draft.marks&&(Re={marks:be.draft.marks})}catch{}try{const be=await En("review2",e,z);be!=null&&be.draft&&be.draft.marks&&(Ve={marks:be.draft.marks})}catch{}if(!(Re!=null&&Re.marks))try{Re=await og(e,z)}catch{Re=null}if(!(Ve!=null&&Ve.marks))try{Ve=await lg(e,z)}catch{Ve=null}if(!Q)return;W({r1:(Re==null?void 0:Re.marks)||{},r2:(Ve==null?void 0:Ve.marks)||{}})}if(he){try{const be=await En("formative1",e,z);be!=null&&be.draft&&(Ie={data:be.draft.data??be.draft})}catch{}try{const be=await En("formative2",e,z);be!=null&&be.draft&&(ot={data:be.draft.data??be.draft})}catch{}if(!(Ie!=null&&Ie.data))try{Ie=await wa("formative1",e,z)}catch{Ie=null}if(!(ot!=null&&ot.data))try{ot=await wa("formative2",e,z)}catch{ot=null}if(!Q)return;K({lab1:(Ie==null?void 0:Ie.data)??null,lab2:(ot==null?void 0:ot.data)??null})}else{if(!X&&D("formative1")){try{const be=await En("formative1",e,z);be!=null&&be.draft&&be.draft.marks&&($e={marks:be.draft.marks})}catch{}if(!($e!=null&&$e.marks))try{$e=await bu("formative1",e,z)}catch{$e=null}}if(!X&&D("formative2")){try{const be=await En("formative2",e,z);be!=null&&be.draft&&be.draft.marks&&(je={marks:be.draft.marks})}catch{}if(!(je!=null&&je.marks))try{je=await bu("formative2",e,z)}catch{je=null}}}if(D("cia1")){try{const be=await En("cia1",e,z);be!=null&&be.draft&&(We={data:be.draft.data??be.draft})}catch{}if(!(We!=null&&We.data))try{We=await vu("cia1",e,z)}catch{We=null}}if(D("cia2")){try{const be=await En("cia2",e,z);be!=null&&be.draft&&(Ee={data:be.draft.data??be.draft})}catch{}if(!(Ee!=null&&Ee.data))try{Ee=await vu("cia2",e,z)}catch{Ee=null}}if(!Q)return;O({ssa1:(Y==null?void 0:Y.marks)||{},ssa2:(le==null?void 0:le.marks)||{},f1:($e==null?void 0:$e.marks)||{},f2:(je==null?void 0:je.marks)||{},cia1:(We==null?void 0:We.data)||null,cia2:(Ee==null?void 0:Ee.data)||null})}catch(ne){if(!Q)return;R((ne==null?void 0:ne.message)||"Failed to load marks")}finally{Q&&ge(!1)}})(),()=>{Q=!1}},[e,d,r,i]);const q=v.useMemo(()=>LJ(d,r),[d,r]),me=v.useMemo(()=>{const G=(Array.isArray(F)&&F.length?F:Io.weights).slice(0,Io.weights.length);for(;G.length<Io.weights.length;)G.push(Io.weights[G.length]??0);const ne=q.visible.map(z=>G[z]??0);return{header:q.header,weights:ne,cycles:q.cycles,visible:q.visible,labels:q.labels}},[F,q]),fe=v.useMemo(()=>me.weights.map(G=>Number(G)||0).reduce((G,ne)=>G+ne,0),[me]),E=v.useMemo(()=>{const Q={co1:0,co2:0,co3:0,co4:0,co5:0};for(let G=0;G<dx.length;G++){const ne=dx[G],z=j4[G];z===1?Q.co1+=ne.max:z===2?Q.co2+=ne.max:z===3?Q.co3+=ne.max:z===4?Q.co4+=ne.max:z===5&&(Q.co5+=ne.max)}return Q},[]),U=v.useMemo(()=>{var pe,ee,ue,Ae,Le,ct,ce,xe,se,Se,Ze,et,Et,wt,gt,zt,Dt,mr;const Q=On(d),G=new Array(17).fill(0);for(let pt=0;pt<me.visible.length;pt++){const Xt=me.visible[pt];G[Xt]=Number(me.weights[pt])||0}const ne=G[0]||0,z=G[1]||0,he=G[2]||0,X=G[3]||0,H=G[4]||0,oe=G[5]||0,D=G[6]||0,Y=G[7]||0,le=G[8]||0,$e=G[9]||0,je=G[10]||0,We=G[11]||0,Ee=G[12]||0,Re=G[13]||0,Ve=G[14]||0,St=G[15]||0,rt=G[16]||0,ze=C.cia1&&typeof C.cia1=="object"?C.cia1:null,Ie=C.cia2&&typeof C.cia2=="object"?C.cia2:null,ot=Array.isArray(ze==null?void 0:ze.questions)?ze.questions.map(pt=>({key:String((pt==null?void 0:pt.key)||""),max:Number((pt==null?void 0:pt.max)||0),co:(pt==null?void 0:pt.co)==="1&2"?"1&2":Number(pt==null?void 0:pt.co)===2?2:1})).filter(pt=>pt.key):AJ,be=Array.isArray(Ie==null?void 0:Ie.questions)?Ie.questions.map(pt=>({key:String((pt==null?void 0:pt.key)||""),max:Number((pt==null?void 0:pt.max)||0),co:(pt==null?void 0:pt.co)==="3&4"?"3&4":Number(pt==null?void 0:pt.co)===4?4:3})).filter(pt=>pt.key):CJ,we=ze!=null&&ze.rowsByStudentId&&typeof ze.rowsByStudentId=="object"?ze.rowsByStudentId:{},Me=Ie!=null&&Ie.rowsByStudentId&&typeof Ie.rowsByStudentId=="object"?Ie.rowsByStudentId:{},Wt=ot.reduce((pt,Xt)=>pt+(Xt.co===1||Xt.co==="1&2"?Xt.max*(Xt.co==="1&2"?.5:1):0),0),Ct=ot.reduce((pt,Xt)=>pt+(Xt.co===2||Xt.co==="1&2"?Xt.max*(Xt.co==="1&2"?.5:1):0),0),pr=be.reduce((pt,Xt)=>pt+(Xt.co===3||Xt.co==="3&4"?Xt.max*(Xt.co==="3&4"?.5:1):0),0),fr=be.reduce((pt,Xt)=>pt+(Xt.co===4||Xt.co==="3&4"?Xt.max*(Xt.co==="3&4"?.5:1):0),0),Be=((pe=h==null?void 0:h.assessments)==null?void 0:pe.ssa1)||{},mt=((ee=h==null?void 0:h.assessments)==null?void 0:ee.ssa2)||{},It=((ue=h==null?void 0:h.assessments)==null?void 0:ue.formative1)||{},ft=((Ae=h==null?void 0:h.assessments)==null?void 0:Ae.formative2)||{},gr=((Le=h==null?void 0:h.assessments)==null?void 0:Le.cia1)||{},Mr=((ct=h==null?void 0:h.assessments)==null?void 0:ct.cia2)||{},$r=Number((ce=Be==null?void 0:Be.coMax)==null?void 0:ce.co1),_r=Number((xe=Be==null?void 0:Be.coMax)==null?void 0:xe.co2),Vr=Number(((se=mt==null?void 0:mt.coMax)==null?void 0:se.co3)??((Se=mt==null?void 0:mt.coMax)==null?void 0:Se.co1)),en=Number(((Ze=mt==null?void 0:mt.coMax)==null?void 0:Ze.co4)??((et=mt==null?void 0:mt.coMax)==null?void 0:et.co2)),Xr=Number((Et=gr==null?void 0:gr.coMax)==null?void 0:Et.co1),gn=Number((wt=gr==null?void 0:gr.coMax)==null?void 0:wt.co2),Oe=Number(((gt=Mr==null?void 0:Mr.coMax)==null?void 0:gt.co3)??((zt=Mr==null?void 0:Mr.coMax)==null?void 0:zt.co1)),qe=Number(((Dt=Mr==null?void 0:Mr.coMax)==null?void 0:Dt.co4)??((mr=Mr==null?void 0:Mr.coMax)==null?void 0:mr.co2)),Lt=Number(It==null?void 0:It.maxCo),dt=Number(ft==null?void 0:ft.maxCo),He={ssa1:{co1:Number.isFinite($r)?Math.max(0,$r):10,co2:Number.isFinite(_r)?Math.max(0,_r):10},ssa2:{co3:Number.isFinite(Vr)?Math.max(0,Vr):10,co4:Number.isFinite(en)?Math.max(0,en):10},cia1:{co1:Number.isFinite(Xr)?Math.max(0,Xr):Wt,co2:Number.isFinite(gn)?Math.max(0,gn):Ct},cia2:{co3:Number.isFinite(Oe)?Math.max(0,Oe):pr,co4:Number.isFinite(qe)?Math.max(0,qe):fr},f1:{co1:Number.isFinite(Lt)?Math.max(0,Lt):10,co2:Number.isFinite(Lt)?Math.max(0,Lt):10},f2:{co3:Number.isFinite(dt)?Math.max(0,dt):10,co4:Number.isFinite(dt)?Math.max(0,dt):10},review1:{co1:15,co2:15},review2:{co3:15,co4:15}},$t=String(i??"none"),Ue=(()=>{const pt=`model_theory_sheet_${e}_${$t}`,Xt=`model_theory_sheet_${e}_none`,Rt=`model_sheet_${e}`,_t=Bn(pt);if(_t&&typeof _t=="object")return _t;const jr=Bn(Xt);if(jr&&typeof jr=="object")return jr;const Gr=Bn(Rt);return Gr&&typeof Gr=="object"?Gr:null})(),er=pt=>{const Xt=E;if(!Ue)return{co1:null,co2:null,co3:null,co4:null,co5:null,max:Xt};const Rt=`id:${String(pt.id)}`,_t=pt.reg_no?`reg:${String(pt.reg_no).trim()}`:"",jr=Ue[Rt]||(_t?Ue[_t]:null)||null;if(!jr||typeof jr!="object")return{co1:null,co2:null,co3:null,co4:null,co5:null,max:Xt};const Gr=!!jr.absent,Cr=String(jr.absentKind||"AL").toUpperCase(),Rr=jr.q&&typeof jr.q=="object"?jr.q:{};let De=!1;const Ke={co1:0,co2:0,co3:0,co4:0,co5:0};for(let Ce=0;Ce<dx.length;Ce++){const it=dx[Ce],tr=Rr[it.key],Kt=Ni(tr);if(Kt==null)continue;De=!0;const yt=qn(Kt,0,it.max),Ht=j4[Ce];Ht===1?Ke.co1+=yt:Ht===2?Ke.co2+=yt:Ht===3?Ke.co3+=yt:Ht===4?Ke.co4+=yt:Ht===5&&(Ke.co5+=yt)}return De?Gr&&Cr==="AL"?{co1:0,co2:0,co3:0,co4:0,co5:0,max:Xt}:{co1:qn(Ke.co1,0,Xt.co1),co2:qn(Ke.co2,0,Xt.co2),co3:qn(Ke.co3,0,Xt.co3),co4:qn(Ke.co4,0,Xt.co4),co5:qn(Ke.co5,0,Xt.co5),max:Xt}:Gr&&Cr==="AL"?{co1:0,co2:0,co3:0,co4:0,co5:0,max:Xt}:{co1:null,co2:null,co3:null,co4:null,co5:null,max:Xt}},Z=(pt,Xt,Rt)=>pt==null||!Xt||!Number.isFinite(Xt)?null:qn(pt/Xt*Rt,0,Rt);if(Q==="LAB"||Q==="PRACTICAL"){const Xt=(Cr,Rr,De)=>{const Ke=Cr!=null&&Cr.sheet&&typeof Cr.sheet=="object"?Cr.sheet:{},Ce=Ke!=null&&Ke.rowsByStudentId&&typeof Ke.rowsByStudentId=="object"?Ke.rowsByStudentId:{},it=qn(Number((Ke==null?void 0:Ke.expCountA)??0),0,12),tr=qn(Number((Ke==null?void 0:Ke.expCountB)??0),0,12),Kt=!!(Ke!=null&&Ke.coAEnabled),yt=!!(Ke!=null&&Ke.coBEnabled),Ht=!!(Ke!=null&&Ke.ciaExamEnabled),qt=Ke!=null&&Ke.coConfigs&&typeof Ke.coConfigs=="object"?Ke.coConfigs:null,lr=qt?qt[String(Rr)]:null,Mt=De!=null&&qt?qt[String(De)]:null,tt=lr?!!lr.enabled:Kt,Ft=De!=null?Mt?!!Mt.enabled:yt:!1,Qt=lr?qn(Number(lr.expCount??0),0,12):it,At=De!=null?Mt?qn(Number(Mt.expCount??0),0,12):tr:0,bt=lr&&Number.isFinite(Number(lr.expMax))?Number(lr.expMax):Number.isFinite(Number(Ke==null?void 0:Ke.expMaxA))?Number(Ke.expMaxA):25,V=De!=null?Mt&&Number.isFinite(Number(Mt.expMax))?Number(Mt.expMax):Number.isFinite(Number(Ke==null?void 0:Ke.expMaxB))?Number(Ke.expMaxB):25:0,ie=bt+(Ht?15:0),_e=De!=null?V+(Ht?15:0):0,Je=(jt,cr)=>Array.isArray(jt)?jt.map(sr=>typeof sr=="number"&&Number.isFinite(sr)?sr:null):jt==null?[]:[],Nt=jt=>{const cr=(jt||[]).filter(sr=>typeof sr=="number"&&Number.isFinite(sr));return cr.length?cr.reduce((sr,Fr)=>sr+Fr,0)/cr.length:null};return{get:jt=>{const cr=Ce[String(jt)]||{},sr=cr!=null&&cr.marksByCo&&typeof cr.marksByCo=="object"?cr.marksByCo:{},Fr=(sr==null?void 0:sr[String(Rr)])??cr.marksA,Nr=De!=null?(sr==null?void 0:sr[String(De)])??cr.marksB:[],Pt=Je(Fr).slice(0,tt?Qt:0),Ot=Je(Nr).slice(0,Ft?At:0),Tr=Nt(Pt),vr=Nt(Ot),ye=cr==null?void 0:cr.ciaExam,lt=typeof ye=="number"&&Number.isFinite(ye)?ye:null,ht=Tr!=null||vr!=null||lt!=null,Vt=ht?(Tr??0)+(Ht?(lt??0)/2:0):null,Wr=ht?(vr??0)+(Ht?(lt??0)/2:0):null;return{a:Vt==null?null:qn(Vt,0,ie),b:Wr==null?null:qn(Wr,0,_e)}},CO_MAX_A:ie,CO_MAX_B:_e}},Rt=Xt(A.cia1,1,2),_t=Xt(A.cia2,3,4),jr=Xt(A.model,5,null),Gr=(Cr,Rr,De)=>Cr==null||!Rr||!Number.isFinite(Rr)?null:qn(Cr/Rr*De,0,De);return f.map((Cr,Rr)=>{const De=Rt.get(Cr.id),Ke=_t.get(Cr.id),Ce=jr.get(Cr.id),it=null,tr=Gr(De.a,Rt.CO_MAX_A,z),Kt=null,yt=null,Ht=Gr(De.b,Rt.CO_MAX_B,H),qt=null,lr=null,Mt=Gr(Ke.a,_t.CO_MAX_A,Y),tt=null,Ft=null,Qt=Gr(Ke.b,_t.CO_MAX_B,je),At=null,bt=null,V=null,ie=null,_e=null,Je=Gr(Ce.a,jr.CO_MAX_A,rt),Nt=[it,tr,Kt,yt,Ht,qt,lr,Mt,tt,Ft,Qt,At,bt,V,ie,_e,Je],Bt=me.visible.map(Fr=>Nt[Fr]),cr=Bt.some(Fr=>typeof Fr=="number"&&Number.isFinite(Fr))?ad(Bt.reduce((Fr,Nr)=>Fr+(typeof Nr=="number"&&Number.isFinite(Nr)?Nr:0),0)):null,sr=cr==null||!fe?null:ad(cr/fe*100);return{sno:Rr+1,...Cr,cells:Bt,total:cr,pct:sr}})}return f.map((pt,Xt)=>{const Rt=Ni(C.ssa1[String(pt.id)]),_t=Ni(C.ssa2[String(pt.id)]),jr=Rt==null?null:Number(Rt)/2,Gr=_t==null?null:Number(_t)/2,Cr=jr==null?null:qn(jr,0,He.ssa1.co1),Rr=jr==null?null:qn(jr,0,He.ssa1.co2),De=Gr==null?null:qn(Gr,0,He.ssa2.co3),Ke=Gr==null?null:qn(Gr,0,He.ssa2.co4),Ce=(C.f1||{})[String(pt.id)]||{},it=(C.f2||{})[String(pt.id)]||{},tr=Ni(Ce==null?void 0:Ce.skill1)!=null&&Ni(Ce==null?void 0:Ce.att1)!=null?qn(Number(Ce.skill1)+Number(Ce.att1),0,He.f1.co1):null,Kt=Ni(Ce==null?void 0:Ce.skill2)!=null&&Ni(Ce==null?void 0:Ce.att2)!=null?qn(Number(Ce.skill2)+Number(Ce.att2),0,He.f1.co2):null,yt=Ni(it==null?void 0:it.skill1)!=null&&Ni(it==null?void 0:it.att1)!=null?qn(Number(it.skill1)+Number(it.att1),0,He.f2.co3):null,Ht=Ni(it==null?void 0:it.skill2)!=null&&Ni(it==null?void 0:it.att2)!=null?qn(Number(it.skill2)+Number(it.att2),0,He.f2.co4):null,qt=Ni(T.r1[String(pt.id)]),lr=Ni(T.r2[String(pt.id)]),Mt=qt==null?null:Number(qt)/2,tt=lr==null?null:Number(lr)/2,Ft=Mt==null?null:qn(Mt,0,He.review1.co1),Qt=Mt==null?null:qn(Mt,0,He.review1.co2),At=tt==null?null:qn(tt,0,He.review2.co3),bt=tt==null?null:qn(tt,0,He.review2.co4),V=ar=>{const j=ar!=null&&ar.sheet&&typeof ar.sheet=="object"?ar.sheet:{},ae=j!=null&&j.rowsByStudentId&&typeof j.rowsByStudentId=="object"?j.rowsByStudentId:{};qn(Number((j==null?void 0:j.expCountA)??0),0,12),qn(Number((j==null?void 0:j.expCountB)??0),0,12);const Ne=Number.isFinite(Number(j==null?void 0:j.expMaxA))?Number(j.expMaxA):25,Xe=Number.isFinite(Number(j==null?void 0:j.expMaxB))?Number(j.expMaxB):25,ut=(j==null?void 0:j.ciaExamEnabled)!==!1,Jt=30/2,ur=Ne+(ut?Jt:0),Kr=Xe+(ut?Jt:0),Zr=(_n,xn)=>Array.isArray(_n)?_n.map(An=>typeof An=="number"&&Number.isFinite(An)?An:null):_n==null?[]:[],pn=_n=>{const xn=(_n||[]).filter(An=>typeof An=="number"&&Number.isFinite(An));return xn.length?xn.reduce((An,Dn)=>An+Dn,0)/xn.length:null};return{get:_n=>{const xn=ae[String(_n)]||{},An=Zr(xn==null?void 0:xn.marksA),Dn=Zr(xn==null?void 0:xn.marksB),ws=pn(An),ps=pn(Dn),$n=xn==null?void 0:xn.ciaExam,Sa=typeof $n=="number"&&Number.isFinite($n)?$n:null,Fa=ws!=null||ps!=null||Sa!=null,$a=Fa?(ws??0)+(ut?(Sa??0)/2:0):null,Ao=Fa?(ps??0)+(ut?(Sa??0)/2:0):null;return{a:$a==null?null:qn($a,0,ur),b:Ao==null?null:qn(Ao,0,Kr)}},CO_MAX_A:ur,CO_MAX_B:Kr}},ie=Q==="TCPL"?V(P.lab1):null,_e=Q==="TCPL"?V(P.lab2):null,Je=ie?ie.get(pt.id):null,Nt=_e?_e.get(pt.id):null,Bt=(Je==null?void 0:Je.a)??null,jt=(Je==null?void 0:Je.b)??null,cr=(Nt==null?void 0:Nt.a)??null,sr=(Nt==null?void 0:Nt.b)??null,Fr=we[String(pt.id)]||{},Nr=Me[String(pt.id)]||{},Pt=!!(Fr!=null&&Fr.absent),Ot=!!(Nr!=null&&Nr.absent);let Tr=null,vr=null;if(!Pt){const ar=Fr!=null&&Fr.q&&typeof Fr.q=="object"?Fr.q:{};let j=!1,ae=0,Ne=0;for(const Xe of ot){const ut=Ni(ar==null?void 0:ar[Xe.key]);if(ut==null)continue;j=!0;const Jt=qn(ut,0,Xe.max||ut),ur=EJ(Xe.co);ae+=Jt*ur.co1,Ne+=Jt*ur.co2}j&&(Tr=qn(ae,0,He.cia1.co1),vr=qn(Ne,0,He.cia1.co2))}let ye=null,lt=null;if(!Ot){const ar=Nr!=null&&Nr.q&&typeof Nr.q=="object"?Nr.q:{};let j=!1,ae=0,Ne=0;for(const Xe of be){const ut=Ni(ar==null?void 0:ar[Xe.key]);if(ut==null)continue;j=!0;const Jt=qn(ut,0,Xe.max||ut),ur=TJ(Xe.co);ae+=Jt*ur.co3,Ne+=Jt*ur.co4}j&&(ye=qn(ae,0,He.cia2.co3),lt=qn(Ne,0,He.cia2.co4))}const ht=Z(Cr,He.ssa1.co1,ne),Vt=Z(Tr,He.cia1.co1,z),Wr=Q==="TCPR"?Z(Ft,He.review1.co1,he):Q==="TCPL"?Z(Bt,(ie==null?void 0:ie.CO_MAX_A)??He.f1.co1,he):Z(tr,He.f1.co1,he),Yr=Z(Rr,He.ssa1.co2,X),fn=Z(vr,He.cia1.co2,H),In=Q==="TCPR"?Z(Qt,He.review1.co2,oe):Q==="TCPL"?Z(jt,(ie==null?void 0:ie.CO_MAX_B)??He.f1.co2,oe):Z(Kt,He.f1.co2,oe),Ye=Z(De,He.ssa2.co3,D),st=Z(ye,He.cia2.co3,Y),at=Q==="TCPR"?Z(At,He.review2.co3,le):Q==="TCPL"?Z(cr,(_e==null?void 0:_e.CO_MAX_A)??He.f2.co3,le):Z(yt,He.f2.co3,le),nt=Z(Ke,He.ssa2.co4,$e),xt=Z(lt,He.cia2.co4,je),rr=Q==="TCPR"?Z(bt,He.review2.co4,We):Q==="TCPL"?Z(sr,(_e==null?void 0:_e.CO_MAX_B)??He.f2.co4,We):Z(Ht,He.f2.co4,We),vt=er(pt),dr=Z(vt.co1,vt.max.co1,Ee),ir=Z(vt.co2,vt.max.co2,Re),Br=Z(vt.co3,vt.max.co3,Ve),kr=Z(vt.co4,vt.max.co4,St),Ur=Z(vt.co5,vt.max.co5,rt),zr=[ht,Vt,Wr,Yr,fn,In,Ye,st,at,nt,xt,rr,dr,ir,Br,kr,Ur],Or=me.visible.map(ar=>zr[ar]),cn=Or.some(ar=>typeof ar=="number"&&Number.isFinite(ar))?ad(Or.reduce((ar,j)=>ar+(typeof j=="number"&&Number.isFinite(j)?j:0),0)):null,nr=cn==null||!fe?null:ad(cn/fe*100);return{sno:Xt+1,...pt,cells:Or,total:cn,pct:nr}})},[me,C,T,A,P,f,S,fe,e,i,E,h,d]),I=me.header,M=me.cycles,te=me.weights;return n.jsxs("div",{style:{padding:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:12,flexWrap:"wrap",marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("h3",{style:{margin:0},children:"INTERNAL MARK"}),n.jsx("div",{style:{color:"#6b7280",marginTop:4},children:"Summative + Formative (based on IQAC mapping)"})]}),n.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:n.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("span",{style:{color:"#374151",fontWeight:700},children:"Section"}),n.jsxs("select",{value:i??"",onChange:Q=>o(Q.target.value?Number(Q.target.value):null),style:{padding:8,borderRadius:8,border:"1px solid #d1d5db"},children:[n.jsx("option",{value:"",disabled:!0,children:""}),s.map(Q=>{const G=Q.department,ne=(G==null?void 0:G.short_name)||(G==null?void 0:G.code)||(G==null?void 0:G.name)||Q.department_name||"",z=Q.semester,he=`${Q.section_name||`TA ${Q.id}`} ${z?` Sem ${z}`:""} ${ne?` ${ne}`:""}`;return n.jsx("option",{value:Q.id,children:he},Q.id)})]})]})})]}),l?n.jsx("div",{style:{color:"#b91c1c",marginBottom:8},children:l}):null,g?n.jsx("div",{style:{color:"#b91c1c",marginBottom:8},children:g}):null,Fe?n.jsx("div",{style:{color:"#b91c1c",marginBottom:8},children:Fe}):null,m||re?n.jsx("div",{style:{color:"#6b7280",marginBottom:8},children:"Loading"}):null,n.jsx("div",{style:{overflowX:"auto",border:"1px solid #e5e7eb",borderRadius:10},children:n.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",fontSize:12},children:[n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f9fafb"},children:"S.No"}),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f9fafb"},children:"Register No."}),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f9fafb"},children:"Name"}),I.map((Q,G)=>n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f3f4f6"},children:String(Q)},G)),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f9fafb"},children:ad(fe)}),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f9fafb"},children:"100"})]}),n.jsxs("tr",{children:[n.jsx("th",{colSpan:3,style:{border:"1px solid #e5e7eb",padding:8,background:"#fff",textAlign:"left",fontWeight:800},children:"internal weightage"}),te.map((Q,G)=>n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#f3f4f6"},children:Number(Q).toFixed(1)},`w-${G}`)),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#fff"}}),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#fff"}})]}),n.jsxs("tr",{children:[n.jsx("th",{colSpan:3,style:{border:"1px solid #e5e7eb",padding:8,background:"#fff",textAlign:"left",fontWeight:800},children:"cycle"}),M.map((Q,G)=>n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#fff"},children:String(Q)},`c-${G}`)),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#fff"}}),n.jsx("th",{style:{border:"1px solid #e5e7eb",padding:8,background:"#fff"}})]})]}),n.jsx("tbody",{children:U.map(Q=>n.jsxs("tr",{children:[n.jsx("td",{style:{border:"1px solid #e5e7eb",padding:6},children:Q.sno}),n.jsx("td",{style:{border:"1px solid #e5e7eb",padding:6},children:Q.reg_no}),n.jsx("td",{style:{border:"1px solid #e5e7eb",padding:6},children:Q.name}),(Array.isArray(Q.cells)?Q.cells:[]).map((G,ne)=>n.jsx("td",{style:{border:"1px solid #e5e7eb",padding:6,textAlign:"center"},children:G==null?"":Number(G).toFixed(2)},ne)),n.jsx("td",{style:{border:"1px solid #e5e7eb",padding:6,textAlign:"center",fontWeight:800},children:Q.total==null?"":Number(Q.total).toFixed(2)}),n.jsx("td",{style:{border:"1px solid #e5e7eb",padding:6,textAlign:"center"},children:Q.pct==null?"":Number(Q.pct).toFixed(2)})]},Q.id))})]})})]})}function MJ(){const{code:e}=g0(),t=Ri(),r=Ji(),[s,a]=Jr.useState(()=>"marks");Jr.useEffect(()=>{if(!r||!r.pathname)return;const m=r.pathname.toLowerCase();m.includes("/lca/instructions")||m.includes("/lca_instructions")||m.includes("/lca")||m.includes("/cdap")||m.includes("/articulation")?a("lca_instructions"):m.includes("/marks")?a("marks"):m.includes("/co_attainment")?a("co_attainment"):m.includes("/internal_mark")||m.includes("/internal-mark")?a("internal_mark"):m.includes("/cqi")?a("cqi"):a("marks")},[r]);const i=Jr.useMemo(()=>{const m=String((r==null?void 0:r.pathname)||"").toLowerCase();return m.includes("/cdap")?"cdap":m.includes("/articulation")?"articulation":m.includes("/lca")&&!(m.includes("/lca/instructions")||m.includes("/lca_instructions"))?"lca":"instructions"},[r==null?void 0:r.pathname]);if(!e)return n.jsxs("div",{style:{padding:24},children:[n.jsx("p",{style:{color:"#666"},children:"No course selected."}),n.jsx("button",{onClick:()=>t("/obe"),className:"obe-btn obe-btn-primary",children:"Back"})]});const o=decodeURIComponent(e),[l,c]=Jr.useState(null),[d,u]=Jr.useState(null),[h,p]=Jr.useState(!1),[f,x]=Jr.useState(()=>{try{const m=localStorage.getItem(`obe_course_qp_${o}`);return String(m||"").trim().toUpperCase()==="QP2"?"QP2":"QP1"}catch{return"QP1"}}),[g,y]=Jr.useState(null);return Jr.useEffect(()=>{let m=!0;return(async()=>{try{m&&p(!1);const w=await wl();if(!m)return;const S=(w||[]).filter(O=>String(O.subject_code)===String(o)),k=S[0]||null;k&&c(k.subject_name||null);let F=null;try{const O=localStorage.getItem(`markEntry_selectedTa_${o}`),T=O==null?NaN:Number(O);F=Number.isFinite(T)?T:null}catch{F=null}const L=F!=null&&S.find(O=>Number(O.id)===Number(F))||S.find(O=>String((O==null?void 0:O.class_type)||"").trim())||k,C=String((L==null?void 0:L.class_type)||"").trim();C&&(u(C),p(!0))}catch{}})(),()=>{m=!1}},[o]),Jr.useEffect(()=>{let m=!0;return(async()=>{try{const w=await vo();if(!m)return;const S=String(o),k=S.toUpperCase(),F=(w||[]).filter(W=>String((W==null?void 0:W.course_code)||"").trim()===S||String((W==null?void 0:W.course_code)||"").trim().toUpperCase()===k),L=W=>String(W||"").trim().toUpperCase(),C=F.find(W=>{const A=L(W==null?void 0:W.question_paper_type);return A&&A!=="QP1"})||F.find(W=>L(W==null?void 0:W.question_paper_type))||F.find(W=>String((W==null?void 0:W.class_type)||"").trim())||F[0];if(!h&&C&&C.class_type){const W=String(C.class_type||"").trim();u(W||null)}else if(!h)try{const W=await qf();if(!m)return;const A=(Array.isArray(W)?W:W.results||[]).find(N=>String(N.course_code||"").trim().toUpperCase()===k);A&&A.class_type&&(u(String(A.class_type||"").trim()||null),Array.isArray(A.enabled_assessments)&&A.enabled_assessments.length&&y(A.enabled_assessments.map(N=>String(N).trim().toLowerCase()).filter(Boolean)))}catch{}let O=null;try{O=localStorage.getItem(`obe_course_qp_${o}`)}catch{O=null}const T=String(O||"").trim().toUpperCase();if(T==="QP1"||T==="QP2")x(T);else{const W=String((C==null?void 0:C.question_paper_type)||"").trim().toUpperCase();x(W==="QP2"?"QP2":"QP1")}if(On(C==null?void 0:C.class_type)==="SPECIAL"){y([]);try{const W=await ag(S);y(Array.isArray(W)?W:[])}catch{const W=C==null?void 0:C.enabled_assessments;y(Array.isArray(W)?W.map(A=>String(A).trim().toLowerCase()).filter(Boolean):[])}}else y(null)}catch{}})(),()=>{m=!1}},[o]),n.jsx("main",{className:"obe-course-page",style:{padding:"32px 48px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',minHeight:"100vh",background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)"},children:n.jsxs("div",{style:{width:"100%",minWidth:0,boxSizing:"border-box"},children:[n.jsx("div",{style:{marginBottom:24,background:"#fff",padding:"28px 32px",borderRadius:16,boxShadow:"0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04)"},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:24,flexWrap:"wrap"},children:[n.jsxs("div",{style:{flex:1},children:[n.jsxs("h2",{style:{margin:0,fontSize:32,fontWeight:700,color:"#0f172a",letterSpacing:"-0.02em"},children:["OBE - ",o]}),n.jsx("div",{style:{color:"#64748b",marginTop:8,fontSize:16},children:"Course OBE workspace"}),l&&n.jsx("div",{style:{color:"#1e293b",marginTop:12,fontWeight:700,fontSize:20},children:l}),n.jsxs("div",{style:{marginTop:16,display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[d&&n.jsxs("div",{style:{background:"#eff6ff",color:"#3b82f6",padding:"6px 14px",borderRadius:8,fontWeight:600,fontSize:14,border:"1px solid #bfdbfe"},children:[" Class type: ",n.jsx("strong",{children:String(d).toLowerCase()[0].toUpperCase()+String(d).toLowerCase().slice(1)})]}),n.jsxs("div",{style:{background:"#f8fafc",color:"#475569",padding:"6px 14px",borderRadius:8,fontWeight:600,fontSize:14,border:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{children:" QP Type:"}),n.jsxs("select",{value:String(f||"QP1").trim().toUpperCase()==="QP2"?"QP2":"QP1",onChange:m=>{const S=String(m.target.value||"").trim().toUpperCase()==="QP2"?"QP2":"QP1";x(S);try{localStorage.setItem(`obe_course_qp_${o}`,S)}catch{}},style:{padding:"4px 10px",borderRadius:6,border:"1px solid #cbd5e1",fontSize:14,fontWeight:600,color:"#0f172a",background:"#fff",cursor:"pointer"},children:[n.jsx("option",{value:"QP1",children:"QP1"}),n.jsx("option",{value:"QP2",children:"QP2"})]})]})]})]}),n.jsx("div",{children:n.jsx("button",{onClick:()=>t("/obe"),onMouseEnter:m=>{m.currentTarget.style.background="#f8fafc",m.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:m=>{m.currentTarget.style.background="#fff",m.currentTarget.style.borderColor="#e2e8f0"},style:{padding:"10px 20px",borderRadius:10,border:"1px solid #e2e8f0",background:"#fff",color:"#475569",cursor:"pointer",fontWeight:600,fontSize:15,transition:"all 0.2s ease",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:" Back to courses"})})]})}),n.jsx("div",{style:{display:"flex",gap:6,marginBottom:24,background:"#fff",padding:"8px",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.06)",flexWrap:"wrap"},"aria-label":"OBE Tabs",children:[{key:"lca_instructions",label:" Learner Centric Approach",icon:""},{key:"marks",label:" Mark Entry",icon:""},{key:"co_attainment",label:" CO Attainment",icon:""},{key:"cqi",label:" CQI",icon:""},{key:"internal_mark",label:" Internal Mark",icon:""}].map(m=>{const w=s===m.key;return n.jsx("button",{onClick:()=>{if(a(m.key),e){const S=encodeURIComponent(e),k=m.key==="lca_instructions"?"lca/instructions":String(m.key);t(`/obe/course/${S}/${k}`)}},onMouseEnter:S=>{w||(S.currentTarget.style.background="rgba(59,130,246,0.08)",S.currentTarget.style.color="#3b82f6")},onMouseLeave:S=>{w||(S.currentTarget.style.background="transparent",S.currentTarget.style.color="#64748b")},style:{padding:"10px 24px",borderRadius:8,border:"none",background:w?"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)":"transparent",color:w?"#fff":"#64748b",cursor:"pointer",fontWeight:w?600:500,fontSize:15,transition:"all 0.2s ease",boxShadow:w?"0 2px 8px rgba(37,99,235,0.2)":"none"},children:m.label},m.key)})}),n.jsxs("div",{children:[s==="marks"&&n.jsx(NJ,{courseId:o,classType:d,questionPaperType:f,enabledAssessments:g}),s==="lca_instructions"&&n.jsx(g8,{courseCode:o,courseName:l,initialTab:i}),s==="co_attainment"&&n.jsx(b8,{courseId:o,enabledAssessments:g,classType:d}),s==="internal_mark"&&n.jsx(FJ,{courseId:o,enabledAssessments:g}),s==="cqi"&&n.jsx(v8,{courseId:o})]})]})})}function RJ(){const e=Ri(),[t]=IF(),r=v.useMemo(()=>{const y=String(t.get("subject_code")||"").trim(),m=String(t.get("assessment")||"").trim().toLowerCase(),w=String(t.get("reason")||"Edit Marks").trim(),S=t.get("teaching_assignment_id"),k=S?Number(S):void 0;return{subject_code:y,assessment:m,reason:w,teaching_assignment_id:Number.isFinite(k)?k:void 0}},[t]),[s,a]=v.useState(r.subject_code),[i,o]=v.useState(r.assessment),[l,c]=v.useState(r.reason),[d,u]=v.useState(String(r.teaching_assignment_id??"")),[h,p]=v.useState(!1),[f,x]=v.useState(null);async function g(){p(!0),x(null);try{const y=(d||"").trim(),m=y?Number(y):void 0;await w0({assessment:i,subject_code:s,reason:l,teaching_assignment_id:Number.isFinite(m)?m:void 0,force:!0}),alert("Edit request sent to IQAC."),e(-1)}catch(y){x((y==null?void 0:y.message)||"Request failed")}finally{p(!1)}}return n.jsxs("div",{style:{maxWidth:720},children:[n.jsx("div",{style:{fontWeight:900,fontSize:16,marginBottom:12},children:"OBE Request"}),n.jsx("div",{className:"obe-card",children:n.jsxs("div",{style:{display:"grid",gap:10},children:[n.jsxs("label",{style:{display:"grid",gap:6},children:[n.jsx("div",{className:"obe-small-muted",style:{fontWeight:800},children:"Subject Code"}),n.jsx("input",{className:"obe-input",value:s,onChange:y=>a(y.target.value),placeholder:"e.g., GEA1268"})]}),n.jsxs("label",{style:{display:"grid",gap:6},children:[n.jsx("div",{className:"obe-small-muted",style:{fontWeight:800},children:"Assessment"}),n.jsx("input",{className:"obe-input",value:i,onChange:y=>o(y.target.value),placeholder:"cia1 | cia2 | model | formative1 | formative2"})]}),n.jsxs("label",{style:{display:"grid",gap:6},children:[n.jsx("div",{className:"obe-small-muted",style:{fontWeight:800},children:"Teaching Assignment ID (optional)"}),n.jsx("input",{className:"obe-input",value:d,onChange:y=>u(y.target.value),placeholder:"e.g., 123"})]}),n.jsxs("label",{style:{display:"grid",gap:6},children:[n.jsx("div",{className:"obe-small-muted",style:{fontWeight:800},children:"Reason"}),n.jsx("textarea",{className:"obe-input",value:l,onChange:y=>c(y.target.value),rows:3,placeholder:"Edit Marks",style:{resize:"vertical"}})]}),f?n.jsx("div",{className:"obe-danger-pill",children:f}):null,n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[n.jsx("button",{className:"obe-btn",type:"button",onClick:()=>e(-1),disabled:h,children:"Cancel"}),n.jsx("button",{className:"obe-btn obe-btn-primary",type:"button",onClick:g,disabled:h||!s||!i,children:h?"Requesting":"Request Edit"})]})]})})]})}function BJ(){const[e,t]=v.useState([]),[r,s]=v.useState([]),[a,i]=v.useState([]),[o,l]=v.useState(!1),[c,d]=v.useState(!1),[u,h]=v.useState(null),[p,f]=v.useState(new Set);v.useEffect(()=>{x()},[]);async function x(){l(!0);try{const w=await hr("/api/academics/section-advisors/?page_size=0"),S=await hr("/api/academics/sections/?page_size=0"),k=await hr("/api/academics/hod-staff/?page_size=0"),F=await hr("/api/accounts/me/");async function L(C){if(!(C.headers.get("content-type")||"").includes("application/json")){const T=await C.text();throw console.error("Expected JSON but got:",T),new Error("Server returned non-JSON response (see console)")}return C.json()}if(w.ok){const C=await L(w);i(C.results||C)}if(S.ok){const C=await L(S);t(C.results||C)}if(k.ok){const C=await L(k);s(C.results||C)}if(F.ok){const C=await L(F);d(!!(C.permissions&&(C.permissions.includes("academics.assign_advisor")||C.permissions.includes("academics.add_sectionadvisor"))))}}catch(w){console.error(w),alert("Failed to load HOD assignments. Check console for server response.")}finally{l(!1)}}async function g(w,S){l(!0);try{if(!c)return alert("You do not have permission to assign advisors");const F=await hr("/api/academics/section-advisors/",{method:"POST",body:JSON.stringify({section_id:w,advisor_id:S,is_active:!0})});if(F.ok)f(L=>{const C=new Set(L);return C.delete(w),C}),await x();else{const L=await F.text();alert("Error: "+L)}}finally{l(!1)}}function y(w){f(S=>{const k=new Set(S);return k.has(w)?k.delete(w):k.add(w),k})}function m(w){return a.find(S=>S.section_id===w&&S.is_active)}return n.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:n.jsx(Lu,{className:"h-6 w-6 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Advisor Assign"}),n.jsx("p",{className:"text-gray-600",children:"Assign advisors to sections and edit existing assignments"})]})]})}),o&&n.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12",children:n.jsxs("div",{className:"flex items-center justify-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),n.jsx("span",{className:"ml-3 text-gray-600",children:"Loading assignments..."})]})}),!o&&e.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Filter by Department"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{onClick:()=>h(null),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${u===null?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Departments"}),Array.from(new Set(e.map(w=>w.department_id||0))).filter(w=>w>0).map(w=>{var L,C;const S=e.filter(O=>(O.department_id||0)===w);if(S.length===0)return null;const k=((L=S[0])==null?void 0:L.department_short_name)||((C=S[0])==null?void 0:C.department_code)||`Dept ${w}`,F=u===w;return n.jsx("button",{onClick:()=>h(F?null:w),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${F?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:k},w)})]})]}),n.jsx("div",{className:"space-y-6",children:Array.from(new Set(e.map(w=>w.department_id||0))).filter(w=>u===null||u===w).map(w=>{var L,C;const S=e.filter(O=>(O.department_id||0)===w);if(S.length===0)return null;const k=((L=S[0])==null?void 0:L.department_short_name)||((C=S[0])==null?void 0:C.department_code)||`Department ${w}`,F=r.filter(O=>(O.department||0)===w);return n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[n.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:[k," Department"]}),n.jsx("div",{className:"overflow-x-auto mb-6",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-blue-50 border-b-2 border-gray-200",children:[n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-700",children:"Section"}),n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-700",children:"Select Advisor"}),n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-700",children:"Action"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:S.map(O=>{const T=m(O.id),W=p.has(O.id),A=!T||W;return n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-4 py-3 text-gray-700",children:O.name}),n.jsx("td",{className:"px-4 py-3",children:A?n.jsxs("select",{id:`advisor-${O.id}`,className:"w-full p-2 border border-gray-300 rounded-lg bg-white text-gray-700 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",defaultValue:(T==null?void 0:T.advisor_id)||"",children:[n.jsx("option",{value:"",children:"-- Select Advisor --"}),F.map(N=>n.jsxs("option",{value:N.id,children:[N.staff_id," - ",N.user]},N.id))]}):n.jsx("div",{className:"text-gray-900 font-medium",children:(T==null?void 0:T.advisor)||"No advisor assigned"})}),n.jsx("td",{className:"px-4 py-3",children:T&&!W?n.jsx("button",{disabled:!c,className:`p-2 text-sm font-medium rounded-lg transition-colors ${c?"text-blue-600 hover:bg-blue-50 border border-blue-300":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>c&&y(O.id),title:"Edit Assignment",children:n.jsx(_d,{className:"h-4 w-4"})}):n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{disabled:!c,className:`p-2 text-sm font-medium rounded-lg transition-colors ${c?"text-blue-600 hover:bg-blue-50 border border-blue-300":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>{if(!c)return;const P=document.getElementById(`advisor-${O.id}`).value;if(!P)return alert("Select an advisor first");g(O.id,Number(P))},title:"Save Assignment",children:n.jsx(kc,{className:"h-4 w-4"})}),W&&n.jsx("button",{className:"p-2 text-sm font-medium rounded-lg transition-colors text-red-600 hover:bg-red-50 border border-red-300",onClick:()=>y(O.id),title:"Cancel",children:n.jsx(Qo,{className:"h-4 w-4"})}),T&&n.jsx("button",{disabled:!c,className:`p-2 text-sm font-medium rounded-lg transition-colors flex items-center justify-center ${c?"bg-red-50 text-red-700 border border-red-300 hover:bg-red-100":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:async()=>{if(c&&confirm("Delete advisor assignment for this section?"))try{const N=await hr(`/api/academics/section-advisors/${T.id}/`,{method:"DELETE"});if(!N.ok){const P=await N.text();return alert("Delete failed: "+P)}await x()}catch(N){console.error(N),alert("Delete failed")}},title:"Delete Assignment",children:n.jsx(ap,{className:"h-4 w-4"})})]})})]},O.id)})})]})})]},w)})})]}),!o&&e.length===0&&n.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12",children:n.jsxs("div",{className:"text-center",children:[n.jsx(va,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No sections available"}),n.jsx("p",{className:"text-gray-600",children:"There are no sections available for advisor assignment at this time."})]})})]})})}const C4=e=>{if(typeof e.user=="string")return e.user;if(e.user&&typeof e.user=="object"){const t=e.user.first_name||"",r=e.user.last_name||"";return`${t} ${r}`.trim()||e.user.username||e.staff_id}return e.staff_id},E4=e=>{if(!e)return"";if(typeof e.user=="string")return e.user;if(e.user&&typeof e.user=="object"){const t=e.user.first_name||"",r=e.user.last_name||"";return`${t} ${r}`.trim()||e.user.username||e.staff_id}return e.staff_id||""};function PJ(){const[e,t]=v.useState([]),[r,s]=v.useState([]),[a,i]=v.useState([]),[o,l]=v.useState(null),[c,d]=v.useState(null),[u,h]=v.useState([]),[p,f]=v.useState([]),[x,g]=v.useState([]),[y,m]=v.useState([]),[w,S]=v.useState(!0),[k,F]=v.useState(new Set),[L,C]=v.useState(new Set),O=(()=>{try{return JSON.parse(localStorage.getItem("permissions")||"[]")}catch{return[]}})(),T=O.includes("academics.view_elective_teaching"),W=O.includes("academics.assign_elective_teaching");v.useEffect(()=>{A()},[]);async function A(){try{S(!0);const U=await hr("/api/academics/my-students/?page_size=0"),I=T||W?"/api/academics/hod-staff/?page_size=0":"/api/academics/advisor-staff/?page_size=0",M=await hr(o&&I.includes("hod-staff")?`${I}&department=${o}`:I),te=await hr("/api/curriculum/department/?page_size=0"),Q=await hr("/api/curriculum/elective/?page_size=0"),G=await hr("/api/academics/teaching-assignments/?page_size=0"),ne=async z=>{if(!(z.headers.get("content-type")||"").includes("application/json"))throw new Error("non-json");return z.json()};if(U.ok){const z=await ne(U),he=(z.results||z).map(X=>({id:X.section_id,name:X.section_name,batch:X.batch,batch_regulation:X.batch_regulation,department_id:X.department_id,semester:X.semester,department:X.department}));t(he)}if(M.ok){const z=await ne(M);let he=z.results||z;o&&(he=he.filter(X=>X.department&&X.department.id===o||X.department===o)),s(he)}if(te.ok){const z=await ne(te),he=z.results||z;h(he),m(he.filter(H=>H.is_elective));const X=new Map;he.forEach(H=>{H.department&&H.department.id&&X.set(H.department.id,H.department)}),X.size>0&&i(Array.from(X.values()))}if(Q.ok){const z=await ne(Q);g(z.results||z)}if(G.ok){const z=await ne(G);f(z.results||z)}}catch(U){console.error(U),alert("Failed to load teaching assignment data")}finally{S(!1)}}v.useEffect(()=>{async function U(){try{const I=T||W?"/api/academics/hod-staff/?page_size=0":"/api/academics/advisor-staff/?page_size=0",M=o&&I.includes("hod-staff")?`${I}&department=${o}`:I,te=await hr(M);if(!te.ok)return;const Q=await te.json();let G=Q.results||Q;!I.includes("hod-staff")&&o&&(G=G.filter(ne=>ne.department&&ne.department.id===o||ne.department===o)),s(G)}catch(I){console.error("loadStaff failed",I)}}U()},[o]);const N=(U,I)=>p.find(M=>{const te=M.section_details&&M.section_details.id===U||M.section_details&&M.section_details.id===U||M.section===U||M.section_id===U,Q=M.curriculum_row_details&&M.curriculum_row_details.id===I||M.curriculum_row_details&&M.curriculum_row_details.id===I||M.curriculum_row&&M.curriculum_row.id===I||M.curriculum_row_id===I;return te&&Q}),P=(U,I)=>`${U}-${I}`,K=(U,I)=>{const M=P(U,I);F(te=>new Set(te).add(M))},re=(U,I)=>{const M=P(U,I);F(te=>{const Q=new Set(te);return Q.delete(M),Q})},ge=(U,I)=>{const M=P(U,I);return k.has(M)},Fe=U=>p.find(I=>{const M=I.elective_subject_id||I.elective_subject&&I.elective_subject.id||I.elective_subject_details&&I.elective_subject_details.id||I.elective_subject;return Number(M)===Number(U)}),R=U=>`elective-${U}`,q=U=>{const I=R(U);C(M=>new Set(M).add(I))},me=U=>{const I=R(U);C(M=>{const te=new Set(M);return te.delete(I),te})},fe=U=>{const I=R(U);return L.has(I)};async function E(U,I,M){if(!I)return alert("Select staff"),Promise.reject("No staff selected");try{if(M){const te={staff_id:Number(I),is_active:!0},Q=await hr(`/api/academics/teaching-assignments/${M}/`,{method:"PATCH",body:JSON.stringify(te)});if(Q.ok)return alert("Updated successfully"),A(),Promise.resolve();{const G=await Q.text();return alert("Error: "+G),Promise.reject(G)}}else{const te={elective_subject_id:U,staff_id:Number(I),is_active:!0},Q=await hr("/api/academics/teaching-assignments/",{method:"POST",body:JSON.stringify(te)});if(Q.ok)return alert("Assigned successfully"),A(),Promise.resolve();{const G=await Q.text();return alert("Error: "+G),Promise.reject(G)}}}catch(te){return alert("Error: "+te),Promise.reject(te)}}return w?n.jsx("div",{style:{padding:"28px",minHeight:"100vh",background:"linear-gradient(180deg, #f7fbff 0%, #ffffff 60%)"},children:n.jsx("div",{style:{padding:"16px",borderRadius:"8px",background:"#fff",border:"1px solid rgba(15,23,42,0.04)",color:"#6b7280"},children:"Loading teaching assignments"})}):n.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:n.jsx(Lu,{className:"h-6 w-6 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Teaching Assign"}),n.jsx("p",{className:"text-gray-600",children:"Assign faculty to courses and sections"})]})]})}),a.length>0&&n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Filters"}),n.jsx("div",{className:"flex flex-wrap gap-4",children:a.length>0&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Department:"}),n.jsxs("select",{value:o??"",onChange:U=>l(U.target.value?Number(U.target.value):null),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"",children:"All Departments"}),a.map(U=>n.jsx("option",{value:U.id,children:U.short_name||U.code||U.name||`Dept ${U.id}`},U.id))]})]})})]}),n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(va,{className:"h-5 w-5 text-blue-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Course Assignments"})]}),e.length===0?n.jsx("div",{className:"text-center py-8",children:n.jsx("div",{className:"text-gray-500 text-sm",children:"No sections available for the selected filters."})}):n.jsx("div",{className:"space-y-6",children:e.map(U=>{const I=u.filter(M=>(U.semester?M.semester===U.semester:!0)&&(U.batch_regulation?M.regulation===U.batch_regulation.code:!0)&&!M.is_elective);return n.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[n.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"text-lg font-semibold text-blue-900",children:[U.batch," / ",U.name]}),n.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[n.jsxs("p",{className:"text-blue-700 text-sm",children:["Semester: ",U.semester||"Not specified"]}),U.batch_regulation&&n.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 border border-indigo-200",children:["Regulation: ",U.batch_regulation.code]})]})]}),n.jsxs("div",{className:"text-blue-600 text-sm font-medium",children:["Section ID: ",U.id]})]})}),I.length===0?n.jsx("div",{className:"text-gray-500 text-sm py-4",children:"No subjects available for this section."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Subject Code"}),n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Subject Name"}),n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Assigned Staff"}),n.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Action"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:I.map(M=>{var G,ne;const te=N(U.id,M.id),Q=ge(U.id,M.id);return n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:M.course_code||"-"}),n.jsx("td",{className:"px-4 py-3 text-gray-700",children:M.course_name||"Unnamed"}),n.jsx("td",{className:"px-4 py-3",children:Q?n.jsxs("select",{id:`staff-${U.id}-${M.id}`,defaultValue:((G=te==null?void 0:te.staff_details)==null?void 0:G.id)||(te==null?void 0:te.staff)||"",className:"w-full p-2 border border-gray-300 rounded-lg bg-white text-gray-700 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"",children:"-- select staff --"}),r.map(z=>n.jsxs("option",{value:z.id,children:[z.staff_id," - ",C4(z)]},z.id))]}):te?n.jsxs("div",{className:"text-sm text-gray-900 font-medium",children:[(ne=te.staff_details)==null?void 0:ne.staff_id," - ",E4(te.staff_details)]}):n.jsx("div",{className:"text-sm text-gray-500 italic",children:"Not assigned"})}),n.jsx("td",{className:"px-4 py-3 text-center",children:n.jsx("div",{className:"flex items-center justify-center gap-2",children:Q?n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>{const z=document.getElementById(`staff-${U.id}-${M.id}`);if(!(z!=null&&z.value))return alert("Select staff member");if(te){const he={staff_id:Number(z.value),is_active:!0};hr(`/api/academics/teaching-assignments/${te.id}/`,{method:"PATCH",body:JSON.stringify(he)}).then(X=>{X.ok?(alert("Updated successfully"),re(U.id,M.id),A()):X.text().then(H=>alert("Error: "+H))})}else{const he={section_id:U.id,staff_id:Number(z.value),curriculum_row_id:M.id,is_active:!0};hr("/api/academics/teaching-assignments/",{method:"POST",body:JSON.stringify(he)}).then(X=>{X.ok?(alert("Assigned successfully"),re(U.id,M.id),A()):X.text().then(H=>alert("Error: "+H))})}},className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors border border-green-300",title:"Save Assignment",children:n.jsx(kc,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>re(U.id,M.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-red-300",title:"Cancel",children:n.jsx(Qo,{className:"h-4 w-4"})}),te&&n.jsx("button",{onClick:async()=>{if(confirm("Delete teaching assignment for this subject/section?"))try{const z=await hr(`/api/academics/teaching-assignments/${te.id}/`,{method:"DELETE"});if(z.ok)alert("Deleted"),re(U.id,M.id),A();else{const he=await z.text().catch(()=>null);alert("Failed: "+(he||z.status))}}catch(z){console.error(z),alert("Failed to delete")}},className:"p-2 text-red-700 hover:bg-red-50 rounded-lg transition-colors border border-red-300",title:"Delete Assignment",children:n.jsx(ap,{className:"h-4 w-4"})})]}):n.jsx(n.Fragment,{children:n.jsx("button",{onClick:()=>K(U.id,M.id),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-blue-300",title:"Edit Assignment",children:n.jsx(_d,{className:"h-4 w-4"})})})})})]},`${U.id}-${M.id}`)})})]})})]},U.id)})})]}),T&&n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Elective Subject Assignments"}),a.length>1&&n.jsxs("div",{className:"mb-6",children:[n.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Filter by Department"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{onClick:()=>d(null),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${c===null?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Departments"}),a.map(U=>n.jsx("button",{onClick:()=>d(U.id),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${c===U.id?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:U.short_name||U.code||U.name||`Dept ${U.id}`},U.id))]})]}),n.jsx("div",{className:"space-y-4",children:y.filter(U=>!c||U.department&&U.department.id===c).length===0?n.jsx("div",{className:"text-gray-500 text-sm",children:"No elective parents found for the selected department."}):y.filter(U=>!c||U.department&&U.department.id===c).map(U=>n.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[n.jsx("div",{className:"flex justify-between items-center mb-4",children:n.jsx("div",{className:"font-semibold text-gray-900",children:U.course_name||U.course_code||"Elective"})}),n.jsx("div",{className:"space-y-3",children:(x&&x.filter(I=>I.parent===U.id)).map(I=>{var Q,G;const M=Fe(I.id),te=fe(I.id);return console.log(`Elective ${I.course_code} (ID: ${I.id}):`,{opt:I,existingElectiveAssignment:M,allAssignments:p.filter(ne=>ne.subject&&(ne.subject.includes(I.course_code)||ne.subject.includes(I.course_name)))}),n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200",children:[n.jsxs("div",{className:"flex-1 text-sm font-medium text-gray-900",children:[I.course_code||"-","  ",I.course_name||"-"]}),n.jsx("div",{className:"min-w-[200px]",children:te?n.jsxs("select",{id:`elective-staff-${I.id}`,defaultValue:((Q=M==null?void 0:M.staff_details)==null?void 0:Q.id)||(M==null?void 0:M.staff)||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"",children:"-- select staff --"}),r.map(ne=>n.jsxs("option",{value:ne.id,children:[ne.staff_id," - ",C4(ne)]},ne.id))]}):M?n.jsxs("div",{className:"text-sm text-gray-900 font-medium",children:[(G=M.staff_details)==null?void 0:G.staff_id," - ",E4(M.staff_details)]}):n.jsx("div",{className:"text-sm text-gray-500 italic",children:"Not assigned"})}),n.jsx("div",{className:"flex items-center gap-2",children:te?n.jsxs(n.Fragment,{children:[n.jsx("button",{disabled:!W,onClick:()=>{if(!W)return alert("No permission to assign electives");const ne=document.getElementById(`elective-staff-${I.id}`);if(!(ne!=null&&ne.value))return alert("Select staff member");E(I.id,Number(ne.value),M==null?void 0:M.id).then(()=>{me(I.id)}).catch(()=>{})},className:`p-2 rounded-lg transition-colors ${W?"text-green-600 hover:bg-green-50 border border-green-300":"text-gray-400 bg-gray-100 cursor-not-allowed border border-gray-300"}`,title:W?"Save Assignment":"No permission",children:n.jsx(kc,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>me(I.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-red-300",title:"Cancel",children:n.jsx(Qo,{className:"h-4 w-4"})}),M&&n.jsx("button",{onClick:async()=>{if(confirm("Delete elective teaching assignment for this option?"))try{const ne=await hr(`/api/academics/teaching-assignments/${M.id}/`,{method:"DELETE"});if(ne.ok)alert("Deleted"),me(I.id),A();else{const z=await ne.text().catch(()=>null);alert("Failed: "+(z||ne.status))}}catch(ne){console.error(ne),alert("Failed to delete")}},className:"p-2 text-red-700 hover:bg-red-50 rounded-lg transition-colors border border-red-300",title:"Delete Assignment",children:n.jsx(ap,{className:"h-4 w-4"})})]}):n.jsx(n.Fragment,{children:n.jsx("button",{onClick:()=>q(I.id),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-blue-300",title:"Edit Assignment",children:n.jsx(_d,{className:"h-4 w-4"})})})})]},I.id)})})]},U.id))})]})]})})}function OJ(){const[e,t]=v.useState([]),[r,s]=v.useState(!1),[a,i]=v.useState(null);v.useEffect(()=>{o()},[]),v.useEffect(()=>{e.length>0&&a===null&&i(e[0].section_id)},[e]);async function o(){s(!0);try{const d=await hr("/api/academics/my-students/");if(!d.ok)throw new Error(await d.text());const u=await d.json();t(u.results||[])}catch(d){console.error(d),alert("Failed to load your students. See console for details.")}finally{s(!1)}}const l=e.find(d=>d.section_id===a),c=[...(l==null?void 0:l.students)||[]].sort((d,u)=>d.reg_no.localeCompare(u.reg_no));return r?n.jsx("div",{className:"min-h-screen p-4 md:p-6 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(zi,{className:"w-8 h-8 text-indigo-600 animate-spin"}),n.jsx("span",{className:"text-slate-600 text-lg",children:"Loading student information..."})]})}):n.jsxs("div",{className:"min-h-screen p-4 md:p-6 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm mb-6 p-6 border border-slate-200",children:n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 p-3 rounded-xl shadow-lg",children:n.jsx(v0,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"My Students"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"View and manage your assigned student profiles"})]})]}),n.jsx("div",{className:"px-4 py-2 bg-gradient-to-r from-slate-100 to-indigo-100 rounded-lg",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Qs,{className:"w-5 h-5 text-indigo-700"}),n.jsxs("span",{className:"text-sm font-semibold text-indigo-900",children:["Total: ",e.reduce((d,u)=>d+u.students.length,0)]})]})})]})}),e.length===0&&!r&&n.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12",children:n.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[n.jsx("div",{className:"bg-slate-100 p-4 rounded-full mb-4",children:n.jsx(Qs,{className:"w-16 h-16 text-slate-400"})}),n.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No Students Assigned"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"You don't have any students assigned to your sections yet."})]})}),e.length>0&&n.jsx("div",{className:"mb-6 flex flex-wrap gap-3",children:e.map(d=>{const u=a===d.section_id;return n.jsxs("button",{onClick:()=>i(d.section_id),className:`px-5 py-2 rounded-full font-medium text-sm transition-all duration-200 flex items-center gap-2 ${u?"bg-gradient-to-r from-indigo-600 to-cyan-500 text-white shadow-lg shadow-indigo-200":"bg-white text-slate-700 border border-slate-200 hover:border-indigo-300 hover:bg-slate-50"}`,children:[d.section_name,n.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${u?"bg-white/25 text-white":"bg-slate-100 text-slate-700"}`,children:d.students.length})]},d.section_id)})}),c.length>0&&n.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gradient-to-r from-slate-50 to-indigo-50 border-b-2 border-slate-200",children:[n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-indigo-900",children:"S.No"}),n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-indigo-900",children:"Registration No"}),n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-indigo-900",children:"Student Name"}),n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-indigo-900",children:"Email"})]})}),n.jsx("tbody",{className:"divide-y divide-slate-200",children:c.map((d,u)=>n.jsxs("tr",{className:"hover:bg-blue-50 transition-colors",children:[n.jsx("td",{className:"py-3 px-4",children:n.jsx("span",{className:"text-sm font-medium text-slate-600",children:u+1})}),n.jsx("td",{className:"py-3 px-4",children:n.jsx("span",{className:"text-sm font-semibold text-slate-900",children:d.reg_no})}),n.jsx("td",{className:"py-3 px-4",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(qR,{className:"w-5 h-5 text-slate-400"}),n.jsx("span",{className:"text-sm font-medium text-slate-900",children:d.first_name&&d.last_name?`${d.first_name} ${d.last_name}`.trim():d.username})]})}),n.jsx("td",{className:"py-3 px-4",children:n.jsx("div",{className:"flex items-center gap-2 text-slate-600",children:d.email?n.jsxs(n.Fragment,{children:[n.jsx(Jv,{className:"w-4 h-4 text-slate-400"}),n.jsx("span",{className:"text-sm",children:d.email})]}):n.jsx("span",{className:"text-sm text-slate-400",children:"-"})})})]},d.id))})]})})})]})}const IJ=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function T4(e){if(!e)return"";if(typeof e=="string"){const a=e.trim();return a.split(/[\s\-\_]+/)[0]||a.slice(0,15)+(a.length>15?"":"")}if(e.course_code)return e.course_code;const t=e.course_name||e.course||e.subject_text||"",r=String(t).trim();if(!r)return"";const s=r.split(/[\s\-\_]+/).filter(a=>a.length>0);return s.length>0?s[0]:r.slice(0,15)+(r.length>15?"":"")}function DJ(){const[e,t]=v.useState(null),[r,s]=v.useState([]),[a,i]=v.useState([]),[o,l]=v.useState(!1),[c,d]=v.useState(null);v.useEffect(()=>{u()},[]);async function u(){try{const h=await hr("/api/accounts/me/");if(!h.ok)throw new Error(await h.text());const p=await h.json(),f=p.profile||{};d(p.id),f.section_id&&t(f.section_id)}catch(h){console.error(h)}}return v.useEffect(()=>{e&&(l(!0),(async()=>{try{const h=await hr(`/api/timetable/section/${e}/timetable/`);if(!h.ok)throw new Error(await h.text());let f=(await h.json()).results||[];s(f);const x=[];for(const g of f||[])for(const y of g.assignments||[])x.find(m=>m.id===y.period_id)||x.push({id:y.period_id,index:y.period_index,is_break:y.is_break,label:y.label});x.sort((g,y)=>(g.index||0)-(y.index||0)),i(x)}catch(h){console.error(h)}finally{l(!1)}})())},[e]),n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-6",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl",children:n.jsx(ca,{className:"h-6 w-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Timetable"}),n.jsx("p",{className:"text-gray-600",children:"View your class schedule for the week"})]})]})}),o&&n.jsx("div",{className:"bg-white rounded-xl shadow-sm p-8 border border-gray-100",children:n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:"inline-flex items-center gap-2 text-gray-600",children:[n.jsx(zi,{className:"animate-spin h-5 w-5 text-indigo-600"}),n.jsx("span",{children:"Loading timetable..."})]})})}),!o&&!e&&n.jsx("div",{className:"bg-white rounded-xl shadow-sm p-8 border border-gray-100",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Wi,{className:"h-12 w-12 text-amber-500 mx-auto mb-3"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Section Not Assigned"}),n.jsx("p",{className:"text-gray-600",children:"You are not assigned to a section or your profile is incomplete."})]})}),!o&&e&&n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(mi,{className:"h-5 w-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Weekly Schedule"})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gradient-to-r from-slate-50 to-blue-50 border-b-2 border-gray-200",children:[n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 min-w-[100px] sticky left-0 bg-gradient-to-r from-slate-50 to-blue-50 z-10",children:"Day / Period"}),a.map(h=>n.jsx("th",{className:"px-4 py-3 text-left min-w-[140px]",children:n.jsx("div",{className:"text-sm font-bold text-indigo-700",children:h.is_break||h.is_lunch?h.label||(h.is_break?"Break":"Lunch"):h.label||`${h.start_time||""}${h.start_time&&h.end_time?" - ":""}${h.end_time||""}`})},`period-${h.id}`))]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:IJ.map((h,p)=>n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-4 py-3 font-bold text-gray-900 bg-gray-50 sticky left-0 z-10",children:h}),a.map(f=>{const g=((r.find(m=>m.day===p+1)||{assignments:[]}).assignments||[]).filter(m=>m.period_id===f.id),y=g.some(m=>m.is_special);return n.jsx("td",{className:`px-4 py-3 align-top ${y&&g.some(m=>!m.is_special)?"bg-red-50":""}`,children:f.is_break?n.jsx("div",{className:"flex items-center justify-center py-2",children:n.jsx("span",{className:"text-sm text-gray-500 italic",children:f.label||"Break"})}):g&&g.length?n.jsx("div",{className:"space-y-2",children:g.map((m,w)=>{var k,F;const S=y&&!m.is_special;return n.jsxs("div",{className:`rounded-lg p-2.5 ${m.is_special?"bg-amber-50 border border-amber-200":S?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"}`,children:[n.jsxs("div",{className:"font-semibold text-gray-900 text-xs leading-tight flex items-center gap-1",children:[n.jsx(va,{className:"h-3 w-3"}),m.is_special?m.timetable_name||"Special":T4(m.curriculum_row||m.subject_text),m.is_special&&n.jsxs("span",{className:"text-amber-600 ml-1",children:[" ",T4(m.curriculum_row||m.subject_text)]})]}),n.jsxs("div",{className:"text-xs text-gray-700 mt-1 flex items-center gap-1",children:[n.jsx(Qs,{className:"h-3 w-3"}),"Staff: ",((k=m.staff)==null?void 0:k.username)||""]}),S&&n.jsx("div",{className:"text-xs text-red-600 mt-1 font-medium",children:"Overridden by special"}),m.is_special&&n.jsxs("div",{className:"text-xs text-amber-700 mt-1 flex items-center gap-1",children:[n.jsx(ca,{className:"h-3 w-3"}),m.date||"","  ",f.label||""]}),m.subject_batch&&n.jsxs("div",{className:"text-xs text-blue-700 mt-1 font-medium",children:["Batch: ",m.subject_batch.name]}),S&&m.elective_subject&&n.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Elective: ",m.elective_subject.course_code||m.elective_subject.course_name]})]},`${m.id||((F=m.curriculum_row)==null?void 0:F.id)||w}`)})}):n.jsx("div",{className:"flex items-center justify-center py-4",children:n.jsx("span",{className:"text-gray-300 text-sm",children:""})})},`cell-${p}-${f.id}`)})]},`day-${p}`))})]})})]})]})})}const UJ=["Mon","Tue","Wed","Thu","Fri","Sat"];function L4(e){if(!e)return"";if(typeof e=="string"){const a=e.trim();return a.split(/[\s\-\_]+/)[0]||a.slice(0,15)+(a.length>15?"":"")}const t=(e==null?void 0:e.course_name)||(e==null?void 0:e.course)||(e==null?void 0:e.subject_text)||(e==null?void 0:e.course_code)||"",r=String(t).trim();if(!r)return"";const s=r.split(/[\s\-\_]+/).filter(a=>a.length>0);return s.length>0?s[0]:r.slice(0,15)+(r.length>15?"":"")}function $J(e){var a,i;if(Array.isArray(e)){const o=[],l=new Set;for(const c of e){const d=c.section,u=c.subject_batch||(d==null?void 0:d.batch);let h="";u!=null&&u.name&&(h+=u.name),d!=null&&d.name&&(h+=(h?" / ":"")+d.name),h||(d!=null&&d.id?h="Sec "+d.id:(a=c.subject_batch)!=null&&a.name&&(h=c.subject_batch.name)),h&&!l.has(h)&&(o.push(h),l.add(h))}return o.length?o.join(" + "):""}const t=e.section,r=e.subject_batch||(t==null?void 0:t.batch);let s="";return r!=null&&r.name&&(s+=r.name),t!=null&&t.name&&(s+=(s?" / ":"")+t.name),s||(t!=null&&t.id?s="Sec "+t.id:(i=e.subject_batch)!=null&&i.name&&(s=e.subject_batch.name)),s||""}function WJ(){const[e,t]=v.useState([]),[r,s]=v.useState([]),[a,i]=v.useState(!1);v.useEffect(()=>{o()},[]);async function o(){i(!0);try{const l=new Date().toISOString().slice(0,10),c=await hr(`/api/timetable/staff/?date=${l}`);if(!c.ok)throw new Error(await c.text());const d=await c.json();t(d.results||[]);const u=await hr("/api/timetable/templates/");if(u.ok){const h=await u.json(),p=h.find(f=>f.is_active)||h[0];if(p&&p.periods)s(p.periods);else{const f=[];for(const x of d.results||[])for(const g of x.assignments||[])f.find(y=>y.id===g.period_id)||f.push({id:g.period_id,index:g.period_index,is_break:g.is_break,is_lunch:g.is_lunch,label:g.label,start_time:g.start_time,end_time:g.end_time});f.sort((x,g)=>(x.index||0)-(g.index||0)),s(f)}}}catch(l){console.error(l)}finally{i(!1)}}return n.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:n.jsx(ca,{className:"h-6 w-6 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Timetable"}),n.jsx("p",{className:"text-gray-600",children:"View your assigned teaching schedule"})]})]})}),a?n.jsx("div",{className:"bg-white rounded-lg shadow-sm p-8",children:n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:"inline-flex items-center gap-2 text-gray-600",children:[n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-blue-600 border-t-transparent"}),n.jsx("span",{children:"Loading timetable..."})]})})}):n.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(mi,{className:"h-5 w-5 text-blue-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Weekly Schedule"})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-blue-50 border-b-2 border-gray-200",children:[n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-700",children:"Day / Period"}),r.map(l=>n.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-700 min-w-[120px]",children:l.label||`${l.start_time||""}${l.start_time&&l.end_time?" - ":""}${l.end_time||""}`},l.id))]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:UJ.map((l,c)=>n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-4 py-3 font-semibold text-gray-900 bg-gray-50",children:l}),r.map(d=>{const h=((e.find(f=>f.day===c+1)||{assignments:[]}).assignments||[]).filter(f=>f.period_id===d.id),p=h.some(f=>f.is_special);return n.jsx("td",{className:`px-4 py-3 ${p&&h.some(f=>!f.is_special)?"bg-red-50":""}`,children:d.is_break||d.is_lunch?n.jsx("div",{className:"flex items-center justify-center",children:n.jsx("span",{className:"text-sm text-gray-500 italic",children:d.label||(d.is_break?"Break":"Lunch")})}):h&&h.length?n.jsx("div",{className:"space-y-2",children:(()=>{var x;const f={};for(const g of h){let y="";g.is_special?y=`special_${g.timetable_name||g.id}`:g.curriculum_row&&g.curriculum_row.id?y=`curr_${g.curriculum_row.id}`:g.subject_batch&&g.subject_batch.id?y=`batch_${g.subject_batch.id}`:g.elective_subject&&g.elective_subject.id?y=`elective_${g.elective_subject.id}`:g.subject_text?y=`subj_${(g.subject_text||"").replace(/[^A-Za-z0-9]/g,"").toLowerCase()}`:y=`section_${((x=g.section)==null?void 0:x.id)||Math.random()}`,f[y]=f[y]||[],f[y].push(g)}return Object.keys(f).map((g,y)=>{const m=f[g],w=m[0],S=p&&!w.is_special,k=w.is_special?"bg-amber-50 border border-amber-200":S?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200";return n.jsxs("div",{className:`rounded-lg p-2.5 ${k}`,children:[n.jsxs("div",{className:"font-semibold text-gray-900 text-xs leading-tight",children:[w.is_special?w.timetable_name||"Special":L4(w.elective_subject||w.curriculum_row||w.subject_text),w.is_special&&n.jsxs("span",{className:"text-amber-600 ml-1",children:[" ",L4(w.elective_subject||w.curriculum_row||w.subject_text)]})]}),n.jsx("div",{className:"text-xs text-blue-700 font-medium mt-1",children:$J(m)}),S&&n.jsx("div",{className:"text-xs text-red-600 mt-1 font-medium",children:"Overridden"}),w.is_special&&n.jsx("div",{className:"text-xs text-amber-700 mt-1",children:w.date||""})]},y)})})()}):n.jsx("div",{className:"flex items-center justify-center py-4",children:n.jsx("span",{className:"text-gray-300 text-sm",children:""})})},d.id)})]},l))})]})})]})]})})}async function zJ(e){const t=e?`/api/academics/staff/${e}/assigned-subjects/`:"/api/academics/staff/assigned-subjects/",r=await hr(t);if(!r.ok)throw new Error("Failed to fetch assigned subjects");const s=await r.json();return s.results||s}async function ux(){const e=await hr("/api/academics/subject-batches/?page_size=0");if(!e.ok)throw new Error("Failed to fetch subject batches");const t=await e.json();return t.results||t}async function qJ(e){var a;const t=await hr("/api/academics/subject-batches/",{method:"POST",body:JSON.stringify(e)}),r=t.headers.get("content-type")||"",s=await t.text();if(!t.ok){const i=r.includes("application/json")&&((a=JSON.parse(s))==null?void 0:a.detail)||s;throw new Error(i)}return r.includes("application/json")?JSON.parse(s):s}function HJ(){const[e,t]=v.useState([]),[r,s]=v.useState([]),[a,i]=v.useState({}),[o,l]=v.useState(!0),[c,d]=v.useState(null),[u,h]=v.useState(null),[p,f]=v.useState(""),[x,g]=v.useState([]),[y,m]=v.useState([]),[w,S]=v.useState(null),[k,F]=v.useState([]),[L,C]=v.useState(!1),[O,T]=v.useState([]),[W,A]=v.useState(null),[N,P]=v.useState([]);v.useEffect(()=>{K()},[]);async function K(){l(!0),d(null);try{const M=await zJ(),te=await ux();t(M),s(te)}catch(M){console.error(M),d((M==null?void 0:M.message)||"Failed to load assigned subjects")}finally{l(!1)}}async function re(M){var Q;console.log("openPickerForAssignment clicked",M),d(null);const te=a[M.id]||`Batch for ${M.subject_code||M.subject_name||M.id}`;A(M),i(G=>({...G,[M.id]:te}));try{const G=await hr(`/api/academics/sections/${M.section_id}/students/`);if(!G.ok){const X=await G.text();throw new Error(X||"Failed to load students")}const ne=await G.json();let z=ne.results||ne;const he=M.curriculum_row_id||((Q=M.curriculum_row)==null?void 0:Q.id);if(he){const X=new Set;for(const H of r)if(H.curriculum_row&&H.curriculum_row.id===he)for(const oe of H.students||[])X.add(oe.id);z=z.filter(H=>!X.has(H.id))}T(z),P(z.map(X=>X.id)),C(!0)}catch(G){console.error("openPickerForAssignment error",G),d((G==null?void 0:G.message)||String(G)),alert("Failed to load students: "+((G==null?void 0:G.message)||G))}}async function ge(M){d(null),A(M),T([]),P([]);try{let te;if(M.section_id){const ne=await hr(`/api/academics/sections/${M.section_id}/students/`);if(!ne.ok)throw new Error(await ne.text());te=await ne.json()}else if(M.elective_subject_id){const ne=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${M.elective_subject_id}`);if(!ne.ok)throw new Error(await ne.text());te=await ne.json()}else throw new Error("No student mapping available for this assignment");const G=(te.results||te||[]).map(ne=>({id:Number(ne.id),reg_no:String(ne.reg_no??ne.regno??""),name:String(ne.username??ne.name??ne.full_name??""),section:ne.section_name??ne.section??null,section_id:ne.section_id??null}));T(G),P(G.map(ne=>ne.id)),C(!0)}catch(te){console.error("openListStudents error",te),d((te==null?void 0:te.message)||String(te)),alert("Failed to load students: "+((te==null?void 0:te.message)||te))}}function Fe(M){P(te=>te.includes(M)?te.filter(Q=>Q!==M):[...te,M])}async function R(){if(!W)return;const M=r.map(ne=>{const z=String(ne.name||"").match(/Batch\s*(\d+)/i);return z?parseInt(z[1],10):null}).filter(Boolean),G={name:`Batch ${(M.length?Math.max(...M):0)+1}`,student_ids:N};W.curriculum_row_id&&(G.curriculum_row_id=W.curriculum_row_id);try{await qJ(G);const ne=await ux();s(ne),C(!1),T([]),A(null),alert("Batch created for subject")}catch(ne){console.error(ne),alert("Failed to create batch: "+((ne==null?void 0:ne.message)||ne))}}async function q(M){if(h(M.id),f(M.name||""),S(M),m((M.students||[]).map(te=>te.id)),M.curriculum_row&&M.curriculum_row.id)try{const te=e.find(Q=>Q.curriculum_row_id===M.curriculum_row.id);if(te&&te.section_id){const Q=await hr(`/api/academics/sections/${te.section_id}/students/`);if(Q.ok){const G=await Q.json(),ne=G.results||G;g(ne)}}}catch(te){console.error("Failed to load students for batch editing:",te),g(M.students||[])}else g(M.students||[])}async function me(){if(u)try{const M={name:p,student_ids:y},te=await hr(`/api/academics/subject-batches/${u}/`,{method:"PATCH",body:JSON.stringify(M)});if(!te.ok)throw new Error(await te.text());const Q=await ux();s(Q),fe(),alert("Batch updated successfully")}catch(M){console.error("saveBatchEdit failed",M),alert("Failed to update batch: "+((M==null?void 0:M.message)||M))}}function fe(){h(null),f(""),S(null),g([]),m([])}function E(M){m(te=>te.includes(M)?te.filter(Q=>Q!==M):[...te,M])}async function U(M){if(confirm("Delete this batch?"))try{const te=await hr(`/api/academics/subject-batches/${M}/`,{method:"DELETE"});if(!te.ok)throw new Error(await te.text());const Q=await ux();s(Q),alert("Batch deleted")}catch(te){console.error("deleteBatch failed",te),alert("Failed to delete: "+((te==null?void 0:te.message)||te))}}const I={};return r.forEach(M=>{const te=M.curriculum_row&&M.curriculum_row.id?String(M.curriculum_row.id):"___no_cr";I[te]||(I[te]=[]),I[te].push(M)}),n.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 via-white to-gray-50 p-6",children:[n.jsx("div",{className:"bg-gradient-to-r from-white to-blue-50 rounded-xl shadow-lg p-6 mb-6",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-indigo-200 rounded-xl flex items-center justify-center",children:n.jsx(va,{className:"w-6 h-6 text-blue-700"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Assigned Subjects"}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View all subjects assigned to you for the current academic session"})]})]}),!o&&!c&&e.length>0&&n.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-full",children:[n.jsx("span",{className:"text-sm font-medium",children:"Total Subjects"}),n.jsx("span",{className:"bg-white/20 text-white px-3 py-1 rounded-full text-sm font-semibold",children:e.length})]})]})}),o&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[n.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"}),n.jsx("p",{className:"text-gray-600 font-medium",children:"Loading your assigned subjects..."})]}),c&&!o&&n.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Wi,{className:"w-8 h-8 text-red-600"})}),n.jsx("p",{className:"text-red-600 font-medium mb-4",children:c}),n.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",onClick:K,children:"Try Again"})]}),!o&&!c&&e.length===0&&n.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(tB,{className:"w-8 h-8 text-gray-400"})}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Subjects Assigned"}),n.jsx("p",{className:"text-gray-600",children:"You don't have any subjects assigned for the current session."})]}),!o&&!c&&e.length>0&&n.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-blue-50 border-b-2 border-gray-200",children:[n.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-blue-700",children:"S.No"}),n.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-blue-700",children:"Subject"}),n.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-blue-700",children:"Section"}),n.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-blue-700",children:"Batch"}),n.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-blue-700",children:"Semester"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:e.map((M,te)=>n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-6 py-4",children:n.jsx("span",{className:"text-sm font-medium text-gray-900",children:te+1})}),n.jsx("td",{className:"px-6 py-4",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"font-semibold text-gray-900",children:M.subject_name||"Unnamed Subject"}),M.subject_code&&n.jsx("div",{className:"text-sm text-blue-600 font-medium",children:M.subject_code})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:M.section_id?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-lg text-xs font-medium transition-colors",onClick:()=>re(M),children:"Create Batch"}),n.jsx("button",{type:"button",className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors",onClick:()=>ge(M),children:"List Students"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors",onClick:()=>ge(M),children:"List Students"}),n.jsx("span",{className:"text-xs text-gray-500 px-2 py-1",children:"Department-wide elective"})]})})]})}),n.jsx("td",{className:"px-6 py-4",children:M.section_name?n.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-1 rounded-full w-fit",children:[n.jsx(Qs,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm font-medium",children:M.section_name})]}):n.jsx("span",{className:"text-gray-400",children:""})}),n.jsx("td",{className:"px-6 py-4",children:M.batch?n.jsxs("div",{className:"flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1 rounded-full w-fit",children:[n.jsx(ca,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm font-medium",children:M.batch})]}):n.jsx("span",{className:"text-gray-400",children:""})}),n.jsx("td",{className:"px-6 py-4",children:M.semester!=null?n.jsxs("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-semibold",children:["Sem ",M.semester]}):n.jsx("span",{className:"text-gray-400",children:""})})]},M.id))})]})})}),n.jsx("div",{className:"mt-6",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[n.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[n.jsx(Qs,{className:"w-5 h-5 text-blue-600"}),"Student Subject Batches"]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Existing Batches"}),r.length===0&&n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(Qs,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),n.jsx("p",{children:"No batches created yet"})]}),e.map(M=>{const te=M.curriculum_row_id?String(M.curriculum_row_id):null,Q=te?I[te]||[]:[];return!Q||Q.length===0?null:n.jsxs("div",{className:"mb-6 border-b border-gray-100 pb-4 last:border-b-0",children:[n.jsx("div",{className:"font-bold text-gray-900 mb-3",children:M.subject_name||M.subject_code||"Unnamed Subject"}),n.jsx("div",{className:"space-y-3",children:Q.map(G=>n.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:G.name}),n.jsx("div",{className:"text-sm text-gray-600",children:n.jsxs("span",{className:"font-medium",children:[(G.students||[]).length," students"]})})]}),n.jsxs("div",{className:"ml-4 flex gap-2",children:[n.jsx("button",{className:"bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",onClick:()=>q(G),children:"Edit"}),n.jsx("button",{className:"bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",onClick:()=>U(G.id),children:"Delete"})]})]})},G.id))})]},`subject-${M.id}`)}),(()=>{const M=r.filter(te=>{const Q=te.curriculum_row&&te.curriculum_row.id?te.curriculum_row.id:null;return!Q||!e.some(G=>G.curriculum_row_id===Q)});return M.length===0?null:n.jsxs("div",{className:"mt-6",children:[n.jsx("div",{className:"font-bold text-gray-900 mb-3",children:"Other Batches"}),n.jsx("div",{className:"space-y-3",children:M.map(te=>n.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:te.name}),n.jsx("div",{className:"text-sm text-gray-600",children:n.jsxs("span",{className:"font-medium",children:[(te.students||[]).length," students"]})})]}),n.jsxs("div",{className:"ml-4 flex gap-2",children:[n.jsx("button",{className:"bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",onClick:()=>q(te),children:"Edit"}),n.jsx("button",{className:"bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",onClick:()=>U(te.id),children:"Delete"})]})]})},`other-${te.id}`))})]})})()]})]})}),L&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b border-gray-200",children:n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:a[(W==null?void 0:W.id)||""]||"Create Batch"}),n.jsx("div",{className:"text-sm text-gray-600",children:(W==null?void 0:W.subject_name)||(W==null?void 0:W.subject_code)})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{type:"button",className:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",onClick:()=>{C(!1),T([]),A(null)},children:"Cancel"}),n.jsx("button",{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:R,children:"Create Batch"})]})]})}),n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-4",children:[n.jsxs("h4",{className:"font-semibold text-gray-900 mb-2",children:["Students (",O.length,")"]}),n.jsx("p",{className:"text-sm text-gray-600",children:"Select students to include in this batch"})]}),n.jsx("div",{className:"max-h-96 overflow-y-auto",children:n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:O.map(M=>n.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[n.jsx("input",{type:"checkbox",checked:N.includes(M.id),onChange:()=>Fe(M.id),className:"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-900",children:M.username||M.full_name||M.reg_no}),M.reg_no&&n.jsx("div",{className:"text-xs text-gray-500",children:M.reg_no})]})]},M.id))})})]})]})}),u&&w&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b border-gray-200",children:n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:"Edit Batch"}),n.jsx("div",{className:"text-sm text-gray-600",children:"Modify batch name and student assignments"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{type:"button",className:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",onClick:fe,children:"Cancel"}),n.jsx("button",{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:me,children:"Save Changes"})]})]})}),n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Batch Name"}),n.jsx("input",{type:"text",value:p,onChange:M=>f(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter batch name"})]}),n.jsxs("div",{children:[n.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center justify-between",children:[n.jsxs("span",{children:["Students (",y.length," selected)"]}),n.jsx("div",{className:"text-sm text-gray-600",children:"Click to add/remove students"})]}),n.jsx("div",{className:"max-h-80 overflow-y-auto border border-gray-200 rounded-lg p-4",children:x.length===0?n.jsxs("div",{className:"text-center text-gray-500 py-4",children:[n.jsx(Qs,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),n.jsx("p",{children:"No students available for this batch"})]}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x.map(M=>n.jsxs("label",{className:`flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${y.includes(M.id)?"border-blue-300 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[n.jsx("input",{type:"checkbox",checked:y.includes(M.id),onChange:()=>E(M.id),className:"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-900",children:M.username||M.full_name||M.reg_no}),M.reg_no&&n.jsx("div",{className:"text-xs text-gray-500",children:M.reg_no})]})]},M.id))})})]})]})]})})]})}function VJ(){const[e,t]=v.useState(new Date().toISOString().slice(0,10)),[r,s]=v.useState([]),[a,i]=v.useState(!1),[o,l]=v.useState(null),[c,d]=v.useState([]),[u,h]=v.useState({}),[p,f]=v.useState(!1),[x,g]=v.useState(!1),[y,m]=v.useState(!1),[w,S]=v.useState(new Date().toISOString().slice(0,7)),[k,F]=v.useState([]),[L,C]=v.useState({}),[O,T]=v.useState([]),[W,A]=v.useState(!1),[N,P]=v.useState({}),[K,re]=v.useState({}),[ge,Fe]=v.useState({}),[R,q]=v.useState(!1),[me,fe]=v.useState(null),[E,U]=v.useState(null);v.useEffect(()=>{M()},[e]);function I(Y){const le={};for(const $e of Y){let je="";if($e.period&&$e.period.index!==void 0){const We=$e.period.index;$e.subject_batch_id?je=`batch_${We}_${$e.subject_batch_id}`:$e.elective_subject_id?je=`elective_${We}_${$e.teaching_assignment_id||$e.elective_subject_id}`:$e.subject?je=`subj_${We}_${String($e.subject||"").replace(/[^A-Za-z0-9]/g,"").toLowerCase()}`:je=`section_${We}_${$e.section_id}`}else $e.subject_batch_id?je=`batch_${$e.subject_batch_id}`:$e.elective_subject_id?je=`elective_${$e.teaching_assignment_id||$e.elective_subject_id}`:$e.subject?je=`subj_${String($e.subject).replace(/[^A-Za-z0-9]/g,"").toLowerCase()}`:je=`section_${$e.section_id}`;if(!le[je])le[je]={...$e,section_ids:[$e.section_id],section_names:[$e.section_name],attendance_session_ids:[$e.attendance_session_id]};else{const We=le[je];We.section_ids.includes($e.section_id)||We.section_ids.push($e.section_id),$e.section_name&&!We.section_names.includes($e.section_name)&&We.section_names.push($e.section_name),We.attendance_session_ids=Array.from(new Set([...We.attendance_session_ids||[],$e.attendance_session_id]))}}return Object.keys(le).map($e=>({...le[$e],id:$e}))}async function M(){i(!0);try{const Y=await hr(`/api/academics/staff/periods/?date=${e}`);if(!Y.ok)throw new Error("Failed to load periods");const le=await Y.json();s(le.results||[])}catch(Y){console.error("fetchPeriods",Y),s([])}finally{i(!1)}}function te(Y){var St;const le=Y.section_ids&&Array.isArray(Y.section_ids)&&Y.section_ids.length?Y.section_ids:[Y.section_id],$e=r.filter(rt=>!rt||rt.attendance_session_locked||!le.includes(rt.section_id)||Y.id&&rt.id===Y.id?!1:!!(Y.subject_batch_id&&rt.subject_batch_id===Y.subject_batch_id||Y.teaching_assignment_id&&rt.teaching_assignment_id===Y.teaching_assignment_id||Y.elective_subject_id&&rt.elective_subject_id===Y.elective_subject_id||Y.subject&&rt.subject===Y.subject));if($e.length===0)return null;const je=[...$e].sort((rt,ze)=>rt.period.index-ze.period.index),We=((St=Y.period)==null?void 0:St.index)||Y.period&&Y.period.index||0,Ee=je.find(rt=>rt.period.index>We),Re=[...je].reverse().find(rt=>rt.period.index<We),Ve=4;return Ee&&Ee.period.index-We<=Ve?Ee:Re&&We-Re.period.index<=Ve?Re:null}function Q(Y){const le=te(Y);le?(fe(Y),U(le),q(!0)):G(Y)}async function G(Y){l(Y),d([]),h({}),i(!0);try{let le=[];if(Y.section_ids&&Array.isArray(Y.section_ids)&&Y.section_ids.length>1)if(Y.elective_subject_id){const Ee=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${Y.elective_subject_id}`);Ee.ok&&(le=(await Ee.json()).results||[])}else{const Ee=[];for(const Ve of Y.section_ids)Ee.push(hr(`/api/academics/sections/${Ve}/students/`).then(St=>St.ok?St.json():{results:[]}).catch(()=>({results:[]})));const Re=await Promise.allSettled(Ee);for(const Ve of Re)if(Ve.status==="fulfilled"){const St=Ve.value||{},rt=St.results||St.students||[];le=le.concat(rt)}}else if(Y.elective_subject_id){const Ee=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${Y.elective_subject_id}`);Ee.ok&&(le=(await Ee.json()).results||[])}else if(Y.subject_batch_id){const Ee=await hr(`/api/academics/subject-batches/${Y.subject_batch_id}/`);if(Ee.ok){const Re=await Ee.json();le=Re.students||Re.results||[]}}else{const Ee=await hr(`/api/academics/sections/${Y.section_id}/students/`);Ee.ok&&(le=(await Ee.json()).results||[])}const $e={};for(const Ee of le||[])Ee&&Ee.id&&($e[Ee.id]=Ee);const je=Object.values($e);d((je||[]).map(Ee=>({id:Number(Ee.id),reg_no:String(Ee.reg_no||Ee.regno||String(Ee.id)),name:String(Ee.name??Ee.full_name??Ee.username??""),username:String(Ee.username??Ee.name??""),section:Ee.section_name??Ee.section??null,section_id:Ee.section_id??null})));const We={};if((je||[]).forEach(Ee=>We[Ee.id]="P"),h(We),Y.attendance_session_id||Y.attendance_session_ids&&Y.attendance_session_ids.length)try{const Re=(Y.attendance_session_ids&&Y.attendance_session_ids.length?Y.attendance_session_ids:[Y.attendance_session_id]).map(rt=>hr(`/api/academics/period-attendance/${rt}/`).then(ze=>ze.ok?ze.json():null).catch(()=>null)),Ve=await Promise.allSettled(Re),St={...We};for(const rt of Ve){if(rt.status!=="fulfilled"||!rt.value)continue;(rt.value.records||[]).forEach(ot=>{const be=ot.student_pk||ot.student&&ot.student.id||null;be&&(St[be]=ot.status||St[be]||"A")})}h(St)}catch(Ee){console.error("load session records",Ee)}}catch(le){console.error("openPeriod",le)}finally{i(!1)}}function ne(Y,le){h($e=>({...$e,[Y]:le}))}async function z(){if(o){f(!0);try{const Y=c.map(Re=>({student_id:Re.id,status:u[Re.id]||"P"})),le=o.consecutive_periods&&Array.isArray(o.consecutive_periods)&&o.consecutive_periods.length>0?o.consecutive_periods.map(Re=>Re.period_id):[o.period.id],$e=o.section_ids&&Array.isArray(o.section_ids)&&o.section_ids.length>0?o.section_ids:[o.section_id],je={};for(const Re of $e){const Ve=c.filter(St=>(St.section_id||null)===Re).map(St=>({student_id:St.id,status:u[St.id]||"P"}));if(Ve.length===0&&o.section_name){const St=new Set(String(o.section_name).split(" + ").map(ze=>ze.trim())),rt=c.filter(ze=>St.has(String(ze.section_name||ze.section||"").trim())).map(ze=>({student_id:ze.id,status:u[ze.id]||"P"}));je[Re]=rt.length?rt:c.map(ze=>({student_id:ze.id,status:u[ze.id]||"P"}))}else je[Re]=Ve.length?Ve:c.map(St=>({student_id:St.id,status:u[St.id]||"P"}))}const We=[];for(const Re of le)for(const Ve of $e){const St={section_id:Ve,period_id:Re,teaching_assignment_id:o.teaching_assignment_id??null,date:e,records:je[Ve]||[]};console.log("Saving attendance for section",Ve,"period",Re,St);const rt=await hr("/api/academics/period-attendance/bulk-mark/",{method:"POST",body:JSON.stringify(St)}),ze=await(rt.ok?rt.json().catch(()=>null):rt.json().catch(()=>null));We.push({section:Ve,period:Re,ok:rt.ok,data:ze})}const Ee=We.filter(Re=>!Re.ok);if(Ee.length)console.error("Some saves failed:",Ee),alert("Attendance saved for some sections/periods, but failed for others. Check console for details.");else{await M();const Re=o.combined_period_label||o.period&&(o.period.label||`Period ${o.period.index}`);alert(`Attendance saved successfully!

Date: ${e}
Period(s): ${Re}
Sections: ${$e.length}
Students: ${c.length}`),l(null)}}catch(Y){console.error("saveMarks error:",Y),alert("Failed to save attendance: "+(Y instanceof Error?Y.message:String(Y)))}finally{f(!1)}}}async function he(){var Y,le,$e,je,We,Ee;if(!(!me||!E)){q(!1);try{const Re=me;let Ve=[];if(Re.section_ids&&Array.isArray(Re.section_ids)&&Re.section_ids.length>1){const be=Re.section_ids.map(we=>hr(`/api/academics/sections/${we}/students/`).then(Me=>Me.ok?Me.json():{results:[]}).catch(()=>({results:[]})));if(Re.elective_subject_id){const we=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${Re.elective_subject_id}`);we.ok&&(Ve=(await we.json()).results||[])}else{const we=await Promise.allSettled(be);for(const Me of we)if(Me.status==="fulfilled"){const Wt=Me.value||{};Ve=Ve.concat(Wt.results||Wt.students||[])}}}else if(Re.elective_subject_id){const be=await hr(`/api/curriculum/elective-choices/?elective_subject_id=${Re.elective_subject_id}`);be.ok&&(Ve=(await be.json()).results||[])}else if(Re.subject_batch_id){const be=await hr(`/api/academics/subject-batches/${Re.subject_batch_id}/`);if(be.ok){const we=await be.json();Ve=we.students||we.results||[]}}else{const be=await hr(`/api/academics/sections/${Re.section_id}/students/`);be.ok&&(Ve=(await be.json()).results||[])}const St={};for(const be of Ve||[])be&&be.id&&(St[be.id]=be);let rt=Object.values(St).map(be=>({id:Number(be.id),reg_no:String(be.reg_no||be.regno||String(be.id)),username:be.username||be.name||"",section_id:be.section_id||be.sectionId||null,section_name:be.section_name||be.section||""}));if((!rt||rt.length===0)&&Re.section_ids&&Array.isArray(Re.section_ids)&&Re.section_ids.length>0){const be=Re.section_ids.map(Ct=>hr(`/api/academics/sections/${Ct}/students/`).then(pr=>pr.ok?pr.json():{results:[]}).catch(()=>({results:[]}))),we=await Promise.allSettled(be),Me=[];for(const Ct of we)if(Ct.status==="fulfilled"){const pr=Ct.value||{},fr=pr.results||pr.students||[];Me.push(...fr)}const Wt={};for(const Ct of Me)Ct&&Ct.id&&(Wt[Ct.id]=Ct);rt=Object.values(Wt).map(Ct=>({id:Number(Ct.id),reg_no:String(Ct.reg_no||Ct.regno||String(Ct.id)),username:Ct.username||Ct.name||"",section_id:Ct.section_id||Ct.sectionId||null,section_name:Ct.section_name||Ct.section||""}))}const ze={};rt.forEach(be=>ze[be.id]="P"),d(rt),h(ze);const Ie=`${((Y=me.period)==null?void 0:Y.label)||`Period ${(le=me.period)==null?void 0:le.index}`} & ${(($e=E.period)==null?void 0:$e.label)||`Period ${(je=E.period)==null?void 0:je.index}`}`,ot=Re.section_names&&Re.section_names.length?Re.section_names.join(" + "):Re.section_name||"";l({...me,consecutive_periods:[{period_id:me.period.id,label:((We=me.period)==null?void 0:We.label)||""},{period_id:E.period.id,label:((Ee=E.period)==null?void 0:Ee.label)||""}],combined_period_label:Ie,section_name:ot,section_ids:Re.section_ids||[Re.section_id]})}catch(Re){console.error("markBothPeriods error:",Re),alert("Failed to prepare marking for both periods: "+(Re instanceof Error?Re.message:String(Re)))}finally{q(!1),fe(null),U(null)}}}function X(){me&&(q(!1),G(me),fe(null),U(null))}async function H(){var je;if(!o||!o.attendance_session_id){alert("No active attendance session to lock/unlock");return}const Y=o.attendance_session_locked,le=o.attendance_session_id;if(window.confirm(Y?"Are you sure you want to request an unlock for this attendance session? Unlocking requires approval.":"Are you sure you want to lock this attendance session? This will prevent any further changes to attendance records.")){g(!0);try{if(Y){const We=await hr("/api/academics/attendance-unlock-requests/",{method:"POST",body:JSON.stringify({session:o.attendance_session_id,note:""})});if(We.ok){const Ee=await We.json();console.log("Unlock request created:",Ee),alert('Unlock request submitted successfully! Check the "My Requests" button in the Analytics page to view the status.');try{l(Re=>Re&&{...Re,unlock_request_status:Ee.status,unlock_request_id:Ee.id}),s(Re=>Re.map(Ve=>Ve.attendance_session_id&&le&&Ve.attendance_session_id===le?{...Ve,unlock_request_status:Ee.status,unlock_request_id:Ee.id}:Ve))}catch(Re){console.warn("Failed to update local unlock status",Re)}}else{const Ee=await We.json().catch(()=>({}));if(We.status===400&&((je=Ee.detail)!=null&&je.includes("already pending")))alert("An unlock request for this session already exists and is pending approval. Please check the Requests section for status.");else throw new Error(Ee.detail||"Failed to create unlock request")}}else{const We=await hr(`/api/academics/period-attendance/${o.attendance_session_id}/lock/`,{method:"POST"});if(!We.ok){const Re=await We.json().catch(()=>({}));throw new Error(Re.detail||"Failed to lock session")}const Ee=await We.json();console.log("Session locked successfully:",Ee),l({...o,attendance_session_locked:Ee.is_locked}),await M(),alert("Attendance session locked successfully!")}}catch(We){console.error("toggleLock error:",We),alert("Failed to perform lock/unlock: "+(We instanceof Error?We.message:String(We)))}finally{g(!1)}}}async function oe(){try{const Y=await hr("/api/timetable/staff/");if(!Y.ok)throw new Error("Failed to load assignments");const le=await Y.json(),$e=[];for(const je of le.results||[]){const We=je.day;for(const Ee of je.assignments||[])$e.push({...Ee,_day:We})}await D(w,$e),F($e),m(!0),C({}),P({}),re({})}catch(Y){console.error("openBulkModal",Y),alert("Failed to open bulk modal")}}async function D(Y,le){var $e,je;try{const[We,Ee]=Y.split("-").map(ot=>parseInt(ot)),Re=new Date(We,Ee-1,1).toISOString().slice(0,10),Ve=new Date(We,Ee,0).toISOString().slice(0,10),St=await hr(`/api/academics/period-attendance/?date_after=${Re}&date_before=${Ve}`);if(!St.ok){console.warn("Failed to load existing sessions"),Fe({});return}const ze=(await St.json()).results||[],Ie={};for(const ot of ze){const be=ot.date,we=(($e=ot.section)==null?void 0:$e.id)||ot.section_id,Me=((je=ot.period)==null?void 0:je.id)||ot.period_id;if(!be||!we||!Me)continue;const Wt=new Date(be),Ct=Wt.getDay()===0?7:Wt.getDay(),pr=le.find(fr=>{var Be,mt;return fr._day===Ct&&(fr.period_id===Me||((Be=fr.period)==null?void 0:Be.id)===Me)&&(fr.section_id===we||((mt=fr.section)==null?void 0:mt.id)===we)});if(pr){const fr=pr.id?String(pr.id):`${pr._day}_${Me}_${we}`;Ie[fr]||(Ie[fr]=new Set),Ie[fr].add(be)}}Fe(Ie),console.log("Loaded marked sessions:",Ie)}catch(We){console.error("Error loading marked sessions:",We),Fe({})}}return v.useEffect(()=>{y&&k.length>0&&D(w,k)},[w]),v.useEffect(()=>{async function Y(){var $e,je,We,Ee;if(!Object.keys(L).filter(Re=>L[Re]).length){T([]);return}A(!0);try{const Re=[];for(const rt of k){const ze=rt.id?String(rt.id):`${rt._day}_${rt.period_id}_${rt.section_id}`;if(L[ze]){if(rt.elective_subject_id)Re.push(hr(`/api/curriculum/elective-choices/?elective_subject_id=${rt.elective_subject_id}`).then(Ie=>Ie.ok?Ie.json():{results:[]}));else if(rt.subject_batch_id||($e=rt.subject_batch)!=null&&$e.id){const Ie=rt.subject_batch_id||((je=rt.subject_batch)==null?void 0:je.id);Re.push(hr(`/api/academics/subject-batches/${Ie}/`).then(ot=>ot.ok?ot.json():{students:[]}))}else if(rt.section_id||(We=rt.section)!=null&&We.id){const Ie=rt.section_id||((Ee=rt.section)==null?void 0:Ee.id);Re.push(hr(`/api/academics/sections/${Ie}/students/`).then(ot=>ot.ok?ot.json():{results:[]}))}}}const Ve=await Promise.allSettled(Re),St=[];for(const rt of Ve){if(rt.status!=="fulfilled")continue;const ze=rt.value||{},Ie=ze.results||ze.students||[];for(const ot of Ie)!ot||!ot.id||St.find(be=>be.id===ot.id)||St.push({id:ot.id,reg_no:ot.reg_no||ot.regno||String(ot.id),username:ot.username||ot.name||""})}T(St),re(rt=>{const ze={...rt};for(const Ie of St)ze[Ie.id]===void 0&&(ze[Ie.id]=!1);return ze})}catch(Re){console.error("loadAgg",Re),T([])}finally{A(!1)}}Y()},[L,k]),n.jsxs("div",{className:"min-h-screen p-4 md:p-6 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm mb-6 p-6 border border-slate-200",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 p-3 rounded-xl shadow-lg",children:n.jsx(ca,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"Mark Attendance"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Record student attendance for periods"})]})]})}),n.jsx("div",{className:"bg-white rounded-xl shadow-sm mb-6 p-4 border border-slate-200",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"text-sm font-medium text-slate-700 flex items-center gap-2",children:[n.jsx(mi,{className:"w-4 h-4 text-indigo-600"}),"Select Date:"]}),n.jsx("input",{type:"date",value:e,onChange:Y=>t(Y.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 mb-6",children:[n.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-slate-50",children:n.jsxs("h2",{className:"text-lg font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx(Qs,{className:"w-5 h-5 text-indigo-600"}),"Assigned Periods"]})}),n.jsx("div",{className:"p-6",children:a?n.jsxs("div",{className:"flex items-center justify-center py-12",children:[n.jsx(zi,{className:"w-8 h-8 text-indigo-600 animate-spin"}),n.jsx("span",{className:"ml-3 text-slate-600",children:"Loading periods..."})]}):n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[I(r).map(Y=>n.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow",children:[n.jsx("div",{className:"flex items-start justify-between mb-2",children:n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-semibold text-slate-900 mb-1",children:Y.period.label||`Period ${Y.period.index}`}),n.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-slate-600 mb-1",children:[n.jsx(mi,{className:"w-4 h-4"}),Y.period.start_time||"",Y.period.start_time&&Y.period.end_time?`  ${Y.period.end_time}`:""]}),n.jsx("div",{className:"text-sm text-slate-700 mb-1",children:n.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md bg-blue-100 text-blue-800 font-medium",children:Y.section_names&&Y.section_names.length?Y.section_names.join(" + "):Y.section_name})}),n.jsx("div",{className:"text-sm italic text-slate-600",children:Y.subject_display||Y.subject||"No subject"}),Y.unlock_request_status&&n.jsxs("div",{className:"mt-2",children:[Y.unlock_request_status==="PENDING"&&n.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-amber-100 text-amber-800 border border-amber-300 rounded-md text-xs font-medium",children:"Pending"}),Y.unlock_request_status==="APPROVED"&&n.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-100 text-green-800 border border-green-300 rounded-md text-xs font-medium",children:"Approved"}),Y.unlock_request_status==="REJECTED"&&n.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-red-100 text-red-800 border border-red-300 rounded-md text-xs font-medium",children:"Rejected"})]})]})}),n.jsx("div",{className:"mt-3",children:Y.attendance_session_locked?n.jsxs("button",{onClick:()=>G(Y),className:"w-full px-3 py-2 bg-amber-100 text-amber-800 border border-amber-300 rounded-lg text-sm font-medium hover:bg-amber-200 flex items-center justify-center gap-2",children:[n.jsx(ou,{className:"w-4 h-4"}),Y.attendance_session_id?"View Locked Session":"View Locked Period"]}):n.jsx("button",{onClick:()=>Q(Y),className:"w-full px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",children:Y.attendance_session_id?n.jsxs(n.Fragment,{children:[n.jsx(ru,{className:"w-4 h-4"}),"Open Session"]}):n.jsxs(n.Fragment,{children:[n.jsx(ca,{className:"w-4 h-4"}),"Take Attendance"]})})})]},Y.id)),!r.length&&n.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-center",children:[n.jsx("div",{className:"bg-slate-100 p-4 rounded-full mb-4",children:n.jsx(ca,{className:"w-12 h-12 text-slate-400"})}),n.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:"No Periods Found"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"No periods assigned for this date"})]}),n.jsx("div",{className:"col-span-full mt-2",children:n.jsx("button",{onClick:oe,className:"w-full px-4 py-3 border-2 border-dashed border-indigo-300 text-indigo-600 rounded-lg font-medium hover:bg-indigo-50 transition-colors",children:"Bulk Mark (All Assignments)"})})]})})]}),o&&n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 mb-6",children:[n.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 bg-slate-50 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:[o.combined_period_label||o.period.label||`Period ${o.period.index}`,"  ",o.section_name,n.jsxs("span",{className:"ml-3 inline-flex items-center px-2 py-0.5 rounded-md bg-slate-100 text-slate-700 text-sm font-medium",children:[c.length," student",c.length!==1?"s":""]})]}),o.attendance_session_locked&&n.jsxs(n.Fragment,{children:[n.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-amber-100 text-amber-800 border border-amber-300 rounded-lg text-sm font-medium",children:[n.jsx(ou,{className:"w-3.5 h-3.5"}),"Locked"]}),o.unlock_request_status==="PENDING"&&n.jsx("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-amber-50 text-amber-800 border border-amber-200 rounded-lg text-sm font-medium ml-3",children:"Pending"}),o.unlock_request_status==="APPROVED"&&n.jsx("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-green-50 text-green-800 border border-green-200 rounded-lg text-sm font-medium ml-3",children:"Approved"}),o.unlock_request_status==="REJECTED"&&n.jsx("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-red-50 text-red-800 border border-red-200 rounded-lg text-sm font-medium ml-3",children:"Rejected"})]})]}),n.jsxs("button",{onClick:()=>l(null),className:"px-3 py-1.5 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-medium transition-colors flex items-center gap-2",children:[n.jsx(Qo,{className:"w-4 h-4"}),"Close"]})]}),n.jsxs("div",{className:"p-6",children:[n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-200",children:[n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700 bg-slate-50",children:"Reg No"}),n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700 bg-slate-50",children:"Student"}),n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700 bg-slate-50",children:"Status"})]})}),n.jsx("tbody",{className:"divide-y divide-slate-200",children:c.map(Y=>{const le=u[Y.id]||"P",$e={P:"bg-green-50 text-green-800 border-green-300",A:"bg-red-50 text-red-800 border-red-300",LEAVE:"bg-amber-50 text-amber-800 border-amber-300",OD:"bg-blue-50 text-blue-800 border-blue-300",LATE:"bg-indigo-50 text-indigo-800 border-indigo-300"},je={P:"bg-green-600",A:"bg-red-600",LEAVE:"bg-amber-600",OD:"bg-blue-600",LATE:"bg-indigo-600"},We=$e[le]||$e.P,Ee=je[le]||je.P;return n.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[n.jsx("td",{className:"py-3 px-4 text-sm font-medium text-slate-900",children:Y.reg_no}),n.jsx("td",{className:"py-3 px-4 text-sm text-slate-700",children:Y.username}),n.jsx("td",{className:"py-3 px-4",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:`inline-block w-3 h-3 rounded-full mr-2 ${Ee}`}),n.jsxs("div",{className:"relative inline-block",children:[n.jsxs("select",{value:u[Y.id]||"P",onChange:Re=>ne(Y.id,Re.target.value),disabled:o.attendance_session_locked,className:`appearance-none px-3 py-1.5 pr-8 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${We} ${o.attendance_session_locked?"disabled:bg-slate-100 disabled:text-slate-500 disabled:cursor-not-allowed":""}`,children:[n.jsx("option",{value:"P",children:"Present"}),n.jsx("option",{value:"A",children:"Absent"}),n.jsx("option",{value:"LEAVE",children:"Leave"}),n.jsx("option",{value:"OD",children:"On Duty"}),n.jsx("option",{value:"LATE",children:"Late"})]}),n.jsx(C6,{className:"w-4 h-4 text-slate-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none"})]})]})})]},Y.id)})})]})}),n.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[n.jsx("button",{onClick:z,disabled:p||o.attendance_session_locked,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:p?n.jsxs(n.Fragment,{children:[n.jsx(zi,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):n.jsxs(n.Fragment,{children:[n.jsx(kc,{className:"w-4 h-4"}),"Save Attendance"]})}),o.attendance_session_id&&n.jsx("button",{onClick:H,disabled:x,className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${o.attendance_session_locked?"bg-amber-600 hover:bg-amber-700 disabled:bg-amber-300 text-white":"bg-slate-600 hover:bg-slate-700 disabled:bg-slate-300 text-white"}`,children:x?n.jsxs(n.Fragment,{children:[n.jsx(zi,{className:"w-4 h-4 animate-spin"}),o.attendance_session_locked?"Unlocking...":"Locking..."]}):n.jsx(n.Fragment,{children:o.attendance_session_locked?n.jsxs(n.Fragment,{children:[n.jsx(Ax,{className:"w-4 h-4"}),"Unlock Session"]}):n.jsxs(n.Fragment,{children:[n.jsx(ou,{className:"w-4 h-4"}),"Lock Session"]})})})]})]})]}),y&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-xl w-full max-w-3xl max-h-[85vh] overflow-y-auto shadow-2xl",children:[n.jsx("div",{className:"sticky top-0 bg-white border-b border-slate-200 px-6 py-4 rounded-t-xl",children:n.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Bulk Mark Attendance"})}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2",children:[n.jsx(ca,{className:"w-4 h-4 text-indigo-600"}),"Select Month:"]}),n.jsx("input",{type:"month",value:w,onChange:Y=>S(Y.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-3",children:"Assignments"}),n.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 max-h-60 overflow-y-auto bg-slate-50",children:[n.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm font-medium text-slate-700",children:[n.jsx("input",{type:"checkbox",checked:Object.keys(L).length>0&&Object.values(L).every(Boolean),onChange:Y=>{const le=Y.target.checked,$e={};for(const je of k){const We=je.id?String(je.id):`${je._day}_${je.period_id}_${je.section_id}`;$e[We]=le}C($e)},className:"w-4 h-4 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500"}),"Select / Deselect all"]}),n.jsx("div",{className:"space-y-2",children:(()=>{const Y=k.filter(le=>{const $e=le.id?String(le.id):`${le._day}_${le.period_id}_${le.section_id}`,je=ge[$e];if(!je)return!0;try{const[We,Ee]=w.split("-").map(St=>parseInt(St)),Re=new Date(We,Ee,0).getDate();let Ve=0;for(let St=1;St<=Re;St++){const rt=new Date(We,Ee-1,St);(rt.getDay()===0?7:rt.getDay())===le._day&&Ve++}return je.size<Ve}catch{return!0}});return Y.length===0?n.jsxs("div",{className:"text-center py-8 text-slate-600",children:[n.jsx(ru,{className:"w-12 h-12 text-green-500 mx-auto mb-2"}),n.jsx("p",{className:"font-medium",children:"All assignments are fully marked for this month!"})]}):Y.map(le=>{var Ee;const $e=le.id?String(le.id):`${le._day}_${le.period_id}_${le.section_id}`,je=ge[$e],We=je?je.size:0;return n.jsxs("label",{className:"flex items-start gap-3 p-2 hover:bg-white rounded-lg transition-colors cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:!!L[$e],onChange:()=>C(Re=>({...Re,[$e]:!Re[$e]})),className:"w-4 h-4 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500 mt-0.5"}),n.jsxs("div",{className:"flex-1 text-sm",children:[n.jsxs("div",{className:"font-medium text-slate-900",children:[le.label||`Period ${le.period_index}`,"  ",["Mon","Tue","Wed","Thu","Fri","Sat"][le._day-1]||`Day ${le._day}`,le.start_time?` ${le.start_time}${le.end_time?" - "+le.end_time:""}`:""]}),n.jsxs("div",{className:"text-xs text-slate-600 mt-0.5",children:[le.section_name||((Ee=le.section)==null?void 0:Ee.name)||(le.section_id?`Section ${le.section_id}`:""),"  ",le.subject_display||le.subject_text||"",We>0&&n.jsxs("span",{className:"ml-2 text-green-600 font-medium",children:["(",We," day",We!==1?"s":""," marked)"]})]})]})]},$e)})})()})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-3",children:"Dates (month view for selected assignments)"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{try{const[Y,le]=w.split("-").map(Ve=>parseInt(Ve)),$e=new Date(Y,le,0),je=new Set;for(const Ve of k){const St=Ve.id?String(Ve.id):`${Ve._day}_${Ve.period_id}_${Ve.section_id}`;L[St]&&je.add(Ve._day)}const We=[];for(let Ve=1;Ve<=$e.getDate();Ve++){const St=new Date(Y,le-1,Ve),rt=St.getDay()===0?7:St.getDay();je.size>0&&je.has(rt)&&We.push(St.toISOString().slice(0,10))}const Ee=Object.keys(L).filter(Ve=>L[Ve]),Re=We.filter(Ve=>Ee.length===0?!0:Ee.some(St=>{const rt=ge[St];return!rt||!rt.has(Ve)}));return Re.length===0&&Ee.length>0?n.jsxs("div",{className:"text-center py-4 text-slate-600",children:[n.jsx(ru,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),n.jsx("p",{className:"text-sm",children:"All dates are already marked for selected assignments"})]}):Re.map(Ve=>{const St=Ee.filter(rt=>{const ze=ge[rt];return ze&&ze.has(Ve)}).length;return n.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-1.5 border border-slate-300 rounded-lg text-sm hover:bg-slate-100 cursor-pointer transition-colors",children:[n.jsx("input",{type:"checkbox",checked:!!N[Ve],onChange:()=>P(rt=>({...rt,[Ve]:!rt[Ve]})),className:"w-4 h-4 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500"}),n.jsxs("span",{children:[Ve,St>0&&Ee.length>1&&n.jsxs("span",{className:"ml-1 text-xs text-amber-600",children:["(",St,"/",Ee.length," marked)"]})]})]},Ve)})}catch{return n.jsx("div",{})}})()})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-semibold text-slate-900 mb-3",children:["Students (derived from selected assignments)",n.jsxs("span",{className:"ml-2 text-sm text-slate-600",children:["(",O.length," student",O.length!==1?"s":"",")"]})]}),n.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 max-h-64 overflow-y-auto bg-slate-50",children:[W&&n.jsxs("div",{className:"flex items-center justify-center py-8 text-slate-600",children:[n.jsx(zi,{className:"w-6 h-6 animate-spin mr-2"}),"Loading students..."]}),!W&&O.length===0&&n.jsx("div",{className:"text-center py-8 text-slate-600",children:"No students for selected assignments"}),!W&&O.length>0&&n.jsx("div",{className:"space-y-1",children:O.map(Y=>n.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-white rounded-lg transition-colors cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:!!K[Y.id],onChange:le=>re($e=>({...$e,[Y.id]:!$e[Y.id]})),className:"w-4 h-4 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500"}),n.jsxs("span",{className:"text-sm text-slate-900",children:[Y.reg_no,"  ",Y.username]})]},Y.id))})]})]})]}),n.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-slate-200 px-6 py-4 flex gap-3 rounded-b-xl",children:[n.jsxs("button",{onClick:async()=>{var je,We,Ee,Re;const Y=Object.keys(N).filter(Ve=>N[Ve]);if(!Y.length){alert("Select at least one date");return}const le=[];for(const Ve of k){const St=Ve.id?String(Ve.id):`${Ve._day}_${Ve.period_id}_${((je=Ve.section)==null?void 0:je.id)||Ve.section_id}`;if(!L[St])continue;const rt=Ve.section_id||Ve.section&&(Ve.section.id||Ve.section.pk)||((We=Ve.section)==null?void 0:We.pk)||((Ee=Ve.section)==null?void 0:Ee.id),ze=Ve.period_id||Ve.period&&(Ve.period.id||Ve.period_id)||((Re=Ve.period)==null?void 0:Re.id)||Ve.period_id,Ie=Number(rt),ot=Number(ze);!Number.isFinite(Ie)||!Number.isFinite(ot)||le.push({section_id:Ie,period_id:ot})}const $e=Object.keys(K).filter(Ve=>K[Number(Ve)]).map(Ve=>Number(Ve));if(!le.length){alert("No assignments selected");return}if(!$e.length){alert("No students selected");return}try{const Ve=await hr("/api/academics/period-attendance/bulk-mark/",{method:"POST",body:JSON.stringify({assignments:le,dates:Y,student_ids:$e})});if(!Ve.ok){let St="Failed";try{const rt=await Ve.json();St=JSON.stringify(rt)}catch{try{St=await Ve.text()}catch{}}alert("Failed: "+St);return}alert("Bulk attendance saved"),m(!1)}catch(Ve){console.error("bulk save",Ve),alert("Failed to save bulk attendance")}},className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[n.jsx(kc,{className:"w-4 h-4"}),"Save Bulk"]}),n.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg font-medium transition-colors",children:"Close"})]})]})}),R&&me&&E&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md shadow-2xl",children:[n.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 px-6 py-4 rounded-t-xl",children:n.jsxs("div",{className:"flex items-center gap-3 text-white",children:[n.jsx(Wi,{className:"w-6 h-6"}),n.jsx("h3",{className:"text-xl font-bold",children:"Consecutive Periods Detected"})]})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[n.jsxs("p",{className:"text-sm text-slate-700 mb-3",children:["The same subject has consecutive periods",Math.abs(E.period.index-me.period.index)>1?" (with break/lunch in between)":"",":"]}),n.jsxs("div",{className:"space-y-2 mb-3",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-600"}),n.jsx("span",{className:"font-semibold text-slate-900",children:me.period.label||`Period ${me.period.index}`}),n.jsxs("span",{className:"text-slate-600",children:["(",me.period.start_time," - ",me.period.end_time,")"]})]}),Math.abs(E.period.index-me.period.index)>1&&n.jsx("div",{className:"flex items-center gap-2 text-sm pl-4",children:n.jsxs("span",{className:"text-slate-500 italic",children:[" ",Math.abs(E.period.index-me.period.index)-1," period(s) in between (break/lunch)"]})}),n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-600"}),n.jsx("span",{className:"font-semibold text-slate-900",children:E.period.label||`Period ${E.period.index}`}),n.jsxs("span",{className:"text-slate-600",children:["(",E.period.start_time," - ",E.period.end_time,")"]})]})]}),n.jsxs("p",{className:"text-sm font-medium text-slate-900",children:["Subject: ",n.jsx("span",{className:"text-indigo-600",children:me.subject||me.subject_display||"Same Subject"})]})]}),n.jsx("p",{className:"text-sm text-slate-600",children:"Would you like to mark attendance for both periods at once (all students Present), or just the selected period?"})]}),n.jsxs("div",{className:"px-6 pb-6 flex flex-col gap-3",children:[n.jsxs("button",{onClick:he,className:"w-full px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[n.jsx(ru,{className:"w-5 h-5"}),"Mark Both Periods (All Present)"]}),n.jsx("button",{onClick:X,className:"w-full px-4 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg font-medium transition-colors",children:"Single Period Only"}),n.jsx("button",{onClick:()=>{q(!1),fe(null),U(null)},className:"w-full px-4 py-2 text-slate-600 hover:text-slate-800 text-sm font-medium transition-colors",children:"Cancel"})]})]})})]})}const GJ=()=>{const[e,t]=v.useState("overview"),[r,s]=v.useState("class"),[a,i]=v.useState(!0),[o,l]=v.useState(null),[c,d]=v.useState(""),[u,h]=v.useState(""),[p,f]=v.useState(!0),[x,g]=v.useState(""),[y,m]=v.useState(""),[w,S]=v.useState(null),[k,F]=v.useState(null),[L,C]=v.useState([]),[O,T]=v.useState([]),[W,A]=v.useState([]),[N,P]=v.useState([]),[K,re]=v.useState(!1),[ge,Fe]=v.useState(!1),[R,q]=v.useState(null),[me,fe]=v.useState([]),[E,U]=v.useState(!1),[I,M]=v.useState(!1),[te,Q]=v.useState(!1),[G,ne]=v.useState([]),z=G.filter(Be=>Be.status==="PENDING").length,[he,X]=v.useState(null),[H,oe]=v.useState(!1),[D,Y]=v.useState(!0),[le,$e]=v.useState(!1),[je,We]=v.useState(!1),[Ee,Re]=v.useState(null),[Ve,St]=v.useState(null);v.useEffect(()=>{I&&rt()},[I]);const rt=async()=>{Q(!0);try{const Be=await hr("/api/academics/attendance-unlock-requests/"),mt=await Be.json();if(console.log("Unlock requests response:",mt),Be.ok){const It=Array.isArray(mt)?mt:mt.results||mt.data||[];console.log("Setting requests:",It),console.log("Request IDs:",It.map(ft=>({requestId:ft.id,sessionId:ft.session,status:ft.status}))),ne(It)}else console.error("Failed to load requests:",mt),ne([])}catch(Be){console.error("Error loading requests:",Be),ne([])}finally{Q(!1)}},ze=async(Be,mt)=>{if(console.log(`Attempting to ${mt} request with ID:`,Be),!!window.confirm(`Are you sure you want to ${mt} this request?`)){Q(!0);try{const It=await hr(`/api/academics/attendance-unlock-requests/${Be}/${mt}/`,{method:"POST"});if(!It.ok){const ft=await It.json().catch(()=>({}));throw new Error(ft.detail||"Failed")}alert(`Request ${mt==="approve"?"approved":"rejected"} successfully!`),await rt()}catch(It){alert("Failed: "+((It==null?void 0:It.message)||String(It))),Q(!1)}}},Ie=async Be=>{Fe(!0),re(!0),q(null);try{const mt=new Date().toISOString().split("T")[0],It=new URLSearchParams({section_id:String(Be),date:mt}),ft=await hr(`/api/academics/analytics/class-report/?${It}`),gr=await ft.json();ft.ok?q(gr):q(null)}catch{q(null)}finally{Fe(!1)}},ot=async(Be,mt)=>{We(!0),$e(!0),Re(null),St(mt||null);try{const It=new URLSearchParams({session_id:String(Be)}),ft=await hr(`/api/academics/analytics/period-log/?${It}`),gr=await ft.json().catch(()=>null);ft.ok?Re(gr):Re(null)}catch{Re(null)}finally{We(!1)}};v.useEffect(()=>{Me(),be(),we();const mt=new Date().toISOString().split("T")[0];h(mt),d(mt)},[]);const be=async()=>{oe(!0);try{const Be=await hr("/api/academics/analytics/today-periods/"),mt=await Be.json();Be.ok?X(mt):X(null)}catch(Be){console.error("Failed to load today periods:",Be),X(null)}finally{oe(!1)}},we=async()=>{U(!0);try{const Be=new Date().toISOString().split("T")[0],mt=await hr(`/api/academics/staff/periods/?date=${Be}`),It=await mt.json().catch(()=>({}));mt.ok?fe(It.results||[]):fe([])}catch(Be){console.error("Failed to load assigned periods",Be),fe([])}finally{U(!1)}};v.useEffect(()=>{c&&u&&Wt()},[e,c,u,x,y]);const Me=async()=>{try{const Be=await hr("/api/academics/analytics/filters/"),mt=await Be.json();Be.ok?(S(mt),s(mt.permission_level)):l(mt.error||"Failed to load filters")}catch(Be){l(Be.message)}},Wt=async()=>{i(!0),l(null);try{const Be=new URLSearchParams({view_type:e,start_date:c,end_date:u});x&&Be.append("department_id",x),y&&Be.append("section_id",y);const mt=await hr(`/api/academics/analytics/attendance/?${Be}`),It=await mt.json();mt.ok?(s(It.permission_level),e==="overview"&&It.data.summary?(F(It.data.summary),C(It.data.daily_trend||[])):e==="department"&&It.data.departments?T(It.data.departments):e==="class"&&It.data.classes?A(It.data.classes):e==="student"&&It.data.students&&P(It.data.students)):l(It.error||It.detail||"Failed to load analytics")}catch(Be){l(Be.message)}finally{i(!1)}},Ct=Be=>Be>=85?"text-green-600 bg-green-50":Be>=75?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50",pr=()=>{let Be="",mt="attendance_analytics.csv";if(e==="department"&&O.length>0?(Be=`Department,Total Records,Present,Absent,Leave,OD,Attendance Rate
`,O.forEach(It=>{Be+=`${It.department_name},${It.total_records},${It.present},${It.absent},${It.leave},${It.on_duty},${It.attendance_rate}%
`}),mt="department_analytics.csv"):e==="class"&&W.length>0?(Be=`Section,Course,Department,Total Records,Present,Absent,Leave,OD,Attendance Rate
`,W.forEach(It=>{Be+=`${It.section_name},${It.course_name},${It.department},${It.total_records},${It.present},${It.absent},${It.leave},${It.on_duty},${It.attendance_rate}%
`}),mt="class_analytics.csv"):e==="student"&&N.length>0&&(Be=`Reg No,Name,Section,Total Records,Present,Absent,Leave,OD,Late,Attendance Rate
`,N.forEach(It=>{Be+=`${It.reg_no},${It.name},${It.section},${It.total_records},${It.present},${It.absent},${It.leave},${It.on_duty},${It.late},${It.attendance_rate}%
`}),mt="student_analytics.csv"),Be){const It=new Blob([Be],{type:"text/csv;charset=utf-8;"}),ft=document.createElement("a");ft.href=URL.createObjectURL(It),ft.download=mt,ft.click()}},fr=(w==null?void 0:w.sections.filter(Be=>!x||Be.batch__course__department__id===parseInt(x)))||[];return n.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Attendance Analytics"}),n.jsxs("p",{className:"text-gray-600 mt-1",children:[r==="all"&&"All Departments Access",r==="department"&&"Department Level Access",r==="class"&&"Class Level Access"]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("button",{onClick:()=>M(!0),className:"relative flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[n.jsx(Wi,{className:"w-4 h-4"}),r==="all"?"All Requests":"My Requests",z>0&&n.jsx("span",{className:"absolute -top-2 -right-2 flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-red-600 rounded-full",children:z})]}),n.jsxs("button",{onClick:pr,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:a,children:[n.jsx(h1,{className:"w-4 h-4"}),"Export CSV"]})]})]}),I&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-xl w-full max-w-6xl max-h-[85vh] flex flex-col shadow-2xl",children:[n.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-indigo-600 to-blue-600 px-6 py-4 flex items-center justify-between rounded-t-xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Wi,{className:"w-6 h-6 text-white"}),n.jsx("h3",{className:"text-xl font-bold text-white",children:r==="all"?"All Unlock Requests":"My Unlock Requests"}),z>0&&n.jsxs("span",{className:"px-2 py-1 bg-white/20 text-white text-sm rounded-lg font-medium",children:[z," Pending"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:rt,disabled:te,className:"p-2 hover:bg-white/10 rounded-lg transition-colors disabled:opacity-50",title:"Refresh",children:n.jsx(L6,{className:`w-5 h-5 text-white ${te?"animate-spin":""}`})}),n.jsx("button",{onClick:()=>{M(!1),ne([])},className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:n.jsx(Qo,{className:"w-5 h-5 text-white"})})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[te&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[n.jsx(zi,{className:"w-12 h-12 text-indigo-600 animate-spin"}),n.jsx("p",{className:"text-gray-600",children:"Loading requests..."})]}),!te&&G.length===0&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[n.jsx("div",{className:"bg-gray-100 p-4 rounded-full",children:n.jsx(Wi,{className:"w-12 h-12 text-gray-400"})}),n.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Requests Found"}),n.jsx("p",{className:"text-gray-600 text-sm text-center max-w-md",children:r==="all"?"There are no unlock requests at this time":'You have no unlock requests. To request an unlock, go to the attendance marking page and click "Unlock Session" on a locked period.'})]}),!te&&G.length>0&&n.jsx("div",{className:"space-y-3",children:G.map(Be=>{const mt={PENDING:"bg-yellow-100 text-yellow-800 border-yellow-300",APPROVED:"bg-green-100 text-green-800 border-green-300",REJECTED:"bg-red-100 text-red-800 border-red-300"},ft={PENDING:mi,APPROVED:d1,REJECTED:u1}[Be.status]||mi;return n.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:n.jsxs("div",{className:"flex items-start justify-between gap-4",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["Request #",Be.id," (Session: ",Be.session_id||Be.session,")"]}),n.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium border ${mt[Be.status]||mt.PENDING}`,children:[n.jsx(ft,{className:"w-3 h-3"}),Be.status]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-gray-500",children:"Session:"}),n.jsx("span",{className:"ml-2 font-medium text-gray-900",children:Be.session_display||`Session #${Be.session&&Be.session.id||"N/A"}`})]}),r==="all"&&n.jsxs("div",{children:[n.jsx("span",{className:"text-gray-500",children:"Requested by:"}),n.jsx("span",{className:"ml-2 font-medium text-gray-900",children:Be.requested_by&&typeof Be.requested_by=="object"?Be.requested_by.username||Be.requested_by.staff_id||Be.requested_by.id:Be.requested_by_display||"N/A"})]}),n.jsxs("div",{children:[n.jsx("span",{className:"text-gray-500",children:"Requested at:"}),n.jsx("span",{className:"ml-2 font-medium text-gray-900",children:Be.requested_at?new Date(Be.requested_at).toLocaleString():"N/A"})]}),Be.note&&n.jsxs("div",{className:"col-span-2",children:[n.jsx("span",{className:"text-gray-500",children:"Note:"}),n.jsx("span",{className:"ml-2 text-gray-700 italic",children:Be.note})]})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:Be.status==="PENDING"?r==="all"?n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>ze(Be.id,"approve"),disabled:te,className:"flex items-center gap-1.5 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:[n.jsx(d1,{className:"w-4 h-4"}),"Approve"]}),n.jsxs("button",{onClick:()=>ze(Be.id,"reject"),disabled:te,className:"flex items-center gap-1.5 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:[n.jsx(u1,{className:"w-4 h-4"}),"Reject"]})]}):n.jsxs("div",{className:"text-sm text-gray-500 italic flex items-center gap-1.5",children:[n.jsx(mi,{className:"w-4 h-4"}),"Waiting for approval"]}):n.jsxs("div",{className:"text-sm text-gray-500",children:[(Be.reviewed_by_display||Be.reviewed_by)&&n.jsxs("div",{children:[n.jsx("span",{className:"text-gray-500",children:"Reviewed by:"}),n.jsx("span",{className:"ml-1 font-medium",children:Be.reviewed_by_display||`Staff #${Be.reviewed_by}`})]}),Be.reviewed_at&&n.jsx("div",{className:"text-xs text-gray-400",children:new Date(Be.reviewed_at).toLocaleString()})]})})]})},Be.id)})})]})]})}),!H&&he&&he.periods.length>0&&n.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-indigo-50 to-blue-50 cursor-pointer hover:from-indigo-100 hover:to-blue-100 transition-colors",onClick:()=>Y(!D),children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(mi,{className:"w-5 h-5 text-indigo-600"}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Today's Period Attendance"}),n.jsxs("p",{className:"text-sm text-gray-600",children:[new Date(he.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),"  ",he.total_periods," ",he.total_periods===1?"period":"periods"]})]})]}),n.jsx(C6,{className:`w-5 h-5 text-gray-600 transition-transform ${D?"rotate-180":""}`})]}),D&&n.jsx("div",{className:"p-6 overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Period"}),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),n.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Locked"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leave"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OD"}),n.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Report"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:he.periods.map(Be=>n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:[Be.period_label||`Period ${Be.period_index}`,n.jsx("div",{className:"text-xs text-gray-500",children:Be.period_start&&Be.period_end?`${Be.period_start} - ${Be.period_end}`:""})]}),n.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:[n.jsx("div",{className:"font-medium",children:Be.section_name}),Be.subject&&n.jsx("div",{className:"text-xs text-gray-500",children:Be.subject})]}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm",children:Be.is_locked?n.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-red-100 text-red-700",children:[n.jsx(ou,{className:"w-3 h-3 mr-1"}),"Locked"]}):n.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-50 text-green-700",children:[n.jsx(Ax,{className:"w-3 h-3 mr-1"}),"Unlocked"]})}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-900",children:Be.total_strength}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 font-semibold",children:Be.present}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-red-600 font-semibold",children:Be.absent}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-600",children:Be.leave}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-600",children:Be.on_duty}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx("button",{onClick:()=>ot(Be.session_id,Be),className:"px-2 py-1 text-xs bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"Report"}),n.jsx("button",{onClick:()=>Ie(Be.section_id),className:"px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200",children:"Class"})]})})]},Be.session_id))})]})})]}),H&&n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(zi,{className:"w-5 h-5 text-indigo-600 animate-spin"}),n.jsx("p",{className:"text-gray-600",children:"Loading today's period attendance..."})]})}),n.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(T6,{className:"w-5 h-5 text-gray-600"}),n.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Filters"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"col-span-1 md:col-span-2 lg:col-span-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Options"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"inline-flex items-center",children:[n.jsx("input",{type:"checkbox",checked:p,onChange:Be=>{const mt=Be.target.checked;f(mt);const It=new Date().toISOString().split("T")[0];if(mt){const ft=c||It;d(ft),h(ft)}},className:"mr-2"}),"Single Day"]}),n.jsx("button",{type:"button",onClick:()=>{const Be=new Date().toISOString().split("T")[0];d(Be),h(Be)},className:"px-2 py-1 text-xs bg-gray-100 rounded",children:"Today"})]}),p?n.jsx("div",{className:"mt-2",children:n.jsx("input",{type:"date",value:c,onChange:Be=>{const mt=Be.target.value,It=new Date().toISOString().split("T")[0];mt?(d(mt),h(mt)):(d(It),h(It))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mt-2"})}):n.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[n.jsx("input",{type:"date",value:c,onChange:Be=>{const mt=Be.target.value;if(mt)d(mt);else{const It=new Date().toISOString().split("T")[0];d(It)}},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),n.jsx("input",{type:"date",value:u,onChange:Be=>{const mt=Be.target.value;if(mt)h(mt);else{const It=new Date().toISOString().split("T")[0];h(It)}},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),r==="all"&&w&&w.departments.length>0&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),n.jsxs("select",{value:x,onChange:Be=>{g(Be.target.value),m("")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"",children:"All Departments"}),w.departments.map(Be=>n.jsxs("option",{value:Be.id,children:[Be.short_name," - ",Be.name]},Be.id))]})]}),(r==="all"||r==="department")&&fr.length>0&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Section"}),n.jsxs("select",{value:y,onChange:Be=>m(Be.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"",children:"All Sections"}),fr.map(Be=>n.jsxs("option",{value:Be.id,children:[Be.name," - ",Be.batch__course__name]},Be.id))]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-2",children:[n.jsx("div",{className:"sm:hidden",children:n.jsxs("select",{value:e,onChange:Be=>t(Be.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"overview",children:"Overview"}),n.jsx("option",{value:"department",children:"By Department"}),n.jsx("option",{value:"class",children:"By Class"}),n.jsx("option",{value:"student",children:"By Student"}),n.jsx("option",{value:"period",children:"By Period"})]})}),n.jsxs("div",{className:"hidden sm:flex gap-2",children:[n.jsxs("button",{onClick:()=>t("overview"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${e==="overview"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(PR,{className:"w-4 h-4"}),"Overview"]}),n.jsxs("button",{onClick:()=>t("department"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${e==="department"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(TR,{className:"w-4 h-4"}),"By Department"]}),n.jsxs("button",{onClick:()=>t("class"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${e==="class"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(v0,{className:"w-4 h-4"}),"By Class"]}),n.jsxs("button",{onClick:()=>t("student"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${e==="student"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(Qs,{className:"w-4 h-4"}),"By Student"]}),n.jsxs("button",{onClick:()=>t("period"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${e==="period"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(mi,{className:"w-4 h-4"}),"By Period"]})]})]}),o&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[n.jsx(Wi,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-red-900",children:"Error"}),n.jsx("p",{className:"text-red-700 text-sm",children:o})]})]}),a&&n.jsx("div",{className:"flex justify-center items-center py-12",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!a&&e==="overview"&&k&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Total Sessions"}),n.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:k.total_sessions})]}),n.jsx(ca,{className:"w-8 h-8 text-blue-600"})]})}),n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Total Records"}),n.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:k.total_records})]}),n.jsx(Qs,{className:"w-8 h-8 text-purple-600"})]})}),n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Present"}),n.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:k.present_count})]}),n.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:n.jsx("span",{className:"text-green-600 font-bold",children:""})})]})}),n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Absent"}),n.jsx("p",{className:"text-2xl font-bold text-red-600 mt-1",children:k.absent_count})]}),n.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:n.jsx("span",{className:"text-red-600 font-bold",children:""})})]})}),n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Attendance Rate"}),n.jsxs("p",{className:`text-2xl font-bold mt-1 ${k.attendance_rate>=85?"text-green-600":k.attendance_rate>=75?"text-yellow-600":"text-red-600"}`,children:[k.attendance_rate,"%"]})]}),n.jsx(F6,{className:"w-8 h-8 text-blue-600"})]})})]}),L.length>0&&n.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Daily Attendance Trend"}),n.jsx("div",{className:"overflow-x-auto",children:n.jsx("div",{className:"min-w-full",children:L.map((Be,mt)=>{const It=Be.total>0?Be.present/Be.total*100:0;return n.jsxs("div",{className:"flex items-center gap-4 py-2 border-b border-gray-100 last:border-b-0",children:[n.jsx("div",{className:"w-24 text-sm text-gray-600",children:new Date(Be.day).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-6 overflow-hidden",children:n.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${It}%`}})}),n.jsxs("span",{className:"text-sm font-medium text-gray-700 w-12 text-right",children:[It.toFixed(1),"%"]})]})}),n.jsxs("div",{className:"text-sm text-gray-500 w-32 text-right",children:[n.jsx("span",{className:"text-green-600",children:Be.present})," / ",Be.total]})]},mt)})})})]})]}),!a&&e==="period"&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-xl font-semibold",children:"Assigned Periods (Today)"}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("button",{onClick:we,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:E,children:"Refresh"})})]}),E&&n.jsxs("div",{className:"py-6 flex items-center gap-3",children:[n.jsx(zi,{className:"w-5 h-5 text-indigo-600 animate-spin"}),n.jsx("div",{className:"text-gray-600",children:"Loading assigned periods..."})]}),!E&&me.length===0&&n.jsx("div",{className:"text-gray-600",children:"No assigned periods found for today."}),n.jsx("div",{className:"overflow-x-auto bg-white rounded-lg border border-gray-200",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Period"}),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),n.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Locked"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leave"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OD"}),n.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Report"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:me.map(Be=>{var mt,It,ft,gr,Mr;return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:[((mt=Be.period)==null?void 0:mt.label)||`Period ${(It=Be.period)==null?void 0:It.index}`,n.jsx("div",{className:"text-xs text-gray-500",children:(ft=Be.period)!=null&&ft.start_time&&((gr=Be.period)!=null&&gr.end_time)?`${Be.period.start_time} - ${Be.period.end_time}`:""})]}),n.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:[n.jsx("div",{className:"font-medium",children:Be.section_name}),Be.subject_display&&n.jsx("div",{className:"text-xs text-gray-500",children:Be.subject_display})]}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm",children:Be.attendance_session_locked?n.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-red-100 text-red-700",children:[n.jsx(ou,{className:"w-3 h-3 mr-1"}),"Locked"]}):n.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-50 text-green-700",children:[n.jsx(Ax,{className:"w-3 h-3 mr-1"}),"Unlocked"]})}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-900",children:Be.total_strength??"-"}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 font-semibold",children:Be.present??"-"}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-red-600 font-semibold",children:Be.absent??"-"}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-600",children:Be.leave??"-"}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-600",children:Be.on_duty??"-"}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx("button",{onClick:()=>Be.attendance_session_id&&ot(Be.attendance_session_id,Be),disabled:!Be.attendance_session_id,className:`px-2 py-1 text-xs ${Be.attendance_session_id?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-100 text-gray-400 cursor-not-allowed"} rounded`,children:"Report"}),n.jsx("button",{onClick:()=>{var $r;return Ie(Be.section_id||(($r=Be.section)==null?void 0:$r.id)||Be.section_id)},className:"px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200",children:"Class"})]})})]},`${Be.id}-${((Mr=Be.period)==null?void 0:Mr.id)||"x"}`)})})]})})]}),!a&&e==="department"&&n.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[n.jsx("div",{className:"sm:hidden p-4 space-y-3",children:O.map(Be=>n.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-3 shadow-sm",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"text-sm font-semibold",children:[Be.department_short," - ",Be.department_name]}),n.jsxs("div",{className:"text-xs text-gray-500",children:["Total: ",Be.total_records]})]}),n.jsxs("div",{className:"text-sm text-right",children:[n.jsx("div",{className:"text-green-600 font-semibold",children:Be.present}),n.jsx("div",{className:"text-xs text-gray-500",children:"Present"})]})]}),n.jsxs("div",{className:"mt-2 grid grid-cols-4 gap-2 text-xs text-center",children:[n.jsxs("div",{className:"text-red-600",children:[Be.absent,n.jsx("div",{className:"text-gray-400",children:"Absent"})]}),n.jsxs("div",{className:"",children:[Be.leave,n.jsx("div",{className:"text-gray-400",children:"Leave"})]}),n.jsxs("div",{className:"",children:[Be.on_duty,n.jsx("div",{className:"text-gray-400",children:"OD"})]}),n.jsxs("div",{className:"",children:[Be.attendance_rate,"%",n.jsx("div",{className:"text-gray-400",children:"Rate"})]})]})]},Be.department_id))}),n.jsx("div",{className:"hidden sm:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leave"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OD"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O.map(Be=>n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:Be.department_short}),n.jsx("div",{className:"text-xs text-gray-500",children:Be.department_name})]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:Be.total_records}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-green-600 font-medium",children:Be.present}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-red-600 font-medium",children:Be.absent}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600",children:Be.leave}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600",children:Be.on_duty}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:n.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Ct(Be.attendance_rate)}`,children:[Be.attendance_rate,"%"]})})]},Be.department_id))})]})}),O.length===0&&n.jsx("div",{className:"text-center py-12 text-gray-500",children:"No data available for the selected period"})]}),!a&&e==="class"&&n.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[n.jsx("div",{className:"sm:hidden p-4 space-y-3",children:W.map(Be=>n.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-3 shadow-sm",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold",children:Be.section_name}),n.jsxs("div",{className:"text-xs text-gray-500",children:[Be.course_name,"  ",Be.department]})]}),n.jsxs("div",{className:"text-sm text-right",children:[n.jsx("div",{className:"text-green-600 font-semibold",children:Be.present}),n.jsx("div",{className:"text-xs text-gray-500",children:"Present"})]})]}),n.jsxs("div",{className:"mt-2 grid grid-cols-4 gap-2 text-xs text-center",children:[n.jsxs("div",{className:"text-gray-900",children:[Be.total_records,n.jsx("div",{className:"text-gray-400",children:"Total"})]}),n.jsxs("div",{className:"text-red-600",children:[Be.absent,n.jsx("div",{className:"text-gray-400",children:"Absent"})]}),n.jsxs("div",{className:"",children:[Be.leave,n.jsx("div",{className:"text-gray-400",children:"Leave"})]}),n.jsxs("div",{className:"",children:[Be.on_duty,n.jsx("div",{className:"text-gray-400",children:"OD"})]})]}),n.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:["Rate: ",Be.attendance_rate,"%"]}),n.jsx("button",{onClick:()=>Ie(Be.section_id),className:"px-2 py-1 text-xs bg-indigo-600 text-white rounded",children:"Report"})]})]},Be.section_id))}),n.jsx("div",{className:"hidden sm:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Section"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dept"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leave"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OD"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:W.map(Be=>n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:Be.section_name}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:Be.course_name}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:Be.department}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:Be.total_records}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-green-600 font-medium",children:Be.present}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-red-600 font-medium",children:Be.absent}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600",children:Be.leave}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600",children:Be.on_duty}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:n.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Ct(Be.attendance_rate)}`,children:[Be.attendance_rate,"%"]})}),n.jsx("td",{className:"px-4 py-4",children:n.jsx("button",{onClick:()=>Ie(Be.section_id),className:"px-2 py-1 text-xs bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"Report"})})]},Be.section_id))})]})}),W.length===0&&n.jsx("div",{className:"text-center py-12 text-gray-500",children:"No data available for the selected period"})]}),K&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:n.jsx("div",{className:"bg-white rounded-lg shadow-lg w-11/12 max-w-md p-6",children:ge?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):R?n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Class Report"}),n.jsxs("p",{className:"text-sm text-gray-600",children:[R.department_short," / ",R.batch_name," / ",R.section_name,"  ",new Date(R.date).toLocaleDateString()]})]}),n.jsx("button",{onClick:()=>re(!1),className:"text-gray-500",children:"Close"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Total Strength"}),n.jsx("div",{className:"text-lg font-bold",children:R.total_strength})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Attendance %"}),n.jsxs("div",{className:"text-lg font-bold",children:[R.attendance_percentage,"%"]})]}),n.jsxs("div",{className:"p-3 bg-green-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Present"}),n.jsx("div",{className:"text-lg font-bold text-green-600",children:R.present})]}),n.jsxs("div",{className:"p-3 bg-red-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Absent"}),n.jsx("div",{className:"text-lg font-bold text-red-600",children:R.absent})]}),n.jsxs("div",{className:"p-3 bg-yellow-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Leave"}),n.jsx("div",{className:"text-lg font-bold",children:R.leave})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"OD"}),n.jsx("div",{className:"text-lg font-bold",children:R.on_duty})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm col-span-2",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Late"}),n.jsx("div",{className:"text-lg font-bold",children:R.late})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Students (last 3 digits)"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Absent"}),n.jsx("div",{className:"font-mono",children:R.absent_list&&R.absent_list.length?R.absent_list.join(", "):""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Leave"}),n.jsx("div",{className:"font-mono",children:R.leave_list&&R.leave_list.length?R.leave_list.join(", "):""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"OD"}),n.jsx("div",{className:"font-mono",children:R.od_list&&R.od_list.length?R.od_list.join(", "):""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Late"}),n.jsx("div",{className:"font-mono",children:R.late_list&&R.late_list.length?R.late_list.join(", "):""})]})]})]})]}):n.jsx("div",{className:"text-sm text-gray-500",children:"No report available."})})}),!a&&e==="student"&&n.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[n.jsx("div",{className:"sm:hidden p-4 space-y-3",children:N.map(Be=>n.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-3 shadow-sm",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"text-sm font-semibold",children:[Be.reg_no,"  ",Be.name]}),n.jsx("div",{className:"text-xs text-gray-500",children:Be.section})]}),n.jsxs("div",{className:"text-sm text-right",children:[n.jsx("div",{className:"text-green-600 font-semibold",children:Be.present}),n.jsx("div",{className:"text-xs text-gray-500",children:"Present"})]})]}),n.jsxs("div",{className:"mt-2 grid grid-cols-4 gap-2 text-xs text-center",children:[n.jsxs("div",{className:"text-gray-900",children:[Be.total_records,n.jsx("div",{className:"text-gray-400",children:"Total"})]}),n.jsxs("div",{className:"text-red-600",children:[Be.absent,n.jsx("div",{className:"text-gray-400",children:"Absent"})]}),n.jsxs("div",{className:"",children:[Be.leave,n.jsx("div",{className:"text-gray-400",children:"Leave"})]}),n.jsxs("div",{className:"",children:[Be.late,n.jsx("div",{className:"text-gray-400",children:"Late"})]})]}),n.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Rate: ",Be.attendance_rate,"%"]})]},Be.student_id))}),n.jsx("div",{className:"hidden sm:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reg No"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Section"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leave"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OD"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Late"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(Be=>n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:Be.reg_no}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Be.name}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:Be.section}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:Be.total_records}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-green-600 font-medium",children:Be.present}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-red-600 font-medium",children:Be.absent}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600",children:Be.leave}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600",children:Be.on_duty}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600",children:Be.late}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:n.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Ct(Be.attendance_rate)}`,children:[Be.attendance_rate,"%"]})})]},Be.student_id))})]})}),N.length===0&&n.jsx("div",{className:"text-center py-12 text-gray-500",children:"No data available for the selected period"})]}),!a&&e==="period"&&n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:n.jsxs("div",{className:"p-6",children:[n.jsx("div",{className:"flex items-center justify-between mb-4",children:n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Periods"}),n.jsxs("p",{className:"text-sm text-gray-600",children:["List of periods and their logs for ",c||"today"]})]})}),H&&n.jsxs("div",{className:"py-6 flex items-center gap-3",children:[n.jsx(zi,{className:"w-5 h-5 text-indigo-600 animate-spin"}),n.jsx("span",{className:"text-gray-600",children:"Loading periods..."})]}),!H&&he&&he.periods.length>0&&n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-2",children:he.periods.map(Be=>n.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold",children:Be.period_label}),n.jsxs("div",{className:"text-xs text-gray-500",children:[Be.period_start,"  ",Be.period_end]}),n.jsx("div",{className:"mt-2 text-sm text-blue-700 bg-blue-50 inline-block px-2 py-1 rounded",children:Be.section_name}),n.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Be.subject})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"text-green-600 font-semibold",children:Be.present}),n.jsx("div",{className:"text-xs text-gray-500",children:"Present"})]})]}),n.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[n.jsx("button",{onClick:()=>ot(Be.session_id,Be),className:"flex-1 px-3 py-2 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"View Log"}),n.jsx("button",{onClick:()=>Ie(Be.section_id),className:"px-3 py-2 text-sm bg-gray-100 rounded",children:"Class Report"})]})]},Be.session_id))}),!H&&(!he||he.periods.length===0)&&n.jsx("div",{className:"py-12 text-center text-gray-500",children:"No periods found for the selected date."})]})}),le&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:n.jsx("div",{className:"bg-white rounded-lg shadow-lg w-11/12 max-w-2xl p-6 max-h-[90vh] overflow-y-auto",children:je?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):Ee?n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Period Attendance Report"}),n.jsxs("p",{className:"text-sm text-gray-600",children:[Ee.period_label," (",Ee.period_start,"  ",Ee.period_end,")  ",Ee.subject]}),n.jsxs("p",{className:"text-sm text-gray-600",children:[Ee.department_short," / ",Ee.batch_name," / ",Ee.section_name,"  ",new Date(Ee.date).toLocaleDateString()]})]}),n.jsx("button",{onClick:()=>{$e(!1),Re(null)},className:"text-gray-500 hover:text-gray-700",children:n.jsx(Qo,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Total Strength"}),n.jsx("div",{className:"text-lg font-bold",children:Ee.total_strength})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Total Marked"}),n.jsx("div",{className:"text-lg font-bold",children:Ee.total_marked})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Attendance %"}),n.jsxs("div",{className:"text-lg font-bold",children:[Ee.attendance_percentage,"%"]})]}),n.jsx("div",{className:"p-3 bg-gray-50 rounded text-sm flex items-center justify-between",children:n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Status"}),n.jsx("div",{className:"text-sm font-semibold flex items-center gap-1 mt-1",children:Ee.is_locked?n.jsxs(n.Fragment,{children:[n.jsx(ou,{className:"w-4 h-4 text-red-600"}),n.jsx("span",{className:"text-red-600",children:"Locked"})]}):n.jsxs(n.Fragment,{children:[n.jsx(Ax,{className:"w-4 h-4 text-green-600"}),n.jsx("span",{className:"text-green-600",children:"Unlocked"})]})})]})}),n.jsxs("div",{className:"p-3 bg-green-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Present"}),n.jsx("div",{className:"text-lg font-bold text-green-600",children:Ee.present})]}),n.jsxs("div",{className:"p-3 bg-red-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Absent"}),n.jsx("div",{className:"text-lg font-bold text-red-600",children:Ee.absent})]}),n.jsxs("div",{className:"p-3 bg-yellow-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Leave"}),n.jsx("div",{className:"text-lg font-bold",children:Ee.leave})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"OD"}),n.jsx("div",{className:"text-lg font-bold",children:Ee.on_duty})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm col-span-2",children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Late"}),n.jsx("div",{className:"text-lg font-bold",children:Ee.late})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Students (last 3 digits)"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Absent"}),n.jsx("div",{className:"font-mono",children:Ee.absent_list&&Ee.absent_list.length?Ee.absent_list.join(", "):""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Leave"}),n.jsx("div",{className:"font-mono",children:Ee.leave_list&&Ee.leave_list.length?Ee.leave_list.join(", "):""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"OD"}),n.jsx("div",{className:"font-mono",children:Ee.od_list&&Ee.od_list.length?Ee.od_list.join(", "):""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Late"}),n.jsx("div",{className:"font-mono",children:Ee.late_list&&Ee.late_list.length?Ee.late_list.join(", "):""})]})]})]}),Ee.marked_by&&n.jsxs("div",{className:"text-xs text-gray-500 border-t pt-3",children:[n.jsxs("p",{children:["Marked by: ",n.jsx("span",{className:"font-semibold",children:Ee.marked_by})]}),Ee.marked_at&&n.jsxs("p",{children:["Marked at: ",new Date(Ee.marked_at).toLocaleString()]})]})]}):n.jsx("div",{className:"text-sm text-gray-500",children:"No report available for this period."})})})]})};function QJ(){const[e,t]=v.useState(""),[r,s]=v.useState(""),[a,i]=v.useState([]),[o,l]=v.useState(null),[c,d]=v.useState(!1);v.useEffect(()=>{const f=new Date,x=f.toISOString().slice(0,10),g=new Date(f.getTime()-1e3*60*60*24*30).toISOString().slice(0,10);t(g),s(x)},[]),v.useEffect(()=>{e&&r&&u()},[e,r]);async function u(){d(!0);try{const f=`?start_date=${e}&end_date=${r}`;console.log("Fetching student attendance:",{startDate:e,endDate:r,url:`/api/academics/student/attendance/${f}`});const x=await hr(`/api/academics/student/attendance/${f}`);if(!x.ok){const y=await x.text();throw console.error("Failed to fetch attendance:",x.status,y),new Error(`Failed to fetch (${x.status})`)}const g=await x.json();console.log("Student attendance response:",{recordCount:(g.results||[]).length,summary:g.summary,records:g.results}),i(g.results||[]),l(g.summary||null)}catch(f){console.error("fetchRecords error:",f),i([]),alert("Failed to load attendance records: "+(f instanceof Error?f.message:String(f)))}finally{d(!1)}}function h(f){switch(f){case"P":return"bg-green-100 text-green-800 border-green-200";case"A":return"bg-red-100 text-red-800 border-red-200";case"LEAVE":return"bg-blue-100 text-blue-800 border-blue-200";case"OD":return"bg-purple-100 text-purple-800 border-purple-200";case"LATE":return"bg-amber-100 text-amber-800 border-amber-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}}function p(f){switch(f){case"P":return n.jsx(ru,{className:"h-3.5 w-3.5"});case"A":return n.jsx(u1,{className:"h-3.5 w-3.5"});default:return n.jsx(Wi,{className:"h-3.5 w-3.5"})}}return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-6",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl",children:n.jsx(ru,{className:"h-6 w-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Attendance"}),n.jsx("p",{className:"text-gray-600",children:"View your attendance records and statistics"})]})]})}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(ca,{className:"h-5 w-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Date Range"})]}),n.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[n.jsxs("div",{className:"flex-1 min-w-[200px]",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"From Date"}),n.jsx("input",{type:"date",value:e,onChange:f=>t(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),n.jsxs("div",{className:"flex-1 min-w-[200px]",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"To Date"}),n.jsx("input",{type:"date",value:r,onChange:f=>s(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),n.jsx("button",{onClick:u,disabled:c,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-indigo-300 transition-colors font-medium flex items-center gap-2",children:c?n.jsxs(n.Fragment,{children:[n.jsx(zi,{className:"h-4 w-4 animate-spin"}),"Loading..."]}):n.jsxs(n.Fragment,{children:[n.jsx(ca,{className:"h-4 w-4"}),"Refresh"]})})]}),!c&&a.length>0&&n.jsxs("div",{className:"mt-3 text-sm text-gray-600 flex items-center gap-2",children:[n.jsx(ru,{className:"h-4 w-4 text-green-600"}),"Showing ",a.length," attendance record",a.length!==1?"s":""," from ",e," to ",r]})]}),c?n.jsx("div",{className:"bg-white rounded-xl shadow-sm p-8 border border-gray-100",children:n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:"inline-flex items-center gap-2 text-gray-600",children:[n.jsx(zi,{className:"animate-spin h-5 w-5 text-indigo-600"}),n.jsx("span",{children:"Loading attendance records..."})]})})}):n.jsx("div",{children:a.length===0?n.jsx("div",{className:"bg-white rounded-xl shadow-sm p-8 border border-gray-100",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Wi,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Records Found"}),n.jsx("p",{className:"text-gray-600",children:"No attendance records found for the selected date range."})]})}):n.jsxs("div",{className:"space-y-6",children:[o&&n.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(F6,{className:"h-5 w-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Overall Attendance"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4 border border-green-200",children:[n.jsx("div",{className:"text-sm text-green-700 font-medium mb-1",children:"Attendance Rate"}),n.jsx("div",{className:"text-3xl font-bold text-green-900",children:o.overall.percentage!=null?`${o.overall.percentage.toFixed(1)}%`:"N/A"})]}),n.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[n.jsx("div",{className:"text-sm text-blue-700 font-medium mb-1",children:"Present"}),n.jsx("div",{className:"text-3xl font-bold text-blue-900",children:o.overall.present})]}),n.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200",children:[n.jsx("div",{className:"text-sm text-purple-700 font-medium mb-1",children:"Total Periods"}),n.jsx("div",{className:"text-3xl font-bold text-purple-900",children:o.overall.total_marked_periods})]})]})]}),o&&o.by_subject&&o.by_subject.length>0&&n.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(va,{className:"h-5 w-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Subject-wise Breakdown"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.by_subject.map(f=>{const x=f.percentage!=null?f.percentage:0,g=f.counts||{};return n.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[n.jsxs("div",{className:"flex justify-between items-start mb-3",children:[n.jsx("div",{className:"font-semibold text-gray-900",children:f.subject_display||f.subject_key}),n.jsx("div",{className:"text-lg font-bold text-indigo-600",children:x!=null?`${x.toFixed(1)}%`:"N/A"})]}),n.jsx("div",{className:"h-2.5 bg-gray-200 rounded-full overflow-hidden mb-3",children:n.jsx("div",{className:`h-full transition-all ${x>=75?"bg-green-500":x>=50?"bg-amber-500":"bg-red-500"}`,style:{width:`${Math.max(0,Math.min(100,x))}%`}})}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded border border-green-200",children:["P: ",g.P||0]}),n.jsxs("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded border border-red-200",children:["A: ",g.A||0]}),n.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded border border-blue-200",children:["LEAVE: ",g.LEAVE||0]}),n.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded border border-purple-200",children:["OD: ",g.OD||0]}),n.jsxs("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 text-xs font-medium rounded border border-amber-200",children:["LATE: ",g.LATE||0]})]})]},f.subject_key)})})]}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(mi,{className:"h-5 w-5 text-indigo-600"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Attendance Records"})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Period"}),n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Section"}),n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Subject"}),n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),n.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Marked By"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:a.map(f=>{var x,g,y;return n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ca,{className:"h-4 w-4 text-gray-400"}),f.date]})}),n.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:((x=f.period)==null?void 0:x.label)||((g=f.period)!=null&&g.index?`Period ${f.period.index}`:"")}),n.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:((y=f.section)==null?void 0:y.name)||""}),n.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-medium",children:f.subject_display||""}),n.jsx("td",{className:"px-6 py-4 text-sm",children:n.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium border ${h(f.status)}`,children:[p(f.status),f.status]})}),n.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Lu,{className:"h-3.5 w-3.5 text-gray-400"}),f.marked_by||""]})})]},f.id)})})]})})]})]})})]})})}const T0="";async function XJ(){const e=await hr(`${T0}/api/academics/mentor/staff/`);return e.ok?e.json():{results:[]}}async function YJ(e){const t=await hr(`${T0}/api/academics/mentor/staff/${e}/students/`);return t.ok?t.json():{results:[]}}async function KJ(e,t){return await hr(`${T0}/api/academics/mentor/map/`,{method:"POST",body:JSON.stringify({mentor_id:e,student_ids:t})})}async function F4(){const e=await hr(`${T0}/api/academics/my-students/`);return e.ok?e.json():{results:[]}}async function JJ(e,t){const r={student_ids:[e]};return t&&(r.mentor_id=t),await hr(`${T0}/api/academics/mentor/unmap/`,{method:"POST",body:JSON.stringify(r)})}async function ZJ(){const e=await hr(`${T0}/api/academics/mentor/my-mentees/`);return e.ok?e.json():{results:[]}}function eZ(){const[e,t]=v.useState([]),[r,s]=v.useState(null),[a,i]=v.useState([]),[o,l]=v.useState([]),[c,d]=v.useState(!1);v.useEffect(()=>{u()},[]);async function u(){const y=await XJ();t(y.results||[])}async function h(){const m=(await F4()).results||[],w=[];m.forEach(S=>{(S.students||[]).forEach(F=>w.push(F))}),i(w)}async function p(y){s(y),l([]),i([]);const w=(await YJ(y)).results||[],k=(await F4()).results||[],F=[];k.forEach(O=>{(O.students||[]).forEach(W=>F.push(W))});const L=new Set(w.map(O=>O.id)),C=F.filter(O=>!L.has(O.id)&&!O.has_mentor);l(w),i(C)}async function f(y){if(!r)return alert("Select a mentor first");d(!0);const m=await KJ(r,[y]);if(m.ok)await h(),r&&await p(r);else{const w=await m.json().catch(()=>null);alert("Failed: "+(w&&w.detail?w.detail:m.statusText))}d(!1)}async function x(y){if(!r)return;d(!0);const m=await JJ(y,r);if(m.ok)await h(),r&&await p(r);else{const w=await m.json().catch(()=>null);alert("Failed to remove: "+(w&&w.detail?w.detail:m.statusText))}d(!1)}const g=e.find(y=>y.id===r);return n.jsxs("div",{className:"min-h-screen p-4 md:p-6 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm mb-6 p-6 border border-slate-200",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 p-3 rounded-xl shadow-lg",children:n.jsx(Cx,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"Mentor Assignment"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Assign and manage mentor mappings for your students"})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[n.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-slate-50",children:n.jsxs("h3",{className:"text-lg font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx(Qs,{className:"w-5 h-5 text-indigo-600"}),"Staff Members",n.jsx("span",{className:"ml-auto px-2.5 py-0.5 bg-indigo-100 text-indigo-700 text-xs font-medium rounded-full",children:e.length})]})}),n.jsx("div",{className:"p-4 max-h-[600px] overflow-y-auto",children:e.length===0?n.jsx("div",{className:"text-center py-8 text-slate-500",children:"No staff members available"}):n.jsx("div",{className:"space-y-2",children:e.map(y=>n.jsx("div",{className:`p-4 rounded-lg border transition-all cursor-pointer ${r===y.id?"bg-gradient-to-r from-indigo-50 to-blue-50 border-indigo-300 shadow-md":"bg-white border-slate-200 hover:border-indigo-200 hover:shadow-sm"}`,onClick:()=>p(y.id),children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:`font-medium ${r===y.id?"text-indigo-900":"text-slate-900"}`,children:y.username}),n.jsx("div",{className:"text-sm text-slate-600 mt-1",children:n.jsx("span",{className:"font-mono",children:y.staff_id||"N/A"})})]}),n.jsxs("button",{onClick:m=>{m.stopPropagation(),p(y.id)},className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5 ${r===y.id?"bg-indigo-600 text-white":"bg-indigo-100 text-indigo-700 hover:bg-indigo-200"}`,children:[n.jsx(E6,{className:"w-4 h-4"}),"View"]})]})},y.id))})})]})}),n.jsx("div",{className:"lg:col-span-3",children:r?n.jsxs("div",{className:"space-y-6",children:[g&&n.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-4 shadow-lg",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Cx,{className:"w-6 h-6"}),n.jsxs("div",{children:[n.jsxs("div",{className:"font-semibold",children:["Selected Mentor: ",g.username]}),n.jsxs("div",{className:"text-sm opacity-90",children:["Staff ID: ",g.staff_id||"N/A"]})]})]})}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[n.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-green-50",children:n.jsxs("h4",{className:"text-base font-semibold text-green-900 flex items-center gap-2",children:[n.jsx(v0,{className:"w-5 h-5 text-green-700"}),"Assigned Students",n.jsx("span",{className:"ml-auto px-2.5 py-0.5 bg-green-200 text-green-800 text-xs font-medium rounded-full",children:o.length})]})}),n.jsx("div",{className:"p-4 max-h-[300px] overflow-y-auto",children:o.length>0?n.jsx("div",{className:"space-y-2",children:o.map(y=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"text-sm font-medium text-slate-900",children:[y.reg_no,"  ",y.username]}),n.jsx("div",{className:"text-xs text-slate-600 mt-0.5",children:y.section_name})]}),n.jsxs("button",{className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-red-300 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5",onClick:()=>x(y.id),disabled:c,children:[n.jsx(FB,{className:"w-4 h-4"}),"Remove"]})]},y.id))}):n.jsx("div",{className:"text-center py-8 text-slate-500",children:"No students currently assigned to this mentor"})})]}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[n.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-blue-50",children:n.jsxs("h4",{className:"text-base font-semibold text-blue-900 flex items-center gap-2",children:[n.jsx(Qs,{className:"w-5 h-5 text-blue-700"}),"Available to Assign",n.jsx("span",{className:"ml-auto px-2.5 py-0.5 bg-blue-200 text-blue-800 text-xs font-medium rounded-full",children:a.length})]})}),n.jsx("div",{className:"p-4 max-h-[300px] overflow-y-auto",children:a.length>0?n.jsx("div",{className:"space-y-2",children:a.map(y=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"text-sm font-medium text-slate-900",children:[y.reg_no,"  ",y.username]}),n.jsx("div",{className:"text-xs text-slate-600 mt-0.5",children:y.section_name})]}),n.jsxs("button",{className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 disabled:bg-green-300 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5",onClick:()=>f(y.id),disabled:c||!r,children:[c?n.jsx(zi,{className:"w-4 h-4 animate-spin"}):n.jsx(TB,{className:"w-4 h-4"}),"Assign"]})]},y.id))}):n.jsx("div",{className:"text-center py-8 text-slate-500",children:"No available students to assign"})})]})]}):n.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12",children:n.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[n.jsx("div",{className:"bg-slate-100 p-4 rounded-full mb-4",children:n.jsx(Cx,{className:"w-16 h-16 text-slate-400"})}),n.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:"Select a Staff Member"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Click on a staff member to view and manage their mentee assignments"})]})})})]})]})}function tZ(){const[e,t]=v.useState([]),[r,s]=v.useState(!1);v.useEffect(()=>{a()},[]);async function a(){s(!0);try{const i=await ZJ();t(i.results||[])}catch(i){console.error(i),alert("Failed to load mentees")}finally{s(!1)}}return n.jsxs("div",{className:"min-h-screen p-4 md:p-6 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm mb-6 p-6 border border-slate-200",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 p-3 rounded-xl shadow-lg",children:n.jsx(Qs,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"My Mentees"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Students assigned to you as mentor"})]})]})}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[n.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-slate-50",children:n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("h2",{className:"text-lg font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx(Cx,{className:"w-5 h-5 text-indigo-600"}),"Mentees List",!r&&e.length>0&&n.jsx("span",{className:"ml-2 px-2.5 py-0.5 bg-indigo-100 text-indigo-700 text-xs font-medium rounded-full",children:e.length})]})})}),n.jsxs("div",{className:"p-6",children:[r&&n.jsxs("div",{className:"flex items-center justify-center py-12",children:[n.jsx(zi,{className:"w-8 h-8 text-indigo-600 animate-spin"}),n.jsx("span",{className:"ml-3 text-slate-600",children:"Loading mentees..."})]}),!r&&e.length===0&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[n.jsx("div",{className:"bg-slate-100 p-4 rounded-full mb-4",children:n.jsx(Qs,{className:"w-12 h-12 text-slate-400"})}),n.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:"No Mentees Assigned"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"You don't have any students assigned as mentees yet."})]}),!r&&e.length>0&&n.jsx("div",{children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-200",children:[n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700 bg-slate-50",children:"Reg No"}),n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700 bg-slate-50",children:"Name"}),n.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700 bg-slate-50",children:"Section"})]})}),n.jsx("tbody",{className:"divide-y divide-slate-200",children:e.map(i=>n.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[n.jsx("td",{className:"py-3 px-4",children:n.jsx("span",{className:"text-sm font-medium text-slate-900",children:i.reg_no})}),n.jsx("td",{className:"py-3 px-4",children:n.jsx("span",{className:"text-sm text-slate-700",children:i.username})}),n.jsx("td",{className:"py-3 px-4",children:n.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800",children:i.section_name||"N/A"})})]},i.id))})]})})]})]})]})}function rZ(){const[e,t]=v.useState(null),[r,s]=v.useState(!0),{collapsed:a}=Zv();return v.useEffect(()=>{Pp().then(o=>{const l={...o,roles:Array.isArray(o.roles)?o.roles.map(c=>typeof c=="string"?c:c.name):[],permissions:Array.isArray(o.permissions)?o.permissions:[],profile_type:o.profile_type||null,profile:o.profile||null};t(l)}).catch(()=>t(null)).finally(()=>s(!1))},[]),r?n.jsx("div",{className:"flex justify-center items-center h-screen",children:n.jsx("p",{className:"text-gray-600",children:"Loading..."})}):((Array.isArray(e==null?void 0:e.permissions)?e==null?void 0:e.permissions:[]).map(o=>String(o||"").toLowerCase()),n.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-x-hidden",children:[n.jsx(R6,{user:e}),e?n.jsxs("div",{className:"flex",children:[n.jsx(dP,{}),n.jsx("main",{className:`flex-1 transition-all duration-300 pt-20 overflow-x-hidden ${a?"lg:ml-20":"lg:ml-64"}`,children:n.jsxs(o2,{children:[n.jsx(Pn,{path:"/",element:n.jsx(Tf,{to:"/dashboard",replace:!0})}),n.jsx(Pn,{path:"/dashboard",element:n.jsx(mJ,{})}),n.jsx(Pn,{path:"/profile",element:n.jsx(xJ,{user:e})}),n.jsx(Pn,{path:"/import/questions",element:n.jsx(jJ,{})}),n.jsx(Pn,{path:"/curriculum/master",element:n.jsx(gJ,{})}),n.jsx(Pn,{path:"/curriculum/master/:id",element:n.jsx(S4,{})}),n.jsx(Pn,{path:"/curriculum/master/new",element:n.jsx(S4,{})}),n.jsx(Pn,{path:"/curriculum/department",element:n.jsx(yJ,{})}),n.jsx(Pn,{path:"/curriculum/elective-import",element:n.jsx(Rs,{user:e,requiredPermissions:["curriculum.import_elective_choices"],element:n.jsx(bJ,{})})}),n.jsx(Pn,{path:"/obe",element:n.jsx(w8,{})}),n.jsx(Pn,{path:"/obe/course/:code/*",element:n.jsx(MJ,{})}),n.jsx(Pn,{path:"/obe/request",element:n.jsx(Rs,{user:e,requiredProfile:"STAFF",element:n.jsx(RJ,{})})}),n.jsx(Pn,{path:"/obe/master/requests",element:n.jsx(Rs,{user:e,requiredPermissions:["obe.master.manage"],element:n.jsx(hJ,{})})}),n.jsx(Pn,{path:"/obe/master/due-dates",element:n.jsx(Rs,{user:e,requiredPermissions:["obe.master.manage"],element:n.jsx(tw,{})})}),n.jsx(Pn,{path:"/academic",element:n.jsx(_J,{})}),n.jsx(Pn,{path:"/hod/advisors",element:n.jsx(Rs,{user:e,requiredRoles:["HOD"],requiredPermissions:["academics.assign_advisor"],element:n.jsx(BJ,{})})}),n.jsx(Pn,{path:"/advisor/teaching",element:n.jsx(Rs,{user:e,requiredRoles:["ADVISOR"],requiredPermissions:["academics.assign_teaching"],element:n.jsx(PJ,{})})}),n.jsx(Pn,{path:"/iqac/timetable",element:n.jsx(Rs,{user:e,requiredPermissions:["timetable.manage_templates"],element:n.jsx(pP,{})})}),n.jsx(Pn,{path:"/iqac/academic-controller",element:n.jsx(Rs,{user:e,requiredRoles:["IQAC"],requiredPermissions:["obe.master.manage"],element:n.jsx(AP,{})})}),n.jsx(Pn,{path:"/iqac/academic-controller/course/:courseCode",element:n.jsx(Rs,{user:e,requiredRoles:["IQAC"],requiredPermissions:["obe.master.manage"],element:n.jsx(TP,{})})}),n.jsx(Pn,{path:"/iqac/academic-controller/course/:courseCode/marks/:taId",element:n.jsx(Rs,{user:e,requiredRoles:["IQAC"],requiredPermissions:["obe.master.manage"],element:n.jsx(BK,{})})}),n.jsx(Pn,{path:"/iqac/academic-controller/course/:courseCode/internal-mark/:taId",element:n.jsx(Rs,{user:e,requiredRoles:["IQAC"],requiredPermissions:["obe.master.manage"],element:n.jsx(fJ,{})})}),n.jsx(Pn,{path:"/iqac/academic-controller/course/:courseCode/obe/:taId/*",element:n.jsx(Rs,{user:e,requiredRoles:["IQAC"],requiredPermissions:["obe.master.manage"],element:n.jsx(uJ,{})})}),n.jsx(Pn,{path:"/iqac/obe-requests",element:n.jsx(Rs,{user:e,requiredPermissions:["obe.master.manage"],element:n.jsx(aA,{})})}),n.jsx(Pn,{path:"/advisor/timetable",element:n.jsx(Rs,{user:e,requiredRoles:["ADVISOR"],requiredPermissions:["timetable.assign"],element:n.jsx(hP,{})})}),n.jsx(Pn,{path:"/advisor/students",element:n.jsx(Rs,{user:e,requiredRoles:["ADVISOR"],requiredPermissions:["academics.view_my_students"],element:n.jsx(OJ,{})})}),n.jsx(Pn,{path:"/advisor/mentor",element:n.jsx(Rs,{user:e,requiredRoles:["ADVISOR"],requiredPermissions:["academics.assign_mentor"],element:n.jsx(eZ,{})})}),n.jsx(Pn,{path:"/student/timetable",element:n.jsx(Rs,{user:e,requiredProfile:"STUDENT",requiredPermissions:["timetable.view"],element:n.jsx(DJ,{})})}),n.jsx(Pn,{path:"/student/attendance",element:n.jsx(Rs,{user:e,requiredProfile:"STUDENT",element:n.jsx(QJ,{})})}),n.jsx(Pn,{path:"/staff/timetable",element:n.jsx(Rs,{user:e,requiredProfile:"STAFF",requiredPermissions:["timetable.view"],element:n.jsx(WJ,{})})}),n.jsx(Pn,{path:"/staff/assigned-subjects",element:n.jsx(Rs,{user:e,requiredProfile:"STAFF",requiredPermissions:["academics.view_assigned_subjects"],element:n.jsx(HJ,{})})}),n.jsx(Pn,{path:"/staff/period-attendance",element:n.jsx(Rs,{user:e,requiredProfile:"STAFF",requiredPermissions:["academics.mark_attendance"],element:n.jsx(VJ,{})})}),n.jsx(Pn,{path:"/staff/analytics",element:n.jsx(Rs,{user:e,requiredProfile:"STAFF",requiredPermissions:["analytics.view_all_analytics","analytics.view_department_analytics","analytics.view_class_analytics"],element:n.jsx(GJ,{})})}),n.jsx(Pn,{path:"/staff/mentees",element:n.jsx(Rs,{user:e,requiredProfile:"STAFF",requiredPermissions:["academics.view_mentees"],element:n.jsx(tZ,{})})}),n.jsx(Pn,{path:"*",element:e?n.jsx(Tf,{to:"/dashboard",replace:!0}):n.jsx(fb,{user:e})})]})})]}):n.jsx("div",{className:"pt-16",children:n.jsxs(o2,{children:[n.jsx(Pn,{path:"/",element:e?n.jsx(Tf,{to:"/dashboard",replace:!0}):n.jsx(fb,{user:e})}),n.jsx(Pn,{path:"*",element:e?n.jsx(Tf,{to:"/dashboard",replace:!0}):n.jsx(fb,{user:e})})]})})]}))}function nZ(){const[e,t]=v.useState(""),[r,s]=v.useState(""),[a,i]=v.useState(!1),[o,l]=v.useState(null),[c,d]=v.useState(!1),u=Ri();function h(f){if(typeof f!="object"||f===null)return null;const g=f.response;if(!g)return null;const y=g.data;if(!y)return null;const m=y.non_field_errors;return Array.isArray(m)&&m.length>0?String(m[0]):typeof y.detail=="string"?y.detail:null}const p=async f=>{f.preventDefault(),l(null),d(!0);try{await N6(e,r),u("/dashboard")}catch(x){const g=h(x)||"Login failed";l(g)}finally{d(!1)}};return n.jsxs(n.Fragment,{children:[n.jsx(R6,{user:null}),n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"max-w-md w-full",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 sm:p-10",children:[n.jsxs("div",{className:"mb-8 text-center",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome Back"}),n.jsx("p",{className:"text-gray-600",children:"Sign in to access your account"})]}),n.jsxs("form",{className:"space-y-6",onSubmit:p,children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",htmlFor:"identifier",children:"Email or Register No"}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:n.jsx(Jv,{className:"h-5 w-5 text-gray-400"})}),n.jsx("input",{id:"identifier",type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"College Email or Reg. No.",value:e,onChange:f=>t(f.target.value),required:!0,disabled:c})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",htmlFor:"password",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:n.jsx(ou,{className:"h-5 w-5 text-gray-400"})}),n.jsx("input",{id:"password",type:a?"text":"password",className:"block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter your password",value:r,onChange:f=>s(f.target.value),required:!0,disabled:c}),n.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>i(!a),"aria-label":a?"Hide password":"Show password",children:a?n.jsx(YR,{className:"h-5 w-5"}):n.jsx(E6,{className:"h-5 w-5"})})]})]}),n.jsx("div",{className:"flex items-center justify-end",children:n.jsx(sa,{to:"/forgot-password",className:"text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors",children:"Forgot Password?"})}),o&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[n.jsx(Wi,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-red-800",children:o})]}),n.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98]",disabled:c,children:c?n.jsxs("span",{className:"flex items-center justify-center gap-2",children:[n.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing In..."]}):"Sign In"}),n.jsx("div",{className:"text-center pt-4",children:n.jsx(sa,{to:"/",className:"text-sm text-gray-600 hover:text-gray-900 font-medium transition-colors",children:" Back to Home"})})]})]})})})]})}HN(document.getElementById("root")).render(n.jsx(Jr.StrictMode,{children:n.jsx(RF,{children:n.jsx(UB,{children:n.jsxs(o2,{children:[n.jsx(Pn,{path:"/login",element:n.jsx(nZ,{})}),n.jsx(Pn,{path:"/*",element:n.jsx(rZ,{})})]})})})}));export{ds as _,aZ as c,lT as g};
